{"id": "207835", "title": "ACPI video backlight brightness control does not work on Acer TravelMate 5735Z by default", "description": "On the Intel GM45/GMA 4500MHD laptop with Debian Sid/unstable and Linux 5.6.7 and GNOME Shell 3.36.2, trying to change the brightness of the internal display using the function keys, GNOME shows the OSD, which seems to have five levels (from acer_wmi?), but the actual brightness does *not* change. There is only `/sys/class/backlight/intel_backlight/brightness` though, and writing values to it seems to work.\n\nBooting the system with `acpi_backlight=vendor`, exposes `/sys/devices/platform/acer-wmi/backlight/acer-wmi/brightness`, but the behavior is the same.\n\nBooting the system with `acpi_backlight=native` or `acpi_backlight=native`, changing the brightness with the function keys works, and there now seem to be 15 (or 16) levels.\n\n```\n$ grep '.*' /sys/class/dmi/id/*_* 2> /dev/null\n/sys/class/dmi/id/bios_date:07/26/2011\n/sys/class/dmi/id/bios_vendor:Acer\n/sys/class/dmi/id/bios_version:V1.14\n/sys/class/dmi/id/board_asset_tag:Base Board Asset Tag\n/sys/class/dmi/id/board_name:BA51_MV\n/sys/class/dmi/id/board_vendor:Acer\n/sys/class/dmi/id/board_version:V1.14\n/sys/class/dmi/id/chassis_asset_tag:\n/sys/class/dmi/id/chassis_type:10\n/sys/class/dmi/id/chassis_vendor:Acer\n/sys/class/dmi/id/chassis_version:V1.14\n/sys/class/dmi/id/product_family:Intel_Mobile\n/sys/class/dmi/id/product_name:TravelMate 5735Z\n/sys/class/dmi/id/product_sku:Montevina_Fab\n/sys/class/dmi/id/product_version:V1.14\n/sys/class/dmi/id/sys_vendor:Acer\n```", "patch": ["From c55ae691503c56f502d36ab7649ee77d820e3d25 Mon Sep 17 00:00:00 2001\nFrom: Paul Menzel <pmenzel@molgen.mpg.de>\nDate: Thu, 21 May 2020 23:15:24 +0200\nSubject: [PATCH] ACPI: video: Use native backlight on Acer TravelMate 5735Z\nMIME-Version: 1.0\nContent-Type: text/plain; charset=UTF-8\nContent-Transfer-Encoding: 8bit\n\nCurrently, changing the brightness of the internal display of the Acer\nTravelMate 5735Z does not work. Pressing the function keys or changing the\nslider, GNOME Shell 3.36.2 displays the OSD (five steps), but the\nbrightness does not change.\n\nThe Acer TravelMate 5735Z shipped with Windows 7 and as such does not\ntrigger our \"win8 ready\" heuristic for preferring the native backlight\ninterface.\n\nStill ACPI backlight control doesn't work on this model, where as the\nnative (intel_video) backlight interface does work by adding\n`acpi_backlight=native` or `acpi_backlight=none` to Linux’ command line.\n\nSo, add a quirk to force using native backlight control on this model.\n\nCloses: https://bugzilla.kernel.org/show_bug.cgi?id=207835\nSigned-off-by: Paul Menzel <pmenzel@molgen.mpg.de>\n---\n drivers/acpi/video_detect.c | 10 ++++++++++\n 1 file changed, 10 insertions(+)\n\ndiff --git a/drivers/acpi/video_detect.c b/drivers/acpi/video_detect.c\nindex b4994e50608d..2499d7e3c710 100644\n--- a/drivers/acpi/video_detect.c\n+++ b/drivers/acpi/video_detect.c\n@@ -361,6 +361,16 @@ static const struct dmi_system_id video_detect_dmi_table[] = {\n \t\tDMI_MATCH(DMI_BOARD_NAME, \"JV50\"),\n \t\t},\n \t},\n+\t{\n+\t /* https://bugzilla.kernel.org/show_bug.cgi?id=207835 */\n+\t .callback = video_detect_force_native,\n+\t .ident = \"Acer TravelMate 5735Z\",\n+\t .matches = {\n+\t\tDMI_MATCH(DMI_SYS_VENDOR, \"Acer\"),\n+\t\tDMI_MATCH(DMI_PRODUCT_NAME, \"TravelMate 5735Z\"),\n+\t\tDMI_MATCH(DMI_BOARD_NAME, \"BA51_MV\"),\n+\t\t},\n+\t},\n \n \t/*\n \t * Desktops which falsely report a backlight and which our heuristics\n-- \n2.27.0.rc0\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "Other", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "acpi_other", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2020-05-21 21:01 UTC by Paul Menzel", "Modified": "2020-06-30 06:49 UTC", "CC List": "3 users", "See Also": "", "Kernel Version": "5.6.7", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/acpi/video_detect.c"], "methods": ["video_detect_dmi_table"]}
{"id": "206661", "title": "iwlwifi:9260: missing PCI subdevice entries for 0x2526 (0x04010, 0x4018 and 0x401C)", "description": "Created attachment 287603 [details]\nBoot Log of Error\n\nI am using Kernel 5.6 RC2 and I am seeing issues where firmware is not being loaded for my Intel Corporation Wireless-AC 9260 card.  Attached is the boot logging.\n\nIf I can do anything to debug, let me know,", "patch": ["From f842f4ad6098dd99c22886554dc93947818d4d2a Mon Sep 17 00:00:00 2001\nFrom: Luca Coelho <luciano.coelho@intel.com>\nDate: Tue, 10 Mar 2020 14:25:21 +0200\nSubject: [PATCH] iwlwifi: pcie: add 0x2526/0x401* devices back to cfg\n detection\n\nThree devices, with PCI device ID 0x2526 and subdevice IDs 0x4010,\n0x4018 and 0x401C were removed accidentally.  Add them back.\n\nReported-by: Brett Hassal <brett.hassal@gmail.com>\nBugzilla: https://bugzilla.kernel.org/show_bug.cgi?id=206661\nFixes: 0b295a1eb81f (\"iwlwifi: add device name to device_info\")\nSigned-off-by: Luca Coelho <luciano.coelho@intel.com>\n---\n drivers/net/wireless/intel/iwlwifi/pcie/drv.c | 3 +++\n 1 file changed, 3 insertions(+)\n\ndiff --git a/drivers/net/wireless/intel/iwlwifi/pcie/drv.c b/drivers/net/wireless/intel/iwlwifi/pcie/drv.c\nindex 97f227f3cbc3..f441b20e1642 100644\n--- a/drivers/net/wireless/intel/iwlwifi/pcie/drv.c\n+++ b/drivers/net/wireless/intel/iwlwifi/pcie/drv.c\n@@ -981,6 +981,9 @@ static const struct iwl_dev_info iwl_dev_info_table[] = {\n \tIWL_DEV_INFO(0x2526, 0x0014, iwl9260_2ac_160_cfg, iwl9260_160_name),\n \tIWL_DEV_INFO(0x2526, 0x0018, iwl9260_2ac_160_cfg, iwl9260_160_name),\n \tIWL_DEV_INFO(0x2526, 0x001C, iwl9260_2ac_160_cfg, iwl9260_160_name),\n+\tIWL_DEV_INFO(0x2526, 0x4010, iwl9260_2ac_160_cfg, iwl9260_160_name),\n+\tIWL_DEV_INFO(0x2526, 0x4018, iwl9260_2ac_160_cfg, iwl9260_160_name),\n+\tIWL_DEV_INFO(0x2526, 0x401C, iwl9260_2ac_160_cfg, iwl9260_160_name),\n \tIWL_DEV_INFO(0x2526, 0x6010, iwl9260_2ac_160_cfg, iwl9260_160_name),\n \tIWL_DEV_INFO(0x2526, 0x6014, iwl9260_2ac_160_cfg, iwl9260_160_name),\n \tIWL_DEV_INFO(0x2526, 0x8014, iwl9260_2ac_160_cfg, iwl9260_160_name),\n-- \n2.25.1\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "network-wireless", "Hardware": "All Linux", "Importance": "P1 high", "Assignee": "DO NOT USE - assign \"network-wireless-intel\" component instead", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2020-02-25 02:22 UTC by Mark Bidewell", "Modified": "2020-03-26 05:25 UTC", "CC List": "4 users", "See Also": "", "Kernel Version": "5.6-rc2", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/net/wireless/intel/iwlwifi/pcie/drv.c"], "methods": ["iwl_dev_info_table"]}
{"id": "203617", "title": "ACPI Error \"storm\" on LG Gram 17 (\"No handler or method for GPE...\")", "description": "Created attachment 282777 [details]\nOutput of `uname -a`\n\nAttempting to boot an LG 17Z990 with newer kernels causes an endless stream of errors. Excerpt:\n\n00:47:20 phobos kernel: [   26.235209] ACPI Error: No installed handler for fixed event - PM_Timer (0), disabling (20190215/evevent-257)\n00:47:20 phobos kernel: [   26.236062] ACPI Error: No installed handler for fixed event - SleepButton (3), disabling (20190215/evevent-257)\n00:47:20 phobos kernel: [   26.236917] ACPI Error: Could not disable RealTimeClock events (20190215/evxfevnt-245)\n00:47:20 phobos kernel: [   26.237796] ACPI Error: No handler or method for GPE 08, disabling event (20190215/evgpe-835)\n00:47:20 phobos kernel: [   26.238699] ACPI Error: No handler or method for GPE 09, disabling event (20190215/evgpe-835)\n00:47:20 phobos kernel: [   26.239306] ACPI Error: No handler or method for GPE 0A, disabling event (20190215/evgpe-835)\n00:47:20 phobos kernel: [   26.239910] ACPI Error: No handler or method for GPE 0B, disabling event (20190215/evgpe-835)\n00:47:20 phobos kernel: [   26.240517] ACPI Error: No handler or method for GPE 0C, disabling event (20190215/evgpe-835)\n00:47:20 phobos kernel: [   26.241123] ACPI Error: No handler or method for GPE 0D, disabling event (20190215/evgpe-835)\n00:47:20 phobos kernel: [   26.241724] ACPI Error: No handler or method for GPE 0E, disabling event (20190215/evgpe-835)\n00:47:20 phobos kernel: [   26.242450] ACPI Error: No handler or method for GPE 10, disabling event (20190215/evgpe-835)\n00:47:20 phobos kernel: [   26.243086] ACPI Error: No handler or method for GPE 11, disabling event (20190215/evgpe-835)\n00:47:20 phobos kernel: [   26.243792] ACPI Error: No handler or method for GPE 13, disabling event (20190215/evgpe-835)\n00:47:20 phobos kernel: [   26.244411] ACPI Error: No handler or method for GPE 14, disabling event (20190215/evgpe-835)\n00:47:20 phobos kernel: [   26.245031] ACPI Error: No handler or method for GPE 15, disabling event (20190215/evgpe-835)\n00:47:20 phobos kernel: [   26.245648] ACPI Error: No handler or method for GPE 16, disabling event (20190215/evgpe-835)\n00:47:20 phobos kernel: [   26.246248] ACPI Error: No handler or method for GPE 17, disabling event (20190215/evgpe-835)\n00:47:20 phobos kernel: [   26.246847] ACPI Error: No handler or method for GPE 20, disabling event (20190215/evgpe-835)\n00:47:20 phobos kernel: [   26.247422] ACPI Error: No handler or method for GPE 21, disabling event (20190215/evgpe-835)\n00:47:20 phobos kernel: [   26.248092] ACPI Error: No handler or method for GPE 23, disabling event (20190215/evgpe-835)\n00:47:20 phobos kernel: [   26.248653] ACPI Error: No handler or method for GPE 24, disabling event (20190215/evgpe-835)\n00:47:20 phobos kernel: [   26.249215] ACPI Error: No handler or method for GPE 25, disabling event (20190215/evgpe-835)\n00:47:20 phobos kernel: [   26.249775] ACPI Error: No handler or method for GPE 26, disabling event (20190215/evgpe-835)\n00:47:20 phobos kernel: [   26.250335] ACPI Error: No handler or method for GPE 27, disabling event (20190215/evgpe-835)\n00:47:20 phobos kernel: [   26.250988] ACPI Error: No handler or method for GPE 51, disabling event (20190215/evgpe-835)\n00:47:20 phobos kernel: [   26.251549] ACPI Error: No handler or method for GPE 52, disabling event (20190215/evgpe-835)\n00:47:20 phobos kernel: [   26.252107] ACPI Error: No handler or method for GPE 53, disabling event (20190215/evgpe-835)\n00:47:20 phobos kernel: [   26.252664] ACPI Error: No handler or method for GPE 54, disabling event (20190215/evgpe-835)\n00:47:20 phobos kernel: [   26.253222] ACPI Error: No handler or method for GPE 55, disabling event (20190215/evgpe-835)\n00:47:20 phobos kernel: [   26.253781] ACPI Error: No handler or method for GPE 56, disabling event (20190215/evgpe-835)\n00:47:20 phobos kernel: [   26.254340] ACPI Error: No handler or method for GPE 57, disabling event (20190215/evgpe-835)\n00:47:20 phobos kernel: [   26.254898] ACPI Error: No handler or method for GPE 60, disabling event (20190215/evgpe-835)\n00:47:20 phobos kernel: [   26.255620] ACPI Error: No handler or method for GPE 63, disabling event (20190215/evgpe-835)\n00:47:20 phobos kernel: [   26.256181] ACPI Error: No handler or method for GPE 64, disabling event (20190215/evgpe-835)\n00:47:20 phobos kernel: [   26.256743] ACPI Error: No handler or method for GPE 65, disabling event (20190215/evgpe-835)\n00:47:20 phobos kernel: [   26.257380] ACPI Error: No handler or method for GPE 67, disabling event (20190215/evgpe-835)\n00:47:20 phobos kernel: [   26.257940] ACPI Error: No handler or method for GPE 68, disabling event (20190215/evgpe-835)\n00:47:20 phobos kernel: [   26.258592] ACPI Error: No handler or method for GPE 6A, disabling event (20190215/evgpe-835)\n00:47:20 phobos kernel: [   26.259144] ACPI Error: No handler or method for GPE 6B, disabling event (20190215/evgpe-835)\n00:47:20 phobos kernel: [   26.259701] ACPI Error: No handler or method for GPE 6C, disabling event (20190215/evgpe-835)\n00:47:20 phobos kernel: [   26.260326] ACPI Error: No handler or method for GPE 6E, disabling event (20190215/evgpe-835)\n00:47:20 phobos kernel: [   26.260859] ACPI Error: No handler or method for GPE 6F, disabling event (20190215/evgpe-835)\n00:47:20 phobos kernel: [   26.261437] ACPI Error: No installed handler for fixed event - PM_Timer (0), disabling (20190215/evevent-257)\n00:47:20 phobos kernel: [   26.262166] ACPI Error: No installed handler for fixed event - SleepButton (3), disabling (20190215/evevent-257)\n00:47:20 phobos kernel: [   26.289509] ACPI Error: Aborting method \\_GPE._L69 due to previous error (AE_NOT_FOUND) (20190215/psparse-531)\n00:47:20 phobos kernel: [   26.290363] ACPI Error: AE_NOT_FOUND, while evaluating GPE method [_L69] (20190215/evgpe-509)\n\nUsually the system won't boot at all, producing many MB of error logs instead. Occasionally, depending on the kernel config and the phase of the moon, it'll get to a login prompt, but the system is mostly unusable.\n\nBooting with 'pci=noacpi' prevents the errors but disables sleep and hibernation functions.\n\nKernel version 4.14.119 doesn't have this problem. Stock Debian Stretch works okay.\n\nKernel version 4.19 in Debian Buster does have this problem. I've also tried the 5.0.10 and 5.1 kernels, which have the same problem, and Ubuntu 19.04 which also has the same problem.\n\nBug #114201 looks similar to this, so I tried disabling the Watchdog completely in .config, but that didn't help. I haven't been able to identify any values in the .config files from one version to the next that would suggest a root cause there.\n\nI'm having trouble building kernel 4.15rc1, but I'll keep trying to nail down the version that introduces this bug.\n\nI'm quite eager to get this fixed and will try to respond promptly with additional information as needed and test any other suggestions.", "patch": ["diff --git a/drivers/pci/hotplug/acpiphp_glue.c b/drivers/pci/hotplug/acpiphp_glue.c\nindex e4c46637f32f..b3869951c0eb 100644\n--- a/drivers/pci/hotplug/acpiphp_glue.c\n+++ b/drivers/pci/hotplug/acpiphp_glue.c\n@@ -449,8 +449,15 @@ static void acpiphp_native_scan_bridge(struct pci_dev *bridge)\n \n \t/* Scan non-hotplug bridges that need to be reconfigured */\n \tfor_each_pci_bridge(dev, bus) {\n-\t\tif (!hotplug_is_native(dev))\n-\t\t\tmax = pci_scan_bridge(bus, dev, max, 1);\n+\t\tif (hotplug_is_native(dev))\n+\t\t\tcontinue;\n+\n+\t\tmax = pci_scan_bridge(bus, dev, max, 1);\n+\t\tif (dev->subordinate) {\n+\t\t\tpcibios_resource_survey_bus(dev->subordinate);\n+\t\t\tpci_bus_size_bridges(dev->subordinate);\n+\t\t\tpci_bus_assign_resources(dev->subordinate);\n+\t\t}\n \t}\n }\n \n@@ -480,7 +487,6 @@ static void enable_slot(struct acpiphp_slot *slot, bool bridge)\n \t\t\tif (PCI_SLOT(dev->devfn) == slot->device)\n \t\t\t\tacpiphp_native_scan_bridge(dev);\n \t\t}\n-\t\tpci_assign_unassigned_bridge_resources(bus->self);\n \t} else {\n \t\tLIST_HEAD(add_list);\n \t\tint max, pass;\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "Other", "Hardware": "Intel Linux", "Importance": "P1 normal", "Assignee": "Mika Westerberg", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2019-05-16 02:20 UTC by Rob", "Modified": "2022-08-04 14:35 UTC", "CC List": "13 users", "See Also": "", "Kernel Version": "5.1", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/pci/hotplug/acpiphp_glue.c"], "methods": ["acpiphp_native_scan_bridge", "enable_slot"]}
{"id": "203475", "title": "Samsung 860 EVO queued TRIM issues", "description": "Created attachment 282579 [details]\ndmesg of the errors occuring\n\nI have a Samsung SSD 860 EVO mSATA 500GB SSD connected via an ASMedia ASM1062 Serial ATA Controller. It causes has 20-30 seconds lockups on fstrim (which runs during bootup on my system), with messages such as:\n\n[  332.792044] ata14.00: exception Emask 0x0 SAct 0x3fffe SErr 0x0 action 0x6 frozen\n[  332.798271] ata14.00: failed command: SEND FPDMA QUEUED\n[  332.804499] ata14.00: cmd 64/01:08:00:00:00/00:00:00:00:00/a0 tag 1 ncq dma 512 out\n                        res 40/00:00:00:00:00/00:00:00:00:00/00 Emask 0x4 (timeout)\n[  332.817145] ata14.00: status: { DRDY }\n\nAfter disabling queued TRIM via the included patch, the issue disappears.", "patch": ["$ diff -u a/drivers/ata/libata-core.c b/drivers/ata/libata-core.c\n--- a/drivers/ata/libata-core.c\t2019-05-01 13:55:02.646011817 +0500\n+++ b/drivers/ata/libata-core.c\t2019-05-01 13:55:57.290012703 +0500\n@@ -4563,6 +4563,8 @@\n \t\t\t\t\t\tATA_HORKAGE_ZERO_AFTER_TRIM, },\n \t{ \"Samsung SSD 850*\",\t\tNULL,\tATA_HORKAGE_NO_NCQ_TRIM |\n \t\t\t\t\t\tATA_HORKAGE_ZERO_AFTER_TRIM, },\n+\t{ \"Samsung SSD 860*\",\t\tNULL,\tATA_HORKAGE_NO_NCQ_TRIM |\n+\t\t\t\t\t\tATA_HORKAGE_ZERO_AFTER_TRIM, },\n \t{ \"FCCT*M500*\",\t\t\tNULL,\tATA_HORKAGE_NO_NCQ_TRIM |\n \t\t\t\t\t\tATA_HORKAGE_ZERO_AFTER_TRIM, },\n \n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "IO/Storage", "Classification": "Unclassified", "Component": "Serial ATA", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Tejun Heo", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2019-05-01 22:00 UTC by Roman Mamedov", "Modified": "2023-10-06 12:46 UTC", "CC List": "26 users", "See Also": "", "Kernel Version": "4.14.114", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/ata/libata-core.c"], "methods": ["ata_device_blacklist"]}
{"id": "203369", "title": "A4Tech mouse: horizontal scrolling is recognized as vertical since kernel 5.0", "description": "I have an A4Tech WOP-49Z mouse, which has two wheels - one for vertical and one for horizontal scrolling. It has worked perfectly well with many Linux kernel versions since 2011. With the latest stable kernel version 5.0, however, the horizontal wheel acts as an inverted vertical wheel.\n\nxev reports both vertical and horizontal wheel scrolling as buttons 4/5 with kernel versions 5.0.5, 5.0.7. With kernel versions 4.19.32, 4.19.34 and 4.20.17, xev reports vertical wheel scrolling as buttons 4/5 and horizontal wheel scrolling as buttons 6/7.\n\nI'm testing different kernel versions in the same system with the same other package versions. I'm rebooting and switching between different installed kernel versions provided by Manjaro Linux distribution.\n\nCould this bug be caused by a mistake in the implementation of the new feature in kernel 5.0 - \"Logitech High Resolution Scrolling support\"?", "patch": ["diff --git a/drivers/hid/hid-a4tech.c b/drivers/hid/hid-a4tech.c\nindex 9428ea7cdf8a..fafb9fa558e7 100644\n--- a/drivers/hid/hid-a4tech.c\n+++ b/drivers/hid/hid-a4tech.c\n@@ -38,7 +38,7 @@ static int a4_input_mapped(struct hid_device *hdev, struct hid_input *hi,\n {\n \tstruct a4tech_sc *a4 = hid_get_drvdata(hdev);\n \n-\tif (usage->type == EV_REL && usage->code == REL_WHEEL)\n+\tif (usage->type == EV_REL && usage->code == REL_WHEEL_HI_RES)\n \t\tset_bit(REL_HWHEEL, *bit);\n \n \tif ((a4->quirks & A4_2WHEEL_MOUSE_HACK_7) && usage->hid == 0x00090007)\n@@ -60,7 +60,7 @@ static int a4_event(struct hid_device *hdev, struct hid_field *field,\n \tinput = field->hidinput->input;\n \n \tif (a4->quirks & A4_2WHEEL_MOUSE_HACK_B8) {\n-\t\tif (usage->type == EV_REL && usage->code == REL_WHEEL) {\n+\t\tif (usage->type == EV_REL && usage->code == REL_WHEEL_HI_RES) {\n \t\t\ta4->delayed_value = value;\n \t\t\treturn 1;\n \t\t}\n@@ -77,7 +77,7 @@ static int a4_event(struct hid_device *hdev, struct hid_field *field,\n \t\treturn 1;\n \t}\n \n-\tif (usage->code == REL_WHEEL && a4->hw_wheel) {\n+\tif (usage->code == REL_WHEEL_HI_RES && a4->hw_wheel) {\n \t\tinput_event(input, usage->type, REL_HWHEEL, value);\n \t\treturn 1;\n \t}\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Input Devices", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "drivers_input-devices", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2019-04-21 11:24 UTC by Igor Kushnir", "Modified": "2019-10-15 10:16 UTC", "CC List": "4 users", "See Also": "", "Kernel Version": "5.0", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/hid/hid-a4tech.c"], "methods": ["a4_input_mapped", "a4_event"]}
{"id": "200989", "title": "ACPI / LPSS Braswell Lenovo 11e won't boot as of LPSS commit in 4.17.12 (with patch)", "description": "Created attachment 278225 [details]\n[PATCH] ACPI / LPSS: Ensure LPIOEP is always set on resume\n\nHi there.\n\nI've got a 3rd generation Lenovo 11e that locks up on boot. The processor inside is an Intel N3150, which is family 6, model 0x4c, which is one that turns on lpss_quirks. I was able to bisect the problem commit to the merge of 12864ff8545f6b8144fdf1bb89b5663357f29ec4 which skipped over some IOSF updates when exiting D3 that wasn't matched by a call to the handler for entering D3.  \n\nWhat I've been able to see is that on boot, the acpi_lpss_resume() function gets called, but the acpi_lpss_suspend() hasn't.  Because of this, the IOSF write to LPSS_IOSF_UNIT_LPIOEP never happens, and for some reason that freezes the computer.  I've got a minimal patch that allows my system to boot normally by ensuring that write happens whether the matching acpi_lpss_suspend() call takes place or not.\n\nI don't have any other relevant systems to test this patch on so I can't say whether it introduces any regressions, nor do I have a very good handle on why this freezes the boot in the first place.  I'm happy to discuss in whatever way I can.", "patch": ["From 27fda1ab0d800966b0ec1c444fe356812bd2f04e Mon Sep 17 00:00:00 2001\nFrom: Zhang Rui <rui.zhang@intel.com>\nDate: Mon, 3 Sep 2018 10:00:07 +0800\nSubject: [PATCH] ACPI / LPSS: Force lpss quirks on boot\n\nCommit 12864ff8545f (\"ACPI / LPSS: Avoid PM quirks on suspend and resume\nfrom hibernation\") bypasses lpss quirks for S3 and S4, by setting a flag\nfor S3/S4 in acpi_lpss_suspend(), and check that flag in\nacpi_lpss_resume().\n\nBut this overlooks the boot case where acpi_lpss_resume() may get called\nwithout a corresponding acpi_lpss_suspend() having been called.\n\nThus force setting the flag during boot.\n\nFixes: 12864ff8545f (ACPI / LPSS: Avoid PM quirks on suspend and resume from hibernation)\nLink: https://bugzilla.kernel.org/show_bug.cgi?id=200989\nSigned-off-by: Zhang Rui <rui.zhang@intel.com>\n---\n drivers/acpi/acpi_lpss.c | 2 +-\n 1 file changed, 1 insertion(+), 1 deletion(-)\n\ndiff --git a/drivers/acpi/acpi_lpss.c b/drivers/acpi/acpi_lpss.c\nindex 9706613..bf64cfa 100644\n--- a/drivers/acpi/acpi_lpss.c\n+++ b/drivers/acpi/acpi_lpss.c\n@@ -879,7 +879,7 @@ static void acpi_lpss_dismiss(struct device *dev)\n #define LPSS_GPIODEF0_DMA_LLP\t\tBIT(13)\n \n static DEFINE_MUTEX(lpss_iosf_mutex);\n-static bool lpss_iosf_d3_entered;\n+static bool lpss_iosf_d3_entered = true;\n \n static void lpss_iosf_enter_d3_state(void)\n {\n-- \n2.7.4\n\n", "From 7eee88ef4e4b918217f0e8c58c6a6d035e970f44 Mon Sep 17 00:00:00 2001\nFrom: Zhang Rui <rui.zhang@intel.com>\nDate: Mon, 10 Sep 2018 11:48:54 +0800\nSubject: [PATCH] 200989\n\nSigned-off-by: Zhang Rui <rui.zhang@intel.com>\n---\n drivers/acpi/acpi_lpss.c | 2 ++\n 1 file changed, 2 insertions(+)\n\ndiff --git a/drivers/acpi/acpi_lpss.c b/drivers/acpi/acpi_lpss.c\nindex bf64cfa..776424f 100644\n--- a/drivers/acpi/acpi_lpss.c\n+++ b/drivers/acpi/acpi_lpss.c\n@@ -901,6 +901,8 @@ static void lpss_iosf_enter_d3_state(void)\n \n \tmutex_lock(&lpss_iosf_mutex);\n \n+\tlpss_iosf_d3_entered = false;\n+\n \tret = pmc_atom_read(PMC_D3_STS_0, &d3_sts_0);\n \tif (ret)\n \t\tgoto exit;\n-- \n2.7.4\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "Power-Other", "Hardware": "Intel Linux", "Importance": "P1 normal", "Assignee": "Zhang Rui", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2018-09-01 07:45 UTC by William Lieurance", "Modified": "2018-09-14 05:02 UTC", "CC List": "4 users", "See Also": "", "Kernel Version": "4.17.12", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/acpi/acpi_lpss.c"], "methods": ["acpi_lpss_dismiss"]}
{"id": "199971", "title": "iwlwifi: 3165: TFD queue hang", "description": "Created attachment 276377 [details]\ndebug info encrypted for Emmanuel Grumbach, Johannes Berg and Luciano Coelho\n\nDell Vostro 5468 laptop with Intel Corporation Wireless 3165 (rev 79) on board. Firmware crash tested on Ubuntu 18.04, Arch Linux and openSUSE Leap 15.0. Arch running latest kernel available: 4.16.13-2-ARCH and linux-firmware 20180518.2a9b2cf-1 dated 19 May 2018. All debug info (with .dump) included in the archive. Information was gathered from openSUSE (kernel: 4.12.14-lp150.12.4-default and firmware version 29.1044073957.0) just because it happened to be the last distro I tested.\n\nThe crash happens when I try to transfer files over SFTP from laptop to smartphone. Files are 200-300 MB in size, sometimes bigger. Download starts slowly at 600 KB/s and goes to 1.7 MB/s max. The crash occurs around half way through the file. If firmware crashes a couple of times download speed degrades to 800 KB/s max. I'm not sure if firmware crashes during \"regular\" internet surfing and/or if other network protocol is used (nfs).\n\nHow to crash:\nstart sshd service\nmonitor with journalctl: journalctl -b -p err -f\nconnect and start downloading files.\n\nP.S. I remember it working flawlessly on Arch, using linux-lts with 4.9 kernel and firmware version 22.391740.0. I probably could find dmesg related to that kernel and firmware if needed. Also, I tried to use firmware version 22.391740.0 on non-lts 4.14.11-1-ARCH at that time and it crashed.", "patch": ["diff --git a/drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c b/drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c\nindex 73233eca9..1768c2a7f 100644\n--- a/drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c\n+++ b/drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c\n@@ -820,7 +820,7 @@ int iwl_mvm_mac_setup_register(struct iwl_mvm *mvm)\n \t\treturn ret;\n \n \tif (fw_has_capa(&mvm->fw->ucode_capa,\n-\t\t\tIWL_UCODE_TLV_CAPA_TDLS_SUPPORT)) {\n+\t\t\tIWL_UCODE_TLV_CAPA_TDLS_SUPPORT) && false) {\n \t\tIWL_DEBUG_TDLS(mvm, \"TDLS supported\\n\");\n \t\thw->wiphy->flags |= WIPHY_FLAG_SUPPORTS_TDLS;\n \t\tieee80211_hw_set(hw, TDLS_WIDER_BW);\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "network-wireless", "Hardware": "x86-64 Linux", "Importance": "P1 high", "Assignee": "DO NOT USE - assign \"network-wireless-intel\" component instead", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2018-06-07 22:35 UTC by 4regallshit", "Modified": "2018-12-03 22:19 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "4.12.14", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c"], "methods": ["iwl_mvm_mac_setup_register"]}
{"id": "198351", "title": "iwlwifi: 9260: very slow WAN-LAN transfers at 5Ghz", "description": "Created attachment 273399 [details]\ndmesg output\n\nI recently updated my 8260 card to 9260 in laptop.\n\nAfter that download speed from my nas connected over ethernet to router dropped significantly at 5Gz.\nWas around 40MB/s with 8260. Dropped to 4MB/s with 9260.\n\nDownload speeds from internet(google drive) fully saturate my internet channel. eg. ~15MB/s. \nSo it looks like issue exists only for local wan-lan connections.\n\nAlso download speeds at 2.4Ghz is around 10MB/b which is also faster than 5Ghz one.\n\nI'm using most recent firmware-version: 34.0.0\nand most recent kernel 4.15-rc6. (got the same behavior though on 4.14.10)", "patch": ["From f35978844e2eea1b2a6d4a2a6445d66528fc7a06 Mon Sep 17 00:00:00 2001\nFrom: Sara Sharon <sara.sharon@intel.com>\nDate: Tue, 29 Mar 2016 10:56:57 +0300\nSubject: [PATCH] iwlwifi: mvm: fix security bug in PN checking\n\nA previous patch allowed the same PN for packets originating from the\nsame AMSDU by copying PN only for the last packet in the series.\n\nThis however is bogus since we cannot assume the last frame will be\nreceived on the same queue, and if it is received on a different ueue\nwe will end up not incrementing the PN and possibly let the next\npacket to have the same PN and pass through.\n\nChange the logic instead to driver explicitly indicate for the second\nsub frame and on to be allowed to have the same PN as the first\nsubframe. Indicate it to mac80211 as well for the fallback queue.\n\nFixes: f1ae02b186d9 (\"iwlwifi: mvm: allow same PN for de-aggregated AMSDU\")\nSigned-off-by: Sara Sharon <sara.sharon@intel.com>\nSigned-off-by: Luca Coelho <luciano.coelho@intel.com>\n---\n drivers/net/wireless/intel/iwlwifi/mvm/rxmq.c | 39 ++++++++++++++-------------\n 1 file changed, 20 insertions(+), 19 deletions(-)\n\ndiff --git a/drivers/net/wireless/intel/iwlwifi/mvm/rxmq.c b/drivers/net/wireless/intel/iwlwifi/mvm/rxmq.c\nindex 71d6660c48e1..4a4ccfd11e5b 100644\n--- a/drivers/net/wireless/intel/iwlwifi/mvm/rxmq.c\n+++ b/drivers/net/wireless/intel/iwlwifi/mvm/rxmq.c\n@@ -71,6 +71,7 @@ static inline int iwl_mvm_check_pn(struct iwl_mvm *mvm, struct sk_buff *skb,\n \tstruct ieee80211_hdr *hdr = (struct ieee80211_hdr *)skb->data;\n \tstruct ieee80211_rx_status *stats = IEEE80211_SKB_RXCB(skb);\n \tstruct iwl_mvm_key_pn *ptk_pn;\n+\tint res;\n \tu8 tid, keyidx;\n \tu8 pn[IEEE80211_CCMP_PN_LEN];\n \tu8 *extiv;\n@@ -127,12 +128,13 @@ static inline int iwl_mvm_check_pn(struct iwl_mvm *mvm, struct sk_buff *skb,\n \tpn[4] = extiv[1];\n \tpn[5] = extiv[0];\n \n-\tif (memcmp(pn, ptk_pn->q[queue].pn[tid],\n-\t\t   IEEE80211_CCMP_PN_LEN) <= 0)\n+\tres = memcmp(pn, ptk_pn->q[queue].pn[tid], IEEE80211_CCMP_PN_LEN);\n+\tif (res < 0)\n+\t\treturn -1;\n+\tif (!res && !(stats->flag & RX_FLAG_ALLOW_SAME_PN))\n \t\treturn -1;\n \n-\tif (!(stats->flag & RX_FLAG_AMSDU_MORE))\n-\t\tmemcpy(ptk_pn->q[queue].pn[tid], pn, IEEE80211_CCMP_PN_LEN);\n+\tmemcpy(ptk_pn->q[queue].pn[tid], pn, IEEE80211_CCMP_PN_LEN);\n \tstats->flag |= RX_FLAG_PN_VALIDATED;\n \n \treturn 0;\n@@ -314,28 +316,21 @@ static void iwl_mvm_rx_csum(struct ieee80211_sta *sta,\n }\n \n /*\n- * returns true if a packet outside BA session is a duplicate and\n- * should be dropped\n+ * returns true if a packet is a duplicate and should be dropped.\n+ * Updates AMSDU PN tracking info\n  */\n-static bool iwl_mvm_is_nonagg_dup(struct ieee80211_sta *sta, int queue,\n-\t\t\t\t  struct ieee80211_rx_status *rx_status,\n-\t\t\t\t  struct ieee80211_hdr *hdr,\n-\t\t\t\t  struct iwl_rx_mpdu_desc *desc)\n+static bool iwl_mvm_is_dup(struct ieee80211_sta *sta, int queue,\n+\t\t\t   struct ieee80211_rx_status *rx_status,\n+\t\t\t   struct ieee80211_hdr *hdr,\n+\t\t\t   struct iwl_rx_mpdu_desc *desc)\n {\n \tstruct iwl_mvm_sta *mvm_sta;\n \tstruct iwl_mvm_rxq_dup_data *dup_data;\n-\tu8 baid, tid, sub_frame_idx;\n+\tu8 tid, sub_frame_idx;\n \n \tif (WARN_ON(IS_ERR_OR_NULL(sta)))\n \t\treturn false;\n \n-\tbaid = (le32_to_cpu(desc->reorder_data) &\n-\t\tIWL_RX_MPDU_REORDER_BAID_MASK) >>\n-\t\tIWL_RX_MPDU_REORDER_BAID_SHIFT;\n-\n-\tif (baid != IWL_RX_REORDER_DATA_INVALID_BAID)\n-\t\treturn false;\n-\n \tmvm_sta = iwl_mvm_sta_from_mac80211(sta);\n \tdup_data = &mvm_sta->dup_data[queue];\n \n@@ -365,6 +360,12 @@ static bool iwl_mvm_is_nonagg_dup(struct ieee80211_sta *sta, int queue,\n \t\t     dup_data->last_sub_frame[tid] >= sub_frame_idx))\n \t\treturn true;\n \n+\t/* Allow same PN as the first subframe for following sub frames */\n+\tif (dup_data->last_seq[tid] == hdr->seq_ctrl &&\n+\t    sub_frame_idx > dup_data->last_sub_frame[tid] &&\n+\t    desc->mac_flags2 & IWL_RX_MPDU_MFLG2_AMSDU)\n+\t\trx_status->flag |= RX_FLAG_ALLOW_SAME_PN;\n+\n \tdup_data->last_seq[tid] = hdr->seq_ctrl;\n \tdup_data->last_sub_frame[tid] = sub_frame_idx;\n \n@@ -981,7 +982,7 @@ void iwl_mvm_rx_mpdu_mq(struct iwl_mvm *mvm, struct napi_struct *napi,\n \t\tif (ieee80211_is_data(hdr->frame_control))\n \t\t\tiwl_mvm_rx_csum(sta, skb, desc);\n \n-\t\tif (iwl_mvm_is_nonagg_dup(sta, queue, rx_status, hdr, desc)) {\n+\t\tif (iwl_mvm_is_dup(sta, queue, rx_status, hdr, desc)) {\n \t\t\tkfree_skb(skb);\n \t\t\tgoto out;\n \t\t}\n-- \n2.15.1\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "network-wireless", "Hardware": "Intel Linux", "Importance": "P1 high", "Assignee": "DO NOT USE - assign \"network-wireless-intel\" component instead", "URL": "", "Keywords": "", "Duplicates (1)": "198417", "Depends on": "", "Blocks": "", "Reported": "2018-01-04 12:00 UTC by sergeidanilov", "Modified": "2018-03-07 07:44 UTC", "CC List": "7 users", "See Also": "", "Kernel Version": "4.15-rc6", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/net/wireless/intel/iwlwifi/mvm/rxmq.c"], "methods": ["iwl_mvm_check_pn", "iwl_mvm_rx_csum", "iwl_mvm_is_nonagg_dup", "iwl_mvm_rx_mpdu_mq"]}
{"id": "196743", "title": "iwlwifi: adding too many link-layer multicast addresses produces a warning - WIFILNX-1329", "description": "Adding a multicast address to a device that has at least 50 of them already present produces a warning.\nThe addresses were added using the script below:\n\n#!/bin/bash\nfor i in {0..255}\ndo\n\thex=$(printf '%02x' $i)\n\tip maddress add 33:33:ff:00:00:$hex dev wlp4s0\ndone\n\n\nCommand MCAST_FILTER_CMD (0x1d0) is too large (328 bytes)\n------------[ cut here ]------------\nWARNING: CPU: 0 PID: 3839 at drivers/net/wireless/intel/iwlwifi/pcie/tx.c:1526 iwl_pcie_enqueue_hcmd+0x8d8/0xb00 [iwlwifi]\nModules linked in: nfnetlink_queue nfnetlink_log nfnetlink bluetooth ecdh_generic fuse ctr ccm nf_conntrack_ipv6 nf_defrag_ipv6 nf_conntrack_ipv4 nf_defrag_ipv4 xt_conntrack nf_conntrack libcrc32c crc32c_generic ip6table_filter iptable_filter ip6_tables nls_iso8859_1 nls_cp437 msr vfat fat intel_rapl x86_pkg_temp_ther\n thermal wmi led_class tpm battery ac mac_hid sch_fq_codel sg ip_tables x_tables ext4 crc16 jbd2 fscrypto mbcache dm_crypt algif_skcipher af_alg dm_mod dax sr_mod cdrom sd_mod crct10dif_pclmul crc32_pclmul crc32c_intel ghash_clmulni_intel pcbc rtsx_pci_sdmmc mmc_core serio_raw atkbd libps2 ahci libahci aesni_intel aes\nCPU: 0 PID: 3839 Comm: kworker/u16:1 Not tainted 4.12.8-2-ARCH #1\nHardware name: LENOVO 20DF004PMC/20DF004PMC, BIOS J5ET57WW (1.28 ) 06/01/2017\nWorkqueue: phy0 ieee80211_reconfig_filter [mac80211]\ntask: ffff8bc15f76d580 task.stack: ffffb5ac03b8c000\nRIP: 0010:iwl_pcie_enqueue_hcmd+0x8d8/0xb00 [iwlwifi]\nRSP: 0018:ffffb5ac03b8fb38 EFLAGS: 00010282\nRAX: 0000000000000039 RBX: 00000000000001d0 RCX: 0000000000000000\nRDX: 0000000000000000 RSI: ffff8bc25ec0dcc8 RDI: ffff8bc25ec0dcc8\nRBP: ffffb5ac03b8fbd8 R08: 000000000000032d R09: 0000000000000004\nR10: 0000000000000008 R11: 0000000000000001 R12: ffff8bc258200018\nR13: ffff8bc24e6cc000 R14: 0000000000000001 R15: 0000000000000148\nFS:  0000000000000000(0000) GS:ffff8bc25ec00000(0000) knlGS:0000000000000000\nCS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033\nCR2: 00007f977f26fd40 CR3: 0000000062a09000 CR4: 00000000003406f0\nCall Trace:\n ? enqueue_task_fair+0xb6/0x6d0\n iwl_trans_pcie_send_hcmd+0x166/0x500 [iwlwifi]\n ? try_to_wake_up+0x59/0x440\n iwl_trans_send_cmd+0x55/0xa0 [iwlwifi]\n ? default_wake_function+0x12/0x20\n iwl_mvm_send_cmd+0x29/0x80 [iwlmvm]\n ? iwl_mvm_update_mu_groups+0x80/0x80 [iwlmvm]\n iwl_mvm_send_cmd_pdu+0x58/0x80 [iwlmvm]\n iwl_mvm_mc_iface_iterator+0x6b/0x90 [iwlmvm]\n ? iwl_mvm_mc_iface_iterator+0x6b/0x90 [iwlmvm]\n __iterate_interfaces+0x78/0x110 [mac80211]\n ? iwl_mvm_update_mu_groups+0x80/0x80 [iwlmvm]\n ieee80211_iterate_active_interfaces_atomic+0x33/0x50 [mac80211]\n iwl_mvm_recalc_multicast+0x48/0x70 [iwlmvm]\n iwl_mvm_configure_filter+0x4c/0x70 [iwlmvm]\n ieee80211_configure_filter+0x140/0x340 [mac80211]\n ieee80211_reconfig_filter+0x15/0x20 [mac80211]\n process_one_work+0x1de/0x430\n worker_thread+0x47/0x3f0\n kthread+0x125/0x140\n ? process_one_work+0x430/0x430\n ? kthread_create_on_node+0x70/0x70\n ret_from_fork+0x25/0x30\nCode: ed fc ff ff 8b 5b 28 4c 89 e7 89 4d b0 89 de e8 2f c5 00 00 8b 4d b0 89 da 48 89 c6 48 c7 c7 78 78 8f c0 0f b7 c9 e8 ab de 8a f7 <0f> ff c7 45 b0 ea ff ff ff e9 81 f8 ff ff 4d 89 f4 48 8b b5 68 \n---[ end trace 5ff5af742e33689f ]---\niwlwifi 0000:04:00.0: Error sending MCAST_FILTER_CMD: enqueue_hcmd failed: -22\niwlwifi 0000:04:00.0: mcast filter cmd error. ret=-22\n\n\n\nEach additional address added produces a warning:\n\nCommand MCAST_FILTER_CMD (0x1d0) is too large (332 bytes)\n[...]\nCommand MCAST_FILTER_CMD (0x1d0) is too large (340 bytes)\n[...]\nCommand MCAST_FILTER_CMD (0x1d0) is too large (344 bytes)\n[...]\nCommand MCAST_FILTER_CMD (0x1d0) is too large (352 bytes)\n[...]\n\n\n\ndevice info:\nIntel(R) Dual Band Wireless AC 3160, REV=0x164\n\ndriver: iwlwifi\nversion: 4.12.8-2-ARCH\nfirmware-version: 17.459231.0\nexpansion-rom-version: \nbus-info: 0000:04:00.0\nsupports-statistics: yes\nsupports-test: no\nsupports-eeprom-access: no\nsupports-register-dump: no\nsupports-priv-flags: no", "patch": ["From d9d00ee49a82e2deac818729c019bb21f6f675c1 Mon Sep 17 00:00:00 2001\nFrom: Luca Coelho <luciano.coelho@intel.com>\nDate: Fri, 1 Sep 2017 17:59:15 +0300\nSubject: [PATCH] iwlwifi: mvm: use IWL_HCMD_NOCOPY for MCAST_FILTER_CMD\n\nThe MCAST_FILTER_CMD can get quite large when we have many mcast\naddresses to set (we support up to 255).  So the command should be\nsend as NOCOPY to prevent a warning caused by too-long commands:\n\nWARNING: CPU: 0 PID: 9700 at /root/iwlwifi/stack-dev/drivers/net/wireless/intel/iwlwifi/pcie/tx.c:1550 iwl_pcie_enqueue_hcmd+0x8c7/0xb40 [iwlwifi]\nCommand MCAST_FILTER_CMD (0x1d0) is too large (328 bytes)\n\nThis fixes: https://bugzilla.kernel.org/show_bug.cgi?id=196743\n\nReported-by: regwz@seznam.cz\nCc: stable@vger.kernel.org\nSigned-off-by: Luca Coelho <luciano.coelho@intel.com>\n---\n drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c | 10 +++++++++-\n 1 file changed, 9 insertions(+), 1 deletion(-)\n\ndiff --git a/drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c b/drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c\nindex 15f2d826bb4b..36ffabdd3820 100644\n--- a/drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c\n+++ b/drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c\n@@ -1546,6 +1546,11 @@ static void iwl_mvm_mc_iface_iterator(void *_data, u8 *mac,\n \tstruct iwl_mvm_mc_iter_data *data = _data;\n \tstruct iwl_mvm *mvm = data->mvm;\n \tstruct iwl_mcast_filter_cmd *cmd = mvm->mcast_filter_cmd;\n+\tstruct iwl_host_cmd hcmd = {\n+\t\t.id = MCAST_FILTER_CMD,\n+\t\t.flags = CMD_ASYNC,\n+\t\t.dataflags[0] = IWL_HCMD_DFL_NOCOPY,\n+\t};\n \tint ret, len;\n \n \t/* if we don't have free ports, mcast frames will be dropped */\n@@ -1560,7 +1565,10 @@ static void iwl_mvm_mc_iface_iterator(void *_data, u8 *mac,\n \tmemcpy(cmd->bssid, vif->bss_conf.bssid, ETH_ALEN);\n \tlen = roundup(sizeof(*cmd) + cmd->count * ETH_ALEN, 4);\n \n-\tret = iwl_mvm_send_cmd_pdu(mvm, MCAST_FILTER_CMD, CMD_ASYNC, len, cmd);\n+\thcmd.len[0] = len;\n+\thcmd.data[0] = cmd;\n+\n+\tret = iwl_mvm_send_cmd(mvm, &hcmd);\n \tif (ret)\n \t\tIWL_ERR(mvm, \"mcast filter cmd error. ret=%d\\n\", ret);\n }\n-- \n2.14.1\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "network-wireless", "Hardware": "x86-64 Linux", "Importance": "P1 low", "Assignee": "DO NOT USE - assign \"network-wireless-intel\" component instead", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2017-08-23 14:47 UTC by regwz", "Modified": "2017-09-04 13:19 UTC", "CC List": "1 user", "See Also": "", "Kernel Version": "4.12.8", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c"], "methods": ["iwl_mvm_mc_iface_iterator"]}
{"id": "196741", "title": "iwlwifi: unsolicited multicast traffic still dropped when adapter set to allmulti - WIFILNX-1330", "description": "Only frames with link-layer address that is on the list shown by `ip -0 maddress show dev wlp4s0` are received.\nThe wireless device is set to ALLMULTI mode by: `ip link set dev wlp4s0 allmulticast on`\n\nSteps to reproduce:\n1. connect a wireless client to a wireless AP\n2. open Wireshark on the client to monitor icmpv6 traffic\n3. execute on the client: `ip link set dev wlp4s0 allmulticast on`\n4. execute on the AP: ping ff02::1 ... RECEIVED by the client (the link-layer address 33:33:00:00:00:01 is on the list)\n5. execute on the AP: ping ff02::1:ffab:cdef ...  NOT RECEIVED by the client (the link-layer address 33:33:ff:ab:cd:ef is not on the list)\n6. apply workaround\n7. go to step 5; the packets are now received by the client\n\nExpected result:\nThe client should receive packets from ff02::1:ffab:cdef because, even though the address is not in the multicast address list, the adapter is in ALLMULTI mode.\n\n\n\nThe workaround for me was to add more than MAX_MCAST_FILTERING_ADDRESSES (256) using the script below (assuming there is at least one multicast address already present):\n\n#!/bin/bash\nfor i in {0..255}\ndo\n\thex=$(printf '%02x' $i)\n\tip maddress add 33:33:ff:00:00:$hex dev wlp4s0\ndone\n\n\nThe use case for this feature is a IPv6 neighbor discovery proxy using ndppd (NDP Proxy Daemon).\n\n\ndevice info:\nIntel(R) Dual Band Wireless AC 3160, REV=0x164\n\ndriver: iwlwifi\nversion: 4.12.8-2-ARCH\nfirmware-version: 17.459231.0\nexpansion-rom-version: \nbus-info: 0000:04:00.0\nsupports-statistics: yes\nsupports-test: no\nsupports-eeprom-access: no\nsupports-register-dump: no\nsupports-priv-flags: no", "patch": ["From 7322fc6784fa77348c9cd9c46169497533efc6a5 Mon Sep 17 00:00:00 2001\nFrom: Luca Coelho <luciano.coelho@intel.com>\nDate: Fri, 1 Sep 2017 18:57:35 +0300\nSubject: [PATCH] iwlwifi: mvm: handle FIF_ALLMULTI when setting multicast\n addresses\n\nWe were ignoring the FIF_ALLMULTI flag when setting the multicast\naddresses with MCAST_FILTER_CMD.  Check if this flag is set and enable\npass_all accordingly.  We also need to set the count to 0 if pass_all\nis enable so we don't pass addresses to the firmware when not needed\n(as doing so causes an assert).\n\nThis fixes https://bugzilla.kernel.org/show_bug.cgi?id=196741\n\nReported-by: regwz@seznam.cz\nSigned-off-by: Luca Coelho <luciano.coelho@intel.com>\n---\n drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c | 6 ++++++\n 1 file changed, 6 insertions(+)\n\ndiff --git a/drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c b/drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c\nindex 36ffabdd3820..6399e6fcf830 100644\n--- a/drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c\n+++ b/drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c\n@@ -1643,6 +1643,12 @@ static void iwl_mvm_configure_filter(struct ieee80211_hw *hw,\n \tif (!cmd)\n \t\tgoto out;\n \n+\tif (changed_flags & FIF_ALLMULTI)\n+\t\tcmd->pass_all = !!(*total_flags & FIF_ALLMULTI);\n+\n+\tif (cmd->pass_all)\n+\t\tcmd->count = 0;\n+\n \tiwl_mvm_recalc_multicast(mvm);\n out:\n \tmutex_unlock(&mvm->mutex);\n-- \n2.14.1\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "network-wireless", "Hardware": "x86-64 Linux", "Importance": "P1 normal", "Assignee": "DO NOT USE - assign \"network-wireless-intel\" component instead", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2017-08-23 14:45 UTC by regwz", "Modified": "2017-09-04 13:24 UTC", "CC List": "1 user", "See Also": "", "Kernel Version": "4.12.8", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c"], "methods": ["iwl_mvm_configure_filter"]}
{"id": "196375", "title": "MTX load commands fail", "description": "After upgrading to 4.12rc0 (also tested on all RC's 4.12, and 4.13 git), the following mtx commands fail on an ML6000 with LTO5 FC drive attached to a qlogic 2462 HBA.  Running Ubuntu Server 16.04\n\nmtx -f /dev/sg19 load 16 0\nLoading media from Storage Element 16 into drive 0...mtx: Request Sense: Long Report=yes\nmtx: Request Sense: Valid Residual=no\nmtx: Request Sense: Error Code=0 (Unknown?!)\nmtx: Request Sense: Sense Key=No Sense\nmtx: Request Sense: FileMark=no\nmtx: Request Sense: EOM=no\nmtx: Request Sense: ILI=no\nmtx: Request Sense: Additional Sense Code = 00\nmtx: Request Sense: Additional Sense Qualifier = 00\nmtx: Request Sense: BPV=no\nmtx: Request Sense: Error in CDB=no\nmtx: Request Sense: SKSV=no\nMOVE MEDIUM from Element Address 4111 to 256 Failed\n\nDowngrading to 4.11.10 resolves the issue.  The issue (and fix) has been replicated on a server running Fedora with an NEOs T48 with an LTO6 SAS drive attached to LSI 3008.  Commit hash from latest version that works is - v4.11-4395-g89c9fea\n\nSorry if anything here is formatted wrong, first bug report.", "patch": ["From: Johannes Thumshirn <jthumshirn@suse.de>\nSubject: [PATCH] scsi: sg: only check for dxfer_len greater than 256M\nTo: \"Martin K . Petersen\" <martin.petersen@oracle.com>\nCc: Jason L Tibbitts III <tibbs@math.uh.edu>,\n\tDoug Gilbert <dgilbert@interlog.com>,\n\tLinux Kernel Mailinglist <linux-kernel@vger.kernel.org>,\n\tLinux SCSI Mailinglist <linux-scsi@vger.kernel.org>,\n\tHannes Reinecke <hare@suse.de>,\n\tJohannes Thumshirn <jthumshirn@suse.de>,\n\tstable@vger.kernel.org\nDate: Thu, 27 Jul 2017 09:11:26 +0200 (5 hours, 42 minutes, 2 seconds ago)\n\nDon't make any assumptions on the sg_io_hdr_t::dxfer_direction or the\nsg_io_hdr_t::dxferp in order to determine if it is a valid request. The\nonly way we can check for bad requests is by checking if the length exceeds\n256M.\n\nSigned-off-by: Johannes Thumshirn <jthumshirn@suse.de>\nFixes: 28676d869bbb (scsi: sg: check for valid direction before starting the\nrequest)\nReported-by: Jason L Tibbitts III <tibbs@math.uh.edu>\nTested-by: Jason L Tibbitts III <tibbs@math.uh.edu>\nSuggested-by: Doug Gilbert <dgilbert@interlog.com>\nCc: Doug Gilbert <dgilbert@interlog.com>\nCc: <stable@vger.kernel.org>\n---\n drivers/scsi/sg.c | 31 +------------------------------\n 1 file changed, 1 insertion(+), 30 deletions(-)\n\ndiff --git a/drivers/scsi/sg.c b/drivers/scsi/sg.c\nindex 4fe606b000b4..d7ff71e0c85c 100644\n--- a/drivers/scsi/sg.c\n+++ b/drivers/scsi/sg.c\n@@ -751,35 +751,6 @@ sg_new_write(Sg_fd *sfp, struct file *file, const char __user *buf,\n \treturn count;\n }\n \n-static bool sg_is_valid_dxfer(sg_io_hdr_t *hp)\n-{\n-\tswitch (hp->dxfer_direction) {\n-\tcase SG_DXFER_NONE:\n-\t\tif (hp->dxferp || hp->dxfer_len > 0)\n-\t\t\treturn false;\n-\t\treturn true;\n-\tcase SG_DXFER_FROM_DEV:\n-\t\t/*\n-\t\t * for SG_DXFER_FROM_DEV we always set dxfer_len to > 0. dxferp\n-\t\t * can either be NULL or != NULL so there's no point in checking\n-\t\t * it either. So just return true.\n-\t\t */\n-\t\treturn true;\n-\tcase SG_DXFER_TO_DEV:\n-\tcase SG_DXFER_TO_FROM_DEV:\n-\t\tif (!hp->dxferp || hp->dxfer_len == 0)\n-\t\t\treturn false;\n-\t\treturn true;\n-\tcase SG_DXFER_UNKNOWN:\n-\t\tif ((!hp->dxferp && hp->dxfer_len) ||\n-\t\t    (hp->dxferp && hp->dxfer_len == 0))\n-\t\t\treturn false;\n-\t\treturn true;\n-\tdefault:\n-\t\treturn false;\n-\t}\n-}\n-\n static int\n sg_common_write(Sg_fd * sfp, Sg_request * srp,\n \t\tunsigned char *cmnd, int timeout, int blocking)\n@@ -800,7 +771,7 @@ sg_common_write(Sg_fd * sfp, Sg_request * srp,\n \t\t\t\"sg_common_write:  scsi opcode=0x%02x, cmd_size=%d\\n\",\n \t\t\t(int) cmnd[0], (int) hp->cmd_len));\n \n-\tif (!sg_is_valid_dxfer(hp))\n+\tif (hp->dxfer_len >= SZ_256M)\n \t\treturn -EINVAL;\n \n \tk = sg_start_req(srp, cmnd);\n-- \n2.12.3\n\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Tools", "Classification": "Unclassified", "Component": "Other", "Hardware": "Intel Linux", "Importance": "P1 high", "Assignee": "Tools.Other", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2017-07-14 23:22 UTC by evan", "Modified": "2018-06-27 20:22 UTC", "CC List": "3 users", "See Also": "", "Kernel Version": "4.12", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/scsi/sg.c"], "methods": ["sg_is_valid_dxfer", "sg_common_write"]}
{"id": "195869", "title": "Wireless ioctls fail if struct iwreq is at the end of a memory mapping", "description": "Created attachment 256697 [details]\ncomplete reduced testcase\n\nIf you do, say\n  struct iwreq* req = ...;\n  int ret = ioctl(sockfd, SIOCGIWNAME, req);\nthe ioctl will fail with EFAULT if req points to valid memory that is exactly sizeof(struct iwreq). Full testcase attached.\n\nThe problem is that dev_ioctl() does a copy_from_user(sizeof(struct ifreq)). On x86-64 that's 40 bytes, but sizeof(struct iwreq) is only 32 bytes.\n\nThis isn't a huge deal, but it does mean that user code that stores struct iwreq on the heap can randomly fail once in a blue moon, and that's bad.\n\nAlternatively it could be documented somewhere that user code should actually pass in a struct ifreq and cast it to struct iwreq for all usage, but that's horrible.", "patch": ["From cae58779548126d5c537197bfda068c835a9e0b1 Mon Sep 17 00:00:00 2001\nFrom: Johannes Berg <johannes.berg@intel.com>\nDate: Wed, 14 Jun 2017 09:28:11 +0200\nSubject: [PATCH] dev_ioctl: copy only the smaller struct iwreq for wext\n\nUnfortunately, struct iwreq isn't a proper subset of struct ifreq,\nbut is still handled by the same code path. Robert reported that\nthen applications may (randomly) fault if the struct iwreq they\npass happens to land within 8 bytes of the end of a mapping (the\nstruct is only 32 bytes, vs. struct ifreq's 40 bytes).\n\nTo fix this, pull out the code handling wireless extension ioctls\nand copy only the smaller structure in this case.\n\nThis bug goes back a long time, I tracked that it was introduced\ninto mainline in 2.1.15!\n\nReported-by: Robert O'Callahan <robert@ocallahan.org>\nSigned-off-by: Johannes Berg <johannes.berg@intel.com>\n---\n net/core/dev_ioctl.c | 22 +++++++++++++++++++---\n 1 file changed, 19 insertions(+), 3 deletions(-)\n\ndiff --git a/net/core/dev_ioctl.c b/net/core/dev_ioctl.c\nindex b94b1d293506..f7d0ed39b0d6 100644\n--- a/net/core/dev_ioctl.c\n+++ b/net/core/dev_ioctl.c\n@@ -410,6 +410,25 @@ int dev_ioctl(struct net *net, unsigned int cmd, void __user *arg)\n \tif (cmd == SIOCGIFNAME)\n \t\treturn dev_ifname(net, (struct ifreq __user *)arg);\n \n+\t/*\n+\t * Take care of Wireless Extensions. Unfortunately struct iwreq\n+\t * isn't a proper subset of struct ifreq (it's 8 byte shorter)\n+\t * so we need to treat it specially, otherwise applications may\n+\t * fault if the struct they're passing happens to land at the\n+\t * end of a mapped page.\n+\t */\n+\tif (cmd >= SIOCIWFIRST && cmd <= SIOCIWLAST) {\n+\t\tstruct iwreq iwr;\n+\n+\t\tif (copy_from_user(&iwr, arg, sizeof(iwr)))\n+\t\t\treturn -EFAULT;\n+\n+\t\t/* cast because it expects struct ifreq argument, but\n+\t\t * really only uses struct iwreq!\n+\t\t */\n+\t\treturn wext_handle_ioctl(net, (void *)&iwr, cmd, arg);\n+\t}\n+\n \tif (copy_from_user(&ifr, arg, sizeof(struct ifreq)))\n \t\treturn -EFAULT;\n \n@@ -559,9 +578,6 @@ int dev_ioctl(struct net *net, unsigned int cmd, void __user *arg)\n \t\t\t\tret = -EFAULT;\n \t\t\treturn ret;\n \t\t}\n-\t\t/* Take care of Wireless Extensions */\n-\t\tif (cmd >= SIOCIWFIRST && cmd <= SIOCIWLAST)\n-\t\t\treturn wext_handle_ioctl(net, &ifr, cmd, arg);\n \t\treturn -ENOTTY;\n \t}\n }\n-- \n2.11.0\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Networking", "Classification": "Unclassified", "Component": "Wireless", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Johannes Berg", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2017-05-24 02:21 UTC by Robert O'Callahan", "Modified": "2017-06-14 12:03 UTC", "CC List": "0 users", "See Also": "", "Kernel Version": "4.12-rc1", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["net/core/dev_ioctl.c"], "methods": ["dev_ioctl"]}
{"id": "195651", "title": "Boot EC - Asus BIOS contain broken DSDT EC but working ECDT EC", "description": "Created attachment 256185 [details]\nacpidump output\n\nThe Asus laptops X550VXK/FX502VD/FX502VE have a BIOS bug where the\nECDT (correctly) states that EC events trigger GPE 0x23, but the\nDSDT _GPE method (incorrectly) says GPE 0x33.\n\nA cursory glance of the code suggests that this should work regardless\n(because it looks like Linux would treat the ECDT and DSDT as two separate\nECs supported simultaneously), but in practice it is not working since the\nECDT is ultimately ignored in favour of the DSDT EC. The sequence of\nevents is:\n\n1. acpi_ec_ecdt_probe() is called in early boot, and calls\n   acpi_config_boot_ec(is_ecdt=true) for the ECDT EC.\n\nacpi_config_boot_ec() sets boot_ec to this new EC, and\nboot_ec_is_ecdt = true.\n\n2. Later, acpi_ec_dsdt_probe() is called and creates a new ec to represent\n   the DSDT EC. Then:\n    /*\n     * When the DSDT EC is available, always re-configure boot EC to\n     * have _REG evaluated. _REG can only be evaluated after the\n     * namespace initialization.\n     * At this point, the GPE is not fully initialized, so do not to\n     * handle the events.\n     */\n    ret = acpi_config_boot_ec(ec, ec->handle, false, false);\n\nSo the DSDT EC is passed to acpi_config_boot_ec() which does:\n    /* Unset old boot EC */\n    if (boot_ec != ec)\n        acpi_ec_free(boot_ec);\n\nacpi_ec_free() sets boot_ec to NULL.\nFurther down in acpi_config_boot_ec() we reach:\n\n    /* Set new boot EC */\n    if (!boot_ec) {\n        boot_ec = ec;\n        boot_ec_is_ecdt = is_ecdt;\n    }\n\nSo now boot_ec points to the DSDT EC and boot_ec_is_ecdt is false.\n\n3. Later, ecpi_ec_ecdt_start() is called and this looks like it would\n   enable GPEs on our ECDT, but it bails out because of:\n\n    if (!boot_ec_is_ecdt)\n        return -ENODEV;\n\n\nThe comment I pasted above from acpi_ec_dsdt_probe() says that it is going\nto reconfigure the boot EC, but it instead calls acpi_config_boot_ec() on\nthe newly probed DSDT EC. It seems like the code is not following the\ncomment here.\n\nAdjusting that code to work with boot_ec adjusts the sequence of events so\nthat both boot EC and DSDT are treated independently and as a result, we\nget EC interrupts firing correctly.\n\nThis fixes media keys on the mentioned laptop models.\nThanks to Chris Chiu for diagnosis.", "patch": ["From: Lv Zheng <lv.zheng@intel.com>\nSubject: [PATCH] ACPI / EC: Enhace boot EC sanity check\n\nIt's reported that some buggy BIOS tables can contain 2 DSDT ECs and some\nof them is invalid. As we shouldn't evaluate _STA here, this patch enhances\nsanity checks as a workaround to skip the wrong EC.\n\nLink: https://bugzilla.kernel.org/show_bug.cgi?id=195651\nReported-by: Daniel Drake <drake@endlessm.com>\nSigned-off-by: Lv Zheng <lv.zheng@intel.com>\n---\n drivers/acpi/ec.c       | 62 ++++++++++++++++++++++++-------------------------\n drivers/acpi/internal.h |  4 ++--\n 2 files changed, 32 insertions(+), 34 deletions(-)\n\nIndex: linux-acpica/drivers/acpi/ec.c\n===================================================================\n--- linux-acpica.orig/drivers/acpi/ec.c\n+++ linux-acpica/drivers/acpi/ec.c\n@@ -1362,6 +1362,14 @@ ec_parse_device(acpi_handle handle, u32\n \t\t\t\t     ec_parse_io_ports, ec);\n \tif (ACPI_FAILURE(status))\n \t\treturn status;\n+\t/*\n+\t * It's better to evaluate _STA to determine if the device is\n+\t * valid. But that could potentially trigger issues related to\n+\t * the unknown orders of _INI/_STA evaluations.\n+\t * However we can abort due to invalid _CRS information here.\n+\t */\n+\tif (ec->data_addr == 0 || ec->command_addr == 0)\n+\t\treturn AE_OK;\n \n \t/* Get GPE bit assignment (EC events). */\n \t/* TODO: Add support for _GPE returning a package */\n", "From: Lv Zheng <lv.zheng@intel.com>\nSubject: [PATCH] ACPI: EC: Add support to skip boot stage DSDT probe\n\nLong time ago, Linux EC driver won't probe DSDT EC during boot. It was\nadded by the following commit (see link #1 for bug report):\n  Commit: c5279dee26c0e8d7c4200993bfc4b540d2469598\n  Subject: ACPI: EC: Add some basic check for ECDT data\nThis is wrong as the only way to know if the DSDT EC is valid is to\nevaluate its _STA control method, but it's not proper to evaluate this\ncontrol method that early and out of the ACPI enumeration process.\n\nBut after we reverted back to the expected behavior, someone reported\nregressions (see link #2 for reference). That forced us to restore the\nwrong behavior back.\n\nNow we've been reported 3rd functional breakage, the only way to fix it is\nto evaluate _STA (see link #3 for newer requirement).\nHowever the link #2 reported issue is not fatal, so we could still skip\nboot stage DSDT probe. But in order not to trigger regressions, this patch\nalso prepares a boot parameter.\n\nLink: http://bugzilla.kernel.org/show_bug.cgi?id=11880 [#1]\nLink: http://bugzilla.kernel.org/show_bug.cgi?id=119261 [#2]\nLink: http://bugzilla.kernel.org/show_bug.cgi?id=195651 [#3]\nReported-by: Daniel Drake <drake@endlessm.com>\nSigned-off-by: Lv Zheng <lv.zheng@intel.com>\n---\nIndex: linux-acpica/drivers/acpi/ec.c\n===================================================================\n--- linux-acpica.orig/drivers/acpi/ec.c\n+++ linux-acpica/drivers/acpi/ec.c\n@@ -151,6 +151,10 @@ static bool ec_freeze_events __read_most\n module_param(ec_freeze_events, bool, 0644);\n MODULE_PARM_DESC(ec_freeze_events, \"Disabling event handling during suspend/resume\");\n \n+static bool ec_no_dsdt_boot_ec __read_mostly = false;\n+module_param(ec_no_dsdt_boot_ec, bool, 0644);\n+MODULE_PARM_DESC(ec_no_dsdt_boot_ec, \"Do not probe DSDT EC as boot EC\");\n+\n struct acpi_ec_query_handler {\n \tstruct list_head node;\n \tacpi_ec_query_func func;\n@@ -1679,6 +1683,9 @@ int __init acpi_ec_dsdt_probe(void)\n \tstruct acpi_ec *ec;\n \tint ret;\n \n+\tif (ec_no_dsdt_boot_ec)\n+\t\treturn -ENODEV;\n+\n \tec = acpi_ec_alloc();\n \tif (!ec)\n \t\treturn -ENOMEM;\n", "From: Lv Zheng <lv.zheng@intel.com>\nSubject: [PATCH] ACPI: EC: Add EC setting preference support\n\nDue to unknown reasons, Windows may prefer ECDT EC GPE rather than DSDT\nEC GPE setting. Without knowing the root cause, this patch simply allows\nusers to specify preferred EC settings (ID and GPE) via command line and\nprovides default value to always prefere DSDT settings.\n\nSigned-off-by: Lv Zheng <lv.zheng@intel.com>\n---\nIndex: linux-acpica/drivers/acpi/ec.c\n===================================================================\n--- linux-acpica.orig/drivers/acpi/ec.c\n+++ linux-acpica/drivers/acpi/ec.c\n@@ -155,6 +155,14 @@ static bool ec_no_dsdt_boot_ec __read_mo\n module_param(ec_no_dsdt_boot_ec, bool, 0644);\n MODULE_PARM_DESC(ec_no_dsdt_boot_ec, \"Do not probe DSDT EC as boot EC\");\n \n+static bool ec_use_boot_ec_id __read_mostly = false;\n+module_param(ec_use_boot_ec_id, bool, 0644);\n+MODULE_PARM_DESC(ec_use_boot_ec_id, \"Override EC_ID using boot EC setting\");\n+\n+static bool ec_use_boot_ec_gpe __read_mostly = true;\n+module_param(ec_use_boot_ec_gpe, bool, 0644);\n+MODULE_PARM_DESC(ec_use_boot_ec_gpe, \"Override GPE_BIT using boot EC setting\");\n+\n struct acpi_ec_query_handler {\n \tstruct list_head node;\n \tacpi_ec_query_func func;\n@@ -1574,14 +1582,28 @@ static bool acpi_is_boot_ec(struct acpi_\n {\n \tif (!boot_ec)\n \t\treturn false;\n-\tif (ec->handle == boot_ec->handle &&\n-\t    ec->gpe == boot_ec->gpe &&\n-\t    ec->command_addr == boot_ec->command_addr &&\n+\tif (ec->command_addr == boot_ec->command_addr &&\n \t    ec->data_addr == boot_ec->data_addr)\n \t\treturn true;\n \treturn false;\n }\n \n+static void acpi_ec_config_preference(struct acpi_ec *ec)\n+{\n+\tif (ec->handle != boot_ec->handle) {\n+\t\tif (ec_use_boot_ec_id)\n+\t\t\tec->handle = boot_ec->handle;\n+\t\telse\n+\t\t\tboot_ec->handle = ec->handle;\n+\t}\n+\tif (ec->gpe != boot_ec->gpe) {\n+\t\tif (ec_use_boot_ec_gpe)\n+\t\t\tec->gpe = boot_ec->gpe;\n+\t\telse\n+\t\t\tboot_ec->gpe = ec->gpe;\n+\t}\n+}\n+\n static int acpi_ec_add(struct acpi_device *device)\n {\n \tstruct acpi_ec *ec = NULL;\n@@ -1600,8 +1622,8 @@ static int acpi_ec_add(struct acpi_devic\n \t}\n \n \tif (acpi_is_boot_ec(ec)) {\n-\t\tboot_ec_is_ecdt = false;\n-\t\tacpi_handle_debug(ec->handle, \"duplicated.\\n\");\n+\t\tacpi_handle_debug(ec->handle, \"duplicated late.\\n\");\n+\t\tacpi_ec_config_preference(ec);\n \t\tacpi_ec_free(ec);\n \t\tec = boot_ec;\n \t\tret = acpi_config_boot_ec(ec, ec->handle, true, false);\n@@ -1699,6 +1721,10 @@ int __init acpi_ec_dsdt_probe(void)\n \t\tret = -ENODEV;\n \t\tgoto error;\n \t}\n+\tif (acpi_is_boot_ec(ec)) {\n+\t\tacpi_handle_debug(ec->handle, \"duplicated early.\\n\");\n+\t\tacpi_ec_config_preference(ec);\n+\t}\n \t/*\n \t * When the DSDT EC is available, always re-configure boot EC to\n \t * have _REG evaluated. _REG can only be evaluated after the\n", "From c635c8641f7aa410886d1635426083fb8be71900 Mon Sep 17 00:00:00 2001\nFrom: Carlo Caione <carlo@endlessm.com>\nDate: Wed, 31 May 2017 17:10:26 +0200\nSubject: [PATCH] ACPI / EC: Fix suspend on lid closing caused by wrong GPE in\n DSDT\n\nAs seen on other ASUS laptops also for the GL702VMK the _GPE define in\nthe DSDT table has a different value than the _GPE number in the ECDT.\n\nThis is causing the event generated when closing the lid to not be\ncatched by the kernel, breaking the suspend on lid closing.\n\nAdd this model to the quirks list.\n\nSigned-off-by: Carlo Caione <carlo@endlessm.com>\n---\n drivers/acpi/ec.c | 4 ++++\n 1 file changed, 4 insertions(+)\n\ndiff --git a/drivers/acpi/ec.c b/drivers/acpi/ec.c\nindex a51554f..41f86c5 100644\n--- a/drivers/acpi/ec.c\n+++ b/drivers/acpi/ec.c\n@@ -1793,6 +1793,10 @@ static struct dmi_system_id ec_dmi_table[] __initdata = {\n \tec_honor_ecdt_gpe, \"ASUSTeK COMPUTER INC. X580VD\", {\n \tDMI_MATCH(DMI_SYS_VENDOR, \"ASUSTeK COMPUTER INC.\"),\n \tDMI_MATCH(DMI_PRODUCT_NAME, \"X580VD\"),}, NULL},\n+\t{\n+\tec_honor_ecdt_gpe, \"ASUSTeK COMPUTER INC. GL702VMK\", {\n+\tDMI_MATCH(DMI_SYS_VENDOR, \"ASUSTeK COMPUTER INC.\"),\n+\tDMI_MATCH(DMI_PRODUCT_NAME, \"GL702VMK\"),}, NULL},\n \t{},\n };\n \n-- \n2.9.3\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "EC", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Lv Zheng", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2017-05-04 05:02 UTC by Lv Zheng", "Modified": "2017-07-04 01:07 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "4.11", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/acpi/ec.c"], "methods": ["ec_parse_device"]}
{"id": "187061", "title": "Poweroff and reboot hungs the PC with screen off and leds blinking on Latitude E7250", "description": "Created attachment 243731 [details]\nScreenshot just before hanging\n\nWhen doing a poweroff or a reboot the PC stops for a few seconds, apparently at the very end of the process, then it hungs. Screen is blank but leds (disk, power and wifi) blink.\n\nI compile the vanilla kernel myself (and the attached files refers to my kernel) but the same problem affects all the kernels I tested, including the original 4.8.0 deloivered with debian SID, and kernel 4.8 delivered with Ubuntu 16.10.\n\nI am attaching a screenshot of the console during the seconds of waiting just before the screen goes blank and the leds start blinking. I am also attaching dmesg result with the last running kernel (4.7.10) and with the latest 4.9.0-rc4 kernel.\n\nAny help on how to further analyze the source of the bug is welcome.\n\nGianpaolo", "patch": ["diff --git a/drivers/acpi/sleep.c b/drivers/acpi/sleep.c\nindex 2b38c1b..7a2e4d4 100644\n--- a/drivers/acpi/sleep.c\n+++ b/drivers/acpi/sleep.c\n@@ -47,32 +47,15 @@ static void acpi_sleep_tts_switch(u32 acpi_state)\n \t}\n }\n \n-static void acpi_sleep_pts_switch(u32 acpi_state)\n-{\n-\tacpi_status status;\n-\n-\tstatus = acpi_execute_simple_method(NULL, \"\\\\_PTS\", acpi_state);\n-\tif (ACPI_FAILURE(status) && status != AE_NOT_FOUND) {\n-\t\t/*\n-\t\t * OS can't evaluate the _PTS object correctly. Some warning\n-\t\t * message will be printed. But it won't break anything.\n-\t\t */\n-\t\tprintk(KERN_NOTICE \"Failure in evaluating _PTS object\\n\");\n-\t}\n-}\n-\n-static int sleep_notify_reboot(struct notifier_block *this,\n+static int tts_notify_reboot(struct notifier_block *this,\n \t\t\tunsigned long code, void *x)\n {\n \tacpi_sleep_tts_switch(ACPI_STATE_S5);\n-\n-\tacpi_sleep_pts_switch(ACPI_STATE_S5);\n-\n \treturn NOTIFY_DONE;\n }\n \n-static struct notifier_block sleep_notifier = {\n-\t.notifier_call\t= sleep_notify_reboot,\n+static struct notifier_block tts_notifier = {\n+\t.notifier_call\t= tts_notify_reboot,\n \t.next\t\t= NULL,\n \t.priority\t= 0,\n };\n@@ -916,9 +899,9 @@ int __init acpi_sleep_init(void)\n \tpr_info(PREFIX \"(supports%s)\\n\", supported);\n \n \t/*\n-\t * Register the sleep_notifier to reboot notifier list so that the _TTS\n-\t * and _PTS object can also be evaluated when the system enters S5.\n+\t * Register the tts_notifier to reboot notifier list so that the _TTS\n+\t * object can also be evaluated when the system enters S5.\n \t */\n-\tregister_reboot_notifier(&sleep_notifier);\n+\tregister_reboot_notifier(&tts_notifier);\n \treturn 0;\n }\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "Power-Off", "Hardware": "Intel Linux", "Importance": "P1 normal", "Assignee": "Ocean He", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2016-11-06 10:55 UTC by Gianpaolo", "Modified": "2016-12-06 14:25 UTC", "CC List": "8 users", "See Also": "151631", "Kernel Version": "4.9-rc4", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/acpi/sleep.c"], "methods": ["acpi_sleep_tts_switch", "acpi_sleep_init"]}
{"id": "177311", "title": "crazy interrupt rate on i801_smbus", "description": "I've noticed, when I do enable CONFIG_SENSORS_JC42 as a module or build into\nmy kernel, this causes a very high rate of interrupts on i801_smbus - about\n6000-8000 per second according to /proc/interrupts. After 20 minutes, there\nwere about 5 million interrupts generated on i801_smbus.\n \nWhen I do unload the module jc42, the interrupts do not stop, until I do a\ncomplete reboot.\n \nMainboard: Supermicro A1SRM-2758F\nKernel: Gentoo-Sources 4.8.1 (Happens also with Vanilla 4.8.1 and older kernel\nversions)\n \ndmesg:\n[    8.319900] i801_smbus 0000:00:1f.3: enabling device (0140 -> 0143)\n[    8.321864] i801_smbus 0000:00:1f.3: SMBus using PCI interrupt\n[    8.326098] ismt_smbus 0000:00:13.0: enabling device (0140 -> 0142)\n \nlspci:\n00:1f.3 SMBus: Intel Corporation Atom processor C2000 PCU SMBus (rev 02)\n\nWhen the module is loaded, I am also getting this errors:\n[   73.934901] ismt_smbus 0000:00:13.0: completion wait timed out\n[   74.974970] ismt_smbus 0000:00:13.0: completion wait timed out\n[   76.014949] ismt_smbus 0000:00:13.0: completion wait timed out\n[   77.054903] ismt_smbus 0000:00:13.0: completion wait timed out\n[   78.094961] ismt_smbus 0000:00:13.0: completion wait timed out\n[   79.134982] ismt_smbus 0000:00:13.0: completion wait timed out\n[   80.175116] ismt_smbus 0000:00:13.0: completion wait timed out\n[   81.215057] ismt_smbus 0000:00:13.0: completion wait timed out", "patch": ["diff --git a/drivers/i2c/busses/i2c-i801.c b/drivers/i2c/busses/i2c-i801.c\nindex 89ae78ef1a1c..f6e124b8392e 100644\n--- a/drivers/i2c/busses/i2c-i801.c\n+++ b/drivers/i2c/busses/i2c-i801.c\n@@ -625,6 +625,8 @@ static irqreturn_t i801_isr(int irq, void *dev_id)\n \n \t/* Confirm this is our interrupt */\n \tpci_read_config_word(priv->pci_dev, PCI_STATUS, &pcists);\n+\tdev_dbg_ratelimited(&priv->pci_dev->dev, \"pcicst %#x, SMBHSTSTS %#x\\n\",\n+\t\t\t    pcists, inb_p(SMBHSTSTS(priv)));\n \tif (!(pcists & PCI_STATUS_INTERRUPT))\n \t\treturn IRQ_NONE;\n \n", "diff --git a/drivers/i2c/busses/i2c-i801.c b/drivers/i2c/busses/i2c-i801.c\nindex 89ae78ef1a1c..76d57fc4e7b8 100644\n--- a/drivers/i2c/busses/i2c-i801.c\n+++ b/drivers/i2c/busses/i2c-i801.c\n@@ -190,6 +190,7 @@\n #define SMBSLVSTS_HST_NTFY_STS\tBIT(0)\n \n /* Host Notify Command register bits */\n+#define SMBSLVCMD_SMBALERT_DISABLE\tBIT(2)\n #define SMBSLVCMD_HST_NTFY_INTREN\tBIT(0)\n \n #define STATUS_ERROR_FLAGS\t(SMBHSTSTS_FAILED | SMBHSTSTS_BUS_ERR | \\\n@@ -1820,6 +1821,10 @@ static int i801_probe(struct pci_dev *dev, const struct pci_device_id *id)\n \t\toutb_p(inb_p(SMBAUXCTL(priv)) &\n \t\t       ~(SMBAUXCTL_CRC | SMBAUXCTL_E32B), SMBAUXCTL(priv));\n \n+\t/* Disable SMB_ALERT signal */\n+\toutb_p(inb_p(SMBSLVCMD(priv)) | SMBSLVCMD_SMBALERT_DISABLE,\n+\t       SMBSLVCMD(priv));\n+\n \t/* Remember original Host Notify setting */\n \tif (priv->features & FEATURE_HOST_NOTIFY)\n \t\tpriv->original_slvcmd = inb_p(SMBSLVCMD(priv));\n", "diff --git a/drivers/i2c/busses/i2c-i801.c b/drivers/i2c/busses/i2c-i801.c\nindex 115660dce722..6ae0101b247a 100644\n--- a/drivers/i2c/busses/i2c-i801.c\n+++ b/drivers/i2c/busses/i2c-i801.c\n@@ -190,6 +190,7 @@\n #define SMBSLVSTS_HST_NTFY_STS\tBIT(0)\n \n /* Host Notify Command register bits */\n+#define SMBSLVCMD_SMBALERT_DISABLE\tBIT(2)\n #define SMBSLVCMD_HST_NTFY_INTREN\tBIT(0)\n \n #define STATUS_ERROR_FLAGS\t(SMBHSTSTS_FAILED | SMBHSTSTS_BUS_ERR | \\\n@@ -972,9 +973,9 @@ static void i801_enable_host_notify(struct i2c_adapter *adapter)\n \tif (!(priv->features & FEATURE_HOST_NOTIFY))\n \t\treturn;\n \n-\tif (!(SMBSLVCMD_HST_NTFY_INTREN & priv->original_slvcmd))\n-\t\toutb_p(SMBSLVCMD_HST_NTFY_INTREN | priv->original_slvcmd,\n-\t\t       SMBSLVCMD(priv));\n+\t/* Enable host notify interrupt and disable SMB_ALERT signal */\n+\toutb_p(SMBSLVCMD_HST_NTFY_INTREN | SMBSLVCMD_SMBALERT_DISABLE |\n+\t       priv->original_slvcmd, SMBSLVCMD(priv));\n \n \t/* clear Host Notify bit to allow a new notification */\n \toutb_p(SMBSLVSTS_HST_NTFY_STS, SMBSLVSTS(priv));\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Hardware Monitoring", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Jean Delvare", "URL": "", "Keywords": "", "Duplicates (1)": "177291", "Depends on": "", "Blocks": "", "Reported": "2016-10-12 20:59 UTC by Conrad Kostecki", "Modified": "2022-01-14 17:30 UTC", "CC List": "5 users", "See Also": "", "Kernel Version": "4.8.1", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/i2c/busses/i2c-i801.c"], "methods": ["i801_isr"]}
{"id": "120591", "title": "BUG() in dmesg after loading nouveau module", "description": "Created attachment 220561 [details]\ndmesg\n\nOS: Arch Linux\nVideo adapter: GeForce GTX 780 Ti\nxf86-nouveau: 1.0.12\n\nI blacklisted nouveau module for full OS initialisation before reproducing, then issued:\n# modprobe nouveau debug=trace\n\nAfter that screen becomes black and in dmesg appears:\nBUG: unable to handle kernel NULL pointer dereference at 0000000000000210\n\nBug is not reproducible with 4.7-rc2 or earlier mainline.", "patch": ["diff --git a/drivers/gpu/drm/nouveau/nouveau_fbcon.c b/drivers/gpu/drm/nouveau/nouveau_fbcon.c\nindex 300ea03..d1f248f 100644\n--- a/drivers/gpu/drm/nouveau/nouveau_fbcon.c\n+++ b/drivers/gpu/drm/nouveau/nouveau_fbcon.c\n@@ -552,7 +552,8 @@ nouveau_fbcon_init(struct drm_device *dev)\n \tif (ret)\n \t\tgoto fini;\n \n-\tfbcon->helper.fbdev->pixmap.buf_align = 4;\n+\tif (fbcon->helper.fbdev)\n+\t\tfbcon->helper.fbdev->pixmap.buf_align = 4;\n \treturn 0;\n \n fini:\n-- \n2.9.0\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Video", "Hardware": "x86-64 Linux", "Importance": "P1 high", "Assignee": "drivers_video-dri", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2016-06-18 16:17 UTC by Dmitrii Tcvetkov", "Modified": "2016-06-24 22:30 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "4.7-rc3", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/gpu/drm/nouveau/nouveau_fbcon.c"], "methods": ["nouveau_fbcon_init"]}
{"id": "117651", "title": "Root NFS and autofs - mount disappears due to inode revalidate failed", "description": "Created attachment 215321 [details]\nlog fragment with failed getattr\n\nAfter upgrading from 3.14.12 to 4.1.15 I've got strange behaviour with autofs. \n\nIt happens on diskless machine with root on NFS. There is autofs indirect mount on /storage, where NFS volumes are mounted on demand.\n\nEverything mounts normally, but after mount expiration\n(during unmount) autofs mount disappears - that is, not only /storage/<volume>\nunmounts, but /storage is also unmounted. This happens quite often - usually on the very first expiration.\n\nautomount logs umount error in such cases.\n\nWithout autofs, mount/umount of the same NFS volume works correctly. \n\nWith NFS debug enabled, I've got following errors:\n\nNFS reply getattr: -512\nnfs_revalidate_inode: (0:15/6291480) getattr failed, error=-512\nNFS: nfs_lookup_revalidate(/storage) is invalid\n\nAfter inode revalidate failure all mounts on this inode are unmounted and so autofs mount disappears, while automount daemon itself continue to run.\n\ntcpdump shows, that server replies to getattr without error, but client\ndoesn't see this reply, and returning error instead.\n\n\nI am ready to supply additional information.", "patch": ["From 8129c6bfdc7e588a90a7d6942fd34c43c6a4f8b8 Mon Sep 17 00:00:00 2001\nFrom: Nicholas Krause <xerofoify@gmail.com>\nDate: Sun, 31 Jul 2016 16:45:33 -0400\nSubject: [PATCH] sunrpc\n\nSigned-off-by: Nicholas Krause <xerofoify@gmail.com>\n---\n net/sunrpc/xprtsock.c | 6 +++---\n 1 file changed, 3 insertions(+), 3 deletions(-)\n\ndiff --git a/net/sunrpc/xprtsock.c b/net/sunrpc/xprtsock.c\nindex 111767a..1bf3014 100644\n--- a/net/sunrpc/xprtsock.c\n+++ b/net/sunrpc/xprtsock.c\n@@ -1743,11 +1743,11 @@ static unsigned short xs_get_random_port(void)\n  * Note that this function has to be called on all sockets that share the\n  * same port, and it must be called before binding.\n  */\n-static void xs_sock_set_reuseport(struct socket *sock)\n+static void xs_sock_set_reuseport(struct socket *sock,int family)\n {\n \tint opt = 1;\n \n-\tkernel_setsockopt(sock, SOL_SOCKET, SO_REUSEPORT,\n+\tkernel_setsockopt(sock, family, SO_REUSEPORT,\n \t\t\t(char *)&opt, sizeof(opt));\n }\n \n@@ -1943,7 +1943,7 @@ static struct socket *xs_create_sock(struct rpc_xprt *xprt,\n \txs_reclassify_socket(family, sock);\n \n \tif (reuseport)\n-\t\txs_sock_set_reuseport(sock);\n+\t\txs_sock_set_reuseport(sock,family);\n \n \terr = xs_bind(transport, sock);\n \tif (err) {\n-- \n2.7.4\n\n", "From 398e8a7af6294cca1976310598e954739407bcc6 Mon Sep 17 00:00:00 2001\nFrom: Nicholas Krause <xerofoify@gmail.com>\nDate: Mon, 1 Aug 2016 10:53:27 -0400\nSubject: [PATCH] set up socket for port reuse correctly in xs_create_sock\n\nSigned-off-by: Nicholas Krause <xerofoify@gmail.com>\n---\n net/sunrpc/xprtsock.c | 4 +++-\n 1 file changed, 3 insertions(+), 1 deletion(-)\n\ndiff --git a/net/sunrpc/xprtsock.c b/net/sunrpc/xprtsock.c\nindex 111767a..1e0a179 100644\n--- a/net/sunrpc/xprtsock.c\n+++ b/net/sunrpc/xprtsock.c\n@@ -1942,8 +1942,10 @@ static struct socket *xs_create_sock(struct rpc_xprt *xprt,\n \t}\n \txs_reclassify_socket(family, sock);\n \n-\tif (reuseport)\n+\tif (reuseport) {\n+\t\tsock->sk->sk_reuse = SK_CAN_REUSE;\n \t\txs_sock_set_reuseport(sock);\n+\t}\n \n \terr = xs_bind(transport, sock);\n \tif (err) {\n-- \n2.7.4\n\n", "From 1f4c17a03ba7f430d63dba8c8e08ff1e2712581d Mon Sep 17 00:00:00 2001\nFrom: Trond Myklebust <trond.myklebust@primarydata.com>\nDate: Mon, 1 Aug 2016 13:36:08 -0400\nSubject: [PATCH] SUNRPC: Handle EADDRNOTAVAIL on connection failures\n\nIf the connect attempt immediately fails with an EADDRNOTAVAIL error, then\nthat means our choice of source port number was bad.\nThis error is expected when we set the SO_REUSEPORT socket option and we\nhave 2 sockets sharing the same source and destination address and port\ncombinations.\n\nSigned-off-by: Trond Myklebust <trond.myklebust@primarydata.com>\nFixes: 402e23b4ed9ed (\"SUNRPC: Fix stupid typo in xs_sock_set_reuseport\")\nCc: stable@vger.kernel.org # v4.0+\n---\n net/sunrpc/xprtsock.c | 4 ++++\n 1 file changed, 4 insertions(+)\n\ndiff --git a/net/sunrpc/xprtsock.c b/net/sunrpc/xprtsock.c\nindex 111767ab124a..c6b1d48c4319 100644\n--- a/net/sunrpc/xprtsock.c\n+++ b/net/sunrpc/xprtsock.c\n@@ -2295,6 +2295,10 @@ static int xs_tcp_finish_connecting(struct rpc_xprt *xprt, struct socket *sock)\n \t\t/* SYN_SENT! */\n \t\tif (xprt->reestablish_timeout < XS_TCP_INIT_REEST_TO)\n \t\t\txprt->reestablish_timeout = XS_TCP_INIT_REEST_TO;\n+\t\tbreak;\n+\tcase -EADDRNOTAVAIL:\n+\t\t/* Source port number is unavailable. Try a new one! */\n+\t\ttransport->srcport = 0;\n \t}\n out:\n \treturn ret;\n-- \n2.7.4\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "File System", "Classification": "Unclassified", "Component": "NFS", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Trond Myklebust", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2016-05-05 11:21 UTC by alexpro", "Modified": "2016-08-02 13:44 UTC", "CC List": "1 user", "See Also": "", "Kernel Version": "4.1.15", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["net/sunrpc/xprtsock.c"], "methods": ["xs_sock_set_reuseport"]}
{"id": "110831", "title": "iwlwifi: mvm: scheduled scan doesn't report results when no matches are passed - MWG100254662", "description": "Hardware: Intel edison with Intel 7260 chip.\nSoftware:Connman-1.3, Wpa_supplicant-2.5 and kernel-4.1.13\n\nThe firmware of Intel 7260 is iwlwifi-7260-13.ucode.\n\nStep:\n1. After wifi is enabled, use the connman cmd of \"connmanctl scan wifi\" to scan wifi ap.\n\n2. When use the connman cmd of \"connmanctl scan wifi\", connman will invoke the interfaces of Wpa_supplicant and Wpa_supplicant will trigger sched scan.\n\n3. After trigger sched scan, no NL80211_CMD_SCHED_SCAN_RESULTS events come from kernel with Intel 7260 chip. \n\n4. Wpa_supplicant will always wait for the events of NL80211_CMD_SCHED_SCAN_RESULTS to get the sched scan results.\n\nExpect:\nNL80211_CMD_SCHED_SCAN_RESULTS events come from kernel with Intel 7260 chip.", "patch": ["From fd409f8743c315418e5da69961482054cbe370d0 Mon Sep 17 00:00:00 2001\nFrom: Luca Coelho <luciano.coelho@intel.com>\nDate: Tue, 2 Feb 2016 15:27:29 +0200\nSubject: [PATCH] [[RFT/RFC] iwlwifi: mvm: don't allow sched scans without\n matches to be started\n\nThe firmware can perform a scheduled scan with not matchsets passed,\nbut it can't send notification that results were found.  Since the\nuserspace then cannot know when we got new results and the firmware\nwouldn't trigger a wake in case we are sleeping, it's better not to\nallow scans without matchsets.\n\nSigned-off-by: Luca Coelho <luciano.coelho@intel.com>\n---\n drivers/net/wireless/iwlwifi/mvm/mac80211.c | 4 ++++\n 1 file changed, 4 insertions(+)\n\ndiff --git a/drivers/net/wireless/iwlwifi/mvm/mac80211.c b/drivers/net/wireless/iwlwifi/mvm/mac80211.c\nindex dda9f7b..42b8304 100644\n--- a/drivers/net/wireless/iwlwifi/mvm/mac80211.c\n+++ b/drivers/net/wireless/iwlwifi/mvm/mac80211.c\n@@ -2796,6 +2796,10 @@ static int iwl_mvm_mac_sched_scan_start(struct ieee80211_hw *hw,\n \tstruct iwl_mvm *mvm = IWL_MAC80211_GET_MVM(hw);\n \tint ret;\n \n+\t/* we don't support \"match all\" in the firmware */\n+\tif (!req->n_match_sets)\n+\t\treturn -EINVAL;\n+\n \tif (!(mvm->fw->ucode_capa.capa[0] & IWL_UCODE_TLV_CAPA_UMAC_SCAN)) {\n \t\tret = iwl_mvm_cancel_scan_wait_notif(mvm, IWL_MVM_SCAN_OS);\n \t\tif (ret)\n-- \n2.7.0.rc3\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "network-wireless", "Hardware": "Intel Linux", "Importance": "P1 normal", "Assignee": "DO NOT USE - assign \"network-wireless-intel\" component instead", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2016-01-15 06:19 UTC by wzhen12", "Modified": "2016-02-15 06:50 UTC", "CC List": "1 user", "See Also": "", "Kernel Version": "4.1.13", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/net/wireless/iwlwifi/mvm/mac80211.c"], "methods": ["iwl_mvm_mac_sched_scan_start"]}
{"id": "106571", "title": "Surface 3 Lid Switch Method parse/execution failed", "description": "Created attachment 191021 [details]\ndmesg until failure\n\nOn the Microsoft Surface 3, when you fold the type cover over the screen (or \"close the lid\"), the lid switch state does not change, and an ACPI error is thrown. The lid switch state always reports closed.\n\n[root@localhost ~]# cat /proc/acpi/button/lid/LID/state \nstate:      closed\n\n[ 1130.459896] ACPI Exception: AE_ERROR, Returned by Handler for [GeneralPurposeIo] (20150930/evregion-297)\n[ 1130.460061] ACPI Error: Method parse/execution failed [\\_SB.GPO0._E4C] (Node ffff88013f4b4438), AE_ERROR (20150930/psparse-542)\n\nFrom the DSDT, this is the GPIO event handler that toggles the lid switch state.", "patch": ["diff --git a/drivers/gpio/gpiolib-acpi.c b/drivers/gpio/gpiolib-acpi.c\nindex 143a9bdbaa53..623a2062c51b 100644\n--- a/drivers/gpio/gpiolib-acpi.c\n+++ b/drivers/gpio/gpiolib-acpi.c\n@@ -603,6 +603,26 @@ acpi_gpio_adr_space_handler(u32 function, acpi_physical_address address,\n \t\t\t\tbreak;\n \t\t\t}\n \t\t}\n+\n+\t\t/*\n+\t\t * The same GPIO pin can be shared between event and\n+\t\t * operation region if it is marked as shared and is only\n+\t\t * read from the ASL code. In that case we \"borrow\" the\n+\t\t * event GPIO here.\n+\t\t */\n+\t\tif (!found && agpio->sharable == ACPI_SHARED &&\n+\t\t     function == ACPI_READ) {\n+\t\t\tstruct acpi_gpio_event *event;\n+\n+\t\t\tlist_for_each_entry(event, &achip->events, node) {\n+\t\t\t\tif (event->pin == pin) {\n+\t\t\t\t\tdesc = event->desc;\n+\t\t\t\t\tfound = true;\n+\t\t\t\t\tbreak;\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\n \t\tif (!found) {\n \t\t\tdesc = gpiochip_request_own_desc(chip, pin,\n \t\t\t\t\t\t\t \"ACPI:OpRegion\");\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "Config-Tables", "Hardware": "x86-64 Linux", "Importance": "P1 normal", "Assignee": "acpi_config-tables", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2015-10-24 19:51 UTC by Stephen Just", "Modified": "2016-02-01 20:59 UTC", "CC List": "4 users", "See Also": "", "Kernel Version": "4.3-rc6", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/gpio/gpiolib-acpi.c"], "methods": ["acpi_gpio_adr_space_handler"]}
{"id": "104121", "title": "Esprimo Mobile 9410: Two acpi_video* devices in sysfs, only one working", "description": "Created attachment 186931 [details]\nacpidump of Esprimo Mobile M9410\n\nUnder /sys/class/backlight there are two entries:\n[xxx@yyy ~]$ ls -l /sys/class/backlight/\nlrwxrwxrwx. 1 root root 0  6. Sep 2015  acpi_video0 -> ../../devices/pci0000:00/0000:00:02.0/backlight/acpi_video0\nlrwxrwxrwx. 1 root root 0  6. Sep 2015  acpi_video1 -> ../../devices/pci0000:00/0000:00:02.0/backlight/acpi_video1\n\nWhen writing manually a new value to acpi_video0/brightness the backlight is not changing. Do the same with acpi_video1/brightness is changing the backlight.\n\nBoth entries are of type firmware.\nAs a result, the backlight can not be changed from the gnome shell slider (gnome 3.16), gsd-backlight-helper and xbacklight. xbacklight is working, when acpi_video1 is defined as the backlight device in an xorg.conf.d file.\n\nHere the output of all files in the acpi_video* folder. In addition I attache an acpidump. If any additional information is needed, please let me know and I try to get it.\n\n[xxx@yyy ~]$ grep . -r /sys/class/backlight/*\n/sys/class/backlight/acpi_video0/type:firmware\n/sys/class/backlight/acpi_video0/brightness:4\n/sys/class/backlight/acpi_video0/power/control:auto\n/sys/class/backlight/acpi_video0/power/async:disabled\n/sys/class/backlight/acpi_video0/power/runtime_enabled:disabled\n/sys/class/backlight/acpi_video0/power/runtime_active_kids:0\n/sys/class/backlight/acpi_video0/power/runtime_active_time:0\ngrep: /sys/class/backlight/acpi_video0/power/autosuspend_delay_ms: Eingabe-/Ausgabefehler\n/sys/class/backlight/acpi_video0/power/runtime_status:unsupported\n/sys/class/backlight/acpi_video0/power/runtime_usage:0\n/sys/class/backlight/acpi_video0/power/runtime_suspended_time:0\n/sys/class/backlight/acpi_video0/bl_power:0\n/sys/class/backlight/acpi_video0/max_brightness:10\n/sys/class/backlight/acpi_video0/actual_brightness:4\n/sys/class/backlight/acpi_video1/type:firmware\n/sys/class/backlight/acpi_video1/brightness:7\n/sys/class/backlight/acpi_video1/power/control:auto\n/sys/class/backlight/acpi_video1/power/async:disabled\n/sys/class/backlight/acpi_video1/power/runtime_enabled:disabled\n/sys/class/backlight/acpi_video1/power/runtime_active_kids:0\n/sys/class/backlight/acpi_video1/power/runtime_active_time:0\ngrep: /sys/class/backlight/acpi_video1/power/autosuspend_delay_ms: Eingabe-/Ausgabefehler\n/sys/class/backlight/acpi_video1/power/runtime_status:unsupported\n/sys/class/backlight/acpi_video1/power/runtime_usage:0\n/sys/class/backlight/acpi_video1/power/runtime_suspended_time:0\n/sys/class/backlight/acpi_video1/bl_power:0\n/sys/class/backlight/acpi_video1/max_brightness:7\n/sys/class/backlight/acpi_video1/actual_brightness:7", "patch": ["diff --git a/drivers/acpi/acpi_video.c b/drivers/acpi/acpi_video.c\nindex 5778e8e4313a..e0c2b6646546 100644\n--- a/drivers/acpi/acpi_video.c\n+++ b/drivers/acpi/acpi_video.c\n@@ -77,6 +77,12 @@ module_param(allow_duplicates, bool, 0644);\n static int disable_backlight_sysfs_if = -1;\n module_param(disable_backlight_sysfs_if, int, 0444);\n \n+static bool device_id_scheme = false;\n+module_param(device_id_scheme, bool, 0444);\n+\n+static bool only_lcd = false;\n+module_param(only_lcd, bool, 0444);\n+\n static int register_count;\n static DEFINE_MUTEX(register_count_mutex);\n static struct mutex video_list_lock;\n@@ -394,6 +400,18 @@ static int video_disable_backlight_sysfs_if(\n \treturn 0;\n }\n \n+static int video_set_device_id_scheme(const struct dmi_system_id *d)\n+{\n+\tdevice_id_scheme = true;\n+\treturn 0;\n+}\n+\n+static int video_enable_only_lcd(const struct dmi_system_id *d)\n+{\n+\tonly_lcd = true;\n+\treturn 0;\n+}\n+\n static struct dmi_system_id video_dmi_table[] = {\n \t/*\n \t * Broken _BQC workaround http://bugzilla.kernel.org/show_bug.cgi?id=13121\n@@ -455,6 +473,33 @@ static struct dmi_system_id video_dmi_table[] = {\n \t\tDMI_MATCH(DMI_PRODUCT_NAME, \"PORTEGE R830\"),\n \t\t},\n \t},\n+\t/*\n+\t * Some machine's _DOD IDs don't have bit 31(Device ID Scheme) set\n+\t * but the IDs actually follow the Device ID Scheme.\n+\t */\n+\t{\n+\t /* https://bugzilla.kernel.org/show_bug.cgi?id=104121 */\n+\t .callback = video_set_device_id_scheme,\n+\t .ident = \"ESPRIMO Mobile M9410\",\n+\t .matches = {\n+\t\tDMI_MATCH(DMI_SYS_VENDOR, \"FUJITSU SIEMENS\"),\n+\t\tDMI_MATCH(DMI_PRODUCT_NAME, \"M118DB\"),\n+\t\t},\n+\t},\n+\t/*\n+\t * Some machines have multiple video output devices, but only the one\n+\t * that is the type of LCD can do the backlight control so we should not\n+\t * register backlight interface for other video output devices.\n+\t */\n+\t{\n+\t /* https://bugzilla.kernel.org/show_bug.cgi?id=104121 */\n+\t .callback = video_enable_only_lcd,\n+\t .ident = \"ESPRIMO Mobile M9410\",\n+\t .matches = {\n+\t\tDMI_MATCH(DMI_SYS_VENDOR, \"FUJITSU SIEMENS\"),\n+\t\tDMI_MATCH(DMI_PRODUCT_NAME, \"M118DB\"),\n+\t\t},\n+\t},\n \t{}\n };\n \n@@ -1003,7 +1048,9 @@ acpi_video_bus_get_one_device(struct acpi_device *device,\n \n \tattribute = acpi_video_get_device_attr(video, device_id);\n \n-\tif (attribute && attribute->device_id_scheme) {\n+\tpr_info(\"%s: attribute->device_id_scheme=%d, device_id_scheme=%d\\n\",\n+\t\t\t__func__, attribute->device_id_scheme, device_id_scheme);\n+\tif (attribute && (attribute->device_id_scheme || device_id_scheme)) {\n \t\tswitch (attribute->display_type) {\n \t\tcase ACPI_VIDEO_DISPLAY_CRT:\n \t\t\tdata->flags.crt = 1;\n@@ -1568,15 +1615,6 @@ static void acpi_video_dev_register_backlight(struct acpi_video_device *device)\n \tstatic int count;\n \tchar *name;\n \n-\t/*\n-\t * Do not create backlight device for video output\n-\t * device that is not in the enumerated list.\n-\t */\n-\tif (!acpi_video_device_in_dod(device)) {\n-\t\tdev_dbg(&device->dev->dev, \"not in _DOD list, ignore\\n\");\n-\t\treturn;\n-\t}\n-\n \tresult = acpi_video_init_brightness(device);\n \tif (result)\n \t\treturn;\n@@ -1657,6 +1695,22 @@ static void acpi_video_run_bcl_for_osi(struct acpi_video_bus *video)\n \tmutex_unlock(&video->device_list_lock);\n }\n \n+static bool acpi_video_should_register_backlight(struct acpi_video_device *dev)\n+{\n+\t/*\n+\t * Do not create backlight device for video output\n+\t * device that is not in the enumerated list.\n+\t */\n+\tif (!acpi_video_device_in_dod(dev)) {\n+\t\tdev_dbg(&dev->dev->dev, \"not in _DOD list, ignore\\n\");\n+\t\treturn false;\n+\t}\n+\n+\tif (only_lcd)\n+\t\treturn dev->flags.lcd;\n+\treturn true;\n+}\n+\n static int acpi_video_bus_register_backlight(struct acpi_video_bus *video)\n {\n \tstruct acpi_video_device *dev;\n@@ -1670,8 +1724,10 @@ static int acpi_video_bus_register_backlight(struct acpi_video_bus *video)\n \t\treturn 0;\n \n \tmutex_lock(&video->device_list_lock);\n-\tlist_for_each_entry(dev, &video->video_device_list, entry)\n-\t\tacpi_video_dev_register_backlight(dev);\n+\tlist_for_each_entry(dev, &video->video_device_list, entry) {\n+\t\tif (acpi_video_should_register_backlight(dev))\n+\t\t\tacpi_video_dev_register_backlight(dev);\n+\t}\n \tmutex_unlock(&video->device_list_lock);\n \n \tvideo->backlight_registered = true;\n", "diff --git a/drivers/acpi/acpi_video.c b/drivers/acpi/acpi_video.c\nindex 5778e8e4313a..3405f7a41e25 100644\n--- a/drivers/acpi/acpi_video.c\n+++ b/drivers/acpi/acpi_video.c\n@@ -77,6 +77,12 @@ module_param(allow_duplicates, bool, 0644);\n static int disable_backlight_sysfs_if = -1;\n module_param(disable_backlight_sysfs_if, int, 0444);\n \n+static bool device_id_scheme = false;\n+module_param(device_id_scheme, bool, 0444);\n+\n+static bool only_lcd = false;\n+module_param(only_lcd, bool, 0444);\n+\n static int register_count;\n static DEFINE_MUTEX(register_count_mutex);\n static struct mutex video_list_lock;\n@@ -394,6 +400,18 @@ static int video_disable_backlight_sysfs_if(\n \treturn 0;\n }\n \n+static int video_set_device_id_scheme(const struct dmi_system_id *d)\n+{\n+\tdevice_id_scheme = true;\n+\treturn 0;\n+}\n+\n+static int video_enable_only_lcd(const struct dmi_system_id *d)\n+{\n+\tonly_lcd = true;\n+\treturn 0;\n+}\n+\n static struct dmi_system_id video_dmi_table[] = {\n \t/*\n \t * Broken _BQC workaround http://bugzilla.kernel.org/show_bug.cgi?id=13121\n@@ -455,6 +473,33 @@ static struct dmi_system_id video_dmi_table[] = {\n \t\tDMI_MATCH(DMI_PRODUCT_NAME, \"PORTEGE R830\"),\n \t\t},\n \t},\n+\t/*\n+\t * Some machine's _DOD IDs don't have bit 31(Device ID Scheme) set\n+\t * but the IDs actually follow the Device ID Scheme.\n+\t */\n+\t{\n+\t /* https://bugzilla.kernel.org/show_bug.cgi?id=104121 */\n+\t .callback = video_set_device_id_scheme,\n+\t .ident = \"ESPRIMO Mobile M9410\",\n+\t .matches = {\n+\t\tDMI_MATCH(DMI_SYS_VENDOR, \"FUJITSU SIEMENS\"),\n+\t\tDMI_MATCH(DMI_PRODUCT_NAME, \"ESPRIMO Mobile M9410\"),\n+\t\t},\n+\t},\n+\t/*\n+\t * Some machines have multiple video output devices, but only the one\n+\t * that is the type of LCD can do the backlight control so we should not\n+\t * register backlight interface for other video output devices.\n+\t */\n+\t{\n+\t /* https://bugzilla.kernel.org/show_bug.cgi?id=104121 */\n+\t .callback = video_enable_only_lcd,\n+\t .ident = \"ESPRIMO Mobile M9410\",\n+\t .matches = {\n+\t\tDMI_MATCH(DMI_SYS_VENDOR, \"FUJITSU SIEMENS\"),\n+\t\tDMI_MATCH(DMI_PRODUCT_NAME, \"ESPRIMO Mobile M9410\"),\n+\t\t},\n+\t},\n \t{}\n };\n \n@@ -1003,7 +1048,7 @@ acpi_video_bus_get_one_device(struct acpi_device *device,\n \n \tattribute = acpi_video_get_device_attr(video, device_id);\n \n-\tif (attribute && attribute->device_id_scheme) {\n+\tif (attribute && (attribute->device_id_scheme || device_id_scheme)) {\n \t\tswitch (attribute->display_type) {\n \t\tcase ACPI_VIDEO_DISPLAY_CRT:\n \t\t\tdata->flags.crt = 1;\n@@ -1568,15 +1613,6 @@ static void acpi_video_dev_register_backlight(struct acpi_video_device *device)\n \tstatic int count;\n \tchar *name;\n \n-\t/*\n-\t * Do not create backlight device for video output\n-\t * device that is not in the enumerated list.\n-\t */\n-\tif (!acpi_video_device_in_dod(device)) {\n-\t\tdev_dbg(&device->dev->dev, \"not in _DOD list, ignore\\n\");\n-\t\treturn;\n-\t}\n-\n \tresult = acpi_video_init_brightness(device);\n \tif (result)\n \t\treturn;\n@@ -1657,6 +1693,22 @@ static void acpi_video_run_bcl_for_osi(struct acpi_video_bus *video)\n \tmutex_unlock(&video->device_list_lock);\n }\n \n+static bool acpi_video_should_register_backlight(struct acpi_video_device *dev)\n+{\n+\t/*\n+\t * Do not create backlight device for video output\n+\t * device that is not in the enumerated list.\n+\t */\n+\tif (!acpi_video_device_in_dod(dev)) {\n+\t\tdev_dbg(&dev->dev->dev, \"not in _DOD list, ignore\\n\");\n+\t\treturn false;\n+\t}\n+\n+\tif (only_lcd)\n+\t\treturn dev->flags.lcd;\n+\treturn true;\n+}\n+\n static int acpi_video_bus_register_backlight(struct acpi_video_bus *video)\n {\n \tstruct acpi_video_device *dev;\n@@ -1670,8 +1722,10 @@ static int acpi_video_bus_register_backlight(struct acpi_video_bus *video)\n \t\treturn 0;\n \n \tmutex_lock(&video->device_list_lock);\n-\tlist_for_each_entry(dev, &video->video_device_list, entry)\n-\t\tacpi_video_dev_register_backlight(dev);\n+\tlist_for_each_entry(dev, &video->video_device_list, entry) {\n+\t\tif (acpi_video_should_register_backlight(dev))\n+\t\t\tacpi_video_dev_register_backlight(dev);\n+\t}\n \tmutex_unlock(&video->device_list_lock);\n \n \tvideo->backlight_registered = true;\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "Power-Video", "Hardware": "x86-64 Linux", "Importance": "P1 normal", "Assignee": "Aaron Lu", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2015-09-06 19:09 UTC by Christian Scharl", "Modified": "2015-11-13 03:18 UTC", "CC List": "3 users", "See Also": "", "Kernel Version": "4.2-rc5", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/acpi/acpi_video.c"], "methods": ["acpi_video_bus_get_one_device", "acpi_video_dev_register_backlight", "acpi_video_bus_register_backlight", "video_dmi_table"]}
{"id": "101521", "title": "iwlwifi: WARNING when setting Tx power with WEXT while in RFKILL - MWG100249491", "description": "Created attachment 182661 [details]\nlspci -vvvx\n\nI am testing vanilla linux-4.1.2 kernel on Dell Vostro 3550 laptop with A12 BIOS. During cold boot I received:\n\n[   20.114785] r8169 0000:05:00.0: Direct firmware load for rtl_nic/rtl8168e-2.fw failed with error -2\n[   20.114795] r8169 0000:05:00.0 enp5s0: unable to load firmware patch rtl_nic/rtl8168e-2.fw (-2)\n[   20.138835] r8169 0000:05:00.0 enp5s0: link down\n[   20.493918] ------------[ cut here ]------------\n[   20.493928] WARNING: CPU: 2 PID: 3162 at net/mac80211/driver-ops.h:12 ieee80211_bss_info_change_notify+0x1e2/0x1f0()\n[   20.493930] wlp9s0:  Failed check-sdata-in-driver check, flags: 0x0\n[   20.493931] Modules linked in: fuse x86_pkg_temp_thermal intel_powerclamp kvm_intel kvm ums_realtek uas iwldvm usb_storage iwlwifi dell_smo8800\n[   20.493942] CPU: 2 PID: 3162 Comm: iwconfig Not tainted 4.1.2-default-pciehp #2\n[   20.493943] Hardware name: Dell Inc. Vostro 3550/, BIOS A12 02/18/2014\n[   20.493945]  ffffffff81dadc75 ffff88040aff7b68 ffffffff819c6a7d ffffffff81128822\n[   20.493947]  ffff88040aff7bb8 ffff88040aff7ba8 ffffffff810d2f05 0000000000000000\n[   20.493950]  0000000000040000 ffff8800d97089e0 ffff88040ced4a00 ffff8800d9708460\n[   20.493952] Call Trace:\n[   20.493957]  [<ffffffff819c6a7d>] dump_stack+0x45/0x57\n[   20.493960]  [<ffffffff81128822>] ? console_unlock+0x282/0x4a0\n[   20.493963]  [<ffffffff810d2f05>] warn_slowpath_common+0x85/0xc0\n[   20.493965]  [<ffffffff810d2f81>] warn_slowpath_fmt+0x41/0x50\n[   20.493967]  [<ffffffff8195b1d2>] ieee80211_bss_info_change_notify+0x1e2/0x1f0\n[   20.493970]  [<ffffffff81974afd>] ieee80211_recalc_txpower+0x2d/0x40\n[   20.493973]  [<ffffffff8197bab7>] ieee80211_set_tx_power+0x47/0x1a0\n[   20.493975]  [<ffffffff81955bea>] cfg80211_wext_siwtxpower+0xaa/0x1d0\n[   20.493977]  [<ffffffff81958b9f>] ioctl_standard_call+0x4f/0xe0\n[   20.493979]  [<ffffffff81958b50>] ? ioctl_standard_iw_point+0x3a0/0x3a0\n[   20.493981]  [<ffffffff8195873d>] wireless_process_ioctl.constprop.9+0x8d/0x100\n[   20.493983]  [<ffffffff81958ddd>] wext_handle_ioctl+0x5d/0xb0\n[   20.493985]  [<ffffffff81806fd9>] dev_ioctl+0x339/0x6f0\n[   20.493990]  [<ffffffff817ce2a2>] sock_ioctl+0x142/0x2e0\n[   20.493993]  [<ffffffff81210968>] do_vfs_ioctl+0x2f8/0x530\n[   20.493996]  [<ffffffff8121c4a4>] ? __fget_light+0x64/0x90\n[   20.493998]  [<ffffffff81210bdc>] SyS_ioctl+0x3c/0x80\n[   20.494001]  [<ffffffff819d279b>] system_call_fastpath+0x16/0x73\n[   20.494002] ---[ end trace 0c521a819f5fe0d4 ]---\n[   21.784629] r8169 0000:05:00.0 enp5s0: link up\n\n\n05:00.0 Ethernet controller: Realtek Semiconductor Co., Ltd. RTL8111/8168/8411 PCI Express Gigabit Ethernet Controller (rev 06)\n09:00.0 Network controller: Intel Corporation Centrino Wireless-N 1030 [Rainbow Peak] (rev 34)\n\n\n05:00.0 Ethernet controller: Realtek Semiconductor Co., Ltd. RTL8111/8168/8411 PCI Express Gigabit Ethernet Controller (rev 06)\n        Subsystem: Dell RTL8111/8168/8411 PCI Express Gigabit Ethernet Controller\n        Flags: bus master, fast devsel, latency 0, IRQ 30\n        I/O ports at e000 [size=256]\n        Memory at f1104000 (64-bit, prefetchable) [size=4K]\n        Memory at f1100000 (64-bit, prefetchable) [size=16K]\n        Capabilities: [40] Power Management version 3\n        Capabilities: [50] MSI: Enable+ Count=1/1 Maskable- 64bit+\n        Capabilities: [70] Express Endpoint, MSI 01\n        Capabilities: [b0] MSI-X: Enable- Count=4 Masked-\n        Capabilities: [d0] Vital Product Data\n        Capabilities: [100] Advanced Error Reporting\n        Capabilities: [140] Virtual Channel\n        Capabilities: [160] Device Serial Number 01-00-00-00-68-4c-e0-00\n        Kernel driver in use: r8169\n\n09:00.0 Network controller: Intel Corporation Centrino Wireless-N 1030 [Rainbow Peak] (rev 34)\n        Subsystem: Intel Corporation Centrino Wireless-N 1030 BGN\n        Flags: bus master, fast devsel, latency 0, IRQ 42\n        Memory at f7e00000 (64-bit, non-prefetchable) [size=8K]\n        Capabilities: [c8] Power Management version 3\n        Capabilities: [d0] MSI: Enable+ Count=1/1 Maskable- 64bit+\n        Capabilities: [e0] Express Endpoint, MSI 00\n        Capabilities: [100] Advanced Error Reporting\n        Capabilities: [140] Device Serial Number 4c-80-93-ff-ff-15-e6-c7\n        Kernel driver in use: iwlwifi\n        Kernel modules: iwlwifi", "patch": ["From ac99d0dac74970d97dbfc0a6d640162179b20795 Mon Sep 17 00:00:00 2001\nFrom: Emmanuel Grumbach <emmanuel.grumbach@intel.com>\nDate: Mon, 2 Nov 2015 14:01:35 +0200\nSubject: [PATCH] mac80211: ensure we don't update tx power on a non-running\n sdata\n\nWe can't update the Tx power on the device unless it is\nrunning.\n\ntype=bugfix\nbug=cq:MWG100249491\nfixes=unknown\n\nChange-Id: I42a1a4785053f5d70b5174bb80aef3ac9e5231fb\nSigned-off-by: Emmanuel Grumbach <emmanuel.grumbach@intel.com>\n---\nI think it fixes:\ncommit db82d8a966ded064bd4cf0e1fcca13442f50d0ae\nAuthor: Lorenzo Bianconi <lorenzo.bianconi83@gmail.com>\nDate:   Wed Jan 14 12:55:08 2015 +0100\n    mac80211: enable TPC through mac80211 stack\nBut I am not sure\n---\n net/mac80211/iface.c | 3 ++-\n 1 file changed, 2 insertions(+), 1 deletion(-)\n\ndiff --git a/net/mac80211/iface.c b/net/mac80211/iface.c\nindex c864fd5..dc469f3 100644\n--- a/net/mac80211/iface.c\n+++ b/net/mac80211/iface.c\n@@ -77,7 +77,8 @@ bool __ieee80211_recalc_txpower(struct ieee80211_sub_if_data *sdata)\n void ieee80211_recalc_txpower(struct ieee80211_sub_if_data *sdata,\n \t\t\t      bool update_bss)\n {\n-\tif (__ieee80211_recalc_txpower(sdata) || update_bss)\n+\tif (__ieee80211_recalc_txpower(sdata) ||\n+\t    (update_bss && ieee80211_sdata_running(sdata)))\n \t\tieee80211_bss_info_change_notify(sdata, BSS_CHANGED_TXPOWER);\n }\n \n-- \n2.5.0\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "network-wireless", "Hardware": "x86-64 Linux", "Importance": "P1 normal", "Assignee": "DO NOT USE - assign \"network-wireless-intel\" component instead", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2015-07-14 20:35 UTC by Martin Mokrejs", "Modified": "2015-11-02 19:42 UTC", "CC List": "1 user", "See Also": "", "Kernel Version": "4.1.2", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["net/mac80211/iface.c"], "methods": ["ieee80211_recalc_txpower"]}
{"id": "95061", "title": "Laptop will not shutdown after suspend to disk (regression)", "description": "Created attachment 171081 [details]\ndmesg output\n\nHi,\n\nSince kernel 3.19 (including 3.19.1) the system (Laptop FSC S7110) will not correctly shut down when suspending to disk (echo disk > /sys/power/state). The power-LED is still on and the fan keeps whirling. However, the hibernation image is created successfully. After pulling the plug and powering the system on, it will boot into the hibernated image without problems. I didn't ran into this problem with a former kernel as far as I can remember but 4.0-rc4 has the same issue. Suspend to RAM, shutdown and reboot all work as expected.\n\ncat /sys/power/disk\n[platform] shutdown reboot suspend\n\nRegards,\nDirk", "patch": ["--- a/drivers/gpu/drm/i915/i915_drv.c\t2015-05-06 22:04:23.000000000 +0200\n+++ b/drivers/gpu/drm/i915/i915_drv.c\t2015-05-12 07:17:49.920570733 +0200\n@@ -622,6 +622,22 @@\n \treturn 0;\n }\n \n+bool i915_hibernate_needs_quirk(struct drm_device *dev)\n+{\n+\tswitch (dev->pdev->subsystem_vendor) {\n+\t\tcase 0x10cf:\n+\t\t\t/* Fujitsu Limited.*/\n+\t\t\treturn (IS_GEN3(dev));\n+\t\tcase PCI_VENDOR_ID_AI:\n+\t\t\treturn (IS_GEN5(dev));\n+\t\tcase PCI_VENDOR_ID_LENOVO:\n+\t\tcase PCI_SUBVENDOR_ID_IBM:\n+\t\t\treturn (INTEL_INFO(dev)->gen < 7);\n+\t}\n+\n+\treturn false;\n+}\n+\n static int i915_drm_suspend_late(struct drm_device *drm_dev, bool hibernation)\n {\n \tstruct drm_i915_private *dev_priv = drm_dev->dev_private;\n@@ -637,15 +653,15 @@\n \n \tpci_disable_device(drm_dev->pdev);\n \t/*\n-\t * During hibernation on some GEN4 platforms the BIOS may try to access\n+\t * During hibernation on some platforms the BIOS may try to access\n \t * the device even though it's already in D3 and hang the machine. So\n \t * leave the device in D0 on those platforms and hope the BIOS will\n \t * power down the device properly. Platforms where this was seen:\n-\t * Lenovo Thinkpad X301, X61s\n+\t * Lenovo Thinkpad X301, X61s, X41, T520\n+\t * FSC Lifebook S7110\n+\t * Acer Aspire 1830T\n \t */\n-\tif (!(hibernation &&\n-\t      drm_dev->pdev->subsystem_vendor == PCI_VENDOR_ID_LENOVO &&\n-\t      INTEL_INFO(dev_priv)->gen == 4))\n+\tif (!(hibernation && i915_hibernate_needs_quirk(drm_dev)))\n \t\tpci_set_power_state(drm_dev->pdev, PCI_D3hot);\n \n \treturn 0;\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Video", "Hardware": "Intel Linux", "Importance": "P1 normal", "Assignee": "Imre Deak", "URL": "", "Keywords": "", "Duplicates (1)": "99941", "Depends on": "", "Blocks": "", "Reported": "2015-03-18 12:12 UTC by Dirk Griesbach", "Modified": "2015-12-21 19:25 UTC", "CC List": "7 users", "See Also": "", "Kernel Version": "3.19", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/gpu/drm/i915/i915_drv.c"], "methods": ["i915_drm_suspend_late", "i915_hibernate_needs_quirk"]}
{"id": "94411", "title": "Unwanted delayed execution of _Qxx EC methods", "description": "Created attachment 169541 [details]\ndmesg when function keys are pressed\n\nMy laptop (XPS13 9333) has two function keys to control the screen brightness. When pressed, two _Qxx ACPI methods are called, one to increase and one to decrease the brightness. Both the methods sleep for 200ms.\n\nThis pause of 200ms is causing some problems when I keep one of the function keys pressed. In this situation, more queries than needed are scheduled for a delayed execution, making the screen brightness change even after the function key is released. If I keep the function key pressed for X seconds, it will take roughly 2X seconds for all the queries to be executed.\n\nHere attached see some log lines that show the problem.", "patch": ["From 05a5a68b209d57c2b2e9e8aba1fa6365ec40c52c Mon Sep 17 00:00:00 2001\nMessage-Id: <05a5a68b209d57c2b2e9e8aba1fa6365ec40c52c.1438924516.git.lv.zheng@intel.com>\nIn-Reply-To: <d2029b78c1e914d0c05b28c406a88057858b8a42.1434001323.git.lv.zheng@intel.com>\nReferences: <d2029b78c1e914d0c05b28c406a88057858b8a42.1434001323.git.lv.zheng@intel.com>\nFrom: Lv Zheng <lv.zheng@intel.com>\nDate: Fri, 7 Aug 2015 10:48:41 +0800\nSubject: [PATCH v2] ACPI / EC: Fix an issue caused by the serialized _Qxx\n evaluations.\n\nIt is proven that Windows evaluates _Qxx handlers in a parallel way. This\npatch follows this fact, splits _Qxx evaluations from the NOTIFY queue to\nform a separate queue, so that _Qxx evaluations can be queued up on\ndifferent CPUs rather than being queued up on a CPU0 bound queue.\nEvent handling related callbacks are also renamed and sorted in this patch.\n\nLink: https://bugzilla.kernel.org/show_bug.cgi?id=94411\nReported-by: Gabriele Mazzotta <gabriele.mzt@gmail.com>\nSigned-off-by: Lv Zheng <lv.zheng@intel.com>\n---\n drivers/acpi/ec.c |   76 ++++++++++++++++++++++++++++++++++++++---------------\n 1 file changed, 55 insertions(+), 21 deletions(-)\n\nIndex: linux-acpica/drivers/acpi/ec.c\n===================================================================\n--- linux-acpica.orig/drivers/acpi/ec.c\n+++ linux-acpica/drivers/acpi/ec.c\n@@ -161,8 +161,16 @@ struct transaction {\n \tu8 flags;\n };\n \n+struct acpi_ec_query {\n+\tstruct transaction transaction;\n+\tstruct work_struct work;\n+\tstruct acpi_ec_query_handler *handler;\n+};\n+\n static int acpi_ec_query(struct acpi_ec *ec, u8 *data);\n static void advance_transaction(struct acpi_ec *ec);\n+static void acpi_ec_event_handler(struct work_struct *work);\n+static void acpi_ec_event_processor(struct work_struct *work);\n \n struct acpi_ec *boot_ec, *first_ec;\n EXPORT_SYMBOL(first_ec);\n@@ -974,60 +982,90 @@ void acpi_ec_remove_query_handler(struct\n }\n EXPORT_SYMBOL_GPL(acpi_ec_remove_query_handler);\n \n-static void acpi_ec_run(void *cxt)\n+static struct acpi_ec_query *acpi_ec_create_query(u8 *pval)\n {\n-\tstruct acpi_ec_query_handler *handler = cxt;\n+\tstruct acpi_ec_query *q;\n+\tstruct transaction *t;\n+\n+\tq = kzalloc(sizeof (struct acpi_ec_query), GFP_KERNEL);\n+\tif (!q)\n+\t\treturn NULL;\n+\tINIT_WORK(&q->work, acpi_ec_event_processor);\n+\tt = &q->transaction;\n+\tt->command = ACPI_EC_COMMAND_QUERY;\n+\tt->rdata = pval;\n+\tt->rlen = 1;\n+\treturn q;\n+}\n+\n+static void acpi_ec_delete_query(struct acpi_ec_query *q)\n+{\n+\tif (q) {\n+\t\tif (q->handler)\n+\t\t\tacpi_ec_put_query_handler(q->handler);\n+\t\tkfree(q);\n+\t}\n+}\n+\n+static void acpi_ec_event_processor(struct work_struct *work)\n+{\n+\tstruct acpi_ec_query *q = container_of(work, struct acpi_ec_query, work);\n+\tstruct acpi_ec_query_handler *handler = q->handler;\n \n-\tif (!handler)\n-\t\treturn;\n \tec_dbg_evt(\"Query(0x%02x) started\", handler->query_bit);\n \tif (handler->func)\n \t\thandler->func(handler->data);\n \telse if (handler->handle)\n \t\tacpi_evaluate_object(handler->handle, NULL, NULL, NULL);\n \tec_dbg_evt(\"Query(0x%02x) stopped\", handler->query_bit);\n-\tacpi_ec_put_query_handler(handler);\n+\tacpi_ec_delete_query(q);\n }\n \n static int acpi_ec_query(struct acpi_ec *ec, u8 *data)\n {\n \tu8 value = 0;\n \tint result;\n-\tacpi_status status;\n \tstruct acpi_ec_query_handler *handler;\n-\tstruct transaction t = {.command = ACPI_EC_COMMAND_QUERY,\n-\t\t\t\t.wdata = NULL, .rdata = &value,\n-\t\t\t\t.wlen = 0, .rlen = 1};\n+\tstruct acpi_ec_query *q;\n+\n+\tq = acpi_ec_create_query(&value);\n+\tif (!q)\n+\t\treturn -ENOMEM;\n \n \t/*\n \t * Query the EC to find out which _Qxx method we need to evaluate.\n \t * Note that successful completion of the query causes the ACPI_EC_SCI\n \t * bit to be cleared (and thus clearing the interrupt source).\n \t */\n-\tresult = acpi_ec_transaction(ec, &t);\n-\tif (result)\n-\t\treturn result;\n-\tif (data)\n-\t\t*data = value;\n+\tresult = acpi_ec_transaction(ec, &q->transaction);\n \tif (!value)\n-\t\treturn -ENODATA;\n+\t\tresult = -ENODATA;\n+\tif (result)\n+\t\tgoto err_exit;\n \n \tmutex_lock(&ec->mutex);\n \tlist_for_each_entry(handler, &ec->list, node) {\n \t\tif (value == handler->query_bit) {\n-\t\t\t/* have custom handler for this bit */\n-\t\t\thandler = acpi_ec_get_query_handler(handler);\n+\t\t\tq->handler = acpi_ec_get_query_handler(handler);\n \t\t\tec_dbg_evt(\"Query(0x%02x) scheduled\",\n-\t\t\t\t   handler->query_bit);\n-\t\t\tstatus = acpi_os_execute((handler->func) ?\n-\t\t\t\tOSL_NOTIFY_HANDLER : OSL_GPE_HANDLER,\n-\t\t\t\tacpi_ec_run, handler);\n-\t\t\tif (ACPI_FAILURE(status))\n+\t\t\t\t   q->handler->query_bit);\n+\t\t\t/*\n+\t\t\t * It is reported that _Qxx are evaluated in a\n+\t\t\t * parallel way on Windows:\n+\t\t\t * https://bugzilla.kernel.org/show_bug.cgi?id=94411\n+\t\t\t */\n+\t\t\tif (!schedule_work(&q->work))\n \t\t\t\tresult = -EBUSY;\n \t\t\tbreak;\n \t\t}\n \t}\n \tmutex_unlock(&ec->mutex);\n+\n+err_exit:\n+\tif (result && q)\n+\t\tacpi_ec_delete_query(q);\n+\tif (data)\n+\t\t*data = value;\n \treturn result;\n }\n \n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "EC", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Lv Zheng", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2015-03-06 12:39 UTC by Gabriele Mazzotta", "Modified": "2015-09-14 05:47 UTC", "CC List": "6 users", "See Also": "", "Kernel Version": "3.19", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/acpi/ec.c"], "methods": ["acpi_ec_query"]}
{"id": "90521", "title": "Asus t100ta Buttons not working", "description": "Hello the side buttons for volume on the Asust100 baytrail are not working properly they are being detected by the crystalcove-gpio \n\n  \n265:          0          0          0          0  Crystal Cove    5  gpio_crystalcove\n 266:          0          0          0          0  Crystal Cove    0  volume_up\n 267:          0          0          0          0  Crystal Cove    1  volume_down\n 273:          0          0          0          0  Crystal Cove    7  rotation_lock\n 274:          0          0          0          0  Crystal Cove    8  home\n 360:         17          0   \n\nhowever when i push the volune buttons i get the following error message\n\n 4089.639205] WARNING: CPU: 2 PID: 72 at kernel/irq/manage.c:661 irq_nested_primary_handler+0x2c/0x30()\n[ 4089.639216] Primary handler called for nested irq 267\n[ 4089.639224] Modules linked in: hci_uart joydev snd_soc_sst_baytrail_pcm asus_nb_wmi gpio_keys asus_wmi hid_generic sparse_keymap snd_soc_sst_dsp snd_soc_sst_byt_rt5640_mach intel_rapl intel_powerclamp coretemp kvm_intel kvm crc32_pclmul brcmfmac aesni_intel xts brcmutil aes_i586 cfg80211 lrw snd_intel_sst_acpi gf128mul i915 ablk_helper snd_soc_rt5640 snd_intel_sst_core cryptd snd_soc_rl6231 snd_soc_sst_mfld_platform snd_soc_core snd_compress drm_kms_helper usbhid snd_pcm_dmaengine snd_seq_midi drm mei_txe i2c_algo_bit lpc_ich hid_multitouch mei snd_pcm iosf_mbi snd_seq_midi_event snd_rawmidi wmi mac_hid 8250_fintek snd_seq soc_button_array int3400_thermal snd_seq_device ak8975 acpi_thermal_rel int3402_thermal processor_thermal_device int3403_thermal video acpi_pad snd_timer industrialio snd soundcore\n[ 4089.639466]  bnep snd_soc_sst_acpi rfkill_gpio rfcomm bluetooth 8250_dw spi_pxa2xx_platform pwm_lpss_platform parport_pc ppdev lp parport nls_iso8859_1 uas usb_storage mmc_block sdhci_acpi sdhci\n[ 4089.639543] CPU: 2 PID: 72 Comm: irq/67-Crystal  Tainted: G        W       3.19.0-rc2-next-20141231 #1\n[ 4089.639554] Hardware name: ASUSTeK COMPUTER INC. T100TA/T100TA, BIOS T100TA.313 08/13/2014\n[ 4089.639564]  00000002 00000000 c24fbdf4 c16e0257 c24fbe38 c24fbe28 c105390c c18ec480\n[ 4089.639596]  c24fbe54 00000048 c18f8e3b 00000295 c10a60fc 00000295 c10a60fc f4464540\n[ 4089.639626]  f446459c c278ad40 c24fbe40 c1053974 00000009 c24fbe38 c18ec480 c24fbe54\n[ 4089.639656] Call Trace:\n[ 4089.639685]  [<c16e0257>] dump_stack+0x41/0x52\n[ 4089.639707]  [<c105390c>] warn_slowpath_common+0x8c/0xc0\n[ 4089.639727]  [<c10a60fc>] ? irq_nested_primary_handler+0x2c/0x30\n[ 4089.639744]  [<c10a60fc>] ? irq_nested_primary_handler+0x2c/0x30\n[ 4089.639763]  [<c1053974>] warn_slowpath_fmt+0x34/0x40\n[ 4089.639781]  [<c10a60fc>] irq_nested_primary_handler+0x2c/0x30\n[ 4089.639800]  [<c10a5c56>] handle_irq_event_percpu+0x76/0x190\n[ 4089.639818]  [<c1461570>] ? regmap_format_10_14_write+0x30/0x30\n[ 4089.639836]  [<c1464f4c>] ? _regmap_bus_raw_write+0x4c/0x70\n[ 4089.639854]  [<c10a5da1>] handle_irq_event+0x31/0x50\n[ 4089.639872]  [<c10a83eb>] handle_simple_irq+0x4b/0x70\n[ 4089.639889]  [<c10a5384>] generic_handle_irq+0x24/0x40\n[ 4089.639908]  [<c1366d87>] crystalcove_gpio_irq_handler+0xa7/0xc0\n[ 4089.639927]  [<c10a85a7>] handle_nested_irq+0x77/0x190\n[ 4089.639947]  [<c1469801>] regmap_irq_thread+0x1b1/0x360\n[ 4089.639966]  [<c10a6ae8>] irq_thread_fn+0x18/0x30\n[ 4089.639983]  [<c10a6906>] irq_thread+0xf6/0x110\n[ 4089.640001]  [<c10a6ad0>] ? irq_finalize_oneshot.part.30+0x1b0/0x1b0\n[ 4089.640019]  [<c10a6b50>] ? irq_forced_thread_fn+0x50/0x50\n[ 4089.640037]  [<c10a6810>] ? irq_thread_check_affinity+0xc0/0xc0\n[ 4089.640054]  [<c106f389>] kthread+0xa9/0xc0\n[ 4089.640074]  [<c16e6401>] ret_from_kernel_thread+0x21/0x30\n[ 4089.640091]  [<c106f2e0>] ? kthread_create_on_node+0x110/0x110\n[ 4089.640105] ---[ end trace dca7946ad31eba7d ]---\n[ 4089.640113] ------------[ cut here ]------------\n[ 4089.640131] WARNING: CPU: 2 PID: 72 at kernel/irq/handle.c:147 handle_irq_event_percpu+0x17a/0x190()\n[ 4089.640147] irq 267 handler irq_nested_primary_handler+0x0/0x30 enabled interrupts\n[ 4089.640154] Modules linked in: hci_uart joydev snd_soc_sst_baytrail_pcm asus_nb_wmi gpio_keys asus_wmi hid_generic sparse_keymap snd_soc_sst_dsp snd_soc_sst_byt_rt5640_mach intel_rapl intel_powerclamp coretemp kvm_intel kvm crc32_pclmul brcmfmac aesni_intel xts brcmutil aes_i586 cfg80211 lrw snd_intel_sst_acpi gf128mul i915 ablk_helper snd_soc_rt5640 snd_intel_sst_core cryptd snd_soc_rl6231 snd_soc_sst_mfld_platform snd_soc_core snd_compress drm_kms_helper usbhid snd_pcm_dmaengine snd_seq_midi drm mei_txe i2c_algo_bit lpc_ich hid_multitouch mei snd_pcm iosf_mbi snd_seq_midi_event snd_rawmidi wmi mac_hid 8250_fintek snd_seq soc_button_array int3400_thermal snd_seq_device ak8975 acpi_thermal_rel int3402_thermal processor_thermal_device int3403_thermal video acpi_pad snd_timer industrialio snd soundcore\n[ 4089.640373]  bnep snd_soc_sst_acpi rfkill_gpio rfcomm bluetooth 8250_dw spi_pxa2xx_platform pwm_lpss_platform parport_pc ppdev lp parport nls_iso8859_1 uas usb_storage mmc_block sdhci_acpi sdhci\n[ 4089.640442] CPU: 2 PID: 72 Comm: irq/67-Crystal  Tainted: G        W       3.19.0-rc2-next-20141231 #1\n[ 4089.640452] Hardware name: ASUSTeK COMPUTER INC. T100TA/T100TA, BIOS T100TA.313 08/13/2014\n[ 4089.640461]  00000002 00000000 c24fbe0c c16e0257 c24fbe50 c24fbe40 c105390c c18ec3e8\n[ 4089.640491]  c24fbe6c 00000048 c18f8e27 00000093 c10a5d5a 00000093 c10a5d5a f4464540\n[ 4089.640521]  f446459c c278ad40 c24fbe58 c1053974 00000009 c24fbe50 c18ec3e8 c24fbe6c\n[ 4089.640550] Call Trace:\n[ 4089.640571]  [<c16e0257>] dump_stack+0x41/0x52\n[ 4089.640591]  [<c105390c>] warn_slowpath_common+0x8c/0xc0\n[ 4089.640610]  [<c10a5d5a>] ? handle_irq_event_percpu+0x17a/0x190\n[ 4089.640627]  [<c10a5d5a>] ? handle_irq_event_percpu+0x17a/0x190\n[ 4089.640646]  [<c1053974>] warn_slowpath_fmt+0x34/0x40\n[ 4089.640664]  [<c10a5d5a>] handle_irq_event_percpu+0x17a/0x190\n[ 4089.640682]  [<c10a60d0>] ? irq_set_irq_wake+0x100/0x100\n[ 4089.640700]  [<c10a5da1>] handle_irq_event+0x31/0x50\n[ 4089.640718]  [<c10a83eb>] handle_simple_irq+0x4b/0x70\n[ 4089.640735]  [<c10a5384>] generic_handle_irq+0x24/0x40\n[ 4089.640752]  [<c1366d87>] crystalcove_gpio_irq_handler+0xa7/0xc0\n[ 4089.640770]  [<c10a85a7>] handle_nested_irq+0x77/0x190\n[ 4089.640790]  [<c1469801>] regmap_irq_thread+0x1b1/0x360\n[ 4089.640809]  [<c10a6ae8>] irq_thread_fn+0x18/0x30\n[ 4089.640826]  [<c10a6906>] irq_thread+0xf6/0x110\n[ 4089.640844]  [<c10a6ad0>] ? irq_finalize_oneshot.part.30+0x1b0/0x1b0\n[ 4089.640862]  [<c10a6b50>] ? irq_forced_thread_fn+0x50/0x50\n[ 4089.640880]  [<c10a6810>] ? irq_thread_check_affinity+0xc0/0xc0\n[ 4089.640896]  [<c106f389>] kthread+0xa9/0xc0\n[ 4089.640915]  [<c16e6401>] ret_from_kernel_thread+0x21/0x30\n[ 4089.640933]  [<c106f2e0>] ? kthread_create_on_node+0x110/0x110\n[ 4089.640945] ---[ end trace dca7946ad31eba7e ]---\n[ 4089.943279] ------------[ cut here ]------------\n[ 4089.943320] WARNING: CPU: 2 PID: 72 at kernel/irq/manage.c:661 irq_nested_primary_handler+0x2c/0x30()\n[ 4089.943331] Primary handler called for nested irq 267\n[ 4089.943340] Modules linked in: hci_uart joydev snd_soc_sst_baytrail_pcm asus_nb_wmi gpio_keys asus_wmi hid_generic sparse_keymap snd_soc_sst_dsp snd_soc_sst_byt_rt5640_mach intel_rapl intel_powerclamp coretemp kvm_intel kvm crc32_pclmul brcmfmac aesni_intel xts brcmutil aes_i586 cfg80211 lrw snd_intel_sst_acpi gf128mul i915 ablk_helper snd_soc_rt5640 snd_intel_sst_core cryptd snd_soc_rl6231 snd_soc_sst_mfld_platform snd_soc_core snd_compress drm_kms_helper usbhid snd_pcm_dmaengine snd_seq_midi drm mei_txe i2c_algo_bit lpc_ich hid_multitouch mei snd_pcm iosf_mbi snd_seq_midi_event snd_rawmidi wmi mac_hid 8250_fintek snd_seq soc_button_array int3400_thermal snd_seq_device ak8975 acpi_thermal_rel int3402_thermal processor_thermal_device int3403_thermal video acpi_pad snd_timer industrialio snd soundcore\n[ 4089.943580]  bnep snd_soc_sst_acpi rfkill_gpio rfcomm bluetooth 8250_dw spi_pxa2xx_platform pwm_lpss_platform parport_pc ppdev lp parport nls_iso8859_1 uas usb_storage mmc_block sdhci_acpi sdhci\n[ 4089.943657] CPU: 2 PID: 72 Comm: irq/67-Crystal  Tainted: G        W       3.19.0-rc2-next-20141231 #1\n[ 4089.943668] Hardware name: ASUSTeK COMPUTER INC. T100TA/T100TA, BIOS T100TA.313 08/13/2014\n[ 4089.943678]  00000002 00000000 c24fbdf4 c16e0257 c24fbe38 c24fbe28 c105390c c18ec480\n[ 4089.943710]  c24fbe54 00000048 c18f8e3b 00000295 c10a60fc 00000295 c10a60fc f4464540\n[ 4089.943740]  f446459c c278ad40 c24fbe40 c1053974 00000009 c24fbe38 c18ec480 c24fbe54\n[ 4089.943770] Call Trace:\n[ 4089.943799]  [<c16e0257>] dump_stack+0x41/0x52\n[ 4089.943821]  [<c105390c>] warn_slowpath_common+0x8c/0xc0\n[ 4089.943842]  [<c10a60fc>] ? irq_nested_primary_handler+0x2c/0x30\n[ 4089.943859]  [<c10a60fc>] ? irq_nested_primary_handler+0x2c/0x30\n[ 4089.943878]  [<c1053974>] warn_slowpath_fmt+0x34/0x40\n[ 4089.943896]  [<c10a60fc>] irq_nested_primary_handler+0x2c/0x30\n[ 4089.943914]  [<c10a5c56>] handle_irq_event_percpu+0x76/0x190\n[ 4089.943933]  [<c1461570>] ? regmap_format_10_14_write+0x30/0x30\n[ 4089.943951]  [<c1464f4c>] ? _regmap_bus_raw_write+0x4c/0x70\n[ 4089.943969]  [<c10a5da1>] handle_irq_event+0x31/0x50\n[ 4089.943987]  [<c10a83eb>] handle_simple_irq+0x4b/0x70\n[ 4089.944005]  [<c10a5384>] generic_handle_irq+0x24/0x40\n[ 4089.944024]  [<c1366d87>] crystalcove_gpio_irq_handler+0xa7/0xc0\n[ 4089.944042]  [<c10a85a7>] handle_nested_irq+0x77/0x190\n[ 4089.944062]  [<c1469801>] regmap_irq_thread+0x1b1/0x360\n[ 4089.944081]  [<c10a6ae8>] irq_thread_fn+0x18/0x30\n[ 4089.944098]  [<c10a6906>] irq_thread+0xf6/0x110\n[ 4089.944116]  [<c10a6ad0>] ? irq_finalize_oneshot.part.30+0x1b0/0x1b0\n[ 4089.944134]  [<c10a6b50>] ? irq_forced_thread_fn+0x50/0x50\n[ 4089.944152]  [<c10a6810>] ? irq_thread_check_affinity+0xc0/0xc0\n[ 4089.944170]  [<c106f389>] kthread+0xa9/0xc0\n[ 4089.944190]  [<c16e6401>] ret_from_kernel_thread+0x21/0x30\n[ 4089.944207]  [<c106f2e0>] ? kthread_create_on_node+0x110/0x110\n[ 4089.944221] ---[ end trace dca7946ad31eba7f ]---\n\nperhaps the pins need to be assigned the correct values??\n\nThank you", "patch": ["From c4719c161bd3ed8dfcbac7562561739ec6968a3b Mon Sep 17 00:00:00 2001\nFrom: Aaron Lu <aaron.lu@intel.com>\nDate: Fri, 9 Jan 2015 14:05:47 +0800\nSubject: [PATCH] gpio: crystalcove: use handle_nested_irq\n\nThe CrystalCove GPIO chip has can_sleep set so its demultiplexed irqs\nwill have IRQ_NESTED_THREAD flag set, thus we should use the nested\nversion handle_nested_irq in CrystalCove's irq handler instead of\nhandle_generic_irq, or the following warning will be hit and the\nfunctionality is lost:\n\n[ 4089.639554] Hardware name: ASUSTeK COMPUTER INC. T100TA/T100TA, BIOS T100TA.313 08/13/2014\n[ 4089.639564]  00000002 00000000 c24fbdf4 c16e0257 c24fbe38 c24fbe28 c105390c c18ec480\n[ 4089.639596]  c24fbe54 00000048 c18f8e3b 00000295 c10a60fc 00000295 c10a60fc f4464540\n[ 4089.639626]  f446459c c278ad40 c24fbe40 c1053974 00000009 c24fbe38 c18ec480 c24fbe54\n[ 4089.639656] Call Trace:\n[ 4089.639685]  [<c16e0257>] dump_stack+0x41/0x52\n[ 4089.639707]  [<c105390c>] warn_slowpath_common+0x8c/0xc0\n[ 4089.639727]  [<c10a60fc>] ? irq_nested_primary_handler+0x2c/0x30\n[ 4089.639744]  [<c10a60fc>] ? irq_nested_primary_handler+0x2c/0x30\n[ 4089.639763]  [<c1053974>] warn_slowpath_fmt+0x34/0x40\n[ 4089.639781]  [<c10a60fc>] irq_nested_primary_handler+0x2c/0x30\n[ 4089.639800]  [<c10a5c56>] handle_irq_event_percpu+0x76/0x190\n[ 4089.639818]  [<c1461570>] ? regmap_format_10_14_write+0x30/0x30\n[ 4089.639836]  [<c1464f4c>] ? _regmap_bus_raw_write+0x4c/0x70\n[ 4089.639854]  [<c10a5da1>] handle_irq_event+0x31/0x50\n[ 4089.639872]  [<c10a83eb>] handle_simple_irq+0x4b/0x70\n[ 4089.639889]  [<c10a5384>] generic_handle_irq+0x24/0x40\n[ 4089.639908]  [<c1366d87>] crystalcove_gpio_irq_handler+0xa7/0xc0\n[ 4089.639927]  [<c10a85a7>] handle_nested_irq+0x77/0x190\n[ 4089.639947]  [<c1469801>] regmap_irq_thread+0x1b1/0x360\n[ 4089.639966]  [<c10a6ae8>] irq_thread_fn+0x18/0x30\n[ 4089.639983]  [<c10a6906>] irq_thread+0xf6/0x110\n[ 4089.640001]  [<c10a6ad0>] ? irq_finalize_oneshot.part.30+0x1b0/0x1b0\n[ 4089.640019]  [<c10a6b50>] ? irq_forced_thread_fn+0x50/0x50\n[ 4089.640037]  [<c10a6810>] ? irq_thread_check_affinity+0xc0/0xc0\n[ 4089.640054]  [<c106f389>] kthread+0xa9/0xc0\n[ 4089.640074]  [<c16e6401>] ret_from_kernel_thread+0x21/0x30\n[ 4089.640091]  [<c106f2e0>] ? kthread_create_on_node+0x110/0x110\n[ 4089.640105] ---[ end trace dca7946ad31eba7d ]---\n\nBuglink: https://bugzilla.kernel.org/show_bug.cgi?id=90521\nReported-by: Brian Loften <bloften80@gmail.com>\nSigned-off-by: Aaron Lu <aaron.lu@intel.com>\n---\n drivers/gpio/gpio-crystalcove.c | 2 +-\n 1 file changed, 1 insertion(+), 1 deletion(-)\n\ndiff --git a/drivers/gpio/gpio-crystalcove.c b/drivers/gpio/gpio-crystalcove.c\nindex 55d4803d71b0..3d9e08f7e823 100644\n--- a/drivers/gpio/gpio-crystalcove.c\n+++ b/drivers/gpio/gpio-crystalcove.c\n@@ -272,7 +272,7 @@ static irqreturn_t crystalcove_gpio_irq_handler(int irq, void *data)\n \tfor (gpio = 0; gpio < CRYSTALCOVE_GPIO_NUM; gpio++) {\n \t\tif (pending & BIT(gpio)) {\n \t\t\tvirq = irq_find_mapping(cg->chip.irqdomain, gpio);\n-\t\t\tgeneric_handle_irq(virq);\n+\t\t\thandle_nested_irq(virq);\n \t\t}\n \t}\n \n-- \n1.9.3\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "Config-Interrupts", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Aaron Lu", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2014-12-31 15:23 UTC by Brian Loften", "Modified": "2015-01-20 08:09 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "3.19-rc2", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/gpio/gpio-crystalcove.c"], "methods": ["crystalcove_gpio_irq_handler"]}
{"id": "84561", "title": "[ivb] Intel backlight does not adjust, but only turns on/off in kernel 3.16 on Samsung 880Z5E laptop", "description": "Hi!\n\nAfter upgrading from kernel 3.14 to 3.16 on a Samsung 880Z5E laptop (with dual Intel HD 4000 and Radeon 8770M cards), the intermediate % of backlight don't work.\n\nI.e. /sys/class/backlight/intel_backlight is there with max_brightness=4882 and type=raw, but all brightness levels > 0 result in full brightness, and brightness level = 0 results in the screen turned off. The same is on the brightness adjustment UI: 0% is \"turned off\", everything greater than 0% is full brightness.\n\n(although when the screen is turned on after being turned off, the backlight turns on smoothly)\n\nacpi_backlight=vendor and video.use_native_backlight=1 also don't work.\n\nWhat other details do you need? acpidump, dmidecode?", "patch": ["From f39714124f8e57b7dd119407e3361bdf0c93596c Mon Sep 17 00:00:00 2001\nFrom: Aaron Lu <aaron.lu@intel.com>\nDate: Tue, 9 Dec 2014 13:04:36 +0800\nSubject: [PATCH] ACPI / video: Add some samsung models to\n disable_native_backlight list\n\nThe SAMSUNG 870Z5E/880Z5E/680Z5E and SAMSUNG\n370R4E/370R4V/370R5E/3570RE/370R5V do not have a working native\nbacklight control interface so restore their acpi_videoX interface.\n\nBuglink: https://bugzilla.kernel.org/show_bug.cgi?id=84221\nBuglink: https://bugzilla.kernel.org/show_bug.cgi?id=84651\nReported-and-tested-by: Brent Saner <brent.saner@gmail.com>\nReported-and-tested-by: Vitaliy Filippov <vitalif@yourcmc.ru>\nReported-and-tested-by: Laszlo KREKACS <laszlo.krekacs.list@gmail.com>\nReported-and-tested-by: Vladimir Perepechin <vovochka13@gmail.com>\nSigned-off-by: Aaron Lu <aaron.lu@intel.com>\n---\n drivers/acpi/video.c | 17 +++++++++++++++++\n 1 file changed, 17 insertions(+)\n\ndiff --git a/drivers/acpi/video.c b/drivers/acpi/video.c\nindex 185a57d13723..8b844931b936 100644\n--- a/drivers/acpi/video.c\n+++ b/drivers/acpi/video.c\n@@ -504,6 +504,23 @@ static struct dmi_system_id video_dmi_table[] __initdata = {\n \t\tDMI_MATCH(DMI_PRODUCT_NAME, \"HP ENVY 15 Notebook PC\"),\n \t\t},\n \t},\n+\n+\t{\n+\t .callback = video_disable_native_backlight,\n+\t .ident = \"SAMSUNG 870Z5E/880Z5E/680Z5E\",\n+\t .matches = {\n+\t\tDMI_MATCH(DMI_SYS_VENDOR, \"SAMSUNG ELECTRONICS CO., LTD.\"),\n+\t\tDMI_MATCH(DMI_PRODUCT_NAME, \"870Z5E/880Z5E/680Z5E\"),\n+\t\t},\n+\t},\n+\t{\n+\t .callback = video_disable_native_backlight,\n+\t .ident = \"SAMSUNG 370R4E/370R4V/370R5E/3570RE/370R5V\",\n+\t .matches = {\n+\t\tDMI_MATCH(DMI_SYS_VENDOR, \"SAMSUNG ELECTRONICS CO., LTD.\"),\n+\t\tDMI_MATCH(DMI_PRODUCT_NAME, \"370R4E/370R4V/370R5E/3570RE/370R5V\"),\n+\t\t},\n+\t},\n \t{}\n };\n \n-- \n1.9.3\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "Power-Video", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Aaron Lu", "URL": "", "Keywords": "", "Duplicates (1)": "84221", "Depends on": "", "Blocks": "", "Reported": "2014-09-14 10:39 UTC by Vitaliy Filippov", "Modified": "2015-05-17 20:30 UTC", "CC List": "8 users", "See Also": "", "Kernel Version": "3.16.2", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/acpi/video.c"], "methods": ["video_dmi_table"]}
{"id": "84111", "title": "HP Pavilion dv6-3182 shows at least one additional backlight interface", "description": "My HP Pavilion dv6-3182 laptop shows three interfaces in /sys/class/backlight: acpi_video0, acpi_video1 and radeon_bl0.\n\nradeon_bl0 only appears when the radeon driver is used (i.e. not if fglrx is used).\n\nBoth acpi_video0 and radeon_bl0 control the brightness of the screen, but acpi_video0 has 11 brightness levels whilst radeon_bl0 has 256.\n\nAs far as I know, acpi_video1 has no purpose. Writing to its brightness file doesn't do anything, but it causes problems to desktop environments that choose it over the other options.", "patch": ["diff --git a/drivers/acpi/video.c b/drivers/acpi/video.c\nindex fcbda105616e..c3897fe53cb4 100644\n--- a/drivers/acpi/video.c\n+++ b/drivers/acpi/video.c\n@@ -1407,10 +1407,30 @@ acpi_video_device_bind(struct acpi_video_bus *video,\n \t\tif (device->device_id == (ids->value.int_val & 0xffff)) {\n \t\t\tids->bind_info = device;\n \t\t\tACPI_DEBUG_PRINT((ACPI_DB_INFO, \"device_bind %d\\n\", i));\n+\t\t\tdev_info(&device->dev->dev, \"bound video output device _ADR: 0x%x\\n\", device->device_id);\n \t\t}\n \t}\n }\n \n+static bool acpi_video_device_in_dod(struct acpi_video_device *device)\n+{\n+\tstruct acpi_video_bus *video = device->video;\n+\tint i;\n+\n+\t/* If we have a broken _DOD, no need to test */\n+\tif (!video->attached_count) {\n+\t\tdev_info(&video->device->dev, \"broken _DOD\\n\");\n+\t\treturn true;\n+\t}\n+\n+\tfor (i = 0; i < video->attached_count; i++) {\n+\t\tif (video->attached_array[i].bind_info == device)\n+\t\t\treturn true;\n+\t}\n+\n+\treturn false;\n+}\n+\n /*\n  *  Arg:\n  *\tvideo\t: video bus device\n@@ -1468,8 +1488,8 @@ static int acpi_video_device_enumerate(struct acpi_video_bus *video)\n \n \t\tactive_list[count].value.int_val = obj->integer.value;\n \t\tactive_list[count].bind_info = NULL;\n-\t\tACPI_DEBUG_PRINT((ACPI_DB_INFO, \"dod element[%d] = %d\\n\", i,\n-\t\t\t\t  (int)obj->integer.value));\n+\t\tdev_info(&video->device->dev, \"dod element[%d] = 0x%x\\n\", i,\n+\t\t\t\t  (int)obj->integer.value);\n \t\tcount++;\n \t}\n \n@@ -1850,6 +1870,15 @@ static void acpi_video_dev_register_backlight(struct acpi_video_device *device)\n \tstatic int count;\n \tchar *name;\n \n+\t/*\n+\t * Do not create backlight device for video output\n+\t * device that is not in the enumerated list.\n+\t */\n+\tif (!acpi_video_device_in_dod(device)) {\n+\t\tdev_info(&device->dev->dev, \"not in _DOD list, ignore\\n\");\n+\t\treturn;\n+\t}\n+\n \tresult = acpi_video_init_brightness(device);\n \tif (result)\n \t\treturn;\n@@ -1878,6 +1907,8 @@ static void acpi_video_dev_register_backlight(struct acpi_video_device *device)\n \tif (IS_ERR(device->backlight))\n \t\treturn;\n \n+\tdev_info(&device->dev->dev, \"created backlight device\\n\");\n+\n \t/*\n \t * Save current brightness level in case we have to restore it\n \t * before acpi_video_device_lcd_set_level() is called next time.\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "Power-Video", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Aaron Lu", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2014-09-08 18:37 UTC by Alicia Boya García", "Modified": "2014-12-08 01:44 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "3.13", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/acpi/video.c"], "methods": ["acpi_video_device_bind", "acpi_video_device_enumerate", "acpi_video_dev_register_backlight"]}
{"id": "83151", "title": "Intel Turbo can't be disabled/enabled under certain conditions", "description": "On my laptop (Dell XPS 13 9333) MSR_IA32_MISC_ENABLE_TURBO_DISABLE is 0 when AC is present, 1 otherwise.\nBecause of this, setting turbo_disabled on init leads to some issues:\n* If I turn on the laptop while the AC is present, the sysfs interface always allows me to change the state of no_turbo. However, the changes are only effective when the AC is present.\n* If I turn on the laptop while on battery, the sysfs interface doesn't allow me to change the state of no_turbo. That means I'm not able to disable it when it's automatically enabled when I plug the AC.\n\nNote that I don't have the possibility to disable Intel Turbo from the BIOS settings.", "patch": ["From 626e20b0e4d7db71b265ba662692191590266351 Mon Sep 17 00:00:00 2001\nFrom: Gabriele Mazzotta <gabriele.mzt@gmail.com>\nDate: Sat, 30 Aug 2014 16:52:41 +0200\nSubject: [PATCH] cpufreq: intel_pstate: Don't rely on the initial state of the\n turbo\n\nSome BIOSes modify the state of MSR_IA32_MISC_ENABLE_TURBO_DISABLE\nbased on the current power source for the system battery AC vs\nbattery. Reflect the correct current state and ability to modify the\nsysfs file based on current state of MSR_IA32_MISC_ENABLE_TURBO_DISABLE.\n\nReferences: https://bugzilla.kernel.org/show_bug.cgi?id=83151\n\nSigned-off-by: Gabriele Mazzotta <gabriele.mzt@gmail.com>\nSigned-off-by: Dirk Brandewie <dirk.j.brandewie@intel.com>\n---\n drivers/cpufreq/intel_pstate.c | 49 ++++++++++++++++++++++++++++++------------\n 1 file changed, 35 insertions(+), 14 deletions(-)\n\ndiff --git a/drivers/cpufreq/intel_pstate.c b/drivers/cpufreq/intel_pstate.c\nindex 55c4a60..4830c6a 100644\n--- a/drivers/cpufreq/intel_pstate.c\n+++ b/drivers/cpufreq/intel_pstate.c\n@@ -142,6 +142,7 @@ struct perf_limits {\n \n static struct perf_limits limits = {\n \t.no_turbo = 0,\n+\t.turbo_disabled = 0,\n \t.max_perf_pct = 100,\n \t.max_perf = int_tofp(1),\n \t.min_perf_pct = 0,\n@@ -221,6 +222,18 @@ static inline void intel_pstate_reset_all_pid(void)\n \t}\n }\n \n+static inline void update_turbo_state(void)\n+{\n+\tu64 misc_en;\n+\tstruct cpudata *cpu;\n+\n+\tcpu = all_cpu_data[0];\n+\trdmsrl(MSR_IA32_MISC_ENABLE, misc_en);\n+\tlimits.turbo_disabled = \n+\t\t(misc_en & MSR_IA32_MISC_ENABLE_TURBO_DISABLE ||\n+\t\t cpu->pstate.max_pstate == cpu->pstate.turbo_pstate);\n+}\n+\n /************************** debugfs begin ************************/\n static int pid_param_set(void *data, u64 val)\n {\n@@ -277,6 +290,19 @@ static void __init intel_pstate_debug_expose_params(void)\n \t\treturn sprintf(buf, \"%u\\n\", limits.object);\t\t\\\n \t}\n \n+static ssize_t show_no_turbo(struct kobject *kobj,\n+\t\t\t     struct attribute *attr, char *buf)\n+{\n+\tssize_t ret;\n+\n+\tupdate_turbo_state();\n+\tif (limits.turbo_disabled)\n+\t\tret = sprintf(buf, \"%u\\n\", limits.turbo_disabled);\n+\telse\n+\t\tret = sprintf(buf, \"%u\\n\", limits.no_turbo);\n+\treturn ret; \n+}\n+\n static ssize_t store_no_turbo(struct kobject *a, struct attribute *b,\n \t\t\t      const char *buf, size_t count)\n {\n@@ -286,11 +312,13 @@ static ssize_t store_no_turbo(struct kobject *a, struct attribute *b,\n \tret = sscanf(buf, \"%u\", &input);\n \tif (ret != 1)\n \t\treturn -EINVAL;\n-\tlimits.no_turbo = clamp_t(int, input, 0 , 1);\n-\tif (limits.turbo_disabled) {\n+\n+\tupdate_turbo_state();\n+\tif (limits.turbo_disabled)\n \t\tpr_warn(\"Turbo disabled by BIOS or unavailable on processor\\n\");\n-\t\tlimits.no_turbo = limits.turbo_disabled;\n-\t}\n+\telse\n+\t\tlimits.no_turbo = clamp_t(int, input, 0, 1);\n+\n \treturn count;\n }\n \n@@ -326,7 +354,6 @@ static ssize_t store_min_perf_pct(struct kobject *a, struct attribute *b,\n \treturn count;\n }\n \n-show_one(no_turbo, no_turbo);\n show_one(max_perf_pct, max_perf_pct);\n show_one(min_perf_pct, min_perf_pct);\n \n@@ -504,7 +531,7 @@ static void intel_pstate_get_min_max(struct cpudata *cpu, int *min, int *max)\n \tint max_perf_adj;\n \tint min_perf;\n \n-\tif (limits.no_turbo)\n+\tif (limits.no_turbo || limits.turbo_disabled)\n \t\tmax_perf = cpu->pstate.max_pstate;\n \n \tmax_perf_adj = fp_toint(mul_fp(int_tofp(max_perf), limits.max_perf));\n@@ -519,6 +546,8 @@ static void intel_pstate_set_pstate(struct cpudata *cpu, int pstate)\n {\n \tint max_perf, min_perf;\n \n+\tupdate_turbo_state();\n+\n \tintel_pstate_get_min_max(cpu, &min_perf, &max_perf);\n \n \tpstate = clamp_t(int, pstate, min_perf, max_perf);\n@@ -731,7 +760,6 @@ static int intel_pstate_set_policy(struct cpufreq_policy *policy)\n \t\tlimits.min_perf = int_tofp(1);\n \t\tlimits.max_perf_pct = 100;\n \t\tlimits.max_perf = int_tofp(1);\n-\t\tlimits.no_turbo = limits.turbo_disabled;\n \t\treturn 0;\n \t}\n \tlimits.min_perf_pct = (policy->min * 100) / policy->cpuinfo.max_freq;\n@@ -774,7 +802,6 @@ static int intel_pstate_cpu_init(struct cpufreq_policy *policy)\n {\n \tstruct cpudata *cpu;\n \tint rc;\n-\tu64 misc_en;\n \n \trc = intel_pstate_init_cpu(policy->cpu);\n \tif (rc)\n@@ -782,12 +809,6 @@ static int intel_pstate_cpu_init(struct cpufreq_policy *policy)\n \n \tcpu = all_cpu_data[policy->cpu];\n \n-\trdmsrl(MSR_IA32_MISC_ENABLE, misc_en);\n-\tif (misc_en & MSR_IA32_MISC_ENABLE_TURBO_DISABLE ||\n-\t    cpu->pstate.max_pstate == cpu->pstate.turbo_pstate) {\n-\t\tlimits.turbo_disabled = 1;\n-\t\tlimits.no_turbo = 1;\n-\t}\n \tif (limits.min_perf_pct == 100 && limits.max_perf_pct == 100)\n \t\tpolicy->policy = CPUFREQ_POLICY_PERFORMANCE;\n \telse\n-- \n1.9.3\n\n", "From 858b52341c64d03f2ed7db2f293d6c990b04c6bc Mon Sep 17 00:00:00 2001\nFrom: Gabriele Mazzotta <gabriele.mzt@gmail.com>\nDate: Sat, 30 Aug 2014 16:52:41 +0200\nSubject: [PATCH] cpufreq: intel_pstate: Don't rely on the initial state of the\n turbo\n\nSome BIOSes modify the state of MSR_IA32_MISC_ENABLE_TURBO_DISABLE\nbased on the current power source for the system battery AC vs\nbattery. Reflect the correct current state and ability to modify the\nsysfs file based on current state of MSR_IA32_MISC_ENABLE_TURBO_DISABLE.\n\nReferences: https://bugzilla.kernel.org/show_bug.cgi?id=83151\n\nSigned-off-by: Gabriele Mazzotta <gabriele.mzt@gmail.com>\nSigned-off-by: Dirk Brandewie <dirk.j.brandewie@intel.com>\n---\n drivers/cpufreq/intel_pstate.c | 50 +++++++++++++++++++++++++++++++-----------\n 1 file changed, 37 insertions(+), 13 deletions(-)\n\ndiff --git a/drivers/cpufreq/intel_pstate.c b/drivers/cpufreq/intel_pstate.c\nindex 0668b38..0d807f7 100644\n--- a/drivers/cpufreq/intel_pstate.c\n+++ b/drivers/cpufreq/intel_pstate.c\n@@ -138,6 +138,7 @@ struct perf_limits {\n \n static struct perf_limits limits = {\n \t.no_turbo = 0,\n+\t.turbo_disabled = 0,\n \t.max_perf_pct = 100,\n \t.max_perf = int_tofp(1),\n \t.min_perf_pct = 0,\n@@ -218,6 +219,18 @@ static inline void intel_pstate_reset_all_pid(void)\n \t}\n }\n \n+static inline void update_turbo_state(void)\n+{\n+\tu64 misc_en;\n+\tstruct cpudata *cpu;\n+\n+\tcpu = all_cpu_data[0];\n+\trdmsrl(MSR_IA32_MISC_ENABLE, misc_en);\n+\tlimits.turbo_disabled =\n+\t\t(misc_en & MSR_IA32_MISC_ENABLE_TURBO_DISABLE ||\n+\t\t cpu->pstate.max_pstate == cpu->pstate.turbo_pstate);\n+}\n+\n /************************** debugfs begin ************************/\n static int pid_param_set(void *data, u64 val)\n {\n@@ -274,6 +287,20 @@ static void __init intel_pstate_debug_expose_params(void)\n \t\treturn sprintf(buf, \"%u\\n\", limits.object);\t\t\\\n \t}\n \n+static ssize_t show_no_turbo(struct kobject *kobj,\n+\t\t\t     struct attribute *attr, char *buf)\n+{\n+\tssize_t ret;\n+\n+\tupdate_turbo_state();\n+\tif (limits.turbo_disabled)\n+\t\tret = sprintf(buf, \"%u\\n\", limits.turbo_disabled);\n+\telse\n+\t\tret = sprintf(buf, \"%u\\n\", limits.no_turbo);\n+\n+\treturn ret;\n+}\n+\n static ssize_t store_no_turbo(struct kobject *a, struct attribute *b,\n \t\t\t      const char *buf, size_t count)\n {\n@@ -283,11 +310,14 @@ static ssize_t store_no_turbo(struct kobject *a, struct attribute *b,\n \tret = sscanf(buf, \"%u\", &input);\n \tif (ret != 1)\n \t\treturn -EINVAL;\n-\tlimits.no_turbo = clamp_t(int, input, 0 , 1);\n+\n+\tupdate_turbo_state();\n \tif (limits.turbo_disabled) {\n \t\tpr_warn(\"Turbo disabled by BIOS or unavailable on processor\\n\");\n-\t\tlimits.no_turbo = limits.turbo_disabled;\n-\t}\n+\t\treturn -EPERM;\n+\t} else\n+\t\tlimits.no_turbo = clamp_t(int, input, 0, 1);\n+\n \treturn count;\n }\n \n@@ -323,7 +353,6 @@ static ssize_t store_min_perf_pct(struct kobject *a, struct attribute *b,\n \treturn count;\n }\n \n-show_one(no_turbo, no_turbo);\n show_one(max_perf_pct, max_perf_pct);\n show_one(min_perf_pct, min_perf_pct);\n \n@@ -501,7 +530,7 @@ static void intel_pstate_get_min_max(struct cpudata *cpu, int *min, int *max)\n \tint max_perf_adj;\n \tint min_perf;\n \n-\tif (limits.no_turbo)\n+\tif (limits.no_turbo || limits.turbo_disabled)\n \t\tmax_perf = cpu->pstate.max_pstate;\n \n \tmax_perf_adj = fp_toint(mul_fp(int_tofp(max_perf), limits.max_perf));\n@@ -516,6 +545,8 @@ static void intel_pstate_set_pstate(struct cpudata *cpu, int pstate)\n {\n \tint max_perf, min_perf;\n \n+\tupdate_turbo_state();\n+\n \tintel_pstate_get_min_max(cpu, &min_perf, &max_perf);\n \n \tpstate = clamp_t(int, pstate, min_perf, max_perf);\n@@ -716,7 +747,7 @@ static int intel_pstate_set_policy(struct cpufreq_policy *policy)\n \t\tlimits.min_perf = int_tofp(1);\n \t\tlimits.max_perf_pct = 100;\n \t\tlimits.max_perf = int_tofp(1);\n-\t\tlimits.no_turbo = limits.turbo_disabled;\n+\t\tlimits.no_turbo = 0;\n \t\treturn 0;\n \t}\n \tlimits.min_perf_pct = (policy->min * 100) / policy->cpuinfo.max_freq;\n@@ -759,7 +790,6 @@ static int intel_pstate_cpu_init(struct cpufreq_policy *policy)\n {\n \tstruct cpudata *cpu;\n \tint rc;\n-\tu64 misc_en;\n \n \trc = intel_pstate_init_cpu(policy->cpu);\n \tif (rc)\n@@ -767,12 +797,6 @@ static int intel_pstate_cpu_init(struct cpufreq_policy *policy)\n \n \tcpu = all_cpu_data[policy->cpu];\n \n-\trdmsrl(MSR_IA32_MISC_ENABLE, misc_en);\n-\tif (misc_en & MSR_IA32_MISC_ENABLE_TURBO_DISABLE ||\n-\t    cpu->pstate.max_pstate == cpu->pstate.turbo_pstate) {\n-\t\tlimits.turbo_disabled = 1;\n-\t\tlimits.no_turbo = 1;\n-\t}\n \tif (limits.min_perf_pct == 100 && limits.max_perf_pct == 100)\n \t\tpolicy->policy = CPUFREQ_POLICY_PERFORMANCE;\n \telse\n-- \n2.1.0\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Power Management", "Classification": "Unclassified", "Component": "intel_pstate", "Hardware": "Intel Linux", "Importance": "P1 normal", "Assignee": "Kristen", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2014-08-24 19:26 UTC by Gabriele Mazzotta", "Modified": "2015-07-28 14:00 UTC", "CC List": "5 users", "See Also": "", "Kernel Version": "3.16", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/cpufreq/intel_pstate.c"], "methods": ["store_no_turbo", "intel_pstate_get_min_max", "intel_pstate_set_pstate", "intel_pstate_set_policy", "intel_pstate_cpu_init", "perf_limits"]}
{"id": "75581", "title": "Faill of battery detection on Lenovo Z480 with probability 5-10%", "description": "Created attachment 135211 [details]\noutput of dmesg (last line after rmmod battery&&modprobe battery)\n\nSometimes battery detection in module battery fails, reloading of module solves problem. I see this bug from Linux-3.7.4 until Linux-3.14.2.", "patch": ["diff --git a/drivers/acpi/battery.c b/drivers/acpi/battery.c\nindex 9a2c63b..82086ca 100644\n--- a/drivers/acpi/battery.c\n+++ b/drivers/acpi/battery.c\n@@ -34,6 +34,7 @@\n #include <linux/dmi.h>\n #include <linux/slab.h>\n #include <linux/suspend.h>\n+#include <linux/delay.h>\n #include <asm/unaligned.h>\n \n #include <linux/acpi.h>\n@@ -672,6 +673,8 @@ static void acpi_battery_quirks(struct acpi_battery *battery)\n static int acpi_battery_update(struct acpi_battery *battery)\n {\n \tint result, old_present = acpi_battery_present(battery);\n+\tint retry = 5;\n+\n \tresult = acpi_battery_get_status(battery);\n \tif (result)\n \t\treturn result;\n@@ -682,7 +685,16 @@ static int acpi_battery_update(struct acpi_battery *battery)\n \t}\n \tif (!battery->update_time ||\n \t    old_present != acpi_battery_present(battery)) {\n+\n+retry:\n \t\tresult = acpi_battery_get_info(battery);\n+\n+\t\tif (result && retry) {\n+\t\t\tretry--;\n+\t\t\tmdelay(500);\n+\t\t\tgoto retry;\n+\t\t}\t\t\n+\n \t\tif (result)\n \t\t\treturn result;\n \t\tacpi_battery_init_alarm(battery);\n", "diff --git a/drivers/acpi/battery.c b/drivers/acpi/battery.c\nindex 9a2c63b..e8a68f1 100644\n--- a/drivers/acpi/battery.c\n+++ b/drivers/acpi/battery.c\n@@ -34,6 +34,7 @@\n #include <linux/dmi.h>\n #include <linux/slab.h>\n #include <linux/suspend.h>\n+#include <linux/delay.h>\n #include <asm/unaligned.h>\n \n #include <linux/acpi.h>\n@@ -771,7 +772,7 @@ static struct dmi_system_id bat_dmi_table[] = {\n \n static int acpi_battery_add(struct acpi_device *device)\n {\n-\tint result = 0;\n+\tint result = 0, retry = 5;\n \tstruct acpi_battery *battery = NULL;\n \n \tif (!device)\n@@ -787,7 +788,16 @@ static int acpi_battery_add(struct acpi_device *device)\n \tmutex_init(&battery->sysfs_lock);\n \tif (acpi_has_method(battery->device->handle, \"_BIX\"))\n \t\tset_bit(ACPI_BATTERY_XINFO_PRESENT, &battery->flags);\n+\n+retry_get_info:\n \tresult = acpi_battery_update(battery);\n+\n+\tif (result && retry) {\n+\t\tmsleep(10);\n+\t\tretry--;\n+\t\tgoto retry_get_info;\n+\t}\n+\n \tif (result)\n \t\tgoto fail;\n \n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "Power-Battery", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Lan Tianyu", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2014-05-06 10:03 UTC by naszar", "Modified": "2014-07-08 07:21 UTC", "CC List": "3 users", "See Also": "", "Kernel Version": "3.14.2", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/acpi/battery.c"], "methods": ["acpi_battery_update"]}
{"id": "60583", "title": "Kernel oops at boot in acpi_ev_notify_dispatch", "description": "Created attachment 106942 [details]\nOutput of acpidump, hwinfo lspci syslog\n\nSometimes the kernel oops at boot, something to do with acpi.\nIt started when I installed 3.5.4 on a Panasonic CF-19 Toughbook.\nI tried 3.10.1 but the same result.\nCrash occurs in same function but different adress. (drivers/acpi/acpica/evmisc.c line 267 for 3.5.4 and line 216 for 3.1.0.1)\n\nsyslog reports :\nJul  5 10:44:36 ship1 kernel: BUG: unable to handle kernel NULL pointer dereference at   (null)\nJul  5 10:44:36 ship1 kernel: IP: [<  (null)>]   (null)\nJul  5 10:44:36 ship1 kernel: *pde = 00000000\nJul  5 10:44:36 ship1 kernel: Oops: 0010 [#1] SMP\nJul  5 10:44:36 ship1 kernel: Modules linked in: af_packet uinput nfsd exportfs nfs lockd nfs_acl sunrpc ipv6 iptable_filter iptable_nat nf_nat nf_conntrack_ipv4 nf_conntrack nf_defrag_ipv4 iptable_mangle iptable_raw ip_tables x_tables binfmt_misc loop cpufreq_ondemand cpufreq_conservative cpufreq_powersave speedstep_lib acpi_cpufreq arc4 freq_table iwlwifi mac80211 led_class mperf cfg80211 video intel_agp thermal processor rfkill i2c_i801 xhci_hcd intel_gtt thermal_sys agpgart kvm_intel kvm e1000e microcode sg coretemp rtc_cmos i2c_core serio_raw evdev hwmon battery ac button ext3 jbd pata_jmicron ide_pci_generic ahci libahci ata_piix libata sd_mod scsi_mod uhci_hcd ohci_hcd ehci_hcd usbhid usbcore usb_common [last unloaded: scsi_wait_scan]\nJul  5 10:44:36 ship1 kernel:\nJul  5 10:44:36 ship1 kernel: Pid: 1009, comm: kworker/0:2 Not tainted 3.5.4-vessel #6 Panasonic Corporation CF-191HAAXF4/CF19-6\nJul  5 10:44:36 ship1 kernel: EIP: 0060:[<00000000>] EFLAGS: 00010282 CPU: 0\nJul  5 10:44:36 ship1 kernel: EIP is at 0x0\nJul  5 10:44:36 ship1 kernel: EAX: f584d4a0 EBX: f5aad938 ECX: 00000000 EDX: 00000080\nJul  5 10:44:36 ship1 kernel: ESI: f5b575a8 EDI: f5e61740 EBP: dfa99f2c ESP: dfa99f20\nJul  5 10:44:36 ship1 kernel: DS: 007b ES: 007b FS: 00d8 GS: 0000 SS: 0068\nJul  5 10:44:36 ship1 kernel: CR0: 8005003b CR2: 00000000 CR3: 1fb83000 CR4: 001407d0\nJul  5 10:44:36 ship1 kernel: DR0: 00000000 DR1: 00000000 DR2: 00000000 DR3: 00000000\nJul  5 10:44:36 ship1 kernel: DR6: ffff0ff0 DR7: 00000400\nJul  5 10:44:36 ship1 kernel: Process kworker/0:2 (pid: 1009, ti=dfa98000 task=f5aed790 task.ti=dfa98000)\nJul  5 10:44:36 ship1 kernel: Stack:\nJul  5 10:44:36 ship1 kernel: c02a1a99 f4ebd3a0 f4ebd3a8 dfa99f3c c0294cc7 f4ebd3a8 f59f6a80 dfa99f78\nJul  5 10:44:36 ship1 kernel: c013e4fb 00000000 c051b000 c0520920 f5aed790 f5ad3500 00000046 c0294caa\nJul  5 10:44:36 ship1 kernel: 00000000 f5e65a05 f5e65a00 f59f6a80 f5e61740 35944000 dfa99fb8 c013ea70\nJul  5 10:44:36 ship1 kernel: Call Trace:\nJul  5 10:44:36 ship1 kernel: [<c02a1a99>] ? acpi_ev_notify_dispatch+0x4e/0x61\nJul  5 10:44:36 ship1 kernel: [<c0294cc7>] acpi_os_execute_deferred+0x1d/0x28\nJul  5 10:44:36 ship1 kernel: [<c013e4fb>] process_one_work+0xfb/0x340\nJul  5 10:44:36 ship1 kernel: [<c0294caa>] ? acpi_os_wait_events_complete+0x19/0x19\nJul  5 10:44:36 ship1 kernel: [<c013ea70>] worker_thread+0x140/0x3a0\nJul  5 10:44:36 ship1 kernel: [<c013e930>] ? manage_workers+0x1f0/0x1f0\nJul  5 10:44:36 ship1 kernel: [<c0144354>] kthread+0x74/0x80\nJul  5 10:44:36 ship1 kernel: [<c01442e0>] ? kthread_freezable_should_stop+0x60/0x60\nJul  5 10:44:36 ship1 kernel: [<c03d11b6>] kernel_thread_helper+0x6/0xd\nJul  5 10:44:36 ship1 kernel: Code:  Bad EIP value.\nJul  5 10:44:36 ship1 kernel: EIP: [<00000000>] 0x0 SS:ESP 0068:dfa99f20\nJul  5 10:44:36 ship1 kernel: CR2: 0000000000000000\nJul  5 10:44:36 ship1 kernel: ---[ end trace 11fc5ca1174c2a77 ]---\nJul  5 10:44:38 ship1 kernel: BUG: unable to handle kernel paging request at fffffffc\nJul  5 10:44:38 ship1 kernel: IP: [<c0143f3a>] kthread_data+0xa/0x10\nJul  5 10:44:38 ship1 kernel: *pde = 00528067 *pte = 00000000\nJul  5 10:44:38 ship1 kernel: Oops: 0000 [#2] SMP\nJul  5 10:44:38 ship1 kernel: Modules linked in: af_packet uinput nfsd exportfs nfs lockd nfs_acl sunrpc ipv6 iptable_filter iptable_nat nf_nat nf_conntrack_ipv4 nf_conntrack nf_defrag_ipv4 iptable_mangle iptable_raw ip_tables x_tables binfmt_misc loop cpufreq_ondemand cpufreq_conservative cpufreq_powersave speedstep_lib acpi_cpufreq arc4 freq_table iwlwifi mac80211 led_class mperf cfg80211 video intel_agp thermal processor rfkill i2c_i801 xhci_hcd intel_gtt thermal_sys agpgart kvm_intel kvm e1000e microcode sg coretemp rtc_cmos i2c_core serio_raw evdev hwmon battery ac button ext3 jbd pata_jmicron ide_pci_generic ahci libahci ata_piix libata sd_mod scsi_mod uhci_hcd ohci_hcd ehci_hcd usbhid usbcore usb_common [last unloaded: scsi_wait_scan]\nJul  5 10:44:38 ship1 kernel:\nJul  5 10:44:38 ship1 kernel: Pid: 1009, comm: kworker/0:2 Tainted: G      D      3.5.4-vessel #6 Panasonic Corporation CF-191HAAXF4/CF19-6\nJul  5 10:44:38 ship1 kernel: EIP: 0060:[<c0143f3a>] EFLAGS: 00010002 CPU: 0\nJul  5 10:44:38 ship1 kernel: EIP is at kthread_data+0xa/0x10\nJul  5 10:44:38 ship1 kernel: EAX: 00000000 EBX: 00000000 ECX: 00000000 EDX: 00000000\nJul  5 10:44:38 ship1 kernel: ESI: f5e64920 EDI: 00000000 EBP: dfa99cf0 ESP: dfa99ce4\nJul  5 10:44:38 ship1 kernel: DS: 007b ES: 007b FS: 00d8 GS: 0000 SS: 0068\nJul  5 10:44:38 ship1 kernel: CR0: 8005003b CR2: fffffffc CR3: 1fb83000 CR4: 001407d0\nJul  5 10:44:38 ship1 kernel: DR0: 00000000 DR1: 00000000 DR2: 00000000 DR3: 00000000\nJul  5 10:44:38 ship1 kernel: DR6: ffff0ff0 DR7: 00000400\nJul  5 10:44:38 ship1 kernel: Process kworker/0:2 (pid: 1009, ti=dfa98000 task=f5aed790 task.ti=dfa98000)\nJul  5 10:44:38 ship1 kernel: Stack:\nJul  5 10:44:38 ship1 kernel: c0140d4c f5aed790 f5e64920 dfa99d8c c03cf26c f5402698 00000000 dfa99d14\nJul  5 10:44:38 ship1 kernel: c01d1c70 dfa99d43 f5827990 00000000 dfa99d34 c020ca60 dfa99d43 00000004\nJul  5 10:44:38 ship1 kernel: c051b000 c0520920 f5aed790 f581a000 000003f1 dfa99d44 c017e397 00000000\nJul  5 10:44:38 ship1 kernel: Call Trace:\nJul  5 10:44:38 ship1 kernel: [<c0140d4c>] ? wq_worker_sleeping+0xc/0x80\nJul  5 10:44:38 ship1 kernel: [<c03cf26c>] __schedule+0x34c/0x750\nJul  5 10:44:38 ship1 kernel: [<c01d1c70>] ? d_hash_and_lookup+0x30/0x60\nJul  5 10:44:38 ship1 kernel: [<c020ca60>] ? proc_flush_task+0xd0/0x1a0\nJul  5 10:44:38 ship1 kernel: [<c017e397>] ? call_rcu_sched+0x17/0x20\nJul  5 10:44:38 ship1 kernel: [<c017e397>] ? call_rcu_sched+0x17/0x20\nJul  5 10:44:38 ship1 kernel: [<c012d6a9>] ? release_task+0x1d9/0x310\nJul  5 10:44:38 ship1 kernel: [<c012ce01>] ? exit_mm+0x1/0x100\nJul  5 10:44:38 ship1 kernel: [<c014978a>] ? switch_task_namespaces+0x1a/0x50\nJul  5 10:44:38 ship1 kernel: [<c03cf8de>] schedule+0x1e/0x50\nJul  5 10:44:38 ship1 kernel: [<c012eacf>] do_exit+0x4cf/0x7d0\nJul  5 10:44:38 ship1 kernel: [<c03cdd7b>] ? printk+0x38/0x3a\nJul  5 10:44:38 ship1 kernel: [<c0105726>] oops_end+0x86/0xd0\nJul  5 10:44:38 ship1 kernel: [<c01228a8>] no_context+0xd8/0x1a0\nJul  5 10:44:38 ship1 kernel: [<c0122a15>] __bad_area_nosemaphore+0xa5/0x140\nJul  5 10:44:38 ship1 kernel: [<c0122ac2>] bad_area_nosemaphore+0x12/0x20\nJul  5 10:44:38 ship1 kernel: [<c0122f39>] do_page_fault+0x279/0x400\nJul  5 10:44:38 ship1 kernel: [<c035ed00>] ? netlink_broadcast_filtered+0x1d0/0x340\nJul  5 10:44:38 ship1 kernel: [<c035ee95>] ? netlink_broadcast+0x25/0x30\nJul  5 10:44:38 ship1 kernel: [<c029c0cc>] ? acpi_bus_generate_netlink_event+0xfd/0x109\nJul  5 10:44:38 ship1 kernel: [<c0122cc0>] ? mm_fault_error+0x170/0x170\nJul  5 10:44:38 ship1 kernel: [<c03d0a0a>] error_code+0x5a/0x60\nJul  5 10:44:38 ship1 kernel: [<c0122cc0>] ? mm_fault_error+0x170/0x170\nJul  5 10:44:38 ship1 kernel: [<c02a1a99>] ? acpi_ev_notify_dispatch+0x4e/0x61\nJul  5 10:44:38 ship1 kernel: [<c0294cc7>] acpi_os_execute_deferred+0x1d/0x28\nJul  5 10:44:38 ship1 kernel: [<c013e4fb>] process_one_work+0xfb/0x340\nJul  5 10:44:38 ship1 kernel: [<c0294caa>] ? acpi_os_wait_events_complete+0x19/0x19\nJul  5 10:44:38 ship1 kernel: [<c013ea70>] worker_thread+0x140/0x3a0\nJul  5 10:44:38 ship1 kernel: [<c013e930>] ? manage_workers+0x1f0/0x1f0\nJul  5 10:44:38 ship1 kernel: [<c0144354>] kthread+0x74/0x80\nJul  5 10:44:38 ship1 kernel: [<c01442e0>] ? kthread_freezable_should_stop+0x60/0x60\nJul  5 10:44:38 ship1 kernel: [<c03d11b6>] kernel_thread_helper+0x6/0xd\nJul  5 10:44:38 ship1 kernel: Code: 90 55 64 a1 ac c5 51 c0 8b 80 74 01 00 00 89 e5 5d 8b 40 f8 c3 8d b6 00 00 00 00 8d bf 00 00 00 00 55 8b 80 74 01 00 00 89 e5 5d <8b> 40 fc c3 66 90 55 31 c0 89 e5 5d c3 89 f6 8d bc 27 00 00 00\nJul  5 10:44:38 ship1 kernel: EIP: [<c0143f3a>] kthread_data+0xa/0x10 SS:ESP 0068:dfa99ce4\nJul  5 10:44:38 ship1 kernel: CR2: 00000000fffffffc\nJul  5 10:44:38 ship1 kernel: ---[ end trace 11fc5ca1174c2a78 ]---", "patch": ["From d20ef436012704eb2d18f2c0d03ad770beec2572 Mon Sep 17 00:00:00 2001\nFrom: Lv Zheng <lv.zheng@intel.com>\nData: Thu, 12 Dec 2013 10:33:13 +0800\nSubject: [DBG PATCH] ACPICA: Events: Add delayed handler flushing to ensure all executions are exit.\n\nAccording to the report, current Linux kernel code is facing a boot time\nrace issue in the acpi_remove_notify_handler().\nThe notify handlers can be invoked after flushing that is implemented in\nacpi_os_wait_events_complete().  This patch moves the flushing code to the\nposition after removing the notify handlers to fix this issue.\nThis patch also cleans up all AcpiOsWaitEventsComplete() invocations.\n\nBuglink: https://bugzilla.kernel.org/show_bug.cgi?id=60583\nSigned-off-by: Lv Zheng <lv.zheng@intel.com>\n---\n evxface.c |   40 ++++++++++++++++++++++++++++++++--------\n 1 file changed, 32 insertions(+), 8 deletions(-)\n\nIndex: linux-acpica/drivers/acpi/acpica/evxface.c\n===================================================================\n--- linux-acpica.orig/drivers/acpi/acpica/evxface.c\n+++ linux-acpica/drivers/acpi/acpica/evxface.c\n@@ -251,10 +251,6 @@ acpi_remove_notify_handler(acpi_handle d\n \t\treturn_ACPI_STATUS(AE_BAD_PARAMETER);\n \t}\n \n-\t/* Make sure all deferred notify tasks are completed */\n-\n-\tacpi_os_wait_events_complete();\n-\n \tstatus = acpi_ut_acquire_mutex(ACPI_MTX_NAMESPACE);\n \tif (ACPI_FAILURE(status)) {\n \t\treturn_ACPI_STATUS(status);\n@@ -277,6 +273,18 @@ acpi_remove_notify_handler(acpi_handle d\n \n \t\t\t\tacpi_gbl_global_notify[i].handler = NULL;\n \t\t\t\tacpi_gbl_global_notify[i].context = NULL;\n+\n+\t\t\t\t(void)acpi_ut_release_mutex(ACPI_MTX_NAMESPACE);\n+\n+\t\t\t\t/* Make sure all deferred notify tasks are completed */\n+\n+\t\t\t\tacpi_os_wait_events_complete();\n+\n+\t\t\t\tstatus =\n+\t\t\t\t    acpi_ut_acquire_mutex(ACPI_MTX_NAMESPACE);\n+\t\t\t\tif (ACPI_FAILURE(status)) {\n+\t\t\t\t\treturn_ACPI_STATUS(status);\n+\t\t\t\t}\n \t\t\t}\n \t\t}\n \n@@ -329,7 +337,18 @@ acpi_remove_notify_handler(acpi_handle d\n \t\t\t\t    handler_obj->notify.next[i];\n \t\t\t}\n \n+\t\t\t(void)acpi_ut_release_mutex(ACPI_MTX_NAMESPACE);\n+\n+\t\t\t/* Make sure all deferred notify tasks are completed */\n+\n+\t\t\tacpi_os_wait_events_complete();\n+\n \t\t\tacpi_ut_remove_reference(handler_obj);\n+\n+\t\t\tstatus = acpi_ut_acquire_mutex(ACPI_MTX_NAMESPACE);\n+\t\t\tif (ACPI_FAILURE(status)) {\n+\t\t\t\treturn_ACPI_STATUS(status);\n+\t\t\t}\n \t\t}\n \t}\n \n@@ -840,10 +859,6 @@ acpi_remove_gpe_handler(acpi_handle gpe_\n \t\treturn_ACPI_STATUS(AE_BAD_PARAMETER);\n \t}\n \n-\t/* Make sure all deferred GPE tasks are completed */\n-\n-\tacpi_os_wait_events_complete();\n-\n \tstatus = acpi_ut_acquire_mutex(ACPI_MTX_EVENTS);\n \tif (ACPI_FAILURE(status)) {\n \t\treturn_ACPI_STATUS(status);\n@@ -895,10 +910,19 @@ acpi_remove_gpe_handler(acpi_handle gpe_\n \t\t(void)acpi_ev_add_gpe_reference(gpe_event_info);\n \t}\n \n+\tacpi_os_release_lock(acpi_gbl_gpe_lock, flags);\n+\t(void)acpi_ut_release_mutex(ACPI_MTX_EVENTS);\n+\n+\t/* Make sure all deferred GPE tasks are completed */\n+\n+\tacpi_os_wait_events_complete();\n+\n \t/* Now we can free the handler object */\n \n \tACPI_FREE(handler);\n \n+\treturn_ACPI_STATUS(status);\n+\n unlock_and_exit:\n \tacpi_os_release_lock(acpi_gbl_gpe_lock, flags);\n \n", "\u001f�\b\u0000�8�R\u0000\u0003�=iw�H��\u0015~E%s:\u0003\u0011`�x�2Ml��\u0003d�Lw\u000eG���\u0004K\f\u0012q���{kSI*-8�{��k��\u0010IU�nU���RZ[�l���&�L�p�oq���������N[���w�nw���������vo��\u001d��&�$�u\u0010�+B���zW�ϙ���\u001f�Z��_|n:tI=��Z����A��\r������i�u�w��w�yg����\u001di?��\u0005������o��.uz����=��l�g�n�s����{�����}�̝�^w���\u001e\u0019�%��v���G���U\u0004sH^�Sh�(y��t\u0015�n��\u0007�\u000b�5�o^V��\u001e����A�ə}\u0007�;]��\u001c��\u000f;\u0007�j����z�o:\u000b\u000f�O����\u001b���~$��˓��!�;\u000e\t�˥�\n��_���\"t�\u000bJ<?t�w����\u0005]\u0005����\r�\f�(�\u001d'P�B�؋��ٗ�^��~vg�\u0001��Ս�����\r�'�+F�\u0000��\u0019�A��\u0017�OV�y�>Q���V4\bW�Y�^Q��ה\u0000{�+5�De�;�MC\f]u= ���\u000e]�kȧ\u0000���l/\u001a�;�V�5]��\u0015G���:n�8\u0017')z�����\u0010�:`\r�K\u00076\u0001�r�\\�^\u0000\u000e77nH���)�ݫ=ƕ&[j���\"U�� �7��Z\u0002~\u000e[��u2�#C{n�\u0005yw\u0017��O.\f>r�<�4���9�+E%�\u001e��G�`���\r�ٺi-\\/�9�ȫ���\u000b굦�W�y�٬\u0012g�~\u0006��\u00132\u0010~�\u0016��^���o\u0004�mbe�\\�3֐����T\"a\u001ed���o�`֚\u0011\u0006���C,v5�+�㗹=��\u0013:�zm��J�O^\u0019�8뛥D�t\u0011����С\u000b\u001a�جi/��X\\ޔ��B��l�v�l\u0019�-i��*.ٲ\n�6w\u0017T�� `+@�\u0000�\u00078%�Y�\u0006L�C\u0018>�I�^\u0005n��I�y\u0005�mo\u0015l���\u0001��C���|�ٞ�Z\u000e��\u001d\u001c�H�i7���1��\u001d����\u0003iv��\u001b��=\u0002\u000f�\u0019'�����`��̞]�IH�����b�\u0003#\u0002O�7Ϫ�J���\u001f\u0019ЈY�n���\u000e��)\u000e���s�D\n\u001f5\u0002�r��ٽ�p9��XY`��d������\u0011��Z%�eF�H\u000e��W������SS�\u0010ڤ:��tA�^%(S��,�\u0011�\u0005]��nwf�Z������~\u0019��\u0010��R�A��m�\u001b(���E�d�\u0003�\u0015��\u001a'ť�\n��\u0001�{k���Nj���ڋO�=%OIt�@rE�w�<\u0013�z�\u0001�:r�e�\u0000T���Sr�t�R�\u0012V�*&�_�V��N<W[jU>��C��|�5_Bx�;��lX%��9כ�7�I��\u0003�\u000b|����?�\u001b�\u0013`\u0005�\n�\u0006�б�\u0018bK*w��񲎶��\u0001��ڬ0�\u001c���������\"�]�}C\u0001\u001a�g�A���ӕ�\u0007<!�XH\u0014���@\u0003�q�i��}��d�\u0006��u�]�V�Q\u0019�kj�`���)\fd�\u0012�ԣ+wF8��q�G��ba�>���).l\t�Tz=�sd\u0003�����N{o���>����R�C���PՈ)��.S\u001c��\u0014�A.����w�D������5\u0000NX8�9�U\u000b�h��N�N9AL�\n��\u000b���Q.\u00039\u0015L�/�'�?LN�__��s)�_O�\n�=��z#6\u0012q�MOγ�\u0000�\u0015�\t0_�8�<j\u0014�\u0005�!I��\u0003\u000e4��8\n�\u0001H�\u0000R�T\u0012���\u0003�\u0005�2�C\\���\u0019��_\u0011�`Q�9\f��Ż��A.�\u0017G���\u0002�z<���р�\u0013�7��Y�\u0014�`tu���e�=��_3eM�s\u0010^\u0013FLH_y�Eb�pIr���$�7���`X,�pj��\n�!�Ԁ0��vW�\"�+(�\n�w�\u000b�\u001e�_\u000e\t�\u0005�F|K_��5�\u001a�\u0010���Ů�~%�D�R�FO=�O��$6AZ�q9�l\u001b9�ʑD��xp�h\u0018\u001b��v�P\u0012*��,��k!\u0005w:t~����~g>�\u0007�RP\u0001Ȗ��\tRj��\u0001\n�\u0012\u000b�����\u0014�y�\u000e�\u0014\u0007�\u0015�� ��\u0018�\u001f0N*�\n�K�\u0011�\u001d��5�W\u0019��l\u000b���\u001c�ʫV򂜿==Mt��KZ:���T}*�V\u000e|\u00058�ѡ{\u001bH��YiD�� ����\u001f��8O�~{~4>A��?\u001b�2v��jM�[�\u0003��5�&������Mj\u0003�\u0007�9\u0014�\u001b�ƾ#\u001e�\u0006�j\r3���U[�\u0000�Kj�+�ٟ(�p�dr9|G�\u0017d�\u0014L\u000e�0�lr9jg��o�ڈ/�\u0011sN�\u0004��~K�\u0016Xh�\u000eC�2@%,(]���\u001c\u0000�\t\u0017�<��!�0��l+q�|�hh{� 3;��v��,\u0017w$\n�\\�\u0018�0(U\u0014\b�oI��x��폰\u0000'��Z�?y�T6\"����X�����]a\u001a?}�k�����=\u0018��\u0014K�}��}�\u001f�#�|���{,\u00011BY�@a!�*�d5�[��\u0004EoԤ�\u0012��\u0018י!����ơ\r���:R3����F�?�\u0002��\u0002{���߄�\\a&c�/�`*;\f��v�\u0012����qy���y`\b.U\u0002���%X�/\u0001�9�bM���������=�B�����+\u0000FJSp\f*���Ԡ�!s`p�GR\u001c��\\6\u001d#ް���z�\u001a����倭��lY\u0018nқ�\u0017qq'(?�̙㾕��\u0012]1\u001b\u0014)�%p\u0010�S@ܜM�r\u0013*H�ܾD<&�F94�\u0011\u0016�镲q\u000e�\u001a�$B���M���'�\u000f#a��uH�?��|\u0018�\u0007g�7�����prz2\u001a�\u0015\"t\u0001#���\u0013H�\u0014k�\u0001vؼ\u0012�\u001c�\u0011j*IO͗�\b\u0014;�J\u0004_����>�1!��������Y|��H)_�LlE�ð׋\u0010wn3ƲR����\u000f\u0002\u0014�8`\u0018N�6��Kw\u0007pb��3��E\b\u0017q!�k������HI\n�\u0019\u001f筷�y$\b\f#`���ҥ's�oŜ][��5\u001c�\u000e��z�\u0005�\u001e[`}����\u0013:\n���S��\u0014c\"�7�F��h�]'�t�4���x{~�\t��!@X�bt��;�O���\u0006��\u001a����0�\u0010�\u001f,\u000f׃H\u001d5sT�%�z�\u0004Qƫ\u0014S��o��\u000e\u0011�\u0018�\u0014B~�\t�h�)�_\u000f��P�p\u0006�\u0017ҸIW�d���K�\u0011�F�/&g���ᇈP#��\u000e�&���m$\\O��G)2\u0017���\u0010���y|��\u0000�j��\u001a|��H�1ӤA�_g:_�!\u0002L�\u001d�0/D\u000fi8\u0010�r�\u001d(eM�Y\f���:DD����)6��\u0011\u0004/a[����D�٩iI)����?t=�щ\u0014C-�I+w\u0019��I�*\u00027Z���k\\\u001e\u0017���,\u0005L\t3��\u000b\"C��6�+^�ں�[��$�KܙJD-A��`�K���w�S�IC�2\u0012�J�K_GΛ;]�������ѩ��\t\u0015�P��@VBmD�UgIŨ܅Ƛ�\u001d\u000ej|ܺ$;��<����\u00144Tɺ���F�|]F�YE��|�\u0002- \u001aʉ\u001e!C�ȱ2%�\"�R|U \u001c2EBsc�Ќ�\u0004>�l��g\u0007K�71B�]�\u0001���h�68\r���\u001e\"8`���zq\u0005\u0000M���\t|�e�����V�dL7)�w� \u0017��,_!\"$_%.�^\u0012lm��\b�@D\b �`��( <�1��^c�M��A���{�@Z�Ŋ�\u0019aQPݓz��4Țz-\u00164eQ���1&����ݼ�\u0005cM!]A��6��q��k\u0001�tx��t\t�rË1�\u000e�\r���\u000f�D�\r<�[\u0017\u001c ���\u0002�F�/)F��D1\u0012uZ�\u0015S���=��L�\u0014$-��[*A��W�;T\u000e<����Q@Jsy\r�/��\u0015�����4U*.�C��R��6=��3�SD\n\u0019�4�3�f�B�ɩ2\u00132z\u001a�\u00132v+�P�SjB\f;��ID\u0019A<\u00151wWA���\u0015\r0�#�E'�\tS�e�\f�\t�i�\u001f\u001aɌ�����ǌ�8-6H|=�\u00146���K\r\u0011��yMj\u0006|���\r�\u0001���\u0012r�!\u0011\u0016\u0015\u000b��泪q;\u0012�XAHbOj�����ݱPJj{�\u0016y��.C�ig�L���vYF/>j���o�]0���Z��X\u0012B����\t��oʽq\u0019�>14g�&ЖM%������_s\u0014Mhǚ0�\u0011��prY\u0013/�\tV2�he/\u0002�e晶�P\u0017��^\u0002�\u0016�\f\bӯRGr\u0012��a�ʙNl��0��)�������\u0018����pP/�;���Y�M�^\u0016\u001f�@���Z\u0007m��:�2�S\t!/}*۠շ�k��\u0012\u000b~�;�������逧�\u001e���뼮�a/,,�61�%��C�e/��z��F3��ؚ���\u000f\u0001��`8:�ѕ�&m��� \r��\u00120\u0019�إ�\u0002(\u0000�5�?�\r\u000e�]M�n�r\u0013�PhD%�j�vso^�\u0000��%Hx|s#x���|#x��S\u0005�L��A(m\f�pU��P���*T��z\u00122�YZ\u0016��ܿ�Ҹ�h���\rD��$?^\u000e�м\u0004�$*Q\f<����}�_EE����S\u001d\u0001��Q�\u0006����%'�KA8)�-��A/0�4ϩ��c�Z\t=���l�d\r��*�֥Ab�֩di\u000b��q+A)-\u0019OI\u0016��F�R-\"\u0003V�T㪇�\u0016\u001a�ٯ\u000f.ښ���v�RRm�J�t�\u0006\u0004.�\u0004�y��D �@���.^6a�#\u0016I\u0004���$�\u0016���}�~s��J]\u0004㥷�\f�E�׈b��XJ0�f|�L�`�����\u0006Sb��RV53Og�\u0018�|�\b�\u0004[>1h�:NM����ɫ��DQ0�(n�K�sq�\u0011�\r�\u0017��Z��B�yM�M]�JĲ0��T$���+$S\u0012PĜc:Z�Q�\u0012�q���4�4��\u000f�I\bD-�\u0019\u000b����F\u0012�\u0018%���\u0012\u0004Ĭ/��:�rJc��\n�p;� �瞬�aᥩ\u0014\u0004\u000e\u0003h�Cʶ�Ӱ\u0002�ʺ�lE��\u001b}���\u001b�K�Vl�\u001bm��7�\u0017�-!�`v\u0014͗�OSś�v�TM��G\t�T^/Iz7�%b�K'�o4�\u000f\u0019@�>\u0006j=�\n���� ��u0� jz�C~2u�\u000b;��\u0005݉��-����f\fFbr�Ն>耨�F�U��d�.����0�53`!�V(\u0011Qȵ%��Z�vZ\u001c��J��MC԰��2\u0012^��N����ix�SВ����V5f\u001f�\n�^���#�~��9Pi\u0013����[~#&\u001b�\u001b��q�f\u0013ӁŰ�\n�Y@F1�Q4�\\��99����^��(Y\u0000\u001d\u0015\"&K���\u0010ϊ\u0018J�e��kJ�����A-g���d�\t,o�.��\u001a�ux�^\u000bI�\u001e�E�ꂤ��Jzj1M����s��p,*���&!>�A����n<\u0014���D��z;�%m:\u0015af��\u000b$�����N�{O�7\f�\u0012�Z8\u001b�>he�\u000e���Z�I0�L��\u001c�,\u001c�\u001d��5E�MY$�P\u0015v��ۓ�l�r�zY{\u000b�i�DH��̻D��U�a�\u0019\u0017�\u0017��\u0006�\t�rAn��%;e��\n�\u0015�\u0012T�z\u000e�\u0007*Nf�k\u000eg��v0���\u001a��\bf\u0014̕�F���q_~���g�e�<��D�s\u0010\u001at�ً�2�\"���J\u0002�nE�\u0002\u0017��b�J\u0011Un����x\nX&\u00046u��\u0000 �\u000f�`���ij�\u0015���\u0005��Ν��\u0014%}����\u0017µ\u0018^\\���\"\u0011�Ǖ���\u001c\u0003q�s������\u0018\u0003���e�\u000e�l�p|\u0000�E:2՞��ū!܏z*���u��\u000e\u0007��\u000f�����x�L�0�\u0015{'*d�\u0003��O��֢��h�bI�ZrFi˲΋\u0014��ON֔\t8.h���N�\u0011�9})�\u0019yK��\\0����.1e��*=�d�ZV;c@*��18U�vb=\u0013hǗ2\u001bmsmj\u0016�Ɯ��6#�B6��\u0017��\u0018�w�\u0012\u0011\u001b�h�\u0013�toe\u0010H��\r&7Y��\t\u0019Ub��/&�.X)9��(�>�b\u0019e.�C�X\u000e�t���G\t��\u0015\r�Pr��\u001c\u0017��\u0001��γ]O��Y\u0005;JV�\bB�~\u0015:B���P\u0019t0\u000b,\u000f��>�,ǎU@�K���N�\u0003-I\u0001�2�Pll|`�\u0019%�l\u001e\u001d8v�\f\u0015<~~\u0006u�����0N\u001a�,z�\n(7=��:-a��N�ܸW�<���D�\u001f\u0000\u0004�\u000bqЮŧ~��\u001c��G9�y������4���eU���E`Sh�Ҫ��R�`�ٜ\"��M|<a�믇��\u0019m�~�8\u0019���\u001b<� ]_��K�>\"6���i!+MUQͯ�\t}�D\u0019%��B+�BZ���3���R�\u0018\u0012MVۛ\r����n�\u0019}�{!O\u00002��}�KVȬ�C\u001eԛE'�6P�:�K\u0006��!�W�Kj�x����r8V\u0013�O��j_r�H��\u0001e���n���E]��\u0003�\bgc˼�0�'\u001b��\\�<;U�~���Y\rTIV'%�T���,~Rh�\u001c��h\u0016��o�����c\u0005AI�1d���(^�##Hڣx�O��j&�\u0012fK/f��W�H֏ɒ���3A��Kts�;B\\?\u0002�E�6�P5��,5���U+��r��\u000e��9�q�ɮ����SX�f��\u0018�.\nd=�$\n=��)Ę�T�S�X�y, ��\u00040�\u0017eR\"}\u0014NS\f9D�k*���xY�sfV��,0\u0003ss�\u0006\t��?]\u0007��\u0007�`�{=Qt�u�%Gt��=r�ĽISC�\u0013�|��\u0011�R&RT�*\u0002�ҋ0�Д�0��b\u0011��֔��K\u0019�fԾ��M�\u000b^�Y�|3�/��x�\"�h�����>\u0016��/f�|\tW6J�x�9X-S��\u001f�\u0018��\u001d#�Z�nW%�ɭ\u001d\u0018�G��\tu�ԑDׄS�(n��0��%�\n��<YB�\u001cV��\u0013Ra'q�\u0012ZP;���5�\u0015�jg���Ltt�?\u001a�!r������v{���\u0010\u000bO\u001c�o���ˋ�\u0018�����inFF�qӅ\u000eBQ\u001a�\u001cR�U_[�`�\u0013`�`V��g�ğ�\u0013\u000f]8�Y�����ktvw�\u0011��\u001b��n�\u0013��\u001c��Kd���y���龼\\�\u001f$���\t�ܖ�\u0015�毃I���不�����.�q�f��X:��$\u001d�\u0014�_-Cǒ\b�㮡\u001d|�Qr0S�xȄg)�N����v�\t��{0��j��ƽ�����g�Y��\u0002e\\�\u0016jK�\u001d��#'���b*\u0017�R��~Ӟ�R�\n�����\u0010��\u0004���\u0012Y�\r�_����'�_V\u0013�\n��B�����\u000b\u0004�.����\u0017-���H��ŉo��E�\\\tzs:\u001c�灱���䳣9>xB;\u0002]>��ͺ0�P)��8}\u0019\u000f�\nb��\u001d�O��\u0003�%\u0012�M���K�K57A׳�\u000f�~7�4+�^�4�����\u0018�\u0012��t���\u001b�_����D]��f\t�o����\t�͒�h\u000b��\u000b�1�����ߦ����1_��M�,u�^����184錮���\u0010�IbMe����9�\u0018\u001c��zX��\r\u000b�oFI���$\u001f�P�1�\u000f�$\u0011�wvY%v���L2.J���\u000e�Y�t�<I\u0002\"\u0011)o��n��03�\u0016K�E�;�B��*>��\bS�a_�(�oヤH*?k#�ʒ_�����2�h�ȸ��9���ڴ�y�A/�\b�}�N�hʮq��!\rdC�%�\u0000I6\u0001�\u0018�O�Tx�/\u00136�����\u0016�̈́ۊ⇣����.��<�d����)�4��j\u000e\u0011K��&��R�Q�(U]G\u0014,\u0006'�/����=�\u001aȮr1���\u001b�S�a��\u000bY\rY����\r��=�����\u0003��\u0007��>�������m#���\u0018�@!W\u0012�C$%��:��5�9\u0010��E�B�ȑ,X����8i��wޛ��!�\u000e\u001a�\u0006Ah�3��yo�w�\u0018|8�f\u000b\u001e��� n�\u0013M\r�h<�dz\t��1�-C0v�\u001e��k/1�8\u0003�a0H�������4J�o���\u000b�.�r��1�`�7D-�\u001e�\u001a�(��\u001b�(|�,,t��\u0003]́��E9�XE�Pm0R\u000f��O֌��7�\u0013�A�\u0000��.$\u0017��1\u0014uJ���u0\u0015���T_SW\u001f\u0018�\u0006Ū���G\u0018S��+�fHj�@�F�D�IyXk�Ή��\u0010;5N��␧0�bniS�ҟ\n3����@\u0015Y\u0011�F\u001cx$��:�ׁL\u0010�M�ƾTe�QW�Y��V\u001e�)PW�bf+'@��fZ����+1\u0005p޾],DU����\u0007���\u0000\t1�d�X�U(�㒘*u)�\u0011UH&p,\b�#\u001e��B]۝P��u��\u001dש��J\u0001(\t)$���,�V\u000f|�����0�B�\t��y�Fqc�wV#�j4�\u001f\u001d����mՖ\u0013�ǎhz��@�\tC��E���\u0017G/�\u0006���߄J$\tఅ$�W+\u0001���ӷ\u0017\u0010�S�y�����BH�����[,\u0019��\u0002�o}\b��\u0004c��o\u001b�����u�Xh\u0012Q8�y��$-�w�){#���7\"#\u0011ҋ�Ez�˶�\u00029W\u0014�D\u001f}Fo��q\n���n�V��\b��\u000b�r�fݗ\f��\u00000�p?���\u001dܬ=�)�;�8\u0005�\u001eq���\u0013�KzW\u0007�n�ev\u0019��u[�K��^v�\u0003��9��mt�k�6\u00066e#7�ӓ<�)�3����%�9ÿ�\u0000�NN>\f���@��a\u0000C����P\u0001ٍ�T���+\u0005t7���S\u00115�\\�#�yKu� �>���\f_��\b\bюSkt� vCz\u0002�=�=\u0001w'�\u0017��+���[H\u0000\u0018\u0005\u001b�9@�C�:ۮHb\"KV䣛���>ʶ�\u0002V�AY'E�\u0013E��mz$t_6�Hs��9kkM�����@\u0015Ӣ�ǃ-~m\u0002L�˒c׬q\u0012ȱN�Q\t�����\"�\u00168y0�\u0006B��l\u0007\u0001�=��M6�ނd'3���\u00073R\u0000���!G�Y���|���A'�\u0014;��p7�j>��*\b��\u001a��MM]7\u0002ǘX~5c\u0013\u0003Q���*�ê���jɄ�Q|{�a�0�q/�F�a\u0019�\u001e��Q��,�Le?�\u001a�_G�x.���#�+)��J��9K���A���\t�!��\u000b(+}�Q2H�!\fh�k�\\҄K���\r�f�VDB]\u0016I\u0004*\u0007�E6��*���aU�ʒ��x��'RvUed�?r�\u0002����\u001f5z�U�}\u001f\u0006�5��i��c�-�|���\u0010$�\u0010��<HR#\u0010�/+e5&\bR�W9QEI\u0003\u001bQ\f�ìߓ�\u0016�\u0011C�Y�4�M��\u000eH�<Ԓ����`&N21�\\^�ue�~�l}�iɽ\u0004ZY��ԔF\u001f.h���fa\u00071ʋ�\t�!O%,'t\fPdݕ�\bZ\u0014�<V9_�Z��X[e�Ġ&P��.\u0012뇲\u001fS�>R\u0013J�����_G�\u0007�:�\u0014�0*٥d\u0005�K���c�;��u��9�uv)\u0005�l�R���E\u0007���KҨ[�\u0012��V\u0018H�\\B*m�ӆ���ul�j�;5�촌<����f�.���;���D2�\\b�p J��%S!A\u001b��?�\u0004T�\u0004��~�p��@�\u0002�}��\u0013�m�FV������\u0006\n\u001e\u0002�=��n�+��\u0001��]�0�\u0002-��\u001b'?@`�\u0005��\u001a%�\u000e�;+U9r`�884�&4���\u0000�I�\u00056�����LTN/s��[\u0018�?\r9�(��2�UNm�������W�ǲ�q���Nu%'C���\u001b\"D�D�0��\u0016��;�$9@m\u0013W�<��\u00016K\u0000'�(\u0000�\\:����q�L;�!��j�l���\u0011�t�s��3�24w�h��馡i���o^t�_�q\u0005x2�m\u0007tE\u0017��cޭ{y�a�*\u0006W�s��\u0015��y�G�e9�e�&�7ݎk>\"ƽ�����1Z\u0013���%]L緅�����\u0015\u0018\u0010�\u0003wb\u001a#g��vh��\u001dwd�&�����ӥ�ȶ\u0003�\u001d�7lM8�+bz�0���X\f�\u001a�铳ق���)yv��ׯ��l�30��\u0014��~���#\\�\\@\u001e%�\"oF�Ycư�n�c�;=�4����ox�D������?�E���/5ѣ�ts-�ݗ��hZLu�YlpU��V״��tA��r2i�?W[���%�\u0016\u0018�<[/�t}�_ï�\u0016gtA^���\u0016�ٜ.�1�\u0019���\u0000\u001a)�!�'l\u0001\u001d�lf�.C8��Jq�pN�*^\u0019�2��UL\u001d2V�ex7aǚL�\u000e��@��C�\u0014\"����ʆ\u0001B~5��p\u0003�\"��}�i��Y�!\u0019��-��<W��/x���R_�g�\u001ayt��&��\u001d\u0013dD�\"O�5�(�i��nd�p^�F�,��`�f0&n�\u0007c�/�1��h��}ɓ|\u000f#2�����y�pT�>N�oE��e�T��\u0000\u001a�=$m~�\u0013F�N�\u0012I�{��\u00183�\u000f���'?��#K��r���\\_�H�r��\u0013�\u0011t�[��\u0017�64é��Z�F���\u0002e\u000b�5��zW�5�p[�M�u=\u0018\u0012~����.�7��f�����(\r�p�\u001a���\"�\u0003Q�\u0015bJ��vb�s�%\u0015\u0014�Y�\u0005:c���|\u0013^\u000ea�1�k�\n\u001a\u0006�O��\u0001�}*\u00176�SI�b��V4._WN�\u0016��n��\u001f/�\u0006\u000e�\u0010E\u0005b\u0014��0܄px�v\"���Pi��V.��]\u000f�`�$\u0006\u0018�\u0004�\u0010%\u000b\u0010߂-ua����-[�\u0006��c4��Y�\u0016!������\u00191���\u0010V��? ΊޘA[QE�|\r\u00077_���\u0018�ZBAɗ(4�\u0015��c�V+���~�7�\u0010�{<\u0002�05Y����.��i�ي�U�.�pc�v��l>���\u0007���ȝg�?�����U��k\u001b\u0011��\u0018?��Y�����EA�/�\f:��.c�<�C�V`v'�o\u0004�=\n<�\u0018S�[�gU���7\u0018&����8`)�oĸ��\r۷,rB}��lb\u001a}��?������$�\u0001\u000e���\u0018u��\u000f����/��n�A�\u0000\u0006\u000bu0��\u0014c\u001bá\u0010,x\u0019s��t�H�`ȍ�\u0011\u001c\u0015Awrk�N{�wtƖ\u001c�>[�\u0005X��OW�5�z��\u001a\u0013j��2D��zA�lc\u000e(�cG\u001e�\fn�7�k��A�6\u000b�\r��\u0004%L���]d\u0014�����s�)>�I|7�ބ�A� \u0000��ᦴ�\u0001���P@_�߉���Ŀ][-�\u0019�\u0005���Ҍ9�d\u000e���\u001dW\u0016�g�'�\u0017����s�� �Y!��X?߅��^r,\u001f�>�\u0007�p�\u001a9���Y�B��o�t���g[��\u0005��0��>�4��n_Q\u000fPM�Y\u0001�\u0010�*L��u� �&��%\u0014�^���L!Ie�\\�ܬ���'���\u000b[�G��O���!{����?f�s�p�vF�P:CQĐ\u0014't\fҬ(mQ4b\"�\u001f1���Nr���+���\u0013�c���%۟�|��-���v�i\u0014��>���\"'\f���و��n��hs/�\u0002}bNH��Ꙑ\u0012\\׼�ӉhW�&�n\u0015�\u0012�B_� ���o���[ O\u0005�)�\u001f�Ɨ�P�s9����\u0011ɐ��mgk�n����\u001dC_��j����P\u001c�.�Y\u0007�U\b��S�s{\u001eW=�nv\t,��m�|�o���\u0014��X�<���z�\u0004r��\r(��\u001f%ѷ_���]��t\u0001\u0007�\u0000\r�b�No1F(���\n~q�\u0000��>&d�S\u0003$\t��O+~��N��)��ZSJ���%_����\u0007eS��DB'�O��\u000egi\u0010��y�\n�ƌ�\u0018��Y�e=\u0010���F���<����ڌ����\n��=4\u0015�ou\\��w<c����\u0014�&\u0017�hi\u000b\u0000-)\u0012ڛt�˾�˾�˾�˾�˾�˾�˾�˾�˾|?�����\u0000�\u0000\u0000"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "ACPICA-Core", "Hardware": "i386 Linux", "Importance": "P1 normal", "Assignee": "Lv Zheng", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2013-07-19 12:45 UTC by ronald.vink", "Modified": "2014-06-11 00:15 UTC", "CC List": "3 users", "See Also": "", "Kernel Version": "3.5.4", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/acpi/acpica/evxface.c"], "methods": ["acpi_remove_notify_handler", "acpi_remove_gpe_handler"]}
{"id": "60577", "title": "WiFi doen't work on Intel WiMAX/WiFi Link 5150", "description": "Created attachment 106926 [details]\nlspci -vv\n\nI have notebook Dell 11z with WiMAX/WiFi adapter Intel Link 5150. \nWhen I tried to list network interfaces, i didn't see any WiFi interfaces.\n\n>ifconfig\n\nenp0s29f7u5: flags=129<UP,NOARP>  mtu 1400\n        ether 00:1d:e1:1b:40:a2  txqueuelen 20  (Ethernet)\n        RX packets 0  bytes 0 (0.0 B)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 0  bytes 0 (0.0 B)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\nenp2s0: flags=4099<UP,BROADCAST,MULTICAST>  mtu 1500\n        ether 00:26:b9:c8:83:86  txqueuelen 1000  (Ethernet)\n        RX packets 0  bytes 0 (0.0 B)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 0  bytes 0 (0.0 B)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\nlo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536\n        inet 127.0.0.1  netmask 255.0.0.0\n        inet6 ::1  prefixlen 128  scopeid 0x10<host>\n        loop  txqueuelen 0  (Local Loopback)\n        RX packets 212  bytes 18372 (17.9 KiB)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 212  bytes 18372 (17.9 KiB)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n\nBTW: enp2s0  - ethernet, enp0s29f7u5 - WiMax \n\nModule for my WiFi adapter named iwlwifi.\n> lsmod | grep iwlwifi\n\niwlwifi    173477 0\ncfg        510937 1 iwlwifi\n\n\nBut, when i tried to list pci devices (lspci -vv), i didn't see string  \"driver in use: iwlwifi\" string in this:\n\n08:00.0 Network controller: Intel Corporation WiMAX/WiFi Link 5150\n        Subsystem: Intel Corporation Device 1326\n        Control: I/O- Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr- Stepping- SERR- FastB2B- DisINTx-\n        Status: Cap+ 66MHz- UDF- FastB2B- ParErr- DEVSEL=fast >TAbort- <TAbort- <MAbort- >SERR- <PERR- INTx-\n        Latency: 0, Cache Line Size: 64 bytes\n        Interrupt: pin A routed to IRQ 11\n        Region 0: Memory at f0600000 (64-bit, non-prefetchable) [size=8K]\n        Capabilities: <access denied>\n\n(the full \"lspci -vv\" in the attachment)", "patch": ["From 5e0ca023f0598057c8f01b6d90e602437902f5d3 Mon Sep 17 00:00:00 2001\nFrom: Emmanuel Grumbach <emmanuel.grumbach@intel.com>\nDate: Thu, 18 Jul 2013 19:11:26 +0300\nSubject: [PATCH] iwlwifi: add DELL SKU for 5150 HMC\n\nThis SKU was missing in the list of supported devices\n\nhttps://bugzilla.kernel.org/show_bug.cgi?id=60577\n\nChange-Id: I3b0669dd076f678934decb61bffcb789be51476c\nCc: <stable@vger.kernel.org> [all-versiions]\nSigned-off-by: Emmanuel Grumbach <emmanuel.grumbach@intel.com>\n---\n drivers/net/wireless/iwlwifi/pcie/drv.c | 1 +\n 1 file changed, 1 insertion(+)\n\ndiff --git a/drivers/net/wireless/iwlwifi/pcie/drv.c b/drivers/net/wireless/iwlwifi/pcie/drv.c\nindex de9f5da..654d8da 100644\n--- a/drivers/net/wireless/iwlwifi/pcie/drv.c\n+++ b/drivers/net/wireless/iwlwifi/pcie/drv.c\n@@ -130,6 +130,7 @@ static DEFINE_PCI_DEVICE_TABLE(iwl_hw_card_ids) = {\n \t{IWL_PCI_DEVICE(0x423C, 0x1306, iwl5150_abg_cfg)}, /* Half Mini Card */\n \t{IWL_PCI_DEVICE(0x423C, 0x1221, iwl5150_agn_cfg)}, /* Mini Card */\n \t{IWL_PCI_DEVICE(0x423C, 0x1321, iwl5150_agn_cfg)}, /* Half Mini Card */\n+\t{IWL_PCI_DEVICE(0x423C, 0x1326, iwl5150_abg_cfg)}, /* Half Mini Card */\n \n \t{IWL_PCI_DEVICE(0x423D, 0x1211, iwl5150_agn_cfg)}, /* Mini Card */\n \t{IWL_PCI_DEVICE(0x423D, 0x1311, iwl5150_agn_cfg)}, /* Half Mini Card */\n-- \n1.8.1.msysgit.1\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "network-wireless", "Hardware": "x86-64 Linux", "Importance": "P1 normal", "Assignee": "drivers_network-wireless@kernel-bugs.osdl.org", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2013-07-18 13:18 UTC by Arthur Sudneko", "Modified": "2014-05-08 05:43 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "3.9.9", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/net/wireless/iwlwifi/pcie/drv.c"], "methods": ["DEFINE_PCI_DEVICE_TABLE"]}
{"id": "60519", "title": "Wrong battery information reported on Samsung NP540U3C", "description": "Created attachment 106809 [details]\nOutput of acpidump\n\nThe battery information reported in sysfs is wrong since kernel 2.6.34. In older versions the information is correct.\n\nThe affected device is a Samsung NP540U3C. The output of acpidump is attached.\nThese are the contents of /sys/class/power_supply/BAT1/uevent:\n\nCorrect information on 2.6.33:\nPOWER_SUPPLY_NAME=BAT1\nPOWER_SUPPLY_TYPE=Battery\nPOWER_SUPPLY_STATUS=Full\nPOWER_SUPPLY_PRESENT=1\nPOWER_SUPPLY_TECHNOLOGY=Li-ion\nPOWER_SUPPLY_VOLTAGE_MIN_DESIGN=7500000\nPOWER_SUPPLY_VOLTAGE_NOW=8638000\nPOWER_SUPPLY_CURRENT_NOW=0\nPOWER_SUPPLY_CHARGE_FULL_DESIGN=6890000\nPOWER_SUPPLY_CHARGE_FULL=6800000\nPOWER_SUPPLY_CHARGE_NOW=6800000\nPOWER_SUPPLY_MODEL_NAME=\nPOWER_SUPPLY_MANUFACTURER=SAMSUNG Electronics\nPOWER_SUPPLY_SERIAL_NUMBER=\n\nWrong information on 2.6.34:\nPOWER_SUPPLY_NAME=BAT1\nPOWER_SUPPLY_TYPE=Battery\nPOWER_SUPPLY_STATUS=Unknown\nPOWER_SUPPLY_PRESENT=1\nPOWER_SUPPLY_TECHNOLOGY=Unknown\nPOWER_SUPPLY_CYCLE_COUNT=204\nPOWER_SUPPLY_VOLTAGE_MIN_DESIGN=1000\nPOWER_SUPPLY_VOLTAGE_NOW=8638000\nPOWER_SUPPLY_CURRENT_NOW=0\nPOWER_SUPPLY_POWER_NOW=0\nPOWER_SUPPLY_ENERGY_FULL_DESIGN=1000\nPOWER_SUPPLY_ENERGY_FULL=6890000\nPOWER_SUPPLY_ENERGY_NOW=6800000\nPOWER_SUPPLY_MODEL_NAME=\nPOWER_SUPPLY_MANUFACTURER=LION\nPOWER_SUPPLY_SERIAL_NUMBER=", "patch": ["diff --git a/drivers/acpi/battery.c b/drivers/acpi/battery.c\nindex c760b61..2c9958c 100644\n--- a/drivers/acpi/battery.c\n+++ b/drivers/acpi/battery.c\n@@ -117,6 +117,7 @@ struct acpi_battery {\n \tstruct acpi_device *device;\n \tstruct notifier_block pm_nb;\n \tunsigned long update_time;\n+\tint revision;\n \tint rate_now;\n \tint capacity_now;\n \tint voltage_now;\n@@ -359,6 +360,7 @@ static struct acpi_offsets info_offsets[] = {\n };\n \n static struct acpi_offsets extended_info_offsets[] = {\n+\t{offsetof(struct acpi_battery, revision), 0},\n \t{offsetof(struct acpi_battery, power_unit), 0},\n \t{offsetof(struct acpi_battery, design_capacity), 0},\n \t{offsetof(struct acpi_battery, full_charge_capacity), 0},\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "Power-Battery", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Lan Tianyu", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2013-07-05 14:01 UTC by Jan Hoffmann", "Modified": "2013-10-09 09:07 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "2.6.34", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/acpi/battery.c"], "methods": ["acpi_battery", "info_offsets"]}
{"id": "53441", "title": "hda_intel: sound stops working after suspend to ram", "description": "Created attachment 92591 [details]\ndmesg showing error messages\n\nOn a fresh boot the sound card works fine.\nAfter a few suspends to ram (it doesn't necessarily happen after just one) the sound card stops working well. The sound comes out chopppy, as a series of clicks separated by 2 second or so silences.\n\nI see these messages in the kernel log right after resume:\nhda-intel: azx_get_response timeout, switching to polling mode: last cmd=0x00170503\nhda-intel: No response from codec, disabling MSI: last cmd=0x00170503\nhda_intel: azx_get_response timeout, switching to single_cmd mode: last cmd=0x00170503\n\nThe only way to fix the sound seems to be a reboot.\nI don't have this problem with v3.6.11, it appeared with kernel v3.7.1 (I have not tested v3.7). Right now I'm running 3.7.6 and the problem is still there.\n\n$ lspci  | grep -i audio\n00:1b.0 Audio device: Intel Corporation 5 Series/3400 Series Chipset High Definition Audio (rev 05)\n01:00.1 Audio device: NVIDIA Corporation High Definition Audio Controller (rev a1)\n\n$ lsmod | grep snd\nsnd_hda_codec_hdmi     24993  4 \nsnd_hda_codec_idt      54740  1 \nsnd_hda_intel          24840  6 \nsnd_hda_codec          71155  3 snd_hda_codec_hdmi,snd_hda_codec_idt,snd_hda_intel\nsnd_pcm                74322  3 snd_hda_codec_hdmi,snd_hda_codec,snd_hda_intel\nsnd_page_alloc          7333  2 snd_pcm,snd_hda_intel\nsnd_timer              17563  1 snd_pcm", "patch": ["From 2c1350fdeaefefe1a149d3b083383409f43f0daa Mon Sep 17 00:00:00 2001\nFrom: Takashi Iwai <tiwai@suse.de>\nDate: Thu, 14 Feb 2013 09:44:55 +0100\nSubject: [PATCH] ALSA: hda - Disable runtime PM for Intel 5 Series/3400\n\nWe've got a regression report wrt the IRQ issue related with the\npower-save on a Dell machine, and disabling runtime PM works around.\n\nBugzilla: https://bugzilla.kernel.org/show_bug.cgi?id=53441\n\nCc: <stable@vger.kernel.org> [v3.7+]\nSigned-off-by: Takashi Iwai <tiwai@suse.de>\n---\n sound/pci/hda/hda_intel.c | 2 +-\n 1 file changed, 1 insertion(+), 1 deletion(-)\n\ndiff --git a/sound/pci/hda/hda_intel.c b/sound/pci/hda/hda_intel.c\nindex bb9179e..4cea6bb6 100644\n--- a/sound/pci/hda/hda_intel.c\n+++ b/sound/pci/hda/hda_intel.c\n@@ -3756,7 +3756,7 @@ static DEFINE_PCI_DEVICE_TABLE(azx_ids) = {\n \t  .driver_data = AZX_DRIVER_SCH | AZX_DCAPS_INTEL_PCH },\n \t/* 5 Series/3400 */\n \t{ PCI_DEVICE(0x8086, 0x3b56),\n-\t  .driver_data = AZX_DRIVER_SCH | AZX_DCAPS_INTEL_PCH },\n+\t  .driver_data = AZX_DRIVER_SCH | AZX_DCAPS_INTEL_PCH_NOPM },\n \t/* Poulsbo */\n \t{ PCI_DEVICE(0x8086, 0x811b),\n \t  .driver_data = AZX_DRIVER_SCH | AZX_DCAPS_INTEL_PCH_NOPM },\n-- \n1.8.1.2\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Sound", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Jaroslav Kysela", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2013-02-05 21:40 UTC by Jose Marino", "Modified": "2013-11-12 15:16 UTC", "CC List": "4 users", "See Also": "", "Kernel Version": "3.7.6", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["sound/pci/hda/hda_intel.c"], "methods": ["DEFINE_PCI_DEVICE_TABLE"]}
{"id": "51141", "title": "ACPI display backlight brightness is set to zero at every boot-up - HP Folio 13-2000", "description": "Created attachment 87851 [details]\ndmesg log (kernel 3.6.8)\n\nEvery time I boot-up my notebook's display stays black. Since most of the time I'm using an external display I found out that the backlight brightness in GNOME settings is set to zero – I can temporarily solve the issue by increasing the screen brightness but next time I boot this setting is lost, screen brightness is set back to zero again. Using the kernel boot parameter i915.invert_brightness=1 works fine as workaround.\n\nWhen I looked into /sys/class/backlight/acpi_video0/brightness to confirm that it's set to zero I realized that I have two entries in backlight:\n- 'acpi_video0' (with brightness set to 0, actual_brightness set to 0) and\n- 'intel_backlight' (with brightness set to 4882, actual_brightness set to 0).\n\nWhen I increase screen brightness to 100% in GNOME settings, the values change to:\n- 'acpi_video0' brightness & actual_brightness 10,\n- 'intel_backlight' brightness & actual_brightness 4882.\n\nNext time I boot, ACPI display backlight brightness is set to 0 again.\n\nI'm affected by this bug since kernel v3.6, before that I was affected by Bug #46481. My notebook is a HP Folio 13-200, I'll attach a dmesg-log and the output of acpidump.", "patch": ["From 117af51d695c78bfdf618a183664f0e9f3769b9a Mon Sep 17 00:00:00 2001\nFrom: Zhang Rui <rui.zhang@intel.com>\nDate: Sun, 2 Dec 2012 10:00:41 +0800\nSubject: [PATCH] ACPI video: ignore BIOS initial backlight value for HP Folio\n 13-2000.\n\nOr else the laptop will boot with a dimmed screen.\n\nSigned-off-by: Zhang Rui <rui.zhang@intel.com>\n---\n drivers/acpi/video.c |   14 ++++++++++++++\n 1 file changed, 14 insertions(+)\n\ndiff --git a/drivers/acpi/video.c b/drivers/acpi/video.c\nindex 1e0a9e1..58bddd3 100644\n--- a/drivers/acpi/video.c\n+++ b/drivers/acpi/video.c\n@@ -389,6 +389,12 @@ static int __init video_set_bqc_offset(const struct dmi_system_id *d)\n \treturn 0;\n }\n \n+static int video_ignore_initial_backlight(const struct dmi_system_id *d)\n+{\n+\tuse_bios_initial_backlight = 0;\n+\treturn 0;\n+}\n+\n static struct dmi_system_id video_dmi_table[] __initdata = {\n \t/*\n \t * Broken _BQC workaround http://bugzilla.kernel.org/show_bug.cgi?id=13121\n@@ -433,6 +439,14 @@ static struct dmi_system_id video_dmi_table[] __initdata = {\n \t\tDMI_MATCH(DMI_PRODUCT_NAME, \"Aspire 7720\"),\n \t\t},\n \t},\n+\t{\n+\t .callback = video_ignore_initial_backlight,\n+\t .ident = \"HP Folio 13-2000\",\n+\t .matches = {\n+\t\tDMI_MATCH(DMI_BOARD_VENDOR, \"Hewlett-Packard\"),\n+\t\tDMI_MATCH(DMI_PRODUCT_NAME, \"HP Folio 13 - 2000 Notebook PC\"),\n+\t\t},\n+\t},\n \t{}\n };\n \n-- \n1.7.9.5\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "Other", "Hardware": "All Linux", "Importance": "P1 low", "Assignee": "acpi_other", "URL": "http://bugs.debian.org/cgi-bin/bugrep...", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2012-11-30 00:54 UTC by Stefan Nagy", "Modified": "2013-11-18 07:01 UTC", "CC List": "5 users", "See Also": "", "Kernel Version": "3.6.8", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/acpi/video.c"], "methods": ["video_dmi_table"]}
{"id": "50491", "title": "rmmod/modprobe i7core_edac leads to kernel oops", "description": "If I run the following on my system:\n\n# while rmmod i7core_edac ; do modprobe i7core_edac ; done\n\nI quickly get a flood of warning and error messages in the kernel logs. First I get 3 correct cycles:\n\nEDAC PCI: Removed device 0 for i7core_edac EDAC PCI controller: DEV 0000:ff:03.0\nEDAC MC: Removed device 0 for i7core_edac.c i7 core #0: DEV 0000:ff:03.0\nEDAC MC0: Giving out device to 'i7core_edac.c' 'i7 core #0': DEV 0000:ff:03.0\nEDAC PCI1: Giving out device to module 'i7core_edac' controller 'EDAC PCI controller': DEV '0000:ff:03.0' (POLLED)\nEDAC i7core: Driver loaded, 1 memory controller(s) found.\n\nbut then a first failure occurs:\n\nEDAC PCI: Removed device 3 for i7core_edac EDAC PCI controller: DEV 0000:ff:03.0\nEDAC MC: Removed device 0 for i7core_edac.c i7 core #0: DEV 0000:ff:03.0\nEDAC i7core: Device not found: dev 00.0 PCI ID 8086:2c41\n\nThis last message is repeated a hundred times or so, and finally a WARNING followed by a BUG.\n\n------------[ cut here ]------------\nWARNING: at include/linux/kref.h:42 klist_next+0xba/0x110()\nHardware name: System Product Name\nModules linked in: i7core_edac(+) fuse xt_tcpudp xt_pkttype xt_physdev xt_LOG xt_limit nfsd lockd nfs_acl auth_rpcgss sunrpc bridge stp llc ip6t_REJECT nf_conntrack_ipv6 nf_defrag_ipv6 ip6table_raw ipt_REJECT iptable_raw iptable_filter ip6table_mangle nf_conntrack_netbios_ns nf_conntrack_broadcast nf_conntrack_ipv4 nf_defrag_ipv4 ip_tables xt_conntrack nf_conntrack ip6table_filter ip6_tables x_tables cpufreq_conservative cpufreq_userspace cpufreq_powersave acpi_cpufreq mperf nls_utf8 loop snd_hda_codec_hdmi mt2060 snd_hda_codec_realtek snd_hda_intel snd_hda_codec e1000e container snd_hwdep snd_pcm button edac_core sr_mod dvb_usb_dib0700 dib0090 dib7000p dib7000m dib0070 dvb_usb dib8000 dvb_core dib3000mc rc_core sg iTCO_wdt iTCO_vendor_support coretemp kvm_intel kvm i2c_mux_gpio i2c_mux gpio_ich lpc_ich i2c_i801 crc32c_intel dibx000_common cdrom pcspkr microcode snd_timer snd edd soundcore snd_page_alloc autofs4 radeon ttm rtc_cmos drm_kms_helper drm i2c_algo_bit processor thermal_sys ata_generic [last unloaded: i7core_edac]\nPid: 10962, comm: modprobe Not tainted 3.7.0-rc5 #12\nCall Trace:\n [<ffffffff8104501c>] warn_slowpath_common+0x8c/0xc0\n [<ffffffff81045065>] warn_slowpath_null+0x15/0x20\n [<ffffffff815c34ea>] klist_next+0xba/0x110\n [<ffffffff81317ac0>] ? pci_do_find_bus+0x60/0x60\n [<ffffffff813be319>] next_device+0x9/0x30\n [<ffffffff813beaf9>] bus_find_device+0x69/0x90\n [<ffffffff81317b9b>] pci_get_dev_by_id+0x6b/0xb0\n [<ffffffff81317ce0>] pci_get_subsys+0x30/0x40\n [<ffffffff81317d03>] pci_get_device+0x13/0x20\n [<ffffffffa0331448>] i7core_get_onedevice+0x3c/0x28e [i7core_edac]\n [<ffffffffa033177e>] i7core_probe+0x8e/0x16e [i7core_edac]\n [<ffffffff81316524>] local_pci_probe+0x74/0x100\n [<ffffffff81316679>] __pci_device_probe+0xc9/0xf0\n [<ffffffff81316c05>] pci_device_probe+0x35/0x60\n [<ffffffff813c022f>] really_probe+0x10f/0x2f0\n [<ffffffff813c05bb>] driver_probe_device+0x7b/0xa0\n [<ffffffff813c063f>] __driver_attach+0x5f/0x90\n [<ffffffff813c05e0>] ? driver_probe_device+0xa0/0xa0\n [<ffffffff813be609>] bus_for_each_dev+0x49/0x80\n [<ffffffff813bfe69>] driver_attach+0x19/0x20\n [<ffffffff813bf83b>] bus_add_driver+0xdb/0x260\n [<ffffffffa038d000>] ? 0xffffffffa038cfff\n [<ffffffff813c0c68>] driver_register+0xa8/0x150\n [<ffffffffa038d000>] ? 0xffffffffa038cfff\n [<ffffffff81316d1c>] __pci_register_driver+0x5c/0x70\n [<ffffffffa038d093>] i7core_init+0x93/0x1000 [i7core_edac]\n [<ffffffff8100024a>] do_one_initcall+0x8a/0x160\n [<ffffffff810a99b5>] sys_init_module+0xc5/0x220\n [<ffffffff815ff829>] system_call_fastpath+0x16/0x1b\n---[ end trace e1e91b09c80c8edb ]---\nBUG: unable to handle kernel NULL pointer dereference at 0000000000000030\nIP: [<ffffffff815c30b8>] klist_put+0x28/0xa0\nPGD 13699d067 PUD 137f4d067 PMD 0 \nOops: 0000 [#1] PREEMPT SMP \nModules linked in: i7core_edac(+) fuse xt_tcpudp xt_pkttype xt_physdev xt_LOG xt_limit nfsd lockd nfs_acl auth_rpcgss sunrpc bridge stp llc ip6t_REJECT nf_conntrack_ipv6 nf_defrag_ipv6 ip6table_raw ipt_REJECT iptable_raw iptable_filter ip6table_mangle nf_conntrack_netbios_ns nf_conntrack_broadcast nf_conntrack_ipv4 nf_defrag_ipv4 ip_tables xt_conntrack nf_conntrack ip6table_filter ip6_tables x_tables cpufreq_conservative cpufreq_userspace cpufreq_powersave acpi_cpufreq mperf nls_utf8 loop snd_hda_codec_hdmi mt2060 snd_hda_codec_realtek snd_hda_intel snd_hda_codec e1000e container snd_hwdep snd_pcm button edac_core sr_mod dvb_usb_dib0700 dib0090 dib7000p dib7000m dib0070 dvb_usb dib8000 dvb_core dib3000mc rc_core sg iTCO_wdt iTCO_vendor_support coretemp kvm_intel kvm i2c_mux_gpio i2c_mux gpio_ich lpc_ich i2c_i801 crc32c_intel dibx000_common cdrom pcspkr microcode snd_timer snd edd soundcore snd_page_alloc autofs4 radeon ttm rtc_cmos drm_kms_helper drm i2c_algo_bit processor thermal_sys ata_generic [last unloaded: i7core_edac]\nCPU 6 \nPid: 10962, comm: modprobe Tainted: G        W    3.7.0-rc5 #12 System manufacturer System Product Name/Z8NA-D6(C)\n[26130.232897] RIP: 0010:[<ffffffff815c30b8>]  [<ffffffff815c30b8>] klist_put+0x28/0xa0\nRSP: 0018:ffff880125389af8  EFLAGS: 00010246\nRAX: 0000000000000000 RBX: 0000000000000000 RCX: 00000000cb2dcb2c\nRDX: 00000000000035f0 RSI: 0000000000000000 RDI: 0000000000000000\nRBP: ffff880125389b18 R08: ffffffff81e41cdc R09: ffffffff81e61e20\nR10: 0000000000000044 R11: 000000000001fef0 R12: ffff8801391b24b8\nR13: 0000000000000000 R14: 0000000000000000 R15: 0000000000000001\nFS:  00007fca8695c700(0000) GS:ffff88013f2c0000(0000) knlGS:0000000000000000\nCS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033\nCR2: 0000000000000030 CR3: 00000001357d5000 CR4: 00000000000007e0\nDR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000\nDR3: 0000000000000000 DR6: 00000000ffff0ff0 DR7: 0000000000000400\nProcess modprobe (pid: 10962, threadinfo ffff880125388000, task ffff880037a68700)\nStack:\n ffff880125389b48 ffffffff81317ac0 0000000000000000 ffffffffa0332640\n ffff880125389b38 ffffffff815c314c ffff880125389b38 ffff880125389bb8\n ffff880125389b78 ffffffff813beb0a ffff8801397a68d8 ffff8801391b24b8\nCall Trace:\n [<ffffffff81317ac0>] ? pci_do_find_bus+0x60/0x60\n [<ffffffff815c314c>] klist_iter_exit+0x1c/0x30\n [<ffffffff813beb0a>] bus_find_device+0x7a/0x90\n [<ffffffff81317b9b>] pci_get_dev_by_id+0x6b/0xb0\n [<ffffffff81317ce0>] pci_get_subsys+0x30/0x40\n [<ffffffff81317d03>] pci_get_device+0x13/0x20\n [<ffffffffa0331448>] i7core_get_onedevice+0x3c/0x28e [i7core_edac]\n [<ffffffffa033177e>] i7core_probe+0x8e/0x16e [i7core_edac]\n [<ffffffff81316524>] local_pci_probe+0x74/0x100\n [<ffffffff81316679>] __pci_device_probe+0xc9/0xf0\n [<ffffffff81316c05>] pci_device_probe+0x35/0x60\n [<ffffffff813c022f>] really_probe+0x10f/0x2f0\n [<ffffffff813c05bb>] driver_probe_device+0x7b/0xa0\n [<ffffffff813c063f>] __driver_attach+0x5f/0x90\n [<ffffffff813c05e0>] ? driver_probe_device+0xa0/0xa0\n [<ffffffff813be609>] bus_for_each_dev+0x49/0x80\n [<ffffffff813bfe69>] driver_attach+0x19/0x20\n [<ffffffff813bf83b>] bus_add_driver+0xdb/0x260\n [<ffffffffa038d000>] ? 0xffffffffa038cfff\n [<ffffffff813c0c68>] driver_register+0xa8/0x150\n [<ffffffffa038d000>] ? 0xffffffffa038cfff\n [<ffffffff81316d1c>] __pci_register_driver+0x5c/0x70\n [<ffffffffa038d093>] i7core_init+0x93/0x1000 [i7core_edac]\n [<ffffffff8100024a>] do_one_initcall+0x8a/0x160\n [<ffffffff810a99b5>] sys_init_module+0xc5/0x220\n [<ffffffff815ff829>] system_call_fastpath+0x16/0x1b\nCode: 00 00 00 55 48 89 e5 48 83 ec 20 4c 89 65 e8 49 89 fc 4c 89 75 f8 41 89 f6 48 89 5d e0 4c 89 6d f0 48 8b 1f 48 83 e3 fe 48 89 df <4c> 8b 6b 30 e8 4f 51 03 00 45 84 f6 74 2a 49 8b 04 24 a8 01 74 \nRIP  [<ffffffff815c30b8>] klist_put+0x28/0xa0\n RSP <ffff880125389af8>\nCR2: 0000000000000030\n---[ end trace e1e91b09c80c8edc ]---\n\nA further call to lspci shows the following error:\nlspci: Cannot open /sys/bus/pci/devices/0000:ff:00.0/resource: No such file or directory\nPCI device 0000:ff:00.0 has simply disappeared (symbolic link /sys/bus/pci/devices/0000:ff:00.0 points to a nonexistent directory.)", "patch": ["From: Jean Delvare <jdelvare@suse.de>\nSubject: i7core_edac: Fix PCI device reference count\n\nThe reference count changes done by pci_get_device can be a little\nmisleading when the usage diverges from the most common scheme. The\nreference count of the device passed as the last parameter is always\ndecreased, even if the function returns no new device. So if we are\ngoing to try alternative device IDs, we must manually increment the\ndevice reference count before each retry. If we don't, we end up\ndecreasing the reference count, and after a few modprobe/rmmod cycles\nthe PCI devices will vanish.\n\nSigned-off-by: Jean Delvare <jdelvare@suse.de>\nCc: Mauro Carvalho Chehab <mchehab@redhat.com>\nCc: Alan Cox <alan@linux.intel.com>\n---\nThis should fix the reference count in the success path. The error\npath will need some more care though.\n\n drivers/edac/i7core_edac.c |    9 +++++++--\n 1 file changed, 7 insertions(+), 2 deletions(-)\n\n--- linux-3.7-rc6.orig/drivers/edac/i7core_edac.c\t2012-11-20 19:59:54.000000000 +0100\n+++ linux-3.7-rc6/drivers/edac/i7core_edac.c\t2012-11-20 20:49:48.209144254 +0100\n@@ -1334,14 +1334,19 @@ static int i7core_get_onedevice(struct p\n \t * is at addr 8086:2c40, instead of 8086:2c41. So, we need\n \t * to probe for the alternate address in case of failure\n \t */\n-\tif (dev_descr->dev_id == PCI_DEVICE_ID_INTEL_I7_NONCORE && !pdev)\n+\tif (dev_descr->dev_id == PCI_DEVICE_ID_INTEL_I7_NONCORE && !pdev) {\n+\t\tpci_dev_get(*prev);\t/* pci_get_device will put it */\n \t\tpdev = pci_get_device(PCI_VENDOR_ID_INTEL,\n \t\t\t\t      PCI_DEVICE_ID_INTEL_I7_NONCORE_ALT, *prev);\n+\t}\n \n-\tif (dev_descr->dev_id == PCI_DEVICE_ID_INTEL_LYNNFIELD_NONCORE && !pdev)\n+\tif (dev_descr->dev_id == PCI_DEVICE_ID_INTEL_LYNNFIELD_NONCORE &&\n+\t    !pdev) {\n+\t\tpci_dev_get(*prev);\t/* pci_get_device will put it */\n \t\tpdev = pci_get_device(PCI_VENDOR_ID_INTEL,\n \t\t\t\t      PCI_DEVICE_ID_INTEL_LYNNFIELD_NONCORE_ALT,\n \t\t\t\t      *prev);\n+\t}\n \n \tif (!pdev) {\n \t\tif (*prev) {\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "EDAC", "Hardware": "All Linux", "Importance": "P1 low", "Assignee": "Jean Delvare", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2012-11-13 13:55 UTC by Jean Delvare", "Modified": "2013-11-19 18:44 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "3.0.39", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/edac/i7core_edac.c"], "methods": ["i7core_get_onedevice"]}
{"id": "45921", "title": "resume from hibernate fails when \"Suspend to RAM and standby\" is disabled", "description": "The system in question can't suspend to ram, resume results in a reset and the system hanging in a broken bios (power off required).\n\nHibernate, however, works, but only, if CONFIG_SUSPEND=y and CONFIG_SUSPEND_FREEZER=y, otherwise resume from hibernate fails with two displays full of vertical bars and an otherwise fully locked up system.\n\nThe difference, as far as I can remember, is that if both options are set these vertical bars appear twice shortly on the main display during hibernation, when the options are not set they don't seem to appear.\n\nThe system is an Ivy Bridge system using the integrated HD4000 graphics, so i915 is in use.\n\nThe behavior is the same with 3.5.0 and 3.5.1. Kernel config attached.", "patch": ["From 5c320f6263a0dbf0dc33df63befff9a06a35c562 Mon Sep 17 00:00:00 2001\nFrom: Zhang Rui <rui.zhang@intel.com>\nDate: Wed, 28 Nov 2012 22:26:51 +0800\nSubject: [PATCH] ACPI: do acpisleep dmi check when CONFIG_ACPI_SLEEP is set\n\nThe current acpisleep dmi checks only run when CONFIG_SUSPEND is set.\nAnd this may break hibernation on some platforms when CONFIG_SUSPEND\nis cleared.\nhttps://bugzilla.kernel.org/show_bug.cgi?id=45921\n\nMove acpisleep dmi check into #ifdef CONFIG_ACPI_SLEEP instead.\n\nSigned-off-by: Zhang Rui <rui.zhang@intel.com>\n---\n drivers/acpi/sleep.c |  329 +++++++++++++++++++++++++-------------------------\n 1 file changed, 166 insertions(+), 163 deletions(-)\n\ndiff --git a/drivers/acpi/sleep.c b/drivers/acpi/sleep.c\nindex fdcdbb6..eb6dd2c 100644\n--- a/drivers/acpi/sleep.c\n+++ b/drivers/acpi/sleep.c\n@@ -109,6 +109,167 @@ void __init acpi_old_suspend_ordering(void)\n \told_suspend_ordering = true;\n }\n \n+static int __init init_old_suspend_ordering(const struct dmi_system_id *d)\n+{\n+\tacpi_old_suspend_ordering();\n+\treturn 0;\n+}\n+\n+static int __init init_nvs_nosave(const struct dmi_system_id *d)\n+{\n+\tacpi_nvs_nosave();\n+\treturn 0;\n+}\n+\n+static struct dmi_system_id __initdata acpisleep_dmi_table[] = {\n+\t{\n+\t.callback = init_old_suspend_ordering,\n+\t.ident = \"Abit KN9 (nForce4 variant)\",\n+\t.matches = {\n+\t\tDMI_MATCH(DMI_BOARD_VENDOR, \"http://www.abit.com.tw/\"),\n+\t\tDMI_MATCH(DMI_BOARD_NAME, \"KN9 Series(NF-CK804)\"),\n+\t\t},\n+\t},\n+\t{\n+\t.callback = init_old_suspend_ordering,\n+\t.ident = \"HP xw4600 Workstation\",\n+\t.matches = {\n+\t\tDMI_MATCH(DMI_SYS_VENDOR, \"Hewlett-Packard\"),\n+\t\tDMI_MATCH(DMI_PRODUCT_NAME, \"HP xw4600 Workstation\"),\n+\t\t},\n+\t},\n+\t{\n+\t.callback = init_old_suspend_ordering,\n+\t.ident = \"Asus Pundit P1-AH2 (M2N8L motherboard)\",\n+\t.matches = {\n+\t\tDMI_MATCH(DMI_BOARD_VENDOR, \"ASUSTek Computer INC.\"),\n+\t\tDMI_MATCH(DMI_BOARD_NAME, \"M2N8L\"),\n+\t\t},\n+\t},\n+\t{\n+\t.callback = init_old_suspend_ordering,\n+\t.ident = \"Panasonic CF51-2L\",\n+\t.matches = {\n+\t\tDMI_MATCH(DMI_BOARD_VENDOR,\n+\t\t\t\t\"Matsushita Electric Industrial Co.,Ltd.\"),\n+\t\tDMI_MATCH(DMI_BOARD_NAME, \"CF51-2L\"),\n+\t\t},\n+\t},\n+\t{\n+\t.callback = init_nvs_nosave,\n+\t.ident = \"Sony Vaio VGN-FW21E\",\n+\t.matches = {\n+\t\tDMI_MATCH(DMI_SYS_VENDOR, \"Sony Corporation\"),\n+\t\tDMI_MATCH(DMI_PRODUCT_NAME, \"VGN-FW21E\"),\n+\t\t},\n+\t},\n+\t{\n+\t.callback = init_nvs_nosave,\n+\t.ident = \"Sony Vaio VPCEB17FX\",\n+\t.matches = {\n+\t\tDMI_MATCH(DMI_SYS_VENDOR, \"Sony Corporation\"),\n+\t\tDMI_MATCH(DMI_PRODUCT_NAME, \"VPCEB17FX\"),\n+\t\t},\n+\t},\n+\t{\n+\t.callback = init_nvs_nosave,\n+\t.ident = \"Sony Vaio VGN-SR11M\",\n+\t.matches = {\n+\t\tDMI_MATCH(DMI_SYS_VENDOR, \"Sony Corporation\"),\n+\t\tDMI_MATCH(DMI_PRODUCT_NAME, \"VGN-SR11M\"),\n+\t\t},\n+\t},\n+\t{\n+\t.callback = init_nvs_nosave,\n+\t.ident = \"Everex StepNote Series\",\n+\t.matches = {\n+\t\tDMI_MATCH(DMI_SYS_VENDOR, \"Everex Systems, Inc.\"),\n+\t\tDMI_MATCH(DMI_PRODUCT_NAME, \"Everex StepNote Series\"),\n+\t\t},\n+\t},\n+\t{\n+\t.callback = init_nvs_nosave,\n+\t.ident = \"Sony Vaio VPCEB1Z1E\",\n+\t.matches = {\n+\t\tDMI_MATCH(DMI_SYS_VENDOR, \"Sony Corporation\"),\n+\t\tDMI_MATCH(DMI_PRODUCT_NAME, \"VPCEB1Z1E\"),\n+\t\t},\n+\t},\n+\t{\n+\t.callback = init_nvs_nosave,\n+\t.ident = \"Sony Vaio VGN-NW130D\",\n+\t.matches = {\n+\t\tDMI_MATCH(DMI_SYS_VENDOR, \"Sony Corporation\"),\n+\t\tDMI_MATCH(DMI_PRODUCT_NAME, \"VGN-NW130D\"),\n+\t\t},\n+\t},\n+\t{\n+\t.callback = init_nvs_nosave,\n+\t.ident = \"Sony Vaio VPCCW29FX\",\n+\t.matches = {\n+\t\tDMI_MATCH(DMI_SYS_VENDOR, \"Sony Corporation\"),\n+\t\tDMI_MATCH(DMI_PRODUCT_NAME, \"VPCCW29FX\"),\n+\t\t},\n+\t},\n+\t{\n+\t.callback = init_nvs_nosave,\n+\t.ident = \"Averatec AV1020-ED2\",\n+\t.matches = {\n+\t\tDMI_MATCH(DMI_SYS_VENDOR, \"AVERATEC\"),\n+\t\tDMI_MATCH(DMI_PRODUCT_NAME, \"1000 Series\"),\n+\t\t},\n+\t},\n+\t{\n+\t.callback = init_old_suspend_ordering,\n+\t.ident = \"Asus A8N-SLI DELUXE\",\n+\t.matches = {\n+\t\tDMI_MATCH(DMI_BOARD_VENDOR, \"ASUSTeK Computer INC.\"),\n+\t\tDMI_MATCH(DMI_BOARD_NAME, \"A8N-SLI DELUXE\"),\n+\t\t},\n+\t},\n+\t{\n+\t.callback = init_old_suspend_ordering,\n+\t.ident = \"Asus A8N-SLI Premium\",\n+\t.matches = {\n+\t\tDMI_MATCH(DMI_BOARD_VENDOR, \"ASUSTeK Computer INC.\"),\n+\t\tDMI_MATCH(DMI_BOARD_NAME, \"A8N-SLI Premium\"),\n+\t\t},\n+\t},\n+\t{\n+\t.callback = init_nvs_nosave,\n+\t.ident = \"Sony Vaio VGN-SR26GN_P\",\n+\t.matches = {\n+\t\tDMI_MATCH(DMI_SYS_VENDOR, \"Sony Corporation\"),\n+\t\tDMI_MATCH(DMI_PRODUCT_NAME, \"VGN-SR26GN_P\"),\n+\t\t},\n+\t},\n+\t{\n+\t.callback = init_nvs_nosave,\n+\t.ident = \"Sony Vaio VGN-FW520F\",\n+\t.matches = {\n+\t\tDMI_MATCH(DMI_SYS_VENDOR, \"Sony Corporation\"),\n+\t\tDMI_MATCH(DMI_PRODUCT_NAME, \"VGN-FW520F\"),\n+\t\t},\n+\t},\n+\t{\n+\t.callback = init_nvs_nosave,\n+\t.ident = \"Asus K54C\",\n+\t.matches = {\n+\t\tDMI_MATCH(DMI_SYS_VENDOR, \"ASUSTeK Computer Inc.\"),\n+\t\tDMI_MATCH(DMI_PRODUCT_NAME, \"K54C\"),\n+\t\t},\n+\t},\n+\t{\n+\t.callback = init_nvs_nosave,\n+\t.ident = \"Asus K54HR\",\n+\t.matches = {\n+\t\tDMI_MATCH(DMI_SYS_VENDOR, \"ASUSTeK Computer Inc.\"),\n+\t\tDMI_MATCH(DMI_PRODUCT_NAME, \"K54HR\"),\n+\t\t},\n+\t},\n+\t{},\n+};\n+\n /**\n  * acpi_pm_freeze - Disable the GPEs and suspend EC transactions.\n  */\n@@ -224,6 +385,9 @@ static void acpi_pm_end(void)\n }\n #else /* !CONFIG_ACPI_SLEEP */\n #define acpi_target_sleep_state\tACPI_STATE_S0\n+static struct dmi_system_id __initdata acpisleep_dmi_table[] = {\n+\t{},\n+};\n #endif /* CONFIG_ACPI_SLEEP */\n \n #ifdef CONFIG_SUSPEND\n@@ -382,167 +546,6 @@ static const struct platform_suspend_ops acpi_suspend_ops_old = {\n \t.end = acpi_pm_end,\n \t.recover = acpi_pm_finish,\n };\n-\n-static int __init init_old_suspend_ordering(const struct dmi_system_id *d)\n-{\n-\told_suspend_ordering = true;\n-\treturn 0;\n-}\n-\n-static int __init init_nvs_nosave(const struct dmi_system_id *d)\n-{\n-\tacpi_nvs_nosave();\n-\treturn 0;\n-}\n-\n-static struct dmi_system_id __initdata acpisleep_dmi_table[] = {\n-\t{\n-\t.callback = init_old_suspend_ordering,\n-\t.ident = \"Abit KN9 (nForce4 variant)\",\n-\t.matches = {\n-\t\tDMI_MATCH(DMI_BOARD_VENDOR, \"http://www.abit.com.tw/\"),\n-\t\tDMI_MATCH(DMI_BOARD_NAME, \"KN9 Series(NF-CK804)\"),\n-\t\t},\n-\t},\n-\t{\n-\t.callback = init_old_suspend_ordering,\n-\t.ident = \"HP xw4600 Workstation\",\n-\t.matches = {\n-\t\tDMI_MATCH(DMI_SYS_VENDOR, \"Hewlett-Packard\"),\n-\t\tDMI_MATCH(DMI_PRODUCT_NAME, \"HP xw4600 Workstation\"),\n-\t\t},\n-\t},\n-\t{\n-\t.callback = init_old_suspend_ordering,\n-\t.ident = \"Asus Pundit P1-AH2 (M2N8L motherboard)\",\n-\t.matches = {\n-\t\tDMI_MATCH(DMI_BOARD_VENDOR, \"ASUSTek Computer INC.\"),\n-\t\tDMI_MATCH(DMI_BOARD_NAME, \"M2N8L\"),\n-\t\t},\n-\t},\n-\t{\n-\t.callback = init_old_suspend_ordering,\n-\t.ident = \"Panasonic CF51-2L\",\n-\t.matches = {\n-\t\tDMI_MATCH(DMI_BOARD_VENDOR,\n-\t\t\t\t\"Matsushita Electric Industrial Co.,Ltd.\"),\n-\t\tDMI_MATCH(DMI_BOARD_NAME, \"CF51-2L\"),\n-\t\t},\n-\t},\n-\t{\n-\t.callback = init_nvs_nosave,\n-\t.ident = \"Sony Vaio VGN-FW21E\",\n-\t.matches = {\n-\t\tDMI_MATCH(DMI_SYS_VENDOR, \"Sony Corporation\"),\n-\t\tDMI_MATCH(DMI_PRODUCT_NAME, \"VGN-FW21E\"),\n-\t\t},\n-\t},\n-\t{\n-\t.callback = init_nvs_nosave,\n-\t.ident = \"Sony Vaio VPCEB17FX\",\n-\t.matches = {\n-\t\tDMI_MATCH(DMI_SYS_VENDOR, \"Sony Corporation\"),\n-\t\tDMI_MATCH(DMI_PRODUCT_NAME, \"VPCEB17FX\"),\n-\t\t},\n-\t},\n-\t{\n-\t.callback = init_nvs_nosave,\n-\t.ident = \"Sony Vaio VGN-SR11M\",\n-\t.matches = {\n-\t\tDMI_MATCH(DMI_SYS_VENDOR, \"Sony Corporation\"),\n-\t\tDMI_MATCH(DMI_PRODUCT_NAME, \"VGN-SR11M\"),\n-\t\t},\n-\t},\n-\t{\n-\t.callback = init_nvs_nosave,\n-\t.ident = \"Everex StepNote Series\",\n-\t.matches = {\n-\t\tDMI_MATCH(DMI_SYS_VENDOR, \"Everex Systems, Inc.\"),\n-\t\tDMI_MATCH(DMI_PRODUCT_NAME, \"Everex StepNote Series\"),\n-\t\t},\n-\t},\n-\t{\n-\t.callback = init_nvs_nosave,\n-\t.ident = \"Sony Vaio VPCEB1Z1E\",\n-\t.matches = {\n-\t\tDMI_MATCH(DMI_SYS_VENDOR, \"Sony Corporation\"),\n-\t\tDMI_MATCH(DMI_PRODUCT_NAME, \"VPCEB1Z1E\"),\n-\t\t},\n-\t},\n-\t{\n-\t.callback = init_nvs_nosave,\n-\t.ident = \"Sony Vaio VGN-NW130D\",\n-\t.matches = {\n-\t\tDMI_MATCH(DMI_SYS_VENDOR, \"Sony Corporation\"),\n-\t\tDMI_MATCH(DMI_PRODUCT_NAME, \"VGN-NW130D\"),\n-\t\t},\n-\t},\n-\t{\n-\t.callback = init_nvs_nosave,\n-\t.ident = \"Sony Vaio VPCCW29FX\",\n-\t.matches = {\n-\t\tDMI_MATCH(DMI_SYS_VENDOR, \"Sony Corporation\"),\n-\t\tDMI_MATCH(DMI_PRODUCT_NAME, \"VPCCW29FX\"),\n-\t\t},\n-\t},\n-\t{\n-\t.callback = init_nvs_nosave,\n-\t.ident = \"Averatec AV1020-ED2\",\n-\t.matches = {\n-\t\tDMI_MATCH(DMI_SYS_VENDOR, \"AVERATEC\"),\n-\t\tDMI_MATCH(DMI_PRODUCT_NAME, \"1000 Series\"),\n-\t\t},\n-\t},\n-\t{\n-\t.callback = init_old_suspend_ordering,\n-\t.ident = \"Asus A8N-SLI DELUXE\",\n-\t.matches = {\n-\t\tDMI_MATCH(DMI_BOARD_VENDOR, \"ASUSTeK Computer INC.\"),\n-\t\tDMI_MATCH(DMI_BOARD_NAME, \"A8N-SLI DELUXE\"),\n-\t\t},\n-\t},\n-\t{\n-\t.callback = init_old_suspend_ordering,\n-\t.ident = \"Asus A8N-SLI Premium\",\n-\t.matches = {\n-\t\tDMI_MATCH(DMI_BOARD_VENDOR, \"ASUSTeK Computer INC.\"),\n-\t\tDMI_MATCH(DMI_BOARD_NAME, \"A8N-SLI Premium\"),\n-\t\t},\n-\t},\n-\t{\n-\t.callback = init_nvs_nosave,\n-\t.ident = \"Sony Vaio VGN-SR26GN_P\",\n-\t.matches = {\n-\t\tDMI_MATCH(DMI_SYS_VENDOR, \"Sony Corporation\"),\n-\t\tDMI_MATCH(DMI_PRODUCT_NAME, \"VGN-SR26GN_P\"),\n-\t\t},\n-\t},\n-\t{\n-\t.callback = init_nvs_nosave,\n-\t.ident = \"Sony Vaio VGN-FW520F\",\n-\t.matches = {\n-\t\tDMI_MATCH(DMI_SYS_VENDOR, \"Sony Corporation\"),\n-\t\tDMI_MATCH(DMI_PRODUCT_NAME, \"VGN-FW520F\"),\n-\t\t},\n-\t},\n-\t{\n-\t.callback = init_nvs_nosave,\n-\t.ident = \"Asus K54C\",\n-\t.matches = {\n-\t\tDMI_MATCH(DMI_SYS_VENDOR, \"ASUSTeK Computer Inc.\"),\n-\t\tDMI_MATCH(DMI_PRODUCT_NAME, \"K54C\"),\n-\t\t},\n-\t},\n-\t{\n-\t.callback = init_nvs_nosave,\n-\t.ident = \"Asus K54HR\",\n-\t.matches = {\n-\t\tDMI_MATCH(DMI_SYS_VENDOR, \"ASUSTeK Computer Inc.\"),\n-\t\tDMI_MATCH(DMI_PRODUCT_NAME, \"K54HR\"),\n-\t\t},\n-\t},\n-\t{},\n-};\n #endif /* CONFIG_SUSPEND */\n \n #ifdef CONFIG_HIBERNATION\n@@ -873,13 +876,13 @@ int __init acpi_sleep_init(void)\n \tu8 type_a, type_b;\n #ifdef CONFIG_SUSPEND\n \tint i = 0;\n-\n-\tdmi_check_system(acpisleep_dmi_table);\n #endif\n \n \tif (acpi_disabled)\n \t\treturn 0;\n \n+\tdmi_check_system(acpisleep_dmi_table);\n+\n \tsleep_states[ACPI_STATE_S0] = 1;\n \tprintk(KERN_INFO PREFIX \"(supports S0\");\n \n-- \n1.7.9.5\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Power Management", "Classification": "Unclassified", "Component": "Hibernation/Suspend", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Lan Tianyu", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2012-08-13 23:13 UTC by Andreas Steinmetz", "Modified": "2013-04-12 05:49 UTC", "CC List": "4 users", "See Also": "", "Kernel Version": "3.5", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/acpi/sleep.c"], "methods": ["init_old_suspend_ordering", "init_nvs_nosave", "acpi_sleep_init", "acpisleep_dmi_table"]}
{"id": "43286", "title": "NFS4ERR_SHARE_DENIED errors are translated to EIO", "description": "I noticed while testing against a NetApp filer that the Linux NFSv4 client currently translates NFS4ERR_SHARE_DENIED errors to EIO; it would be nice if this was translated to something more sensible like EACCES.\n\n(This was on an Ubuntu 11.10 client, but AFAICT NFS4ERR_SHARE_DENIED is not\nreferenced in the mainline kernel tree either.)\n\n# uname -a\nLinux kjamieson 3.0.0-19-generic #33-Ubuntu SMP Thu Apr 19 19:05:14 UTC 2012 x86_64 x86_64 x86_64 GNU/Linux\n# strace cat /mnt/file1\nopen(\"/mnt/file1\", O_RDONLY)     = -1 EIO (Input/output error)\n\nNetwork File System\n    [Program Version: 4]\n    [V4 Procedure: COMPOUND (1)]\n    Status: NFS4ERR_SHARE_DENIED (10015)\n    Tag: <EMPTY>\n        length: 0\n        contents: <EMPTY>\n    Operations (count: 3)\n        Opcode: PUTFH (22)\n            Status: NFS4_OK (0)\n        Opcode: SAVEFH (32)\n            Status: NFS4_OK (0)\n        Opcode: OPEN (18)\n            Status: NFS4ERR_SHARE_DENIED (10015)\n\n\nAs a point of comparison, Solaris appears to map NFS4ERR_SHARE_DENIED to EACCES:\n\n# uname -a\nSunOS nas-sol10-vm1 5.10 Generic_139556-08 i86pc i386 i86pc\n# truss cat /mnt/file1\nopen64(\"/mnt/file1\", O_RDONLY)                  Err#13 EACCES", "patch": ["From 6b37f0811928f485322f1f96a1322d999edd21c6 Mon Sep 17 00:00:00 2001\nFrom: Trond Myklebust <Trond.Myklebust@netapp.com>\nDate: Mon, 28 May 2012 11:36:28 -0400\nSubject: [PATCH] NFSv4: Map NFS4ERR_SHARE_DENIED into an EACCES error instead\n of EIO\n\nIf a file OPEN is denied due to a share lock, the resulting\nNFS4ERR_SHARE_DENIED is currently mapped to the default EIO.\nThis patch adds a more appropriate mapping, and brings Linux\ninto line with what Solaris 10 does.\n\nSee https://bugzilla.kernel.org/show_bug.cgi?id=43286\n\nSigned-off-by: Trond Myklebust <Trond.Myklebust@netapp.com>\nCc: stable@vger.kernel.org\n---\n fs/nfs/nfs4proc.c |    2 ++\n 1 files changed, 2 insertions(+), 0 deletions(-)\n\ndiff --git a/fs/nfs/nfs4proc.c b/fs/nfs/nfs4proc.c\nindex af2db2c..42d9e9c 100644\n--- a/fs/nfs/nfs4proc.c\n+++ b/fs/nfs/nfs4proc.c\n@@ -103,6 +103,8 @@ static int nfs4_map_errors(int err)\n \tcase -NFS4ERR_BADOWNER:\n \tcase -NFS4ERR_BADNAME:\n \t\treturn -EINVAL;\n+\tcase -NFS4ERR_SHARE_DENIED:\n+\t\treturn -EACCES;\n \tdefault:\n \t\tdprintk(\"%s could not handle NFSv4 error %d\\n\",\n \t\t\t\t__func__, -err);\n-- \n1.7.7.6\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "File System", "Classification": "Unclassified", "Component": "NFS", "Hardware": "All Linux", "Importance": "P1 low", "Assignee": "Trond Myklebust", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2012-05-23 22:58 UTC by Kevin Jamieson", "Modified": "2012-07-01 09:37 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "3.0", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["fs/nfs/nfs4proc.c"], "methods": ["nfs4_map_errors"]}
{"id": "43163", "title": "[ILK eDP] Black Screen on Boot for Dell Latitude E6410 Intel HD Graphics (panel power sequencing fail?)", "description": "On every boot under 3.3.3 the system starts to a black screen. I can login and startx at which point the screen works. \n\nWhen switching display via Xrandr the other monitor works without issue, however going back to the laptop display makes the black screen come back. Switching back and forth between display several times reactivates the laptop display.\n\nThe system was booting fine in 3.3.1 however xrandr had occasional issues. \n3.1.10 was perfect.", "patch": ["From 131e5764a77571f184d849823fa33d61f9c647b9 Mon Sep 17 00:00:00 2001\nFrom: Daniel Vetter <daniel.vetter@ffwll.ch>\nDate: Thu, 10 May 2012 12:30:46 +0200\nSubject: [PATCH] drm/i915: enable vdd when switching off the eDP panel\n\nWe have one bug report from a validation team that we get the eDP\npanel sequencing still somewhat wrong: We need to enable VDD while\nswitching off the panel and backlight. Unfortunately that reporter\nseems to have fallen off the earth :(\n\nFor another reporter this actually fixes a black panel issue because\nwithout this the backlight/panel gets confused and doesn't light up\nagain.\n\nBugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=46312\nBugzilla: https://bugzilla.kernel.org/show_bug.cgi?id=43163\nTested-by: Vincent Frentzel <zcecc22@gmail.com>\nCc: stable@kernel.org\nSigned-Off-by: Daniel Vetter <daniel.vetter@ffwll.ch>\n---\n drivers/gpu/drm/i915/intel_dp.c |   15 +++++++--------\n 1 file changed, 7 insertions(+), 8 deletions(-)\n\ndiff --git a/drivers/gpu/drm/i915/intel_dp.c b/drivers/gpu/drm/i915/intel_dp.c\nindex a1a5ce7..9b0a38c 100644\n--- a/drivers/gpu/drm/i915/intel_dp.c\n+++ b/drivers/gpu/drm/i915/intel_dp.c\n@@ -1154,7 +1154,7 @@ static void ironlake_edp_panel_off(struct intel_dp *intel_dp)\n \n \tDRM_DEBUG_KMS(\"Turn eDP power off\\n\");\n \n-\tWARN(intel_dp->want_panel_vdd, \"Cannot turn power off while VDD is on\\n\");\n+\tWARN(!intel_dp->want_panel_vdd, \"Need VDD to turn off panel\\n\");\n \tironlake_panel_vdd_off_sync(intel_dp); /* finish any pending work */\n \n \tpp = ironlake_get_pp_control(dev_priv);\n@@ -1266,18 +1266,16 @@ static void intel_dp_prepare(struct drm_encoder *encoder)\n {\n \tstruct intel_dp *intel_dp = enc_to_intel_dp(encoder);\n \n+\n+\t/* Make sure the panel is off before trying to change the mode. But also\n+\t * ensure that we have vdd while we switch off the panel. */\n+\tironlake_edp_panel_vdd_on(intel_dp);\n \tironlake_edp_backlight_off(intel_dp);\n \tironlake_edp_panel_off(intel_dp);\n \n-\t/* Wake up the sink first */\n-\tironlake_edp_panel_vdd_on(intel_dp);\n \tintel_dp_sink_dpms(intel_dp, DRM_MODE_DPMS_ON);\n \tintel_dp_link_down(intel_dp);\n \tironlake_edp_panel_vdd_off(intel_dp, false);\n-\n-\t/* Make sure the panel is off before trying to\n-\t * change the mode\n-\t */\n }\n \n static void intel_dp_commit(struct drm_encoder *encoder)\n@@ -1309,10 +1307,11 @@ intel_dp_dpms(struct drm_encoder *encoder, int mode)\n \tuint32_t dp_reg = I915_READ(intel_dp->output_reg);\n \n \tif (mode != DRM_MODE_DPMS_ON) {\n+\t\t/* Switching the panel off requires vdd. */\n+\t\tironlake_edp_panel_vdd_on(intel_dp);\n \t\tironlake_edp_backlight_off(intel_dp);\n \t\tironlake_edp_panel_off(intel_dp);\n \n-\t\tironlake_edp_panel_vdd_on(intel_dp);\n \t\tintel_dp_sink_dpms(intel_dp, mode);\n \t\tintel_dp_link_down(intel_dp);\n \t\tironlake_edp_panel_vdd_off(intel_dp, false);\n-- \n1.7.10\n\n", "From f8bcb9d62b804df7a11ad819dd5f769e87f8716e Mon Sep 17 00:00:00 2001\nFrom: Daniel Vetter <daniel.vetter@ffwll.ch>\nDate: Thu, 10 May 2012 12:30:46 +0200\nSubject: [PATCH] drm/i915: enable vdd when switching off the eDP panel\n\nWe have one bug report from a validation team that we get the eDP\npanel sequencing still somewhat wrong: We need to enable VDD while\nswitching off the panel and backlight. Unfortunately that reporter\nseems to have fallen off the earth :(\n\nFor another reporter this actually fixes a black panel issue because\nwithout this the backlight/panel gets confused and doesn't light up\nagain.\n\nBugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=46312\nBugzilla: https://bugzilla.kernel.org/show_bug.cgi?id=43163\nTested-by: Vincent Frentzel <zcecc22@gmail.com>\nCc: stable@kernel.org\nSigned-Off-by: Daniel Vetter <daniel.vetter@ffwll.ch>\n\nConflicts:\n\n\tdrivers/gpu/drm/i915/intel_dp.c\n---\n drivers/gpu/drm/i915/intel_dp.c |   15 +++++++--------\n 1 file changed, 7 insertions(+), 8 deletions(-)\n\ndiff --git a/drivers/gpu/drm/i915/intel_dp.c b/drivers/gpu/drm/i915/intel_dp.c\nindex 4b63791..857c173 100644\n--- a/drivers/gpu/drm/i915/intel_dp.c\n+++ b/drivers/gpu/drm/i915/intel_dp.c\n@@ -1148,7 +1148,7 @@ static void ironlake_edp_panel_off(struct intel_dp *intel_dp)\n \n \tDRM_DEBUG_KMS(\"Turn eDP power off\\n\");\n \n-\tWARN(intel_dp->want_panel_vdd, \"Cannot turn power off while VDD is on\\n\");\n+\tWARN(!intel_dp->want_panel_vdd, \"Need VDD to turn off panel\\n\");\n \n \tpp = ironlake_get_pp_control(dev_priv);\n \tpp &= ~(POWER_TARGET_ON | EDP_FORCE_VDD | PANEL_POWER_RESET | EDP_BLC_ENABLE);\n@@ -1259,18 +1259,16 @@ static void intel_dp_prepare(struct drm_encoder *encoder)\n {\n \tstruct intel_dp *intel_dp = enc_to_intel_dp(encoder);\n \n+\n+\t/* Make sure the panel is off before trying to change the mode. But also\n+\t * ensure that we have vdd while we switch off the panel. */\n+\tironlake_edp_panel_vdd_on(intel_dp);\n \tironlake_edp_backlight_off(intel_dp);\n \tironlake_edp_panel_off(intel_dp);\n \n-\t/* Wake up the sink first */\n-\tironlake_edp_panel_vdd_on(intel_dp);\n \tintel_dp_sink_dpms(intel_dp, DRM_MODE_DPMS_ON);\n \tintel_dp_link_down(intel_dp);\n \tironlake_edp_panel_vdd_off(intel_dp, false);\n-\n-\t/* Make sure the panel is off before trying to\n-\t * change the mode\n-\t */\n }\n \n static void intel_dp_commit(struct drm_encoder *encoder)\n@@ -1302,10 +1300,11 @@ intel_dp_dpms(struct drm_encoder *encoder, int mode)\n \tuint32_t dp_reg = I915_READ(intel_dp->output_reg);\n \n \tif (mode != DRM_MODE_DPMS_ON) {\n+\t\t/* Switching the panel off requires vdd. */\n+\t\tironlake_edp_panel_vdd_on(intel_dp);\n \t\tironlake_edp_backlight_off(intel_dp);\n \t\tironlake_edp_panel_off(intel_dp);\n \n-\t\tironlake_edp_panel_vdd_on(intel_dp);\n \t\tintel_dp_sink_dpms(intel_dp, mode);\n \t\tintel_dp_link_down(intel_dp);\n \t\tironlake_edp_panel_vdd_off(intel_dp, false);\n-- \n1.7.10\n\n", "From ef3e993966fd3f13efca9309da30b70553cfdf9c Mon Sep 17 00:00:00 2001\nFrom: Daniel Vetter <daniel.vetter@ffwll.ch>\nDate: Thu, 10 May 2012 12:30:46 +0200\nSubject: [PATCH] drm/i915: enable vdd when switching off the eDP panel\n\nWe have one bug report from a validation team that we get the eDP\npanel sequencing still somewhat wrong: We need to enable VDD while\nswitching off the panel and backlight. Unfortunately that reporter\nseems to have fallen off the earth :(\n\nFor another reporter this actually fixes a black panel issue because\nwithout this the backlight/panel gets confused and doesn't light up\nagain.\n\nv2: I've forgotten to remove the vdd_off call in panel_off which is\nnow bogus. This essentially reverts\n\nv3: the current panel_off code forces off the vdd power, too. Which is\nbogus and resulted in some funny warnings later on when we've tried to\ndo aux channel communications with just the vdd forced on.\n\ncommit 17038de5f16569a25343cf68668f3b657eafb00e\nAuthor: Chris Wilson <chris@chris-wilson.co.uk>\nDate:   Mon Apr 16 22:43:42 2012 +0100\n\n    drm/i915/dp: Flush any outstanding work to turn the VDD off\n\nBugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=46312\nBugzilla: https://bugzilla.kernel.org/show_bug.cgi?id=43163\nTested-by: Vincent Frentzel <zcecc22@gmail.com>\nCc: stable@kernel.org\nSigned-Off-by: Daniel Vetter <daniel.vetter@ffwll.ch>\n\nConflicts:\n\n\tdrivers/gpu/drm/i915/intel_dp.c\n---\n drivers/gpu/drm/i915/intel_dp.c |   17 ++++++++---------\n 1 file changed, 8 insertions(+), 9 deletions(-)\n\ndiff --git a/drivers/gpu/drm/i915/intel_dp.c b/drivers/gpu/drm/i915/intel_dp.c\nindex 4b63791..1d19408 100644\n--- a/drivers/gpu/drm/i915/intel_dp.c\n+++ b/drivers/gpu/drm/i915/intel_dp.c\n@@ -1148,10 +1148,10 @@ static void ironlake_edp_panel_off(struct intel_dp *intel_dp)\n \n \tDRM_DEBUG_KMS(\"Turn eDP power off\\n\");\n \n-\tWARN(intel_dp->want_panel_vdd, \"Cannot turn power off while VDD is on\\n\");\n+\tWARN(!intel_dp->want_panel_vdd, \"Need VDD to turn off panel\\n\");\n \n \tpp = ironlake_get_pp_control(dev_priv);\n-\tpp &= ~(POWER_TARGET_ON | EDP_FORCE_VDD | PANEL_POWER_RESET | EDP_BLC_ENABLE);\n+\tpp &= ~(POWER_TARGET_ON | PANEL_POWER_RESET | EDP_BLC_ENABLE);\n \tI915_WRITE(PCH_PP_CONTROL, pp);\n \tPOSTING_READ(PCH_PP_CONTROL);\n \n@@ -1259,18 +1259,16 @@ static void intel_dp_prepare(struct drm_encoder *encoder)\n {\n \tstruct intel_dp *intel_dp = enc_to_intel_dp(encoder);\n \n+\n+\t/* Make sure the panel is off before trying to change the mode. But also\n+\t * ensure that we have vdd while we switch off the panel. */\n+\tironlake_edp_panel_vdd_on(intel_dp);\n \tironlake_edp_backlight_off(intel_dp);\n \tironlake_edp_panel_off(intel_dp);\n \n-\t/* Wake up the sink first */\n-\tironlake_edp_panel_vdd_on(intel_dp);\n \tintel_dp_sink_dpms(intel_dp, DRM_MODE_DPMS_ON);\n \tintel_dp_link_down(intel_dp);\n \tironlake_edp_panel_vdd_off(intel_dp, false);\n-\n-\t/* Make sure the panel is off before trying to\n-\t * change the mode\n-\t */\n }\n \n static void intel_dp_commit(struct drm_encoder *encoder)\n@@ -1302,10 +1300,11 @@ intel_dp_dpms(struct drm_encoder *encoder, int mode)\n \tuint32_t dp_reg = I915_READ(intel_dp->output_reg);\n \n \tif (mode != DRM_MODE_DPMS_ON) {\n+\t\t/* Switching the panel off requires vdd. */\n+\t\tironlake_edp_panel_vdd_on(intel_dp);\n \t\tironlake_edp_backlight_off(intel_dp);\n \t\tironlake_edp_panel_off(intel_dp);\n \n-\t\tironlake_edp_panel_vdd_on(intel_dp);\n \t\tintel_dp_sink_dpms(intel_dp, mode);\n \t\tintel_dp_link_down(intel_dp);\n \t\tironlake_edp_panel_vdd_off(intel_dp, false);\n-- \n1.7.10\n\n", "From abf91b71b112cce282be9d4df2288c89cb5d03c3 Mon Sep 17 00:00:00 2001\nFrom: Daniel Vetter <daniel.vetter@ffwll.ch>\nDate: Thu, 9 Aug 2012 09:55:29 +0200\nSubject: [PATCH] drm/i915: reorder edp disabling to fix ivb MacBook Air\n\neDP is tons of fun. It turns out that at least the new MacBook Air 5,1\nmodel absolutely doesn't like the new force vdd dance we've introduced\nin\n\ncommit 6cb49835da0426f69a2931bc2a0a8156344b0e41\nAuthor: Daniel Vetter <daniel.vetter@ffwll.ch>\nDate:   Sun May 20 17:14:50 2012 +0200\n\n    drm/i915: enable vdd when switching off the eDP panel\n\nBut that patch also tried to fix some neat edp sequence issue with the\nforce_vdd timings. Closer inspection reveals that we've raised\nforce_vdd only to do the aux channel communication dp_sink_dpms. If we\nmove the edp_panel_off below that, we don't need any force_vdd for the\ndisable sequence, which makes the Air happy.\n\nUnfortunately the reporter of the original bug that the above commit\nfixed is travelling, so we can't test whether this regresses things.\nBut my theory is that since we don't check for any power-off ->\nforce_vdd-on delays in edp_panel_vdd_on, this was the actual\nroot-cause of this failure. With that force_vdd dance completely\neliminated, I'm hopeful the original bug stays fixed, too.\n\nFor reference the old bug, which hopefully doesn't get broken by this:\n\nhttps://bugzilla.kernel.org/show_bug.cgi?id=43163\n\nIn any case, regression fixers win over plain bugfixes, so this needs\nto go in asap.\n\nv2: The crucial pieces seems to be to clear the force_vdd flag\nuncoditionally, too, in edp_panel_off. Looks like this is left behind\nby the firmware somehow.\n\nBugzilla: https://bugzilla.kernel.org/show_bug.cgi?id=45671\nTested-by: Roberto Romer <sildurin@gmail.com>\nCc: stable@vger.kernel.org\nCc: Keith Packard <keithp@keithp.com>\nSigned-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>\n---\n drivers/gpu/drm/i915/intel_dp.c |   14 ++++----------\n 1 file changed, 4 insertions(+), 10 deletions(-)\n\ndiff --git a/drivers/gpu/drm/i915/intel_dp.c b/drivers/gpu/drm/i915/intel_dp.c\nindex 0a56b9a..9bb7616 100644\n--- a/drivers/gpu/drm/i915/intel_dp.c\n+++ b/drivers/gpu/drm/i915/intel_dp.c\n@@ -1171,10 +1171,10 @@ static void ironlake_edp_panel_off(struct intel_dp *intel_dp)\n \n \tDRM_DEBUG_KMS(\"Turn eDP power off\\n\");\n \n-\tWARN(!intel_dp->want_panel_vdd, \"Need VDD to turn off panel\\n\");\n+\tWARN(intel_dp->want_panel_vdd, \"Force VDD must be off to turn off panel\\n\");\n \n \tpp = ironlake_get_pp_control(dev_priv);\n-\tpp &= ~(POWER_TARGET_ON | PANEL_POWER_RESET | EDP_BLC_ENABLE);\n+\tpp &= ~(POWER_TARGET_ON | EDP_FORCE_VDD | PANEL_POWER_RESET | EDP_BLC_ENABLE);\n \tI915_WRITE(PCH_PP_CONTROL, pp);\n \tPOSTING_READ(PCH_PP_CONTROL);\n \n@@ -1285,13 +1285,10 @@ static void intel_dp_prepare(struct drm_encoder *encoder)\n \n \t/* Make sure the panel is off before trying to change the mode. But also\n \t * ensure that we have vdd while we switch off the panel. */\n-\tironlake_edp_panel_vdd_on(intel_dp);\n \tironlake_edp_backlight_off(intel_dp);\n-\tironlake_edp_panel_off(intel_dp);\n-\n \tintel_dp_sink_dpms(intel_dp, DRM_MODE_DPMS_ON);\n+\tironlake_edp_panel_off(intel_dp);\n \tintel_dp_link_down(intel_dp);\n-\tironlake_edp_panel_vdd_off(intel_dp, false);\n }\n \n static void intel_dp_commit(struct drm_encoder *encoder)\n@@ -1324,13 +1321,10 @@ intel_dp_dpms(struct drm_encoder *encoder, int mode)\n \n \tif (mode != DRM_MODE_DPMS_ON) {\n \t\t/* Switching the panel off requires vdd. */\n-\t\tironlake_edp_panel_vdd_on(intel_dp);\n \t\tironlake_edp_backlight_off(intel_dp);\n-\t\tironlake_edp_panel_off(intel_dp);\n-\n \t\tintel_dp_sink_dpms(intel_dp, mode);\n+\t\tironlake_edp_panel_off(intel_dp);\n \t\tintel_dp_link_down(intel_dp);\n-\t\tironlake_edp_panel_vdd_off(intel_dp, false);\n \n \t\tif (is_cpu_edp(intel_dp))\n \t\t\tironlake_edp_pll_off(encoder);\n-- \n1.7.10.4\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Video", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "drivers_video-dri-intel@kernel-bugs.osdl.org", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2012-04-25 17:29 UTC by Vincent Frentzel", "Modified": "2012-08-20 21:56 UTC", "CC List": "3 users", "See Also": "", "Kernel Version": "3.3.3", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/gpu/drm/i915/intel_dp.c"], "methods": ["ironlake_edp_panel_off", "intel_dp_prepare", "intel_dp_dpms"]}
{"id": "43088", "title": "[965GM] hang at DPMS time", "description": "Created attachment 72873 [details]\nlspci -vvnn\n\nHello,\n\nI have the Ubuntu 12.04 beta2 x86_64 with a mainline kernel 3.2.14 installed on a FUJITSU SIEMENS ESPRIMO Mobile M9400 notebook with an Intel Corporation Mobile GM965/GL960 Integrated Graphics Controller (lspci -vvnn attached), and I'm experiencing GPU hangups several times a day (dmesg output attached).\n\nEverything is well as long as I don't leave the computer for long enough for a DPMS powersaving to kick in (set to 5 minutes in Unity). If I'm away long enough, there is a good chance I'll find the GPU hanged up upon return. Unfortunately, I'm not able to reproduce this issue at will and have to wait for it to happen.\n\nIf there is anything I can do to help to resolve this, I'll gladly do so.\n\nMartin Senft", "patch": ["From a423bc65d3ab32cb295783ab5a32d7cd2c631543 Mon Sep 17 00:00:00 2001\nFrom: Chris Wilson <chris@chris-wilson.co.uk>\nDate: Tue, 10 Apr 2012 22:55:05 +0100\nSubject: [PATCH] drm/i915: Wait for all pending operations to the fb before\n disabling the pipe\n\nDuring modeset we have to disable the pipe to reconfigure its timings\nand maybe its size. Userspace may have queued up command buffers that\ndepend upon the pipe running in a certain configuration and so the\ncommands may become confused across the modeset. At the moment, we use a\nless than satisfactory kick-scanline-waits should the GPU hang during\nthe modeset. It should be more reliable to wait for the pending\noperations to complete first, even though we still have a window for\nuserspace to submit a broken command buffer during the modeset.\n\nSigned-off-by: Chris Wilson <chris@chris-wilson.co.uk>\n---\n drivers/gpu/drm/i915/intel_display.c |   29 ++++++-----------------------\n 1 file changed, 6 insertions(+), 23 deletions(-)\n\ndiff --git a/drivers/gpu/drm/i915/intel_display.c b/drivers/gpu/drm/i915/intel_display.c\nindex f446e66..f51345d 100644\n--- a/drivers/gpu/drm/i915/intel_display.c\n+++ b/drivers/gpu/drm/i915/intel_display.c\n@@ -2910,16 +2910,16 @@ static void intel_clear_scanline_wait(struct drm_device *dev)\n \n static void intel_crtc_wait_for_pending_flips(struct drm_crtc *crtc)\n {\n-\tstruct drm_i915_gem_object *obj;\n-\tstruct drm_i915_private *dev_priv;\n+\tstruct drm_device *dev;\n \n \tif (crtc->fb == NULL)\n \t\treturn;\n \n-\tobj = to_intel_framebuffer(crtc->fb)->obj;\n-\tdev_priv = crtc->dev->dev_private;\n-\twait_event(dev_priv->pending_flip_queue,\n-\t\t   atomic_read(&obj->pending_flip) == 0);\n+\tdev = crtc->dev;\n+\n+\tmutex_lock(&dev->struct_mutex);\n+\tintel_finish_fb(crtc->fb);\n+\tmutex_unlock(&dev->struct_mutex);\n }\n \n static bool intel_crtc_driving_pch(struct drm_crtc *crtc)\n@@ -3381,23 +3381,6 @@ static void intel_crtc_disable(struct drm_crtc *crtc)\n \tstruct drm_crtc_helper_funcs *crtc_funcs = crtc->helper_private;\n \tstruct drm_device *dev = crtc->dev;\n \n-\t/* Flush any pending WAITs before we disable the pipe. Note that\n-\t * we need to drop the struct_mutex in order to acquire it again\n-\t * during the lowlevel dpms routines around a couple of the\n-\t * operations. It does not look trivial nor desirable to move\n-\t * that locking higher. So instead we leave a window for the\n-\t * submission of further commands on the fb before we can actually\n-\t * disable it. This race with userspace exists anyway, and we can\n-\t * only rely on the pipe being disabled by userspace after it\n-\t * receives the hotplug notification and has flushed any pending\n-\t * batches.\n-\t */\n-\tif (crtc->fb) {\n-\t\tmutex_lock(&dev->struct_mutex);\n-\t\tintel_finish_fb(crtc->fb);\n-\t\tmutex_unlock(&dev->struct_mutex);\n-\t}\n-\n \tcrtc_funcs->dpms(crtc, DRM_MODE_DPMS_OFF);\n \tassert_plane_disabled(dev->dev_private, to_intel_crtc(crtc)->plane);\n \tassert_pipe_disabled(dev->dev_private, to_intel_crtc(crtc)->pipe);\n-- \n1.7.9.5\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Video", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "drivers_video-dri-intel@kernel-bugs.osdl.org", "URL": "https://bugs.freedesktop.org/show_bug...", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2012-04-10 20:28 UTC by Martin Senft", "Modified": "2012-04-18 22:12 UTC", "CC List": "3 users", "See Also": "", "Kernel Version": "3.2.14", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/gpu/drm/i915/intel_display.c"], "methods": ["intel_crtc_wait_for_pending_flips", "intel_crtc_disable"]}
{"id": "42981", "title": "Processor Aggregator Device is not stable causing FW-OS communication to stop", "description": "Processors' Idling, as defined in \"Processor Aggregator Device\" chapter of ACPI 4.0a spec, isn't stable, it doesn't handle big changes of the active cores well. Slow changes (e.g. 2 cores idled or activated every second) are OK, but drastic changes of the number of active cores cause whole FW-OS communication to stop (communication using ACPI defined interface). It happens especially when bigger number of cores (8 or more) is reactivated.\n\nVersion-Release number of selected component (if applicable):\nI've tested it using kernel 2.6.32 and newer, e.g. 3.1.4 with the same results.\n\nReproducible: Always\n\nSteps to Reproduce:\n1. Request OS to idle 8 or more cores as described in \"Processor Aggregator\nDevice\" chapter of ACPI 4.0a spec.\n2. Request OS to make all cores active.\n3. Repeat steps with bigger number of cores to idle if necessary.\nActual Results:  \nCores are active again but communication with the firmware using ASL code is\nstopped, no _OST response from OS. power_saving processes are hanging.\n\n\nExpected Results:  \nCores are active again.", "patch": ["From 4f078f244f6d7adb0d7e4cdbc42f729a4238f979 Mon Sep 17 00:00:00 2001\nFrom: Stuart Hayes <Stuart_Hayes@Dell.com>\nDate: Wed, 13 Jun 2012 16:10:45 -0500\nSubject: [PATCH] acpi_pad: fix power_saving thread deadlock\nReply-To: Len Brown <lenb@kernel.org>\nOrganization: Intel Open Source Technology Center\n\nThe acpi_pad driver can get stuck in destroy_power_saving_task()\nwaiting for kthread_stop() to stop a power_saving thread.  The problem\nis that the isolated_cpus_lock mutex is owned when\ndestroy_power_saving_task() calls kthread_stop(), which waits for a\npower_saving thread to end, and the power_saving thread tries to\nacquire the isolated_cpus_lock when it calls round_robin_cpu().  This\npatch fixes the issue by making round_robin_cpu() use its own mutex.\n\nhttps://bugzilla.kernel.org/show_bug.cgi?id=42981\n\nCc: stable@vger.kernel.org\nSigned-off-by: Stuart Hayes <Stuart_Hayes@Dell.com>\nSigned-off-by: Len Brown <len.brown@intel.com>\n---\n drivers/acpi/acpi_pad.c | 7 ++++---\n 1 file changed, 4 insertions(+), 3 deletions(-)\n\ndiff --git a/drivers/acpi/acpi_pad.c b/drivers/acpi/acpi_pad.c\nindex f3e959f..af4aad6 100644\n--- a/drivers/acpi/acpi_pad.c\n+++ b/drivers/acpi/acpi_pad.c\n@@ -36,6 +36,7 @@\n #define ACPI_PROCESSOR_AGGREGATOR_DEVICE_NAME \"Processor Aggregator\"\n #define ACPI_PROCESSOR_AGGREGATOR_NOTIFY 0x80\n static DEFINE_MUTEX(isolated_cpus_lock);\n+static DEFINE_MUTEX(round_robin_lock);\n \n static unsigned long power_saving_mwait_eax;\n \n@@ -107,7 +108,7 @@ static void round_robin_cpu(unsigned int tsk_index)\n \tif (!alloc_cpumask_var(&tmp, GFP_KERNEL))\n \t\treturn;\n \n-\tmutex_lock(&isolated_cpus_lock);\n+\tmutex_lock(&round_robin_lock);\n \tcpumask_clear(tmp);\n \tfor_each_cpu(cpu, pad_busy_cpus)\n \t\tcpumask_or(tmp, tmp, topology_thread_cpumask(cpu));\n@@ -116,7 +117,7 @@ static void round_robin_cpu(unsigned int tsk_index)\n \tif (cpumask_empty(tmp))\n \t\tcpumask_andnot(tmp, cpu_online_mask, pad_busy_cpus);\n \tif (cpumask_empty(tmp)) {\n-\t\tmutex_unlock(&isolated_cpus_lock);\n+\t\tmutex_unlock(&round_robin_lock);\n \t\treturn;\n \t}\n \tfor_each_cpu(cpu, tmp) {\n@@ -131,7 +132,7 @@ static void round_robin_cpu(unsigned int tsk_index)\n \ttsk_in_cpu[tsk_index] = preferred_cpu;\n \tcpumask_set_cpu(preferred_cpu, pad_busy_cpus);\n \tcpu_weight[preferred_cpu]++;\n-\tmutex_unlock(&isolated_cpus_lock);\n+\tmutex_unlock(&round_robin_lock);\n \n \tset_cpus_allowed_ptr(current, cpumask_of(preferred_cpu));\n }\n-- \n1.7.11.rc2.2.g02101c9\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "Power-Processor", "Hardware": "x86-64 Linux", "Importance": "P1 high", "Assignee": "Len Brown", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2012-03-23 17:01 UTC by Sebastian Jarosz", "Modified": "2012-07-14 14:50 UTC", "CC List": "4 users", "See Also": "", "Kernel Version": "2.6.32", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/acpi/acpi_pad.c"], "methods": ["round_robin_cpu"]}
{"id": "41672", "title": "backlight control will not work on Lenovo V570", "description": "No backlight options will be available on a Lenovo V570.  I've tried it with several different kernel versions including 3.1-rc3.  In all cases dmesg has the error  ACPI Error: Current brightness invalid. \n\nIt appears the kernel believes the machine is multi-headed.  It does the right thing for the first head it sees and then gets the invalid brightness on the second head which causes it to assume acpi brightness won't work.  The laptop has the standard external D-sub connector for an external monitor, but there is nothing connected to it.  In fact, if I make the ugly hack of commenting out the multihead check in acpi_video_bus_check() then backlight control works fine.\n\nI'll attach the acpidump, dmesg, and ugly hack.", "patch": ["From 79ed9ec8ff5622e7fbc6e05d77154651aeb50717 Mon Sep 17 00:00:00 2001\nFrom: Bill Pemberton <wfp5p@virginia.edu>\nDate: Wed, 24 Aug 2011 14:45:45 -0400\nSubject: [PATCH] Ugly hack to fix backlight on V570\n\nThis is clearly not the right way to fix the problem.  It does,\nhowever, have the effect of fixing the problem.\n---\n drivers/acpi/video.c |   18 +++++++++---------\n 1 files changed, 9 insertions(+), 9 deletions(-)\n\ndiff --git a/drivers/acpi/video.c b/drivers/acpi/video.c\nindex 08a44b5..b0a7ef1 100644\n--- a/drivers/acpi/video.c\n+++ b/drivers/acpi/video.c\n@@ -910,15 +910,15 @@ static int acpi_video_bus_check(struct acpi_video_bus *video)\n \t */\n \n \t/* Does this device support video switching? */\n-\tif (video->cap._DOS || video->cap._DOD) {\n-\t\tif (!video->cap._DOS) {\n-\t\t\tprintk(KERN_WARNING FW_BUG\n-\t\t\t\t\"ACPI(%s) defines _DOD but not _DOS\\n\",\n-\t\t\t\tacpi_device_bid(video->device));\n-\t\t}\n-\t\tvideo->flags.multihead = 1;\n-\t\tstatus = 0;\n-\t}\n+\t/* if (video->cap._DOS || video->cap._DOD) { */\n+\t/* \tif (!video->cap._DOS) { */\n+\t/* \t\tprintk(KERN_WARNING FW_BUG */\n+\t/* \t\t\t\"ACPI(%s) defines _DOD but not _DOS\\n\", */\n+\t/* \t\t\tacpi_device_bid(video->device)); */\n+\t/* \t} */\n+\t/* \tvideo->flags.multihead = 1; */\n+\t/* \tstatus = 0; */\n+\t/* } */\n \n \t/* Does this device support retrieving a video ROM? */\n \tif (video->cap._ROM) {\n-- \n1.7.6\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "Power-Video", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Zhang Rui", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2011-08-24 19:25 UTC by Bill Pemberton", "Modified": "2012-11-29 05:09 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "3.1-rc3", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/acpi/video.c"], "methods": ["acpi_video_bus_check"]}
{"id": "41342", "title": "Audio gain is massively higher in kernel 3.1", "": "Show dependency tree", "description": "The audio volume is much, much louder in 3.1-rc2 and -rc1 compared to kernel 3.0 and earlier for my card:\n\n00:1b.0 Audio device: Intel Corporation 6 Series Chipset Family High Definition Audio Controller (rev 05)\n\tSubsystem: Dell Device 050e\n\tFlags: bus master, fast devsel, latency 0, IRQ 53\n\tMemory at f1c00000 (64-bit, non-prefetchable) [size=16K]\n\tCapabilities: <access denied>\n\tKernel driver in use: snd_hda_intel\n\tKernel modules: snd-hda-intel\n\n\nSound blasts out deafeningly unless I use alsamixer to adjust Master to zero (alsamixer says this is -64dB) and PCM to near to zero (eg a value like 27, ie -29dB).\n\nNote that with kernel 3.0, adjusting PCM in alsamixer does not affect the sound gain, but in 3.1 it (luckily!) does. It's quite difficult to adjust the sound to a non-painful level using gnome-volume control because the gain is biased so high.", "patch": ["diff --git a/sound/pci/hda/patch_realtek.c b/sound/pci/hda/patch_realtek.c\nindex 58717ab..d7ee37d 100644\n--- a/sound/pci/hda/patch_realtek.c\n+++ b/sound/pci/hda/patch_realtek.c\n@@ -1794,6 +1794,7 @@ static const char * const alc_slave_vols[] = {\n \t\"Speaker Playback Volume\",\n \t\"Mono Playback Volume\",\n \t\"Line-Out Playback Volume\",\n+\t\"PCM Playback Volume\",\n \tNULL,\n };\n \n@@ -1808,6 +1809,7 @@ static const char * const alc_slave_sws[] = {\n \t\"Mono Playback Switch\",\n \t\"IEC958 Playback Switch\",\n \t\"Line-Out Playback Switch\",\n+\t\"PCM Playback Switch\",\n \tNULL,\n };\n \n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Sound", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Jaroslav Kysela", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "40982", "Reported": "2011-08-18 08:12 UTC by rocko", "Modified": "2011-08-24 11:30 UTC", "CC List": "4 users", "See Also": "", "Kernel Version": "3.0-rc2", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["sound/pci/hda/patch_realtek.c"], "methods": ["alc_slave_vols", "alc_slave_sws"]}
{"id": "40042", "title": "iwlagn: bad 802.11n performance and \"aggregation not enabled\" flood in dmesg", "description": "Hi.\n\nI'm trying to get 802.11n working with followed card:\n\n   02:00.0 Network controller: Intel Corporation WiFi Link 5100\n\nIt's inside ASUS F6A laptop. I'm connecting it to another machine with:\n   \n   01:00.0 Network controller: Atheros Communications Inc. AR5008 Wireless Network Adapter (rev 01)\n\nAtheros card is in AP mode (with hostapd). And just after connecting I'm getting followed messages:\n\n[132378.252140] iwlagn 0000:02:00.0: iwlagn_tx_agg_start on ra = 00:21:91:f3:c8:a1 tid = 0\n[132404.533559] iwlagn 0000:02:00.0: Aggregation not enabled for tid 0 because load = 3\n[132427.820093] iwlagn 0000:02:00.0: iwlagn_tx_agg_start on ra = 00:21:91:f3:c8:a1 tid = 0\n[132445.826017] iwlagn 0000:02:00.0: Aggregation not enabled for tid 0 because load = 1\n[132448.868061] iwlagn 0000:02:00.0: iwlagn_tx_agg_start on ra = 00:21:91:f3:c8:a1 tid = 0\n[132472.781121] iwlagn 0000:02:00.0: Aggregation not enabled for tid 0 because load = 0\n[132479.995679] iwlagn 0000:02:00.0: Aggregation not enabled for tid 0 because load = 9\n[132482.848072] iwlagn 0000:02:00.0: iwlagn_tx_agg_start on ra = 00:21:91:f3:c8:a1 tid = 0\n[132505.042703] iwlagn 0000:02:00.0: Aggregation not enabled for tid 0 because load = 0\n[132532.848067] iwlagn 0000:02:00.0: iwlagn_tx_agg_start on ra = 00:21:91:f3:c8:a1 tid = 0\n[132551.187911] iwlagn 0000:02:00.0: Aggregation not enabled for tid 0 because load = 0\n\nI'm gettint something around 2.5Mbyte/sec while downloading some large file (fully intranet). Preinstalled Windows Vista is able to download same file at 5-6 mb/sec.", "patch": ["From 2a57013065767d2fe77aacf98395cce3819d7c2a Mon Sep 17 00:00:00 2001\nFrom: Wey-Yi Guy <wey-yi.w.guy@intel.com>\nDate: Mon, 25 Jul 2011 12:16:42 -0700\nSubject: [PATCH 1/1] iwlagn: always trigger aggregation\n\nSigned-off-by: Wey-Yi Guy <wey-yi.w.guy@intel.com>\n---\n drivers/net/wireless/iwlwifi/iwl-agn-rs.c |    2 ++\n 1 files changed, 2 insertions(+), 0 deletions(-)\n\ndiff --git a/drivers/net/wireless/iwlwifi/iwl-agn-rs.c b/drivers/net/wireless/iwlwifi/iwl-agn-rs.c\nindex 3789ff4..8be2b49 100644\n--- a/drivers/net/wireless/iwlwifi/iwl-agn-rs.c\n+++ b/drivers/net/wireless/iwlwifi/iwl-agn-rs.c\n@@ -421,6 +421,8 @@ static int rs_tl_turn_on_agg_for_tid(struct iwl_priv *priv,\n \n \tload = rs_tl_get_load(lq_data, tid);\n \n+\t/* always trigger HT */\n+\tload = IWL_AGG_LOAD_THRESHOLD + 1;\n \tif (load > IWL_AGG_LOAD_THRESHOLD) {\n \t\tIWL_DEBUG_HT(priv, \"Starting Tx agg: STA: %pM tid: %d\\n\",\n \t\t\t\tsta->addr, tid);\n-- \n1.7.0.4\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "network-wireless", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "drivers_network-wireless@kernel-bugs.osdl.org", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2011-07-25 18:46 UTC by Dmitry Nezhevenko", "Modified": "2012-01-13 19:06 UTC", "CC List": "3 users", "See Also": "", "Kernel Version": "3.0", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/net/wireless/iwlwifi/iwl-agn-rs.c"], "methods": ["rs_tl_turn_on_agg_for_tid"]}
{"id": "36082", "title": "samsung-laptop: N150 DMI mismatch", "description": "The samsung-laptop driver fails to load on my laptop (N150), due to a DMI mismatch: the driver expexts N230 to be in the identifier (and product/board name), whereas my laptop only includes N150/N210/N220.\n\nFull DMI output is attached.", "patch": ["--- linux-2.6.39/drivers/platform/x86/samsung-laptop.c.original\t2011-05-28 10:38:05.289823919 +0200\n+++ linux-2.6.39/drivers/platform/x86/samsung-laptop.c\t2011-05-28 11:02:35.831853944 +0200\n@@ -601,12 +601,12 @@ static struct dmi_system_id __initdata s\n \t\t.callback = dmi_check_cb,\n \t},\n \t{\n-\t\t.ident = \"N150/N210/N220/N230\",\n+\t\t.ident = \"N150/N210/N220\",\n \t\t.matches = {\n \t\t\tDMI_MATCH(DMI_SYS_VENDOR,\n \t\t\t\t\t\"SAMSUNG ELECTRONICS CO., LTD.\"),\n-\t\t\tDMI_MATCH(DMI_PRODUCT_NAME, \"N150/N210/N220/N230\"),\n-\t\t\tDMI_MATCH(DMI_BOARD_NAME, \"N150/N210/N220/N230\"),\n+\t\t\tDMI_MATCH(DMI_PRODUCT_NAME, \"N150/N210/N220\"),\n+\t\t\tDMI_MATCH(DMI_BOARD_NAME, \"N150/N210/N220\"),\n \t\t},\n \t\t.callback = dmi_check_cb,\n \t},\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Platform_x86", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "drivers_platform_x86@kernel-bugs.osdl.org", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2011-05-28 11:10 UTC by Daniel Eklöf", "Modified": "2011-08-08 17:28 UTC", "CC List": "3 users", "See Also": "", "Kernel Version": "2.6.39", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/platform/x86/samsung-laptop.c"], "methods": ["dmi_system_id __initdata"]}
{"id": "35472", "title": "[bisected] [r600] radeondrmfb rendering is broken and running X makes GPU lock-up on RV770 CE (Radeon HD 4730)", "description": "with 2.6.37 it's all OK but since 2.6.38 from very framebuffer initialization screen is filled with dense grey lines looking like ugly grid. also per every 3cm on my 1920x1080/23' screen there is a distinctive whitish vertical line.\nwhen X try to startup i can see cursor and can move it around for a while (that grey grid is there too) but kdm does not starting up and GPU locks up.\n\nit is the same with 2.6.39. here is `dmesg|grep drm` for 2.6.39:\n[    0.462282] [drm] Initialized drm 1.1.0 20060810\n[    0.462315] [drm] radeon defaulting to kernel modesetting.\n[    0.462337] [drm] radeon kernel modesetting enabled.\n[    0.462575] [drm] initializing kernel modesetting (RV770 0x1002:0x944E).\n[    0.462608] [drm] register mmio base: 0xFDFE0000\n[    0.462630] [drm] register mmio size: 65536\n[    0.463313] [drm] Detected VRAM RAM=512M, BAR=256M\n[    0.463343] [drm] RAM width 128bits DDR\n[    0.463526] [drm] radeon: 512M of VRAM memory ready\n[    0.463549] [drm] radeon: 512M of GTT memory ready.\n[    0.463571] [drm] Supports vblank timestamp caching Rev 1 (10.10.2010).\n[    0.463594] [drm] Driver supports precise vblank timestamp query.\n[    0.463708] [drm] radeon: irq initialized.\n[    0.463733] [drm] GART: num cpu pages 131072, num gpu pages 131072\n[    0.465260] [drm] Loading RV770 Microcode\n[    0.512429] [drm] ring test succeeded in 1 usecs\n[    0.512544] [drm] radeon: ib pool ready.\n[    0.512584] [drm] ib test succeeded in 0 usecs\n[    0.512609] [drm] Enabling audio support\n[    0.512805] [drm] Radeon Display Connectors\n[    0.512827] [drm] Connector 0:\n[    0.512847] [drm]   DVI-I\n[    0.512868] [drm]   HPD2\n[    0.512889] [drm]   DDC: 0x7e60 0x7e60 0x7e64 0x7e64 0x7e68 0x7e68 0x7e6c 0x7e6c\n[    0.512915] [drm]   Encoders:\n[    0.512936] [drm]     DFP1: INTERNAL_UNIPHY\n[    0.512957] [drm]     CRT2: INTERNAL_KLDSCP_DAC2\n[    0.512979] [drm] Connector 1:\n[    0.512999] [drm]   DIN\n[    0.513028] [drm]   Encoders:\n[    0.513049] [drm]     TV1: INTERNAL_KLDSCP_DAC2\n[    0.513070] [drm] Connector 2:\n[    0.513091] [drm]   DVI-I\n[    0.513111] [drm]   HPD1\n[    0.513132] [drm]   DDC: 0x7e20 0x7e20 0x7e24 0x7e24 0x7e28 0x7e28 0x7e2c 0x7e2c\n[    0.513158] [drm]   Encoders:\n[    0.513179] [drm]     CRT1: INTERNAL_KLDSCP_DAC1\n[    0.513201] [drm]     DFP2: INTERNAL_KLDSCP_LVTMA\n[    0.577285] [drm] Internal thermal controller without fan control\n[    0.578307] [drm] radeon: power management initialized\n[    0.657478] [drm] fb mappable at 0xD0142000\n[    0.657500] [drm] vram apper at 0xD0000000\n[    0.657521] [drm] size 8294400\n[    0.657541] [drm] fb depth is 24\n[    0.657562] [drm]    pitch is 7680\n[    0.657632] fbcon: radeondrmfb (fb0) is primary device\n[    1.073319] fb0: radeondrmfb frame buffer device\n[    1.073349] drm: registered panic notifier\n[    1.073379] [drm] Initialized radeon 2.9.0 20080528 for 0000:01:00.0 on minor 0\n[  252.565034] WARNING: at drivers/gpu/drm/radeon/radeon_fence.c:246 radeon_fence_wait+0x3a6/0x400()\n[  252.565102]  [<ffffffff8137c334>] ? drm_ioctl+0x394/0x450\n[  252.565145] [drm] Disabling audio support\n[  252.731618] [drm] ring test succeeded in 1 usecs\n[  252.908838] [drm:r600_ib_test] *ERROR* radeon: ib test failed (scratch(0x8504)=0xCAFEDEAD)\n[  252.908841] [drm:rv770_resume] *ERROR* radeon: failed testing IB (-22).\n[  267.523039] WARNING: at drivers/gpu/drm/radeon/radeon_fence.c:246 radeon_fence_wait+0x3a6/0x400()\n[  267.523107]  [<ffffffff8137c334>] ? drm_ioctl+0x394/0x450\n[  268.216464] [drm] ring test succeeded in 1 usecs\n[  268.216473] [drm] ib test succeeded in 1 usecs\n[  268.216475] [drm] Enabling audio support\n[  273.719044] WARNING: at drivers/gpu/drm/radeon/radeon_fence.c:246 radeon_fence_wait+0x3a6/0x400()\n[  273.719114]  [<ffffffff8137c334>] ? drm_ioctl+0x394/0x450\n[  273.719159] [drm] Disabling audio support\n[  274.411517] [drm] ring test succeeded in 1 usecs\n[  274.588784] [drm:r600_ib_test] *ERROR* radeon: ib test failed (scratch(0x8504)=0xCAFEDEAD)\n[  274.588787] [drm:rv770_resume] *ERROR* radeon: failed testing IB (-22).\n[  290.090036] WARNING: at drivers/gpu/drm/radeon/radeon_fence.c:246 radeon_fence_wait+0x3a6/0x400()\n[  290.090103]  [<ffffffff8137c334>] ? drm_ioctl+0x394/0x450\n[  290.779828] [drm] ring test succeeded in 1 usecs\n[  290.957091] [drm:r600_ib_test] *ERROR* radeon: ib test failed (scratch(0x8504)=0xCAFEDEAD)\n[  290.957094] [drm:rv770_resume] *ERROR* radeon: failed testing IB (-22).\n[  306.459037] WARNING: at drivers/gpu/drm/radeon/radeon_fence.c:246 radeon_fence_wait+0x3a6/0x400()\n[  306.459105]  [<ffffffff8137c334>] ? drm_ioctl+0x394/0x450\n[  307.153106] [drm] ring test succeeded in 1 usecs\n[  307.330842] [drm:r600_ib_test] *ERROR* radeon: ib test failed (scratch(0x8504)=0xCAFEDEAD)\n[  307.330845] [drm:rv770_resume] *ERROR* radeon: failed testing IB (-22).", "patch": ["From bc239235f154b113c93a506b716b00ce81c3f5b8 Mon Sep 17 00:00:00 2001\nFrom: Alex Deucher <alexdeucher@gmail.com>\nDate: Wed, 29 Jun 2011 09:36:04 -0400\nSubject: [PATCH] drm/radeon/kms: Fix chremap setup on RV770 CE\n\nCE variant requires a different chremap setup.\n\nFixes:\nhttps://bugzilla.kernel.org/show_bug.cgi?id=35472\n\nSigned-off-by: Alex Deucher <alexdeucher@gmail.com>\nCc: stable@kernel.org\n---\n drivers/gpu/drm/radeon/rv770.c |    6 ++++++\n 1 files changed, 6 insertions(+), 0 deletions(-)\n\ndiff --git a/drivers/gpu/drm/radeon/rv770.c b/drivers/gpu/drm/radeon/rv770.c\nindex 6f508ff..8bb347d 100644\n--- a/drivers/gpu/drm/radeon/rv770.c\n+++ b/drivers/gpu/drm/radeon/rv770.c\n@@ -575,6 +575,12 @@ static void rv770_program_channel_remap(struct radeon_device *rdev)\n \telse\n \t\ttcp_chan_steer = 0x00fac688;\n \n+\t/* RV770 CE has special chremap setup */\n+\tif (rdev->pdev->device == 0x944e) {\n+\t\ttcp_chan_steer = 0x00b08b08;\n+\t\tmc_shared_chremap = 0x00b08b08;\n+\t}\n+\n \tWREG32(TCP_CHAN_STEER, tcp_chan_steer);\n \tWREG32(MC_SHARED_CHREMAP, mc_shared_chremap);\n }\n-- \n1.7.1.1\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Video", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "drivers_video-dri", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2011-05-20 04:03 UTC by Sergey Kondakov", "Modified": "2011-07-05 11:38 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "2.6.38", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/gpu/drm/radeon/rv770.c"], "methods": ["rv770_program_channel_remap"]}
{"id": "34252", "title": "Unexpected behaviour when switching video cards with vga_switcheroo", "": "Show dependency tree", "description": "Created attachment 56262 [details]\nKernel config\n\nTrying to setup script, that switches video cards, I ran into the situation when I left with a black screen not possible to do anything with the system.\nHere is an example:\n\n# cat /sys/kernel/debug/vgaswitcheroo/switch\n0:IGD:+:Pwr:0000:01:05.0\n1:DIS: :Pwr:0000:02:00.0\n# echo IGD > /sys/kernel/debug/vgaswitcheroo/switch\n# cat /sys/kernel/debug/vgaswitcheroo/switch\n0:IGD:+:Off:0000:01:05.0\n1:DIS: :Pwr:0000:02:00.0\n\nI think that this behaviour is buggy and this should not happen.\n\nEnvironment:\n# lspci | grep -i vga\n01:05.0 VGA compatible controller: ATI Technologies Inc RS780M/RS780MN [Radeon HD 3200 Graphics]\n02:00.0 VGA compatible controller: ATI Technologies Inc M93 [Mobility Radeon HD 4500 Series]\n# uname -a\nLinux garik-laptop 2.6.39-rc5+ #8 SMP Sat Apr 30 18:36:12 MSD 2011 x86_64 AMD Athlon(tm) Neo Processor MV-40 AuthenticAMD GNU/Linux", "patch": ["commit 871be6ce12b6035d4eba4a06a10c365254426569\nAuthor: Florian Mickler <florian@mickler.org>\nDate:   Thu May 12 15:53:00 2011 +0200\n\n    vga_switcheroo: don't toggle-switch devices\n    \n    If the requested device is already active, ignore the request.\n    \n    This restores the original behaviour of the interface. The change was\n    probably an unintended side effect of\n    \n    commit 66b37c6777c4 vga_switcheroo: split switching into two stages\n    \n    which did not take into account to duplicate the !active check in the split-off\n    stage2.\n    \n    Fix this by factoring that check out of stage1 into the debugfs_write routine.\n    \n    References: https://bugzilla.kernel.org/show_bug.cgi?id=34252\n    Reported-by: Igor Murzov <e-mail@date.by>\n    Signed-off-by: Florian Mickler <florian@mickler.org>\n    CC: Dave Airlie <airlied@redhat.com>\n\ndiff --git a/drivers/gpu/vga/vga_switcheroo.c b/drivers/gpu/vga/vga_switcheroo.c\nindex e01cacb..498b284 100644\n--- a/drivers/gpu/vga/vga_switcheroo.c\n+++ b/drivers/gpu/vga/vga_switcheroo.c\n@@ -219,9 +219,6 @@ static int vga_switchto_stage1(struct vga_switcheroo_client *new_client)\n \tint i;\n \tstruct vga_switcheroo_client *active = NULL;\n \n-\tif (new_client->active == true)\n-\t\treturn 0;\n-\n \tfor (i = 0; i < VGA_SWITCHEROO_MAX_CLIENTS; i++) {\n \t\tif (vgasr_priv.clients[i].active == true) {\n \t\t\tactive = &vgasr_priv.clients[i];\n@@ -372,6 +369,9 @@ vga_switcheroo_debugfs_write(struct file *filp, const char __user *ubuf,\n \t\tgoto out;\n \t}\n \n+\tif (client->active == true)\n+\t\tgoto out;\n+\n \t/* okay we want a switch - test if devices are willing to switch */\n \tcan_switch = true;\n \tfor (i = 0; i < VGA_SWITCHEROO_MAX_CLIENTS; i++) {\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Video", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "drivers_video-dri", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "27352", "Reported": "2011-05-02 22:39 UTC by Igor Murzov", "Modified": "2011-05-19 07:27 UTC", "CC List": "5 users", "See Also": "", "Kernel Version": "2.6.39-rc5", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/gpu/vga/vga_switcheroo.c"], "methods": ["vga_switchto_stage1", "vga_switcheroo_debugfs_write"]}
{"id": "33812", "title": "radeon with modeset option causes oops as secondary adapter (vgaswitcheroo)", "": "Show dependency tree", "description": "Created attachment 54942 [details]\nkernel log\n\nSystem: Lenovo ThinkPad T500\n00:02.0 VGA compatible controller: Intel Corporation Mobile 4 Series Chipset Integrated Graphics Controller (rev 07)\n01:00.0 VGA compatible controller: ATI Technologies Inc Mobility Radeon HD 3650\nusing vgaswitcheroo\n\nTrying to load radeon (as a module or in kernel) with modeset not explicitly disabled causes a kernel NULL pointer dereference if i915 has initialised the fb console already. \nThat behaviour did not occur in 2.6.38, only after upgrading to 2.6.38.3 (haven't had the time to bisect yet).\n\nIf I disable switching in the BIOS and move to the radeon card as exclusive adapter, everything works fine. with dual graphics stack", "patch": ["From 498ba6b7d0530e4829e3d3f4065eb34f877d9b14 Mon Sep 17 00:00:00 2001\nFrom: Dave Airlie <airlied@redhat.com>\nDate: Sun, 1 May 2011 19:30:13 +1000\nSubject: [PATCH] drm/radeon: fix regression on atom cards with hardcoded EDID record.\n\nSince fafcf94e2b5732d1e13b440291c53115d2b172e9 introduced an edid size, it seems to have broken this path.\n\nThis manifest as oops on T500 Lenovo laptops with dual graphics primarily.\n\nShould fix: https://bugzilla.kernel.org/show_bug.cgi?id=33812\n\nSigned-off-by: Dave Airlie <airlied@redhat.com>\ncc: stable@kernel.org\n---\n drivers/gpu/drm/radeon/radeon_atombios.c |    5 +++--\n 1 files changed, 3 insertions(+), 2 deletions(-)\n\ndiff --git a/drivers/gpu/drm/radeon/radeon_atombios.c b/drivers/gpu/drm/radeon/radeon_atombios.c\nindex f5d12fb..f116516 100644\n--- a/drivers/gpu/drm/radeon/radeon_atombios.c\n+++ b/drivers/gpu/drm/radeon/radeon_atombios.c\n@@ -1599,9 +1599,10 @@ struct radeon_encoder_atom_dig *radeon_atombios_get_lvds_info(struct\n \t\t\t\t\t\t\tmemcpy((u8 *)edid, (u8 *)&fake_edid_record->ucFakeEDIDString[0],\n \t\t\t\t\t\t\t       fake_edid_record->ucFakeEDIDLength);\n \n-\t\t\t\t\t\t\tif (drm_edid_is_valid(edid))\n+\t\t\t\t\t\t\tif (drm_edid_is_valid(edid)) {\n \t\t\t\t\t\t\t\trdev->mode_info.bios_hardcoded_edid = edid;\n-\t\t\t\t\t\t\telse\n+\t\t\t\t\t\t\t\trdev->mode_info.bios_hardcoded_edid_size = edid_size;\n+\t\t\t\t\t\t\t} else\n \t\t\t\t\t\t\t\tkfree(edid);\n \t\t\t\t\t\t}\n \t\t\t\t\t}\n-- \n1.7.4.2\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Video", "Hardware": "All Linux", "Importance": "P1 high", "Assignee": "Dave Airlie", "URL": "", "Keywords": "", "Duplicates (2)": "33422 34022", "Depends on": "", "Blocks": "32012", "Reported": "2011-04-21 23:14 UTC by Johannes Engel", "Modified": "2011-05-04 16:33 UTC", "CC List": "7 users", "See Also": "", "Kernel Version": "2.6.38", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/gpu/drm/radeon/radeon_atombios.c"], "methods": ["*radeon_atombios_get_lvds_info"]}
{"id": "33232", "title": "WARNING: at /build/buildd/linux-2.6.38/net/wireless/scan.c:591 cfg80211_inform_bss_frame 0x1da/0x1f0 [cfg80211]()", "description": "Hello\nReported just to keep track, system seems to work.\n\n- latest updates installed\n- window with stop sign displayed on desktop every time after full loading re kernel developed a serious problem ....\n- os still functional in spite of above mssge (can perform updates, use mail, browse)\n\nProblemType: KernelOops\nDistroRelease: Ubuntu 11.04\nPackage: linux-image-2.6.38-8-generic 2.6.38-8.42\n\n[   52.942507] WARNING: at /build/buildd/linux-2.6.38/net/wireless/scan.c:591 cfg80211_inform_bss_frame+0x1da/0x1f0 [cfg80211]()\n[   52.942509] Hardware name: GA-MA78GM-S2HP\n[   52.942510] Modules linked in: binfmt_misc nls_iso8859_1 nls_cp437 vfat fat snd_hda_codec_hdmi arc4 snd_hda_codec_realtek snd_usb_audio snd_hda_intel snd_hda_codec zd1211rw ppdev mac80211 snd_pcm snd_hwdep snd_usbmidi_lib snd_seq_midi snd_rawmidi snd_seq_midi_event radeon snd_seq snd_timer psmouse snd_seq_device cfg80211 serio_raw uvcvideo videodev v4l2_compat_ioctl32 ttm snd k10temp edac_core drm_kms_helper edac_mce_amd parport_pc sp5100_tco i2c_piix4 drm xhci_hcd soundcore snd_page_alloc i2c_algo_bit lp parport usbhid hid usb_storage uas ahci floppy firewire_ohci firewire_core crc_itu_t r8169 pata_atiixp libahci\n[   52.942537] Pid: 0, comm: kworker/0:1 Not tainted 2.6.38-8-generic #42-Ubuntu\n[   52.942539] Call Trace:\n[   52.942541]  <IRQ>  [<ffffffff81065cef>] ? warn_slowpath_common+0x7f/0xc0\n[   52.942548]  [<ffffffff81065d4a>] ? warn_slowpath_null+0x1a/0x20\n[   52.942553]  [<ffffffffa033403a>] ? cfg80211_inform_bss_frame+0x1da/0x1f0 [cfg80211]\n[   52.942557]  [<ffffffff8144d2d6>] ? ehci_qtd_alloc.clone.58+0x16/0x60\n[   52.942560]  [<ffffffff814377bc>] ? usb_hcd_link_urb_to_ep+0x8c/0xc0\n[   52.942569]  [<ffffffffa038b875>] ? ieee80211_bss_info_update+0x55/0x220 [mac80211]\n[   52.942574]  [<ffffffffa038bb58>] ? ieee80211_scan_rx+0x118/0x190 [mac80211]\n[   52.942582]  [<ffffffffa03a0177>] ? ieee80211_prepare_and_rx_handle+0x217/0x260 [mac80211]\n[   52.942589]  [<ffffffffa03a035f>] ? __ieee80211_rx_handle_packet+0x19f/0x300 [mac80211]\n[   52.942596]  [<ffffffffa03a05da>] ? ieee80211_rx+0x11a/0x1d0 [mac80211]\n[   52.942598]  [<ffffffff81450944>] ? ehci_irq+0x174/0x230\n[   52.942603]  [<ffffffffa0386c11>] ? ieee80211_tasklet_handler+0xd1/0xe0 [mac80211]\n[   52.942605]  [<ffffffff8106cc43>] ? tasklet_action+0x73/0x120\n[   52.942607]  [<ffffffff8106d538>] ? __do_softirq+0xa8/0x1c0\n[   52.942610]  [<ffffffff81030518>] ? ack_apic_level+0x78/0x1a0\n[   52.942613]  [<ffffffff8100cf1c>] ? call_softirq+0x1c/0x30\n[   52.942615]  [<ffffffff8100ea45>] ? do_softirq+0x65/0xa0\n[   52.942617]  [<ffffffff8106d755>] ? irq_exit+0x85/0x90\n[   52.942620]  [<ffffffff815caec6>] ? do_IRQ+0x66/0xe0\n[   52.942622]  [<ffffffff815c3213>] ? ret_from_intr+0x0/0x15\n[   52.942623]  <EOI>  [<ffffffff810d975b>] ? rcu_needs_cpu+0x6b/0x270\n[   52.942628]  [<ffffffff81037f0b>] ? native_safe_halt+0xb/0x10\n[   52.942631]  [<ffffffff81014801>] ? default_idle+0x41/0xe0\n[   52.942634]  [<ffffffff8100a266>] ? cpu_idle+0xa6/0xf0\n[   52.942636]  [<ffffffff815bc743>] ? start_secondary+0xbc/0xbe\n[   52.942638] ---[ end trace 683bef0bfcfd6f92 ]---\n\nOthers log files in the linked Launchpad URL\n\nThanks\nFabio", "patch": ["zd1211rw: fix invalid signal values from device\n\nFrom: Jussi Kivilinna <jussi.kivilinna@mbnet.fi>\n\nDriver uses IEEE80211_HW_SIGNAL_UNSPEC and so signal values reported to\nmac80211 should be in range 0..100. Sometimes device return out of range\nvalues. This patch adds checks to enforce range returned from driver to\nmac80211 be in 0..100 range.\n\nSigned-off-by: Jussi Kivilinna <jussi.kivilinna@mbnet.fi>\n---\n drivers/net/wireless/zd1211rw/zd_mac.c |   13 +++++++++++--\n 1 files changed, 11 insertions(+), 2 deletions(-)\n\ndiff --git a/drivers/net/wireless/zd1211rw/zd_mac.c b/drivers/net/wireless/zd1211rw/zd_mac.c\nindex 5037c8b..ec7bcb0 100644\n--- a/drivers/net/wireless/zd1211rw/zd_mac.c\n+++ b/drivers/net/wireless/zd1211rw/zd_mac.c\n@@ -160,6 +160,15 @@ static int zd_reg2alpha2(u8 regdomain, char *alpha2)\n \treturn 1;\n }\n \n+static inline int zd_check_signal(int signal)\n+{\n+\tif (signal < 0)\n+\t\treturn 0;\n+\tif (signal > 100)\n+\t\treturn 100;\n+\treturn signal;\n+}\n+\n int zd_mac_preinit_hw(struct ieee80211_hw *hw)\n {\n \tint r;\n@@ -461,7 +470,7 @@ static void zd_mac_tx_status(struct ieee80211_hw *hw, struct sk_buff *skb,\n \tif (i<IEEE80211_TX_MAX_RATES)\n \t\tinfo->status.rates[i].idx = -1; /* terminate */\n \n-\tinfo->status.ack_signal = ackssi;\n+\tinfo->status.ack_signal = zd_check_signal(ackssi);\n \tieee80211_tx_status_irqsafe(hw, skb);\n }\n \n@@ -982,7 +991,7 @@ int zd_mac_rx(struct ieee80211_hw *hw, const u8 *buffer, unsigned int length)\n \n \tstats.freq = zd_channels[_zd_chip_get_channel(&mac->chip) - 1].center_freq;\n \tstats.band = IEEE80211_BAND_2GHZ;\n-\tstats.signal = status->signal_strength;\n+\tstats.signal = zd_check_signal(status->signal_strength);\n \n \trate = zd_rx_rate(buffer, status);\n \n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Networking", "Classification": "Unclassified", "Component": "Wireless", "Hardware": "All Linux", "Importance": "P1 low", "Assignee": "networking_wireless@kernel-bugs.osdl.org", "URL": "https://bugs.launchpad.net/ubuntu/+so...", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2011-04-13 18:48 UTC by njin", "Modified": "2012-06-14 17:50 UTC", "CC List": "3 users", "See Also": "", "Kernel Version": "2.6.38", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/net/wireless/zd1211rw/zd_mac.c"], "methods": ["zd_mac_tx_status", "zd_mac_rx"]}
{"id": "32592", "title": "Asus UL30VT backlight control only works with acpi_osi=\"Linux\" acpi_osi=\"!Windows 2009\"", "description": "Created attachment 53362 [details]\nAsus UL30VT Bios 211 DSDT\n\nAsus UL30VT backlight control only works with acpi_osi=\"Linux\" acpi_osi=\"!Windows 2009\".  Without these options, I get a desktop notification for the brightness when using the Fn brightness up/down keys, but no change in display brightness.  Likewise the sysfs brightness control thinks it's doing it's job when I read and write the file, but there's no change in the display state.  Either method causes the display brightness to change when the system is rebooted, as if Linux setup the change, but didn't actually flush it out to hardware.", "patch": ["diff --git a/drivers/acpi/video_detect.c b/drivers/acpi/video_detect.c\nindex b728880..db05f3b 100644\n--- a/drivers/acpi/video_detect.c\n+++ b/drivers/acpi/video_detect.c\n@@ -156,6 +156,14 @@ static struct dmi_system_id video_detect_dmi_table[] = {\n \t\tDMI_MATCH(DMI_BOARD_NAME, \"X360\"),\n \t\t},\n \t},\n+        {\n+         .callback = video_detect_force_vendor,\n+         .ident = \"Asus UL30VT\",\n+         .matches = {\n+                DMI_MATCH(DMI_SYS_VENDOR, \"ASUSTeK Computer Inc.\"),\n+                DMI_MATCH(DMI_PRODUCT_NAME, \"UL30VT\"),\n+                },\n+        },\n \t{ },\n };\n \n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "Power-Video", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Lan Tianyu", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2011-04-04 03:16 UTC by Alex Williamson", "Modified": "2013-02-08 18:31 UTC", "CC List": "5 users", "See Also": "", "Kernel Version": "3.2", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/acpi/video_detect.c"], "methods": ["video_detect_dmi_table"]}
{"id": "32402", "title": "Oops associated with radeon_unpin_work_func", "description": "If this system (LFS build) is left idle for several hours with xscreensaver running(don't currently know which screen saver app. I am assuming one of the Mesa 3D ones) the system will oops. The system is locked solid and there is no trace in messages.old on reboot. The attached jpg is a photo of the screen at system failure. I first noticed the problem in 2.6.38-rc8 but have waited until now to report the problem in the hope of obtaining a more repeatable scenario.\n\nVersion info:\n\nXorg server 1.10.0\nXorg ati driver 6.14.1\nlibdrm-2.4.24\nMesa-7.10.1\n\nProcessor  AMD Phenom(tm) II X4 940 Processor\n\nLinux Andromeda 2.6.38.2 #1 SMP Mon Mar 28 22:17:13 BST 2011 i686 athlon-4 i386 GNU/Linux\n \nGnu C                  4.6.0\nGnu make               3.81\nbinutils               2.21\nutil-linux             2.14.1\nmount                  support\nmodule-init-tools      3.5\ne2fsprogs              1.41.4\nLinux C Library        2.13\nDynamic linker (ldd)   2.13\nLinux C++ Library      6.0.15\nProcps                 3.2.7\nNet-tools              1.60\nKbd                    1.15\nSh-utils               7.4\nModules Loaded         md4 md5 hmac cryptomgr aead nls_cp437 cifs crypto_hash crypto_algapi microcode nfs fscache nfsd lockd sunrpc exportfs fuse usbhid firewire_ohci sr_mod sg firewire_core cdrom psmouse i2c_piix4 crc_itu_t button vboxnetflt fifo splitter ohci_hcd ehci_hcd usbcore nls_base vboxnetadp snd_hda_codec_hdmi snd_hda_codec_analog snd_hda_intel snd_hda_codec snd_seq_dummy snd_seq_oss snd_seq_midi_event snd_seq snd_seq_device snd_pcm_oss snd_mixer_oss snd_hwdep snd_pcm snd_page_alloc snd_timer snd soundcore brd loop asus_atk0110 powernow_k8 processor thermal_sys mperf pata_atiixp vboxdrv sky2 rtc eeprom unix", "patch": ["From ee11d4db3389aab9df38edb3eed4d5822320d5f1 Mon Sep 17 00:00:00 2001\nFrom: Dave Airlie <airlied@redhat.com>\nDate: Sun, 29 May 2011 17:48:32 +1000\nSubject: [PATCH] drm/radeon: fix oops in ttm reserve when pageflipping (v2)\n\nWe need to take a reference to this object, pinning doesn't take a reference\nso if userspace deletes the object it can disappear even if pinned.\n\nv2: fix error paths to unreference properly also.\n\nshould fix:\nhttps://bugzilla.kernel.org/show_bug.cgi?id=32402\nand\nhttps://bugzilla.redhat.com/show_bug.cgi?id=680651\n\nSigned-off-by: Dave Airlie <airlied@redhat.com>\n---\n drivers/gpu/drm/radeon/radeon_display.c |   13 ++++++++-----\n 1 files changed, 8 insertions(+), 5 deletions(-)\n\ndiff --git a/drivers/gpu/drm/radeon/radeon_display.c b/drivers/gpu/drm/radeon/radeon_display.c\nindex ae247ee..292f73f 100644\n--- a/drivers/gpu/drm/radeon/radeon_display.c\n+++ b/drivers/gpu/drm/radeon/radeon_display.c\n@@ -264,6 +264,8 @@ static void radeon_unpin_work_func(struct work_struct *__work)\n \t\tradeon_bo_unreserve(work->old_rbo);\n \t} else\n \t\tDRM_ERROR(\"failed to reserve buffer after flip\\n\");\n+\n+\tdrm_gem_object_unreference_unlocked(&work->old_rbo->gem_base);\n \tkfree(work);\n }\n \n@@ -371,6 +373,8 @@ static int radeon_crtc_page_flip(struct drm_crtc *crtc,\n \tnew_radeon_fb = to_radeon_framebuffer(fb);\n \t/* schedule unpin of the old buffer */\n \tobj = old_radeon_fb->obj;\n+\t/* take a reference to the old object */\n+\tdrm_gem_object_reference(obj);\n \trbo = gem_to_radeon_bo(obj);\n \twork->old_rbo = rbo;\n \tINIT_WORK(&work->work, radeon_unpin_work_func);\n@@ -378,12 +382,9 @@ static int radeon_crtc_page_flip(struct drm_crtc *crtc,\n \t/* We borrow the event spin lock for protecting unpin_work */\n \tspin_lock_irqsave(&dev->event_lock, flags);\n \tif (radeon_crtc->unpin_work) {\n-\t\tspin_unlock_irqrestore(&dev->event_lock, flags);\n-\t\tkfree(work);\n-\t\tradeon_fence_unref(&fence);\n-\n \t\tDRM_DEBUG_DRIVER(\"flip queue: crtc already busy\\n\");\n-\t\treturn -EBUSY;\n+\t\tr = -EBUSY;\n+\t\tgoto unlock_free;\n \t}\n \tradeon_crtc->unpin_work = work;\n \tradeon_crtc->deferred_flip_completion = 0;\n@@ -497,6 +498,8 @@ pflip_cleanup1:\n pflip_cleanup:\n \tspin_lock_irqsave(&dev->event_lock, flags);\n \tradeon_crtc->unpin_work = NULL;\n+unlock_free:\n+\tdrm_gem_object_unreference_unlocked(old_radeon_fb->obj);\n \tspin_unlock_irqrestore(&dev->event_lock, flags);\n \tradeon_fence_unref(&fence);\n \tkfree(work);\n-- \n1.7.4.4\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Video", "Hardware": "All Linux", "Importance": "P1 high", "Assignee": "drivers_video-dri", "URL": "", "Keywords": "", "Duplicates (3)": "29942 33222 38232", "Depends on": "", "Blocks": "", "Reported": "2011-03-31 23:13 UTC by Stuart Foster", "Modified": "2011-07-10 23:13 UTC", "CC List": "11 users", "See Also": "", "Kernel Version": "2.6.39", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/gpu/drm/radeon/radeon_display.c"], "methods": ["radeon_unpin_work_func", "radeon_crtc_page_flip"]}
{"id": "32052", "title": "Unloading wmi module causes a kernel oops.", "description": "Created attachment 52302 [details]\nlspci -vvv\n\nHello.\n\nI have Acer Aspire TimelineX 1830T so I'm using acer_wmi module. Since 2.6.37 there is a regression which is causing a NULL pointer dereference and kernel oops.\n\nSteps to reproduce:\n1. Boot any kernel newer than 2.6.37 (tested on 2.6.37.1, .3, .4, .5 and 2.6.38.1) with acer_wmi built as module\n2. Run \"modprobe -r acer_wmi\"\n3. Kernel oops!\n\nOn 2.6.36, .1, .2, .4 works flawlessly.\nRunning ArchLinux x86_64.\n\nlspci -vvv and appropriate part of everything.log attached. \nCan provide any other info if needed.", "patch": ["WMI: properly cleanup devices\n\nFrom: Dmitry Torokhov <dmitry.torokhov@gmail.com>\n\nSigned-off-by: Dmitry Torokhov <dtor@mail.ru>\n---\n\n drivers/platform/x86/wmi.c |    6 +++++-\n 1 files changed, 5 insertions(+), 1 deletions(-)\n\n\ndiff --git a/drivers/platform/x86/wmi.c b/drivers/platform/x86/wmi.c\nindex f23d5a8..9b88be4 100644\n--- a/drivers/platform/x86/wmi.c\n+++ b/drivers/platform/x86/wmi.c\n@@ -754,9 +754,13 @@ static void wmi_free_devices(void)\n \tstruct wmi_block *wblock, *next;\n \n \t/* Delete devices for all the GUIDs */\n-\tlist_for_each_entry_safe(wblock, next, &wmi_block_list, list)\n+\tlist_for_each_entry_safe(wblock, next, &wmi_block_list, list) {\n+\t\tlist_del(&wblock->list);\n \t\tif (wblock->dev.class)\n \t\t\tdevice_unregister(&wblock->dev);\n+\t\telse\n+\t\t\tkfree(wblock);\n+\t}\n }\n \n static bool guid_already_parsed(const char *guid_string)\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Platform Specific/Hardware", "Classification": "Unclassified", "Component": "x86-64", "Hardware": "x86-64 Linux", "Importance": "P1 normal", "Assignee": "other_modules", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2011-03-28 12:15 UTC by Coacher", "Modified": "2012-01-15 17:23 UTC", "CC List": "5 users", "See Also": "", "Kernel Version": "2.6.37", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/platform/x86/wmi.c"], "methods": ["wmi_free_devices"]}
{"id": "32032", "title": "Divide error in minstrel_ht_tx_status followed by hang", "description": "Created attachment 52232 [details]\nsyslog capturing crashes\n\nDebian Squeeze with updated kernels containing brcm80211 driver.\nReproduced with the following kernel packages:\n linux-image-2.6.37-trunk-686   2.6.37-1~experimental.1\n linux-image-2.6.37.2-686       2.6.37-2\n linux-image-2.6.38-1-686       2.6.38-1\nwith two different firmware versions for brcm80211, currently:\n firmware-brcm80211             0.29\n\nThe system worked reliably with the first kernel until an automated package update occurred. Wireless is now unusable. I have been unable to trace what may have changed to trigger the problem.\n\nAfter associating, the following crash occurs, followed by a second crash in acpi_idle_enter_bm, which then keeps occurring, rendering the system completely hung in a matter of seconds.\n\nMar 27 14:31:10 davin kernel: [ 1716.250150] divide error: 0000 [#1] SMP\nMar 27 14:31:10 davin kernel: [ 1716.250305] last sysfs file: /sys/module/aes_generic/initstate\nMar 27 14:31:10 davin kernel: [ 1716.250478] Modules linked in: aes_i586 aes_generic hidp hid acpi_cpufreq mperf cpufreq_conservative cpufreq_powersave cpufreq_userspace cpufreq_stats parport_pc ppdev lp parport sco bridge stp bnep rfcomm l2cap binfmt_misc uinput fuse loop arc4 snd_hda_codec_realtek ecb snd_hda_intel joydev snd_hda_codec snd_hwdep brcm80211(C) snd_pcm mac80211 snd_seq snd_timer snd_seq_device i915 cfg80211 drm_kms_helper tpm_tis snd psmouse tpm btusb uvcvideo bluetooth soundcore i2c_i801 drm rfkill i2c_algo_bit ac tpm_bios video videodev serio_raw i2c_core evdev pcspkr snd_page_alloc battery power_supply button processor ext4 mbcache jbd2 crc16 sd_mod crc_t10dif ahci libahci libata uhci_hcd scsi_mod ehci_hcd usbcore sky2 thermal thermal_sys nls_base [last unloaded: scsi_wait_scan]\nMar 27 14:31:10 davin kernel: [ 1716.253132]\nMar 27 14:31:10 davin kernel: [ 1716.253186] Pid: 0, comm: kworker/0:0 Tainted: G         C   2.6.38-1-686 #1 SAMSUNG ELECTRONICS CO., LTD. NF110/NF210/NF310          /NF110/NF210/NF310 \nMar 27 14:31:10 davin kernel: [ 1716.253637] EIP: 0060:[<f8e7e46f>] EFLAGS: 00010246 CPU: 1\nMar 27 14:31:10 davin kernel: [ 1716.253830] EIP is at minstrel_ht_tx_status+0x462/0x675 [mac80211]\nMar 27 14:31:10 davin kernel: [ 1716.254008] EAX: 0000006c EBX: ef452068 ECX: 00010000 EDX: 00000000\nMar 27 14:31:10 davin kernel: [ 1716.254008] ESI: ef452000 EDI: ef452000 EBP: 00000000 ESP: f68d9f04\nMar 27 14:31:10 davin kernel: [ 1716.254008]  DS: 007b ES: 007b FS: 00d8 GS: 00e0 SS: 0068\nMar 27 14:31:10 davin kernel: [ 1716.254008] Process kworker/0:0 (pid: 0, ti=f68d8000 task=f684acb0 task.ti=f68d4000)\nMar 27 14:31:10 davin kernel: [ 1716.254008] Stack:\nMar 27 14:31:10 davin kernel: [ 1716.254008]  00000000 ef452000 ef452068 e5ce76c0 00000000 00000000 00000000 ef6f7220\nMar 27 14:31:10 davin kernel: [ 1716.254008]  00000000 00000000 00000000 00000000 00010000 00000000 f8e8224c ef6f7000\nMar 27 14:31:10 davin kernel: [ 1716.254008]  e5ce76d8 e5ce76c0 f8e63205 ef452000 e5ce76c0 ef2ea2c0 e5ce76d8 f5b0c086\nMar 27 14:31:10 davin kernel: [ 1716.254008] Call Trace:\nMar 27 14:31:10 davin kernel: [ 1716.254008]  [<f8e63205>] ? ieee80211_tx_status+0x234/0x6b7 [mac80211]\nMar 27 14:31:10 davin kernel: [ 1716.254008]  [<f8e62933>] ? ieee80211_tasklet_handler+0x4a/0x8c [mac80211]\nMar 27 14:31:10 davin kernel: [ 1716.254008]  [<c10347fd>] ? __do_softirq+0x0/0x14f\nMar 27 14:31:10 davin kernel: [ 1716.254008]  [<c1033cd7>] ? tasklet_action+0x61/0x9f\nMar 27 14:31:10 davin kernel: [ 1716.254008]  [<c1034898>] ? __do_softirq+0x9b/0x14f\nMar 27 14:31:10 davin kernel: [ 1716.254008]  [<c10347fd>] ? __do_softirq+0x0/0x14f\nMar 27 14:31:10 davin kernel: [ 1716.254008]  <IRQ>\nMar 27 14:31:10 davin kernel: [ 1716.254008]  [<c1034781>] ? irq_exit+0x26/0x59\nMar 27 14:31:10 davin kernel: [ 1716.254008]  [<c1003e63>] ? do_IRQ+0x73/0x84\nMar 27 14:31:10 davin kernel: [ 1716.254008]  [<c10034b0>] ? common_interrupt+0x30/0x38\nMar 27 14:31:10 davin kernel: [ 1716.254008]  [<f85a5cde>] ? acpi_idle_enter_bm+0x247/0x284 [processor]\nMar 27 14:31:10 davin kernel: [ 1716.254008]  [<c11ded9b>] ? cpuidle_idle_call+0xd4/0x15d\nMar 27 14:31:10 davin kernel: [ 1716.254008]  [<c1002201>] ? cpu_idle+0x95/0xb0\nMar 27 14:31:10 davin kernel: [ 1716.254008]  [<c1288b52>] ? start_secondary+0x1b8/0x1bd\nMar 27 14:31:10 davin kernel: [ 1716.254008] Code: 89 43 e4 8b 4c 24 08 8b 49 08 81 f9 98 19 00 00 89 4c 24 30 77 0c 8b 44 24 08 c7 00 00 00 00 00 eb 32 0f b7 6e 0a 31 d2 8b 46 1c <f7> f5 8b 14 24 89 c1 8b 44 24 18 03 8c 90 18 f0 e7 f8 b8 40 42\nMar 27 14:31:10 davin kernel: [ 1716.254008] EIP: [<f8e7e46f>] minstrel_ht_tx_status+0x462/0x675 [mac80211] SS:ESP 0068:f68d9f04", "patch": ["diff -urp linux-2.6-2.6.38/drivers/staging//brcm80211/sys/wlc_ampdu.c linux-2.6-2.6.38-brcmfix/drivers/staging//brcm80211/sys/wlc_ampdu.c\n--- linux-2.6-2.6.38/drivers/staging//brcm80211/sys/wlc_ampdu.c\t2011-03-15 02:20:32.000000000 +0100\n+++ linux-2.6-2.6.38-brcmfix/drivers/staging//brcm80211/sys/wlc_ampdu.c\t2011-04-08 21:17:05.886442876 +0200\n@@ -1119,16 +1119,6 @@ wlc_ampdu_dotxstatus_complete(struct amp\n \t\t\t\ttx_info->flags |= IEEE80211_TX_STAT_ACK;\n \t\t\t\ttx_info->flags |= IEEE80211_TX_STAT_AMPDU;\n \n-\t\t\t\t/* XXX TODO: Make these accurate. */\n-\t\t\t\ttx_info->status.ampdu_ack_len =\n-\t\t\t\t    (txs->\n-\t\t\t\t     status & TX_STATUS_FRM_RTX_MASK) >>\n-\t\t\t\t    TX_STATUS_FRM_RTX_SHIFT;\n-\t\t\t\ttx_info->status.ampdu_len =\n-\t\t\t\t    (txs->\n-\t\t\t\t     status & TX_STATUS_FRM_RTX_MASK) >>\n-\t\t\t\t    TX_STATUS_FRM_RTX_SHIFT;\n-\n \t\t\t\tskb_pull(p, D11_PHY_HDR_LEN);\n \t\t\t\tskb_pull(p, D11_TXH_LEN);\n \n@@ -1164,6 +1154,8 @@ wlc_ampdu_dotxstatus_complete(struct amp\n \t\t\t}\n \t\t}\n \t\ttot_mpdu++;\n+\t\ttx_info->status.ampdu_len = tot_mpdu;\n+\t\ttx_info->status.ampdu_ack_len = suc_mpdu;\n \n \t\t/* break out if last packet of ampdu */\n \t\tif (((mcl & TXC_AMPDU_MASK) >> TXC_AMPDU_SHIFT) ==\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Staging", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Roland Vossen", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2011-03-27 21:46 UTC by Wouter Cloetens", "Modified": "2011-05-30 08:35 UTC", "CC List": "4 users", "See Also": "", "Kernel Version": "2.6.38", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/staging/brcm80211/sys/wlc_ampdu.c"], "methods": ["wlc_ampdu_dotxstatus_complete"]}
{"id": "31872", "title": "boot panic unless acpi=off, Thread overran stack, or stack corrupted - Toshiba Satellite/mobile P4", "": "Show dependency tree", "description": "Created attachment 51972 [details]\nlspci -vvv\n\nMy laptop cannot boot anymore with latest 2.6.38 kernel (also confirmed\nwith 2.6.38 rc6, rc7 and rc8) while ACPI support is enabled (booting with ACPI=off allows ending the boot sequence but many functionalities are lost). A kernel panic occurs early during the boot.\n\nOlder kernels until 2.6.37.2 did not trigger this bug on that laptop.\n\nIt's the official Debian kernel 2.6.38-1-686.", "patch": ["---\n drivers/acpi/scan.c |   24 +++++++++++++++++-------\n 1 file changed, 17 insertions(+), 7 deletions(-)\n\nIndex: linux-2.6/drivers/acpi/scan.c\n===================================================================\n--- linux-2.6.orig/drivers/acpi/scan.c\n+++ linux-2.6/drivers/acpi/scan.c\n@@ -1322,16 +1322,26 @@ end:\n \n static void acpi_bus_add_power_resource(acpi_handle handle)\n {\n-\tstruct acpi_bus_ops ops = {\n-\t\t.acpi_op_add = 1,\n-\t\t.acpi_op_start = 1,\n-\t};\n+\t//struct acpi_bus_ops ops = {\n+\t//\t.acpi_op_add = 1,\n+\t//\t.acpi_op_start = 1,\n+\t//};\n \tstruct acpi_device *device = NULL;\n \n \tacpi_bus_get_device(handle, &device);\n-\tif (!device)\n-\t\tacpi_add_single_object(&device, handle, ACPI_BUS_TYPE_POWER,\n-\t\t\t\t\tACPI_STA_DEFAULT, &ops);\n+\tif (!device) {\n+\t\tstruct acpi_buffer path = {ACPI_ALLOCATE_BUFFER, NULL};\n+\t\tint result;\n+\n+\t\tresult = acpi_get_name(handle, ACPI_FULL_PATHNAME, &path);\n+\t\tif (!result) {\n+\t\t\tpr_info(\"%s: %s\\n\", __func__, (char*)path.pointer);\n+\t\t\tkfree(path.pointer);\n+\t\t}\n+\n+\t\t//acpi_add_single_object(&device, handle, ACPI_BUS_TYPE_POWER,\n+\t\t//\t\t\tACPI_STA_DEFAULT, &ops);\n+\t}\n }\n \n static int acpi_bus_type_and_status(acpi_handle handle, int *type,\n", "---\n drivers/acpi/scan.c |    4 +++-\n 1 file changed, 3 insertions(+), 1 deletion(-)\n\nIndex: linux-2.6/drivers/acpi/scan.c\n===================================================================\n--- linux-2.6.orig/drivers/acpi/scan.c\n+++ linux-2.6/drivers/acpi/scan.c\n@@ -882,7 +882,9 @@ static int acpi_bus_get_power_flags(stru\n \t\t\tdevice->power.flags.power_resources = 1;\n \t\t\tps->flags.valid = 1;\n \t\t\tfor (j = 0; j < ps->resources.count; j++)\n-\t\t\t\tacpi_bus_add_power_resource(ps->resources.handles[j]);\n+\t\t\t\tif (device->handle != ps->resources.handles[j])\n+\t\t\t\t\tacpi_bus_add_power_resource(\n+\t\t\t\t\t\tps->resources.handles[j]);\n \t\t}\n \n \t\t/* Evaluate \"_PSx\" to see if we can do explicit sets */\n", "---\n drivers/acpi/scan.c |    4 ++++\n 1 file changed, 4 insertions(+)\n\nIndex: linux-2.6/drivers/acpi/scan.c\n===================================================================\n--- linux-2.6.orig/drivers/acpi/scan.c\n+++ linux-2.6/drivers/acpi/scan.c\n@@ -943,6 +943,10 @@ static int acpi_bus_get_flags(struct acp\n \tif (ACPI_SUCCESS(status))\n \t\tdevice->flags.lockable = 1;\n \n+\t/* Power resources cannot be power manageable. */\n+\tif (device->device_type == ACPI_BUS_TYPE_POWER)\n+\t\treturn 0;\n+\n \t/* Presence of _PS0|_PR0 indicates 'power manageable' */\n \tstatus = acpi_get_handle(device->handle, \"_PS0\", &temp);\n \tif (ACPI_FAILURE(status))\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "ACPICA-Core", "Hardware": "i386 Linux", "Importance": "P1 normal", "Assignee": "Rafael J. Wysocki", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "27352", "Reported": "2011-03-25 20:17 UTC by Pascal Dormeau", "Modified": "2011-04-30 19:53 UTC", "CC List": "4 users", "See Also": "", "Kernel Version": "2.6.38", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/acpi/scan.c"], "methods": ["acpi_bus_add_power_resource"]}
{"id": "31572", "title": "BUG in vb_alloc() - firewire crash at boot", "": "Show dependency tree", "description": "Created attachment 51502 [details]\nphoto of oops\n\nComputer crash randomly at boot with one flashdisk or usb cdrom connected.\nTested with kernel 2.6.38-rc2 and 2.6.38.\n\nComputer: AMD Phenom x6, M4A88TD-V EVO/USB3 motherboard, 8GB RAM.\n\nlspci:\n\n00:00.0 Host bridge: Advanced Micro Devices [AMD] RS880 Host Bridge\n00:01.0 PCI bridge: ASUSTeK Computer Inc. RS880 PCI to PCI bridge (int gfx)\n00:09.0 PCI bridge: Advanced Micro Devices [AMD] RS780/RS880 PCI to PCI bridge (PCIE port 4)\n00:0a.0 PCI bridge: Advanced Micro Devices [AMD] RS780/RS880 PCI to PCI bridge (PCIE port 5)\n00:11.0 SATA controller: ATI Technologies Inc SB700/SB800 SATA Controller [IDE mode] (rev 40)\n00:12.0 USB Controller: ATI Technologies Inc SB700/SB800 USB OHCI0 Controller\n00:12.2 USB Controller: ATI Technologies Inc SB700/SB800 USB EHCI Controller\n00:13.0 USB Controller: ATI Technologies Inc SB700/SB800 USB OHCI0 Controller\n00:13.2 USB Controller: ATI Technologies Inc SB700/SB800 USB EHCI Controller\n00:14.0 SMBus: ATI Technologies Inc SBx00 SMBus Controller (rev 42)\n00:14.1 IDE interface: ATI Technologies Inc SB700/SB800 IDE Controller (rev 40)\n00:14.2 Audio device: ATI Technologies Inc SBx00 Azalia (Intel HDA) (rev 40)\n00:14.3 ISA bridge: ATI Technologies Inc SB700/SB800 LPC host controller (rev 40)\n00:14.4 PCI bridge: ATI Technologies Inc SBx00 PCI to PCI Bridge (rev 40)\n00:14.5 USB Controller: ATI Technologies Inc SB700/SB800 USB OHCI2 Controller\n00:15.0 PCI bridge: ATI Technologies Inc Device 43a0\n00:15.1 PCI bridge: ATI Technologies Inc Device 43a1\n00:16.0 USB Controller: ATI Technologies Inc SB700/SB800 USB OHCI0 Controller\n00:16.2 USB Controller: ATI Technologies Inc SB700/SB800 USB EHCI Controller\n00:18.0 Host bridge: Advanced Micro Devices [AMD] Family 10h Processor HyperTransport Configuration\n00:18.1 Host bridge: Advanced Micro Devices [AMD] Family 10h Processor Address Map\n00:18.2 Host bridge: Advanced Micro Devices [AMD] Family 10h Processor DRAM Controller\n00:18.3 Host bridge: Advanced Micro Devices [AMD] Family 10h Processor Miscellaneous Control\n00:18.4 Host bridge: Advanced Micro Devices [AMD] Family 10h Processor Link Control\n01:05.0 VGA compatible controller: ATI Technologies Inc RS880 [Radeon HD 4250]\n01:05.1 Audio device: ATI Technologies Inc RS880 Audio Device [Radeon HD 4200]\n02:00.0 FireWire (IEEE 1394): VIA Technologies, Inc. VT6315 Series Firewire Controller\n02:00.1 IDE interface: VIA Technologies, Inc. VT6415 PATA IDE Host Controller (rev a0)\n03:00.0 USB Controller: NEC Corporation uPD720200 USB 3.0 Host Controller (rev 03)\n06:00.0 Ethernet controller: Realtek Semiconductor Co., Ltd. RTL8111/8168B PCI Express Gigabit Ethernet controller (rev 06)", "patch": ["--- a/mm/vmalloc.c\n+++ b/mm/vmalloc.c\n@@ -915,6 +915,10 @@ static void *vb_alloc(unsigned long size, gfp_t gfp_mask)\n \tunsigned int order;\n \tint purge = 0;\n \n+\tprintk(KERN_DEBUG \"*** vb_alloc(%lu):\\n\", size);\n+\tprintk(KERN_DEBUG \"VMAP_BLOCK_SIZE: %#x\\n\", (u32)VMAP_BLOCK_SIZE);\n+\tprintk(KERN_DEBUG \"vmap_initialized: %u\\n\", vmap_initialized);\n+\n \tBUG_ON(size & ~PAGE_MASK);\n \tBUG_ON(size > PAGE_SIZE*VMAP_MAX_ALLOC);\n \torder = get_order(size);\n@@ -926,6 +930,8 @@ again:\n \t\tint i;\n \n \t\tspin_lock(&vb->lock);\n+\t\tprintk(KERN_DEBUG \"va: %#lx-%#lx\\n\",\n+\t\t       vb->va->va_start, vb->va->va_end);\n \t\tif (vb->free < 1UL << order)\n \t\t\tgoto next;\n \n@@ -941,6 +947,7 @@ again:\n \t\t\tgoto next;\n \t\t}\n \t\taddr = vb->va->va_start + (i << PAGE_SHIFT);\n+\t\tprintk(KERN_DEBUG \"found: i: %d, addr: %#lx\\n\", i, addr);\n \t\tBUG_ON(addr_to_vb_idx(addr) !=\n \t\t\t\taddr_to_vb_idx(vb->va->va_start));\n \t\tvb->free -= 1UL << order;\n", "From: Clemens Ladisch <clemens@ladisch.de>\nDate: Tue, 21 Jun 2011 22:09:50 +0200\nSubject: [PATCH] mm: fix wrong vmap address calculations with odd NR_CPUS values\n\nCommit db64fe02258f (mm: rewrite vmap layer) introduced code that does\naddress calculations under the assumption that VMAP_BLOCK_SIZE is\na power of two.  However, this might not be true if CONFIG_NR_CPUS is\nnot set to a power of two.\n\nWrong vmap_block index/offset values could lead to memory corruption.\nHowever, this has never been observed in practice (or never been\ndiagnosed correctly); what caught this was the BUG_ON in vb_alloc() that\nchecks for inconsistent vmap_block indices.\n\nTo fix this, ensure that VMAP_BLOCK_SIZE always is a power of two.\n\nBugLink: https://bugzilla.kernel.org/show_bug.cgi?id=31572\nReported-by: Pavel Kysilka <goldenfish@linuxsoft.cz>\nReported-by: Matias A. Fonzo <selk@dragora.org>\nSigned-off-by: Clemens Ladisch <clemens@ladisch.de>\nCc: 2.6.28+ <stable@kernel.org>\n---\n mm/vmalloc.c |    7 ++++---\n 1 files changed, 4 insertions(+), 3 deletions(-)\n\ndiff --git a/mm/vmalloc.c b/mm/vmalloc.c\nindex 1d34d75..d3d451b 100644\n--- a/mm/vmalloc.c\n+++ b/mm/vmalloc.c\n@@ -732,9 +732,10 @@ static void free_unmap_vmap_area_addr(unsigned long addr)\n #define VMAP_BBMAP_BITS_MIN\t(VMAP_MAX_ALLOC*2)\n #define VMAP_MIN(x, y)\t\t((x) < (y) ? (x) : (y)) /* can't use min() */\n #define VMAP_MAX(x, y)\t\t((x) > (y) ? (x) : (y)) /* can't use max() */\n-#define VMAP_BBMAP_BITS\t\tVMAP_MIN(VMAP_BBMAP_BITS_MAX,\t\t\\\n-\t\t\t\t\tVMAP_MAX(VMAP_BBMAP_BITS_MIN,\t\\\n-\t\t\t\t\t\tVMALLOC_PAGES / NR_CPUS / 16))\n+#define VMAP_BBMAP_BITS\t\t\\\n+\t\tVMAP_MIN(VMAP_BBMAP_BITS_MAX,\t\\\n+\t\tVMAP_MAX(VMAP_BBMAP_BITS_MIN,\t\\\n+\t\t\tVMALLOC_PAGES / roundup_pow_of_two(NR_CPUS) / 16))\n \n #define VMAP_BLOCK_SIZE\t\t(VMAP_BBMAP_BITS * PAGE_SIZE)\n \n-- \n1.7.3.2\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Memory Management", "Classification": "Unclassified", "Component": "Other", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Andrew Morton", "URL": "", "Keywords": "", "Duplicates (1)": "firewire_ohci", "Depends on": "", "Blocks": "27352", "Reported": "2011-03-21 12:40 UTC by Pavel Kysilka", "Modified": "2011-08-15 09:19 UTC", "CC List": "3 users", "See Also": "", "Kernel Version": "2.6.38-rc2", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["mm/vmalloc.c"], "methods": ["*vb_alloc"]}
{"id": "30832", "title": "Radeon S-Video Out has become black and white. Works fine in 2.6.37", "": "Show dependency tree", "description": "The S-Video out of Radeon driver has become black and white in kernel 2.6.38.The regression happened around 2.6.37.2 as the driver worked fine in 2.6.37. I have a Radeon HD4850 card.\n\nHere is the difference in the dmesg output from the two kernels. I can hardly notice any difference, other than timestamps. In kernel 2.6.38, initialization happens very quickly - maybe a timing issue? Other than the kernels, everything else is same.\n\n2.6.38-6-generic\n\n[    9.422549] [drm] Initialized drm 1.1.0 20060810\n[   10.094022] [drm] radeon defaulting to kernel modesetting.\n[   10.094024] [drm] radeon kernel modesetting enabled.\n[   10.094105] fb: conflicting fb hw usage radeondrmfb vs VESA VGA - removing generic driver\n[   10.095453] [drm] initializing kernel modesetting (RV770 0x1002:0x9442).\n[   10.095475] [drm] register mmio base: 0xFDFE0000\n[   10.095476] [drm] register mmio size: 65536\n[   10.097903] [drm] Detected VRAM RAM=512M, BAR=256M\n[   10.097906] [drm] RAM width 256bits DDR\n[   10.098018] [drm] radeon: 512M of VRAM memory ready\n[   10.098020] [drm] radeon: 512M of GTT memory ready.\n[   10.098033] [drm] Supports vblank timestamp caching Rev 1 (10.10.2010).\n[   10.098034] [drm] Driver supports precise vblank timestamp query.\n[   10.098097] [drm] radeon: irq initialized.\n[   10.098099] [drm] GART: num cpu pages 131072, num gpu pages 131072\n[   10.098748] [drm] Loading RV770 Microcode\n[   11.480076] [drm] ring test succeeded in 1 usecs\n[   11.480146] [drm] radeon: ib pool ready.\n[   11.480196] [drm] ib test succeeded in 0 usecs\n[   11.480198] [drm] Enabling audio support\n[   11.480389] [drm] Radeon Display Connectors\n[   11.480390] [drm] Connector 0:\n[   11.480391] [drm]   DVI-I\n[   11.480392] [drm]   HPD1\n[   11.480394] [drm]   DDC: 0x7e60 0x7e60 0x7e64 0x7e64 0x7e68 0x7e68 0x7e6c 0x7e6c\n[   11.480395] [drm]   Encoders:\n[   11.480396] [drm]     DFP1: INTERNAL_UNIPHY\n[   11.480397] [drm]     CRT2: INTERNAL_KLDSCP_DAC2\n[   11.480398] [drm] Connector 1:\n[   11.480399] [drm]   DIN\n[   11.480400] [drm]   Encoders:\n[   11.480400] [drm]     TV1: INTERNAL_KLDSCP_DAC2\n[   11.480401] [drm] Connector 2:\n[   11.480402] [drm]   DVI-I\n[   11.480403] [drm]   HPD2\n[   11.480404] [drm]   DDC: 0x7e20 0x7e20 0x7e24 0x7e24 0x7e28 0x7e28 0x7e2c 0x7e2c\n[   11.480405] [drm]   Encoders:\n[   11.480406] [drm]     CRT1: INTERNAL_KLDSCP_DAC1\n[   11.480407] [drm]     DFP2: INTERNAL_KLDSCP_LVTMA\n[   11.536188] [drm] Internal thermal controller with fan control\n[   11.536219] [drm] radeon: power management initialized\n[   11.638668] [drm] fb mappable at 0xD0142000\n[   11.638669] [drm] vram apper at 0xD0000000\n[   11.638670] [drm] size 8294400\n[   11.638671] [drm] fb depth is 24\n[   11.638672] [drm]    pitch is 7680\n[   11.638789] fb0: radeondrmfb frame buffer device\n[   11.638790] drm: registered panic notifier\n[   11.638794] [drm] Initialized radeon 2.8.0 20080528 for 0000:01:00.0 on minor 0\n[   22.170538] [drm:drm_mode_getfb] *ERROR* invalid framebuffer id\n\n\n\n2.6.37-020637-generic\n\n[   15.278388] [drm] Initialized drm 1.1.0 20060810\n[   15.654177] [drm] radeon defaulting to kernel modesetting.\n[   15.654178] [drm] radeon kernel modesetting enabled.\n[   15.654692] fb: conflicting fb hw usage radeondrmfb vs VESA VGA - removing generic driver\n[   15.656087] [drm] initializing kernel modesetting (RV770 0x1002:0x9442).\n[   15.660089] [drm] register mmio base: 0xFDFE0000\n[   15.660090] [drm] register mmio size: 65536\n[   15.662457] [drm] Detected VRAM RAM=512M, BAR=256M\n[   15.662460] [drm] RAM width 256bits DDR\n[   15.670407] [drm] radeon: 512M of VRAM memory ready\n[   15.670408] [drm] radeon: 512M of GTT memory ready.\n[   15.670477] [drm] radeon: irq initialized.\n[   15.670479] [drm] GART: num cpu pages 131072, num gpu pages 131072\n[   15.671039] [drm] Loading RV770 Microcode\n[   15.870579] [drm] ring test succeeded in 1 usecs\n[   15.870647] [drm] radeon: ib pool ready.\n[   15.870699] [drm] ib test succeeded in 0 usecs\n[   15.870701] [drm] Enabling audio support\n[   15.870886] [drm] Radeon Display Connectors\n[   15.870887] [drm] Connector 0:\n[   15.870888] [drm]   DVI-I\n[   15.870889] [drm]   HPD1\n[   15.870890] [drm]   DDC: 0x7e60 0x7e60 0x7e64 0x7e64 0x7e68 0x7e68 0x7e6c 0x7e6c\n[   15.870891] [drm]   Encoders:\n[   15.870892] [drm]     DFP1: INTERNAL_UNIPHY\n[   15.870893] [drm]     CRT2: INTERNAL_KLDSCP_DAC2\n[   15.870894] [drm] Connector 1:\n[   15.870895] [drm]   DIN\n[   15.870896] [drm]   Encoders:\n[   15.870897] [drm]     TV1: INTERNAL_KLDSCP_DAC2\n[   15.870898] [drm] Connector 2:\n[   15.870898] [drm]   DVI-I\n[   15.870899] [drm]   HPD2\n[   15.870901] [drm]   DDC: 0x7e20 0x7e20 0x7e24 0x7e24 0x7e28 0x7e28 0x7e2c 0x7e2c\n[   15.870902] [drm]   Encoders:\n[   15.870903] [drm]     CRT1: INTERNAL_KLDSCP_DAC1\n[   15.870904] [drm]     DFP2: INTERNAL_KLDSCP_LVTMA\n[   15.936495] [drm] Internal thermal controller with fan control\n[   15.936529] [drm] radeon: power management initialized\n[   16.028673] [drm] fb mappable at 0xD0142000\n[   16.028674] [drm] vram apper at 0xD0000000\n[   16.028675] [drm] size 8294400\n[   16.028676] [drm] fb depth is 24\n[   16.028677] [drm]    pitch is 7680\n[   16.028790] fb0: radeondrmfb frame buffer device\n[   16.028792] drm: registered panic notifier\n[   16.028795] [drm] Initialized radeon 2.7.0 20080528 for 0000:01:00.0 on minor 0\n[   20.216393] [drm:drm_mode_getfb] *ERROR* invalid framebuffer id\n[   20.981880] Modules linked in: nfs lockd fscache nfs_acl auth_rpcgss sunrpc snd_hda_codec_hdmi tuner_simple tuner_types wm8775 tda9887 tda8290 snd_hda_codec_realtek tuner radeon cx25840 snd_hda_intel ivtv cx2341x snd_hda_codec snd_seq_midi btusb bluetooth v4l2_common snd_rawmidi videodev snd_hwdep snd_seq_midi_event v4l1_compat v4l2_compat_ioctl32 tveeprom snd_pcm snd_seq ttm joydev hid_topseed drm_kms_helper serio_raw drm hid_logitech i2c_piix4 ff_memless lp ppdev parport_pc parport snd_seq_device snd_timer i2c_algo_bit k10temp edac_core edac_mce_amd cdc_acm usblp shpchp snd soundcore snd_page_alloc usbhid hid usb_storage uas firewire_ohci ahci firewire_core crc_itu_t r8169 pata_atiixp libahci", "patch": ["From 5922d921aacaa89afc930ac1cb0f8ae1f499c002 Mon Sep 17 00:00:00 2001\nFrom: Alex Deucher <alexdeucher@gmail.com>\nDate: Wed, 16 Mar 2011 19:13:52 -0400\nSubject: [PATCH] drm/radeon/kms: prefer legacy pll algo for tv-out\n\nSome boards seem to prefer the legacy pll algo for\ntv-out.\n\nFixes:\nhttps://bugzilla.kernel.org/show_bug.cgi?id=30832\n\nSigned-off-by: Alex Deucher <alexdeucher@gmail.com>\nCc: stable@kernel.org\n---\n drivers/gpu/drm/radeon/atombios_crtc.c |    6 +++++-\n 1 files changed, 5 insertions(+), 1 deletions(-)\n\ndiff --git a/drivers/gpu/drm/radeon/atombios_crtc.c b/drivers/gpu/drm/radeon/atombios_crtc.c\nindex c74f646..80e26c0 100644\n--- a/drivers/gpu/drm/radeon/atombios_crtc.c\n+++ b/drivers/gpu/drm/radeon/atombios_crtc.c\n@@ -957,7 +957,11 @@ static void atombios_crtc_set_pll(struct drm_crtc *crtc, struct drm_display_mode\n \t/* adjust pixel clock as needed */\n \tadjusted_clock = atombios_adjust_pll(crtc, mode, pll, ss_enabled, &ss);\n \n-\tif (ASIC_IS_AVIVO(rdev))\n+\tif (radeon_encoder->active_device & (ATOM_DEVICE_TV_SUPPORT))\n+\t\t/* TV seems to prefer the legacy algo on some boards */\n+\t\tradeon_compute_pll_legacy(pll, adjusted_clock, &pll_clock, &fb_div, &frac_fb_div,\n+\t\t\t\t\t  &ref_div, &post_div);\n+\telse if (ASIC_IS_AVIVO(rdev))\n \t\tradeon_compute_pll_avivo(pll, adjusted_clock, &pll_clock, &fb_div, &frac_fb_div,\n \t\t\t\t\t &ref_div, &post_div);\n \telse\n-- \n1.7.1.1\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Video", "Hardware": "IA-64 Linux", "Importance": "P1 normal", "Assignee": "drivers_video-dri", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "27352", "Reported": "2011-03-09 18:28 UTC by Arbit Rabbit", "Modified": "2011-03-27 20:04 UTC", "CC List": "3 users", "See Also": "", "Kernel Version": "2.6.38-rc6", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/gpu/drm/radeon/atombios_crtc.c"], "methods": ["atombios_crtc_set_pll"]}
{"id": "29732", "title": "rndis_wlan not working again for BCM4320a", "description": "Created attachment 48752 [details]\nSyslogs for rndis_wlan with 2.6.38-rc5\n\nI've been testing the 2.6.368 kernel with my wireless adapter and it seems that something is not well once again.\n\n\nI'm attaching the logs of four test sets. All tests were performed after booting the computer with the device disconnected and only connecting it after everything is ready on the desktop. The attachments show what came up on the syslog after the moment I plugged in the device.\n\n\n- On the first test, I disabled network-manager and only used iwconfig + dhclient. I got no connection and the adapter's \"Link\" LED just kept blinking as if nothing was happening.\n\n- For all other tests I enabled network-manager. On the second test, after about an hour with the device connected, it hadn't connected yet and my ESSID didn't shown up on n-m's available connections. I used iwconfig + dhclient to configure the device. No success yet. N-m caught the SSID by then but it couldn't connect neither.\n\n- On the third test, the SSID was detected about 5 minutes after I plugged the device. The connection was not successful. I left the computer idle for some hours and when I returned, I clicked the network's name on network-manager's list. It connected and all seemed well. However, 15 minutes later, the device disconnected. On the log you can see n-m retrying to connect without success. After it gave up, I tried to connect manually again. No success.\n\n- On the fourth test, n-m connected automatically after about 25 minutes. Unfortunately, after other 25 mins it disconnected and couldn't reconnect again.\n\n\nSo, it seems to me that we have two (or three?) issues/symptoms here again:\n- The scan results seem to be poor again, as reported on Bug #20822. The \"alternative scan mode\" patch that significantly improved it for 2.6.37 seems to be present, but maybe something is preventing it from working correctly?\n- It seems that as soon as the connection is established, the device disconnects.\n- I noticed that sometimes there are looping messages from wpa_supplicant saying that it is \"Trying to associate\" with my router, but then it says that \"Authentication with 00:00:00:00:00:00 timed out\". Notice the 00s.\n\n\nBest regards,\nPitxyoki", "patch": ["rndis_wlan: use power save only for BCM4320b\n\nFrom: Jussi Kivilinna <jussi.kivilinna@mbnet.fi>\n\nBCM4320a breaks when enabling power save (bug 29732). So disable power save\nfor anything but BCM4320b.\n\nSigned-off-by: Jussi Kivilinna <jussi.kivilinna@mbnet.fi>\n---\n drivers/net/wireless/rndis_wlan.c |    3 +++\n 1 files changed, 3 insertions(+), 0 deletions(-)\n\ndiff --git a/drivers/net/wireless/rndis_wlan.c b/drivers/net/wireless/rndis_wlan.c\nindex 848cc2c..518542b 100644\n--- a/drivers/net/wireless/rndis_wlan.c\n+++ b/drivers/net/wireless/rndis_wlan.c\n@@ -2597,6 +2597,9 @@ static int rndis_set_power_mgmt(struct wiphy *wiphy, struct net_device *dev,\n \t__le32 mode;\n \tint ret;\n \n+\tif (priv->device_type != RNDIS_BCM4320B)\n+\t\treturn -ENOTSUPP;\n+\n \tnetdev_dbg(usbdev->net, \"%s(): %s, %d\\n\", __func__,\n \t\t\t\tenabled ? \"enabled\" : \"disabled\",\n \t\t\t\ttimeout);\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "network-wireless", "Hardware": "All Linux", "Importance": "P1 enhancement", "Assignee": "Jussi Kivilinna", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2011-02-23 12:29 UTC by Pitxyoki", "Modified": "2011-03-04 23:41 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "2.6.38-rc5", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/net/wireless/rndis_wlan.c"], "methods": ["rndis_set_power_mgmt"]}
{"id": "28142", "title": "CIFS: \"Echo Request\" message results in STATUS_ACCESS_DENIED", "": "Show dependency tree", "description": "hi,\n\nafter mounting a CIFS share on a windows server 2003, r2 3790 SP2, and doing \"nothing\"/idling, after about 50-60 seconds accessing the mounted share is not possible anymore due to \"permission denied\" errors.\n\nsniffing the traffic reveals that a \"Echo Request\" message is being sent immediately followed by a \"Echo Response, Error: STATUS_ACCESS_DENIED\" message. after that one has to remount the share in order to access it again.\n\naccessing the share and copying files seems to work fine immediately after mounting, but only until the \"Echo Request\" message.\n\n2.6.37 was not affected. i've tested 2.6.38-rc2 and 2.6.38-rc3 and both suffer from the issues.\n\nmount.cifs version: 1.14-3.5.6, samba-3.5.6\n------------\nCONFIG_CIFS=y\n# CONFIG_CIFS_STATS is not set\nCONFIG_CIFS_WEAK_PW_HASH=y\nCONFIG_CIFS_UPCALL=y\nCONFIG_CIFS_XATTR=y\nCONFIG_CIFS_POSIX=y\n# CONFIG_CIFS_DEBUG2 is not set\nCONFIG_CIFS_DFS_UPCALL=y\nCONFIG_CIFS_ACL=y\nCONFIG_CIFS_EXPERIMENTAL=y\nCONFIG_SMB_FS=m  (module is not loaded)\nCONFIG_SMB_NLS_DEFAULT=y\nCONFIG_SMB_NLS_REMOTE=\"cp850\"\n-------------\ncat /proc/fs/cifs/DebugData \nDisplay Internal CIFS Data Structures for Debugging\n---------------------------------------------------\nCIFS Version 1.69\nFeatures: dfs lanman posix spnego xattr acl\nActive VFS Requests: 0\nServers:\n1) Name: xxxx  Domain: xxxx Uses: 1 OS: Windows Server 2003 R2 3790 Service Pack 2\n        NOS: Windows Server 2003 R2 5.2 Capability: 0x1f3fd\n        SMB session status: 1   TCP status: 1\n        Local Users To Server: 1 SecMode: 0xf Req On Wire: 0\n        Shares:\n        1) xxxx Mounts: 1 Type: NTFS DevInfo: 0x20 Attributes: 0x700ff\nPathComponentMax: 255 Status: 0x1 type: DISK \n\n\ni've now compiled the debug settings too if that helps, but not yet rebooted (and only remote access at the moment).\n\nJG", "patch": ["From cda5fcbf45b9feaae67e244d39db0ab8f2e7fc73 Mon Sep 17 00:00:00 2001\nFrom: Jeff Layton <jlayton@redhat.com>\nDate: Thu, 3 Feb 2011 14:52:29 -0500\nSubject: [PATCH] cifs: enable signing flag in SMB header when server has it on\n\nSigned-off-by: Jeff Layton <jlayton@redhat.com>\n---\n fs/cifs/transport.c |    4 ++++\n 1 files changed, 4 insertions(+), 0 deletions(-)\n\ndiff --git a/fs/cifs/transport.c b/fs/cifs/transport.c\nindex b8c5e2e..fbc5aac 100644\n--- a/fs/cifs/transport.c\n+++ b/fs/cifs/transport.c\n@@ -359,6 +359,10 @@ cifs_call_async(struct TCP_Server_Info *server, struct smb_hdr *in_buf,\n \tif (rc)\n \t\treturn rc;\n \n+\t/* enable signing if server requires it */\n+\tif (server->secMode & (SECMODE_SIGN_REQUIRED | SECMODE_SIGN_ENABLED))\n+\t\tin_buf->Flags2 |= SMBFLG2_SECURITY_SIGNATURE;\n+\n \tmutex_lock(&server->srv_mutex);\n \tmid = AllocMidQEntry(in_buf, server);\n \tif (mid == NULL) {\n-- \n1.7.3.4\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "File System", "Classification": "Unclassified", "Component": "CIFS", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Jeff Layton", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "27352", "Reported": "2011-02-03 18:54 UTC by JG", "Modified": "2011-02-12 22:45 UTC", "CC List": "6 users", "See Also": "", "Kernel Version": "2.6.38-rc3", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["fs/cifs/transport.c"], "methods": ["cifs_call_async"]}
{"id": "25922", "title": "IdeaPad Y530 brightness keys not functioning", "": "Show dependency tree", "description": "After increasing/decreasing brightness by \"Fn+Up/Down\" it changes by some value and after that keys are not responding (not making any change).\nModifying brighntness value by:\necho 0 > /sys/class/backlight/acpi_video0/brightness\nworks good.\n\nLatest kernel that I tried where the issue no occurs was 2.6.36.2.", "patch": ["From 557c45518d39a5b495135909f55f328e1cab1d03 Mon Sep 17 00:00:00 2001\nFrom: Ike Panhc <ike.pan@canonical.com>\nDate: Wed, 23 Feb 2011 10:20:45 +0800\nSubject: [PATCH] ideapad: read brightness setting when have brightness key notify\n\nBugLink: https://bugzilla.kernel.org/show_bug.cgi?id=25922\n\nOn ideapad Y530, the brightness key notify will be blocked if the last notify\nis not responsed by getting the brightness value. Read value when we get the\nnotify shall fix the problem and will not have any difference on other ideapads.\n\nSigned-off-by: Ike Panhc <ike.pan@canonical.com>\n---\n drivers/platform/x86/ideapad-laptop.c |    2 ++\n 1 files changed, 2 insertions(+), 0 deletions(-)\n\ndiff --git a/drivers/platform/x86/ideapad-laptop.c b/drivers/platform/x86/ideapad-laptop.c\nindex 114d952..21b1018 100644\n--- a/drivers/platform/x86/ideapad-laptop.c\n+++ b/drivers/platform/x86/ideapad-laptop.c\n@@ -459,6 +459,8 @@ static void ideapad_acpi_notify(struct acpi_device *adevice, u32 event)\n \t\tif (test_bit(vpc_bit, &vpc1)) {\n \t\t\tif (vpc_bit == 9)\n \t\t\t\tideapad_sync_rfk_state(adevice);\n+\t\t\telse if (vpc_bit == 4)\n+\t\t\t\tread_ec_data(handle, 0x12, &vpc2);\n \t\t\telse\n \t\t\t\tideapad_input_report(priv, vpc_bit);\n \t\t}\n-- \n1.7.4.1\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Platform_x86", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "drivers_platform_x86@kernel-bugs.osdl.org", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "21782 56331", "Reported": "2010-12-30 12:48 UTC by Tomasz", "Modified": "2013-04-09 06:23 UTC", "CC List": "7 users", "See Also": "", "Kernel Version": "2.6.37-rc8", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/platform/x86/ideapad-laptop.c"], "methods": ["ideapad_acpi_notify"]}
{"id": "25692", "title": "Kernel oops (NULL pointer deref) during boot on stac92xx_unsol_event", "": "Show dependency tree", "description": "Created attachment 41702 [details]\nFull kernel log\n\nI am using linux-image-2.6.37-rc7-amd64 (2.6.37~rc7-1~experimental.1) from debian experimental. My motherboard is Intel D946GZIS. During boot I get this oops and sound does not work. It used to work on 2.6.36 and before.\n\nBelow is the relevant part of dmesg. I also attached the whole thing (kernel.log). I am new to submitting kernel bugs so I apologise beforehand if I am missing any info. Please let me know if you need anything else.\n\n[    6.267424] HDA Intel 0000:00:1b.0: PCI INT A -> GSI 22 (level, low) -> IRQ 22\n[    6.267479] HDA Intel 0000:00:1b.0: irq 40 for MSI/MSI-X\n[    6.267505] HDA Intel 0000:00:1b.0: setting latency timer to 64\n[    6.320950] input: HDA Digital PCBeep as /devices/pci0000:00/0000:00:1b.0/input/input6\n[    6.520042] BUG: unable to handle kernel NULL pointer dereference at           (null)\n[    6.520066] IP: [<ffffffffa072cc3b>] stac92xx_unsol_event+0x38b/0x577 [snd_hda_codec_idt]\n[    6.520087] PGD 36854067 PUD 7bc27067 PMD 0 \n[    6.520100] Oops: 0000 [#1] SMP \n[    6.520108] last sysfs file: /sys/module/snd_hda_codec/initstate\n[    6.520119] CPU 0 \n[    6.520123] Modules linked in: snd_hda_codec_idt snd_hda_intel(+) snd_hda_codec snd_hwdep snd_pcm_oss snd_mixer_oss snd_pcm snd_seq_midi snd_rawmidi snd_seq_midi_event snd_seq snd_timer snd_seq_device rng_core snd parport_pc joydev evdev parport soundcore snd_page_alloc processor i2c_i801 pcspkr tpm_tis tpm tpm_bios shpchp pci_hotplug psmouse serio_raw ext4 mbcache jbd2 crc16 usbhid hid uas usb_storage btrfs zlib_deflate crc32c libcrc32c sg sd_mod crc_t10dif sr_mod cdrom ata_generic nouveau ttm ata_piix uhci_hcd libata drm_kms_helper drm i2c_algo_bit ehci_hcd i2c_core usbcore video e100 mii scsi_mod thermal_sys output button nls_base [last unloaded: scsi_wait_scan]\n[    6.520310] \n[    6.520315] Pid: 483, comm: modprobe Not tainted 2.6.37-rc7-amd64 #1 D946GZIS/        \n[    6.520323] RIP: 0010:[<ffffffffa072cc3b>]  [<ffffffffa072cc3b>] stac92xx_unsol_event+0x38b/0x577 [snd_hda_codec_idt]\n[    6.520337] RSP: 0018:ffff88007c343c68  EFLAGS: 00010246\n[    6.520343] RAX: 0000000000000000 RBX: ffff880079d9a400 RCX: 0000000000000701\n[    6.520350] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff880079d9a400\n[    6.520357] RBP: ffff88007954d000 R08: 0000000000000000 R09: 0000000000000708\n[    6.520366] R10: ffff88007ec0fd30 R11: ffff88007ec136c0 R12: ffff88007954d1a0\n[    6.520373] R13: ffff88003673dc08 R14: ffff88007954d004 R15: ffff88007f817090\n[    6.520381] FS:  00007f7683d8b700(0000) GS:ffff88007ec00000(0000) knlGS:0000000000000000\n[    6.520389] CS:  0010 DS: 0000 ES: 0000 CR0: 000000008005003b\n[    6.520395] CR2: 0000000000000000 CR3: 000000007bc40000 CR4: 00000000000006f0\n[    6.520403] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000\n[    6.520410] DR3: 0000000000000000 DR6: 00000000ffff0ff0 DR7: 0000000000000400\n[    6.520418] Process modprobe (pid: 483, threadinfo ffff88007c342000, task ffff88007f116540)\n[    6.520426] Stack:\n[    6.520429]  0000000000000000 ffff880079d9a400 000000000000000b ffff88007954d000\n[    6.520442]  000000000000000b ffff880079d9a400 ffff88007954d000 0000000000000001\n[    6.520454]  ffff88007954d000 ffff88007954d004 ffff88007f817090 ffffffffa072a185\n[    6.520466] Call Trace:\n[    6.520474]  [<ffffffffa072a185>] ? stac92xx_init+0x393/0x66c [snd_hda_codec_idt]\n[    6.520486]  [<ffffffffa0701125>] ? snd_hda_codec_build_controls+0x23/0x42 [snd_hda_codec]\n[    6.520497]  [<ffffffffa07030b6>] ? snd_hda_build_controls+0x1a/0x73 [snd_hda_codec]\n[    6.520508]  [<ffffffffa071f821>] ? azx_probe+0x7cc/0x86b [snd_hda_intel]\n[    6.520519]  [<ffffffff8123dd45>] ? __pm_runtime_set_status+0x162/0x186\n[    6.520528]  [<ffffffff811aed2e>] ? local_pci_probe+0x49/0x92\n[    6.520536]  [<ffffffff811afa35>] ? pci_device_probe+0xc2/0xef\n[    6.520544]  [<ffffffff8123737e>] ? driver_sysfs_add+0x66/0x8d\n[    6.520551]  [<ffffffff812374bf>] ? driver_probe_device+0xa8/0x138\n[    6.520558]  [<ffffffff8123759e>] ? __driver_attach+0x4f/0x6f\n[    6.520565]  [<ffffffff8123754f>] ? __driver_attach+0x0/0x6f\n[    6.520573]  [<ffffffff81236b48>] ? bus_for_each_dev+0x44/0x78\n[    6.520580]  [<ffffffff81236fa0>] ? bus_add_driver+0xa8/0x1f0\n[    6.520587]  [<ffffffff81237845>] ? driver_register+0x90/0xf8\n[    6.520595]  [<ffffffff811afc7f>] ? __pci_register_driver+0x4e/0xc0\n[    6.520604]  [<ffffffffa0724000>] ? alsa_card_azx_init+0x0/0x20 [snd_hda_intel]\n[    6.520613]  [<ffffffff81002079>] ? do_one_initcall+0x78/0x131\n[    6.520622]  [<ffffffff81075dac>] ? sys_init_module+0x97/0x1d3\n[    6.520629]  [<ffffffff81009a12>] ? system_call_fastpath+0x16/0x1b\n[    6.520636] Code: 8d 95 a0 01 00 00 85 c0 4c 0f 44 e2 45 8a 44 24 03 45 84 c0 78 1d 48 8b 85 68 01 00 00 45 0f be c0 b9 01 07 00 00 31 d2 48 89 df <0f> b7 30 e8 b5 3f fd ff 45 8a 44 24 02 45 84 c0 78 1d 48 8b 85 \n[    6.520729] RIP  [<ffffffffa072cc3b>] stac92xx_unsol_event+0x38b/0x577 [snd_hda_codec_idt]\n[    6.520740]  RSP <ffff88007c343c68>\n[    6.520744] CR2: 0000000000000000\n[    6.522186] ---[ end trace 6fbb469bd6db683d ]---", "patch": ["From 80c678526d7da73bde4d46a4622449c2b3c88409 Mon Sep 17 00:00:00 2001\nFrom: Takashi Iwai <tiwai@suse.de>\nDate: Thu, 13 Jan 2011 08:08:08 +0100\nSubject: [PATCH] ALSA: hda - Fix NULL-derefence with a single mic in STAC auto-mic detection\n\nWhen only one mic is available and it's an analog mic, the current\nIDT/STAC parser may give an Oops.\n\nReference: bko#25692\n\thttps://bugzilla.kernel.org/show_bug.cgi?id=25692\n\nSigned-off-by: Takashi Iwai <tiwai@suse.de>\nCc: <stable@kernel.org>\n---\n sound/pci/hda/patch_sigmatel.c |    2 +-\n 1 files changed, 1 insertions(+), 1 deletions(-)\n\ndiff --git a/sound/pci/hda/patch_sigmatel.c b/sound/pci/hda/patch_sigmatel.c\nindex c8d812e..4ab019d 100644\n--- a/sound/pci/hda/patch_sigmatel.c\n+++ b/sound/pci/hda/patch_sigmatel.c\n@@ -3594,7 +3594,7 @@ static int stac_check_auto_mic(struct hda_codec *codec)\n \t\tif (check_mic_pin(codec, spec->dmic_nids[i],\n \t\t    &fixed, &ext, &dock))\n \t\t\treturn 0;\n-\tif (!fixed && !ext && !dock)\n+\tif (!fixed || (!ext && !dock))\n \t\treturn 0; /* no input to switch */\n \tif (!(get_wcaps(codec, ext) & AC_WCAP_UNSOL_CAP))\n \t\treturn 0; /* no unsol support */\n-- \n1.7.3.4\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Sound", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Takashi Iwai", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "21782", "Reported": "2010-12-27 12:08 UTC by Nicos P.", "Modified": "2011-02-02 23:49 UTC", "CC List": "3 users", "See Also": "", "Kernel Version": "2.6.37-rc7", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["sound/pci/hda/patch_sigmatel.c"], "methods": ["stac_check_auto_mic"]}
{"id": "24562", "title": "k8-powernow does not see all cores", "description": "During boot, I get this summary on my AMD 890FX/SB850 chipset:\n\nSMP: Allowing 6 CPUs, 0 hotplug CPUs\nsetup_percpu: NR_CPUS:4096 nr_cpumask_bits:6 nr_cpu_ids:6 nr_node_ids:1\nPERCPU: Embedded 27 pages/cpu @ffff880006000000 s80704 r8192 d21696 u262144\npcpu-alloc: s80704 r8192 d21696 u262144 alloc=1*2097152\npcpu-alloc: [0] 0 1 2 3 4 5 - - \nSLUB: Genslabs=13, HWalign=64, Order=0-3, MinObjects=0, CPUs=6, Nodes=1\n        RCU-based detection of stalled CPUs is disabled.\n        Verbose stalled-CPUs detection is disabled.\nCPU: Physical Processor ID: 0\nCPU: Processor Core ID: 0\nmce: CPU supports 6 MCE banks\nCPU0: AMD Phenom(tm) II X6 1090T Processor stepping 00\nSwitch to broadcast mode on CPU1\nSwitch to broadcast mode on CPU2\nSwitch to broadcast mode on CPU3\nSwitch to broadcast mode on CPU4\nBrought up 6 CPUs\nSwitch to broadcast mode on CPU5\nSwitch to broadcast mode on CPU0\n\nAnd a bit further down cores 4 and 5 are not seen by \"powernow-k8\":\n\npowernow-k8: Found 1 AMD Phenom(tm) II X6 1090T Processor (6 cpu cores) (version 2.20.00)\npowernow-k8: Core Performance Boosting: on.\npowernow-k8:    0 : pstate 0 (3200 MHz)\npowernow-k8:    1 : pstate 1 (2400 MHz)\npowernow-k8:    2 : pstate 2 (1600 MHz)\npowernow-k8:    3 : pstate 3 (800 MHz)\n\nFrequency scaling does work on all 6 cores once the system is up and running.\n\n-----------------------------\n\nFinally, should this: \"AMD Opteron/Athlon64 PowerNow!\" under CPU Frequency scaling inside the kernel be called something else to accommodate the K10 (Phenom) line?", "patch": ["\nFix a poor KERN_INFO message in powernow-k8 driver.\nhttps://bugzilla.kernel.org/show_bug.cgi?id=24562#c6\n\nSigned-off-by: Zhang Rui <rui.zhang@intel.com>\n---\n arch/x86/kernel/cpu/cpufreq/powernow-k8.c |    5 ++---\n 1 file changed, 2 insertions(+), 3 deletions(-)\n\nIndex: linux-2.6/arch/x86/kernel/cpu/cpufreq/powernow-k8.c\n===================================================================\n--- linux-2.6.orig/arch/x86/kernel/cpu/cpufreq/powernow-k8.c\t2010-12-13 15:59:24.000000000 +0800\n+++ linux-2.6/arch/x86/kernel/cpu/cpufreq/powernow-k8.c\t2010-12-13 15:59:47.000000000 +0800\n@@ -625,13 +625,12 @@\n \t\t\t\tCPUFREQ_ENTRY_INVALID) {\n \t\t\tif (cpu_family == CPU_HW_PSTATE) {\n \t\t\t\tprintk(KERN_INFO PFX\n-\t\t\t\t\t\"   %d : pstate %d (%d MHz)\\n\", j,\n+\t\t\t\t\t\"   pstate %d (%d MHz)\\n\",\n \t\t\t\t\tdata->powernow_table[j].index,\n \t\t\t\t\tdata->powernow_table[j].frequency/1000);\n \t\t\t} else {\n \t\t\t\tprintk(KERN_INFO PFX\n-\t\t\t\t\t\"   %d : fid 0x%x (%d MHz), vid 0x%x\\n\",\n-\t\t\t\t\tj,\n+\t\t\t\t\t\"   fid 0x%x (%d MHz), vid 0x%x\\n\",\n \t\t\t\t\tdata->powernow_table[j].index & 0xff,\n \t\t\t\t\tdata->powernow_table[j].frequency/1000,\n \t\t\t\t\tdata->powernow_table[j].index >> 8);\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Power Management", "Classification": "Unclassified", "Component": "cpufreq", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Thomas Renninger", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2010-12-09 14:57 UTC by Thoralf Dassler", "Modified": "2011-03-30 23:36 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "2.6.36", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["arch/x86/kernel/cpu/cpufreq/powernow-k8.c"], "methods": ["print_basics"]}
{"id": "24492", "title": "SBS - Battery status is updated only on AC/DC event, not every minute - Acer Travelmate 2301", "description": "On a Acer Travelmate 2301, the battery status (energy, current, etc.)  doesn't get updated, unless events are triggered (e.g. charger disconnection).\n\nExample, with charger on, an old reading is reported:\n\ntestuser@castor:~$ cat /sys/class/power_supply/BAT0/energy_now\n1120000\n\nImmediately after, having unplugged the charger in order to trigger an event,\nsysfs gets updated:\n\ntestuser@castor:~$ cat /sys/class/power_supply/BAT0/energy_now\n13600000", "patch": ["diff --git a/drivers/acpi/sbs.c b/drivers/acpi/sbs.c\nindex 51ae379..428f310 100644\n--- a/drivers/acpi/sbs.c\n+++ b/drivers/acpi/sbs.c\n@@ -187,6 +187,7 @@ static int acpi_battery_technology(struct acpi_battery *battery)\n \treturn POWER_SUPPLY_TECHNOLOGY_UNKNOWN;\n }\n \n+static int acpi_battery_get_state(struct acpi_battery *battery);\n static int acpi_sbs_battery_get_property(struct power_supply *psy,\n \t\t\t\t\t enum power_supply_property psp,\n \t\t\t\t\t union power_supply_propval *val)\n@@ -195,6 +196,9 @@ static int acpi_sbs_battery_get_property(struct power_supply *psy,\n \n \tif ((!battery->present) && psp != POWER_SUPPLY_PROP_PRESENT)\n \t\treturn -ENODEV;\n+\n+\tacpi_battery_get_state(battery);\n+\n \tswitch (psp) {\n \tcase POWER_SUPPLY_PROP_STATUS:\n \t\tif (battery->rate_now < 0)\n@@ -224,12 +228,18 @@ static int acpi_sbs_battery_get_property(struct power_supply *psy,\n \tcase POWER_SUPPLY_PROP_CURRENT_NOW:\n \tcase POWER_SUPPLY_PROP_POWER_NOW:\n \t\tval->intval = abs(battery->rate_now) *\n-\t\t\t\tacpi_battery_ipscale(battery) * 1000;\n+\t\t\tacpi_battery_ipscale(battery) * 1000;\n+\t\tval->intval *= (acpi_battery_mode(battery)) ?\n+\t\t\t(battery->voltage_now *\n+\t\t\tacpi_battery_vscale(battery)/1000) : 1;\n \t\tbreak;\n \tcase POWER_SUPPLY_PROP_CURRENT_AVG:\n \tcase POWER_SUPPLY_PROP_POWER_AVG:\n \t\tval->intval = abs(battery->rate_avg) *\n-\t\t\t\tacpi_battery_ipscale(battery) * 1000;\n+\t\t\tacpi_battery_ipscale(battery) * 1000;\n+\t\tval->intval *= (acpi_battery_mode(battery)) ?\n+\t\t\t(battery->voltage_now *\n+\t\t\tacpi_battery_vscale(battery) / 1000) : 1;\n \t\tbreak;\n \tcase POWER_SUPPLY_PROP_CAPACITY:\n \t\tval->intval = battery->state_of_charge;\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "Power-Battery", "Hardware": "All Linux", "Importance": "P1 high", "Assignee": "Lan Tianyu", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2010-12-08 22:41 UTC by Lorenzo Masellis", "Modified": "2011-08-06 02:08 UTC", "CC List": "5 users", "See Also": "", "Kernel Version": "2.6.32", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/acpi/sbs.c"], "methods": ["acpi_sbs_battery_get_property"]}
{"id": "24342", "title": "no sound on spdif", "description": "the sound on spdif has gone between 2.6.35.6-45 and 2.6.35.9-64 -these are versions avaliable in fedora. so after booting to older kernel everything works well again.\n\nthere is nothing special in any log files. also my digital reciever shows pcm signal incoming during playback, however it wrongly shows 'pcm' input also when trying to play ac3/dts and in all cases there is no sound.\n\nI am using intel hda chipset (currently have no possibility to check analog audio now)\n\ncard 0: Intel [HDA Intel], device 0: ALC889 Analog [ALC889 Analog]\n  Subdevices: 1/1\n  Subdevice #0: subdevice #0\ncard 0: Intel [HDA Intel], device 1: ALC889 Digital [ALC889 Digital]\n  Subdevices: 0/1\n  Subdevice #0: subdevice #0\n\n\n00:1b.0 Audio device: Intel Corporation 5 Series/3400 Series Chipset High Definition Audio (rev 06)", "patch": ["diff --git a/sound/pci/hda/patch_realtek.c b/sound/pci/hda/patch_realtek.c\nindex 28f95d1..cd32c28 100644\n--- a/sound/pci/hda/patch_realtek.c\n+++ b/sound/pci/hda/patch_realtek.c\n@@ -1290,7 +1290,7 @@ static void alc_auto_init_amp(struct hda_codec *codec, int type)\n \t\tcase 0x10ec0883:\n \t\tcase 0x10ec0885:\n \t\tcase 0x10ec0887:\n-\t\tcase 0x10ec0889:\n+\t\t/*case 0x10ec0889:*/\n \t\t\talc889_coef_init(codec);\n \t\t\tbreak;\n \t\tcase 0x10ec0888:\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Sound", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Jaroslav Kysela", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2010-12-05 10:33 UTC by ciekawy", "Modified": "2012-06-13 14:59 UTC", "CC List": "6 users", "See Also": "", "Kernel Version": "2.6.35", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["sound/pci/hda/patch_realtek.c"], "methods": ["alc_auto_init_amp"]}
{"id": "24312", "title": "[i915] null pointer dereference on modprobe in intel_svdo_read_byte.clone.8", "description": "The i915 module in Natty's 2.6.37-rc3-7 (and perhaps others) kernel oopses with a null pointer dereference on boot on my i915GM-based Dell Latitude D610 as seen below,\n\n[ 16.693732] i915 0000:00:02.0: PCI INT A -> GSI 16 (level, low) -> IRQ 16\n[ 16.693741] i915 0000:00:02.0: setting latency timer to 64\n[ 16.753618] BUG: unable to handle kernel NULL pointer dereference at (null)\n[ 16.753753] IP: [<c04ca13e>] i2c_transfer+0x1e/0xc0\n[ 16.753851] *pde = 3f032067\n[ 16.753940] Oops: 0000 [#1] SMP\n[ 16.754060] last sysfs file: /sys/module/ssb/initstate\n[ 16.754124] Modules linked in: i915(+) b43(+) snd_seq_device mac80211 drm_kms_helper drm sunrpc cfg80211 yenta_socket dell_laptop pcmcia_rsrc snd dcdbas psmouse\npcmcia_core i2c_algo_bit video shpchp soundcore serio_raw snd_page_alloc output lp parport tg3 ssb\n[ 16.755116]\n[ 16.755171] Pid: 341, comm: modprobe Not tainted 2.6.37-7-generic #19-Ubuntu 0U8082/Latitude D610\n[ 16.755267] EIP: 0060:[<c04ca13e>] EFLAGS: 00010296 CPU: 0\n[ 16.755331] EIP is at i2c_transfer+0x1e/0xc0\n[ 16.755392] EAX: 00000000 EBX: ffffffa1 ECX: 00000002 EDX: f35b5c4c\n[ 16.755458] ESI: f367b748 EDI: f35b5ccf EBP: f35b5c2c ESP: f35b5c14\n[ 16.755524] DS: 007b ES: 007b FS: 00d8 GS: 00e0 SS: 0068\n[ 16.755589] Process modprobe (pid: 341, ti=f35b4000 task=f358a5e0 task.ti=f35b4000)\n[ 16.755675] Stack:\n[ 16.755729] f3fd3e60 00000002 f35b5c4c f363d400 00000000 f35b5ccf f35b5c64 f8541ada\n[ 16.756004] f363d40c 00000000 0000000e f3fd3c00 f363d400 00000000 00000038 00000001\n[ 16.756004] f35b5c48 00010038 f8540001 f35b5ccf f35b5cdc f854549d f35b5ccf 00000014\n[ 16.756004] Call Trace:\n[ 16.756004] [<f8541ada>] ? intel_sdvo_read_byte.clone.8+0x4a/0x90 [i915]\n[ 16.756004] [<f8540001>] ? intel_dp_set_m_n+0x201/0x480 [i915]\n[ 16.756004] [<f854549d>] ? intel_sdvo_init+0x19d/0x5c0 [i915]\n[ 16.756004] [<f853acc7>] ? intel_crt_init+0xe7/0x2f0 [i915]\n[ 16.756004] [<f852d2ed>] ? intel_setup_outputs+0x37d/0x730 [i915]\n[ 16.756004] [<f8539705>] ? intel_modeset_init+0x195/0x360 [i915]\n[ 16.756004] [<f85120a1>] ? i915_load_modeset_init+0x131/0x200 [i915]\n[ 16.756004] [<f8511720>] ? i915_vga_set_decode+0x0/0x30 [i915]\n[ 16.756004] [<f851064f>] ? intel_detect_pch+0x2f/0x80 [i915]\n[ 16.756004] [<f8513e84>] ? i915_driver_load+0x334/0x8e0 [i915]\n[ 16.756004] [<f836e5c3>] ? drm_get_pci_dev+0x153/0x300 [drm]\n[ 16.756004] [<c05fb20f>] ? _raw_spin_lock_irqsave+0x2f/0x50\n[ 16.756004] [<f8551d72>] ? i915_pci_probe+0x12/0x14 [i915]\n[ 16.756004] [<c038af37>] ? local_pci_probe+0x47/0xb0\n[ 16.756004] [<c038c418>] ? pci_device_probe+0x68/0x90\n[ 16.756004] [<c042763d>] ? really_probe+0x4d/0x150\n[ 16.756004] [<c042fb9b>] ? pm_runtime_barrier+0x4b/0xb0\n[ 16.756004] [<c04278dc>] ? driver_probe_device+0x3c/0x60\n[ 16.756004] [<c0427981>] ? __driver_attach+0x81/0x90\n[ 16.756004] [<c0427900>] ? __driver_attach+0x0/0x90\n[ 16.756004] [<c0426968>] ? bus_for_each_dev+0x48/0x70\n[ 16.756004] [<c04274ee>] ? driver_attach+0x1e/0x20\n[ 16.756004] [<c0427900>] ? __driver_attach+0x0/0x90\n[ 16.756004] [<c04270a1>] ? bus_add_driver+0xc1/0x2c0\n[ 16.756004] [<c038bdc0>] ? pci_device_remove+0x0/0xf0\n[ 16.756004] [<c0427bc6>] ? driver_register+0x66/0x110\n[ 16.756004] [<c038b4d5>] ? __pci_register_driver+0x45/0xb0\n[ 16.756004] [<f836e8d6>] ? drm_pci_init+0x96/0xc0 [drm]\n[ 16.756004] [<f8366e24>] ? drm_init+0x54/0x70 [drm]\n[ 16.756004] [<f857008f>] ? i915_init+0x8f/0x91 [i915]\n[ 16.756004] [<c0101255>] ? do_one_initcall+0x35/0x170\n[ 16.756004] [<f8570000>] ? i915_init+0x0/0x91 [i915]\n[ 16.756004] [<c0101255>] ? do_one_initcall+0x35/0x170\n[ 16.756004] [<f8570000>] ? i915_init+0x0/0x91 [i915]\n[ 16.756004] [<c018903b>] ? sys_init_module+0x9b/0x1e0\n[ 16.756004] [<c0226612>] ? sys_write+0x42/0x70\n[ 16.756004] [<c05fb494>] ? syscall_call+0x7/0xb\n[ 16.756004] Code: ff ff 5d c3 89 f6 8d bc 27 00 00 00 00 55 89 e5 57 56 53 83 ec 0c 3e 8d 74 26 00 bb a1 ff ff ff 89 c6 8b 40 0c 89 55 f0 89 4d ec <8b> 00 85 c0 74 6f 89 e0 25 00 e0 ff ff f7 40 14 ff ff ff ef 75\n[ 16.756004] EIP: [<c04ca13e>] i2c_transfer+0x1e/0xc0 SS:ESP 0068:f35b5c14\n[ 16.756004] CR2: 0000000000000000\n[ 16.761639] ---[ end trace 53912a785b2ee2cb ]---", "patch": ["From d74e6cebf4c6f4e29c6ed345f868739028c36415 Mon Sep 17 00:00:00 2001\nFrom: Chris Wilson <chris@chris-wilson.co.uk>\nDate: Wed, 8 Dec 2010 16:48:21 +0000\nSubject: [PATCH] drm/i915/sdvo: Only use the SDVO pin if it is in the valid range\n\nBIOSes. Can't live without them (apparently), definitely can't live with\nthem.\n\nReported-by: Ben Gamari <bgamari@gmail.com>\nBugzilla: https://bugzilla.kernel.org/show_bug.cgi?id=24312\nSigned-off-by: Chris Wilson <chris@chris-wilson.co.uk>\n---\n drivers/gpu/drm/i915/intel_sdvo.c |    9 ++++++---\n 1 files changed, 6 insertions(+), 3 deletions(-)\n\ndiff --git a/drivers/gpu/drm/i915/intel_sdvo.c b/drivers/gpu/drm/i915/intel_sdvo.c\nindex d97e6cb..8b436d7 100644\n--- a/drivers/gpu/drm/i915/intel_sdvo.c\n+++ b/drivers/gpu/drm/i915/intel_sdvo.c\n@@ -1908,9 +1908,12 @@ intel_sdvo_select_i2c_bus(struct drm_i915_private *dev_priv,\n \t\tspeed = mapping->i2c_speed;\n \t}\n \n-\tsdvo->i2c = &dev_priv->gmbus[pin].adapter;\n-\tintel_gmbus_set_speed(sdvo->i2c, speed);\n-\tintel_gmbus_force_bit(sdvo->i2c, true);\n+\tif (pin < ARRAY_LENGTH(dev_priv->gmbus)) {\n+\t\tsdvo->i2c = &dev_priv->gmbus[pin].adapter;\n+\t\tintel_gmbus_set_speed(sdvo->i2c, speed);\n+\t\tintel_gmbus_force_bit(sdvo->i2c, true);\n+\t} else\n+\t\tsdvo->i2c = &dev_priv->gmbus[GMBUS_PORT_DPB].adapter;\n }\n \n static bool\n-- \n1.7.2.3\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Video", "Hardware": "All Linux", "Importance": "P1 blocking", "Assignee": "drivers_video-dri-intel@kernel-bugs.osdl.org", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2010-12-05 01:55 UTC by Ben Gamari", "Modified": "2012-08-29 14:34 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "2.6.37-rc3", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/gpu/drm/i915/intel_sdvo.c"], "methods": ["intel_sdvo_select_i2c_bus"]}
{"id": "24302", "title": "Kernel crashes when repeatedly trying to mount nfs share that is failing", "description": "ARCH: x86_64 (not tested on i386)\n\nTestcase:\n\nOn the server side, configure an export that will be denied to mount (used sec=krb5 as that gives a permission denied for me)\n\n--- server /etc/exports ---\n/foo *(rw,krb5)\n\nOn the client side, autofs gets configured to try to automount server:/foo\n\n--- client /etc/auto.master ---\n/auto /etc/auto.auto\n\n--- client /etc/auto.auto ---\nfoo -tcp server:/foo\n\n[optional]\nStop the autofs service and start the automounter in the foreground (automount -d -f) to see the permission denied message.\n\nCreate a symlink pointing to the autofs:\nln -s /auto/foo foo\n\nThe following is done in a loop as the crash sometimes takes longer than other times:\n\nwhile true; do ls foo/; sleep 1; done\n\nIt seems to take longer on the newest kernel, but eventually there will be a panic.", "patch": ["From dcc0a9d5d9490680ea9faa7b90de3224c3aba7e3 Mon Sep 17 00:00:00 2001\nFrom: Chuck Lever <chuck.lever@oracle.com>\nDate: Wed, 8 Dec 2010 19:07:12 -0500\nSubject: [PATCH] NFS: Fix panic after nfs_umount()\n\nAfter a few unsuccessful NFS mount attempts in which the client and\nserver cannot agree on an authentication flavor both support, the\nclient panics.  nfs_umount() is invoked in the kernel in this case.\n\nTurns out this particular UMNT RPC invocation causes the RPC client to\nwrite off the end of the rpc_clnt's iostat array.  This is because the\nmount client's nrprocs field is initialized with the count of defined\nprocedures (two: MNT and UMNT), rather than the size of the client's\nproc array (four).\n\nThe fix is to use the same initialization technique used by most other\nupper layer clients in the kernel.\n\nIntroduced by commit 0b524123, which failed to update nrprocs when it\nadded support for UMNT.\n\nBugLink: https://bugzilla.kernel.org/show_bug.cgi?id=24302\nBugLink: http://bugs.launchpad.net/bugs/683938\n\nReported-by: Stefan Bader <stefan.bader@canonical.com>\nTested-by: Stefan Bader <stefan.bader@canonical.com>\nCC: stable@kernel.org # >= 2.6.32\nSigned-off-by: Chuck Lever <chuck.lever@oracle.com>\n---\n fs/nfs/mount_clnt.c |    4 ++--\n 1 files changed, 2 insertions(+), 2 deletions(-)\n\ndiff --git a/fs/nfs/mount_clnt.c b/fs/nfs/mount_clnt.c\nindex 59047f8..50552c5 100644\n--- a/fs/nfs/mount_clnt.c\n+++ b/fs/nfs/mount_clnt.c\n@@ -503,13 +503,13 @@ static struct rpc_procinfo mnt3_procedures[] = {\n \n static struct rpc_version mnt_version1 = {\n \t.number\t\t= 1,\n-\t.nrprocs\t= 2,\n+\t.nrprocs\t= ARRAY_SIZE(mnt_procedures),\n \t.procs\t\t= mnt_procedures,\n };\n \n static struct rpc_version mnt_version3 = {\n \t.number\t\t= 3,\n-\t.nrprocs\t= 2,\n+\t.nrprocs\t= ARRAY_SIZE(mnt_procedures),\n \t.procs\t\t= mnt3_procedures,\n };\n \n-- \n1.7.0.4\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "File System", "Classification": "Unclassified", "Component": "NFS", "Hardware": "x86-64 Linux", "Importance": "P1 normal", "Assignee": "Trond Myklebust", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2010-12-03 20:20 UTC by Stefan Bader", "Modified": "2011-01-24 12:51 UTC", "CC List": "3 users", "See Also": "", "Kernel Version": "2.6.32", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["fs/nfs/mount_clnt.c"], "methods": ["rpc_version mnt_version1", "rpc_version mnt_version3"]}
{"id": "23892", "title": "fcntl(..., F_GETLK, ...) does not return correct info about a read lock which is set on server", "description": "Created attachment 38442 [details]\nPrograms for reproducing\n\nEnvironment:\n\nDebian Lenny with kernel 2.6.37-rc3 i686\nnfs-common         1:1.1.2-6lenny2\nnfs-kernel-server  1:1.1.2-6lenny2\n172.22.0.10 is a server\n172.22.0.11 is a client\n\n/etc/exports on a server:\n/srv/test  172.22.0.11(rw,sync,no_subtree_check)\n\n\nSteps to reproduce:\n\nclient# mount -t nfs 172.22.0.10:/srv/test /srv/test\n\nserver$ cd /srv/test\nserver$ ./linlock r file\npress Ctrl-C...\n\nclient$ cd /srv/test\nclient$ ./linlock w file\nfcntl: Resource temporary unavailable\nclient$ ./lockinfo file\nF_UNLCK SEEK_SET start 0 len 0\n\n./linlock tool set read (r) or write (w) lock on a file. ./lockinfo shows what F_GETLK returns. This test shows that a client can not set a write lock on a read lock of server but F_GETLK tells that file is not locked.\n\n\nThe bug does not occur if client with 2.6.21 kernel.\nThe bug occurs if client with 2.6.22-rc1 and higher.", "patch": ["From 84532fe502d996dcade62b6f81bfb77e750edee1 Mon Sep 17 00:00:00 2001\nFrom: Sergey Vlasov <vsu@altlinux.ru>\nDate: Sun, 28 Nov 2010 19:35:17 +0300\nSubject: [PATCH] NFS: Fix fcntl F_GETLK not reporting some conflicts\n\nThe commit 129a84de2347002f09721cda3155ccfd19fade40 (locks: fix\nF_GETLK regression (failure to find conflicts)) fixed the\nposix_test_lock() function by itself, however, its usage in NFS\nchanged by the commit 9d6a8c5c213e34c475e72b245a8eb709258e968c (locks:\ngive posix_test_lock same interface as ->lock) remained broken -\nsubsequent NFS-specific locking code received F_UNLCK instead of the\nuser-specified lock type.  Therefore fl->fl_type needs to be saved\nbefore the posix_test_lock() call and restored if no local conflicts\nwere reported.\n\nReference: https://bugzilla.kernel.org/show_bug.cgi?id=23892\n\nSigned-off-by: Sergey Vlasov <vsu@altlinux.ru>\n---\n fs/nfs/file.c |    2 ++\n 1 files changed, 2 insertions(+), 0 deletions(-)\n\ndiff --git a/fs/nfs/file.c b/fs/nfs/file.c\nindex 60677f9..7bf029e 100644\n--- a/fs/nfs/file.c\n+++ b/fs/nfs/file.c\n@@ -693,6 +693,7 @@ do_getlk(struct file *filp, int cmd, struct file_lock *fl, int is_local)\n {\n \tstruct inode *inode = filp->f_mapping->host;\n \tint status = 0;\n+\tunsigned int saved_type = fl->fl_type;\n \n \t/* Try local locking first */\n \tposix_test_lock(filp, fl);\n@@ -700,6 +701,7 @@ do_getlk(struct file *filp, int cmd, struct file_lock *fl, int is_local)\n \t\t/* found a conflict */\n \t\tgoto out;\n \t}\n+\tfl->fl_type = saved_type;\n \n \tif (nfs_have_delegation(inode, FMODE_READ))\n \t\tgoto out_noconflict;\n-- \n1.7.3.2\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "File System", "Classification": "Unclassified", "Component": "NFS", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Trond Myklebust", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2010-11-28 14:49 UTC by Alexander Morozov", "Modified": "2013-10-11 21:15 UTC", "CC List": "5 users", "See Also": "", "Kernel Version": "2.6.22-rc1", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["fs/nfs/file.c"], "methods": ["do_getlk"]}
{"id": "23222", "title": "2.6.36 radeon KMS: [drm] Cannot find any crtc or sizes", "": "Show dependency tree", "description": "Created attachment 37562 [details]\nkernel config\n\nAfter upgrade from 2.6.35 to 2.6.36 I think I have found a regression.\n2.6.36 is booting fine until kernel tries to change resolution. Then my monitor just goes blank, but the booting process continues. Using ssh I'm able to connect to my computer and there are following messages in my dmesg:\n[    4.650041] No connectors reported connected with modes\n[    4.650046] [drm] Cannot find any crtc or sizes - going 1024x768\n\nMy configuration:\nonboard graphic card: ATI Technologies Inc RS482 [Radeon Xpress 200] with both VGA and DVI ports\nmonitor: Samsung SyncMaster 204B\n\nPlease note that this only happens when my monitor is connected with DVI.\nAfter switching to standard VGA cable everything works just fine.", "patch": ["From d2bf53bffbeda172ad0225d615e3a9f96835efb5 Mon Sep 17 00:00:00 2001\nFrom: Alex Deucher <alexdeucher@gmail.com>\nDate: Thu, 18 Nov 2010 17:16:37 -0500\nSubject: [PATCH] drm/radeon/kms: fix i2c pad masks on rs4xx\n\nThese got lost in the last i2c cleanup.  Fixes:\nhttps://bugzilla.kernel.org/show_bug.cgi?id=23222\n\nSigned-off-by: Alex Deucher <alexdeucher@gmail.com>\nCc: stable@kernel.org\n---\n drivers/gpu/drm/radeon/radeon_combios.c |   13 +++++++++++++\n 1 files changed, 13 insertions(+), 0 deletions(-)\n\ndiff --git a/drivers/gpu/drm/radeon/radeon_combios.c b/drivers/gpu/drm/radeon/radeon_combios.c\nindex 7b7ea26..3bddea5 100644\n--- a/drivers/gpu/drm/radeon/radeon_combios.c\n+++ b/drivers/gpu/drm/radeon/radeon_combios.c\n@@ -571,6 +571,7 @@ static struct radeon_i2c_bus_rec combios_setup_i2c_bus(struct radeon_device *rde\n \t}\n \n \tif (clk_mask && data_mask) {\n+\t\t/* system specific masks */\n \t\ti2c.mask_clk_mask = clk_mask;\n \t\ti2c.mask_data_mask = data_mask;\n \t\ti2c.a_clk_mask = clk_mask;\n@@ -579,7 +580,19 @@ static struct radeon_i2c_bus_rec combios_setup_i2c_bus(struct radeon_device *rde\n \t\ti2c.en_data_mask = data_mask;\n \t\ti2c.y_clk_mask = clk_mask;\n \t\ti2c.y_data_mask = data_mask;\n+\t} else if ((ddc_line == RADEON_GPIOPAD_MASK) ||\n+\t\t   (ddc_line == RADEON_MDGPIO_MASK)) {\n+\t\t/* default gpiopad masks */\n+\t\ti2c.mask_clk_mask = (0x20 << 8);\n+\t\ti2c.mask_data_mask = 0x80;\n+\t\ti2c.a_clk_mask = (0x20 << 8);\n+\t\ti2c.a_data_mask = 0x80;\n+\t\ti2c.en_clk_mask = (0x20 << 8);\n+\t\ti2c.en_data_mask = 0x80;\n+\t\ti2c.y_clk_mask = (0x20 << 8);\n+\t\ti2c.y_data_mask = 0x80;\n \t} else {\n+\t\t/* default masks for ddc pads */\n \t\ti2c.mask_clk_mask = RADEON_GPIO_EN_1;\n \t\ti2c.mask_data_mask = RADEON_GPIO_EN_0;\n \t\ti2c.a_clk_mask = RADEON_GPIO_A_1;\n-- \n1.7.1.1\n\n", "From 1f95a072d82227c57b4ba47557eedccee7fbeff2 Mon Sep 17 00:00:00 2001\nFrom: Alex Deucher <alexdeucher@gmail.com>\nDate: Sun, 21 Nov 2010 10:22:26 -0500\nSubject: [PATCH] drm/radeon/kms: fix regression in rs4xx i2c setup\n\ntypo in my last i2c rework.\n\nFixes:\nhttps://bugzilla.kernel.org/show_bug.cgi?id=23222\n\nSigned-off-by: Alex Deucher <alexdeucher@gmail.com>\nCc: stable@kernel.org\n---\n drivers/gpu/drm/radeon/radeon_combios.c |    2 +-\n 1 files changed, 1 insertions(+), 1 deletions(-)\n\ndiff --git a/drivers/gpu/drm/radeon/radeon_combios.c b/drivers/gpu/drm/radeon/radeon_combios.c\nindex 3bddea5..137b807 100644\n--- a/drivers/gpu/drm/radeon/radeon_combios.c\n+++ b/drivers/gpu/drm/radeon/radeon_combios.c\n@@ -729,7 +729,7 @@ void radeon_combios_i2c_init(struct radeon_device *rdev)\n \t\t\t\t\tclk = RBIOS8(offset + 3 + (i * 5) + 3);\n \t\t\t\t\tdata = RBIOS8(offset + 3 + (i * 5) + 4);\n \t\t\t\t\ti2c = combios_setup_i2c_bus(rdev, DDC_MONID,\n-\t\t\t\t\t\t\t\t    clk, data);\n+\t\t\t\t\t\t\t\t    (1 << clk), (1 << data));\n \t\t\t\t\trdev->i2c_bus[4] = radeon_i2c_create(dev, &i2c, \"GPIOPAD_MASK\");\n \t\t\t\t\tbreak;\n \t\t\t\t}\n-- \n1.7.1.1\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Video", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "drivers_video-dri", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "16444", "Reported": "2010-11-18 15:33 UTC by Ján Bednár", "Modified": "2010-12-05 19:50 UTC", "CC List": "4 users", "See Also": "", "Kernel Version": "2.6.36", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/gpu/drm/radeon/radeon_combios.c"], "methods": ["combios_setup_i2c_bus"]}
{"id": "23012", "title": "ftdi_sio /dev/ttyUSB error:  \"Resource Temporarily Unavailable\"", "": "Show dependency tree", "description": "I am using a ftdi USB-to-serial device, which has worked in previous kernels.  After a recent update to mainline 2.6.37, I am no longer able to access the device.  Upon plugging in the device, the ftdi_sio module loads and /dev/ttyUSB0 appears.  However, when I try to access the device, I get the error \"Resource Temporarily Unavailable\".  There is no other process trying to access the device.  After downgrading to 2.6.36, the problem is fixed.", "patch": ["Index: usb-2.6/drivers/usb/serial/usb-serial.c\n===================================================================\n--- usb-2.6.orig/drivers/usb/serial/usb-serial.c\n+++ usb-2.6/drivers/usb/serial/usb-serial.c\n@@ -52,6 +52,7 @@ static struct usb_driver usb_serial_driv\n \t.suspend =\tusb_serial_suspend,\n \t.resume =\tusb_serial_resume,\n \t.no_dynamic_id = \t1,\n+\t.supports_autosuspend =\t1,\n };\n \n /* There is no MODULE_DEVICE_TABLE for usbserial.c.  Instead\n@@ -1344,6 +1345,8 @@ int usb_serial_register(struct usb_seria\n \t\treturn -ENODEV;\n \n \tfixup_generic(driver);\n+\tif (driver->usb_driver)\n+\t\tdriver->usb_driver->supports_autosuspend = 1;\n \n \tif (!driver->description)\n \t\tdriver->description = driver->driver.name;\n"], "Status": "CLOSED CODE_FIX", "Alias": "Kevin", "Product": "Drivers", "Classification": "Unclassified", "Component": "USB", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Greg Kroah-Hartman", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "21782", "Reported": "2010-11-16 06:25 UTC by Kevin Smith", "Modified": "2011-01-27 16:49 UTC", "CC List": "9 users", "See Also": "", "Kernel Version": "2.6.37-rc1", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/usb/serial/usb-serial.c"], "methods": ["usb_serial_register", "usb_serial_driver"]}
{"id": "21092", "title": "Kernel 2.6.36 Bug during quotaon on reiserfs", "": "Show dependency tree", "description": "I get this bug during boot at enabling usrquta for a reiser(3)fs since 2.6.36. The kernel is a x86_64 smp. The reiserfs reisdes on a dm raid level 5. The same setup worked with kernel version 2.6.35.7, of course there was no other configuratrion change between 2.6.35.7 and 2.6.36.\n\nREISERFS warning (device dm-4): reiserfs-2500 finish_unfinished: cannot turn on journaled quota: error -3\n------------[ cut here ]------------\nkernel BUG at fs/reiserfs/lock.c:43!\ninvalid opcode: 0000 [#1] SMP \nlast sysfs file: /sys/devices/virtual/vc/vcsa12/uevent\nCPU 5 \nModules linked in: snd_seq_dummy snd_seq_oss snd_seq_midi_event snd_seq snd_seq_device snd_pcm_oss snd_mixer_oss quota_v2 quota_tree snd_hda_codec_atihdmi snd_hda_codec_realtek snd_hda_intel snd_hda_codec snd_pcm psmouse snd_timer evdev firewire_ohci snd pcspkr soundcore processor firewire_core thermal snd_page_alloc button crc_itu_t i5k_amb scsi_transport_iscsi tg3 libphy fuse nfs auth_rpcgss fscache lockd sunrpc dm_crypt dm_mirror dm_region_hash dm_log scsi_wait_scan uhci_hcd usb_storage ehci_hcd sr_mod cdrom sg\n\nPid: 3916, comm: quotaon Not tainted 2.6.36_hope3-xw6600 #1 0A9Ch/HP xw6600 Workstation\nRIP: 0010:[<ffffffff811581a3>]  [<ffffffff811581a3>] reiserfs_write_unlock+0x43/0x50\nRSP: 0018:ffff880127a5dd78  EFLAGS: 00010203\nRAX: ffff880129cef3e0 RBX: ffff8801298115d0 RCX: 000000000000006e\nRDX: ffff88012090c540 RSI: 0000000000000000 RDI: ffff88012a838000\nRBP: ffff880127a5dd78 R08: 000000000000000b R09: ffff8801298115d0\nR10: 00007f5abe320580 R11: 0000000000000246 R12: ffff880129811540\nR13: ffff880129811680 R14: ffff88012adc3400 R15: 0000000000001000\nFS:  00007f5abd54c700(0000) GS:ffff880001940000(0000) knlGS:0000000000000000\nCS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033\nCR2: 00007f5abd5924c5 CR3: 000000012a741000 CR4: 00000000000006e0\nDR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000\nDR3: 0000000000000000 DR6: 00000000ffff0ff0 DR7: 0000000000000400\nProcess quotaon (pid: 3916, threadinfo ffff880127a5c000, task ffff880129cef3e0)\nStack:\n ffff880127a5ddc8 ffffffff81155d6f ffff880127a5dda8 ffffffff810d505c\n<0> 0000000000000002 ffff880127a5de28 ffff88012adc3400 0000000000000000\n<0> 0000000000000002 ffff88012adc3400 ffff880127a5de68 ffffffff81141071\nCall Trace:\n [<ffffffff81155d6f>] reiserfs_unpack+0x6f/0x160\n [<ffffffff810d505c>] ? path_put+0x2c/0x40\n [<ffffffff81141071>] reiserfs_quota_on+0x171/0x1d0\n [<ffffffff810d8056>] ? do_path_lookup+0x36/0x60\n [<ffffffff81237245>] ? strncpy_from_user+0x45/0x90\n [<ffffffff81119ac5>] do_quotactl+0x4d5/0x520\n [<ffffffff810d505c>] ? path_put+0x2c/0x40\n [<ffffffff8142b181>] ? down_read+0x11/0x30\n [<ffffffff81119bbe>] sys_quotactl+0xae/0x120                                                                                 \n [<ffffffff81002d2b>] system_call_fastpath+0x16/0x1b                                                                          \nCode: 75 29 8b 47 50 ff c8 89 47 50 83 f8 ff 74 09 c9 c3 0f 1f 80 00 00 00 00 48 c7 47 48 00 00 00 00 48 83 c7 28 e8 5f 26 2d 00 c9 c3 <0f> 0b eb fe 66 0f 1f 84 00 00 00 00 00 55 83 fe ff 48 89 e5 74                                                     \nRIP  [<ffffffff811581a3>] reiserfs_write_unlock+0x43/0x50                                                                     \n RSP <ffff880127a5dd78>                                                                                                       \n---[ end trace 488c3fb0de5127fd ]---  \n\n\nDespite the bug the fs in question is accessible, quota of course dont'work. Any susequent try to enable quota result in a stalled quotaon command without any output on console or dmesg.\n\n\nThank you, Markus", "patch": ["From 5bad9463d118228deed9ba61f9ab759ff15fad52 Mon Sep 17 00:00:00 2001\nFrom: Jan Kara <jack@suse.cz>\nDate: Wed, 27 Oct 2010 23:55:31 +0200\nSubject: [PATCH] reiserfs: Fix locking in reiserfs_quota_on()\n\nreiserfs_quota_on() unpacks a tail of quota file in case it has one. But after\nBKL conversion, reiserfs_unpack() expects to be called with write_lock held.\nSo acquire the lock before calling reiserfs_unpack() to avoid assertion\nfailures.\n\nSigned-off-by: Jan Kara <jack@suse.cz>\n---\n fs/reiserfs/super.c |    2 ++\n 1 files changed, 2 insertions(+), 0 deletions(-)\n\ndiff --git a/fs/reiserfs/super.c b/fs/reiserfs/super.c\nindex 6e85cfd..73c000f 100644\n--- a/fs/reiserfs/super.c\n+++ b/fs/reiserfs/super.c\n@@ -2059,7 +2059,9 @@ static int reiserfs_quota_on(struct super_block *sb, int type, int format_id,\n \tinode = path->dentry->d_inode;\n \t/* We must not pack tails for quota files on reiserfs for quota IO to work */\n \tif (!(REISERFS_I(inode)->i_flags & i_nopack_mask)) {\n+\t\treiserfs_write_lock(sb);\n \t\terr = reiserfs_unpack(inode, NULL);\n+\t\treiserfs_write_unlock(sb);\n \t\tif (err) {\n \t\t\treiserfs_warning(sb, \"super-6520\",\n \t\t\t\t\"Unpacking tail of quota file failed\"\n-- \n1.7.1\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "File System", "Classification": "Unclassified", "Component": "ReiserFS", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "ReiseFS developers team", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "16444", "Reported": "2010-10-24 16:57 UTC by markus.gapp", "Modified": "2011-01-06 15:40 UTC", "CC List": "3 users", "See Also": "", "Kernel Version": "2.6.36", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["fs/reiserfs/super.c"], "methods": ["reiserfs_quota_on"]}
{"id": "19872", "title": "phison unable to read partition table", "description": "Created attachment 32712 [details]\ndmesg log\n\nI have a Verbatim ExpressCard SSD that uses the phison driver from staging.\nOn recent kernels when loading the module I see a lot of errors and the driver is eventually unable to read the partition table off the device, rendering the device useless on those kernels. (log attached)\n\nI tested it with 2.6.35 and 2.6.36rc7, same behaviour. 2.6.32 works find. I haven't had the chance yet to test .33 and .34.", "patch": ["---\n drivers/staging/phison/phison.c |    2 +-\n 1 file changed, 1 insertion(+), 1 deletion(-)\n\n--- a/drivers/staging/phison/phison.c\n+++ b/drivers/staging/phison/phison.c\n@@ -62,7 +62,7 @@ static int phison_init_one(struct pci_de\n \t};\n \tconst struct ata_port_info *ppi[] = { &info, NULL };\n \n-\tret = ata_pci_bdma_init_one(pdev, ppi, &phison_sht, NULL, 0);\n+\tret = ata_pci_bmdma_init_one(pdev, ppi, &phison_sht, NULL, 0);\n \n \tdev_dbg(&pdev->dev, \"phison_init_one(), ret = %x\\n\", ret);\n \n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Staging", "Hardware": "All Linux", "Importance": "P1 high", "Assignee": "drivers_staging@kernel-bugs.osdl.org", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2010-10-07 21:11 UTC by Heinz Wiesinger", "Modified": "2011-01-23 15:38 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "2.6.36-rc7", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/staging/phison/phison.c"], "methods": ["phison_init_one"]}
{"id": "19462", "title": "Reproducible Kernel panic/oops during boot and startup - Panasonic Toughbooks", "description": "I've got reproducible kernel panics on recent stable kernels (2.6.32.8/16/23 and 2.6.35.2 specifically), but not on 2.6.30.x kernels. The panic/oops are occurring on two different hardware platforms; the Panasonic Toughbook CF-19 Mark 3 and and Toughbook CF-74 Mark 4. These are the latest revisions of these hardware models and we have seen the issue on multiple units.\n\nI'll attach the dmesg output from a few different panics / oops we've captured. There are two or three variations of kernel panics that repeat, so I'll include representatives from each type. All of the kernel panics I've seen occur during  boot (initramfs or early init boot process). Once a system is up and running fully, I've not seen a single lockup or oops of this type again. I've looked at related bugs with the acpi subsystem, but haven't seen anything quite like our issue, so I am opening a new issue here.\n\nFYI, I build mainline kernels, using the Debian config and package process, with some very minor config tweaks. My base OS is the Squeeze pre-release. My local mirror has the following package versions for key related packages:\n\n * udev 160-1\n * module-init-tools 3.12-1\n * initramfs-tools 0.98.1\n\nI have been *unable* to repeat this issue using either a Lenny baseline or a Squeeze baseline running the 2.6.30 kernel. I'll include the full panic messages to this ticket for each of the crashes, but here is a summary of the fun.\n\n\nThe first type of issue reports bugs in the mm/slab.c or kernel/cred.c code.\n\nkernel BUG at mm/slab.c:2972!\ninvalid opcode: 0000 [#1] SMP \nlast sysfs file: /sys/devices/pci0000:00/0000:00:02.1/resource\n\nkernel BUG at mm/slab.c:2974!\ninvalid opcode: 0000 [#1] SMP\nlast sysfs file: /sys/class/net/lo/operstate\n\nkernel BUG at mm/slab.c:2974!\ninvalid opcode: 0000 [#1] SMP\nlast sysfs file: /sys/class/power_supply/BAT1/technology\n\nkernel BUG at mm/slab.c:2974!\ninvalid opcode: 0000 [#1] SMP\nlast sysfs file: /sys/class/power_supply/BAT1/technology\n\nkernel BUG at kernel/cred.c:101!\ninvalid opcode: 0000 [#1] SMP\nlast sysfs file: /sys/class/net/lo/operstate\n\n\nAnother type of issue is a report of an unable to handle kernel paging request\n\nBUG: unable to handle kernel paging request at 52545346\nIP: [<c11696af>] acpi_ut_update_object_reference+0x1d/0x11b\n*pdpt = 00000000375f1001 *pde = 0000000000000000\nOops: 0000 [#1] SMP\nlast sysfs file: /sys/class/net/lo/operstate\n\n\nThe the last type of issue we've seen are null pointer dereferences.\n\nBUG: unable to handle kernel NULL pointer dereference at (null)\nIP: [<(null)>] (null)\n*pdpt = 000000003673e001 *pde = 0000000000000000\nOops: 0010 [#1] SMP\nlast sysfs file: /sys/devices/LNXSYSTM:00/LNXSYBUS:00/PNP0C0A:00/power_supply/BAT1/energy_full\n\nBUG: unable to handle kernel NULL pointer dereference at 0000000c\nIP: [<c112dee8>] acpi_ds_build_internal_object+0x10/0x12f\n*pdpt = 0000000036e03001 *pde = 0000000000000000\nOops: 0002 [#1] SMP\nlast sysfs file: /sys/module/processor/initstate\n\nBUG: unable to handle kernel NULL pointer dereference at 0000000c\nIP: [<c112dee8>] acpi_ds_build_internal_object+0x10/0x12f\n*pdpt = 0000000036ddf001 *pde = 0000000000000000\nOops: 0002 [#1] SMP\nlast sysfs file: /sys/devices/virtual/net/lo/operstate\n\n\n\nNow, it may seem like I'm cluttering up one bug report with too many different bits of information, but this issue I'm seeing does not appear on any of the other dozen or so different manufacturers / models I am testing this kernel on. I've only had issues on these two models and on multiple, different hardware units.\n\nThe steps to reproduce are not exactly easy, but it involves a soft reboot after disk activity and/or fuse file system mounting. I can repeat this for testing any patches you may be willing to supply.\n\nTony", "patch": ["Signed-off-by: Bob Moore <robert.moore@intel.com>\n---\ndiff --git a/drivers/acpi/acpica/dswexec.c b/drivers/acpi/acpica/dswexec.c\nindex d555b37..6b0b5d0 100644\n--- a/drivers/acpi/acpica/dswexec.c\n+++ b/drivers/acpi/acpica/dswexec.c\n@@ -300,10 +300,25 @@ acpi_ds_exec_begin_op(struct acpi_walk_state *walk_state,\n \t\t\t * we must enter this object into the namespace.  The created\n \t\t\t * object is temporary and will be deleted upon completion of\n \t\t\t * the execution of this method.\n+\t\t\t *\n+\t\t\t * Note 10/2010: Except for the Scope() op. This opcode does\n+\t\t\t * not actually create a new object, it refers to an existing\n+\t\t\t * object. However, for Scope(), we want to indeed open a\n+\t\t\t * new scope.\n \t\t\t */\n-\t\t\tstatus = acpi_ds_load2_begin_op(walk_state, NULL);\n+\t\t\tif (op->common.aml_opcode != AML_SCOPE_OP) {\n+\t\t\t\tstatus =\n+\t\t\t\t    acpi_ds_load2_begin_op(walk_state, NULL);\n+\t\t\t} else {\n+\t\t\t\tstatus =\n+\t\t\t\t    acpi_ds_scope_stack_push(op->named.node,\n+\t\t\t\t\t\t\t     op->named.node->\n+\t\t\t\t\t\t\t     type, walk_state);\n+\t\t\t\tif (ACPI_FAILURE(status)) {\n+\t\t\t\t\treturn_ACPI_STATUS(status);\n+\t\t\t\t}\n+\t\t\t}\n \t\t}\n-\n \t\tbreak;\n \n \tcase AML_CLASS_EXECUTE:\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "ACPICA-Core", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Lin Ming", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2010-10-01 22:28 UTC by Anthony Awtrey", "Modified": "2018-07-24 07:57 UTC", "CC List": "8 users", "See Also": "", "Kernel Version": "2.6.32", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/acpi/acpica/dswexec.c"], "methods": ["acpi_ds_exec_begin_op"]}
{"id": "16351", "title": "Various issues with imon remote control driver", "description": "Jarod Wilson (the imon driver maintainer) asked my to open a report here so that the issues are not forgotten.\n\n- There is no fallback timer if a release code is missed (i.e. remote pointed \naway from receiver or some other anomaly), causing a key stuck on autorepeat. \nThe driver should inject a release code itself if there is no release/repeat \ncode in 500ms after initial press or in 120ms after a repeat code.\n\n- No release code is sent for 0x02XXXXXX keys if pressing any other button \nbefore release, examples:\n\nexample 1:\nhold '5', then press 'Play' once, then release '5'\nThe 'Play' codes are relayed properly, but the release code for '5' (the 'all \n0x02XXXXXX keys released' (i.e. empty HID input report) which the hardware \ndoes send properly) is wrongly interpreted as a release code for 'Play'.\nThe driver should either release '5' when the empty report is received, or, as \nthis is just a remote control, just inject a release code for '5' when 'Play' \nis pressed.\n\nexample 2:\nhold '5', then hold '4', then release '5', then release '4'\nAs the 0x02XXXXXX range is not completely released until after '4' is \nreleased, the zeroed bitfield is not sent until after '4', and the driver \ndoesn't release '5' at this point anymore. The driver should've injected a \nrelease code for '5' when '4' was pressed.\n\n- imon_mce_timeout() timer function seems to access ictx->last_keycode without \nlocking\n\n- imon_parse_press_type() tests for ictx->release_code which is in an \nundefined state if ktype isn't IMON_KEY_IMON\n\n- when the dpad is in keyboard mode and you hold it down to one direction, \ninstead of autorepeat there is a constant stream of release/press events", "patch": [" drivers/media/IR/imon.c |   68 ++++++++++++++++++++++++++++++++++++----------\n 1 files changed, 53 insertions(+), 15 deletions(-)\n\ndiff --git a/drivers/media/IR/imon.c b/drivers/media/IR/imon.c\nindex 433dca6..5fb3638 100644\n--- a/drivers/media/IR/imon.c\n+++ b/drivers/media/IR/imon.c\n@@ -124,6 +124,7 @@ struct imon_context {\n \tstruct input_dev *idev;\t\t/* input device for remote */\n \tstruct input_dev *touch;\t/* input device for touchscreen */\n \n+\tspinlock_t kc_lock;\t\t/* make sure we get keycodes right */\n \tu32 kc;\t\t\t\t/* current input keycode */\n \tu32 last_keycode;\t\t/* last reported input keycode */\n \tu64 ir_type;\t\t\t/* iMON or MCE (RC6) IR protocol? */\n@@ -956,13 +957,20 @@ static void usb_tx_callback(struct urb *urb)\n }\n \n /**\n- * mce/rc6 keypresses have no distinct release code, use timer\n+ * Used for keypresses w/o a distinct release code, and to ensure\n+ * we don't get stuck keys if a release code is missed.\n  */\n-static void imon_mce_timeout(unsigned long data)\n+static void imon_input_timeout(unsigned long data)\n {\n \tstruct imon_context *ictx = (struct imon_context *)data;\n+\tunsigned long flags;\n+\tu32 kc;\n+\n+\tspin_lock_irqsave(&ictx->kc_lock, flags);\n+\tkc = ictx->last_keycode;\n+\tspin_unlock_irqrestore(&ictx->kc_lock, flags);\n \n-\tinput_report_key(ictx->idev, ictx->last_keycode, 0);\n+\tinput_report_key(ictx->idev, kc, 0);\n \tinput_sync(ictx->idev);\n }\n \n@@ -1006,9 +1014,6 @@ int imon_ir_change_protocol(void *priv, u64 ir_type)\n \t\tdev_dbg(dev, \"Configuring IR receiver for MCE protocol\\n\");\n \t\tir_proto_packet[0] = 0x01;\n \t\tpad_mouse = false;\n-\t\tinit_timer(&ictx->itimer);\n-\t\tictx->itimer.data = (unsigned long)ictx;\n-\t\tictx->itimer.function = imon_mce_timeout;\n \t\tbreak;\n \tcase IR_TYPE_UNKNOWN:\n \tcase IR_TYPE_OTHER:\n@@ -1191,6 +1196,9 @@ static u32 imon_mce_key_lookup(struct imon_context *ictx, u32 hw_code)\n \n \tkeycode = ir_g_keycode_from_table(ictx->idev, scancode);\n \n+\t/* not used in mce mode, but make sure we know its false */\n+\tictx->release_code = false;\n+\n \treturn keycode;\n }\n \n@@ -1217,6 +1225,7 @@ static bool imon_mouse_event(struct imon_context *ictx,\n \tu8 right_shift = 1;\n \tbool mouse_input = true;\n \tint dir = 0;\n+\tunsigned long flags;\n \n \t/* newer iMON device PAD or mouse button */\n \tif (ictx->product != 0xffdc && (buf[0] & 0x01) && len == 5) {\n@@ -1262,7 +1271,9 @@ static bool imon_mouse_event(struct imon_context *ictx,\n \t\t\t\t\t buf[1] >> right_shift & 0x1);\n \t\t}\n \t\tinput_sync(ictx->idev);\n+\t\tspin_lock_irqsave(&ictx->kc_lock, flags);\n \t\tictx->last_keycode = ictx->kc;\n+\t\tspin_unlock_irqrestore(&ictx->kc_lock, flags);\n \t}\n \n \treturn mouse_input;\n@@ -1391,9 +1402,10 @@ static int imon_parse_press_type(struct imon_context *ictx,\n \t\t\t\t unsigned char *buf, u8 ktype)\n {\n \tint press_type = 0;\n-\tint rep_delay = ictx->idev->rep[REP_DELAY];\n-\tint rep_period = ictx->idev->rep[REP_PERIOD];\n+\tint delay = ictx->idev->rep[REP_DELAY];\n+\tunsigned long flags;\n \n+\tspin_lock_irqsave(&ictx->kc_lock, flags);\n \t/* key release of 0x02XXXXXX key */\n \tif (ictx->kc == KEY_RESERVED && buf[0] == 0x02 && buf[3] == 0x00)\n \t\tictx->kc = ictx->last_keycode;\n@@ -1416,13 +1428,10 @@ static int imon_parse_press_type(struct imon_context *ictx,\n \t\t\tictx->last_keycode = ictx->kc;\n \t\t\tictx->mce_toggle_bit = buf[2];\n \t\t\tpress_type = 1;\n-\t\t\tmod_timer(&ictx->itimer,\n-\t\t\t\t  jiffies + msecs_to_jiffies(rep_delay));\n \t\t/* repeat */\n \t\t} else {\n \t\t\tpress_type = 2;\n-\t\t\tmod_timer(&ictx->itimer,\n-\t\t\t\t  jiffies + msecs_to_jiffies(rep_period));\n+\t\t\tdelay = ictx->idev->rep[REP_PERIOD];\n \t\t}\n \n \t/* incoherent or irrelevant data */\n@@ -1437,6 +1446,11 @@ static int imon_parse_press_type(struct imon_context *ictx,\n \telse\n \t\tpress_type = 1;\n \n+\tspin_unlock_irqrestore(&ictx->kc_lock, flags);\n+\n+\tif (press_type > 0)\n+\t\tmod_timer(&ictx->itimer, jiffies + msecs_to_jiffies(delay));\n+\n \treturn press_type;\n }\n \n@@ -1451,6 +1465,8 @@ static void imon_incoming_packet(struct imon_context *ictx,\n \tstruct device *dev = ictx->dev;\n \tu32 kc;\n \tbool norelease = false;\n+\tbool newkey = false;\n+\tu32 oldkc;\n \tint i;\n \tu64 temp_key;\n \tu64 panel_key = 0;\n@@ -1461,6 +1477,7 @@ static void imon_incoming_packet(struct imon_context *ictx,\n \tstruct timeval t;\n \tstatic struct timeval prev_time = { 0, 0 };\n \tu8 ktype = IMON_KEY_IMON;\n+\tunsigned long flags;\n \n \tidev = ictx->idev;\n \n@@ -1484,6 +1501,7 @@ static void imon_incoming_packet(struct imon_context *ictx,\n \t\t\tkc = imon_remote_key_lookup(ictx, remote_key);\n \t}\n \n+\tspin_lock_irqsave(&ictx->kc_lock, flags);\n \t/* keyboard/mouse mode toggle button */\n \tif (kc == KEY_KEYBOARD && !ictx->release_code) {\n \t\tictx->last_keycode = kc;\n@@ -1491,6 +1509,7 @@ static void imon_incoming_packet(struct imon_context *ictx,\n \t\t\tictx->pad_mouse = ~(ictx->pad_mouse) & 0x1;\n \t\t\tdev_dbg(dev, \"toggling to %s mode\\n\",\n \t\t\t\tictx->pad_mouse ? \"mouse\" : \"keyboard\");\n+\t\t\tspin_unlock_irqrestore(&ictx->kc_lock, flags);\n \t\t\treturn;\n \t\t} else {\n \t\t\tictx->pad_mouse = 0;\n@@ -1499,6 +1518,11 @@ static void imon_incoming_packet(struct imon_context *ictx,\n \t}\n \n \tictx->kc = kc;\n+\toldkc = ictx->last_keycode;\n+\tspin_unlock_irqrestore(&ictx->kc_lock, flags);\n+\n+\tif (ictx->kc != oldkc)\n+\t\tnewkey = true;\n \n \t/* send touchscreen events through input subsystem if touchpad data */\n \tif (ictx->display_type == IMON_DISPLAY_TYPE_VGA && len == 8 &&\n@@ -1534,15 +1558,24 @@ static void imon_incoming_packet(struct imon_context *ictx,\n \tif (ictx->kc == KEY_UNKNOWN)\n \t\tgoto unknown_key;\n \n+\tif (newkey && press_type != 0) {\n+\t\tinput_report_key(idev, oldkc, 0);\n+\t\tinput_sync(idev);\n+\t}\n+\n+\tspin_lock_irqsave(&ictx->kc_lock, flags);\n \t/* KEY_MUTE repeats from MCE and knob need to be suppressed */\n \tif ((ictx->kc == KEY_MUTE && ictx->kc == ictx->last_keycode)\n \t    && (buf[7] == 0xee || ktype == IMON_KEY_MCE)) {\n \t\tdo_gettimeofday(&t);\n \t\tmsec = tv2int(&t, &prev_time);\n \t\tprev_time = t;\n-\t\tif (msec < idev->rep[REP_DELAY])\n+\t\tif (msec < idev->rep[REP_DELAY]) {\n+\t\t\tspin_unlock_irqrestore(&ictx->kc_lock, flags);\n \t\t\treturn;\n+\t\t}\n \t}\n+\tspin_unlock_irqrestore(&ictx->kc_lock, flags);\n \n \tinput_report_key(idev, ictx->kc, press_type);\n \tinput_sync(idev);\n@@ -1553,7 +1586,9 @@ static void imon_incoming_packet(struct imon_context *ictx,\n \t\tinput_sync(idev);\n \t}\n \n+\tspin_lock_irqsave(&ictx->kc_lock, flags);\n \tictx->last_keycode = ictx->kc;\n+\tspin_unlock_irqrestore(&ictx->kc_lock, flags);\n \n \treturn;\n \n@@ -1886,6 +1921,10 @@ static struct imon_context *imon_init_intf0(struct usb_interface *intf)\n \t}\n \n \tmutex_init(&ictx->lock);\n+\tspin_lock_init(&ictx->kc_lock);\n+\tinit_timer(&ictx->itimer);\n+\tictx->itimer.data = (unsigned long)ictx;\n+\tictx->itimer.function = imon_input_timeout;\n \n \tmutex_lock(&ictx->lock);\n \n@@ -2310,8 +2349,7 @@ static void __devexit imon_disconnect(struct usb_interface *interface)\n \t\tif (!ictx->display_isopen)\n \t\t\tfree_imon_context(ictx);\n \t} else {\n-\t\tif (ictx->ir_type == IR_TYPE_RC6)\n-\t\t\tdel_timer_sync(&ictx->itimer);\n+\t\tdel_timer_sync(&ictx->itimer);\n \t\tmutex_unlock(&ictx->lock);\n \t}\n \n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Input Devices", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Jarod Wilson", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2010-07-07 17:13 UTC by Anssi Hannula", "Modified": "2011-01-23 19:41 UTC", "CC List": "3 users", "See Also": "", "Kernel Version": "2.6.35-rc4", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/media/IR/imon.c"], "methods": ["imon_mce_timeout", "imon_ir_change_protocol", "imon_mce_key_lookup", "imon_mouse_event", "imon_parse_press_type", "imon_incoming_packet", "imon_disconnect", "*imon_init_intf0", "imon_context"]}
{"id": "16272", "title": "switching to 2.6.34 broke audio on toshiba satellite x205-s9800 using snd_hda_intel module", "": "Show dependency tree", "description": "I switched from 3.6.33 on both sabayon and archlinux distros and both suffer the same symptom of no audio.\n\nalsaconf yeilds:\nLoading driver...\n:: Saving ALSA Levels [BUSY]\n/usr/sbin/alsactl: save_state:1504: No soundcards found.. [DONE]\n:: Restoring ALSA Levels [BUSY]\n/usr/sbin/alsactl: load_state:1610: No soundcards found...... [FAIL]\nSetting default volumes...\namixer: Mixer attach default error: No such file or directory\n---------\nand if I try to force it by adding snd_hda_intel to modules I hang on boot.\nalso going to attach dmesg ........\nreinstalled 3.6.33 and problem is gone, went back to 3.6.34 and broken.\n\nafter no luck fixing it on archforum I was told to post it \"upstream\" so here it is.\n\nthanks for all of the work you do.\nlet me know if any more info is required.", "patch": ["From fbe618f216830f47b183858c3380d4767b1ad02f Mon Sep 17 00:00:00 2001\nFrom: Takashi Iwai <tiwai@suse.de>\nDate: Fri, 11 Jun 2010 11:24:58 +0200\nSubject: [PATCH] ALSA: hda - Don't check capture source mixer if no ADC is available\n\nWith multiple codec configurations, some codec might have no ADC, thus\nit keeps spec->adc_nids = NULL.  This causes an Oops in alc_build_controls().\n\nReference: kernel bug #16156\n\thttps://bugzilla.kernel.org/show_bug.cgi?id=16156\n\nCc: <stable@kernel.org>\nSigned-off-by: Takashi Iwai <tiwai@suse.de>\n---\n sound/pci/hda/patch_realtek.c |   22 ++++++++++++----------\n 1 files changed, 12 insertions(+), 10 deletions(-)\n\ndiff --git a/sound/pci/hda/patch_realtek.c b/sound/pci/hda/patch_realtek.c\nindex fc767b6..f6cd8ed 100644\n--- a/sound/pci/hda/patch_realtek.c\n+++ b/sound/pci/hda/patch_realtek.c\n@@ -2619,16 +2619,18 @@ static int alc_build_controls(struct hda_codec *codec)\n \t}\n \n \t/* assign Capture Source enums to NID */\n-\tkctl = snd_hda_find_mixer_ctl(codec, \"Capture Source\");\n-\tif (!kctl)\n-\t\tkctl = snd_hda_find_mixer_ctl(codec, \"Input Source\");\n-\tfor (i = 0; kctl && i < kctl->count; i++) {\n-\t\thda_nid_t *nids = spec->capsrc_nids;\n-\t\tif (!nids)\n-\t\t\tnids = spec->adc_nids;\n-\t\terr = snd_hda_add_nid(codec, kctl, i, nids[i]);\n-\t\tif (err < 0)\n-\t\t\treturn err;\n+\tif (spec->capsrc_nids || spec->adc_nids) {\n+\t\tkctl = snd_hda_find_mixer_ctl(codec, \"Capture Source\");\n+\t\tif (!kctl)\n+\t\t\tkctl = snd_hda_find_mixer_ctl(codec, \"Input Source\");\n+\t\tfor (i = 0; kctl && i < kctl->count; i++) {\n+\t\t\thda_nid_t *nids = spec->capsrc_nids;\n+\t\t\tif (!nids)\n+\t\t\t\tnids = spec->adc_nids;\n+\t\t\terr = snd_hda_add_nid(codec, kctl, i, nids[i]);\n+\t\t\tif (err < 0)\n+\t\t\t\treturn err;\n+\t\t}\n \t}\n \tif (spec->cap_mixer) {\n \t\tconst char *kname = kctl ? kctl->id.name : NULL;\n-- \n1.7.0.2\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Sound", "Hardware": "All Linux", "Importance": "P1 high", "Assignee": "Jaroslav Kysela", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "15310", "Reported": "2010-06-22 21:48 UTC by wiggyxoxox", "Modified": "2010-09-10 10:05 UTC", "CC List": "5 users", "See Also": "", "Kernel Version": "2.6.34", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["sound/pci/hda/patch_realtek.c"], "methods": ["alc_build_controls"]}
{"id": "16213", "title": "Some NFS/RPC file transfers fail and hang automounting", "description": "Given a file \"foo\" of 50Mb on a remote machine \"remote\". The command\n<localmachine $> cp /remote_mount_point/foo bar\nnever finishes, and bar has a size lesser than foo.\nand the automounting of the local machine is hanged.\n\nThe error message in /var/log/messages is:\nkernel: Callback slot table overflowed\n\nIf foo is lesser than 10Mb, the problem does'nt occur.\nAfter several tries with the source of 50Mb,\nthe different sizes of the target file \"bar\" are random.\n\nThis incident occurs with:\nsunrpc.tcp_slot_table_entries = 16\n\nbut after tunning this parameter, all is fine with:\nsunrpc.tcp_slot_table_entries = 32", "patch": ["commit b44d6b507d40ae805288e0416d005730364d5209\nAuthor: Trond Myklebust <Trond.Myklebust@netapp.com>\nDate:   Wed Jun 16 13:57:32 2010 -0400\n\n    SUNRPC: Fix a re-entrancy bug in xs_tcp_read_calldir()\n    \n    If the attempt to read the calldir fails, then instead of storing the read\n    bytes, we currently discard them. This leads to a garbage final result when\n    upon re-entry to the same routine, we read the remaining bytes.\n    \n    Signed-off-by: Trond Myklebust <Trond.Myklebust@netapp.com>\n\ndiff --git a/net/sunrpc/xprtsock.c b/net/sunrpc/xprtsock.c\nindex 2a96751..7ca65c7 100644\n--- a/net/sunrpc/xprtsock.c\n+++ b/net/sunrpc/xprtsock.c\n@@ -210,7 +210,8 @@ struct sock_xprt {\n \t * State of TCP reply receive\n \t */\n \t__be32\t\t\ttcp_fraghdr,\n-\t\t\t\ttcp_xid;\n+\t\t\t\ttcp_xid,\n+\t\t\t\ttcp_calldir;\n \n \tu32\t\t\ttcp_offset,\n \t\t\t\ttcp_reclen;\n@@ -927,7 +928,7 @@ static inline void xs_tcp_read_calldir(struct sock_xprt *transport,\n {\n \tsize_t len, used;\n \tu32 offset;\n-\t__be32\tcalldir;\n+\tchar *p;\n \n \t/*\n \t * We want transport->tcp_offset to be 8 at the end of this routine\n@@ -936,26 +937,33 @@ static inline void xs_tcp_read_calldir(struct sock_xprt *transport,\n \t * transport->tcp_offset is 4 (after having already read the xid).\n \t */\n \toffset = transport->tcp_offset - sizeof(transport->tcp_xid);\n-\tlen = sizeof(calldir) - offset;\n+\tlen = sizeof(transport->tcp_calldir) - offset;\n \tdprintk(\"RPC:       reading CALL/REPLY flag (%Zu bytes)\\n\", len);\n-\tused = xdr_skb_read_bits(desc, &calldir, len);\n+\tp = ((char *) &transport->tcp_calldir) + offset;\n+\tused = xdr_skb_read_bits(desc, p, len);\n \ttransport->tcp_offset += used;\n \tif (used != len)\n \t\treturn;\n \ttransport->tcp_flags &= ~TCP_RCV_READ_CALLDIR;\n-\ttransport->tcp_flags |= TCP_RCV_COPY_CALLDIR;\n-\ttransport->tcp_flags |= TCP_RCV_COPY_DATA;\n \t/*\n \t * We don't yet have the XDR buffer, so we will write the calldir\n \t * out after we get the buffer from the 'struct rpc_rqst'\n \t */\n-\tif (ntohl(calldir) == RPC_REPLY)\n+\tswitch (ntohl(transport->tcp_calldir)) {\n+\tcase RPC_REPLY:\n+\t\ttransport->tcp_flags |= TCP_RCV_COPY_CALLDIR;\n+\t\ttransport->tcp_flags |= TCP_RCV_COPY_DATA;\n \t\ttransport->tcp_flags |= TCP_RPC_REPLY;\n-\telse\n+\t\tbreak;\n+\tcase RPC_CALL:\n+\t\ttransport->tcp_flags |= TCP_RCV_COPY_CALLDIR;\n+\t\ttransport->tcp_flags |= TCP_RCV_COPY_DATA;\n \t\ttransport->tcp_flags &= ~TCP_RPC_REPLY;\n-\tdprintk(\"RPC:       reading %s CALL/REPLY flag %08x\\n\",\n-\t\t\t(transport->tcp_flags & TCP_RPC_REPLY) ?\n-\t\t\t\t\"reply for\" : \"request with\", calldir);\n+\t\tbreak;\n+\tdefault:\n+\t\tdprintk(\"RPC:       invalid request message type\\n\");\n+\t\txprt_force_disconnect(&transport->xprt);\n+\t}\n \txs_tcp_check_fraghdr(transport);\n }\n \n@@ -975,12 +983,10 @@ static inline void xs_tcp_read_common(struct rpc_xprt *xprt,\n \t\t/*\n \t\t * Save the RPC direction in the XDR buffer\n \t\t */\n-\t\t__be32\tcalldir = transport->tcp_flags & TCP_RPC_REPLY ?\n-\t\t\t\t\thtonl(RPC_REPLY) : 0;\n-\n \t\tmemcpy(rcvbuf->head[0].iov_base + transport->tcp_copied,\n-\t\t\t&calldir, sizeof(calldir));\n-\t\ttransport->tcp_copied += sizeof(calldir);\n+\t\t\t&transport->tcp_calldir,\n+\t\t\tsizeof(transport->tcp_calldir));\n+\t\ttransport->tcp_copied += sizeof(transport->tcp_calldir);\n \t\ttransport->tcp_flags &= ~TCP_RCV_COPY_CALLDIR;\n \t}\n \n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "File System", "Classification": "Unclassified", "Component": "NFS", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Trond Myklebust", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2010-06-15 11:48 UTC by Philippe Dax", "Modified": "2010-07-23 23:17 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "2.6.33", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["net/sunrpc/xprtsock.c"], "methods": ["xs_tcp_read_calldir", "xs_tcp_read_common", "sock_xprt"]}
{"id": "16043", "title": "Resume w/USB remote working in 2.6.33.2, no longer in 2.6.33.10", "": "Show dependency tree", "description": "Using the latest Arch Linux kernel (2.6.33.10-1), the contents of /proc/acpi/wakeup are:\n\n[scott@blargh-htpc ~]$ cat /proc/acpi/wakeup\nDevice  S-state   Status   Sysfs node\nHUB0      S5     disabled  pci:0000:00:09.0\nXVR0      S5     disabled\nXVR1      S5     disabled\nXVR2      S5     disabled\nXVR3      S5     disabled\nXVR4      S5     disabled  pci:0000:00:16.0\nXVR5      S5     disabled\nXVR6      S5     disabled\nUAR1      S5     disabled  pnp:00:08\nUSB0      S4     enabled   pci:0000:00:04.0\nUSB1      S4     disabled  pci:0000:00:06.0\nUSBB      S3     disabled  pci:0000:00:06.1\nUSB2      S3     disabled  pci:0000:00:04.1\nAZAD      S5     disabled  pci:0000:00:08.0\nMMAC      S5     disabled  pci:0000:00:0a.0\n\n[scott@blargh-htpc pkg]$ uname -a\nLinux blargh-htpc 2.6.33-ARCH #1 SMP PREEMPT Thu May 13 11:32:37 CEST 2010 x86_64 Intel(R) Core(TM)2 Duo CPU E8400 @ 3.00GHz GenuineIntel GNU/Linu\nx\n\nThe machine will suspend to RAM correctly, but will no longer be resumed by a USB remote power-on event.  Instead, the power button on the machine must be pressed.  It then resumes correctly.\n\nThis behavior was not present in the previous kernel I was running: 2.6.33.2-1.  In that case, the machine powered back on correctly when the USB remote's power button was pressed.  There was an intermediate kernel release (2.6.33.4-1) that I have not tried, but certainly can do so if that might help determine where the regression was introduced.\n\nAdditionally if there's more information I can provide about the system and my setup, please let me know what is required.", "patch": ["Index: 2.6.33.5/drivers/usb/core/driver.c\n===================================================================\n--- 2.6.33.5.orig/drivers/usb/core/driver.c\n+++ 2.6.33.5/drivers/usb/core/driver.c\n@@ -1790,9 +1790,6 @@ int usb_external_resume_device(struct us\n \n static void choose_wakeup(struct usb_device *udev, pm_message_t msg)\n {\n-\tint\t\t\tw, i;\n-\tstruct usb_interface\t*intf;\n-\n \t/* Remote wakeup is needed only when we actually go to sleep.\n \t * For things like FREEZE and QUIESCE, if the device is already\n \t * autosuspended then its current wakeup setting is okay.\n@@ -1802,18 +1799,10 @@ static void choose_wakeup(struct usb_dev\n \t\treturn;\n \t}\n \n-\t/* If remote wakeup is permitted, see whether any interface drivers\n+\t/* Allow remote wakeup if it is enabled, even if no interface drivers\n \t * actually want it.\n \t */\n-\tw = 0;\n-\tif (device_may_wakeup(&udev->dev) && udev->actconfig) {\n-\t\tfor (i = 0; i < udev->actconfig->desc.bNumInterfaces; i++) {\n-\t\t\tintf = udev->actconfig->interface[i];\n-\t\t\tw |= intf->needs_remote_wakeup;\n-\t\t}\n-\t}\n-\n-\tudev->do_remote_wakeup = w;\n+\tudev->do_remote_wakeup = device_may_wakeup(&udev->dev);\n }\n \n int usb_suspend(struct device *dev, pm_message_t msg)\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "USB", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Alan Stern", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "7216 56331", "Reported": "2010-05-25 03:51 UTC by Scott Sturdivant", "Modified": "2013-04-09 06:23 UTC", "CC List": "4 users", "See Also": "", "Kernel Version": "2.6.33.5", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/usb/core/driver.c"], "methods": ["choose_wakeup"]}
{"id": "16027", "title": "TFP410 driver should use RSEN bit to detect presence of a digital monitor", "description": "Created attachment 26495 [details]\nPatch against linux-2.6.34 to use RSEN instead of HTPLG as monitor present indicator\n\nPresence detection of a digital monitor seems not to be reliable using the\nHTPLG bit, so use the RSEN bit instead.\n\nAs the original Xorg code suffers from the same problem, this \"bug\" is present in a kernels since this inclusion of the Xorg code into the Linux kernel (somewhere around 2.6.29, i think).", "patch": ["Signed-off-by: Dave Müller <dave.mueller@gmx.ch>\n\n--- linux-2.6.34-orig/drivers/gpu/drm/i915/dvo_tfp410.c\t2010-04-20 12:55:12.000000000 +0200\n+++ linux-2.6.34-patched/drivers/gpu/drm/i915/dvo_tfp410.c\t2010-05-22 08:38:39.000000000 +0200\n@@ -216,7 +216,7 @@\n \tuint8_t ctl2;\n \n \tif (tfp410_readb(dvo, TFP410_CTL_2, &ctl2)) {\n-\t\tif (ctl2 & TFP410_CTL_2_HTPLG)\n+\t\tif (ctl2 & TFP410_CTL_2_RSEN)\n \t\t\tret = connector_status_connected;\n \t\telse\n \t\t\tret = connector_status_disconnected;\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Video", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "drivers_video-dri-intel@kernel-bugs.osdl.org", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2010-05-22 08:29 UTC by dave.mueller", "Modified": "2010-08-08 17:14 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "2.6.29", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/gpu/drm/i915/dvo_tfp410.c"], "methods": ["tfp410_detect"]}
{"id": "15982", "title": "radeon module update for 2.6.34 breaks ALSA (snd_atiixp and snd_hda_intel)", "": "Show dependency tree", "description": "Playing sound via ATI IXP SB400 card does not work, qmmp player reports buffer underruns with ALSA, other (sox for example) applications just hangs, its possible to hear sound via FMOD , but its noisy and jerky\n\nLast worked: 2.6.33.4 , doesnt work for mainline 2.6.34 (tried with rc6 and rc7-git9)\n\n\nlspci -vv :\n\n00:14.5 Multimedia audio controller: ATI Technologies Inc IXP SB400 AC'97 Audio Controller (rev 02)\n        Subsystem: ASUSTeK Computer Inc. Device 1183\n        Control: I/O+ Mem+ BusMaster+ SpecCycle- MemWINV+ VGASnoop- ParErr- Stepping- SERR+ FastB2B- DisINTx-\n        Status: Cap+ 66MHz+ UDF- FastB2B- ParErr- DEVSEL=slow >TAbort- <TAbort- <MAbort- >SERR- <PERR- INTx-\n        Latency: 64 (500ns min), Cache Line Size: 64 bytes\n        Interrupt: pin B routed to IRQ 10\n        Region 0: Memory at febfcc00 (32-bit, non-prefetchable) [size=256]\n        Capabilities: <access denied>\n        Kernel driver in use: ATI IXP AC97 controller\n        Kernel modules: snd-atiixp\n\n\n$ lsmod\nModule                  Size  Used by\naf_packet              14550  2 \nramzswap               11293  1 \nlzo_decompress          1921  1 ramzswap\nlzo_compress            1638  1 ramzswap\nfuse                   46778  5 \nlm85                   13313  0 \nhwmon_vid               1916  1 lm85\nhwmon                   1053  1 lm85\nrfcomm                 28298  0 \nl2cap                  28430  3 rfcomm\nbluetooth              41839  2 rfcomm,l2cap\nsnd_seq_oss            21061  0 \nsnd_seq_midi_event      3924  1 snd_seq_oss\nsnd_seq                34905  4 snd_seq_oss,snd_seq_midi_event\nsnd_seq_device          3849  2 snd_seq_oss,snd_seq\nsnd_pcm_oss            31107  0 \nsnd_mixer_oss          11422  1 snd_pcm_oss\narc4                     946  2 \necb                     1401  2 \ncryptomgr              85846  0 \ncrypto_hash             8171  1 cryptomgr\naead                    3651  1 cryptomgr\npcompress                857  1 cryptomgr\ncrypto_blkcipher        7367  2 ecb,cryptomgr\ncrypto_algapi           9122  7 arc4,ecb,cryptomgr,crypto_hash,aead,pcompress,crypto_blkcipher\nrt2500pci              11701  0 \nrt2x00pci               4101  1 rt2500pci\nrt2x00lib              17608  2 rt2500pci,rt2x00pci\nmac80211              118215  2 rt2x00pci,rt2x00lib\ncfg80211              100901  2 rt2x00lib,mac80211\nrfkill                 10896  2 bluetooth,cfg80211\nsnd_atiixp              9825  1 \neeprom_93cx6             904  1 rt2500pci\nsnd_atiixp_modem        7115  0 \nusbhid                 15253  0 \npcmcia                 24282  0 \nsnd_ac97_codec         82624  2 snd_atiixp,snd_atiixp_modem\nasus_laptop            12148  0 \njoydev                  7320  0 \nac97_bus                 702  1 snd_ac97_codec\nmmc_block               6664  0 \nsdhci_pci               5250  0 \nsdhci                  13041  1 sdhci_pci\nyenta_socket           18247  2 \nsnd_pcm                53401  4 snd_pcm_oss,snd_atiixp,snd_atiixp_modem,snd_ac97_codec\nrtc_cmos                7454  0 \nsnd_timer              14278  2 snd_seq,snd_pcm\nmmc_core               39614  2 mmc_block,sdhci\nehci_hcd               32254  0 \nohci_hcd               19709  0 \nvideo                  14806  0 \nsnd                    35728  12 snd_seq_oss,snd_seq,snd_seq_device,snd_pcm_oss,snd_mixer_oss,snd_atiixp,snd_atiixp_modem,snd_ac97_codec,snd_pcm,snd_timer\nbacklight               2648  2 asus_laptop,video\nrtc_core                9613  1 rtc_cmos\nrsrc_nonstatic          8269  1 yenta_socket\nthermal                 9230  0 \nac                      1528  0 \nprocessor              18341  1 \n8139too                15014  0 \nbattery                 3686  0 \nsoundcore               4303  1 snd\nppdev                   5026  0 \noutput                  1164  1 video\nparport_pc             28009  0 \nparport                23883  2 ppdev,parport_pc\nrtc_lib                 1402  1 rtc_core\nevdev                   6269  13 \nled_class               1789  3 rt2x00lib,asus_laptop,sdhci\nsg                     19333  0 \nbutton                  3494  0 \nusbcore               109287  3 usbhid,ehci_hcd,ohci_hcd\npcmcia_core            22624  3 pcmcia,yenta_socket,rsrc_nonstatic\nsnd_page_alloc          5185  3 snd_atiixp,snd_atiixp_modem,snd_pcm\npsmouse                28785  0 \nsr_mod                  9830  0 \npcspkr                  1299  0 \ni2c_piix4               7680  0 \nmii                     2850  1 8139too\ncdrom                  27927  1 sr_mod\nnls_base                4761  1 usbcore", "patch": ["From 72b193ddedb34aa573bc40b4a80a81501225b5a6 Mon Sep 17 00:00:00 2001\nFrom: Alex Deucher <alexdeucher@gmail.com>\nDate: Thu, 20 May 2010 10:50:46 -0400\nSubject: [PATCH] drm/radeon/kms: don't default display priority to high on rs4xx\n\nSeems to cause issues with the sound hardware.  Fixes kernel\nbug 15982:\nhttps://bugzilla.kernel.org/show_bug.cgi?id=15982\n\nSigned-off-by: Alex Deucher <alexdeucher@gmail.com>\nCc: stable@kernel.org\n---\n drivers/gpu/drm/radeon/radeon_display.c |    5 ++++-\n 1 files changed, 4 insertions(+), 1 deletions(-)\n\ndiff --git a/drivers/gpu/drm/radeon/radeon_display.c b/drivers/gpu/drm/radeon/radeon_display.c\nindex bd44f88..073ec61 100644\n--- a/drivers/gpu/drm/radeon/radeon_display.c\n+++ b/drivers/gpu/drm/radeon/radeon_display.c\n@@ -976,8 +976,11 @@ void radeon_update_display_priority(struct radeon_device *rdev)\n \t\t/* set display priority to high for r3xx, rv515 chips\n \t\t * this avoids flickering due to underflow to the\n \t\t * display controllers during heavy acceleration.\n+\t\t * Don't force high on rs4xx igp chips as it seems to\n+\t\t * affect the sound card.  See kernel bug 15982.\n \t\t */\n-\t\tif (ASIC_IS_R300(rdev) || (rdev->family == CHIP_RV515))\n+\t\tif ((ASIC_IS_R300(rdev) || (rdev->family == CHIP_RV515)) &&\n+\t\t    !(rdev->flags & RADEON_IS_IGP))\n \t\t\trdev->disp_priority = 2;\n \t\telse\n \t\t\trdev->disp_priority = 0;\n-- \n1.5.6.3\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Video", "Hardware": "i386 Linux", "Importance": "P1 high", "Assignee": "Jaroslav Kysela", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "15310", "Reported": "2010-05-16 08:41 UTC by Sylvia", "Modified": "2010-06-13 11:38 UTC", "CC List": "5 users", "See Also": "", "Kernel Version": "2.6.34", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/gpu/drm/radeon/radeon_display.c"], "methods": ["radeon_update_display_priority"]}
{"id": "15979", "title": "Eeepc 900 reports incorrect battery status", "description": "On eeepc 900 (and possibly other variants) the battery status is incorrectly reported, possibly do to a mixup of units.\n\nWith power plugged in and battery fully charged:\n$ cat /proc/acpi/battery/BAT0/info \npresent:                 yes\ndesign capacity:         5200 mAh\nlast full capacity:      100 mAh\nbattery technology:      rechargeable\ndesign voltage:          8400 mV\ndesign capacity warning: 20 mAh\ndesign capacity low:     10 mAh\ncapacity granularity 1:  52 mAh\ncapacity granularity 2:  52 mAh\nmodel number:            900\nserial number:            \nbattery type:            LION\nOEM info:                ASUS\n\n$ cat /proc/acpi/battery/BAT0/state \npresent:                 yes\ncapacity state:          ok\ncharging state:          charged\npresent rate:            unknown\nremaining capacity:      100 mAh\npresent voltage:         8326 mV\n\n\nlast full capacity remaining capacity are reported by asus in %\nthere may be a similar problem with granularity\n\nAs a result of the above ubuntu reports a broken battery on each login and remaining battery time is incorrectly estimated.\n\nAdditional info might be obtained from asus linux kernel sources?\n\nFerry", "patch": ["\nAccording to the ACPI spec, some kinds of primary battery can\nreport percentage battery ramaining capacity directly to OS.\n\nIn this case, it reports the LastFullChargedCapacity == 100,\nBatteryPresentRate = 0xFFFFFFFF, and BatteryRemaingCapacity a\npercentage value, which actually means RemainingBatteryPercentage.\n\nNow we found some battery follows this rule even if it's a rechargable.\nhttps://bugzilla.kernel.org/show_bug.cgi?id=15979\n\nHandle these batteries correctly in ACPI battery driver\nso that they won't break userspace.\n\nSigned-off-by: Zhang Rui <rui.zhang@intel.com>\n---\n drivers/acpi/battery.c |   38 +++++++++++++++++++++++++++++++++++++-\n 1 file changed, 37 insertions(+), 1 deletion(-)\n\nIndex: linux-2.6/drivers/acpi/battery.c\n===================================================================\n--- linux-2.6.orig/drivers/acpi/battery.c\n+++ linux-2.6/drivers/acpi/battery.c\n@@ -98,6 +98,7 @@ enum {\n \t * due to bad math.\n \t */\n \tACPI_BATTERY_QUIRK_SIGNED16_CURRENT,\n+\tACPI_BATTERY_QUIRK_PERCENTAGE_CAPACITY,\n };\n \n struct acpi_battery {\n@@ -412,6 +413,8 @@ static int acpi_battery_get_info(struct \n \t\tresult = extract_package(battery, buffer.pointer,\n \t\t\t\tinfo_offsets, ARRAY_SIZE(info_offsets));\n \tkfree(buffer.pointer);\n+\tif (test_bit(ACPI_BATTERY_QUIRK_PERCENTAGE_CAPACITY, &battery->flags))\n+\t\tbattery->full_charge_capacity = battery->design_capacity;\n \treturn result;\n }\n \n@@ -448,6 +451,10 @@ static int acpi_battery_get_state(struct\n \t    battery->rate_now != -1)\n \t\tbattery->rate_now = abs((s16)battery->rate_now);\n \n+\tif (test_bit(ACPI_BATTERY_QUIRK_PERCENTAGE_CAPACITY, &battery->flags)\n+\t    && battery->capacity_now >= 0 && battery->capacity_now <= 100)\n+\t\tbattery->capacity_now = (battery->capacity_now *\n+\t\t\t\tbattery->full_charge_capacity) / 100;\n \treturn result;\n }\n \n@@ -561,6 +568,33 @@ static void acpi_battery_quirks(struct a\n \t}\n }\n \n+/*\n+ * According to the ACPI spec, some kinds of primary battery can\n+ * report percentage battery ramaining capacity directly to OS.\n+ * In this case, it reports the Last Full Charged Capacity == 100\n+ * and BatteryPresentRate = 0xFFFFFFFF.\n+ *\n+ * Now we found some battery reports percentage remaining capacity\n+ * even if it's a rechargable.\n+ * https://bugzilla.kernel.org/show_bug.cgi?id=15979\n+ *\n+ * Handle this correctly so that they won't break userspace.\n+ */\n+static void acpi_battery_quirks2(struct acpi_battery *battery)\n+{\n+\tif (test_bit(ACPI_BATTERY_QUIRK_PERCENTAGE_CAPACITY, &battery->flags))\n+\t\treturn ;\n+\n+        if (battery->full_charge_capacity == 100 &&\n+            battery->rate_now == ACPI_BATTERY_VALUE_UNKNOWN &&\n+            battery->capacity_now >=0 && battery->capacity_now <= 100) {\n+\t\tset_bit(ACPI_BATTERY_QUIRK_PERCENTAGE_CAPACITY, &battery->flags);\n+\t\tbattery->full_charge_capacity = battery->design_capacity;\n+\t\tbattery->capacity_now = (battery->capacity_now *\n+\t\t\t\tbattery->full_charge_capacity) / 100;\n+\t}\n+}\n+\n static int acpi_battery_update(struct acpi_battery *battery)\n {\n \tint result, old_present = acpi_battery_present(battery);\n@@ -586,7 +620,9 @@ static int acpi_battery_update(struct ac\n \tif (!battery->bat.dev)\n \t\tsysfs_add_battery(battery);\n #endif\n-\treturn acpi_battery_get_state(battery);\n+\tresult = acpi_battery_get_state(battery);\n+\tacpi_battery_quirks2(battery);\n+\treturn result;\n }\n \n /* --------------------------------------------------------------------------\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "Power-Battery", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Zhang Rui", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2010-05-15 19:30 UTC by Ferry Toth", "Modified": "2010-11-02 02:55 UTC", "CC List": "4 users", "See Also": "", "Kernel Version": "2.6.32", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/acpi/battery.c"], "methods": ["acpi_battery_get_info", "acpi_battery_get_state", "acpi_battery_update"]}
{"id": "15908", "title": "Not able to use nozomi modem", "description": "There is device in /dev/ directory:\n\nls -l /dev/noz*\ncrw-rw---- 1 root dialout 251, 0 2010-05-05 11:31 /dev/noz0\ncrw-rw---- 1 root dialout 251, 1 2010-05-05 11:31 /dev/noz1\ncrw-rw---- 1 root dialout 251, 2 2010-05-05 11:31 /dev/noz2\ncrw-rw---- 1 root dialout 251, 3 2010-05-05 11:31 /dev/noz3\n\nbut trying to use it from any probram (pppd, comgt) gives:\nCan't open device /dev/noz0\n\nand the dmesg has:\n\nWarning: dev (noz0) tty->count(0) != #fd's(1) in tty_open\nnoz: activated 0: f685b860\nBUG: unable to handle kernel NULL pointer dereference at 000000bc\nIP: [<c046b03c>] mutex_lock+0xc/0x30\n*pde = 00000000\nOops: 0002 [#1] SMP\nlast sysfs file: /sys/devices/pci0000:00/0000:00:14.4/0000:02:06.0/net/mon.wlan0                                              /flags\nModules linked in: binfmt_misc xt_state xt_tcpudp ipt_MASQUERADE iptable_nat nf_                                              nat nf_conntrack_ipv4 nf_conntrack nf_defrag_ipv4 nozomi arc4 pcmcia ecb ath5k m                                              ac80211 ath iptable_filter ppdev yenta_socket parport_pc rsrc_nonstatic r8169 ip                                              _tables lp x_tables usbserial pcmcia_core mii shpchp parport cfg80211 i2c_piix4                                               k8temp led_class serio_raw\n\nPid: 1429, comm: wvdial Not tainted 2.6.34-rc6-m03 #1 GA-MA69VM-S2/GA-MA69VM-S2\nEIP: 0060:[<c046b03c>] EFLAGS: 00210296 CPU: 0\nEIP is at mutex_lock+0xc/0x30\nEAX: 000000bc EBX: 000000bc ECX: f4e1ec00 EDX: f685b800\nESI: 00001000 EDI: 000000bc EBP: 00000000 ESP: f68f5b18\n DS: 007b ES: 007b FS: 00d8 GS: 0033 SS: 0068\nProcess wvdial (pid: 1429, ti=f68f4000 task=f60462e0 task.ti=f68f4000)\nStack:\n 00000000 00001000 f802d3c5 f4e1ec00 00000000 f802d410 c02fda15 c02fb625\n<0> f6ad2700 f4e1ec00 f6ba78b8 00000000 c02f7a9a f306bac0 c02fb4d0 00000004\n<0> 00000010 f6ad2700 00000000 c01c67b7 f306bac0 00200286 ff000000 00000005\nCall Trace:\n [<f802d3c5>] ? ntty_write_room+0x45/0x90 [nozomi]\n [<f802d410>] ? ntty_write+0x0/0x1f0 [nozomi]\n [<c02fda15>] ? tty_write_room+0x15/0x20\n [<c02fb625>] ? n_tty_poll+0x155/0x170\n [<c02f7a9a>] ? tty_poll+0x6a/0x80\n [<c02fb4d0>] ? n_tty_poll+0x0/0x170\n [<c01c67b7>] ? do_select+0x2b7/0x4f0\n [<c01c6f30>] ? __pollwait+0x0/0xf0\n [<c028c569>] ? elv_rb_add+0x79/0x90\n [<c029904c>] ? cfq_insert_request+0x46c/0x4f0\n [<c02a1516>] ? vsnprintf+0xb6/0x7f0\n [<c03d1972>] ? raw_pci_write+0x82/0x90\n [<c014f22b>] ? up+0xb/0x40\n [<c01368eb>] ? release_console_sem+0x1ab/0x1f0\n [<c01b488d>] ? __mem_cgroup_try_charge+0x5d/0x400\n [<c061ffff>] ? powernow_cpu_init+0x16/0x426\n [<c02a07db>] ? string+0x3b/0xd0\n [<c046a164>] ? printk+0x17/0x1b\n [<f802be4e>] ? ntty_activate+0x7e/0xf0 [nozomi]\n [<c012a262>] ? __wake_up+0x42/0x60\n [<c0300757>] ? tty_port_block_til_ready+0x1e7/0x270\n [<c03008b9>] ? tty_port_tty_set+0x39/0x60\n [<c014a400>] ? autoremove_wake_function+0x0/0x40\n [<c02fa8f9>] ? tty_open+0x279/0x530\n [<c031ddc2>] ? kobj_lookup+0xf2/0x140\n [<c01c6ba3>] ? core_sys_select+0x1b3/0x2b0\n [<c02fe899>] ? tty_mode_ioctl+0xa9/0x420\n [<c02f9679>] ? tty_ioctl+0xc9/0x7d0\n [<c0198e19>] ? handle_mm_fault+0x139/0x9c0\n [<c02f95b0>] ? tty_ioctl+0x0/0x7d0\n [<c01c480b>] ? vfs_ioctl+0x2b/0xb0\n [<c01c49f9>] ? do_vfs_ioctl+0x79/0x5c0\n [<c046f3a0>] ? do_page_fault+0x0/0x3e0\n [<c046f544>] ? do_page_fault+0x1a4/0x3e0\n [<c01c6e5f>] ? sys_select+0x2f/0xb0\n [<c0102c10>] ? sysenter_do_call+0x12/0x22\nCode: 8b 74 24 24 8b 7c 24 28 8b 6c 24 2c 83 c4 30 c3 00 00 00 00 00 00 00 00 00                                               00 00 00 00 00 00 83 ec 08 89 1c 24 89 c3 89 74 24 04 <3e> ff 08 79 05 e8 ba 00                                               00 00 89 e0 8b 74 24 04 25 00 e0 ff ff\nEIP: [<c046b03c>] mutex_lock+0xc/0x30 SS:ESP 0068:f68f5b18\nCR2: 00000000000000bc\n---[ end trace 6e73d3662da499c0 ]---\nWarning: dev (noz0) tty->count(0) != #fd's(1) in tty_release_dev\ntty_release_dev: bad tty->count (-1) for noz0\n\n\n\n\nstrace comgt sig -d /dev/noz0\nexecve(\"/usr/local/bin/comgt\", [\"comgt\", \"sig\", \"-d\", \"/dev/noz0\"], [/* 19 vars */]) = 0\nbrk(0)                                  = 0x84d2000\naccess(\"/etc/ld.so.nohwcap\", F_OK)      = -1 ENOENT (No such file or directory)\nmmap2(NULL, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0xb77f7000\naccess(\"/etc/ld.so.preload\", R_OK)      = -1 ENOENT (No such file or directory)\nopen(\"/etc/ld.so.cache\", O_RDONLY)      = 3\nfstat64(3, {st_mode=S_IFREG|0644, st_size=60969, ...}) = 0\nmmap2(NULL, 60969, PROT_READ, MAP_PRIVATE, 3, 0) = 0xb77e8000\nclose(3)                                = 0\naccess(\"/etc/ld.so.nohwcap\", F_OK)      = -1 ENOENT (No such file or directory)\nopen(\"/lib/tls/i686/cmov/libc.so.6\", O_RDONLY) = 3\nread(3, \"\\177ELF\\1\\1\\1\\0\\0\\0\\0\\0\\0\\0\\0\\0\\3\\0\\3\\0\\1\\0\\0\\0\\260l\\1\\0004\\0\\0\\0\"..., 512) = 512\nfstat64(3, {st_mode=S_IFREG|0755, st_size=1319364, ...}) = 0\nmmap2(NULL, 1329512, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) = 0xb76a3000\nmprotect(0xb77e1000, 4096, PROT_NONE)   = 0\nmmap2(0xb77e2000, 12288, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x13e) = 0xb77e2000\nmmap2(0xb77e5000, 10600, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) = 0xb77e5000\nclose(3)                                = 0\nmmap2(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0xb76a2000\nset_thread_area({entry_number:-1 -> 6, base_addr:0xb76a26c0, limit:1048575, seg_32bit:1, contents:0, read_exec_only:0, limit_in_pages:1, seg_not_present:0, useable:1}) = 0\nmprotect(0xb77e2000, 8192, PROT_READ)   = 0\nmprotect(0x8050000, 4096, PROT_READ)    = 0\nmprotect(0xb7815000, 4096, PROT_READ)   = 0\nmunmap(0xb77e8000, 60969)               = 0\ntime(NULL)                              = 1273052631\ngettimeofday({1273052631, 353770}, NULL) = 0\nioctl(1, SNDCTL_TMR_TEMPO or TCGETA, {B38400 opost isig icanon echo ...}) = 0\nbrk(0)                                  = 0x84d2000\nbrk(0x84f4000)                          = 0x84f4000\nbrk(0x84f3000)                          = 0x84f3000\nopen(\"/dev/noz0\", O_RDWR|O_EXCL|O_NOCTTY|O_NONBLOCK) = -1 EIO (Input/output error)\nfstat64(1, {st_mode=S_IFCHR|0600, st_rdev=makedev(136, 1), ...}) = 0\nmmap2(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0xb77f6000\nwrite(1, \"Can't open device /dev/noz0.\\n\", 29Can't open device /dev/noz0.\n) = 29\nioctl(1, SNDCTL_TMR_SOURCE or TCSETA, {B38400 opost isig icanon echo ...}) = 0\nexit_group(1)                           = ?\n\n\nGnu C                  4.4.1\nGnu make               3.81\nbinutils               2.20\nutil-linux             2.16\nmount                  support\nmodule-init-tools      3.10\ne2fsprogs              1.41.9\npcmciautils            014\nPPP                    2.4.5\nLinux C Library        2.10.1\nDynamic linker (ldd)   2.10.1\nProcps                 3.2.8\nNet-tools              1.60\nKbd                    1.15\nSh-utils               7.4\nwireless-tools         29\nModules Loaded         ipt_REDIRECT ppp_async crc_ccitt binfmt_misc arc4 ecb xt_state\n xt_tcpudp ipt_MASQUERADE iptable_nat nf_nat nf_conntrack_ipv4 nozomi nf_conntrack\n nf_defrag_ipv4 ath5k mac80211 ath iptable_filter ip_tables cfg80211 x_tables\n rfkill_backport pcmcia compat yenta_socket ppdev parport_pc rsrc_nonstaticlp\n pcmcia_core led_class parport usbserial serio_raw k8temp shpchp i2c_piix4 r8169 mii", "patch": ["---\n drivers/char/nozomi.c |    1 +\n 1 file changed, 1 insertion(+)\n\n--- a/drivers/char/nozomi.c\n+++ b/drivers/char/nozomi.c\n@@ -1611,6 +1611,7 @@ static int ntty_install(struct tty_drive\n \tret = tty_init_termios(tty);\n \tif (ret == 0) {\n \t\ttty_driver_kref_get(driver);\n+\t\ttty->count++;\n \t\tdriver->ttys[tty->index] = tty;\n \t}\n \treturn ret;\n", "From ece3b74e09c0b76395941bee4dbe9535cbee677e Mon Sep 17 00:00:00 2001\nFrom: Jiri Slaby <jslaby@suse.cz>\nDate: Thu, 29 Jul 2010 11:29:18 +0200\nSubject: [PATCH 1/1] Char: nozomi, set tty->driver_data appropriately\n\nSorry, one more fix, this one depends on the other, so this is rather 2/2.\n--\n\ntty->driver_data is used all over the code, but never set. This\nresults in oopses like:\nBUG: unable to handle kernel NULL pointer dereference at 0000000000000130\nIP: [<ffffffff814a0040>] mutex_lock+0x10/0x40\n...\nPid: 2157, comm: modem-manager Not tainted 2.6.34.1-0.1-desktop #1 2768DR7/2768DR7\nRIP: 0010:[<ffffffff814a0040>]  [<ffffffff814a0040>] mutex_lock+0x10/0x40\nRSP: 0018:ffff88007b16fa50  EFLAGS: 00010286\nRAX: 0000000000000000 RBX: 0000000000000130 RCX: 0000000000000003\nRDX: 0000000000000003 RSI: 0000000000000286 RDI: 0000000000000130\nRBP: 0000000000001000 R08: 0000000000000000 R09: 0000000000000000\nR10: 0000000000000001 R11: 0000000000000000 R12: 0000000000000130\nR13: 0000000000000001 R14: 0000000000000000 R15: ffff88007b16feb4\n...\nCall Trace:\n [<ffffffffa077690d>] ntty_write_room+0x4d/0x90 [nozomi]\n...\n\nSet tty->driver_data to the computed port in .install to not recompute it in\nevery place where needed. Switch .open to use driver_data too.\n\nSigned-off-by: Jiri Slaby <jslaby@suse.cz>\nCc: Alan Cox <alan@linux.intel.com>\n---\n drivers/char/nozomi.c |    3 ++-\n 1 files changed, 2 insertions(+), 1 deletions(-)\n\ndiff --git a/drivers/char/nozomi.c b/drivers/char/nozomi.c\nindex 7f9b858..817169c 100644\n--- a/drivers/char/nozomi.c\n+++ b/drivers/char/nozomi.c\n@@ -1612,6 +1612,7 @@ static int ntty_install(struct tty_driver *driver, struct tty_struct *tty)\n \tif (ret == 0) {\n \t\ttty_driver_kref_get(driver);\n \t\ttty->count++;\n+\t\ttty->driver_data = port;\n \t\tdriver->ttys[tty->index] = tty;\n \t}\n \treturn ret;\n@@ -1640,7 +1641,7 @@ static int ntty_activate(struct tty_port *tport, struct tty_struct *tty)\n \n static int ntty_open(struct tty_struct *tty, struct file *filp)\n {\n-\tstruct port *port = get_port_by_tty(tty);\n+\tstruct port *port = tty->driver_data;\n \treturn tty_port_open(&port->port, tty, filp);\n }\n \n-- \n1.7.2\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Other", "Hardware": "i386 Linux", "Importance": "P1 normal", "Assignee": "drivers_other", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2010-05-05 12:32 UTC by Marek", "Modified": "2012-05-13 14:35 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "2.6.34-rc6", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/char/nozomi.c"], "methods": ["ntty_install"]}
{"id": "15903", "title": "PNP resource assignment fails", "description": "Pavel wrote:\n> i am playing with old PIII computer (HP Vectra VE) and ISA soundcards.\n> Soundcards are PNP(yamaha,opti,ess,...) and no PNP (multisound).\n> Machine\n> is old, but ACPI compliant - old BIOS.\n> \n> Computer booting OK. PNP0 devices allocate resources OK, but PNP1\n> devices (one ISA slot) not. PNP soundcard driver is not correctly\n> loaded\n> - soundcard device not created.\n\n> 2.6.33 kernel working without problem.", "patch": ["diff --git a/drivers/pnp/resource.c b/drivers/pnp/resource.c\nindex 2e54e6a..e3446ab 100644\n--- a/drivers/pnp/resource.c\n+++ b/drivers/pnp/resource.c\n@@ -211,6 +211,8 @@ int pnp_check_port(struct pnp_dev *dev, struct resource *res)\n \t\t\tif (tres->flags & IORESOURCE_IO) {\n \t\t\t\tif (cannot_compare(tres->flags))\n \t\t\t\t\tcontinue;\n+\t\t\t\tif (tres->flags & IORESOURCE_WINDOW)\n+\t\t\t\t\tcontinue;\n \t\t\t\ttport = &tres->start;\n \t\t\t\ttend = &tres->end;\n \t\t\t\tif (ranged_conflict(port, end, tport, tend))\n@@ -271,6 +273,8 @@ int pnp_check_mem(struct pnp_dev *dev, struct resource *res)\n \t\t\tif (tres->flags & IORESOURCE_MEM) {\n \t\t\t\tif (cannot_compare(tres->flags))\n \t\t\t\t\tcontinue;\n+\t\t\t\tif (tres->flags & IORESOURCE_WINDOW)\n+\t\t\t\t\tcontinue;\n \t\t\t\ttaddr = &tres->start;\n \t\t\t\ttend = &tres->end;\n \t\t\t\tif (ranged_conflict(addr, end, taddr, tend))\n\n\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "PNP", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Bjorn Helgaas", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2010-05-03 15:23 UTC by Bjorn Helgaas", "Modified": "2010-05-20 03:05 UTC", "CC List": "3 users", "See Also": "", "Kernel Version": "2.6.34-rc6", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/pnp/resource.c"], "methods": ["pnp_check_port", "pnp_check_mem"]}
{"id": "15789", "title": "Bind mounts broken when used with NFSv4", "description": "There is some serious weirdness if you try and use bind mounts in conjunction with nfs4 mounts.\n\n $ df -T /var/tmp\nFilesystem    Type   1K-blocks      Used Available Use% Mounted on\nfs.beware.dropbear.id.au:/tmp/\n              nfs4     5160576    403968   4494464   9% /var/tmp\n $ df -T /tmp\nFilesystem    Type   1K-blocks      Used Available Use% Mounted on\n/tmp         tmpfs      921600         4    921596   1% /tmp\n $ cat /tmp/foo\nOver The Lazy Dogs Back\n $ cat /var/tmp/foo\nThe Quick Brown Fox\n#\n# So /var/tmp/foo is on an nfs4 mounted filesystem\n# /tmp/foo is on a tmpfs. Both files are different.\n#\n $ mount --bind /tmp/foo /var/tmp/foo\n $ cat /tmp/foo\nOver The Lazy Dogs Back\n $ cat /var/tmp/foo\nThe Quick Brown Fox\n#\n# Both files should be the same. ie \"Over The Lazy Dogs Back\"\n#\n# In other oddity, ls -l correctly shows both files the same size (31),\n# and ls -i correctly shows both have the same inode number, yet:\n $ cat /tmp/foo | wc -c\n31\n $ cat /var/tmp/foo | wc -c\n20\n#\n# So much for reading. Now what about writing?\n#\n $ echo blah blah > /var/tmp/foo\n $ cat /var/tmp/foo\nblah blah\nBrown Fox\n#\n# This should have been truncated\n#\n $ cat /tmp/foo\n#\n# /tmp/foo has been truncated, but it should have \"blah blah\" in it\n#\n $ umount /var/tmp/foo\n $ cat /var/tmp/foo\nblah blah\nBrown Fox\n $cat /tmp/foo\n# Empty", "patch": ["NFSv4: Don't attempt an atomic open if the file is a mountpoint\n\nFrom: Trond Myklebust <Trond.Myklebust@netapp.com>\n\nFix https://bugzilla.kernel.org/show_bug.cgi?id=15789\n\nSigned-off-by: Trond Myklebust <Trond.Myklebust@netapp.com>\n---\n\n fs/nfs/dir.c |    2 +-\n 1 files changed, 1 insertions(+), 1 deletions(-)\n\n\ndiff --git a/fs/nfs/dir.c b/fs/nfs/dir.c\nindex be46f26..fbb4cf7 100644\n--- a/fs/nfs/dir.c\n+++ b/fs/nfs/dir.c\n@@ -1050,7 +1050,7 @@ static int nfs_open_revalidate(struct dentry *dentry, struct nameidata *nd)\n \tstruct inode *dir;\n \tint openflags, ret = 0;\n \n-\tif (!is_atomic_open(nd))\n+\tif (!is_atomic_open(nd) || d_mountpoint(dentry))\n \t\tgoto no_open;\n \tparent = dget_parent(dentry);\n \tdir = parent->d_inode;\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "File System", "Classification": "Unclassified", "Component": "NFS", "Hardware": "All Linux", "Importance": "P1 high", "Assignee": "Trond Myklebust", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2010-04-15 14:33 UTC by Ian Dall", "Modified": "2012-05-14 17:23 UTC", "CC List": "1 user", "See Also": "", "Kernel Version": "2.6.32", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["fs/nfs/dir.c"], "methods": ["nfs_open_revalidate"]}
{"id": "15788", "title": "external usb sound card doesn't work after resume", "": "Show dependency tree", "description": "My external usb sound card doesn't work after resume. What is strange is that it appears in lsusb output but not in aplay -l. I am using tuxonice but the problem also occurs with the suspend-to-disk functionality of the mainline kernel.", "patch": ["Index: usb-2.6/drivers/usb/core/driver.c\n===================================================================\n--- usb-2.6.orig/drivers/usb/core/driver.c\n+++ usb-2.6/drivers/usb/core/driver.c\n@@ -1321,6 +1321,7 @@ int usb_resume(struct device *dev, pm_me\n \n \t/* For all other calls, take the device back to full power and\n \t * tell the PM core in case it was autosuspended previously.\n+\t * Unbind the interfaces that will need rebinding later.\n \t */\n \t} else {\n \t\tstatus = usb_resume_both(udev, msg);\n@@ -1329,6 +1330,7 @@ int usb_resume(struct device *dev, pm_me\n \t\t\tpm_runtime_set_active(dev);\n \t\t\tpm_runtime_enable(dev);\n \t\t\tudev->last_busy = jiffies;\n+\t\t\tdo_unbind_rebind(udev, DO_REBIND);\n \t\t}\n \t}\n \n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Sound", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Jaroslav Kysela", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "7216 15310", "Reported": "2010-04-15 10:16 UTC by François Valenduc", "Modified": "2010-06-13 12:14 UTC", "CC List": "5 users", "See Also": "", "Kernel Version": "2.6.34-rc2", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/usb/core/driver.c"], "methods": ["usb_resume"]}
{"id": "15537", "title": "2.6.34-rc1 hangs for 30 seconds when trying to access the disk", "": "Show dependency tree", "description": "The system works fine with 2.6.33 \nCompiling 2.6.34-rc1 I accepted the defaults for all the new options (except the max no of GPUs). The kernel boot Ok but when I try to use the system and access the disk it freezes for about 30 seconds with no disk activity and then I get a message like this in the system log\n\nMar 11 14:57:57 eccles kernel: ata2: clearing spurious IRQ\nMar 11 14:58:27 eccles kernel: ata2: lost interrupt (Status 0x50)\nMar 11 14:58:27 eccles kernel: ata2.01: exception Emask 0x0 SAct 0x0 SErr 0x0 action 0x0 frozen\nMar 11 14:58:27 eccles kernel: ata2.01: failed command: WRITE DMA\nMar 11 14:58:27 eccles kernel: ata2.01: cmd ca/00:08:4c:37:6f/00:00:00:00:00/fd tag 0 dma 4096 out\nMar 11 14:58:27 eccles kernel:          res 40/00:00:00:00:00/00:00:00:00:00/10 Emask 0x4 (timeout)\nMar 11 14:58:27 eccles kernel: ata2.01: status: { DRDY }\nMar 11 14:58:27 eccles kernel: ata2.00: hard resetting link\nMar 11 14:58:28 eccles kernel: ata2.01: hard resetting link\nMar 11 14:58:28 eccles kernel: ata2.00: SATA link down (SStatus 0 SControl 300)\nMar 11 14:58:28 eccles kernel: ata2.01: SATA link up 3.0 Gbps (SStatus 123 SControl 300)\nMar 11 14:58:28 eccles kernel: ata2.01: configured for UDMA/133\nMar 11 14:58:28 eccles kernel: ata2.01: device reported invalid CHS sector 0\nMar 11 14:58:28 eccles kernel: ata2: EH complete\n\nOr this:\n\nMar 14 22:59:33 eccles kernel: ata2: clearing spurious IRQ\nMar 14 23:00:03 eccles kernel: ata2: lost interrupt (Status 0x50)\nMar 14 23:00:03 eccles kernel: ata2.01: exception Emask 0x0 SAct 0x0 SErr 0x0 action 0x0 frozen\nMar 14 23:00:03 eccles kernel: ata2.01: failed command: READ DMA\nMar 14 23:00:03 eccles kernel: ata2.01: cmd c8/00:08:cc:46:37/00:00:00:00:00/fc tag 0 dma 4096 in\nMar 14 23:00:03 eccles kernel:          res 40/00:00:00:00:00/00:00:00:00:00/10 Emask 0x4 (timeout)\nMar 14 23:00:03 eccles kernel: ata2.01: status: { DRDY }\nMar 14 23:00:03 eccles kernel: ata2.00: hard resetting link\nMar 14 23:00:04 eccles kernel: ata2.01: hard resetting link\nMar 14 23:00:04 eccles kernel: ata2.00: SATA link down (SStatus 0 SControl 300)\nMar 14 23:00:04 eccles kernel: ata2.01: SATA link up 3.0 Gbps (SStatus 123 SControl 300)\nMar 14 23:00:04 eccles kernel: ata2.01: configured for UDMA/133\nMar 14 23:00:04 eccles kernel: ata2.01: device reported invalid CHS sector 0\nMar 14 23:00:04 eccles kernel: ata2: EH complete\n\nI've tried compiling the kernel with different options. Enabling \nCONFIG_PATA_MPIIX or CONFIG_PATA_SCH (even though they weren't needed before). They made it more difficult to trigger the bug which makes me think maybe it's some sort of race condition.\n\nIntel(R) Core(TM)2 Quad CPU    Q9550  @ 2.83GHz\n\nlspci:\n\n00:00.0 Host bridge: Intel Corporation 4 Series Chipset DRAM Controller (rev 03)\n00:01.0 PCI bridge: Intel Corporation 4 Series Chipset PCI Express Root Port (rev 03)\n00:1a.0 USB Controller: Intel Corporation 82801JI (ICH10 Family) USB UHCI Controller #4\n00:1a.1 USB Controller: Intel Corporation 82801JI (ICH10 Family) USB UHCI Controller #5\n00:1a.2 USB Controller: Intel Corporation 82801JI (ICH10 Family) USB UHCI Controller #6\n00:1a.7 USB Controller: Intel Corporation 82801JI (ICH10 Family) USB2 EHCI Controller #2\n00:1c.0 PCI bridge: Intel Corporation 82801JI (ICH10 Family) PCI Express Root Port 1\n00:1c.5 PCI bridge: Intel Corporation 82801JI (ICH10 Family) PCI Express Root Port 6\n00:1d.0 USB Controller: Intel Corporation 82801JI (ICH10 Family) USB UHCI Controller #1\n00:1d.1 USB Controller: Intel Corporation 82801JI (ICH10 Family) USB UHCI Controller #2\n00:1d.2 USB Controller: Intel Corporation 82801JI (ICH10 Family) USB UHCI Controller #3\n00:1d.7 USB Controller: Intel Corporation 82801JI (ICH10 Family) USB2 EHCI Controller #1\n00:1e.0 PCI bridge: Intel Corporation 82801 PCI Bridge (rev 90)\n00:1f.0 ISA bridge: Intel Corporation 82801JIR (ICH10R) LPC Interface Controller\n00:1f.2 IDE interface: Intel Corporation 82801JI (ICH10 Family) 4 port SATA IDE Controller #1\n00:1f.3 SMBus: Intel Corporation 82801JI (ICH10 Family) SMBus Controller\n00:1f.5 IDE interface: Intel Corporation 82801JI (ICH10 Family) 2 port SATA IDE Controller #2\n01:00.0 VGA compatible controller: ATI Technologies Inc RV770 [Radeon HD 4870]\n01:00.1 Audio device: ATI Technologies Inc HD48x0 audio\n03:00.0 Ethernet controller: Realtek Semiconductor Co., Ltd. RTL8111/8168B PCI Express Gigabit Ethernet controller (rev 02)\n04:00.0 Multimedia video controller: Conexant Systems, Inc. CX23880/1/2/3 PCI Video and Audio Decoder (rev 05)\n04:00.2 Multimedia controller: Conexant Systems, Inc. CX23880/1/2/3 PCI Video and Audio Decoder [MPEG Port] (rev 05)\n04:00.4 Multimedia controller: Conexant Systems, Inc. CX23880/1/2/3 PCI Video and Audio Decoder [IR Port] (rev 05)\n04:05.0 Network controller: RaLink RT2561/RT61 802.11g PCI", "patch": ["diff --git a/drivers/ata/libata-sff.c b/drivers/ata/libata-sff.c\r\nindex 02441fd..5de4cf3 100644\r\n--- a/drivers/ata/libata-sff.c\r\n+++ b/drivers/ata/libata-sff.c\r\n@@ -1667,6 +1667,7 @@ unsigned int ata_sff_host_intr(struct ata_port *ap,\r\n {\r\n \tstruct ata_eh_info *ehi = &ap->link.eh_info;\r\n \tu8 status, host_stat = 0;\r\n+\tbool bmdma_stopped = false;\r\n \r\n \tVPRINTK(\"ata%u: protocol %d task_state %d\\n\",\r\n \t\tap->print_id, qc->tf.protocol, ap->hsm_task_state);\r\n@@ -1699,6 +1700,7 @@ unsigned int ata_sff_host_intr(struct ata_port *ap,\r\n \r\n \t\t\t/* before we do anything else, clear DMA-Start bit */\r\n \t\t\tap->ops->bmdma_stop(qc);\r\n+\t\t\tbmdma_stopped = true;\r\n \r\n \t\t\tif (unlikely(host_stat & ATA_DMA_ERR)) {\r\n \t\t\t\t/* error when transfering data to/from memory */\r\n@@ -1716,8 +1718,14 @@ unsigned int ata_sff_host_intr(struct ata_port *ap,\r\n \r\n \t/* check main status, clearing INTRQ if needed */\r\n \tstatus = ata_sff_irq_status(ap);\r\n-\tif (status & ATA_BUSY)\r\n-\t\tgoto idle_irq;\r\n+\tif (status & ATA_BUSY) {\r\n+\t\tif (bmdma_stopped) {\r\n+\t\t\t/* BMDMA engine is already stopped, we're screwed */\r\n+\t\t\tqc->err_mask |= AC_ERR_HSM;\r\n+\t\t\tap->hsm_task_state = HSM_ST_ERR;\r\n+\t\t} else\r\n+\t\t\tgoto idle_irq;\r\n+\t}\r\n \r\n \t/* ack bmdma irq events */\r\n \tap->ops->sff_irq_clear(ap);\r\n@@ -1762,13 +1770,15 @@ EXPORT_SYMBOL_GPL(ata_sff_host_intr);\r\n irqreturn_t ata_sff_interrupt(int irq, void *dev_instance)\r\n {\r\n \tstruct ata_host *host = dev_instance;\r\n+\tbool retried = false;\r\n \tunsigned int i;\r\n-\tunsigned int handled = 0, polling = 0;\r\n+\tunsigned int handled, idle, polling;\r\n \tunsigned long flags;\r\n \r\n \t/* TODO: make _irqsave conditional on x86 PCI IDE legacy mode */\r\n \tspin_lock_irqsave(&host->lock, flags);\r\n-\r\n+retry:\r\n+\thandled = idle = polling = 0;\r\n \tfor (i = 0; i < host->n_ports; i++) {\r\n \t\tstruct ata_port *ap = host->ports[i];\r\n \t\tstruct ata_queued_cmd *qc;\r\n@@ -1782,7 +1792,8 @@ irqreturn_t ata_sff_interrupt(int irq, void *dev_instance)\r\n \t\t\t\thandled |= ata_sff_host_intr(ap, qc);\r\n \t\t\telse\r\n \t\t\t\tpolling |= 1 << i;\r\n-\t\t}\r\n+\t\t} else\r\n+\t\t\tidle |= 1 << i;\r\n \t}\r\n \r\n \t/*\r\n@@ -1790,7 +1801,9 @@ irqreturn_t ata_sff_interrupt(int irq, void *dev_instance)\r\n \t * asserting IRQ line, nobody cared will ensue.  Check IRQ\r\n \t * pending status if available and clear spurious IRQ.\r\n \t */\r\n-\tif (!handled) {\r\n+\tif (!handled && !retried) {\r\n+\t\tbool retry = false;\r\n+\r\n \t\tfor (i = 0; i < host->n_ports; i++) {\r\n \t\t\tstruct ata_port *ap = host->ports[i];\r\n \r\n@@ -1805,8 +1818,22 @@ irqreturn_t ata_sff_interrupt(int irq, void *dev_instance)\r\n \t\t\t\tata_port_printk(ap, KERN_INFO,\r\n \t\t\t\t\t\t\"clearing spurious IRQ\\n\");\r\n \r\n-\t\t\tap->ops->sff_check_status(ap);\r\n-\t\t\tap->ops->sff_irq_clear(ap);\r\n+\t\t\tif (idle & (1 << i)) {\r\n+\t\t\t\tap->ops->sff_check_status(ap);\r\n+\t\t\t\tap->ops->sff_irq_clear(ap);\r\n+\t\t\t} else {\r\n+\t\t\t\t/* clear INTRQ and check if BUSY cleared */\r\n+\t\t\t\tif (!(ap->ops->sff_check_status(ap) & ATA_BUSY))\r\n+\t\t\t\t\tretry |= true;\r\n+\t\t\t\t/*\r\n+\t\t\t\t * With command in flight, we can't do\r\n+\t\t\t\t * sff_irq_clear() w/o racing with completion.\r\n+\t\t\t\t */\r\n+\t\t\t}\r\n+\t\t}\r\n+\t\tif (retry) {\r\n+\t\t\tretried = true;\r\n+\t\t\tgoto retry;\r\n \t\t}\r\n \t}\r\n\r\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "IO/Storage", "Classification": "Unclassified", "Component": "Serial ATA", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Jeff Garzik", "URL": "", "Keywords": "", "Duplicates (3)": "15549 15556 15716", "Depends on": "", "Blocks": "15310", "Reported": "2010-03-14 23:26 UTC by Andrew Benton", "Modified": "2010-04-08 20:08 UTC", "CC List": "5 users", "See Also": "", "Kernel Version": "2.6.34-rc1", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/ata/libata-sff.c"], "methods": ["ata_sff_host_intr", "ata_sff_interrupt"]}
{"id": "15419", "title": "ipw2200: requesting scan causes connection drops", "description": "Created attachment 25292 [details]\nCommented dmesg (ipw2200 debug=255)\n\nOverview:\nSince long time (at least 2.6.24), with some networks the connection gets systematically dropped when a scan is requested (i.e. by NetworkManager).\n\nSteps to reproduce:\nI could always reproduce this issue by stopping NetworkManager and manually configuring a wireless connection to an affected network in /etc/network/interfaces (ifupdown uses wpa_supplicant, like NM does): when the connection is active, a iwlist ethx scan command always causes ap disassociation and subsequent connection drop. If no scans are requested the connection is very reliable and fast and lasts hours (no disassociations happen).\n\nActual results:\nThe card gets disassociated from the ap and the connection drops.\n\nExpected results:\nThe connection shouldn't drop when scanning is requested.\n\nBuild date and platform:\nDebian Sid i386 current (kernel 2.6.32-9) on an Acer TravelMate 435LMi + Intel ProWireless 2915 (ipw2200).\n\nAdditional info:\n- wireless device lspci -vvv:\n02:02.0 Network controller: Intel Corporation PRO/Wireless 2915ABG [Calexico2] Network Connection (rev 05)\n        Subsystem: Intel Corporation Device 1001\n        Control: I/O- Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr- Stepping- SERR+ FastB2B- DisINTx-\n        Status: Cap+ 66MHz- UDF- FastB2B+ ParErr- DEVSEL=medium >TAbort- <TAbort- <MAbort- >SERR- <PERR- INTx-\n        Latency: 32 (750ns min, 6000ns max), Cache Line Size: 32 bytes\n        Interrupt: pin A routed to IRQ 18\n        Region 0: Memory at d0200000 (32-bit, non-prefetchable) [size=4K]\n        Capabilities: [dc] Power Management version 2\n                Flags: PMEClk- DSI+ D1- D2- AuxCurrent=0mA PME(D0+,D1-,D2-,D3hot+,D3cold+)\n                Status: D0 NoSoftRst- PME-Enable- DSel=0 DScale=1 PME-\n        Kernel driver in use: ipw2200\n\n- note:\nThe logfile I'm attaching refers to a connection to a Linksys WAG325N: the ap was 3mt far from the laptop, no matter whether the 802.11n features were enabled or not, whether the ESSID was broadcasted or not and regardless of used encryption (RSN or WPA).\nThe ipw2200 module was loaded with no additional parameters.\n\nThanks\n\nMaurizio", "patch": ["diff --git a/drivers/net/wireless/ipw2x00/ipw2200.c b/drivers/net/wireless/ipw2x00/ipw2200.c\nindex 5c7aa1b..d449833 100644\n--- a/drivers/net/wireless/ipw2x00/ipw2200.c\n+++ b/drivers/net/wireless/ipw2x00/ipw2200.c\n@@ -2348,16 +2348,25 @@ static void ipw_bg_adapter_restart(struct work_struct *work)\n \tmutex_unlock(&priv->mutex);\n }\n \n-#define IPW_SCAN_CHECK_WATCHDOG (5 * HZ)\n+static void ipw_abort_scan(struct ipw_priv *priv);\n+\n+#define IPW_SCAN_CHECK_WATCHDOG\t(5 * HZ)\n \n static void ipw_scan_check(void *data)\n {\n \tstruct ipw_priv *priv = data;\n-\tif (priv->status & (STATUS_SCANNING | STATUS_SCAN_ABORTING)) {\n+\n+\tif (priv->status & STATUS_SCAN_ABORTING) {\n \t\tIPW_DEBUG_SCAN(\"Scan completion watchdog resetting \"\n \t\t\t       \"adapter after (%dms).\\n\",\n \t\t\t       jiffies_to_msecs(IPW_SCAN_CHECK_WATCHDOG));\n \t\tqueue_work(priv->workqueue, &priv->adapter_restart);\n+\t} else if (priv->status & STATUS_SCANNING) {\n+\t\tIPW_DEBUG_SCAN(\"Scan completion watchdog aborting scan \"\n+\t\t\t       \"after (%dms).\\n\",\n+\t\t\t       jiffies_to_msecs(IPW_SCAN_CHECK_WATCHDOG));\n+\t\tipw_abort_scan(priv);\n+\t\tqueue_delayed_work(priv->workqueue, &priv->scan_check, HZ);\n \t}\n }\n \n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "network-wireless", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "drivers_network-wireless@kernel-bugs.osdl.org", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2010-03-01 17:26 UTC by Maurizio Avogadro", "Modified": "2010-08-18 19:21 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "2.6.32", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/net/wireless/ipw2x00/ipw2200.c"], "methods": ["ipw_scan_check"]}
{"id": "15407", "title": "All Lenovo i5/i7 notebooks do not resume properly after suspend - system resumes but will hang if resumed a second time", "description": "After unloading drivers that cause problems with suspend (xhci, bluetooth, etc) the system can suspend OK.  On resume however this message is displayed in dmesg:\n\n[18446744064.763411] irq 9: nobody cared (try booting with the \"irqpoll\" option)\n[18446744064.763419] Pid: 0, comm: swapper Tainted: G        W  2.6.32-14-generic #20-Ubuntu\n[18446744064.763423] Call Trace:\n[18446744064.763426]  <IRQ>  [<ffffffff810c4c1b>] __report_bad_irq+0x2b/0xa0\n[18446744064.763439]  [<ffffffff810c4e1c>] note_interrupt+0x18c/0x1d0\n[18446744064.763446]  [<ffffffff81019f09>] ? read_tsc+0x9/0x20\n[18446744064.763452]  [<ffffffff810c551d>] handle_fasteoi_irq+0xdd/0x100\n[18446744064.763457]  [<ffffffff81015d52>] handle_irq+0x22/0x30\n[18446744064.763465]  [<ffffffff81563bdc>] do_IRQ+0x6c/0xf0\n[18446744064.763472]  [<ffffffff81013b53>] ret_from_intr+0x0/0x11\n[18446744064.763475]  <EOI>  [<ffffffff813086c0>] ? acpi_idle_enter_bm+0x283/0x2b7\n[18446744064.763486]  [<ffffffff813086b9>] ? acpi_idle_enter_bm+0x27c/0x2b7\n[18446744064.763492]  [<ffffffff8144c567>] ? cpuidle_idle_call+0xa7/0x140\n[18446744064.763497]  [<ffffffff81011ea3>] ? cpu_idle+0xb3/0x110\n[18446744064.763504]  [<ffffffff81558aad>] ? start_secondary+0xa8/0xaa\n[18446744064.763508] handlers:\n[18446744064.763510] [<ffffffff812de974>] (acpi_irq+0x0/0x31)\n[18446744064.763517] Disabling IRQ #9\n\n\nIf the system is suspended a second time, it will not resume and instead shows a BIOS screen and must be hard booted.\n\nNote this issue likely affects the following Lenovo models:\n\nT410\nT410s\nT510\nT510i\nW510\nW510i\nW710", "patch": ["diff --git a/drivers/acpi/sleep.c b/drivers/acpi/sleep.c\nindex f74834a..b770fc8 100644\n--- a/drivers/acpi/sleep.c\n+++ b/drivers/acpi/sleep.c\n@@ -450,6 +450,38 @@ static struct dmi_system_id __initdata acpisleep_dmi_table[] = {\n \t\t},\n \t},\n \t{\n+\t.callback = init_set_sci_en_on_resume,\n+\t.ident = \"Lenovo ThinkPad T410\",\n+\t.matches = {\n+\t\tDMI_MATCH(DMI_SYS_VENDOR, \"LENOVO\"),\n+\t\tDMI_MATCH(DMI_PRODUCT_VERSION, \"ThinkPad T410\"),\n+\t\t},\n+\t},\n+\t{\n+\t.callback = init_set_sci_en_on_resume,\n+\t.ident = \"Lenovo ThinkPad T510\",\n+\t.matches = {\n+\t\tDMI_MATCH(DMI_SYS_VENDOR, \"LENOVO\"),\n+\t\tDMI_MATCH(DMI_PRODUCT_VERSION, \"ThinkPad T510\"),\n+\t\t},\n+\t},\n+\t{\n+\t.callback = init_set_sci_en_on_resume,\n+\t.ident = \"Lenovo ThinkPad W510\",\n+\t.matches = {\n+\t\tDMI_MATCH(DMI_SYS_VENDOR, \"LENOVO\"),\n+\t\tDMI_MATCH(DMI_PRODUCT_VERSION, \"ThinkPad W510\"),\n+\t\t},\n+\t},\n+\t{\n+\t.callback = init_set_sci_en_on_resume,\n+\t.ident = \"Lenovo ThinkPad X201\",\n+\t.matches = {\n+\t\tDMI_MATCH(DMI_SYS_VENDOR, \"LENOVO\"),\n+\t\tDMI_MATCH(DMI_PRODUCT_VERSION, \"ThinkPad X201\"),\n+\t\t},\n+\t},\n+\t{\n \t.callback = init_old_suspend_ordering,\n \t.ident = \"Panasonic CF51-2L\",\n \t.matches = {\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "Power-Sleep-Wake", "Hardware": "All Linux", "Importance": "P1 high", "Assignee": "acpi_power-sleep-wake", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2010-02-27 00:31 UTC by Bryn Hughes", "Modified": "2015-03-17 02:27 UTC", "CC List": "16 users", "See Also": "", "Kernel Version": "2.6.32", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/acpi/sleep.c"], "methods": ["acpisleep_dmi_table"]}
{"id": "15366", "title": "sysfs oops when reading current_clocksource if GENERIC_TIME=n", "description": "curr_clocksource is uninitialized if GENERIC_TIME=n\n\n# cat /sys/devices/system/clocksource/clocksource0/current_clocksource\n[  187.940000] Unable to handle kernel NULL pointer dereference at virtual address 00000000\n[  187.960000] pgd = df160000\n[  187.960000] [00000000] *pgd=bf11a031, *pte=00000000, *ppte=00000000\n[  187.970000] Internal error: Oops: 17 [#1] PREEMPT\n[  187.970000] last sysfs file: /sys/devices/system/clocksource/clocksource0/current_clocksource\n[  187.970000] Modules linked in:\n[  187.970000] CPU: 0    Not tainted  (2.6.32.8-iop32x #13)\n[  187.970000] PC is at sysfs_show_current_clocksources+0x2c/0x58\n[  187.970000] LR is at sysfs_show_current_clocksources+0x18/0x58\n[  187.970000] pc : [<c006b530>]    lr : [<c006b51c>]    psr: 60000013\n[  187.970000] sp : df0b9f10  ip : 00000000  fp : beff0cb0\n[  187.970000] r10: c043e3cc  r9 : df0eabd8  r8 : df0b9f80\n[  187.970000] r7 : 00000fff  r6 : df8be960  r5 : c042e0f8  r4 : df10b000\n[  187.970000] r3 : c0472980  r2 : c03b02d8  r1 : 00001000  r0 : df10b000\n[  187.970000] Flags: nZCv  IRQs on  FIQs on  Mode SVC_32  ISA ARM  Segment user\n[  187.970000] Control: 0000397f  Table: bf160000  DAC: 00000015\n[  187.970000] Process cat (pid: 514, stack limit = 0xdf0b8270)\n[  187.970000] Stack: (0xdf0b9f10 to 0xdf0ba000)\n[  187.970000] 9f00:                                     df0eabd8 c042e154 df0eabc0 c01e6f90\n[  187.970000] 9f20: c042e154 c0115da8 00100077 df0c87e8 00000021 00001000 00000000 df10fb80\n[  187.970000] 9f40: beff0cb0 df0b9f80 00001000 00001000 df0b8000 00000000 00000001 c00c6fc0\n[  187.970000] 9f60: c00c45cc c003eff0 00000000 00000000 df10fb80 00001000 beff0cb0 c00c7144\n[  187.970000] 9f80: 00000000 00000000 beff1f5f 00000000 00001000 beff0cb0 001da4e0 00000003\n[  187.970000] 9fa0: c002a128 c0029f60 00001000 beff0cb0 00000003 beff0cb0 00001000 001d9b30\n[  187.970000] 9fc0: 00001000 beff0cb0 001da4e0 00000003 00000001 beff0cb0 00000000 00000001\n[  187.970000] 9fe0: 00000003 beff0c90 0000c034 00008d6c 60000010 00000003 ffffffff ffffffff\n[  187.970000] [<c006b530>] (sysfs_show_current_clocksources+0x2c/0x58) from [<c01e6f90>] (sysdev_show+0x20/0x28)\n[  187.970000] [<c01e6f90>] (sysdev_show+0x20/0x28) from [<c0115da8>] (sysfs_read_file+0x9c/0x130)\n[  187.970000] [<c0115da8>] (sysfs_read_file+0x9c/0x130) from [<c00c6fc0>] (vfs_read+0xb0/0x164)\n[  187.970000] [<c00c6fc0>] (vfs_read+0xb0/0x164) from [<c00c7144>] (sys_read+0x40/0x70)\n[  187.970000] [<c00c7144>] (sys_read+0x40/0x70) from [<c0029f60>] (ret_fast_syscall+0x0/0x38)\n[  187.970000] Code: e3a01a01 e59f202c e593c000 e1a00004 (e59c3000)\n[  188.170000] ---[ end trace 206df0d3d88ba60c ]---", "patch": ["diff --git a/kernel/time/clocksource.c b/kernel/time/clocksource.c\nindex e85c234..c436ee5 100644\n--- a/kernel/time/clocksource.c\n+++ b/kernel/time/clocksource.c\n@@ -568,6 +568,10 @@ static inline void clocksource_select(void) { }\n  */\n static int __init clocksource_done_booting(void)\n {\n+\tmutex_lock(&clocksource_mutex);\n+\tcurr_clocksource = clocksource_default_clock();\n+\tmutex_unlock(&clocksource_mutex);\n+\n \tfinished_booting = 1;\n \n \t/*\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Timers", "Classification": "Unclassified", "Component": "Other", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "john stultz", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2010-02-21 20:19 UTC by Aaro Koskinen", "Modified": "2010-04-05 22:07 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "2.6.32", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["kernel/time/clocksource.c"], "methods": ["clocksource_done_booting"]}
{"id": "15303", "title": "WLAN cannot be activated if booted with activated RF kill switch on Sony notebook (iwl3945)", "": "Show dependency tree", "description": "Keywords:\nWLAN, RF kill switch, iwl3945, sony-laptop\n\nKernel version:\nLinux version 2.6.32-13-generic (buildd@vernadsky) (gcc version 4.4.3 (Ubuntu 4.4.3-2ubuntu1) ) #18-Ubuntu SMP Wed Feb 10 21:24:20 UTC 2010\n(I was also able to confirm the problem with Ubuntu Karmic and Fedora 12)\n\nDescription:\nIf the RF kill switch is activated during booting my Sony Notebook (VGN-TX3HP) WLAN cannot be activated later. If WLAN is activated during boot it can be deactivated and reactivated without problems.\n\nI was able to narrow down the problem: If I unload the sony-laptop module before disabling the kill switch, WLAN becomes active without problems. Then I can load sony-laptop without it is causing problems.\n\nThis problem did not occur with Kernel versions <=2.6.28 (at least).\n\nSteps to reproduce the problem:\n- get a Sony Vaio laptop with iwl3945 hardware (my is a TX3HP)\n- enable RF kill switch (disable WLAN)\n- boot Linux\n- disable RF kill switch (enable WLAN)\n- WLAN does not become available  \n\nSteps to reproduce my workaround:\n- get a Sony Vaio laptop with iwl3945 hardware (my is a TX3HP)\n- enable RF kill switch (disable WLAN)\n- boot Linux\n- unload sony-laptop module\n- disable RF kill switch (enable WLAN)\n- WLAN becomes available  \n- load sony-laptop module", "patch": ["diff --git a/drivers/platform/x86/sony-laptop.c b/drivers/platform/x86/sony-laptop.c\nindex 1387c5f..0784b15 100644\n--- a/drivers/platform/x86/sony-laptop.c\n+++ b/drivers/platform/x86/sony-laptop.c\n@@ -1570,8 +1570,8 @@ static struct sonypi_event sonypi_blueev[] = {\n \n /* The set of possible wireless events */\n static struct sonypi_event sonypi_wlessev[] = {\n-\t{ 0x59, SONYPI_EVENT_WIRELESS_ON },\n-\t{ 0x5a, SONYPI_EVENT_WIRELESS_OFF },\n+\t{ 0x59, 0 },\n+\t{ 0x5a, 0 },\n \t{ 0, 0 }\n };\n \n@@ -2710,7 +2710,14 @@ static irqreturn_t sony_pic_irq(int irq, void *dev_id)\n \t\t\tif (ev == dev->event_types[i].events[j].data) {\n \t\t\t\tdevice_event =\n \t\t\t\t\tdev->event_types[i].events[j].event;\n-\t\t\t\tgoto found;\n+\t\t\t\tif (device_event)\n+\t\t\t\t\tgoto found;\n+\t\t\t\telse {\n+\t\t\t\t\tdprintk(\"ignoring event \"\n+\t\t\t\t\t\t\t\"[0x%.2x] [0x%.2x]\\n\",\n+\t\t\t\t\t\t\tev, data_mask);\n+\t\t\t\t\tgoto ignored;\n+\t\t\t\t}\n \t\t\t}\n \t\t}\n \t}\n@@ -2729,7 +2736,7 @@ found:\n \tsony_laptop_report_input_event(device_event);\n \tacpi_bus_generate_proc_event(dev->acpi_dev, 1, device_event);\n \tsonypi_compat_report_event(device_event);\n-\n+ignored:\n \treturn IRQ_HANDLED;\n }\n \n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Platform", "Hardware": "i386 Linux", "Importance": "P1 normal", "Assignee": "Mattia Dongili", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "56331", "Reported": "2010-02-14 22:59 UTC by Thomas Klose", "Modified": "2013-04-09 06:23 UTC", "CC List": "6 users", "See Also": "", "Kernel Version": "2.6.32", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/platform/x86/sony-laptop.c"], "methods": ["sony_pic_irq", "sonypi_blueev"]}
{"id": "15287", "title": "RadeonKMS segfaults kdm on mobility radeon x700 pcie", "": "Show dependency tree", "description": "Using the KMS option of the radeon-driver makes the kernel segfault and reboot when starting an kde session. This happens on daves radeon-testing tree using latest mesa-git and libdrm-git. Also happens on latest linus tree. The same combination works great when using the non-kms codepath.\n\nHardware is an mobility radeon x700 pcie.\n\nlspci -vn:\n02:00.0 0300: 1002:5653 (prog-if 00 [VGA controller])\n        Subsystem: 1734:1093\n        Flags: bus master, fast devsel, latency 0, IRQ 24\n        Memory at b0000000 (64-bit, prefetchable) [size=128M]\n        Memory at feaf0000 (64-bit, non-prefetchable) [size=64K]\n        I/O ports at b000 [size=256]\n        Expansion ROM at feac0000 [disabled] [size=128K]\n        Capabilities: [50] Power Management version 2\n        Capabilities: [58] Express Endpoint, MSI 00\n        Capabilities: [80] MSI: Enable- Count=1/1 Maskable- 64bit+\n        Capabilities: [100] Advanced Error Reporting", "patch": ["diff --git a/drivers/pci/quirks.c b/drivers/pci/quirks.c\nindex 81d19d5..016ae1c 100644\n--- a/drivers/pci/quirks.c\n+++ b/drivers/pci/quirks.c\n@@ -2108,6 +2108,7 @@ static void __devinit quirk_disable_msi(struct pci_dev *dev)\n \t}\n }\n DECLARE_PCI_FIXUP_FINAL(PCI_VENDOR_ID_AMD, PCI_DEVICE_ID_AMD_8131_BRIDGE, quirk_disable_msi);\n+DECLARE_PCI_FIXUP_FINAL(PCI_VENDOR_ID_VIA, 0xa238, quirk_disable_msi);\n \n /* Go through the list of Hypertransport capabilities and\n  * return 1 if a HT MSI capability is found and enabled */\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "PCI", "Hardware": "All Linux", "Importance": "P1 high", "Assignee": "drivers_pci@kernel-bugs.osdl.org", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "14885", "Reported": "2010-02-12 17:58 UTC by Jan Kreuzer", "Modified": "2010-03-27 23:34 UTC", "CC List": "5 users", "See Also": "", "Kernel Version": "2.6.34-rc1", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/pci/quirks.c"], "methods": ["quirk_disable_msi"]}
{"id": "15118", "title": "\"ThinkPad\" key on T20 only works after suspend cycle", "description": "Reported-by: Florian Zumbiehl <florz@florz.de>\n\nThe vendor (\"ThinkPad\") key on a T20 with latest T22 BIOS only works after a S3 suspend/resume cycle.  Tested with direct (no userspace script) S3 sleep.\n\nThe T20 is running a patched kernel to fix the EC DoS problem.\n\nThe key is operating in NVRAM polling mode.\n\nIt breaks again when thinkpad-acpi is unloaded and then reloaded.\n\nDriver hotkey state dump:\n| /sys/bus/platform/devices/thinkpad_acpi/hotkey_all_mask:0x0088080c\n| /sys/bus/platform/devices/thinkpad_acpi/hotkey_bios_enabled:0\n| /sys/bus/platform/devices/thinkpad_acpi/hotkey_bios_mask:0x0000080c\n| /sys/bus/platform/devices/thinkpad_acpi/hotkey_enable:1\n| /sys/bus/platform/devices/thinkpad_acpi/hotkey_mask:0x0088080c\n| /sys/bus/platform/devices/thinkpad_acpi/hotkey_poll_freq:10\n| /sys/bus/platform/devices/thinkpad_acpi/hotkey_recommended_mask:0x0088080c\n| /sys/bus/platform/devices/thinkpad_acpi/hotkey_report_mode:1\n| /sys/bus/platform/devices/thinkpad_acpi/hotkey_source_mask:0x00880000", "patch": ["commit c3088839a54ff2f15fca7b2134dc5ece8ba9b5f5\nAuthor: Henrique de Moraes Holschuh <hmh@hmh.eng.br>\nDate:   Tue Jan 26 23:08:58 2010 -0200\n\n    thinkpad-acpi: fix poll thread auto-start\n    \n    The driver was not starting the NVRAM polling thread if the input\n    device was bound immediately after registration.\n    \n    This fixes:\n    http://bugzilla.kernel.org/show_bug.cgi?id=15118\n    \n    Reported-by: Florian Zumbiehl <florz@florz.de>\n    Signed-off-by: Henrique de Moraes Holschuh <hmh@hmh.eng.br>\n\ndiff --git a/drivers/platform/x86/thinkpad_acpi.c b/drivers/platform/x86/thinkpad_acpi.c\nindex 675ef96..9582d2e 100644\n--- a/drivers/platform/x86/thinkpad_acpi.c\n+++ b/drivers/platform/x86/thinkpad_acpi.c\n@@ -2610,16 +2610,11 @@ static int hotkey_inputdev_open(struct input_dev *dev)\n {\n \tswitch (tpacpi_lifecycle) {\n \tcase TPACPI_LIFE_INIT:\n-\t\t/*\n-\t\t * hotkey_init will call hotkey_poll_setup_safe\n-\t\t * at the appropriate moment\n-\t\t */\n-\t\treturn 0;\n-\tcase TPACPI_LIFE_EXITING:\n-\t\treturn -EBUSY;\n \tcase TPACPI_LIFE_RUNNING:\n \t\thotkey_poll_setup_safe(false);\n \t\treturn 0;\n+\tcase TPACPI_LIFE_EXITING:\n+\t\treturn -EBUSY;\n \t}\n \n \t/* Should only happen if tpacpi_lifecycle is corrupt */\n@@ -2630,7 +2625,7 @@ static int hotkey_inputdev_open(struct input_dev *dev)\n static void hotkey_inputdev_close(struct input_dev *dev)\n {\n \t/* disable hotkey polling when possible */\n-\tif (tpacpi_lifecycle == TPACPI_LIFE_RUNNING &&\n+\tif (tpacpi_lifecycle != TPACPI_LIFE_EXITING &&\n \t    !(hotkey_source_mask & hotkey_driver_mask))\n \t\thotkey_poll_setup_safe(false);\n }\n@@ -9041,6 +9036,9 @@ static int __init thinkpad_acpi_module_init(void)\n \t\t\treturn ret;\n \t\t}\n \t}\n+\n+\ttpacpi_lifecycle = TPACPI_LIFE_RUNNING;\n+\n \tret = input_register_device(tpacpi_inputdev);\n \tif (ret < 0) {\n \t\tprintk(TPACPI_ERR \"unable to register input device\\n\");\n@@ -9050,7 +9048,6 @@ static int __init thinkpad_acpi_module_init(void)\n \t\ttp_features.input_device_registered = 1;\n \t}\n \n-\ttpacpi_lifecycle = TPACPI_LIFE_RUNNING;\n \treturn 0;\n }\n \n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Platform", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Henrique de Moraes Holschuh", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2010-01-24 11:14 UTC by Henrique de Moraes Holschuh", "Modified": "2010-10-08 18:23 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "2.6.32", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/platform/x86/thinkpad_acpi.c"], "methods": ["hotkey_inputdev_open", "hotkey_inputdev_close", "thinkpad_acpi_module_init"]}
{"id": "14957", "title": "Blank screen with KMS enabled", "": "Show dependency tree", "description": "When the i915 module is loaded with modeset=1, the screen is blanked and stays that way, with the following in dmesg:\n\n[drm] DAC-6: set mode 640x480 0\n[drm] TV-14: set mode NTSC 480i 0\n------------[ cut here ]------------\nWARNING: at drivers/gpu/drm/drm_crtc_helper.c:1032 drm_helper_initial_config+0x36/0x52 [drm_kms_helper]()\nHardware name: SX20S\nNo connectors reported connected with modes\nModules linked in: snd_seq_dummy snd_seq_oss snd_seq_midi_event snd_seq snd_seq_device snd_intel8x0(+) firewire_ohci snd_intel8x0m(+) pcmcia snd_pcm_oss snd_ac97_codec firewire_core ac97_bus snd_mixer_oss i915(+) joydev crc_itu_t yenta_socket snd_pcm drm_kms_helper snd_timer drm rsrc_nonstatic b44 ipw2200 sdhci_pci ohci1394 snd cfbcopyarea soundcore psmouse video ssb sdhci pcmcia_core i2c_i801 libipw ieee1394 iTCO_wdt serio_raw snd_page_alloc pcspkr lib80211 iTCO_vendor_support output cfbimgblt cfbfillrect led_class mii aes_i586 aes_generic xts gf128mul\nPid: 1226, comm: modprobe Not tainted 2.6.32 #1\nCall Trace:\n [<c0126274>] warn_slowpath_common+0x65/0x7c\n [<f9b5dd62>] ? drm_helper_initial_config+0x36/0x52 [drm_kms_helper]\n [<c01262bf>] warn_slowpath_fmt+0x24/0x27\n [<f9b5dd62>] drm_helper_initial_config+0x36/0x52 [drm_kms_helper]\n [<fa31c6e6>] i915_driver_load+0xddb/0xe80 [i915]\n [<f96a8b55>] drm_get_dev+0x2ad/0x38a [drm]\n [<fa33cd90>] i915_pci_probe+0xd/0x9f [i915]\n [<c026ded7>] local_pci_probe+0xe/0x10\n [<c026e823>] pci_device_probe+0x43/0x66\n [<c02d197f>] driver_probe_device+0x8a/0x109\n [<c02d1a41>] __driver_attach+0x43/0x5f\n [<c02d11c3>] bus_for_each_dev+0x3d/0x67\n [<c02d1847>] driver_attach+0x14/0x16\n [<c02d19fe>] ? __driver_attach+0x0/0x5f\n [<c02d1568>] bus_add_driver+0x8f/0x1bf\n [<c025edc9>] ? kset_find_obj+0x1b/0x43\n [<c02d1c7f>] driver_register+0x79/0xe0\n [<c026e9bb>] __pci_register_driver+0x31/0x8e\n [<f96a5259>] drm_init+0x5d/0xb5 [drm]\n [<fa354000>] ? i915_init+0x0/0x4d [i915]\n [<fa35404b>] i915_init+0x4b/0x4d [i915]\n [<c0101133>] do_one_initcall+0x4b/0x130\n [<c0149f79>] sys_init_module+0xa7/0x1de\n [<c010296b>] sysenter_do_call+0x12/0x22\n---[ end trace 2d06d367c79ff13a ]---\n[drm] Initialized i915 1.6.0 20080730 for 0000:00:02.0 on minor 0\n\nThings worked fine under 2.6.31. (I can bisect if necessary.)\n\nDisabling KMS by passing modeset=0 as a module parameter works around this issue.\n\nI am using a Samsung X20 laptop with an Intel Corporation Mobile 915GM/GMS/910GML Express Graphics Controller (rev 03).", "patch": ["From e4d034db2abdcafc1f137d959fca137ce67bee47 Mon Sep 17 00:00:00 2001\nFrom: Zhao Yakui <yakui.zhao@intel.com>\nDate: Wed, 6 Jan 2010 21:14:35 +0800\nSubject: [PATCH v2] drm/i915: Add HP nx9020/Samsung SX20S to ACPI LID quirk list\n\nThe HP comaq nx9020/Samsung SX20S laptop always report that the LID status is\nclosed and we can't use it reliabily for LVDS detection. So add the two boxes\ninto the quirk list.\n\nhttp://bugzilla.kernel.org/show_bug.cgi?id=14957\nhttp://bugzilla.kernel.org/show_bug.cgi?id=14554\n\nSigned-off-by: Zhao Yakui <yakui.zhao@intel.com>\nTested-by: Philipp Kohlbecher<xt28@gmx.de>\n---\nV1->V2: Fix a typo error. Thank Philipp for pointing that incorrect\nDMI string is used for Samsung SX20S.\n\n drivers/gpu/drm/i915/intel_lvds.c |   14 ++++++++++++++\n 1 files changed, 14 insertions(+), 0 deletions(-)\n\ndiff --git a/drivers/gpu/drm/i915/intel_lvds.c b/drivers/gpu/drm/i915/intel_lvds.c\nindex f4b4aa2..160283a 100644\n--- a/drivers/gpu/drm/i915/intel_lvds.c\n+++ b/drivers/gpu/drm/i915/intel_lvds.c\n@@ -602,6 +602,20 @@ static void intel_lvds_mode_set(struct drm_encoder *encoder,\n /* Some lid devices report incorrect lid status, assume they're connected */\n static const struct dmi_system_id bad_lid_status[] = {\n \t{\n+\t\t.ident = \"Compaq nx9020\",\n+\t\t.matches = {\n+\t\t\tDMI_MATCH(DMI_SYS_VENDOR, \"Hewlett-Packard\"),\n+\t\t\tDMI_MATCH(DMI_BOARD_NAME, \"3084\"),\n+\t\t},\n+\t},\n+\t{\n+\t\t.ident = \"Samsung SX20S\",\n+\t\t.matches = {\n+\t\t\tDMI_MATCH(DMI_SYS_VENDOR, \"Samsung Electronics\"),\n+\t\t\tDMI_MATCH(DMI_BOARD_NAME, \"SX20S\"),\n+\t\t},\n+\t},\n+\t{\n \t\t.ident = \"Aspire One\",\n \t\t.matches = {\n \t\t\tDMI_MATCH(DMI_SYS_VENDOR, \"Acer\"),\n-- \n1.5.4.5\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "Other", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "acpi_other", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "14885", "Reported": "2009-12-30 00:08 UTC by Philipp Kohlbecher", "Modified": "2010-01-24 21:46 UTC", "CC List": "6 users", "See Also": "", "Kernel Version": "2.6.33-rc2", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/gpu/drm/i915/intel_lvds.c"], "methods": ["bad_lid_status"]}
{"id": "14753", "title": "ACPI Errors: Index beyond end of object, parse/execution failed, _BCM failed - Asus Notebook X5DIJ-SX101L", "description": "Created attachment 24058 [details]\ndmesg 2.6.32\n\nMost recent kernel where this bug did not occur: 2.6.31.6 stock from Arch Linux\nDistribution: Arch Linux\nHardware Environment: Asus Notebook X5DIJ-SX101L\nSoftware Environment: n/a\n\nProblem Description: \nSince installing the new kernel there a many ACPI Errors in dmesg:\n \nACPI Exception: AE_AML_BUFFER_LIMIT, Index (000000064) is beyond end of object (20090903/exoparg2-445)\nACPI Error (psparse-0537): Method parse/execution failed [\\_SB_.PCI0.SBRG.EC0_.STBR] (Node ffff88007d81d120), AE_AML_BUFFER_LIMIT\nACPI Error (psparse-0537): Method parse/execution failed [\\_SB_.PCI0.VGA_.LCDD._BCM] (Node ffff88007d8373a0), AE_AML_BUFFER_LIMIT\nACPI Error: Evaluating _BCM failed (20090903/video-528)\n\nI didn't notice any problems yet, maybe graphics in X are a bit slower but the biggest problem for me is the spam in dmesg. I found a bugreport (#9558) with ACPI errors that looks similar to mine except the part in square brackets. I have read about using a custom DSDT but the final solution in the other bugreport was a patch for Sizeof operator.\n\nThanks for your support.\n\nSteps to reproduce: Install Arch Linux and kernel 2.6.32, type dmesg in a terminal.", "patch": ["---\n drivers/acpi/blacklist.c |   14 ++++++++++++++\n 1 file changed, 14 insertions(+)\n\nIndex: linux-2.6/drivers/acpi/blacklist.c\n===================================================================\n--- linux-2.6.orig/drivers/acpi/blacklist.c\n+++ linux-2.6/drivers/acpi/blacklist.c\n@@ -185,6 +185,12 @@ static int __init dmi_disable_osi_vista(\n \tacpi_osi_setup(\"!Windows 2006\");\n \treturn 0;\n }\n+static int __init dmi_disable_osi_win7(const struct dmi_system_id *d)\n+{\n+\tprintk(KERN_NOTICE PREFIX \"DMI detected: %s\\n\", d->ident);\n+\tacpi_osi_setup(\"!Windows 2009\");\n+\treturn 0;\n+}\n \n static struct dmi_system_id acpi_osi_dmi_table[] __initdata = {\n \t{\n@@ -211,6 +217,14 @@ static struct dmi_system_id acpi_osi_dmi\n \t\t     DMI_MATCH(DMI_PRODUCT_NAME, \"Sony VGN-SR290J\"),\n \t\t},\n \t},\n+\t{\n+\t.callback = dmi_disable_osi_win7,\n+\t.ident = \"ASUS K50IJ\",\n+\t.matches = {\n+\t\t     DMI_MATCH(DMI_SYS_VENDOR, \"ASUSTeK Computer Inc.\"),\n+\t\t     DMI_MATCH(DMI_PRODUCT_NAME, \"K50IJ\"),\n+\t\t},\n+\t},\n \n \t/*\n \t * BIOS invocation of _OSI(Linux) is almost always a BIOS bug.\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "Power-Video", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Zhang Rui", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2009-12-06 18:32 UTC by Alexander Haeussler", "Modified": "2010-02-06 16:52 UTC", "CC List": "4 users", "See Also": "", "Kernel Version": "2.6.32", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/acpi/blacklist.c"], "methods": ["acpi_osi_dmi_table"]}
{"id": "14686", "title": "WARNING: at drivers/net/wireless/ath/ath5k/base.c:1142 ath5k_tasklet_rx+0x47a/0x5f0", "description": "Created attachment 23926 [details]\nboot dmesg\n\nHi,\nSince 2.6.32-rc8 I observe the following in my dmesg:\n\nWARNING: at drivers/net/wireless/ath/ath5k/base.c:1142 ath5k_tasklet_rx+0x47a/0x5f0 [ath5k]()\nHardware name: 2007WS4\ninvalid hw_rix: 1b\nModules linked in: vboxnetadp vboxnetflt vboxdrv usb_storage tun sco bridge stp llc bnep acpi_cpufreq cpufreq_powersave binfmt_misc uinput fuse hdaps tp_smapi thinkpad_ec cpufreq_stats cpufreq_ondemand freq_table loop dm_mod btusb snd_hda_codec_analog snd_hda_intel snd_hda_codec snd_pcm_oss snd_mixer_oss snd_pcm snd_seq_midi uhci_hcd snd_rawmidi snd_seq_midi_event snd_seq pcmcia snd_timer snd_seq_device ath5k snd psmouse ehci_hcd ath yenta_socket soundcore snd_page_alloc rsrc_nonstatic serio_raw usbcore evdev pcmcia_core\nPid: 14069, comm: rhythmbox Tainted: G        W  2.6.32-rc8 #1\nCall Trace:\n [<f8889d1a>] ? ath5k_tasklet_rx+0x47a/0x5f0 [ath5k]\n [<f8889d1a>] ? ath5k_tasklet_rx+0x47a/0x5f0 [ath5k]\n [<c1034a2c>] warn_slowpath_common+0x6c/0xc0\n [<f8889d1a>] ? ath5k_tasklet_rx+0x47a/0x5f0 [ath5k]\n [<c1034ac6>] warn_slowpath_fmt+0x26/0x30\n [<f8889d1a>] ath5k_tasklet_rx+0x47a/0x5f0 [ath5k]\n [<c149615a>] ? ieee80211_wake_queues+0xa/0x10\n [<c1039803>] tasklet_action+0x83/0x100\n [<c1039f42>] __do_softirq+0xa2/0x130\n [<c101b976>] ? ack_apic_level+0x66/0x170\n [<c1069ad6>] ? handle_IRQ_event+0x36/0xe0\n [<c103a015>] do_softirq+0x45/0x50\n [<c103a215>] irq_exit+0x65/0x80\n [<c1005a44>] do_IRQ+0x54/0xc0\n [<c1004129>] common_interrupt+0x29/0x30\n [<c103007b>] ? push_rt_task+0x9b/0x2a0\n [<c101ec2f>] ? read_hpet+0xf/0x20\n [<c1052af6>] getnstimeofday+0x56/0x110\n [<c1052c01>] do_gettimeofday+0x11/0x40\n [<c10394cd>] sys_gettimeofday+0x1d/0x70\n [<c1003a90>] sysenter_do_call+0x12/0x2c\n\nboot dmesg and config attached.\n\nThanks,\n    Nico", "patch": ["diff --git a/drivers/net/wireless/ath/ath5k/eeprom.c b/drivers/net/wireless/ath/ath5k/eeprom.c\nindex 644962a..7918852 100644\n--- a/drivers/net/wireless/ath/ath5k/eeprom.c\n+++ b/drivers/net/wireless/ath/ath5k/eeprom.c\n@@ -97,6 +97,7 @@ ath5k_eeprom_init_header(struct ath5k_hw *ah)\n \tstruct ath5k_eeprom_info *ee = &ah->ah_capabilities.cap_eeprom;\n \tint ret;\n \tu16 val;\n+\tu32 cksum, offset;\n \n \t/*\n \t * Read values from EEPROM and store them in the capability structure\n@@ -111,7 +112,6 @@ ath5k_eeprom_init_header(struct ath5k_hw *ah)\n \tif (ah->ah_ee_version < AR5K_EEPROM_VERSION_3_0)\n \t\treturn 0;\n \n-#ifdef notyet\n \t/*\n \t * Validate the checksum of the EEPROM date. There are some\n \t * devices with invalid EEPROMs.\n@@ -124,7 +124,6 @@ ath5k_eeprom_init_header(struct ath5k_hw *ah)\n \t\tATH5K_ERR(ah->ah_sc, \"Invalid EEPROM checksum 0x%04x\\n\", cksum);\n \t\treturn -EIO;\n \t}\n-#endif\n \n \tAR5K_EEPROM_READ_HDR(AR5K_EEPROM_ANT_GAIN(ah->ah_ee_version),\n \t    ee_ant_gain);\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "network-wireless", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "drivers_network-wireless@kernel-bugs.osdl.org", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2009-11-25 04:59 UTC by Nicolas Stransky", "Modified": "2010-03-04 15:25 UTC", "CC List": "5 users", "See Also": "", "Kernel Version": "2.6.32", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/net/wireless/ath/ath5k/eeprom.c"], "methods": ["ath5k_eeprom_init_header"]}
{"id": "14597", "title": "thinkpad-acpi: driver fails to load on old BIOS for the A31, T23-T30, X30-X31", "": "Show dependency tree", "description": "The driver will fail to detect BIOSes that both lack the \"ThinkPad\" string in the DMI tables, and the EC version string, for ThinkPads that have the EC version string on the most up-to-date BIOSES.\n\nThis causes the driver to return -ENODEV, and the module will not load.\n\nThe problem can be worked around by giving the module the \"force_load=1\" parameter.\n\nProblem tracked down to the quirk tables used as a fallback for known-BIOS detection, they would not match if the EC version is flagged as \"unknown\".", "patch": ["commit bc6ddddc544c8c991158575446c5bfcc5ae4517e\nAuthor: Henrique de Moraes Holschuh <hmh@hmh.eng.br>\nDate:   Fri Nov 13 18:10:29 2009 -0200\n\n    thinkpad-acpi: fix detection of old ThinkPads\n    \n    There is a problem in the quirk tables used by tpacpi_is_fw_known()\n    and tpacpi_check_outdated_fw(), which causes outdated BIOSes that are\n    lacking the EC firmware ID DMI field to never match.\n    \n    This breaks module loading on, e.g. a T23 with outdated BIOS, and the\n    module will refuse to load unless the \"force_load=1\" parameter is\n    given.\n    \n    This is a serious regression, introduced by commit\n    e675abafcc0df38125e6e94a9ba91c92fe774f52,\n    \"thinkpad-acpi: be more strict when detecting a ThinkPad\".\n    \n    Fix the quirk tables so that they can also match the outdated BIOSes,\n    which in turn will both fix the module loading, and also warn the user\n    he is using outdated firmware and should upgrade.\n    \n    Reported-by: Paul Kimoto <kimoto@lightlink.com>\n    Signed-off-by: Henrique de Moraes Holschuh <hmh@hmh.eng.br>\n\ndiff --git a/drivers/platform/x86/thinkpad_acpi.c b/drivers/platform/x86/thinkpad_acpi.c\nindex d93108d..8973af1 100644\n--- a/drivers/platform/x86/thinkpad_acpi.c\n+++ b/drivers/platform/x86/thinkpad_acpi.c\n@@ -1680,36 +1680,48 @@ static void tpacpi_remove_driver_attributes(struct device_driver *drv)\n \t\t\t  | (__bv1) << 8 | (__bv2) }\n \n #define TPV_Q_X(__v, __bid1, __bid2, __bv1, __bv2,\t\\\n-\t\t__eid1, __eid2, __ev1, __ev2)\t\t\\\n+\t\t__eid, __ev1, __ev2)\t\t\t\\\n \t{ .vendor\t= (__v),\t\t\t\\\n \t  .bios\t\t= TPID(__bid1, __bid2),\t\t\\\n-\t  .ec\t\t= TPID(__eid1, __eid2),\t\t\\\n+\t  .ec\t\t= __eid,\t\t\t\\\n \t  .quirks\t= (__ev1) << 24 | (__ev2) << 16 \\\n \t\t\t  | (__bv1) << 8 | (__bv2) }\n \n #define TPV_QI0(__id1, __id2, __bv1, __bv2) \\\n \tTPV_Q(PCI_VENDOR_ID_IBM, __id1, __id2, __bv1, __bv2)\n \n+/* Outdated IBM BIOSes often lack the EC id string */\n #define TPV_QI1(__id1, __id2, __bv1, __bv2, __ev1, __ev2) \\\n \tTPV_Q_X(PCI_VENDOR_ID_IBM, __id1, __id2, \t\\\n-\t\t__bv1, __bv2, __id1, __id2, __ev1, __ev2)\n+\t\t__bv1, __bv2, TPID(__id1, __id2),\t\\\n+\t\t__ev1, __ev2),\t\t\t\t\\\n+\tTPV_Q_X(PCI_VENDOR_ID_IBM, __id1, __id2, \t\\\n+\t\t__bv1, __bv2, TPACPI_MATCH_UNKNOWN,\t\\\n+\t\t__ev1, __ev2)\n \n+/* Outdated IBM BIOSes often lack the EC id string */\n #define TPV_QI2(__bid1, __bid2, __bv1, __bv2,\t\t\\\n \t\t__eid1, __eid2, __ev1, __ev2) \t\t\\\n \tTPV_Q_X(PCI_VENDOR_ID_IBM, __bid1, __bid2, \t\\\n-\t\t__bv1, __bv2, __eid1, __eid2, __ev1, __ev2)\n+\t\t__bv1, __bv2, TPID(__eid1, __eid2),\t\\\n+\t\t__ev1, __ev2),\t\t\t\t\\\n+\tTPV_Q_X(PCI_VENDOR_ID_IBM, __bid1, __bid2, \t\\\n+\t\t__bv1, __bv2, TPACPI_MATCH_UNKNOWN,\t\\\n+\t\t__ev1, __ev2)\n \n #define TPV_QL0(__id1, __id2, __bv1, __bv2) \\\n \tTPV_Q(PCI_VENDOR_ID_LENOVO, __id1, __id2, __bv1, __bv2)\n \n #define TPV_QL1(__id1, __id2, __bv1, __bv2, __ev1, __ev2) \\\n \tTPV_Q_X(PCI_VENDOR_ID_LENOVO, __id1, __id2, \t\\\n-\t\t__bv1, __bv2, __id1, __id2, __ev1, __ev2)\n+\t\t__bv1, __bv2, TPID(__id1, __id2),\t\\\n+\t\t__ev1, __ev2)\n \n #define TPV_QL2(__bid1, __bid2, __bv1, __bv2,\t\t\\\n \t\t__eid1, __eid2, __ev1, __ev2) \t\t\\\n \tTPV_Q_X(PCI_VENDOR_ID_LENOVO, __bid1, __bid2, \t\\\n-\t\t__bv1, __bv2, __eid1, __eid2, __ev1, __ev2)\n+\t\t__bv1, __bv2, TPID(__eid1, __eid2),\t\\\n+\t\t__ev1, __ev2)\n \n static const struct tpacpi_quirk tpacpi_bios_version_qtable[] __initconst = {\n \t/*  Numeric models ------------------ */\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Platform", "Hardware": "All Linux", "Importance": "P1 high", "Assignee": "Henrique de Moraes Holschuh", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "14230", "Reported": "2009-11-13 20:45 UTC by Henrique de Moraes Holschuh", "Modified": "2010-10-08 18:22 UTC", "CC List": "3 users", "See Also": "", "Kernel Version": "2.6.32-rc1", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/platform/x86/thinkpad_acpi.c"], "methods": ["TPV_Q_X"]}
{"id": "14538", "title": "Unable to associate with AP after resume since 2.6.32-rc6", "": "Show dependency tree", "description": "Kernel version: 2.6.32-rc6\nLast working kernel: 2.6.32-rc5\nAthlon 64 3000 single core\n64 bits version, Bluewhite64\n\nAfter a suspend to ram/resume, the wireless interface is dead and cannot reassociate anymore. Trying to restart wpa/dhcpd gives the following errors:\n\nroot@athor:/home/christian# /etc/rc.d/rc.inet1 stop\nroot@athor:/home/christian# /etc/rc.d/rc.inet1 start\nSIOCSIFFLAGS: Erreur inconnue 132\n/etc/rc.d/rc.inet1:  eth1 information: 'Any ESSID'\nError for wireless request \"Set Nickname\" (8B1C) :\n    SET failed on device eth1 ; Operation not supported.\nSIOCSIFFLAGS: Unknown error 132\nCould not set interface 'eth1' UP\nSIOCSIFFLAGS: Erreur inconnue 132\nPolling for DHCP server on interface eth1:\nerr, eth1: ioctl SIOCSIFFLAGS: Unknown error 132\n\nThe \"Set Nickame\" always occurs and is not the problem. However, the Unknown error 132 is completly new.\n\nMoreover, iwconfig says the eth1 interface is not associated anymore.", "patch": ["Index: wireless-testing/drivers/net/wireless/b43/rfkill.c\n===================================================================\n--- wireless-testing.orig/drivers/net/wireless/b43/rfkill.c\n+++ wireless-testing/drivers/net/wireless/b43/rfkill.c\n@@ -33,9 +33,16 @@ bool b43_is_hw_radio_enabled(struct b43_\n \t\t      & B43_MMIO_RADIO_HWENABLED_HI_MASK))\n \t\t\treturn 1;\n \t} else {\n-\t\tif (b43_status(dev) >= B43_STAT_STARTED &&\n-\t\t    b43_read16(dev, B43_MMIO_RADIO_HWENABLED_LO)\n-\t\t    & B43_MMIO_RADIO_HWENABLED_LO_MASK)\n+\t\t/* To prevent CPU fault on PPC, do not read a register\n+\t\t * unless the interface is started; however, on resume\n+\t\t * for hibernation, this routine is entered early. When\n+\t\t * that happens, unconditionally return TRUE.\n+\t\t */\n+\t\tif (b43_status(dev) >= B43_STAT_STARTED) {\n+\t\t\tif (b43_read16(dev, B43_MMIO_RADIO_HWENABLED_LO)\n+\t\t\t    & B43_MMIO_RADIO_HWENABLED_LO_MASK)\n+\t\t\t\treturn 1;\n+\t\t} else\n \t\t\treturn 1;\n \t}\n \treturn 0;\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Networking", "Classification": "Unclassified", "Component": "Wireless", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Larry Finger", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "7216 14230", "Reported": "2009-11-03 22:07 UTC by Christian Casteyde", "Modified": "2009-12-29 21:04 UTC", "CC List": "3 users", "See Also": "", "Kernel Version": "2.6.32-rc6", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/net/wireless/b43/rfkill.c"], "methods": ["b43_is_hw_radio_enabled"]}
{"id": "14329", "title": "Sata disk doesn't wake up after S3 suspend", "": "Show dependency tree", "description": "Created attachment 23274 [details]\nmessages\n\nAfter suspend one of my secondary disks doesn't resume. It works ok under kernel 2.6.30.9 and previous. I have 4 disk connected to the same Nvidia sata controller: 3 identical maxtor (sda/b/c) and 1 Hitachi (sdd), and this last one doesn't wakes up.\nIn attachment the interesting lines from /var/log/messages and the output of hdparm -I.\nThank you.", "patch": ["diff --git a/drivers/ata/sata_nv.c b/drivers/ata/sata_nv.c\nindex 86a4058..1eb4e02 100644\n--- a/drivers/ata/sata_nv.c\n+++ b/drivers/ata/sata_nv.c\n@@ -1594,9 +1594,21 @@ static int nv_hardreset(struct ata_link *link, unsigned int *class,\n \t    !ata_dev_enabled(link->device))\n \t\tsata_link_hardreset(link, sata_deb_timing_hotplug, deadline,\n \t\t\t\t    NULL, NULL);\n-\telse if (!(ehc->i.flags & ATA_EHI_QUIET))\n-\t\tata_link_printk(link, KERN_INFO,\n-\t\t\t\t\"nv: skipping hardreset on occupied port\\n\");\n+\telse {\n+\t\tconst unsigned long *timing = sata_ehc_deb_timing(ehc);\n+\t\tint rc;\n+\n+\t\tif (!(ehc->i.flags & ATA_EHI_QUIET))\n+\t\t\tata_link_printk(link, KERN_INFO, \"nv: skipping \"\n+\t\t\t\t\t\"hardreset on occupied port\\n\");\n+\n+\t\t/* make sure the link is online */\n+\t\trc = sata_link_resume(link, timing, deadline);\n+\t\t/* whine about phy resume failure but proceed */\n+\t\tif (rc && rc != -EOPNOTSUPP)\n+\t\t\tata_link_printk(link, KERN_WARNING, \"failed to resume \"\n+\t\t\t\t\t\"link (errno=%d)\\n\", rc);\n+\t}\n \n \t/* device signature acquisition is unreliable */\n \treturn -EAGAIN;\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "IO/Storage", "Classification": "Unclassified", "Component": "Serial ATA", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Tejun Heo", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "7216 13615 14616", "Reported": "2009-10-05 22:58 UTC by frodone", "Modified": "2009-11-17 08:55 UTC", "CC List": "3 users", "See Also": "", "Kernel Version": "2.6.31", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/ata/sata_nv.c"], "methods": ["nv_hardreset"]}
{"id": "14181", "title": "b43 causes panic at ifconfig down / shutdown", "": "Show dependency tree", "description": "This problem did not occur in 2.6.30 through 2.6.30.6\nThis problem does occur in 2.6.31-rc3 through 2.6.31\n\nWhen shutting down the system, a panic occurs.\n\nSystem: PowerMac G4\nDistribution: Ubuntu\nKernel is custom built / mainline.\n\nbacktrace is:\n\nssb_device_enable [ssb] (unreliable)\nb43_is_hw_radio_enabled [b43]\nb43_rfkill_poll [b43]\nieee80211_rfkill_poll [mac80211]\ncfg80211_rfkill_poll [cfg80211]\nrfkill_poll [rfkill]", "patch": ["Index: wireless-testing/drivers/net/wireless/b43/main.c\n===================================================================\n--- wireless-testing.orig/drivers/net/wireless/b43/main.c\n+++ wireless-testing/drivers/net/wireless/b43/main.c\n@@ -4500,6 +4500,7 @@ static void b43_op_stop(struct ieee80211\n \tcancel_work_sync(&(wl->beacon_update_trigger));\n \n \tmutex_lock(&wl->mutex);\n+\twiphy_rfkill_stop_polling(hw->wiphy);\n \tif (b43_status(dev) >= B43_STAT_STARTED) {\n \t\tdev = b43_wireless_core_stop(dev);\n \t\tif (!dev)\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "network-wireless", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "drivers_network-wireless@kernel-bugs.osdl.org", "URL": "https://bugs.launchpad.net/bugs/430225", "Keywords": "", "Depends on": "", "Blocks": "13615", "Reported": "2009-09-15 18:34 UTC by Jeremy Huddleston", "Modified": "2009-12-01 12:43 UTC", "CC List": "5 users", "See Also": "", "Kernel Version": "2.6.31", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/net/wireless/b43/main.c"], "methods": ["b43_op_stop"]}
{"id": "14143", "title": "OOPS when setting nr_requests for md devices", "": "Show dependency tree", "description": "Hi,\n\nEchoing any value to /sys/block/mdX/queue/nr_requests causes the kernel to OOPS and often to panic within 5-20 seconds.\n\nDoing the same for the underlaying block device works fine.\n\nReproduces easily on all the boxes I've tried.\n\nExample bt:\n[ 6336.680154] BUG: unable to handle kernel NULL pointer dereference at (null)                                                                                 \n[ 6336.680159] IP: [<ffffffff8102c8fc>] __wake_up_common+0x26/0x72                                                                                             \n[ 6336.680167] PGD 8d450067 PUD 8c91e067 PMD 0                                                                                                                 \n[ 6336.680171] Oops: 0000 [#1] PREEMPT SMP                                                                                                                     \n[ 6336.680174] last sysfs file: /sys/devices/virtual/block/md3/queue/nr_requests                                                                               \n[ 6336.680177] CPU 1                                                                                                                                           \n[ 6336.680179] Modules linked in: xt_tcpudp nf_conntrack_ipv4 nf_defrag_ipv4 xt_state nf_conntrack iptable_filter ip_tables x_tables fglrx(P) ipv6 cpufreq_conservative cpufreq_powersave cpufreq_stats cpufreq_userspace cpufreq_ondemand microcode kvm_intel kvm fuse acpi_cpufreq freq_table coretemp it87 hwmon_vid loop snd_hda_codec_atihdmi snd_hda_codec_realtek snd_hda_intel snd_hda_codec snd_pcm_oss snd_mixer_oss snd_pcm snd_seq_oss snd_seq_midi_event hid_a4tech snd_seq snd_timer snd_seq_device usbhid i2c_i801 evdev i2c_core snd soundcore button processor snd_page_alloc sr_mod cdrom uhci_hcd ehci_hcd floppy usbcore nls_base thermal fan thermal_sys [last unloaded: scsi_wait_scan]\n[ 6336.680225] Pid: 13570, comm: bash Tainted: P           2.6.31-rc9 #3 EP45T-DS3\n[ 6336.680227] RIP: 0010:[<ffffffff8102c8fc>]  [<ffffffff8102c8fc>] __wake_up_common+0x26/0x72\n[ 6336.680232] RSP: 0018:ffff880072c59de8  EFLAGS: 00010096\n[ 6336.680234] RAX: 0000000000000000 RBX: ffff88012d0d0058 RCX: 0000000000000000\n[ 6336.680237] RDX: 0000000000000001 RSI: 0000000000000003 RDI: ffff88012d0d0058\n[ 6336.680239] RBP: 0000000000000001 R08: ffffffffffffffe8 R09: 000000000000000a\n[ 6336.680242] R10: 0000000000066f6b R11: 0000000000000002 R12: 0000000000000000\n[ 6336.680244] R13: ffff88012d0d0060 R14: 0000000000000000 R15: 0000000000000000\n[ 6336.680247] FS:  00007f0137db96f0(0000) GS:ffff88002803e000(0000) knlGS:0000000000000000\n[ 6336.680250] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033\n[ 6336.680252] CR2: 0000000000000000 CR3: 0000000072c5c000 CR4: 00000000000026e0\n[ 6336.680255] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000\n[ 6336.680257] DR3: 0000000000000000 DR6: 00000000ffff0ff0 DR7: 0000000000000400\n[ 6336.680260] Process bash (pid: 13570, threadinfo ffff880072c58000, task ffff88008d430000)\n[ 6336.680262] Stack:\n[ 6336.680263]  00000003816fb4c0 ffff88012d0d0058 ffff88012d0d0000 0000000000000000\n[ 6336.680267] <0> 0000000000000001 0000000000000046 0000000000000003 ffffffff8102ebe5\n[ 6336.680271] <0> 0000000000002000 0000000000000005 ffffffff8165e170 0000000000000005\n[ 6336.680276] Call Trace:\n[ 6336.680280]  [<ffffffff8102ebe5>] ? __wake_up+0x30/0x44\n[ 6336.680285]  [<ffffffff811d2c67>] ? queue_requests_store+0x183/0x2aa\n[ 6336.680288]  [<ffffffff811d2df2>] ? queue_attr_store+0x64/0x7f\n[ 6336.680292]  [<ffffffff81116130>] ? sysfs_write_file+0xd0/0x107\n[ 6336.680296]  [<ffffffff810c4f87>] ? vfs_write+0xad/0x169\n[ 6336.680299]  [<ffffffff810c50ff>] ? sys_write+0x45/0x6e\n[ 6336.680303]  [<ffffffff8100ba2b>] ? system_call_fastpath+0x16/0x1b\n[ 6336.680305] Code: 01 00 00 00 c3 41 57 41 89 cf 41 56 4d 89 c6 41 55 4c 8d 6f 08 41 54 55 89 d5 53 48 83 ec 08 89 74 24 04 48 8b 47 08 4c 8d 40 e8 <49> 8b 40 18 48 8d 58 e8 eb 2d 45 8b 20 4c 89 f1 44 89 fa 8b 74\n[ 6336.680337] RIP  [<ffffffff8102c8fc>] __wake_up_common+0x26/0x72\n[ 6336.680340]  RSP <ffff880072c59de8>\n[ 6336.680342] CR2: 0000000000000000\n[ 6336.680344] ---[ end trace d5292aec4d1f06a9 ]---\n[ 6336.680347] note: bash[13570] exited with preempt_count 2", "patch": ["diff --git a/block/blk-sysfs.c b/block/blk-sysfs.c\nindex d3aa2aa..b78c9c3 100644\n--- a/block/blk-sysfs.c\n+++ b/block/blk-sysfs.c\n@@ -40,7 +40,12 @@ queue_requests_store(struct request_queue *q, const char *page, size_t count)\n {\n \tstruct request_list *rl = &q->rq;\n \tunsigned long nr;\n-\tint ret = queue_var_store(&nr, page, count);\n+\tint ret;\n+\n+\tif (!q->request_fn)\n+\t\treturn -EINVAL;\n+\n+\tret = queue_var_store(&nr, page, count);\n \tif (nr < BLKDEV_MIN_RQ)\n \t\tnr = BLKDEV_MIN_RQ;\n \n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "IO/Storage", "Classification": "Unclassified", "Component": "Block Layer", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Jens Axboe", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "13615", "Reported": "2009-09-08 08:48 UTC by aCaB", "Modified": "2009-10-12 21:28 UTC", "CC List": "3 users", "See Also": "", "Kernel Version": "2.6.31", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["block/blk-sysfs.c"], "methods": ["queue_requests_store"]}
{"id": "14053", "title": "Kernel blocks during rsync to NFS-mounted directory exported from Sun OS machine", "description": "Created attachment 22838 [details]\nFedora 10 machine details (/proc/{cpuinfo,modules,ioports,iomem,scsi/scsi},lspci -vvv)\n\nWe have a Fedora 10 machine and a Sun OS machine. The Sun OS machine exports a ZFS filesystem (pool) to the Fedora 10 machine, which mounts it using a NFS v4 mount (/etc/fstab: \tmelon:/melon1   /melon1 nfs4    rw,rsize=8192,wsize=8192,timeo=14,intr). When a large file (3 GB) is read from the NFS-mounted directory on the Fedora 10 machine (/melon1) this kernel panic frequently occurs. Also, when performing a rsync to this directory this kernel panic also occurs, even being at one point was completely predictable by consistently crashing 3 times in each case after sending around 2 MB. However, the bug is not always so predictable. The Sun OS machine has apparently no ill effects.\n\nI don't know if this is a failure in the implementation of NFS 4 in Linux or in Sun OS.\n\n\nSun OS machine information:\n\nSunOS 5.10 Generic_137112-06 i86pc i386 i86pc\n\nFedora 10 machine information:\n\nClient: Fedora 10 Linux\nClient Kernel Version (/proc/version): Linux version 2.6.27.29-170.2.79.fc10.x86_64 (mockbuild@x86-4.fedora.phx.redhat.com) (gcc version 4.3.2 20081105 (Red Hat 4.3.2-7) (GCC) ) #1 SMP Fri Aug 14 20:49:37 EDT 2009", "patch": ["From: Trond Myklebust <Trond.Myklebust@netapp.com>\nSUNRPC: Fix rpc_task_force_reencode\n\nIf we're in the case where we need to force a reencode and then resend of\nthe RPC request, due to xprt_transmit failing with a networking error, then\nwe _must_ retransmit the entire request.\n\nSigned-off-by: Trond Myklebust <Trond.Myklebust@netapp.com>\n---\n\n net/sunrpc/clnt.c |    1 +\n 1 files changed, 1 insertions(+), 0 deletions(-)\n\n\ndiff --git a/net/sunrpc/clnt.c b/net/sunrpc/clnt.c\nindex c1e467e..fac0ca9 100644\n--- a/net/sunrpc/clnt.c\n+++ b/net/sunrpc/clnt.c\n@@ -955,6 +955,7 @@ static inline void\n rpc_task_force_reencode(struct rpc_task *task)\n {\n \ttask->tk_rqstp->rq_snd_buf.len = 0;\n+\ttask->tk_rqstp->rq_bytes_sent = 0;\n }\n \n static inline void\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "File System", "Classification": "Unclassified", "Component": "NFS", "Hardware": "All Linux", "Importance": "P1 blocking", "Assignee": "Trond Myklebust", "URL": "http://kerneloops.org/submitresult.ph...", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2009-08-25 02:14 UTC by Matthew Breeze", "Modified": "2010-02-03 20:42 UTC", "CC List": "0 users", "See Also": "", "Kernel Version": "2.6.27", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["net/sunrpc/clnt.c"], "methods": ["rpc_task_force_reencode"]}
{"id": "14000", "title": "prism 2.5 broke in 2.6.30.x", "description": "Prism 2.5 wireless card fails as an AP after a kernel upgrade to 2.6.30.1 and later (up to 2.6.30.5).\n\nNot tried with 2.6.30.\nNot tried as STA.\nThe card works well up to kernel 2.6.29.6\n\nTo reproduce:\n# iwconfig wlan0 mode master\n# iwconfig wlan0 chan 4\n# iwconfig wlan0 essid ea0\n# ifconfig wlan0 192.168.220.254\n>now the STA associates>\n# tcpdump -i wlan0 -n\n<now the STA pings>\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on wlan0, link-type EN10MB (Ethernet), capture size 96 bytes\n23:59:36.177209 ARP, Request who-has 192.168.220.254 tell 192.168.220.88, length 28\n23:59:36.177287 ARP, Request who-has 192.168.220.254 tell 192.168.220.88, length 28\n23:59:36.177306 ARP, Reply 192.168.220.254 is-at 00:e0:00:8d:bd:8e, length 28\n23:59:41.610114 ARP, Request who-has 192.168.220.254 tell 192.168.220.88, length 28\n23:59:41.610192 ARP, Request who-has 192.168.220.254 tell 192.168.220.88, length 28\n23:59:41.610199 ARP, Reply 192.168.220.254 is-at 00:e0:00:8d:bd:8e, length 28\n<packets (ARP, at least) flow from STA to AP, but not the other way round>\n\nRelated dmesg lines:\n\n[    5.928208] hostap_pci 0000:02:01.0: PCI INT A -> GSI 21 (level, low) -> IRQ 21                                            \n[    5.928781] hostap_pci: Registered netdevice wifi0\n[    5.928854] wifi0: Original COR value: 0x2\n[    6.128188] prism2_hw_init: initialized in 196 ms\n[    6.129008] wifi0: NIC: id=0x8013 v1.0.0\n[    6.129225] wifi0: PRI: id=0x15 v1.1.1\n[    6.129437] wifi0: STA: id=0x1f v1.8.2\n[    6.133506] wifi0: Intersil Prism2.5 PCI: mem=0xec000000, irq=21\n[    6.134100] wifi0: registered netdevice wlan0\n..... (unrelated) .....\n[  575.222877] wifi0: deauthentication: 00:0b:6b:35:80:9a len=2, reason_code=3\n[  579.638087] wifi0: 00:0b:6b:35:80:9a auth_cb - alg=0 trans#=2 status=0 - STA authenticated\n[  579.639151] wifi0: assoc from 00:0b:6b:35:80:9a with extra data (11 bytes) [<dd><09><00><03><7f><01><01><00><00><00><00>]\n[  579.740704] wifi0: 00:0b:6b:35:80:9a assoc_cb - STA associated\n[  583.017732] Virtual device wifi0 asks to queue packet!\n[  588.025832] Virtual device wifi0 asks to queue packet!\n[  596.028100] Virtual device wifi0 asks to queue packet!\n[  814.920383] Virtual device wifi0 asks to queue packet!\n... and so on\n\nOS:\nDebian Testing, GCC-4.3.3", "patch": ["From: Martin Decky <martin@decky.cz>\n\nAs the hostap driver was converted to use net_device_ops, a mistake was\nmade in hostap_main.c (commit 5ae4efbcd2611562a8b93596be034e63495706a5).\nOriginally, the tx_queue_len was set to 0 for every other interface than\nHOSTAP_INTERFACE_MASTER, but the new fragment of code sets tx_queue_len to\n0 only for HOSTAP_INTERFACE_MASTER. The opposite of the previous\nbehavior makes the driver to drop all packets in AP mode.\n\nChange the way 0 is assigned to tx_queue_len according to the original\nlogic.\n\nSigned-off-by: Martin Decky <martin@decky.cz>\n----\ndiff -Naurp linux-2.6.30.orig/drivers/net/wireless/hostap/hostap_main.c linux-2.6.30/drivers/net/wireless/hostap/hostap_main.c\n--- linux-2.6.30.orig/drivers/net/wireless/hostap/hostap_main.c\t2009-06-10 05:05:27.000000000 +0200\n+++ linux-2.6.30/drivers/net/wireless/hostap/hostap_main.c\t2009-09-08 11:11:23.892816045 +0200\n@@ -875,15 +875,16 @@ void hostap_setup_dev(struct net_device \n \n \tswitch(type) {\n \tcase HOSTAP_INTERFACE_AP:\n+\t\tdev->tx_queue_len = 0;\t/* use main radio device queue */\n \t\tdev->netdev_ops = &hostap_mgmt_netdev_ops;\n \t\tdev->type = ARPHRD_IEEE80211;\n \t\tdev->header_ops = &hostap_80211_ops;\n \t\tbreak;\n \tcase HOSTAP_INTERFACE_MASTER:\n-\t\tdev->tx_queue_len = 0;\t/* use main radio device queue */\n \t\tdev->netdev_ops = &hostap_master_ops;\n \t\tbreak;\n \tdefault:\n+\t\tdev->tx_queue_len = 0;\t/* use main radio device queue */\n \t\tdev->netdev_ops = &hostap_netdev_ops;\n \t}\n \n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "network-wireless", "Hardware": "i386 Linux", "Importance": "P1 normal", "Assignee": "drivers_network-wireless@kernel-bugs.osdl.org", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2009-08-17 21:10 UTC by Yasen Balev", "Modified": "2009-12-18 15:46 UTC", "CC List": "5 users", "See Also": "", "Kernel Version": "2.6.30", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/net/wireless/hostap/hostap_main.c"], "methods": ["hostap_setup_dev"]}
{"id": "13823", "title": "QLA2XXX driver causes kernel oops with a qla2200", "description": "Whenever I insert the qla2xxx module, the kernel always oopses.  Sometimes, the driver will work and detect the drives, but it will oops again later.  I have tried this on multiple machines with different qla2200 cards and they both experience the same oopsing, sometimes resulting in a hard lock.\n\nHere is one of the oops on loading the module:\n[27287.119929] QLogic Fibre Channel HBA Driver: 8.03.00-k4\n[27287.120016] qla2xxx 0000:06:01.0: PCI INT A -> GSI 74 (level, low) -> IRQ 74\n[27287.120070] qla2xxx 0000:06:01.0: Found an ISP2200, irq 74, iobase 0xffffc20000c5c000\n[27287.120281] IRQ 74/qla2xxx: IRQF_DISABLED is not guaranteed on shared IRQs\n[27287.120309] qla2xxx 0000:06:01.0: Configuring PCI space...\n[27287.120510] qla2xxx 0000:06:01.0: Configure NVRAM parameters...\n[27287.205932] qla2xxx 0000:06:01.0: Verifying loaded RISC code...\n[27287.216038] qla2xxx 0000:06:01.0: firmware: requesting ql2200_fw.bin\n[27294.548077] qla2xxx 0000:06:01.0: Allocated (252 KB) for firmware dump...\n[27294.669022] qla2xxx 0000:06:01.0: LIP reset occurred (f7f7).\n[27294.680099] scsi0 : qla2xxx\n[27294.818489] qla2xxx 0000:06:01.0: LOOP UP detected (1 Gbps).\n[27295.684930] BUG: unable to handle kernel NULL pointer dereference at (null)\n[27295.685892] IP: [<ffffffffa0011910>] qla2x00_prep_ms_fdmi_iocb+0x26/0xbc [qla2xxx]\n[27295.685892] PGD 1989d1067 PUD 199007067 PMD 0 \n[27295.685892] Oops: 0002 [#1] SMP \n[27295.685892] last sysfs file: /sys/devices/pci0000:00/0000:00:06.0/0000:05:00.0/0000:06:01.0/firmware/0000:06:01.0/loading\n[27295.685892] CPU 3 \n[27295.685892] Modules linked in: qla2xxx(+)\n[27295.685892] Pid: 14114, comm: qla2xxx_0_dpc Not tainted 2.6.29-gentoo-r5dl380 #2 ProLiant DL380 G4\n[27295.685892] RIP: 0010:[<ffffffffa0011910>]  [<ffffffffa0011910>] qla2x00_prep_ms_fdmi_iocb+0x26/0xbc [qla2xxx]\n[27295.685892] RSP: 0018:ffff88017cdc5c38  EFLAGS: 00010246\n[27295.685892] RAX: 0000000000000000 RBX: 0000000000000000 RCX: 0000000000000010\n[27295.685892] RDX: 0000000000000010 RSI: 0000000000000000 RDI: 0000000000000000\n[27295.685892] RBP: ffff88017cdc5c40 R08: 0000000000000000 R09: ffff880199bde800\n[27295.685892] R10: 0000000000000010 R11: ffff880199bde540 R12: ffff880199bde540\n[27295.685892] R13: ffff880199bde800 R14: ffff880199bde540 R15: ffff880199bde540\n[27295.685892] FS:  0000000000000000(0000) GS:ffff88019ac52300(0000) knlGS:0000000000000000\n[27295.685892] CS:  0010 DS: 0018 ES: 0018 CR0: 000000008005003b\n[27295.685892] CR2: 0000000000000000 CR3: 000000019993f000 CR4: 00000000000006e0\n[27295.685892] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000\n[27295.685892] DR3: 0000000000000000 DR6: 00000000ffff0ff0 DR7: 0000000000000400\n[27295.685892] Process qla2xxx_0_dpc (pid: 14114, threadinfo ffff88017cdc4000, task ffff8801991314d0)\n[27295.685892] Stack:\n[27295.685892]  0000000000000000 ffff88017cdc5c90 ffffffffa0012384 ffff00007cdc5ce0\n[27295.685892]  ffffffffa000b100 000000cf00000203 0000000000000000 ffff880199bde540\n[27295.685892]  0000000000000003 0000000000000000 ffff880199bde540 ffff88017cdc5ce0\n[27295.685892] Call Trace:\n[27295.685892]  [<ffffffffa0012384>] qla2x00_fdmi_rhba+0x2f/0x490 [qla2xxx]\n[27295.685892]  [<ffffffffa000b100>] ? qla2x00_get_port_name+0x7a/0xf1 [qla2xxx]\n[27295.685892]  [<ffffffffa0012810>] qla2x00_fdmi_register+0x2b/0x449 [qla2xxx]\n[27295.685892]  [<ffffffffa00067b1>] qla2x00_configure_loop+0x9da/0x13fc [qla2xxx]\n[27295.685892]  [<ffffffffa0009bf3>] ? qla2x00_mailbox_command+0x51a/0x56c [qla2xxx]\n[27295.685892]  [<ffffffffa000b308>] ? qla2x00_get_retry_cnt+0x51/0xd2 [qla2xxx]\n[27295.685892]  [<ffffffffa000726b>] qla2x00_loop_resync+0x98/0xf3 [qla2xxx]\n[27295.685892]  [<ffffffffa00026f2>] qla2x00_do_dpc+0x2c1/0x392 [qla2xxx]\n[27295.685892]  [<ffffffffa0002431>] ? qla2x00_do_dpc+0x0/0x392 [qla2xxx]\n[27295.685892]  [<ffffffff8104af29>] kthread+0x49/0x76\n[27295.685892]  [<ffffffff8100d1ba>] child_rip+0xa/0x20\n[27295.685892]  [<ffffffff8104aee0>] ? kthread+0x0/0x76\n[27295.685892]  [<ffffffff8100d1b0>] ? child_rip+0x0/0x20\n[27295.685892] Code: 5b 41 5c 5d c3 55 48 89 e5 48 83 ec 08 49 89 fb 41 89 d2 4c 8b 8f a0 01 00 00 4d 8b 81 70 01 00 00 b9 10 00 00 00 31 c0 4c 89 c7 <f3> ab 41 c6 00 29 41 c6 40 01 01 41 83 b9 30 01 00 00 00 66 41 \n[27295.685892] RIP  [<ffffffffa0011910>] qla2x00_prep_ms_fdmi_iocb+0x26/0xbc [qla2xxx]\n[27295.685892]  RSP <ffff88017cdc5c38>\n[27295.685892] CR2: 0000000000000000\n[27299.116827] ---[ end trace 3eb74739b5f59456 ]---\n[27299.689025] qla2xxx 0000:06:01.0: \n[27299.689027]  QLogic Fibre Channel HBA Driver: 8.03.00-k4\n[27299.689028]   QLogic QLA22xx - \n[27299.689029]   ISP2200: PCI (66 MHz) @ 0000:06:01.0 hdma+, host#=0, fw=2.02.08 TP", "patch": ["diff --git a/drivers/scsi/qla2xxx/qla_gs.c b/drivers/scsi/qla2xxx/qla_gs.c\nindex 917534b..52e4dbe 100644\n--- a/drivers/scsi/qla2xxx/qla_gs.c\n+++ b/drivers/scsi/qla2xxx/qla_gs.c\n@@ -1675,6 +1675,9 @@ qla2x00_fdmi_register(scsi_qla_host_t *vha)\n {\n \tint rval;\n \n+\tif (IS_QLA2100(ha) || IS_QLA2200(ha))\n+\t\treturn QLA_FUNCTION_FAILED;\n+\n \trval = qla2x00_mgmt_svr_login(vha);\n \tif (rval)\n \t\treturn rval;\n", "diff --git a/drivers/scsi/qla2xxx/qla_gs.c b/drivers/scsi/qla2xxx/qla_gs.c\nindex 917534b..52e4dbe 100644\n--- a/drivers/scsi/qla2xxx/qla_gs.c\n+++ b/drivers/scsi/qla2xxx/qla_gs.c\n@@ -1675,6 +1675,9 @@ qla2x00_fdmi_register(scsi_qla_host_t *vha)\n {\n \tint rval;\n+\tstruct qla_hw_data *ha = vha->hw; \n+\n+\tif (IS_QLA2100(ha) || IS_QLA2200(ha))\n+\t\treturn QLA_FUNCTION_FAILED;\n+\n \trval = qla2x00_mgmt_svr_login(vha);\n \tif (rval)\n \t\treturn rval;\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "SCSI Drivers", "Classification": "Unclassified", "Component": "QLOGIC QLA2XXX", "Hardware": "All Linux", "Importance": "P1 high", "Assignee": "scsi_drivers-qla2xxx", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2009-07-25 11:03 UTC by Thomas", "Modified": "2012-06-13 14:15 UTC", "CC List": "3 users", "See Also": "", "Kernel Version": "2.6.29", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/scsi/qla2xxx/qla_gs.c"], "methods": ["qla2x00_fdmi_register"]}
{"id": "13793", "title": "2.6.31 regression - boot crash in rcu_process_callbacks - DELL XPS M1330", "description": "Created attachment 22393 [details]\nPhoto of the screen after the crash\n\nKernel 2.6.31 does not boot on my laptop (a DELL XPS M1330). I have tried rc1, rc2, rc3 and today's daily build but none of those will boot on my laptop.\n\nI get the following call trace with today's daily build:\nrcu_do_batch+0x27/0x90\n__rcu_process_callbacks+0xc8/0x100\ntick_handle_oneshot_broadcast+0xdd/0x100\nrcu_process_callbacks+0x20/0x40\ntimer_interrupt+0x21/0x70\nhandle_IRQ_event+0x56/0x120\ndo_softirq+0x3c/0x40\nirq_exit+0x5c/0x70\ndo_IRQ+0x4f/0xc0\ncommon_interrupt+0x29/0x30\nsys_getresuid+0x3b/0x70\nacpi_idle_enter_bm+0x19a/0x1c9\ncpuidle_idle_call+0x6f/0xc0\ncpu_idle+0x42/0x80\nstart_secondary+0xae/0cd0", "patch": ["From a345a80ca7a926c9c6e322a1e8add4817c834d0f Mon Sep 17 00:00:00 2001\nFrom: Stefan Bader <stefan.bader@canonical.com>\nDate: Thu, 23 Jul 2009 11:26:05 +0200\nSubject: [PATCH] jfs: Fix early release of acl in jfs_get_acl\n\nBugLink: http://bugs.launchpad.net/ubuntu/+bug/396780\n\nCommit 073aaa1b142461d91f83da66db1184d7c1b1edea \"helpers for acl\ncaching + switch to those\" introduced new helper functions for\nacl handling but seems to have introduced a regression for jfs as\nthe acl is released before returning it to the caller, instead of\nleaving this for the caller to do.\nThis causes the acl object to be used after freeing it, leading\nto kernel panics in completely different places.\n\nThanks to Christophe Dumez for reporting and bisecting into this.\n\nReported-by: Christophe Dumez <dchris@gmail.com>\nTested-by: Christophe Dumez <dchris@gmail.com>\nSigned-off-by: Stefan Bader <stefan.bader@canonical.com>\nAcked-by: Andy Whitcroft <apw@canonical.com>\n---\n fs/jfs/acl.c |    4 +---\n 1 files changed, 1 insertions(+), 3 deletions(-)\n\ndiff --git a/fs/jfs/acl.c b/fs/jfs/acl.c\nindex f272bf0..3c88d1b 100644\n--- a/fs/jfs/acl.c\n+++ b/fs/jfs/acl.c\n@@ -67,10 +67,8 @@ static struct posix_acl *jfs_get_acl(struct inode *inode, int type)\n \t\tacl = posix_acl_from_xattr(value, size);\n \t}\n \tkfree(value);\n-\tif (!IS_ERR(acl)) {\n+\tif (!IS_ERR(acl))\n \t\tset_cached_acl(inode, type, acl);\n-\t\tposix_acl_release(acl);\n-\t}\n \treturn acl;\n }\n \n-- \n1.5.4.3\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "File System", "Classification": "Unclassified", "Component": "VFS", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Len Brown", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2009-07-17 14:49 UTC by Christophe Dumez", "Modified": "2012-06-13 14:10 UTC", "CC List": "5 users", "See Also": "", "Kernel Version": "2.6.31-rc3", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["fs/jfs/acl.c"], "methods": ["*jfs_get_acl"]}
{"id": "13780", "title": "NULL pointer dereference loading powernowk8", "": "Show dependency tree", "description": "Created attachment 22358 [details]\nkernel log\n\nHi,\n\nWhen the \"loadcpufreq\" init script loads the kernel module (powernow_k8?), I get the following error:\nkernel: [   39.822807] BUG: unable to handle kernel NULL pointer dereference at\n0000000000000024\nkernel: [   39.824035] IP: [<ffffffffa034b094>] powernowk8_cpu_init+0x30d/0xa07\n[powernow_k8]\n\nI'm using debian's kernel linux-image-2.6.30-1-amd64 2.6.30-2\n\nIf I don't start that script, I do not get the error.", "patch": ["diff --git a/arch/x86/kernel/cpu/cpufreq/powernow-k8.c b/arch/x86/kernel/cpu/cpufreq/powernow-k8.c\nindex 4dd7e3b..cfe7043 100644\n--- a/arch/x86/kernel/cpu/cpufreq/powernow-k8.c\n+++ b/arch/x86/kernel/cpu/cpufreq/powernow-k8.c\n@@ -617,9 +617,10 @@ static int check_pst_table(struct powernow_k8_data *data, struct pst_s *pst,\n \treturn 0;\n }\n \n-static void invalidate_entry(struct powernow_k8_data *data, unsigned int entry)\n+static void invalidate_entry(struct cpufreq_frequency_table *powernow_table,\n+\t\tunsigned int entry)\n {\n-\tdata->powernow_table[entry].frequency = CPUFREQ_ENTRY_INVALID;\n+\tpowernow_table[entry].frequency = CPUFREQ_ENTRY_INVALID;\n }\n \n static void print_basics(struct powernow_k8_data *data)\n@@ -911,13 +912,13 @@ static int fill_powernow_table_pstate(struct powernow_k8_data *data,\n \t\t\t\t\t\"bad value %d.\\n\", i, index);\n \t\t\tprintk(KERN_ERR PFX \"Please report to BIOS \"\n \t\t\t\t\t\"manufacturer\\n\");\n-\t\t\tinvalidate_entry(data, i);\n+\t\t\tinvalidate_entry(powernow_table, i);\n \t\t\tcontinue;\n \t\t}\n \t\trdmsr(MSR_PSTATE_DEF_BASE + index, lo, hi);\n \t\tif (!(hi & HW_PSTATE_VALID_MASK)) {\n \t\t\tdprintk(\"invalid pstate %d, ignoring\\n\", index);\n-\t\t\tinvalidate_entry(data, i);\n+\t\t\tinvalidate_entry(powernow_table, i);\n \t\t\tcontinue;\n \t\t}\n \n@@ -962,7 +963,7 @@ static int fill_powernow_table_fidvid(struct powernow_k8_data *data,\n \t\t/* verify frequency is OK */\n \t\tif ((freq > (MAX_FREQ * 1000)) || (freq < (MIN_FREQ * 1000))) {\n \t\t\tdprintk(\"invalid freq %u kHz, ignoring\\n\", freq);\n-\t\t\tinvalidate_entry(data, i);\n+\t\t\tinvalidate_entry(powernow_table, i);\n \t\t\tcontinue;\n \t\t}\n \n@@ -970,7 +971,7 @@ static int fill_powernow_table_fidvid(struct powernow_k8_data *data,\n \t\t * BIOSs are using \"off\" to indicate invalid */\n \t\tif (vid == VID_OFF) {\n \t\t\tdprintk(\"invalid vid %u, ignoring\\n\", vid);\n-\t\t\tinvalidate_entry(data, i);\n+\t\t\tinvalidate_entry(powernow_table, i);\n \t\t\tcontinue;\n \t\t}\n \n@@ -989,7 +990,7 @@ static int fill_powernow_table_fidvid(struct powernow_k8_data *data,\n \n \t\t\t\tdprintk(\"double low frequency table entry, \"\n \t\t\t\t\t\t\"ignoring it.\\n\");\n-\t\t\t\tinvalidate_entry(data, i);\n+\t\t\t\tinvalidate_entry(powernow_table, i);\n \t\t\t\tcontinue;\n \t\t\t} else\n \t\t\t\tcntlofreq = i;\n@@ -1001,7 +1002,7 @@ static int fill_powernow_table_fidvid(struct powernow_k8_data *data,\n \t\t\t\t(unsigned int)\n \t\t\t\t(data->acpi_data.states[i].core_frequency\n \t\t\t\t * 1000));\n-\t\t\tinvalidate_entry(data, i);\n+\t\t\tinvalidate_entry(powernow_table, i);\n \t\t\tcontinue;\n \t\t}\n \t}\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Power Management", "Classification": "Unclassified", "Component": "cpufreq", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Mark Langsdorf", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "12398", "Reported": "2009-07-15 18:00 UTC by Kurt Roeckx", "Modified": "2010-01-19 22:03 UTC", "CC List": "5 users", "See Also": "", "Kernel Version": "2.6.29", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["arch/x86/kernel/cpu/cpufreq/powernow-k8.c"], "methods": ["check_pst_table", "fill_powernow_table_pstate", "fill_powernow_table_fidvid"]}
{"id": "13776", "title": "KMS with Intel Graphic fails", "description": "i am trying kms with a intel chipset, linux-2.6.31-rc3, recent mesa-master and libdrm-master from 13.07.2009 and i am become follow error when i am inserting i915.ko:\n\n[    2.105376] i915 0000:00:02.0: power state changed by ACPI to D0\n[    2.105489] i915 0000:00:02.0: PCI INT A -> GSI 16 (level, low) -> IRQ 16\n[    2.105598] i915 0000:00:02.0: setting latency timer to 64\n[    2.108792] BUG: unable to handle kernel NULL pointer dereference at (null)\n[    2.109046] IP: [<(null)>] (null)\n[    2.109224] *pde = 00000000\n[    2.109397] Oops: 0000 [#1] PREEMPT SMP\n[    2.109716] last sysfs file: /sys/devices/pci0000:00/0000:00:1f.2/host0/target0:0:0/0:0:0:0/type\n[    2.109856] Modules linked in: led_class ieee1394 snd_hda_intel(+) snd_hda_codec snd_pcm snd_timer snd soundcore snd_page_alloc i2c_i801 i915(+) drm ehci_hcd(+) uhci_hcd(+) i2c_algo_bit video backlight output e1000e usbcore\n[    2.111508]\n[    2.111612] Pid: 1018, comm: modprobe Not tainted (2.6.31-rc3 #1) 7667V4E\n[    2.111723] EIP: 0060:[<00000000>] EFLAGS: 00010246 CPU: 1\n[    2.111833] EIP is at 0x0\n[    2.111935] EAX: 00000000 EBX: c1fa3ba0 ECX: c1fed76c EDX: c1fa3ba0\n[    2.112042] ESI: f6b1c110 EDI: 00000000 EBP: f69dfd60 ESP: f69dfd48\n[    2.112042]  DS: 007b ES: 007b FS: 00d8 GS: 0000 SS: 0068\n[    2.112042] Process modprobe (pid: 1018, ti=f69de000 task=f64283f0 task.ti=f69de000)\n[    2.112042] Stack:\n[    2.112042]  c0156da4 f6b5c000 00000000 f6836b00 f69c8660 00000000 f69dfd70 c0156e2c\n[    2.112572] <0> 00000000 f6836b00 f69dfd90 f830600f 00000000 f6b1c110 00000020 f6836b00\n[    2.112572] <0> f69c8660 f6b5c000 f69dfdc4 f83064c9 000080d0 f6b5cca0 f6b5ccdc f6b5ccd4\n[    2.112572] Call Trace:\n[    2.112572]  [<c0156da4>] ? read_cache_page_async+0x72/0xee\n[    2.112572]  [<c0156e2c>] ? read_cache_page+0xc/0x3c\n[    2.112572]  [<f830600f>] ? i915_gem_object_get_pages+0x8c/0xd7 [i915]\n[    2.112572]  [<f83064c9>] ? i915_gem_object_bind_to_gtt+0x167/0x20f [i915]\n[    2.112572]  [<f830658d>] ? i915_gem_object_pin+0x1c/0x149 [i915]\n[    2.112572]  [<f82ad853>] ? drm_gem_object_alloc+0x69/0xaa [drm]\n[    2.112572]  [<f8306853>] ? i915_gem_init_ringbuffer+0x199/0x3de [i915]\n[    2.112572]  [<f82ffa59>] ? i915_driver_load+0x907/0x9da [i915]\n[    2.112572]  [<f82afa14>] ? drm_get_dev+0x2b8/0x395 [drm]\n[    2.112572]  [<f83181fc>] ? i915_pci_probe+0xd/0x8a [i915]\n[    2.112572]  [<c0257c52>] ? local_pci_probe+0xe/0x10\n[    2.112572]  [<c0257dfc>] ? pci_device_probe+0x43/0x66\n[    2.112572]  [<c02aeed2>] ? driver_probe_device+0x79/0xed\n[    2.112572]  [<c02aef89>] ? __driver_attach+0x43/0x5f\n[    2.112572]  [<c02ae766>] ? bus_for_each_dev+0x3d/0x67\n[    2.112572]  [<c02aedab>] ? driver_attach+0x14/0x16\n[    2.112572]  [<c02aef46>] ? __driver_attach+0x0/0x5f\n[    2.112572]  [<c02aeb0b>] ? bus_add_driver+0x8f/0x1bc\n[    2.112572]  [<c02af1b7>] ? driver_register+0x79/0xe0\n[    2.112572]  [<c011eaaf>] ? finish_task_switch+0x56/0x95\n[    2.112572]  [<c02580fe>] ? __pci_register_driver+0x38/0x96\n[    2.112572]  [<f82ac508>] ? drm_init+0x5d/0xb5 [drm]\n[    2.112572]  [<f832a046>] ? i915_init+0x46/0x48 [i915]\n[    2.112572]  [<c010104f>] ? do_one_initcall+0x4a/0x10c\n[    2.112572]  [<f832a000>] ? i915_init+0x0/0x48 [i915]\n[    2.112572]  [<c011f3e1>] ? try_to_wake_up+0x196/0x1a0\n[    2.112572]  [<c011b304>] ? need_resched+0x14/0x1e\n[    2.112572]  [<c0372de9>] ? preempt_schedule+0x3d/0x43\n[    2.112572]  [<c01439db>] ? sys_init_module+0xa7/0x1b8\n[    2.112572]  [<c0102931>] ? syscall_call+0x7/0xb\n[    2.112572] Code:  Bad EIP value.\n[    2.112572] EIP: [<00000000>] 0x0 SS:ESP 0068:f69dfd48\n[    2.112572] CR2: 0000000000000000\n[    2.135981] ---[ end trace f30cb2ef8529a6f3 ]---", "patch": ["commit 54cd2622a50c26fdd0b1ff024263766b1f77ba4f\nAuthor: Daniel Walker <dwalker@fifo99.com>\nDate:   Wed Jul 15 08:52:42 2009 -0700\n\n    gpu: drm: drm_gem: Add a NULL check from kzalloc in drm_gem_object_alloc\n    \n    kzalloc can output NULL, so I've added a check to make sure it's not NULL\n    before we dereference it.\n    \n    Signed-off-by: Daniel Walker <dwalker@fifo99.com>\n\ndiff --git a/drivers/gpu/drm/drm_gem.c b/drivers/gpu/drm/drm_gem.c\nindex 8104eca..c911d6b 100644\n--- a/drivers/gpu/drm/drm_gem.c\n+++ b/drivers/gpu/drm/drm_gem.c\n@@ -134,6 +134,8 @@ drm_gem_object_alloc(struct drm_device *dev, size_t size)\n \tBUG_ON((size & (PAGE_SIZE - 1)) != 0);\n \n \tobj = kzalloc(sizeof(*obj), GFP_KERNEL);\n+\tif (!obj)\n+\t\treturn NULL;\n \n \tobj->dev = dev;\n \tobj->filp = shmem_file_setup(\"drm mm object\", size, VM_NORESERVE);\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Video", "Hardware": "i386 Linux", "Importance": "P2 normal", "Assignee": "Eric Anholt", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2009-07-15 08:05 UTC by mailinglists", "Modified": "2010-09-03 06:22 UTC", "CC List": "9 users", "See Also": "", "Kernel Version": "2.6.31-rc3", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/gpu/drm/drm_gem.c"], "methods": ["drm_gem_object_alloc"]}
{"id": "13761", "title": "kmemleak + BUG: unable to handle kernel paging request", "description": "First I mounted debugfs with \"mount -t debugfs nodev /sys/kernel/debug/\". Then I executed \"echo scan >/sys/kernel/debug/kmemleak\" and \"cat /sys/kernel/debug/kmemleak\" a few times. I get the following message:\n\n\n[ 1649.863693] BUG: unable to handle kernel paging request at 6b6b6b6b\n[ 1649.863706] IP: [<c01b2f95>] kmemleak_seq_next+0x75/0x120\n[ 1649.863718] *pde = 00000000 \n[ 1649.863723] Oops: 0000 [#1] PREEMPT \n[ 1649.863728] last sysfs file: /sys/devices/system/cpu/cpu0/cpuidle/state2/time\n[ 1649.863733] Modules linked in: gspca_sunplus gspca_main videodev v4l1_compat via drm agpgart ppdev lp ipv6 powernow_k8 cpufreq_powersave cpufreq_ondemand cpufreq_userspace cpufreq_conservative leds_clevo_mail led_class snd_via82xx snd_via82xx_modem snd_ac97_codec ac97_bus snd_pcm_oss snd_mixer_oss usbhid snd_pcm snd_mpu401_uart mousedev snd_seq_oss snd_seq_midi pcmcia snd_rawmidi firmware_class snd_seq_midi_event snd_seq snd_timer snd_seq_device serio_raw snd i2c_viapro ide_cd_mod ehci_hcd pcspkr uhci_hcd psmouse k8temp hwmon video backlight 8139too snd_page_alloc cdrom soundcore yenta_socket rsrc_nonstatic usbcore i2c_core nls_base pcmcia_core mii output battery 8250_pnp 8250 rtc_cmos parport_pc serial_core parport rtc_core rtc_lib button thermal processor ac evdev\n[ 1649.863820] \n[ 1649.863825] Pid: 4464, comm: cat Not tainted (2.6.31-rc2 #1) K8N800\n[ 1649.863830] EIP: 0060:[<c01b2f95>] EFLAGS: 00210292 CPU: 0\n[ 1649.863834] EIP is at kmemleak_seq_next+0x75/0x120\n[ 1649.863838] EAX: c7241df0 EBX: 00000000 ECX: 00000000 EDX: 6b6b6b6b\n[ 1649.863842] ESI: e7ea1c70 EDI: c039a168 EBP: db191f1c ESP: db191ef4\n[ 1649.863846]  DS: 007b ES: 007b FS: 0000 GS: 0033 SS: 0068\n[ 1649.863850] Process cat (pid: 4464, ti=db190000 task=e4190620 task.ti=db190000)\n[ 1649.863853] Stack:\n[ 1649.863856]  00000002 00000001 00000000 c01b2f58 00000000 00000002 c7241df0 00000000\n[ 1649.863866] <0> e7ea1c70 c039a168 db191f64 c01d01a3 ee911008 00000cc0 00001000 08051000\n[ 1649.863877] <0> e7e8bc78 e7ea1c98 00000000 00000000 ee911008 00000002 ee911008 0003944e\n[ 1649.863888] Call Trace:\n[ 1649.863895]  [<c01b2f58>] ? kmemleak_seq_next+0x38/0x120\n[ 1649.863902]  [<c01d01a3>] ? seq_read+0x323/0x3d0\n[ 1649.863908]  [<c01b6fe9>] ? vfs_read+0x99/0x160\n[ 1649.863913]  [<c01cfe80>] ? seq_read+0x0/0x3d0\n[ 1649.863919]  [<c01b716d>] ? sys_read+0x3d/0x70\n[ 1649.863925]  [<c0102e44>] ? sysenter_do_call+0x12/0x32\n[ 1649.863928] Code: c0 c7 44 24 0c 58 2f 1b c0 c7 44 24 08 00 00 00 00 c7 44 24 04 01 00 00 00 c7 04 24 02 00 00 00 e8 d1 2e fa ff 8b 45 f0 8b 50 20 <8b> 02 0f 18 00 90 81 fa 60 ad 49 c0 89 d6 c7 45 e8 00 00 00 00 \n[ 1649.863989] EIP: [<c01b2f95>] kmemleak_seq_next+0x75/0x120 SS:ESP 0068:db191ef4\n[ 1649.863996] CR2: 000000006b6b6b6b\n[ 1649.864034] ---[ end trace 1a6e31a050e7af6e ]---\n[ 1649.864040] note: cat[4464] exited with preempt_count 1\n[ 1649.864570] Slab corruption: kmemleak_object start=c7241df0, len=192\n[ 1649.864576] Redzone: 0x9f911029d74e35b/0x9f911029d74e35b.\n[ 1649.864579] Last user: [<c01b30a2>](free_object_rcu+0x62/0x70)\n[ 1649.864589] 000: 01 00 00 00 6b 6b 6b 6b ff ff ff ff ff ff ff ff\n[ 1649.864607] 040: 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b 6c 6b 6b 6b\n[ 1649.864626] Prev obj: start=c7241d18, len=192\n[ 1649.864630] Redzone: 0xd84156c5635688c0/0xd84156c5635688c0.\n[ 1649.864633] Last user: [<c01b4154>](kmemleak_alloc+0x74/0x290)\n[ 1649.864639] 000: 01 00 00 00 ad 4e ad de ff ff ff ff ff ff ff ff\n[ 1649.864656] 010: cc 3a a2 c0 00 00 00 00 31 02 43 c0 01 00 00 00\n[ 1649.864673] Next obj: start=c7241ec8, len=192\n[ 1649.864676] Redzone: 0xd84156c5635688c0/0xd84156c5635688c0.\n[ 1649.864679] Last user: [<c01b4154>](kmemleak_alloc+0x74/0x290)\n[ 1649.864685] 000: 01 00 00 00 ad 4e ad de ff ff ff ff ff ff ff ff\n[ 1649.864702] 010: cc 3a a2 c0 00 00 00 00 31 02 43 c0 01 00 00 00", "patch": ["kmemleak: Do not acquire scan_mutex in kmemleak_open()\n\nFrom: Catalin Marinas <catalin.marinas@arm.com>\n\nInitially, the scan_mutex was acquired in kmemleak_open() and released\nin kmemleak_release() (corresponding to /sys/kernel/debug/kmemleak\noperations). This was causing some lockdep reports when the file was\nclosed from a different task than the one opening it. This patch moves\nthe scan_mutex acquiring in kmemleak_write() or kmemleak_seq_start()\nwith releasing in kmemleak_seq_stop().\n\nSigned-off-by: Catalin Marinas <catalin.marinas@arm.com>\n---\n mm/kmemleak.c |   63 +++++++++++++++++++++++++++------------------------------\n 1 files changed, 30 insertions(+), 33 deletions(-)\n\ndiff --git a/mm/kmemleak.c b/mm/kmemleak.c\nindex 3c2b24c..7cfb7d0 100644\n--- a/mm/kmemleak.c\n+++ b/mm/kmemleak.c\n@@ -1101,6 +1101,11 @@ static void *kmemleak_seq_start(struct seq_file *seq, loff_t *pos)\n {\n \tstruct kmemleak_object *object;\n \tloff_t n = *pos;\n+\tint err;\n+\n+\terr = mutex_lock_interruptible(&scan_mutex);\n+\tif (err < 0)\n+\t\treturn ERR_PTR(err);\n \n \trcu_read_lock();\n \tlist_for_each_entry_rcu(object, &object_list, object_list) {\n@@ -1144,8 +1149,15 @@ static void *kmemleak_seq_next(struct seq_file *seq, void *v, loff_t *pos)\n  */\n static void kmemleak_seq_stop(struct seq_file *seq, void *v)\n {\n-\tif (v)\n-\t\tput_object(v);\n+\tif (!IS_ERR(v)) {\n+\t\t/*\n+\t\t * kmemleak_seq_start may return ERR_PTR if the scan_mutex\n+\t\t * waiting was interrupted, so only release it if !IS_ERR.\n+\t\t */\n+\t\tmutex_unlock(&scan_mutex);\n+\t\tif (v)\n+\t\t\tput_object(v);\n+\t}\n }\n \n /*\n@@ -1172,36 +1184,15 @@ static const struct seq_operations kmemleak_seq_ops = {\n \n static int kmemleak_open(struct inode *inode, struct file *file)\n {\n-\tint ret = 0;\n-\n \tif (!atomic_read(&kmemleak_enabled))\n \t\treturn -EBUSY;\n \n-\tret = mutex_lock_interruptible(&scan_mutex);\n-\tif (ret < 0)\n-\t\tgoto out;\n-\tif (file->f_mode & FMODE_READ) {\n-\t\tret = seq_open(file, &kmemleak_seq_ops);\n-\t\tif (ret < 0)\n-\t\t\tgoto scan_unlock;\n-\t}\n-\treturn ret;\n-\n-scan_unlock:\n-\tmutex_unlock(&scan_mutex);\n-out:\n-\treturn ret;\n+\treturn seq_open(file, &kmemleak_seq_ops);\n }\n \n static int kmemleak_release(struct inode *inode, struct file *file)\n {\n-\tint ret = 0;\n-\n-\tif (file->f_mode & FMODE_READ)\n-\t\tseq_release(inode, file);\n-\tmutex_unlock(&scan_mutex);\n-\n-\treturn ret;\n+\treturn seq_release(inode, file);\n }\n \n /*\n@@ -1221,15 +1212,17 @@ static ssize_t kmemleak_write(struct file *file, const char __user *user_buf,\n {\n \tchar buf[64];\n \tint buf_size;\n-\n-\tif (!atomic_read(&kmemleak_enabled))\n-\t\treturn -EBUSY;\n+\tint ret;\n \n \tbuf_size = min(size, (sizeof(buf) - 1));\n \tif (strncpy_from_user(buf, user_buf, buf_size) < 0)\n \t\treturn -EFAULT;\n \tbuf[buf_size] = 0;\n \n+\tret = mutex_lock_interruptible(&scan_mutex);\n+\tif (ret < 0)\n+\t\treturn ret;\n+\n \tif (strncmp(buf, \"off\", 3) == 0)\n \t\tkmemleak_disable();\n \telse if (strncmp(buf, \"stack=on\", 8) == 0)\n@@ -1242,11 +1235,10 @@ static ssize_t kmemleak_write(struct file *file, const char __user *user_buf,\n \t\tstop_scan_thread();\n \telse if (strncmp(buf, \"scan=\", 5) == 0) {\n \t\tunsigned long secs;\n-\t\tint err;\n \n-\t\terr = strict_strtoul(buf + 5, 0, &secs);\n-\t\tif (err < 0)\n-\t\t\treturn err;\n+\t\tret = strict_strtoul(buf + 5, 0, &secs);\n+\t\tif (ret < 0)\n+\t\t\tgoto out;\n \t\tstop_scan_thread();\n \t\tif (secs) {\n \t\t\tjiffies_scan_wait = msecs_to_jiffies(secs * 1000);\n@@ -1255,7 +1247,12 @@ static ssize_t kmemleak_write(struct file *file, const char __user *user_buf,\n \t} else if (strncmp(buf, \"scan\", 4) == 0)\n \t\tkmemleak_scan();\n \telse\n-\t\treturn -EINVAL;\n+\t\tret = -EINVAL;\n+\n+out:\n+\tmutex_unlock(&scan_mutex);\n+\tif (ret < 0)\n+\t\treturn ret;\n \n \t/* ignore the rest of the buffer, only one command at a time */\n \t*ppos += size;\n", "kmemleak: Protect the seq start/next/stop sequence by rcu_read_lock()\n\nFrom: Catalin Marinas <catalin.marinas@arm.com>\n\nObjects passed to kmemleak_seq_next() have an incremented reference\ncount (hence not freed) but they may point via object_list.next to\nother freed objects. To avoid this, the whole start/next/stop sequence\nmust be protected by rcu_read_lock().\n\nSigned-off-by: Catalin Marinas <catalin.marinas@arm.com>\n---\n mm/kmemleak.c |    4 +---\n 1 files changed, 1 insertions(+), 3 deletions(-)\n\ndiff --git a/mm/kmemleak.c b/mm/kmemleak.c\nindex b2426af..7f33ca9 100644\n--- a/mm/kmemleak.c\n+++ b/mm/kmemleak.c\n@@ -1213,7 +1213,6 @@ static void *kmemleak_seq_start(struct seq_file *seq, loff_t *pos)\n \t}\n \tobject = NULL;\n out:\n-\trcu_read_unlock();\n \treturn object;\n }\n \n@@ -1229,13 +1228,11 @@ static void *kmemleak_seq_next(struct seq_file *seq, void *v, loff_t *pos)\n \n \t++(*pos);\n \n-\trcu_read_lock();\n \tlist_for_each_continue_rcu(n, &object_list) {\n \t\tnext_obj = list_entry(n, struct kmemleak_object, object_list);\n \t\tif (get_object(next_obj))\n \t\t\tbreak;\n \t}\n-\trcu_read_unlock();\n \n \tput_object(prev_obj);\n \treturn next_obj;\n@@ -1251,6 +1248,7 @@ static void kmemleak_seq_stop(struct seq_file *seq, void *v)\n \t\t * kmemleak_seq_start may return ERR_PTR if the scan_mutex\n \t\t * waiting was interrupted, so only release it if !IS_ERR.\n \t\t */\n+\t\trcu_read_unlock();\n \t\tmutex_unlock(&scan_mutex);\n \t\tif (v)\n \t\t\tput_object(v);\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Other", "Classification": "Unclassified", "Component": "Other", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "other_other", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2009-07-11 06:49 UTC by Márton Németh", "Modified": "2012-06-13 13:21 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "2.6.31-rc2", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["mm/kmemleak.c"], "methods": ["kmemleak_write", "kmemleak_open", "kmemleak_seq_stop", "*kmemleak_seq_start"]}
{"id": "13710", "title": "Corrupted low memory after resume", "description": "Created attachment 22215 [details]\ndmesg\n\nIt was tested with latest linux-2.6 git and drm-linux. To make clean test i used test_suspend=mem with acpi_sleep options (s3_bios and/or s3_mode) and without acpi_sleep. Any acpi_sleep option will make my PC freeze. Without acpi_sleep it will resume but with black screen and i can access it with ssh. Disabling kms will resume with black console but Xorg will enable video. \n\nAfter resume dmesg has two traces, memory corruption and warn_slowpath_common:\n\n\n\n[   60.816159] Corrupted low memory at ffff880000004200 (4200 phys) = 00420301\n[   60.816163] ------------[ cut here ]------------\n[   60.816169] WARNING: at arch/x86/kernel/check.c:134 check_for_bios_corruption+0xe4/0xf0()\n[   60.816171] Hardware name:         \n[   60.816172] Memory corruption detected in low memory\n[   60.816173] Modules linked in: binfmt_misc kvm_intel kvm snd_hda_codec_intelhdmi snd_hda_codec_idt snd_hda_intel snd_hda_codec snd_pcm_oss snd_mixer_oss snd_pcm snd_seq_dummy snd_seq_oss snd_seq_midi snd_rawmidi snd_seq_midi_event snd_seq snd_timer snd_seq_device psmouse snd iTCO_wdt iTCO_vendor_support serio_raw soundcore snd_page_alloc e1000e\n[   60.816190] Pid: 9, comm: events/0 Tainted: G        W  2.6.31-rc1-25446-g1ae8c0a #1\n[   60.816192] Call Trace:\n[   60.816196]  [<ffffffff8104a8e8>] warn_slowpath_common+0x78/0xb0\n[   60.816198]  [<ffffffff8104a97c>] warn_slowpath_fmt+0x3c/0x40\n[   60.816200]  [<ffffffff8102aff4>] check_for_bios_corruption+0xe4/0xf0\n[   60.816202]  [<ffffffff8102b000>] ? check_corruption+0x0/0x30\n[   60.816204]  [<ffffffff8102b009>] check_corruption+0x9/0x30\n[   60.816206]  [<ffffffff8105e4d4>] worker_thread+0x144/0x260\n[   60.816209]  [<ffffffff810635c0>] ? autoremove_wake_function+0x0/0x40\n[   60.816211]  [<ffffffff8105e390>] ? worker_thread+0x0/0x260\n[   60.816213]  [<ffffffff810631e6>] kthread+0x96/0xa0\n[   60.816215]  [<ffffffff8100c69a>] child_rip+0xa/0x20\n[   60.816217]  [<ffffffff81063150>] ? kthread+0x0/0xa0\n[   60.816219]  [<ffffffff8100c690>] ? child_rip+0x0/0x20\n[   60.816220] ---[ end trace e934ad520ce5f9cf ]---\n\n\n[   11.621573] PM: resume devices took 5.784 seconds\n[   11.621574] ------------[ cut here ]------------\n[   11.621579] WARNING: at kernel/power/suspend_test.c:52 suspend_test_finish+0x7c/0x80()\n[   11.621580] Hardware name:         \n[   11.621580] Component: resume devices\n[   11.621581] Modules linked in:\n[   11.621583] Pid: 1, comm: swapper Not tainted 2.6.31-rc1-25446-g1ae8c0a #1\n[   11.621585] Call Trace:\n[   11.621589]  [<ffffffff8104a8e8>] warn_slowpath_common+0x78/0xb0\n[   11.621590]  [<ffffffff8104a97c>] warn_slowpath_fmt+0x3c/0x40\n[   11.621592]  [<ffffffff8107ce7c>] suspend_test_finish+0x7c/0x80\n[   11.621594]  [<ffffffff8107cac1>] suspend_devices_and_enter+0xb1/0x210\n[   11.621595]  [<ffffffff8107cd4a>] enter_state+0x12a/0x150\n[   11.621598]  [<ffffffff81377843>] ? rtc_time_to_tm+0xe3/0x1a0\n[   11.621600]  [<ffffffff8107cd8d>] pm_suspend+0x1d/0x30\n[   11.621603]  [<ffffffff81748f83>] test_suspend+0x140/0x1a7\n[   11.621605]  [<ffffffff81748e43>] ? test_suspend+0x0/0x1a7\n[   11.621608]  [<ffffffff8100905b>] do_one_initcall+0x4b/0x190\n[   11.621610]  [<ffffffff8109d802>] ? register_irq_proc+0xe2/0x110\n[   11.621613]  [<ffffffff81140000>] ? load_elf_binary+0x1b0/0x1fe0\n[   11.621616]  [<ffffffff817346ef>] kernel_init+0x169/0x1bf\n[   11.621618]  [<ffffffff8100c69a>] child_rip+0xa/0x20\n[   11.621619]  [<ffffffff81734586>] ? kernel_init+0x0/0x1bf\n[   11.621621]  [<ffffffff8100c690>] ? child_rip+0x0/0x20\n[   11.621622] ---[ end trace e934ad520ce5f9ce ]---", "patch": ["diff --git a/arch/x86/kernel/setup.c b/arch/x86/kernel/setup.c\nindex de2cab1..89d00e2 100644\n--- a/arch/x86/kernel/setup.c\n+++ b/arch/x86/kernel/setup.c\n@@ -672,6 +672,13 @@ static struct dmi_system_id __initdata bad_bios_dmi_table[] = {\n \t\t\tDMI_MATCH(DMI_BIOS_VENDOR, \"Phoenix Technologies\"),\n \t\t},\n \t},\n+        {\n+                .callback = dmi_low_memory_corruption,\n+                .ident = \"Intel BIOS\",\n+                .matches = {\n+                        DMI_MATCH(DMI_BIOS_VENDOR, \"Intel Corp.\"),\n+                },\n+        },\n #endif\n \t{}\n };\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "Power-Sleep-Wake", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Zhang Rui", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2009-07-05 05:37 UTC by Oleksij Rempel", "Modified": "2009-08-30 02:34 UTC", "CC List": "4 users", "See Also": "", "Kernel Version": "2.6.31-rc1", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["arch/x86/kernel/setup.c"], "methods": ["bad_bios_dmi_table"]}
{"id": "13621", "title": "xfs hangs with assertion failed", "": "Show dependency tree", "description": "Mounting external HD is fine, but extensive r/w (rsync) or attempting to unmount the device makes the kernel hang in the following sense: The device keeps mounted, no operations possible, every process accessing the device becomes unkillable. Apparently no major damage to the fs is caused. Log is attached.", "patch": ["commit ff18a82d96026c2fed999e2ccb73a17d8f6b0723\nAuthor: Christoph Hellwig <hch@lst.de>\nDate:   Mon Aug 10 10:40:47 2009 +0200\n\n    [XFS] Replace spin_is_locked due to regression\n    \n    Replace ASSERT(spin_is_locked()) by assert_spin_locked().\n    This fixes bug #13621.\n    \n    Author: Christoph Hellwig <hch@lst.de>\n    Tested-by: Johannes Engel <jcnengel@googlemail.com>\n\ndiff --git a/fs/xfs/xfs_log.c b/fs/xfs/xfs_log.c\nindex 3750f04..9dbdff3 100644\n--- a/fs/xfs/xfs_log.c\n+++ b/fs/xfs/xfs_log.c\n@@ -3180,7 +3180,7 @@ try_again:\n STATIC void\n xlog_state_want_sync(xlog_t *log, xlog_in_core_t *iclog)\n {\n-\tASSERT(spin_is_locked(&log->l_icloglock));\n+\tassert_spin_locked(&log->l_icloglock);\n \n \tif (iclog->ic_state == XLOG_STATE_ACTIVE) {\n \t\txlog_state_switch_iclogs(log, iclog, 0);\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "File System", "Classification": "Unclassified", "Component": "XFS", "Hardware": "All Linux", "Importance": "P1 high", "Assignee": "Christoph Hellwig", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "13070", "Reported": "2009-06-25 10:07 UTC by Johannes Engel", "Modified": "2017-07-23 16:48 UTC", "CC List": "4 users", "See Also": "", "Kernel Version": "2.6.30", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["fs/xfs/xfs_log.c"], "methods": ["xlog_state_want_sync"]}
{"id": "13581", "title": "ath9k doesn't work with newer kernels", "": "Show dependency tree", "description": "Upgrading from 2.6.29 to 2.6.30 the wireless stop working.\nsome infos:\n\n# wpa_supplicant -i wlan0 -D wext -c /etc/wpa_supplicant/wpa_supplicant.conf\nCTRL-EVENT-SCAN-RESULTS                                                     \nTrying to associate with 00:18:84:81:00:fd (SSID='OpenWrt' freq=2452 MHz)   \nAssociation request to the driver failed                                    \nAssociated with 00:18:84:81:00:fd                                           \nCTRL-EVENT-DISCONNECTED - Disconnect event - remove keys                    \nioctl[SIOCSIWENCODEEXT]: No such file or directory                          \nioctl[SIOCSIWSCAN]: Device or resource busy                                 \nFailed to initiate AP scan.                                                 \nAuthentication with 00:00:00:00:00:00 timed out.                            \nCTRL-EVENT-SCAN-RESULTS                                                     \nTrying to associate with 00:18:84:81:00:fd (SSID='OpenWrt' freq=2452 MHz)   \nAssociation request to the driver failed\nAssociated with 00:18:84:81:00:fd\nCTRL-EVENT-DISCONNECTED - Disconnect event - remove keys\nioctl[SIOCSIWENCODEEXT]: No such file or directory\nioctl[SIOCSIWSCAN]: Device or resource busy\nFailed to initiate AP scan.\nAuthentication with 00:00:00:00:00:00 timed out.\n\n# dmesg\ncfg80211: Using static regulatory domain info\ncfg80211: Regulatory domain: US\n        (start_freq - end_freq @ bandwidth), (max_antenna_gain, max_eirp)\n        (2402000 KHz - 2472000 KHz @ 40000 KHz), (600 mBi, 2700 mBm)\n        (5170000 KHz - 5190000 KHz @ 40000 KHz), (600 mBi, 2300 mBm)\n        (5190000 KHz - 5210000 KHz @ 40000 KHz), (600 mBi, 2300 mBm)\n        (5210000 KHz - 5230000 KHz @ 40000 KHz), (600 mBi, 2300 mBm)\n        (5230000 KHz - 5330000 KHz @ 40000 KHz), (600 mBi, 2300 mBm)\n        (5735000 KHz - 5835000 KHz @ 40000 KHz), (600 mBi, 3000 mBm)\ncfg80211: Calling CRDA for country: US\nath9k 0000:03:00.0: PCI INT A -> GSI 17 (level, low) -> IRQ 17\nath9k 0000:03:00.0: setting latency timer to 64\nphy0: Selected rate control algorithm 'ath9k_rate_control'\ncfg80211: Calling CRDA for country: AT\nRegistered led device: ath9k-phy0::radio\nRegistered led device: ath9k-phy0::assoc\nRegistered led device: ath9k-phy0::tx\nRegistered led device: ath9k-phy0::rx\nphy0: Atheros AR5418 MAC/BB Rev:2 AR5133 RF Rev:81: mem=0xffffc200042c0000, irq=17\nADDRCONF(NETDEV_UP): wlan0: link is not ready\nwlan0: authenticate with AP 00:18:84:81:00:fd\nwlan0: authenticated\nwlan0: associate with AP 00:18:84:81:00:fd\nwlan0: RX AssocResp from 00:18:84:81:00:fd (capab=0x431 status=0 aid=3)\nwlan0: associated\nADDRCONF(NETDEV_CHANGE): wlan0: link becomes ready\nwlan0: disassociating by local choice (reason=3)\nwlan0: no IPv6 routers present\nwlan0: authenticate with AP 00:18:84:81:00:fd\nwlan0: authenticated\nwlan0: associate with AP 00:18:84:81:00:fd\nwlan0: RX AssocResp from 00:18:84:81:00:fd (capab=0x431 status=0 aid=3)\nwlan0: associated\nwlan0: disassociating by local choice (reason=3)\nwlan0: authenticate with AP 00:18:84:81:00:fd\nwlan0: authenticated\nwlan0: associate with AP 00:18:84:81:00:fd\nwlan0: RX AssocResp from 00:18:84:81:00:fd (capab=0x431 status=0 aid=3)\nwlan0: associated\nwlan0: disassociating by local choice (reason=3)", "patch": ["From: Yinghai Lu <yinghai@kernel.org>\nSubject: pci: increase alignment to make more space for hidden code\n    \nAs reported in\n\nhttp://bugzilla.kernel.org/show_bug.cgi?id=13940\n\non some system when acpi are enabled, acpi clears some BAR for some\ndevices without reason, and kernel will need to allocate devices for\nthem.  It then apparently hits some undocumented resource conflict,\nresulting in non-working devices.\n\nTry to increase alignment to get more safe range for unassigned devices.\n\nSigned-off-by: Yinghai Lu <yinghai@kernel.org>\nSigned-off-by: Linus Torvalds <torvalds@linux-foundation.org>\n\ndiff --git a/arch/x86/kernel/e820.c b/arch/x86/kernel/e820.c\nindex 85419bb..d17d482 100644\n--- a/arch/x86/kernel/e820.c\n+++ b/arch/x86/kernel/e820.c\n@@ -1378,8 +1378,8 @@ static unsigned long ram_alignment(resource_size_t pos)\n \tif (mb < 16)\n \t\treturn 1024*1024;\n \n-\t/* To 32MB for anything above that */\n-\treturn 32*1024*1024;\n+\t/* To 64MB for anything above that */\n+\treturn 64*1024*1024;\n }\n \n #define MAX_RESOURCE_SIZE ((resource_size_t)-1)\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Networking", "Classification": "Unclassified", "Component": "Wireless", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Luis Chamberlain", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "13070", "Reported": "2009-06-19 12:04 UTC by Matteo Croce", "Modified": "2009-12-29 21:28 UTC", "CC List": "9 users", "See Also": "", "Kernel Version": "2.6.30", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["arch/x86/kernel/e820.c"], "methods": ["ram_alignment"]}
{"id": "13498", "title": "Kernel panic - not syncing: Attepmted to kill init! (Fedora 10)", "description": "Created attachment 21839 [details]\nPanic screen photo\n\nCannot boot Fedora 10 using this and newer kernel versions. Last kernel version working is 2.6.27.5. I have no idea what should I try to make it work....\n\nThis is transcription of the panic screen (see attached photo of CRT):\n\n[<ffffffff811f57df>] driver_register+0xa8/0x113\n[<ffffffff815c5ada>] ? acpi_pci_root_init+0x0/0x28\n[<ffffffff8159f140>] ? early_idt_handler+0x0/0x71\n[<ffffffff811b6195>] acpi_bus_register_driver+0x3e/0x41\n[<ffffffff815c5af3>] acpi_pci_root_init+0x19/0x28\n[<ffffffff8100a047>] do_one_initcall+0x47/0x12e\n[<ffffffff8159f140>] ? early_idt_handler+0x0/0x71\n[<ffffffff81100000>] ? task_statm+0x4e/0x5b\n[<ffffffff8159f70f>] kernel_init+0x1c0/0x214\n[<ffffffff81333489>] ? trace_hardirqs_on_thunk+0x3a/0x3c\n[<ffffffff81011719>] child_rip+0xa/0x11\n[<ffffffff81010a37>] ? restore_args+0x0/0x30\n[<ffffffff8159f54f>] ? kernel_init+0x0/0x214\n[<ffffffff8101170f>] ? child_rip+0x0/0x11\n\nCode: 49 8d 7e 38 49 8d 46 28 49 89 7e 38 49 89 46 28 49 89 46 30 49 89 7e 48 49\n 8b 45 10 48 83 78 38 00 74 32 48 8b 40 10 48 8b 40 38 <48> 8b 98 80 00 00 00 48\n 85 db 75 0d 4c 89 f7 e8 a7 d2 f3 ff e9\nRIP  [<ffffffff8117d603>] pcie_aspm_init_link_state+0x15e/0x65f\n RSP <ffff8800bf699a10>\nCR2: 0000000000000080\n---[ end trace 4eaa2a86a8e2da22 ]---\nKernel panic - not syncing: Attepmted to kill init!", "patch": ["diff --git a/drivers/pci/pcie/aspm.c b/drivers/pci/pcie/aspm.c\nindex b0367f1..777b2c7 100644\n--- a/drivers/pci/pcie/aspm.c\n+++ b/drivers/pci/pcie/aspm.c\n@@ -638,6 +638,10 @@ void pcie_aspm_init_link_state(struct pci_dev *pdev)\n \tif (pdev->pcie_type != PCI_EXP_TYPE_ROOT_PORT &&\n \t\tpdev->pcie_type != PCI_EXP_TYPE_DOWNSTREAM)\n \t\treturn;\n+\t/* VIA has a strange chipset, root port is under a bridge */\n+\tif (pdev->pcie_type == PCI_EXP_TYPE_ROOT_PORT &&\n+\t\tpdev->bus->self)\n+\t\treturn;\n \tdown_read(&pci_bus_sem);\n \tif (list_empty(&pdev->subordinate->devices))\n \t\tgoto out;\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "PCI", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "drivers_pci@kernel-bugs.osdl.org", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2009-06-10 12:05 UTC by Nyyr", "Modified": "2012-06-08 11:47 UTC", "CC List": "3 users", "See Also": "", "Kernel Version": "2.6.27", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/pci/pcie/aspm.c"], "methods": ["pcie_aspm_init_link_state"]}
{"id": "13449", "title": "Battery disappears after suspend/resume on HP laptop.", "description": "Created attachment 21740 [details]\ndmesg after suspend/resume\n\nMy HP Pavilion dv4-1125br suspends and resumes correctly. However, the battery information provided by ACPI disappears.  Before suspend I can get battery information in /proc/acpi/battery/BAT0/state. After the suspend/resume, BAT0/state shows not present.\n\nThis is a fairly recent laptop, and this problem is present in Fedora kernels as early as 2.6.27. I've found bug reports of this issue for Ubunto and Arch Linux, so I don't believe it is Fedora specific.", "patch": ["From e9e371f1686e4a6021a457ef33fbc7c500a0799e Mon Sep 17 00:00:00 2001\nFrom: Gustavo Maciel Dias Vieira <gustavo@sagui.org>\nDate: Mon, 19 Oct 2009 09:41:53 -0200\nSubject: [PATCH 1/1] ACPI: add DMI entry for SCI_EN resume quirk on HP dv4\n\nFixes the missing battery on sleep problem for yet another HP laptop\n(\"HP Pavilion dv4\").\n\nFixes:\n\thttp://bugzilla.kernel.org/show_bug.cgi?id=13449\n\nSigned-off-by: Gustavo Maciel Dias Vieira <gustavo@sagui.org>\n---\n drivers/acpi/sleep.c |    8 ++++++++\n 1 files changed, 8 insertions(+), 0 deletions(-)\n\ndiff --git a/drivers/acpi/sleep.c b/drivers/acpi/sleep.c\nindex a90afcc..ed9760a 100644\n--- a/drivers/acpi/sleep.c\n+++ b/drivers/acpi/sleep.c\n@@ -413,6 +413,14 @@ static struct dmi_system_id __initdata acpisleep_dmi_table[] = {\n \t\t},\n \t},\n \t{\n+\t.callback = init_set_sci_en_on_resume,\n+\t.ident = \"Hewlett-Packard Pavilion dv4\",\n+\t.matches = {\n+\t\tDMI_MATCH(DMI_SYS_VENDOR, \"Hewlett-Packard\"),\n+\t\tDMI_MATCH(DMI_PRODUCT_NAME, \"HP Pavilion dv4\"),\n+\t\t},\n+\t},\n+\t{\n \t.callback = init_old_suspend_ordering,\n \t.ident = \"Panasonic CF51-2L\",\n \t.matches = {\n-- \n1.6.2.5\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "Power-Sleep-Wake", "Hardware": "x86-64 Linux", "Importance": "P1 normal", "Assignee": "acpi_power-sleep-wake", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2009-06-04 01:51 UTC by Gustavo Vieira", "Modified": "2009-11-23 16:41 UTC", "CC List": "5 users", "See Also": "", "Kernel Version": "2.6.30", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/acpi/sleep.c"], "methods": ["acpisleep_dmi_table"]}
{"id": "13394", "title": "check_early_ioremap_leak warning", "description": "Created attachment 21588 [details]\ndmesg containing the warning for some context\n\n------------[ cut here ]------------\nWARNING: at arch/x86/mm/ioremap.c:603 check_early_ioremap_leak+0x48/0x5e()\nHardware name:         \nDebug warning: early ioremap leak of 1 areas detected.\nModules linked in:\nPid: 1, comm: swapper Not tainted 2.6.30-rc6-next-20090521 #3\nCall Trace:\n [<c0120648>] warn_slowpath_common+0x60/0x90\n [<c01206ac>] warn_slowpath_fmt+0x24/0x27\n [<c05d6703>] check_early_ioremap_leak+0x48/0x5e\n [<c0101137>] do_one_initcall+0x4a/0x10c\n [<c05d66bb>] ? check_early_ioremap_leak+0x0/0x5e\n [<c01427d5>] ? register_irq_proc+0x7f/0x9b\n [<c0142844>] ? init_irq_proc+0x53/0x60\n [<c05ca296>] kernel_init+0x102/0x153\n [<c05ca194>] ? kernel_init+0x0/0x153\n [<c01033df>] kernel_thread_helper+0x7/0x10\n---[ end trace 697c170438591ef6 ]---\nplease boot with early_ioremap_debug and report the dmesg.\n\nAnyone know where I'm supposed to put the \"early_ioremap_debug\"?\n\nIf you need more info, lemme know.\n\nThanks everyone :)\n\nChristopher", "patch": ["diff --git a/drivers/acpi/processor_core.c b/drivers/acpi/processor_core.c\nindex 84e0f3c..2f5b339 100644\n--- a/drivers/acpi/processor_core.c\n+++ b/drivers/acpi/processor_core.c\n@@ -1151,6 +1151,8 @@ static int __init acpi_processor_init(void)\n {\n \tint result = 0;\n \n+\tif (acpi_disabled)\n+\t\treturn -ENODEV;\n \tmemset(&errata, 0, sizeof(errata));\n \n #ifdef CONFIG_SMP\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "Other", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Shaohua", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2009-05-27 18:19 UTC by Christopher Dale", "Modified": "2009-08-29 19:02 UTC", "CC List": "5 users", "See Also": "", "Kernel Version": "2.6.30", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/acpi/processor_core.c"], "methods": ["acpi_processor_init"]}
{"id": "13348", "title": "[PATCH]Unable to clone tagged VLAN interface for use with macvlan driver", "description": "It is not possible to make clone of tagged VLAN interface to be used as\nmac-based vlan interfave.\n\nHow reproducible:\nUse any 802.1q tagged vlan interface, e.g. eth2.700 and clone it:\n\n  ip link add link eth2.700 address 00:04:75:cb:38:09 macvlan0 type macvlan\n  ip link set dev macvlan0 up\n  ip addr add 10.195.1.1/24 dev macvlan0\n\nSo far, so good. Now try to ping anything via macvlan0:\n\n  ping 10.195.1.2\n\n\nActual results:\nFor every attempted packet tx kernel writes to console:\n\n------------[ cut here ]------------\nWARNING: at net/8021q/vlan_dev.c:254 vlan_dev_hard_header+0x36/0x126 [8021q]()\nHardware name: M22ES\nModules linked in: arptable_filter arp_tables bridge veth macvlan arc4 ecb ppp_mppe ppp_async crc_ccitt ppp_generic slhc autofs4 sunrpc 8021q garp stp ipt_REJECT nf_conntrack_ipv4 nf_defrag_ipv4 xt_state nf_conntrack xt_tcpudp x_tables dm_mirror dm_region_hash dm_log dm_multipath dm_mod sbs sbshc lp floppy snd_intel8x0 joydev snd_seq_dummy snd_intel8x0m snd_ac97_codec ide_cd_mod ac97_bus snd_seq_oss cdrom snd_seq_midi_event serio_raw snd_seq snd_seq_device snd_pcm_oss snd_mixer_oss parport_pc snd_pcm parport battery 8139cp snd_timer i2c_sis96x ac button snd rtc_cmos rtc_core 8139too soundcore rtc_lib mii i2c_core pcspkr snd_page_alloc pata_sis libata sd_mod scsi_mod ext3 jbd ehci_hcd ohci_hcd uhci_hcd [last unloaded: ip_tables]\nPid: 0, comm: swapper Tainted: G        W  2.6.29.3 #1\nCall Trace:\n [<c0425f48>] warn_slowpath+0x60/0x9f\n [<c0425f6f>] warn_slowpath+0x87/0x9f\n [<dffb850d>] vlan_dev_hard_header+0x0/0x126 [8021q]\n [<dffb8543>] vlan_dev_hard_header+0x36/0x126 [8021q]\n [<dffb850d>] vlan_dev_hard_header+0x0/0x126 [8021q]\n [<df83155d>] macvlan_hard_header+0x3c/0x47 [macvlan]\n [<df831521>] macvlan_hard_header+0x0/0x47 [macvlan]\n [<c062bf3f>] arp_create+0xef/0x1ff\n [<c062c08c>] arp_send+0x3d/0x54\n [<c062c916>] arp_solicit+0x16c/0x177\n [<c05fadd2>] neigh_timer_handler+0x227/0x269\n [<c05fabab>] neigh_timer_handler+0x0/0x269\n [<c042ce4d>] run_timer_softirq+0xf0/0x141\n [<c0429e5a>] __do_softirq+0x76/0xf8\n [<c0429de4>] __do_softirq+0x0/0xf8\n <IRQ>  [<c044fb67>] handle_level_irq+0x0/0xad\n [<c0429db7>] irq_exit+0x35/0x62\n [<c04046bb>] do_IRQ+0xdf/0xf4\n [<c04035a7>] common_interrupt+0x27/0x2c\n [<c04079c5>] default_idle+0x2a/0x3d\n [<c0401bb6>] cpu_idle+0x57/0x70\n---[ end trace 2def39ad9ce2acf6 ]---", "patch": ["--- linux-2.6.29.3/drivers/net/macvlan.c\t2009-05-09 01:47:21.000000000 +0300\n+++ linux-2.6.29.3-macvlan-patch/drivers/net/macvlan.c\t2009-05-20 17:40:29.000000000 +0300\n@@ -311,6 +311,7 @@\n \t\t\t\t  (lowerdev->state & MACVLAN_STATE_MASK);\n \tdev->features \t\t= lowerdev->features & MACVLAN_FEATURES;\n \tdev->iflink\t\t= lowerdev->ifindex;\n+\tdev->hard_header_len \t= lowerdev->hard_header_len;\n \n \tmacvlan_set_lockdep_class(dev);\n \n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Networking", "Classification": "Unclassified", "Component": "IPV4", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Stephen Hemminger", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2009-05-20 00:52 UTC by sg.tweak", "Modified": "2012-06-07 10:57 UTC", "CC List": "4 users", "See Also": "", "Kernel Version": "2.6.29", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/net/macvlan.c"], "methods": ["macvlan_init"]}
{"id": "13313", "title": "vm86old oops", "": "Show dependency tree", "description": "Created attachment 21359 [details]\n.config\n\nHello,\nhardware: ASUS f3jc\nkernel: 2.6.30-rc5-git5\n\nKernel built with\nCONFIG_DEBUG_LOCK_ALLOC=y\nCONFIG_LOCKDEP=y\n\nleads to:\n[   14.816002] general protection fault: 0000 [#1] PREEMPT SMP \n[   14.816073] last sysfs file: /sys/devices/platform/coretemp.1/temp1_input\n[   14.816110] Modules linked in: fuse sbp2 snd_hda_codec_si3054 snd_hda_codec_realtek snd_hda_intel snd_hda_codec snd_pcm serio_raw snd_seq_midi psmouse snd_rawmidi snd_seq_midi_event i2c_i801 snd_seq pcspkr snd_timer snd_seq_device rng_core snd evdev asus_laptop soundcore led_class snd_page_alloc usbhid hid sg sr_mod cdrom sd_mod ata_generic pata_acpi ata_piix ohci1394 libata ehci_hcd uhci_hcd r8169 mii ieee1394 scsi_mod ide_pci_generic usbcore\n[   14.816636] \n[   14.816659] Pid: 2379, comm: vbetool Not tainted (2.6.30-rc5-git5-fb #3) F3JC                \n[   14.816701] EIP: 0060:[<c018c967>] EFLAGS: 00013286 CPU: 0\n[   14.816738] EIP is at lockdep_sys_exit+0x7/0xa0\n[   14.816769] EAX: f60d6000 EBX: f60d7ed4 ECX: 00000000 EDX: 00000000\n[   14.816805] ESI: c06f53c0 EDI: f6ac42b0 EBP: f60d7ec0 ESP: f60d7eac\n[   14.816839]  DS: 007b ES: 007b FS: 00d8 GS: 00e0 SS: 0068\n[   14.816873] Process vbetool (pid: 2379, ti=f60d6000 task=f6ac42b0 task.ti=f60d6000)\n[   14.816910] Stack:\n[   14.816933]  f60d7ec8 c01454cd 00000000 b0c29a68 f60d7ed4 f60d6000 c0128fc8 00000000\n[   14.817024]  00000000 f60d6000 00000000 0000000f 00000000 00000000 00000000 00000000\n[   14.817136]  00004f04 00000000 00000000 00000000 00000000 00000000 0000100a 0000c000\n[   14.817260] Call Trace:\n[   14.817283]  [<c01454cd>] ? copy_vm86_regs_from_user+0x3d/0x60\n[   14.817329]  [<c0128fc8>] ? resume_userspace+0x8/0x28\n[   14.817375]  [<c012918c>] ? syscall_call+0x7/0xb\n[   14.817415] Code: 89 44 24 08 89 5c 24 04 c7 04 24 0d ff 5c c0 e8 20 51 36 00 eb c0 e8 e9 2e fd ff 89 f6 8d bc 27 00 00 00 00 55 89 e5 53 83 ec 10 <65> a1 14 00 00 00 89 45 f8 31 c0 64 8b 1d 20 30 6f c0 8b 93 b0 \n[   14.818042] EIP: [<c018c967>] lockdep_sys_exit+0x7/0xa0 SS:ESP 0068:f60d7eac\n[   14.818136] ---[ end trace 15302304171b6ed3 ]---\n\n\nreproduces with command (for example) \nvbetool vbemode get\n\nstrace (vbetool vbemode get):\nexecve(\"/usr/sbin/vbetool\", [\"vbetool\", \"vbemode\", \"get\"], [/* 38 vars */]) = 0\nbrk(0)                                  = 0x99d5000\naccess(\"/etc/ld.so.nohwcap\", F_OK)      = 0\nmmap2(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0xb8078000\naccess(\"/etc/ld.so.preload\", R_OK)      = -1 ENOENT (No such file or directory)\nopen(\"/etc/ld.so.cache\", O_RDONLY)      = 3\nfstat64(3, {st_mode=S_IFREG|0644, st_size=72327, ...}) = 0\nmmap2(NULL, 72327, PROT_READ, MAP_PRIVATE, 3, 0) = 0xb8066000\nclose(3)                                = 0\naccess(\"/etc/ld.so.nohwcap\", F_OK)      = 0\nopen(\"/usr/lib/libz.so.1\", O_RDONLY)    = 3\nread(3, \"\\177ELF\\1\\1\\1\\0\\0\\0\\0\\0\\0\\0\\0\\0\\3\\0\\3\\0\\1\\0\\0\\0\\260\\30\\0\\0004\\0\\0\\0\"..., 512) = 512\nfstat64(3, {st_mode=S_IFREG|0644, st_size=82160, ...}) = 0\nmmap2(NULL, 84892, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) = 0xb8051000\nmmap2(0xb8065000, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x13) = 0xb8065000\nclose(3)                                = 0\naccess(\"/etc/ld.so.nohwcap\", F_OK)      = 0\nopen(\"/lib/libx86.so.1\", O_RDONLY)      = 3\nread(3, \"\\177ELF\\1\\1\\1\\0\\0\\0\\0\\0\\0\\0\\0\\0\\3\\0\\3\\0\\1\\0\\0\\0\\300\\5\\0\\0004\\0\\0\\0\"..., 512) = 512\nfstat64(3, {st_mode=S_IFREG|0644, st_size=7712, ...}) = 0\nmmap2(NULL, 11884, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) = 0xb804e000\nmmap2(0xb8050000, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x1) = 0xb8050000\nclose(3)                                = 0\naccess(\"/etc/ld.so.nohwcap\", F_OK)      = 0\nopen(\"/usr/lib/libpci.so.3\", O_RDONLY)  = 3\nread(3, \"\\177ELF\\1\\1\\1\\0\\0\\0\\0\\0\\0\\0\\0\\0\\3\\0\\3\\0\\1\\0\\0\\0 \\30\\0\\0004\\0\\0\\0\"..., 512) = 512\nfstat64(3, {st_mode=S_IFREG|0644, st_size=39052, ...}) = 0\nmmap2(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0xb804d000\nmmap2(NULL, 37824, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) = 0xb8043000\nmmap2(0xb804c000, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x9) = 0xb804c000\nclose(3)                                = 0\naccess(\"/etc/ld.so.nohwcap\", F_OK)      = 0\nopen(\"/lib/libc.so.6\", O_RDONLY)        = 3\nread(3, \"\\177ELF\\1\\1\\1\\0\\0\\0\\0\\0\\0\\0\\0\\0\\3\\0\\3\\0\\1\\0\\0\\0\\320h\\1\\0004\\0\\0\\0\"..., 512) = 512\nfstat64(3, {st_mode=S_IFREG|0755, st_size=1310924, ...}) = 0\nmmap2(NULL, 1316432, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) = 0xb7f01000\nmmap2(0xb803d000, 12288, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x13c) = 0xb803d000\nmmap2(0xb8040000, 9808, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) = 0xb8040000\nclose(3)                                = 0\naccess(\"/etc/ld.so.nohwcap\", F_OK)      = 0\nopen(\"/lib/libresolv.so.2\", O_RDONLY)   = 3\nread(3, \"\\177ELF\\1\\1\\1\\0\\0\\0\\0\\0\\0\\0\\0\\0\\3\\0\\3\\0\\1\\0\\0\\0@&\\0\\0004\\0\\0\\0\"..., 512) = 512\nfstat64(3, {st_mode=S_IFREG|0644, st_size=71376, ...}) = 0\nmmap2(NULL, 84036, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) = 0xb7eec000\nmmap2(0xb7efd000, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x10) = 0xb7efd000\nmmap2(0xb7eff000, 6212, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) = 0xb7eff000\nclose(3)                                = 0\nmmap2(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0xb7eeb000\nset_thread_area({entry_number:-1 -> 6, base_addr:0xb7eeb6c0, limit:1048575, seg_32bit:1, contents:0, read_exec_only:0, limit_in_pages:1, seg_not_present:0, us\neable:1}) = 0\nopen(\"/dev/urandom\", O_RDONLY)          = 3\nread(3, \"Y9e\\332\", 4)                   = 4\nclose(3)                                = 0\nmprotect(0xb7efd000, 4096, PROT_READ)   = 0\nmprotect(0xb803d000, 8192, PROT_READ)   = 0\nmprotect(0xb8096000, 4096, PROT_READ)   = 0\nmunmap(0xb8066000, 72327)               = 0\nopen(\"/dev/zero\", O_RDWR)               = 3\nmmap2(0x1000, 655360, PROT_READ|PROT_WRITE|PROT_EXEC, MAP_SHARED|MAP_FIXED, 3, 0) = 0x1000\nclose(3)                                = 0\nopen(\"/dev/mem\", O_RDWR)                = 3\nmmap2(NULL, 1282, PROT_READ|PROT_WRITE|PROT_EXEC, MAP_SHARED|MAP_FIXED, 3, 0) = 0\nmmap2(0xa0000, 393216, PROT_READ|PROT_WRITE|PROT_EXEC, MAP_SHARED|MAP_FIXED, 3, 0xa0) = 0xa0000\nclose(3)                                = 0\niopl(0x3)                               = 0\nbrk(0)                                  = 0x99d5000\nbrk(0x99f6000)                          = 0x99f6000\naccess(\"/sys/bus/pci\", R_OK)            = 0\nvm86old(0xb8050dcc <unfinished ...>\n+++ killed by SIGSEGV +++\n\nSergey", "patch": ["Return-Path: <hpa@hera.kernel.org>\nReceived: from hera.kernel.org (IDENT:U2FsdGVkX1+6OVESrxMDYU+ZvvbuftWJE+AIEzo9itw@hera.kernel.org [140.211.167.34])\n\tby terminus.zytor.com (8.14.3/8.14.2) with ESMTP id n57EhL9v004901\n\t(version=TLSv1/SSLv3 cipher=DHE-RSA-AES256-SHA bits=256 verify=NO)\n\tfor <hpa@zytor.com>; Sun, 7 Jun 2009 07:44:52 -0700\nReceived: from hera.kernel.org (IDENT:U2FsdGVkX18/8SIx5nLVyoC+N0KwQSCPmMSnIz9Vhh4@localhost [127.0.0.1])\n\tby hera.kernel.org (8.14.2/8.14.2) with ESMTP id n57EgY47016464\n\t(version=TLSv1/SSLv3 cipher=DHE-RSA-AES256-SHA bits=256 verify=NO);\n\tSun, 7 Jun 2009 14:42:34 GMT\nReceived: (from hpa@localhost)\n\tby hera.kernel.org (8.14.2/8.13.1/Submit) id n57EgXct016461;\n\tSun, 7 Jun 2009 14:42:33 GMT\nDate: Sun, 7 Jun 2009 14:42:33 GMT\nFrom: tip-bot for Lubomir Rintel <lkundrak@v3.sk>\nTo: linux-tip-commits@vger.kernel.org\nCc: linux-kernel@vger.kernel.org, hpa@zytor.com, mingo@redhat.com,\n        tglx@linutronix.de, mingo@elte.hu, lkundrak@v3.sk\nReply-To: mingo@redhat.com, hpa@zytor.com, linux-kernel@vger.kernel.org,\n        tglx@linutronix.de, lkundrak@v3.sk, mingo@elte.hu\nIn-Reply-To: <1244384628.2323.4.camel@bimbo>\nReferences: <1244384628.2323.4.camel@bimbo>\nSubject: [tip:x86/urgent] x86: Fix non-lazy GS handling in sys_vm86()\nMessage-ID: <tip-3aa6b186f86c5d06d6d92d14311ffed51f091f40@git.kernel.org>\nGit-Commit-ID: 3aa6b186f86c5d06d6d92d14311ffed51f091f40\nX-Mailer: tip-git-log-daemon\nMIME-Version: 1.0\nContent-Type: text/plain; charset=UTF-8\nContent-Disposition: inline\nPrecedence: bulk\nX-Virus-Scanned: ClamAV 0.94.2/9435/Sat Jun  6 18:32:44 2009 on terminus.zytor.com\nX-Virus-Scanned: ClamAV 0.93.3/9435/Sun Jun  7 01:32:44 2009 on hera.kernel.org\nX-Virus-Status: Clean\nX-Spam-Status: No, score=-2.0 required=5.0 tests=BAYES_00,SARE_MSGID_LONG40,\n\tUNPARSEABLE_RELAY autolearn=no version=3.2.5\nX-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on terminus.zytor.com\nX-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.1.1 (terminus.zytor.com [198.137.202.10]); Sun, 07 Jun 2009 07:45:13 -0700 (PDT)\nX-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.0 (hera.kernel.org [127.0.0.1]); Sun, 07 Jun 2009 14:42:47 +0000 (UTC)\n\nCommit-ID:  3aa6b186f86c5d06d6d92d14311ffed51f091f40\nGitweb:     http://git.kernel.org/tip/3aa6b186f86c5d06d6d92d14311ffed51f091f40\nAuthor:     Lubomir Rintel <lkundrak@v3.sk>\nAuthorDate: Sun, 7 Jun 2009 16:23:48 +0200\nCommitter:  Ingo Molnar <mingo@elte.hu>\nCommitDate: Sun, 7 Jun 2009 16:31:23 +0200\n\nx86: Fix non-lazy GS handling in sys_vm86()\n\nThis fixes a stack corruption panic or null dereference oops\ndue to a bad GS in resume_userspace() when returning from\nsys_vm86() and calling lockdep_sys_exit().\n\nOnly a problem when CONFIG_LOCKDEP and CONFIG_CC_STACKPROTECTOR\nenabled.\n\nSigned-off-by: Lubomir Rintel <lkundrak@v3.sk>\nCc: H. Peter Anvin <hpa@zytor.com>\nLKML-Reference: <1244384628.2323.4.camel@bimbo>\nSigned-off-by: Ingo Molnar <mingo@elte.hu>\n\n\n---\n arch/x86/kernel/vm86_32.c |    9 +++++----\n 1 files changed, 5 insertions(+), 4 deletions(-)\n\ndiff --git a/arch/x86/kernel/vm86_32.c b/arch/x86/kernel/vm86_32.c\nindex d7ac84e..6a17769 100644\n--- a/arch/x86/kernel/vm86_32.c\n+++ b/arch/x86/kernel/vm86_32.c\n@@ -287,10 +287,9 @@ static void do_sys_vm86(struct kernel_vm86_struct *info, struct task_struct *tsk\n \tinfo->regs.pt.ds = 0;\n \tinfo->regs.pt.es = 0;\n \tinfo->regs.pt.fs = 0;\n-\n-/* we are clearing gs later just before \"jmp resume_userspace\",\n- * because it is not saved/restored.\n- */\n+#ifndef CONFIG_X86_32_LAZY_GS\n+\tinfo->regs.pt.gs = 0;\n+#endif\n \n /*\n  * The flags register is also special: we cannot trust that the user\n@@ -343,7 +342,9 @@ static void do_sys_vm86(struct kernel_vm86_struct *info, struct task_struct *tsk\n \t__asm__ __volatile__(\n \t\t\"movl %0,%%esp\\n\\t\"\n \t\t\"movl %1,%%ebp\\n\\t\"\n+#ifdef CONFIG_X86_32_LAZY_GS\n \t\t\"mov  %2, %%gs\\n\\t\"\n+#endif\n \t\t\"jmp resume_userspace\"\n \t\t: /* no outputs */\n \t\t:\"r\" (&info->regs), \"r\" (task_thread_info(tsk)), \"r\" (0));\n"], "Status": "CLOSED CODE_FIX", "Alias": "vm86old", "Product": "Platform Specific/Hardware", "Classification": "Unclassified", "Component": "i386", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "platform_i386", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "13070", "Reported": "2009-05-14 21:53 UTC by Sergey Senozhatsky", "Modified": "2009-06-11 13:14 UTC", "CC List": "5 users", "See Also": "", "Kernel Version": "2.6.30", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["arch/x86/kernel/vm86_32.c"], "methods": ["do_sys_vm86"]}
{"id": "13250", "title": "Side channel of Intel HDA chip doesn't work anymore, did work with 2.6.29", "": "Show dependency tree", "description": "The ALSA mixer is now missing the side channel, which was present and did work with the previous kernel. I also have a ATI graphics card with HDA chip which I don't use for audio in that machine.\n\nlspci:\n\n00:1b.0 Audio device: Intel Corporation 82801H (ICH8 Family) HD Audio Controller (rev 02)\n\tSubsystem: Intel Corporation Device 2504\n\tFlags: bus master, fast devsel, latency 0, IRQ 22\n\tMemory at d0220000 (64-bit, non-prefetchable) [size=16K]\n\tCapabilities: <access denied>\n\tKernel driver in use: HDA Intel\n\tKernel modules: snd-hda-intel", "patch": ["diff --git a/sound/pci/hda/patch_sigmatel.c b/sound/pci/hda/patch_sigmatel.c\nindex 03b3646..d2fd8ef 100644\n--- a/sound/pci/hda/patch_sigmatel.c\n+++ b/sound/pci/hda/patch_sigmatel.c\n@@ -150,6 +150,7 @@ enum {\n \tSTAC_D965_REF,\n \tSTAC_D965_3ST,\n \tSTAC_D965_5ST,\n+\tSTAC_D965_5ST_NO_FP,\n \tSTAC_DELL_3ST,\n \tSTAC_DELL_BIOS,\n \tSTAC_927X_MODELS\n@@ -2154,6 +2155,13 @@ static unsigned int d965_5st_pin_configs[14] = {\n \t0x40000100, 0x40000100\n };\n \n+static unsigned int d965_5st_no_fp_pin_configs[14] = {\n+\t0x40000100, 0x40000100, 0x0181304e, 0x01014010,\n+\t0x01a19040, 0x01011012, 0x01016011, 0x40000100,\n+\t0x40000100, 0x40000100, 0x40000100, 0x01442070,\n+\t0x40000100, 0x40000100\n+};\n+\n static unsigned int dell_3st_pin_configs[14] = {\n \t0x02211230, 0x02a11220, 0x01a19040, 0x01114210,\n \t0x01111212, 0x01116211, 0x01813050, 0x01112214,\n@@ -2166,6 +2174,7 @@ static unsigned int *stac927x_brd_tbl[STAC_927X_MODELS] = {\n \t[STAC_D965_REF]  = ref927x_pin_configs,\n \t[STAC_D965_3ST]  = d965_3st_pin_configs,\n \t[STAC_D965_5ST]  = d965_5st_pin_configs,\n+\t[STAC_D965_5ST_NO_FP]  = d965_5st_no_fp_pin_configs,\n \t[STAC_DELL_3ST]  = dell_3st_pin_configs,\n \t[STAC_DELL_BIOS] = NULL,\n };\n@@ -2176,6 +2185,7 @@ static const char *stac927x_models[STAC_927X_MODELS] = {\n \t[STAC_D965_REF]\t\t= \"ref\",\n \t[STAC_D965_3ST]\t\t= \"3stack\",\n \t[STAC_D965_5ST]\t\t= \"5stack\",\n+\t[STAC_D965_5ST_NO_FP]\t= \"5stack-no-fp\",\n \t[STAC_DELL_3ST]\t\t= \"dell-3stack\",\n \t[STAC_DELL_BIOS]\t= \"dell-bios\",\n };\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Sound", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Jaroslav Kysela", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "13070", "Reported": "2009-05-05 10:14 UTC by Andreas Juch", "Modified": "2009-05-30 21:35 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "2.6.30-rc3", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["sound/pci/hda/patch_sigmatel.c"], "methods": ["*stac927x_brd_tbl", "*stac927x_models"]}
{"id": "13232", "title": "ext3/4 with synchronous writes gets wedged by Postfix", "": "Show dependency tree", "description": "Latest working kernel version: 2.6.28.9\nEarliest failing kernel version: 2.6.29\nDistribution: Ubuntu 8.04 LTS\nHardware Environment: Intel 875p chipset (ICH5), P4 with HT\nSoftware Environment: Postfix 2.5.1-2ubuntu1.2\n\nProblem Description:\n\nWith its queue directory on an ext3 or journalled ext4 file\nsystem, mounted with the 'sync' option (or with the 'S' attribute\non the individual queue directories, which is a config option for\nthe Ubuntu package), sending more than a few messages in quick\nsuccession through Postfix causes Postfix and any other process\nattempting to modify the file system afterwards (e.g. by updating\nthe atime when listing a directory) to hang in uninterruptible\nsleep.  sync(1) will also hang afterwards.  If the FS is mounted\nnoatime, it is still possible to read from it, although trying to\nlist the affected queue directories still causes ls to hang (the\nlist of affected directories seems to vary, but may include at\nleast \"active\" and \"maildrop\").\n\nThis happens whether the filesystem is on a hard disk or a RAM\ndisk (/dev/ramX, not tmpfs).  Enabling or disabling barriers, or\nchanging the journalling mode doesn't help.\n\nExt2 seems to be unaffected, as does non-journalled ext4.  XFS,\nReiser and JFS are also fine.  The hang doesn't occur if the\nqueue directories have the 'D' attribute (and a non-sync mount)\ninstead of 'S'.\n\nNothing appears in dmesg at the time of the hang, but here's the\noutput from SysRq-W afterwards (ext3 FS, kernel 2.6.29.2,\nnon-SMP, PREEMPT_NONE):\n\nSysRq : Show Blocked State\n  task                PC stack   pid father\nkjournald     D c01384df     0  2525      2\n cfcb5f0c 00000082 de27d500 c01384df cfcb5ef4 c02cb5c0 00000001 de32ca00\n de324814 dd037ebc de324814 de324934 dd037ebc cfcb5f5c cfcb5f90 c01bd4bb\n 00000046 c0424110 de324a0c de324814 de324800 00000000 00000002 dd037e80\nCall Trace:\n [<c01384df>] ? trace_hardirqs_on+0xb/0xd\n [<c01bd4bb>] journal_commit_transaction+0xea/0xeaf\n [<c02c534a>] ? _spin_unlock_irqrestore+0x38/0x3f\n [<c0138489>] ? trace_hardirqs_on_caller+0x145/0x190\n [<c012b6ee>] ? autoremove_wake_function+0x0/0x38\n [<c0122a25>] ? del_timer+0x50/0x59\n [<c01c0c75>] kjournald+0xad/0x1bb\n [<c012b6ee>] ? autoremove_wake_function+0x0/0x38\n [<c01c0bc8>] ? kjournald+0x0/0x1bb\n [<c012b442>] kthread+0x37/0x59\n [<c012b40b>] ? kthread+0x0/0x59\n [<c0103667>] kernel_thread_helper+0x7/0x10\npickup        D c01384df     0  2597   2594\n cfaa9e5c 00000086 df9faa80 c01384df cfaa9e44 00000282 cfaa9e74 de32ca00\n cfaa9e5c c012b8b7 00000002 de324800 0000014f cfaa9e74 cfaa9e94 c01c0539\n 00000000 de3248c8 de324910 de324814 00000000 df9faa80 c012b6ee de3248e4\nCall Trace:\n [<c01384df>] ? trace_hardirqs_on+0xb/0xd\n [<c012b8b7>] ? prepare_to_wait+0x42/0x4a\n [<c01c0539>] log_wait_commit+0x90/0xf7\n [<c012b6ee>] ? autoremove_wake_function+0x0/0x38\n [<c01bba9d>] journal_stop+0x1c8/0x288\n [<c01b4236>] __ext3_journal_stop+0x1c/0x38\n [<c01aeb96>] ext3_delete_inode+0x90/0xc2\n [<c01aeb06>] ? ext3_delete_inode+0x0/0xc2\n [<c017ab82>] generic_delete_inode+0x72/0x100\n [<c02c4ee1>] ? _spin_lock+0x3a/0x40\n [<c017ad4c>] generic_drop_inode+0x13c/0x1da\n [<c01d4068>] ? _atomic_dec_and_lock+0x10/0x38\n [<c017a4e7>] iput+0x47/0x4e\n [<c0173db0>] do_unlinkat+0xc1/0x137\n [<c0102f87>] ? sysenter_exit+0xf/0x18\n [<c0138489>] ? trace_hardirqs_on_caller+0x145/0x190\n [<c0173e36>] sys_unlink+0x10/0x12\n [<c0102f55>] sysenter_do_call+0x12/0x35\nqmgr          D c01384df     0  2598   2594\n cfe23e60 00000082 df9fa200 c01384df cfe23e48 c02cb5c0 cfe23e78 de32cf00\n cfe23e60 c012b8b7 00000002 de324800 0000014f cfe23e78 cfe23e98 c01c0539\n 00000000 de3248c8 de324910 de324814 00000000 df9fa200 c012b6ee cfaa9e80\nCall Trace:\n [<c01384df>] ? trace_hardirqs_on+0xb/0xd\n [<c012b8b7>] ? prepare_to_wait+0x42/0x4a\n [<c01c0539>] log_wait_commit+0x90/0xf7\n [<c012b6ee>] ? autoremove_wake_function+0x0/0x38\n [<c01bba9d>] journal_stop+0x1c8/0x288\n [<c01ac11e>] ? ext3_mark_iloc_dirty+0x1d8/0x34b\n [<c01b4236>] __ext3_journal_stop+0x1c/0x38\n [<c01b309d>] ext3_unlink+0x70/0x157\n [<c0172344>] ? vfs_unlink+0x45/0xb0\n [<c0172358>] vfs_unlink+0x59/0xb0\n [<c0173e17>] do_unlinkat+0x128/0x137\n [<c0102f87>] ? sysenter_exit+0xf/0x18\n [<c0138489>] ? trace_hardirqs_on_caller+0x145/0x190\n [<c0173e36>] sys_unlink+0x10/0x12\n [<c0102f55>] sysenter_do_call+0x12/0x35\nlocal         D c01384df     0  2654   2594\n de369c74 00000096 df9f8880 c01384df de369c5c 00000286 00000000 de183b80\n de324814 de324800 de324814 dd037e80 de324800 de324880 de369cc4 c01bc306\n c0138489 00000246 00000046 00000001 de324a0c de324814 de324814 df59c060\nCall Trace:\n [<c01384df>] ? trace_hardirqs_on+0xb/0xd\n [<c01bc306>] start_this_handle+0x1c2/0x361\n [<c0138489>] ? trace_hardirqs_on_caller+0x145/0x190\n [<c012b6ee>] ? autoremove_wake_function+0x0/0x38\n [<c01bc54a>] journal_start+0xa5/0x100\n [<c01b43ac>] ext3_journal_start_sb+0x48/0x4d\n [<c01aec4c>] ext3_write_begin+0x84/0x1c6\n [<c0139fe2>] ? __lock_acquire+0x32b/0xa21\n [<c014749e>] generic_file_buffered_write+0xe1/0x292\n [<c0147a94>] __generic_file_aio_write_nolock+0x25c/0x4ab\n [<c0138489>] ? trace_hardirqs_on_caller+0x145/0x190\n [<c0147f63>] generic_file_aio_write+0x66/0xda\n [<c0138f6b>] ? validate_chain+0x3f5/0x1141\n [<c01aad03>] ext3_file_write+0x27/0xa8\n [<c016a972>] do_sync_write+0xcc/0x102\n [<c012b6ee>] ? autoremove_wake_function+0x0/0x38\n [<c016b16d>] vfs_write+0x8b/0x11f\n [<c0102f87>] ? sysenter_exit+0xf/0x18\n [<c016a8a6>] ? do_sync_write+0x0/0x102\n [<c016b577>] sys_write+0x3d/0x64\n [<c0102f55>] sysenter_do_call+0x12/0x35\npostdrop      D c01384df     0  2664   2663\n cfcbfd6c 00000086 dd13f700 c01384df cfcbfd54 c02cb5c0 00000001 deedc780\n c03a1690 c1402348 c03a1690 cfcbfd7c c1402348 cfcbfd90 cfcbfd9c c017a55b\n dd758c48 00000007 00000000 dd13f700 c012b726 c1402364 c1402364 00152b13\nCall Trace:\n [<c01384df>] ? trace_hardirqs_on+0xb/0xd\n [<c017a55b>] __wait_on_freeing_inode+0x6d/0x88\n [<c012b726>] ? wake_bit_function+0x0/0x47\n [<c017a5b5>] find_inode_fast+0x3f/0x4a\n [<c017ba05>] insert_inode_locked+0x50/0xeb\n [<c01ab90b>] ext3_new_inode+0x738/0x88f\n [<c01bc550>] ? journal_start+0xab/0x100\n [<c01b259a>] ext3_create+0x59/0xbf\n [<c01722c4>] vfs_create+0x75/0xb0\n [<c02c4dda>] ? _spin_unlock+0x1d/0x20\n [<c01b2541>] ? ext3_create+0x0/0xbf\n [<c0174bc3>] do_filp_open+0x644/0x713\n [<c02c4dda>] ? _spin_unlock+0x1d/0x20\n [<c01692ce>] do_sys_open+0x45/0xce\n [<c0102f87>] ? sysenter_exit+0xf/0x18\n [<c0138489>] ? trace_hardirqs_on_caller+0x145/0x190\n [<c01693a3>] sys_open+0x23/0x2b\n [<c0102f55>] sysenter_do_call+0x12/0x35\nSched Debug Version: v0.08, 2.6.29.2-test #1\nnow at 166155.025991 msecs\n  .sysctl_sched_latency                    : 20.000000\n  .sysctl_sched_min_granularity            : 4.000000\n  .sysctl_sched_wakeup_granularity         : 5.000000\n  .sysctl_sched_child_runs_first           : 0.000001\n  .sysctl_sched_features                   : 24191\n\ncpu#0, 2798.181 MHz\n  .nr_running                    : 2\n  .load                          : 2048\n  .nr_switches                   : 284843\n  .nr_load_updates               : 6497\n  .nr_uninterruptible            : 5\n  .jiffies                       : 4294953911\n  .next_balance                  : 0.000000\n  .curr->pid                     : 2466\n  .clock                         : 166154.370058\n  .cpu_load[0]                   : 0\n  .cpu_load[1]                   : 4\n  .cpu_load[2]                   : 76\n  .cpu_load[3]                   : 160\n  .cpu_load[4]                   : 196\n\ncfs_rq[0]:\n  .exec_clock                    : 0.000000\n  .MIN_vruntime                  : 24407.116340\n  .min_vruntime                  : 24407.114218\n  .max_vruntime                  : 24407.116340\n  .spread                        : 0.000000\n  .spread0                       : 0.000000\n  .nr_running                    : 2\n  .load                          : 2048\n  .nr_spread_over                : 0\n\nrt_rq[0]:\n  .rt_nr_running                 : 0\n  .rt_throttled                  : 0\n  .rt_time                       : 0.000000\n  .rt_runtime                    : 950.000000\n\nrunnable tasks:\n            task   PID         tree-key  switches  prio     exec-runtime         sum-exec        sum-sleep\n----------------------------------------------------------------------------------------------------------\n            Xorg  2163     24407.116340     28791   120               0               0               0.000000               0.000000               0.000000\nR           bash  2466     24387.418829       274   120               0               0               0.000000               0.000000               0.000000\n\n\nSteps to reproduce:\n\n# mount -o remount,sync /var\n  (or wherever queue_directory points to in the Postfix config)\n\n# while true; do sendmail testaddr@localhost </dev/null; done", "patch": ["fs: Tentative patch to fix kernel bugzilla #13232.\n\nFrom: Al Viro <viro@ZenIV.linux.org.uk>\n\nReviewed-by: \"Theodore Ts'o\" <tytso@mit.edu>\nAcked-by: Jan Kara <jack@suse.cz>\n\ndiff --git a/fs/inode.c b/fs/inode.c\nindex 9d26490..4406952 100644\n--- a/fs/inode.c\n+++ b/fs/inode.c\n@@ -1053,13 +1053,22 @@ int insert_inode_locked(struct inode *inode)\n \tstruct super_block *sb = inode->i_sb;\n \tino_t ino = inode->i_ino;\n \tstruct hlist_head *head = inode_hashtable + hash(sb, ino);\n-\tstruct inode *old;\n \n \tinode->i_state |= I_LOCK|I_NEW;\n \twhile (1) {\n+\t\tstruct hlist_node *node;\n+\t\tstruct inode *old = NULL;\n \t\tspin_lock(&inode_lock);\n-\t\told = find_inode_fast(sb, head, ino);\n-\t\tif (likely(!old)) {\n+\t\thlist_for_each_entry(old, node, head, i_hash) {\n+\t\t\tif (old->i_ino != ino)\n+\t\t\t\tcontinue;\n+\t\t\tif (old->i_sb != sb)\n+\t\t\t\tcontinue;\n+\t\t\tif (old->i_state & (I_FREEING|I_CLEAR|I_WILL_FREE))\n+\t\t\t\tcontinue;\n+\t\t\tbreak;\n+\t\t}\n+\t\tif (likely(!node)) {\n \t\t\thlist_add_head(&inode->i_hash, head);\n \t\t\tspin_unlock(&inode_lock);\n \t\t\treturn 0;\n@@ -1081,14 +1090,24 @@ int insert_inode_locked4(struct inode *inode, unsigned long hashval,\n {\n \tstruct super_block *sb = inode->i_sb;\n \tstruct hlist_head *head = inode_hashtable + hash(sb, hashval);\n-\tstruct inode *old;\n \n \tinode->i_state |= I_LOCK|I_NEW;\n \n \twhile (1) {\n+\t\tstruct hlist_node *node;\n+\t\tstruct inode *old = NULL;\n+\n \t\tspin_lock(&inode_lock);\n-\t\told = find_inode(sb, head, test, data);\n-\t\tif (likely(!old)) {\n+\t\thlist_for_each_entry(old, node, head, i_hash) {\n+\t\t\tif (old->i_sb != sb)\n+\t\t\t\tcontinue;\n+\t\t\tif (!test(old, data))\n+\t\t\t\tcontinue;\n+\t\t\tif (old->i_state & (I_FREEING|I_CLEAR|I_WILL_FREE))\n+\t\t\t\tcontinue;\n+\t\t\tbreak;\n+\t\t}\n+\t\tif (likely(!node)) {\n \t\t\thlist_add_head(&inode->i_hash, head);\n \t\t\tspin_unlock(&inode_lock);\n \t\t\treturn 0;\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "File System", "Classification": "Unclassified", "Component": "ext3", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "fs_ext3@kernel-bugs.osdl.org", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "12398", "Reported": "2009-05-03 19:46 UTC by David Watson", "Modified": "2009-06-07 20:44 UTC", "CC List": "5 users", "See Also": "", "Kernel Version": "2.6.29", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["fs/inode.c"], "methods": ["insert_inode_locked", "insert_inode_locked4"]}
{"id": "13134", "title": "ALPS Touchpad not getting recognized anymore", "description": "Created attachment 21037 [details]\ndmesg with i8042.debug kernel option\n\nI'm using an ALPS Touchpad in my Toshiba Satellite Pro M10.\n\"Advanced features\" in X like vertical/horizontal scrolling don't work\nbecause kernel doesn't recognize the mouse as a touchpad but as a \"PS/2\nGeneric Mouse\". I've looked in launchpad/google/debian bugtrack systems\nand this problem affects a lot of distros/hardware. All points it's a\nproblem with the input subsystem. I've seen reports of people that say\nadding i8042.nomux=1 on boot fixes it for them. It doesn't for me. It's\nnot a hardware error (at least in my case) because touchpad works\nflawless in windows.", "patch": ["Input: ALPS - add signature for Toshiba Satellite Pro M10\n\nThis toshiba has a touchpad with trackpoint and 2 sets of left\nand right buttons (above and below touchpad).\n\nSigned-off-by: Dmitry Torokhov <dtor@mail.ru>\n---\n\n drivers/input/mouse/alps.c |    1 +\n 1 files changed, 1 insertions(+), 0 deletions(-)\n\n\ndiff --git a/drivers/input/mouse/alps.c b/drivers/input/mouse/alps.c\nindex cbedf95..daecc75 100644\n--- a/drivers/input/mouse/alps.c\n+++ b/drivers/input/mouse/alps.c\n@@ -37,6 +37,7 @@\n #define ALPS_FW_BK_2\t0x40\n \n static const struct alps_model_info alps_model_data[] = {\n+\t{ { 0x32, 0x02, 0x14 },\t0xf8, 0xf8, ALPS_PASS | ALPS_DUALPOINT }, /* Toshiba Salellite Pro M10 */\n \t{ { 0x33, 0x02, 0x0a },\t0x88, 0xf8, ALPS_OLDPROTO },\t\t/* UMAX-530T */\n \t{ { 0x53, 0x02, 0x0a },\t0xf8, 0xf8, 0 },\n \t{ { 0x53, 0x02, 0x14 },\t0xf8, 0xf8, 0 },\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Input Devices", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Dmitry Torokhov", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2009-04-18 01:30 UTC by Pablo López Martín", "Modified": "2009-10-20 05:20 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "2.6.29", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/input/mouse/alps.c"], "methods": ["alps_model_data"]}
{"id": "12971", "title": "\"tg3 transmit timed out\" when transmitting at high bitrate", "": "Show dependency tree", "description": "I have laptop - HP compaq 6715s with broadcom lan card (from lspci):\n10:00.0 Ethernet controller: Broadcom Corporation NetLink BCM5906M Fast Ethernet PCI Express (rev 02). I am using slackware 12.2. I compiled kernel 2.6.29 from kernel.org. \n\nWhen I try to copy a file trough the LAN from this laptop with a command like this:\nscp test.bin 192.168.0.1:/tmp\n\nSome MBytes are copied and the transmit stops and there is some messages in dmesg:\n\nWARNING: at net/sched/sch_generic.c:226 dev_watchdog+0x1c2/0x1d0()\nHardware name: HP Compaq 6715s (GR897ES#ABB)\nNETDEV WATCHDOG: eth0 (tg3): transmit timed out\nModules linked in: snd_seq_dummy snd_seq_oss snd_seq_midi_event snd_seq snd_seq_devic\ne snd_pcm_oss snd_mixer_oss ipv6 cpufreq_stats powernow_k8 freq_table ppdev lp parpor\nt_pc parport fuse snd_hda_codec_analog pcmcia snd_hda_intel snd_hda_codec tg3 fan yen\nta_socket snd_hwdep video rsrc_nonstatic rtc_cmos snd_pcm thermal output rtc_core pcm\ncia_core ati_agp processor libphy rtc_lib psmouse i2c_piix4 agpgart container snd_tim\ner snd thermal_sys sg serio_raw evdev button battery ac wmi shpchp soundcore k8temp s\nnd_page_alloc hwmon\nPid: 0, comm: swapper Not tainted 2.6.29-smp #1\nCall Trace:\n [<c01294b6>] warn_slowpath+0x86/0xa0\n [<c0120030>] ? sd_init_MC+0xa0/0xd0\n [<c0120fce>] ? __enqueue_entity+0x8e/0xb0\n [<c03a483f>] ? cpumask_next_and+0x1f/0x40\n [<c012260a>] ? find_busiest_group+0x18a/0x710\n [<c011f8e5>] ? enqueue_task+0x15/0x30\n [<c03a94ed>] ? strlcpy+0x1d/0x60\n [<c06bfc02>] dev_watchdog+0x1c2/0x1d0\n [<c014320b>] ? getnstimeofday+0x4b/0x120\n [<c01320f4>] run_timer_softirq+0x124/0x190\n [<c06bfa40>] ? dev_watchdog+0x0/0x1d0\n [<c012e03a>] __do_softirq+0x8a/0x150\n [<c0132614>] ? update_process_times+0x54/0x70\n [<c012e13b>] do_softirq+0x3b/0x50\n [<c012e47b>] irq_exit+0x3b/0x50\n [<c011467e>] smp_apic_timer_interrupt+0x5e/0x90\n [<c0103940>] apic_timer_interrupt+0x28/0x30\n [<c0109978>] ? default_idle+0x38/0x50\n [<c0109b80>] c1e_idle+0x90/0xf0\n [<c0109b91>] ? c1e_idle+0xa1/0xf0\n [<c0101bea>] cpu_idle+0x4a/0x70\n [<c072f705>] rest_init+0x55/0x60\n---[ end trace 0c67ed7bcfb14db6 ]---\ntg3: eth0: transmit timed out, resetting\ntg3: DEBUG: MAC_TX_STATUS[00000008] MAC_RX_STATUS[00000000]\ntg3: DEBUG: RDMAC_STATUS[00000000] WDMAC_STATUS[00000000]\ntg3: tg3_stop_block timed out, ofs=1400 enable_bit=2\ntg3: tg3_stop_block timed out, ofs=c00 enable_bit=2\ntg3: tg3_stop_block timed out, ofs=4800 enable_bit=2\ntg3: eth0: Link is down.\ntg3: eth0: Link is up at 100 Mbps, full duplex.\ntg3: eth0: Flow control is on for TX and on for RX.\n\nAfter that I cannot send or receive any data through the LAN. There is no ping to anywhere.\nThese commands fix the problem:\n\nip l set dev eth0 down\nip l set dev eth0 up\n\nAnd when I execute `scp test.bin 192.168.0.1:/tmp` there is no network again.\n\nBut this laptop has no problems when receiving data. I can copy with scp from other PC connected to the same lan with 11Mbytes/s.\n\nI have search the web to find a solution with no success.\nI have tried some kernel options like \"irqpoll\" and \"acpi=off\" with no success.", "patch": ["diff -Nrup 1/drivers/net/tg3.c 2/drivers/net/tg3.c\n--- 1/drivers/net/tg3.c\t2009-03-23 16:12:14.000000000 -0700\n+++ 2/drivers/net/tg3.c\t2009-05-04 10:45:37.000000000 -0700\n@@ -5038,12 +5038,12 @@ tg3_tso_bug_end:\n static int tg3_start_xmit_dma_bug(struct sk_buff *skb, struct net_device *dev)\n {\n \tstruct tg3 *tp = netdev_priv(dev);\n-\tu32 len, entry, base_flags, mss;\n+\tu32 len, last_len, entry, base_flags, mss;\n \tstruct skb_shared_info *sp;\n \tint would_hit_hwbug;\n \tdma_addr_t mapping;\n \n-\tlen = skb_headlen(skb);\n+\tlen = last_len = skb_headlen(skb);\n \n \t/* We are running in BH disabled context with netif_tx_lock\n \t * and TX reclaim runs via tp->napi.poll inside of a software\n@@ -5164,6 +5164,11 @@ static int tg3_start_xmit_dma_bug(struct\n \t\t\tif (tg3_40bit_overflow_test(tp, mapping, len))\n \t\t\t\twould_hit_hwbug = 1;\n \n+\t\t\tif (last_len + len < 8)\n+\t\t\t\twould_hit_hwbug = 1;\n+\n+\t\t\tlast_len = len;\n+\n \t\t\tif (tp->tg3_flags2 & TG3_FLG2_HW_TSO)\n \t\t\t\ttg3_set_txd(tp, entry, mapping, len,\n \t\t\t\t\t    base_flags, (i == last)|(mss << 1));\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Network", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "drivers_network@kernel-bugs.osdl.org", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "12398", "Reported": "2009-03-29 18:02 UTC by Nikolay", "Modified": "2010-01-19 21:57 UTC", "CC List": "9 users", "See Also": "", "Kernel Version": "2.6.29", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/net/tg3.c"], "methods": ["tg3_start_xmit_dma_bug"]}
{"id": "12969", "title": "WARNING: at lib/dma-debug.c:539 check_sync+0xe9/0x341() (Not tainted)", "description": "------------[ cut here ]------------                                                                                                          \nWARNING: at lib/dma-debug.c:539 check_sync+0xe9/0x341() (Not tainted)                                                                         \nHardware name: HP Compaq nx6110 (PY501EA#AB9)                                                                                                 \nb44 0000:02:0e.0: DMA-API: device driver tries to sync DMA memory it has not allocated [device address=0x0000000075941040] [size=1566 bytes]  \nModules linked in: llc bnep l2cap bluetooth autofs4 lm90 hwmon i2c_i801 sunrpc ipv6 cpufreq_ondemand acpi_cpufreq uinput snd_intel8x0m snd_intel8x0 snd_ac97_codec snd_seq_dummy ac97_bus snd_seq_oss snd_seq_midi_event snd_seq snd_seq_device snd_pcm_oss snd_mixer_oss snd_pcm b44 ssb firewire_ohci snd_timer ipw2200 iTCO_wdt mii firewire_core snd iTCO_vendor_support libipw yenta_socket crc_itu_t lib80211 rsrc_nonstatic soundcore snd_page_alloc joydev pcspkr wmi serio_raw ata_generic pata_acpi i915 drm i2c_algo_bit i2c_core video output [last unloaded: scsi_wait_scan]                                                                                                                                             \nPid: 2418, comm: S58ntpd Not tainted 2.6.29-16.fc10.i686.PAE #1                                                                               \nCall Trace:                                                                                                                                   \n [<c04396d1>] warn_slowpath+0x7c/0xbd                                                                                                         \n [<c0457fe1>] ? register_lock_class+0x17/0x290                                                                                                \n [<c0458d61>] ? mark_lock+0x1e/0x349                                                                                                          \n [<c0556448>] ? _raw_spin_unlock+0x74/0x78                                                                                                    \n [<c0458d61>] ? mark_lock+0x1e/0x349                                                                                                          \n [<c055a060>] ? check_sync+0x37/0x341                                                                                                         \n [<c055a112>] check_sync+0xe9/0x341                                                                                                           \n [<c0711245>] ? _spin_unlock_irqrestore+0x45/0x55                                                                                             \n [<c04592db>] ? trace_hardirqs_on+0xb/0xd                                                                                                     \n [<c055a4d1>] debug_dma_sync_single_for_device+0x2f/0x39                                                                                      \n [<f828f722>] dma_sync_single_for_device+0x4a/0x59 [b44]                                                                                      \n [<f828f76f>] ssb_dma_sync_single_for_device+0x3e/0x48 [b44]                                                                                  \n [<f8291d1e>] b44_recycle_rx+0x18c/0x196 [b44]                                                                                                \n [<f8291f9f>] b44_poll+0x277/0x3c0 [b44]                                                                                                      \n [<c0687bb9>] net_rx_action+0xa1/0x1ca                                                                                                        \n [<c043e30a>] __do_softirq+0x9d/0x154                                                                                                         \n [<c043e413>] do_softirq+0x52/0x7e                                                                                                            \n [<c043e56f>] irq_exit+0x49/0x77                                                                                                              \n [<c040b22e>] do_IRQ+0x97/0xad                                                                                                                \n [<c0409dac>] common_interrupt+0x2c/0x34                                                                                                      \n---[ end trace d1aa19a66382cf6a ]---", "patch": ["Index: linux-2.6/drivers/net/b44.c\n===================================================================\n--- linux-2.6.orig/drivers/net/b44.c\t2009-04-06 21:47:55.000000000 +0200\n+++ linux-2.6/drivers/net/b44.c\t2009-04-06 21:50:18.000000000 +0200\n@@ -750,7 +750,7 @@\n \t\t\t\t\t     dest_idx * sizeof(*dest_desc),\n \t\t\t\t\t     DMA_BIDIRECTIONAL);\n \n-\tssb_dma_sync_single_for_device(bp->sdev, le32_to_cpu(src_desc->addr),\n+\tssb_dma_sync_single_for_device(bp->sdev, dest_map->mapping,\n \t\t\t\t       RX_PKT_BUF_SZ,\n \t\t\t\t       DMA_FROM_DEVICE);\n }\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Network", "Hardware": "i386 Linux", "Importance": "P1 normal", "Assignee": "drivers_network@kernel-bugs.osdl.org", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2009-03-29 11:43 UTC by Sérgio M Basto", "Modified": "2010-01-19 21:43 UTC", "CC List": "1 user", "See Also": "", "Kernel Version": "2.6.29", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/net/b44.c"], "methods": ["b44_recycle_rx"]}
{"id": "12961", "title": "Kernel panics in early boot: IO-APIC + timer doesn't work", "": "Show dependency tree", "description": "Created attachment 20718 [details]\ndmesg with acpi=debug\n\nLast working kernel version: 2.6.29-rc8-gitsomething\n\nHardware:\n\nTyan K8W Motherboard with 2 1.8GHz Dual Core Opterons with 2GB Ram for each node. The Motherboard uses the AMD 8xxx chipsets for AGP, PCI-X and Southbridge.\n\nSoftware: Debian unstable, 64bit.\n\nThe kernel crashes with the following message (and a backtrace afterwards):\n\n[    0.008000] ENABLING IO-APIC IRQs\n[    0.008000] ..TIMER: vector=0x30 apic1=0 pin1=2 apic2=0 pin2=0\n[    0.008000] ..MP-BIOS bug: 8254 timer not connected to IO-APIC\n[    0.008000] ...trying to set up timer (IRQ0) through the 8259A ...\n[    0.008000] ..... (found apic 0 pin 0) ...\n[    0.008000] ....... failed.\n[    0.008000] ...trying to set up timer as Virtual Wire IRQ...\n[    0.008000] ..... failed.\n[    0.008000] ...trying to set up timer as ExtINT IRQ...\n[    0.008000] ..... failed :(.\n[    0.008000] Kernel panic - not syncing: IO-APIC + timer doesn't work!  Boot with apic=debug and send a r.\n\nAttached is the complete dmesg as capture via serial-console (and with acpi=debug).", "patch": ["From 103a4585691d69c02627aa2a18446823989f413a Mon Sep 17 00:00:00 2001\nFrom: Andreas Herrmann <andreas.herrmann3@amd.com>\nDate: Tue, 21 Apr 2009 19:50:27 +0200\nSubject: [PATCH] x86: hpet: fix periodic mode programming on AMD 81xx\n\nImpact: fix boot time hang on machines with AMD 81xx chipset\n\n(See http://bugzilla.kernel.org/show_bug.cgi?id=12961)\n\nIt partially reverts commit c23e253e67c9d8a91a0ffa33c1f571a17f0a2403\n(x86: hpet: stop HPET_COUNTER when programming periodic mode)\n\nHPET on AMD 81xx chipset needs a second write (with HPET_TN_SETVAL\ncleared) to T0_CMP register to set the period in periodic mode.\n\nWith this patch HPET_COUNTER is still stopped but not reset when HPET\nis programmed in periodic mode. This should help to avoid races when\nHPET is programmed in periodic mode and fixes a boot time hang that\nI've observed on a machine when using 1000HZ.\n\nSigned-off-by: Andreas Herrmann <andreas.herrmann3@amd.com>\n---\n arch/x86/kernel/hpet.c |   18 +++++++++++++++++-\n 1 files changed, 17 insertions(+), 1 deletions(-)\n\ndiff --git a/arch/x86/kernel/hpet.c b/arch/x86/kernel/hpet.c\nindex 648b3a2..b30f79c 100644\n--- a/arch/x86/kernel/hpet.c\n+++ b/arch/x86/kernel/hpet.c\n@@ -236,6 +236,10 @@ static void hpet_stop_counter(void)\n \tunsigned long cfg = hpet_readl(HPET_CFG);\n \tcfg &= ~HPET_CFG_ENABLE;\n \thpet_writel(cfg, HPET_CFG);\n+}\n+\n+static void hpet_reset_counter(void)\n+{\n \thpet_writel(0, HPET_COUNTER);\n \thpet_writel(0, HPET_COUNTER + 4);\n }\n@@ -250,6 +254,7 @@ static void hpet_start_counter(void)\n static void hpet_restart_counter(void)\n {\n \thpet_stop_counter();\n+\thpet_reset_counter();\n \thpet_start_counter();\n }\n \n@@ -309,7 +314,7 @@ static int hpet_setup_msi_irq(unsigned int irq);\n static void hpet_set_mode(enum clock_event_mode mode,\n \t\t\t  struct clock_event_device *evt, int timer)\n {\n-\tunsigned long cfg;\n+\tunsigned long cfg, cmp, now;\n \tuint64_t delta;\n \n \tswitch (mode) {\n@@ -317,12 +322,23 @@ static void hpet_set_mode(enum clock_event_mode mode,\n \t\thpet_stop_counter();\n \t\tdelta = ((uint64_t)(NSEC_PER_SEC/HZ)) * evt->mult;\n \t\tdelta >>= evt->shift;\n+\t\tnow = hpet_readl(HPET_COUNTER);\n+\t\tcmp = now + (unsigned long) delta;\n \t\tcfg = hpet_readl(HPET_Tn_CFG(timer));\n \t\t/* Make sure we use edge triggered interrupts */\n \t\tcfg &= ~HPET_TN_LEVEL;\n \t\tcfg |= HPET_TN_ENABLE | HPET_TN_PERIODIC |\n \t\t       HPET_TN_SETVAL | HPET_TN_32BIT;\n \t\thpet_writel(cfg, HPET_Tn_CFG(timer));\n+\t\thpet_writel(cmp, HPET_Tn_CMP(timer));\n+\t\tudelay(1);\n+\t\t/*\n+\t\t * HPET on AMD 81xx needs a second write (with HPET_TN_SETVAL\n+\t\t * cleared) to T0_CMP to set the period. The HPET_TN_SETVAL\n+\t\t * bit is automatically cleared after the first write.\n+\t\t * (See AMD-8111 HyperTransport I/O Hub Data Sheet,\n+\t\t * Publication # 24674)\n+\t\t */\n \t\thpet_writel((unsigned long) delta, HPET_Tn_CMP(timer));\n \t\thpet_start_counter();\n \t\thpet_print_config();\n-- \n1.6.2\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Platform Specific/Hardware", "Classification": "Unclassified", "Component": "x86-64", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "platform_x86_64@kernel-bugs.osdl.org", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "12398", "Reported": "2009-03-28 19:00 UTC by Daniel Vetter", "Modified": "2009-04-27 20:17 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "2.6.29", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["arch/x86/kernel/hpet.c"], "methods": ["hpet_stop_counter", "hpet_restart_counter", "hpet_set_mode", "hpet_set_mode"]}
{"id": "12914", "title": "pmac_zilog fails to find IRQ for internal serial modem", "description": "Latest working kernel version: 2.6.11\nEarliest failing kernel version: 2.6.27\nDistribution: OpenSUSE 11.1\nHardware Environment: powerpc ( macintosh Powerbook G3 \"wallstreet\")\nSoftware Environment: gcc 4.3.2\nProblem Description: \n\nAfter upgrade to 2.6.28.8, the internal serial modem\nis no longer configured and /dev/ttyPZ2 does not respond.\n\nThe following is the truncated output of dmesg:\n\nUsing PowerMac machine description\nTotal memory = 160MB; using 512kB for hash table (at c9f80000)\nLinux version 2.6.28.8 (sadd@corinth) (gcc version 4.3.2 [gcc-4_3-branch revisio\nn 141291] (SUSE Linux) ) #1 Thu Mar 19 03:25:12 CDT 2009\nFound a Gatwick mac-io controller, rev: 1, mapped at 0xff780000\nFound a Heathrow mac-io controller, rev: 1, mapped at 0xff700000\nPowerMac motherboard: PowerBook Wallstreet\nPMU driver v2 initialized for PowerBook G3 Series, firmware: 0a\nconsole [udbg0] enabled\nFound Grackle (MPC106) PCI host bridge at 0x0000000080000000. Firmware bus numbe\nr: 0->0\n[...]\npmac_zilog: serial modem detected\n[...]\npmac_zilog: 0.6 (Benjamin Herrenschmidt <benh@kernel.crashing.org>)\nttyPZ0 at MMIO 0xf3013020 (irq = 16) is a Z85c30 ESCC - Serial port\nttyPZ1 at MMIO 0xf3013000 (irq = 17) is a Z85c30 ESCC - Infrared port\nttyPZ2 at MMIO 0xf4013020 (irq = 0) is a Z85c30 ESCC - Internal modem\n\n\nThe following is /proc/tty/driver/ttyPZ\n# cat /proc/tty/driver/ttyPZ \nserinfo:1.0 driver revision:\n0: uart:Z85c30 ESCC - Serial port mmio:0xF3013020 irq:16 tx:0 rx:0 DSR\n1: uart:Z85c30 ESCC - Infrared port mmio:0xF3013000 irq:17 tx:0 rx:0 DSR|CD\n2: uart:Z85c30 ESCC - Internal modem mmio:0xF4013020 irq:0 tx:0 rx:0 DSR\n\nAny attempt to configure the modem irq with \"setserial /dev/ttyPZ2 autoconfig\"\nresults in the error in the system log:\nMar 21 16:34:29 corinth kernel: pmac_zilog 1.00013020:ch-a: Unable to register z\ns interrupt handler.\n\n\nFor kernel 2.6.11, with the same hardware, the modem functioned correctly\nand the IRQ was assigned:\npmac_zilog: 0.6 (Benjamin Herrenschmidt <benh@kernel.crashing.org>)\nttyS0 at MMIO 0xf3013020 (irq = 15) is a Z85c30 ESCC - Serial port\nttyS1 at MMIO 0xf3013000 (irq = 16) is a Z85c30 ESCC - Infrared port\nttyS2 at MMIO 0xf4013020 (irq = 79) is a Z85c30 ESCC - Internal modem\n\nSteps to reproduce:\nBoot a Powerbook G3 using 2.6.28.8 configured to have pmac_zilog and the only\nenabled serial device.", "patch": ["--- linux-2.6/drivers/serial/pmac_zilog.c.orig\t2009-03-23 18:59:41.000000000 +0300\n+++ linux-2.6/drivers/serial/pmac_zilog.c\t2009-03-23 22:27:22.000000000 +0300\n@@ -1532,6 +1532,11 @@ no_dma:\n \t */\n \tuap->port.iotype = UPIO_MEM;\n \tuap->port.irq = irq_of_parse_and_map(np, 0);\n+\tif (uap->port.irq == NO_IRQ) {\n+\t\tprintk(KERN_ERR \"pmac_zilog: can't map interrupt for %s\\n\",\n+\t\t\t\tnp->full_name);\n+\t\treturn -ENODEV;\n+\t}\n \tuap->port.uartclk = ZS_CLOCK;\n \tuap->port.fifosize = 1;\n \tuap->port.ops = &pmz_pops;\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Platform Specific/Hardware", "Classification": "Unclassified", "Component": "PPC-32", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "platform_ppc-32", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2009-03-21 14:43 UTC by Mike Sadd", "Modified": "2012-05-30 14:48 UTC", "CC List": "3 users", "See Also": "", "Kernel Version": "2.6.28", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/serial/pmac_zilog.c"], "methods": ["pmz_init_port"]}
{"id": "12646", "title": "w1_therm overflows for temperatures greater that 32.767 Celsius", "description": "Latest working kernel version:Unknown\nEarliest failing kernel version:2.6.29-rc3\nDistribution:FC-8\nHardware Environment:i386, DS18B20 slave, DS9490R master.\nSoftware Environment:\nProblem Description:When the temperature exceeds 32767 milli-degrees the temperature overflows to -32768 millidegrees. These are bothe well within the -55 - +125 degree range for the sensor.\n\nSteps to reproduce: Put your thumb on the sensor while periodically inspecting /sys/devices/w1\\ bus\\ master/*/w1_slave", "patch": ["diff --git a/drivers/w1/slaves/w1_therm.c b/drivers/w1/slaves/w1_therm.c\nindex 2c8dff9..1ed3d55 100644\n--- a/drivers/w1/slaves/w1_therm.c\n+++ b/drivers/w1/slaves/w1_therm.c\n@@ -115,7 +115,7 @@ static struct w1_therm_family_converter w1_therm_families[] = {\n \n static inline int w1_DS18B20_convert_temp(u8 rom[9])\n {\n-\ts16 t = (rom[1] << 8) | rom[0];\n+\tint t = ((s16)rom[1] << 8) | rom[0];\n \tt = t*1000/16;\n \treturn t;\n }\n", "diff --git a/drivers/w1/slaves/w1_therm.c b/drivers/w1/slaves/w1_therm.c\nindex 1ed3d55..990a1a5 100644\n--- a/drivers/w1/slaves/w1_therm.c\n+++ b/drivers/w1/slaves/w1_therm.c\n@@ -115,9 +115,8 @@ static struct w1_therm_family_converter w1_therm_families[] = {\n \n static inline int w1_DS18B20_convert_temp(u8 rom[9])\n {\n-\tint t = ((s16)rom[1] << 8) | rom[0];\n-\tt = t*1000/16;\n-\treturn t;\n+\ts16 t = le16_to_cpup((le16 *)rom);\n+\treturn t*1000/16;\n }\n \n static inline int w1_DS18S20_convert_temp(u8 rom[9])\n", "diff --git a/drivers/w1/slaves/w1_therm.c b/drivers/w1/slaves/w1_therm.c\nindex 1ed3d55..17726a0 100644\n--- a/drivers/w1/slaves/w1_therm.c\n+++ b/drivers/w1/slaves/w1_therm.c\n@@ -115,9 +115,8 @@ static struct w1_therm_family_converter w1_therm_families[] = {\n \n static inline int w1_DS18B20_convert_temp(u8 rom[9])\n {\n-\tint t = ((s16)rom[1] << 8) | rom[0];\n-\tt = t*1000/16;\n-\treturn t;\n+\ts16 t = le16_to_cpup((__le16 *)rom);\n+\treturn t*1000/16;\n }\n \n static inline int w1_DS18S20_convert_temp(u8 rom[9])\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "W1", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Evgeniy Polyakov", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2009-02-07 04:53 UTC by Ian Dall", "Modified": "2012-05-30 12:55 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "2.6.29-rc3", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/w1/slaves/w1_therm.c"], "methods": ["w1_DS18B20_convert_temp"]}
{"id": "12632", "title": "don't assume we are fully charged when not charging or discharging", "description": "Latest working kernel version: None\nEarliest failing kernel version: Everything since ACPI moved to using the power_supply class\nDistribution: Fedora rawhide\nHardware Environment: Lenovo T61\nSoftware Environment: Fedora rawhide\nProblem Description:\n\nOn hardware like the T61 it can take a couple of seconds for the battery\nto start charging after the power is connected, and we incorrectly tell\nuserspace that we are fully charged, and then go back to charging.\n\nOnly mark a battery as fully charged when the preset charge matches either\nthe last full charge, or the design charge.\n\nSteps to reproduce:\n\nCharge battery to 50%. Watch /sys/class/power_supply/BAT*/status, and observe that when the power is disconnected, the status goes from charging->fully_charged->discharging. This also happens when going from battery to AC. This greatly confuses userspace.", "patch": ["From 3b0fb1239e5bc064766ffa3d7a45265e722fb9eb Mon Sep 17 00:00:00 2001\nFrom: Richard Hughes <hughsient@gmail.com>\nDate: Sun, 25 Jan 2009 15:05:50 +0000\nSubject: [PATCH] battery: don't assume we are fully charged when not charging or discharging\n\nOn hardware like the T61 it can take a couple of seconds for the battery\nto start charging after the power is connected, and we incorrectly tell\nuserspace that we are fully charged, and then go back to charging.\n\nOnly mark a battery as fully charged when the preset charge matches either\nthe last full charge, or the design charge.\n\nSigned-off-by: Richard Hughes <hughsient@gmail.com>\n---\n drivers/acpi/battery.c |   25 ++++++++++++++++++++++++-\n 1 files changed, 24 insertions(+), 1 deletions(-)\n\ndiff --git a/drivers/acpi/battery.c b/drivers/acpi/battery.c\nindex 65132f9..69cbc57 100644\n--- a/drivers/acpi/battery.c\n+++ b/drivers/acpi/battery.c\n@@ -138,6 +138,29 @@ static int acpi_battery_technology(struct acpi_battery *battery)\n \n static int acpi_battery_get_state(struct acpi_battery *battery);\n \n+static int acpi_battery_is_charged(struct acpi_battery *battery)\n+{\n+\t/* either charging or discharging */\n+\tif (battery->state != 0)\n+\t\treturn 0;\n+\n+\t/* battery not reporting charge */\n+\tif (battery->capacity_now == ACPI_BATTERY_VALUE_UNKNOWN ||\n+\t    battery->capacity_now == 0)\n+\t\treturn 0;\n+\n+\t/* good batteries update full_charge as the batteries degrade */\n+\tif (battery->full_charge_capacity == battery->capacity_now)\n+\t\treturn 1;\n+\n+\t/* fallback to using design values for broken batteries */\n+\tif (battery->design_capacity == battery->capacity_now)\n+\t\treturn 1;\n+\n+\t/* we don't do any sort of metric based on percentages */\n+\treturn 0;\n+}\n+\n static int acpi_battery_get_property(struct power_supply *psy,\n \t\t\t\t     enum power_supply_property psp,\n \t\t\t\t     union power_supply_propval *val)\n@@ -155,7 +178,7 @@ static int acpi_battery_get_property(struct power_supply *psy,\n \t\t\tval->intval = POWER_SUPPLY_STATUS_DISCHARGING;\n \t\telse if (battery->state & 0x02)\n \t\t\tval->intval = POWER_SUPPLY_STATUS_CHARGING;\n-\t\telse if (battery->state == 0)\n+\t\telse if (acpi_battery_is_charged(battery))\n \t\t\tval->intval = POWER_SUPPLY_STATUS_FULL;\n \t\telse\n \t\t\tval->intval = POWER_SUPPLY_STATUS_UNKNOWN;\n-- \n1.6.0.6\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "Power-Battery", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Zhang Rui", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2009-02-04 05:53 UTC by Richard Hughes", "Modified": "2009-02-22 17:48 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "2.6.29-rc3", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/acpi/battery.c"], "methods": ["acpi_battery_get_property"]}
{"id": "12592", "title": "fw_card_add adds card to the list even on enable failure", "description": "Latest working kernel version:  never\nEarliest failing kernel version:  always\nDistribution:  Debian\nHardware Environment:  Two \"FireWire (IEEE 1394): Texas Instruments TSB43AB23 IEEE-1394a-2000 Controller (PHY/Link)\" devices in one box, with on-board device ill...\nSoftware Environment:  New FW stack\nProblem Description:\n\nWhen Vista boots on the hardware, it does something bad to the on-board firewire adapter, so it starts failing to enable card:\n\nfirewire_ohci 0000:01:09.0: PCI INT A -> Link[APC4] -> GSI 19 (level, low) -> IRQ 19\nfirewire_ohci 0000:01:09.0: setting latency timer to 64\nfirewire_ohci: failed to set phy reg bits.\nfirewire_ohci 0000:01:09.0: PCI INT A disabled\nfirewire_ohci: probe of 0000:01:09.0 failed with error -5\n\nWhen that happens, fw_add_card adds card to the list of all devices, but then returns an error.  Caller then thinks that things went wrong, and releases card structure.  Then when fw_add_card is invoked for second device, kernel reports linked list corruption, as first (released) card is still in the list...\n\nSteps to reproduce:\n\nGet box with one broken and one working card, and try loading firewire-ohci module.", "patch": ["From Petr Vandrovec <petr@vandrovec.name>\n\nRemove card from list of cards when enable fails.\n\nSigned-off-by: Petr Vandrovec <petr@vandrovec.name>\n\ndiff --git a/drivers/firewire/fw-card.c b/drivers/firewire/fw-card.c\nindex 7be2cf3..a5dd7a6 100644\n--- a/drivers/firewire/fw-card.c\n+++ b/drivers/firewire/fw-card.c\n@@ -412,6 +412,7 @@ fw_card_add(struct fw_card *card,\n {\n \tu32 *config_rom;\n \tsize_t length;\n+\tint err;\n \n \tcard->max_receive = max_receive;\n \tcard->link_speed = link_speed;\n@@ -422,7 +423,13 @@ fw_card_add(struct fw_card *card,\n \tlist_add_tail(&card->link, &card_list);\n \tmutex_unlock(&card_mutex);\n \n-\treturn card->driver->enable(card, config_rom, length);\n+\terr = card->driver->enable(card, config_rom, length);\n+\tif (err < 0) {\n+\t\tmutex_lock(&card_mutex);\n+\t\tlist_del(&card->link);\n+\t\tmutex_unlock(&card_mutex);\n+\t}\n+\treturn err;\n }\n EXPORT_SYMBOL(fw_card_add);\n \n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "IEEE1394", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Stefan Richter", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2009-02-01 01:26 UTC by Petr Vandrovec", "Modified": "2009-02-09 14:36 UTC", "CC List": "0 users", "See Also": "", "Kernel Version": "2.6.29-rc3", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/firewire/fw-card.c"], "methods": ["fw_card_add"]}
{"id": "12567", "title": "The rtl-8187b card stops responding and connection is lost on hight trafic (torrent protocol).", "description": "The rtl8187 module driver doesn't work properly on hight traffic. When foe example I am downloading torrents the card doesn't respond an the connection is lost. I have to unload and load the module again. I only happens with me when the torrents are on.", "patch": ["From: Larry Finger <Larry.Finger@lwfinger.net>\n\nThe RTL8187 and RTL8187B devices can stall unless an explicit termination\npacket is sent.\n\nThis change was incorporated in mainline with hash 2fcbab044a3\nand entitled \"rtl8187: Add termination packet to prevent stall\".\n\nThis change should be applied to 2.6.27 and 2.6.28.\n\nSigned-off-by: Larry Finger <Larry.Finger@lwfinger.net>\nSigned-off-by: John W. Linville <linville@tuxdriver.com>\n---\n\nIndex: linux-2.6/drivers/net/wireless/rtl8187_dev.c\n===================================================================\n--- linux-2.6.orig/drivers/net/wireless/rtl8187_dev.c\n+++ linux-2.6/drivers/net/wireless/rtl8187_dev.c\n@@ -263,6 +263,7 @@ static int rtl8187_tx(struct ieee80211_h\n \n \tusb_fill_bulk_urb(urb, priv->udev, usb_sndbulkpipe(priv->udev, ep),\n \t\t\t  buf, skb->len, rtl8187_tx_cb, skb);\n+\turb->transfer_flags |= URB_ZERO_PACKET;\n \trc = usb_submit_urb(urb, GFP_ATOMIC);\n \tif (rc < 0) {\n \t\tusb_free_urb(urb);\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "network-wireless", "Hardware": "All Linux", "Importance": "P1 high", "Assignee": "drivers_network-wireless@kernel-bugs.osdl.org", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2009-01-28 14:06 UTC by Alexander Kaltsas", "Modified": "2009-08-06 00:07 UTC", "CC List": "5 users", "See Also": "", "Kernel Version": "2.6.28", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/net/wireless/rtl8187_dev.c"], "methods": ["rtl8187_tx"]}
{"id": "12360", "title": "with 2.6.28 undock/dock work bad or freeze computer - Dell D430", "description": "Latest working kernel version:2.6.26.2\nEarliest failing kernel version:2.6.28\nDistribution:Debian SID\nHardware Environment: Dell D43\nSoftware Environment: only kernel\nProblem Description: after upgrade kernel and undocking kernel prints info about undock but after while docking  again.See atached dmesg. After this I lost keyboard and mouse. Sometime I get it back.\n\nSteps to reproduce:\ncompile 2.6.28 and undock", "patch": ["diff --git a/drivers/acpi/dock.c b/drivers/acpi/dock.c\nindex 5b30b8d..de397fd 100644\n--- a/drivers/acpi/dock.c\n+++ b/drivers/acpi/dock.c\n@@ -381,6 +381,7 @@ static void hotplug_dock_devices(struct dock_station *ds, u32 event)\n \n \tmutex_lock(&ds->hp_lock);\n \n+\tprintk(KERN_INFO \"DOCK: hotplug_dock_devices()\\n\");\n \t/*\n \t * First call driver specific hotplug functions\n \t */\n@@ -671,6 +672,8 @@ static int handle_eject_request(struct dock_station *ds, u32 event)\n \tif (dock_in_progress(ds))\n \t\treturn -EBUSY;\n \n+\tprintk(KERN_INFO \"DOCK: handle_eject_request\\n\");\n+\n \t/*\n \t * here we need to generate the undock\n \t * event prior to actually doing the undock\n@@ -727,9 +730,12 @@ static void dock_notify(acpi_handle handle, u32 event, void *data)\n \t */\n \tswitch (event) {\n \tcase ACPI_NOTIFY_BUS_CHECK:\n+\t\tprintk(KERN_INFO \"BUS_CHECK\\n\");\n \tcase ACPI_NOTIFY_DEVICE_CHECK:\n+\t\tprintk(KERN_INFO \"DEVICE_CHECK\\n\");\n \t\tif (!dock_in_progress(ds) && acpi_bus_get_device(ds->handle,\n \t\t   &tmp)) {\n+\t\t\tprintk(KERN_INFO \"DOCK: Started docking\\n\");\n \t\t\tbegin_dock(ds);\n \t\t\tdock(ds);\n \t\t\tif (!dock_present(ds)) {\n@@ -743,15 +749,18 @@ static void dock_notify(acpi_handle handle, u32 event, void *data)\n \t\t\tcomplete_dock(ds);\n \t\t\tdock_event(ds, event, DOCK_EVENT);\n \t\t\tdock_lock(ds, 1);\n+\t\t\tprintk(KERN_INFO \"DOCK: Completed docking\\n\");\n \t\t\tbreak;\n \t\t}\n \t\tif (dock_present(ds) || dock_in_progress(ds))\n \t\t\tbreak;\n \t\t/* This is a surprise removal */\n+\t\tprintk(KERN_INFO \"DOCK: Surprise removal\\n\");\n \t\tsurprise_removal = 1;\n \t\tevent = ACPI_NOTIFY_EJECT_REQUEST;\n \t\t/* Fall back */\n \tcase ACPI_NOTIFY_EJECT_REQUEST:\n+\t\tprintk(KERN_INFO \"DOCK: EJECT_REQUEST\\n\");\n \t\tbegin_undock(ds);\n \t\tif ((immediate_undock && !(ds->flags & DOCK_IS_ATA))\n \t\t   || surprise_removal)\n@@ -855,11 +864,15 @@ fdd_out:\n static ssize_t show_docked(struct device *dev,\n \t\t\t   struct device_attribute *attr, char *buf)\n {\n+\tstruct acpi_device *tmp;\n+\n \tstruct dock_station *dock_station = *((struct dock_station **)\n \t\tdev->platform_data);\n-\treturn snprintf(buf, PAGE_SIZE, \"%d\\n\", dock_present(dock_station));\n+\treturn snprintf(buf, PAGE_SIZE, \"%d\\n\",\n+\t\t\tacpi_bus_get_device(dock_station->handle, &tmp));\n \n }\n+\n static DEVICE_ATTR(docked, S_IRUGO, show_docked, NULL);\n \n /*\n", "diff --git a/drivers/acpi/dock.c b/drivers/acpi/dock.c\nindex 5b30b8d..afd5db3 100644\n--- a/drivers/acpi/dock.c\n+++ b/drivers/acpi/dock.c\n@@ -855,10 +855,14 @@ fdd_out:\n static ssize_t show_docked(struct device *dev,\n \t\t\t   struct device_attribute *attr, char *buf)\n {\n+\tstruct acpi_device *tmp;\n+\n \tstruct dock_station *dock_station = *((struct dock_station **)\n \t\tdev->platform_data);\n-\treturn snprintf(buf, PAGE_SIZE, \"%d\\n\", dock_present(dock_station));\n \n+\tif (ACPI_SUCCESS(acpi_bus_get_device(dock_station->handle, &tmp)))\n+\t\treturn snprintf(buf, PAGE_SIZE, \"1\\n\");\n+\treturn snprintf(buf, PAGE_SIZE, \"0\\n\");\n }\n static DEVICE_ATTR(docked, S_IRUGO, show_docked, NULL);\n \n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "Config-Hotplug", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Shaohua", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2009-01-04 12:29 UTC by Daniel Smolik", "Modified": "2009-02-21 09:25 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "2.6.28", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/acpi/dock.c"], "methods": ["hotplug_dock_devices", "handle_eject_request", "dock_notify", "show_docked"]}
{"id": "12310", "title": "NOHZ appears to cause ondemand to effectively ignore 'ignore_nice_load'", "description": "Latest working kernel version: Don't think it ever worked well with NOHZ, but got worse after 2.6.26\nEarliest failing kernel version:\nDistribution:\nHardware Environment: Everex notebook, AMD 64 dual-core\nSoftware Environment: \nProblem Description:\n\n  [this bug is a tickless+ondemand interaction: the problem may be in the cpufreq_ondemand code]\n\n  I'm running boinc, which will cheerfully keep both cores loaded with niced processes if I let it. In the past, meaning for the last six months or more, I managed to stop the niced processes from upping the frequency by setting up_threshhold to 50 or more and letting boinc use only 80% CPU, but with 2.6.28 nothing I did mattered.\n\n I got to looking around the ondemand code and noticed that it would try to call\nget_cpu_idle_time_us() and then calculate idle time differently if that failed, which would happen if NOHZ is turned off. I rebooted with 'nohz=off' and the ondemand code behaves completely to spec according to how I set ignore_nice_load and up_threshhold.\n\nSteps to reproduce:  Build tickless kernel, run boinc (or maybe a niced while-true loop?).", "patch": ["\nMake ignore_nice_load setting of ondemand work as expected.\nondemand micro-accounting of idle time changes broke ignore_nice_load\nsysfs setting due to a thinko in the code.\n\nThe bug entry:\nhttp://bugzilla.kernel.org/show_bug.cgi?id=12310\n\nReported-by: Jim Bray <jimsantelmo@gmail.com>\n\nSigned-off-by: Venkatesh Pallipadi <venkatesh.pallipadi@intel.com>\n\n---\n drivers/cpufreq/cpufreq_ondemand.c |   47 +++++++++++++++++++------------------\n 1 file changed, 25 insertions(+), 22 deletions(-)\n\nIndex: linux-2.6/drivers/cpufreq/cpufreq_ondemand.c\n===================================================================\n--- linux-2.6.orig/drivers/cpufreq/cpufreq_ondemand.c\t2008-12-31 14:10:15.000000000 -0800\n+++ linux-2.6/drivers/cpufreq/cpufreq_ondemand.c\t2008-12-31 14:28:52.000000000 -0800\n@@ -117,11 +117,7 @@ static inline cputime64_t get_cpu_idle_t\n \tbusy_time = cputime64_add(busy_time, kstat_cpu(cpu).cpustat.irq);\n \tbusy_time = cputime64_add(busy_time, kstat_cpu(cpu).cpustat.softirq);\n \tbusy_time = cputime64_add(busy_time, kstat_cpu(cpu).cpustat.steal);\n-\n-\tif (!dbs_tuners_ins.ignore_nice) {\n-\t\tbusy_time = cputime64_add(busy_time,\n-\t\t\t\tkstat_cpu(cpu).cpustat.nice);\n-\t}\n+\tbusy_time = cputime64_add(busy_time, kstat_cpu(cpu).cpustat.nice);\n \n \tidle_time = cputime64_sub(cur_wall_time, busy_time);\n \tif (wall)\n@@ -137,23 +133,6 @@ static inline cputime64_t get_cpu_idle_t\n \tif (idle_time == -1ULL)\n \t\treturn get_cpu_idle_time_jiffy(cpu, wall);\n \n-\tif (dbs_tuners_ins.ignore_nice) {\n-\t\tcputime64_t cur_nice;\n-\t\tunsigned long cur_nice_jiffies;\n-\t\tstruct cpu_dbs_info_s *dbs_info;\n-\n-\t\tdbs_info = &per_cpu(cpu_dbs_info, cpu);\n-\t\tcur_nice = cputime64_sub(kstat_cpu(cpu).cpustat.nice,\n-\t\t\t\t\t dbs_info->prev_cpu_nice);\n-\t\t/*\n-\t\t * Assumption: nice time between sampling periods will be\n-\t\t * less than 2^32 jiffies for 32 bit sys\n-\t\t */\n-\t\tcur_nice_jiffies = (unsigned long)\n-\t\t\t\t\tcputime64_to_jiffies64(cur_nice);\n-\t\tdbs_info->prev_cpu_nice = kstat_cpu(cpu).cpustat.nice;\n-\t\treturn idle_time + jiffies_to_usecs(cur_nice_jiffies);\n-\t}\n \treturn idle_time;\n }\n \n@@ -319,6 +298,9 @@ static ssize_t store_ignore_nice_load(st\n \t\tdbs_info = &per_cpu(cpu_dbs_info, j);\n \t\tdbs_info->prev_cpu_idle = get_cpu_idle_time(j,\n \t\t\t\t\t\t&dbs_info->prev_cpu_wall);\n+\t\tif (dbs_tuners_ins.ignore_nice)\n+\t\t\tdbs_info->prev_cpu_nice = kstat_cpu(j).cpustat.nice;\n+\n \t}\n \tmutex_unlock(&dbs_mutex);\n \n@@ -419,6 +401,23 @@ static void dbs_check_cpu(struct cpu_dbs\n \t\t\t\tj_dbs_info->prev_cpu_idle);\n \t\tj_dbs_info->prev_cpu_idle = cur_idle_time;\n \n+\t\tif (dbs_tuners_ins.ignore_nice) {\n+\t\t\tcputime64_t cur_nice;\n+\t\t\tunsigned long cur_nice_jiffies;\n+\n+\t\t\tcur_nice = cputime64_sub(kstat_cpu(j).cpustat.nice,\n+\t\t\t\t\t j_dbs_info->prev_cpu_nice);\n+\t\t\t/*\n+\t\t\t * Assumption: nice time between sampling periods will\n+\t\t\t * be less than 2^32 jiffies for 32 bit sys\n+\t\t\t */\n+\t\t\tcur_nice_jiffies = (unsigned long)\n+\t\t\t\t\tcputime64_to_jiffies64(cur_nice);\n+\n+\t\t\tj_dbs_info->prev_cpu_nice = kstat_cpu(j).cpustat.nice;\n+\t\t\tidle_time += jiffies_to_usecs(cur_nice_jiffies);\n+\t\t}\n+\n \t\tif (unlikely(!wall_time || wall_time < idle_time))\n \t\t\tcontinue;\n \n@@ -575,6 +574,10 @@ static int cpufreq_governor_dbs(struct c\n \n \t\t\tj_dbs_info->prev_cpu_idle = get_cpu_idle_time(j,\n \t\t\t\t\t\t&j_dbs_info->prev_cpu_wall);\n+\t\t\tif (dbs_tuners_ins.ignore_nice) {\n+\t\t\t\tj_dbs_info->prev_cpu_nice =\n+\t\t\t\t\t\tkstat_cpu(j).cpustat.nice;\n+\t\t\t}\n \t\t}\n \t\tthis_dbs_info->cpu = cpu;\n \t\t/*\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Power Management", "Classification": "Unclassified", "Component": "cpufreq", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Venkatesh Pallipadi", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2008-12-27 19:38 UTC by Jim Bray", "Modified": "2009-02-13 15:15 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "2.6.28", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/cpufreq/cpufreq_ondemand.c"], "methods": ["get_cpu_idle_time_jiffy", "store_ignore_nice_load", "dbs_check_cpu", "cpufreq_governor_dbs"]}
{"id": "12302", "title": "Backward brigthess level", "description": "Latest working kernel version: 2.6.27.10\nEarliest failing kernel version: 2.6.28\nDistribution: all\nHardware Environment: Notebook asus X51L\nSoftware Environment: all\nProblem Description:backward brigthess level\n\nSteps to reproduce: start Kpowersave and select brigthess level \n\nAsus X51L backward brigthess trouble.\n\n/proc/acpi/video/VGA/LCDD/brightness - work fine 0-min 15-max\n/sys/class/backlight/acpi_video0/brightness - trouble 0-max 15-min\n\nKpowersave work bad - 100%-min 1%-max\n\nIn dmesg:\n\nDec 25 23:47:08 sfstudio kernel: \nACPI: Please implement acpi_video_bus_ROM_seq_show\nDec 26 01:34:14 sfstudio kernel: asus-laptop: Asus Laptop Support version 0.42\nDec 26 01:34:14 sfstudio kernel: asus-laptop:   X51L model detected\nDec 26 01:34:14 sfstudio kernel: asus-laptop: Brightness ignored, must be\ncontrolled by ACPI video driver\nDec 26 01:34:14 sfstudio kernel: Registered led device: asus::mail\nDec 26 01:37:29 sfstudio kernel: asus-laptop: Asus Laptop Support version 0.42\nDec 26 01:37:29 sfstudio kernel: asus-laptop:   X51L model detected\nDec 26 01:37:29 sfstudio kernel: asus-laptop: Brightness ignored, must be\ncontrolled by ACPI video driver\nDec 26 01:37:29 sfstudio kernel: Registered led device: asus::mail\nDec 26 01:39:20 sfstudio kernel: asus-laptop: Asus Laptop Support version 0.42\nDec 26 01:39:20 sfstudio kernel: asus-laptop:   X51L model detected\nDec 26 01:39:20 sfstudio kernel: asus-laptop: Brightness ignored, must be\ncontrolled by ACPI video driver\nDec 26 01:39:20 sfstudio kernel: Registered led device: asus::mail\nDec 26 01:40:31 sfstudio kernel: asus-laptop: Asus Laptop Support version 0.42\nDec 26 01:40:31 sfstudio kernel: asus-laptop:   X51L model detected\nDec 26 01:40:31 sfstudio kernel: asus-laptop: Brightness ignored, must be\ncontrolled by ACPI video driver\nDec 26 01:40:31 sfstudio kernel: Registered led device: asus::mail\n\nKernel:\n[root@sfstudio kernel]# uname -a\nLinux sfstudio.sadnet.lo 2.6.28 #2 SMP PREEMPT Thu Dec 25 17:14:54 OMST 2008\ni686 Intel(R) Celeron(R) CPU          540  @ 1.86GHz GNU/Linux", "patch": ["---\n drivers/acpi/video.c |  199 +++++++++++++++++++++++++++++++++++++++------------\n 1 file changed, 153 insertions(+), 46 deletions(-)\n\nIndex: linux-2.6/drivers/acpi/video.c\n===================================================================\n--- linux-2.6.orig/drivers/acpi/video.c\n+++ linux-2.6/drivers/acpi/video.c\n@@ -168,10 +168,19 @@ struct acpi_video_device_cap {\n \tu8 _DSS:1;\t\t/*Device state set */\n };\n \n+struct acpi_video_brightness_flags {\n+\tu8 _BCL_no_ac_battery_levels:1;\t/* no AC/Battery levels in _BCL */\n+\tu8 _BCL_reversed:1;\t\t/* _BCL package is in a reversed order*/\n+\tu8 _BCL_use_index:1;\t\t/* levels in _BCL are index values */\n+\tu8 _BCM_use_index:1;\t\t/* input of _BCM is an index value */\n+\tu8 _BQC_use_index:1;\t\t/* _BQC returns an index value */\n+};\n+\n struct acpi_video_device_brightness {\n \tint curr;\n \tint count;\n \tint *levels;\n+\tstruct acpi_video_brightness_flags flags;\n };\n \n struct acpi_video_device {\n@@ -294,7 +303,7 @@ static int acpi_video_device_lcd_get_lev\n \t\t\tunsigned long long *level);\n static int acpi_video_get_next_level(struct acpi_video_device *device,\n \t\t\t\t     u32 level_current, u32 event);\n-static void acpi_video_switch_brightness(struct acpi_video_device *device,\n+static int acpi_video_switch_brightness(struct acpi_video_device *device,\n \t\t\t\t\t int event);\n static int acpi_video_device_get_state(struct acpi_video_device *device,\n \t\t\t    unsigned long long *state);\n@@ -308,7 +317,9 @@ static int acpi_video_get_brightness(str\n \tint i;\n \tstruct acpi_video_device *vd =\n \t\t(struct acpi_video_device *)bl_get_data(bd);\n-\tacpi_video_device_lcd_get_level_current(vd, &cur_level);\n+\n+\tif (acpi_video_device_lcd_get_level_current(vd, &cur_level))\n+\t\treturn -EINVAL;\n \tfor (i = 2; i < vd->brightness->count; i++) {\n \t\tif (vd->brightness->levels[i] == cur_level)\n \t\t\t/* The first two entries are special - see page 575\n@@ -320,12 +331,12 @@ static int acpi_video_get_brightness(str\n \n static int acpi_video_set_brightness(struct backlight_device *bd)\n {\n-\tint request_level = bd->props.brightness+2;\n+\tint request_level = bd->props.brightness + 2;\n \tstruct acpi_video_device *vd =\n \t\t(struct acpi_video_device *)bl_get_data(bd);\n-\tacpi_video_device_lcd_set_level(vd,\n-\t\t\t\t\tvd->brightness->levels[request_level]);\n-\treturn 0;\n+\n+\treturn acpi_video_device_lcd_set_level(vd,\n+\t\t\t\tvd->brightness->levels[request_level]);\n }\n \n static struct backlight_ops acpi_backlight_ops = {\n@@ -373,7 +384,8 @@ static int video_get_cur_state(struct th\n \tunsigned long long level;\n \tint state;\n \n-\tacpi_video_device_lcd_get_level_current(video, &level);\n+\tif (acpi_video_device_lcd_get_level_current(video, &level))\n+\t\treturn -EINVAL;\n \tfor (state = 2; state < video->brightness->count; state++)\n \t\tif (level == video->brightness->levels[state])\n \t\t\treturn sprintf(buf, \"%d\\n\",\n@@ -479,34 +491,66 @@ acpi_video_device_lcd_query_levels(struc\n static int\n acpi_video_device_lcd_set_level(struct acpi_video_device *device, int level)\n {\n-\tint status = AE_OK;\n+\tint status;\n \tunion acpi_object arg0 = { ACPI_TYPE_INTEGER };\n \tstruct acpi_object_list args = { 1, &arg0 };\n \tint state;\n \n-\n \targ0.integer.value = level;\n \n-\tif (device->cap._BCM)\n-\t\tstatus = acpi_evaluate_object(device->dev->handle, \"_BCM\",\n-\t\t\t\t\t      &args, NULL);\n+\tstatus = acpi_evaluate_object(device->dev->handle, \"_BCM\",\n+\t\t\t\t      &args, NULL);\n+\tif (ACPI_FAILURE(status)) {\n+\t\tACPI_ERROR((AE_INFO, \"Evaluating _BCM failed\"));\n+\t\treturn -EIO;\n+\t}\n+\n \tdevice->brightness->curr = level;\n \tfor (state = 2; state < device->brightness->count; state++)\n-\t\tif (level == device->brightness->levels[state])\n-\t\t\tdevice->backlight->props.brightness = state - 2;\n+\t\tif (level == device->brightness->levels[state]) {\n+\t\t\tif (device->backlight)\n+\t\t\t\tdevice->backlight->props.brightness = state - 2;\n+\t\t\treturn 0;\n+\t\t}\n \n-\treturn status;\n+\tACPI_ERROR((AE_INFO, \"Current brightness invalid\"));\n+\treturn -EINVAL;\n }\n \n static int\n acpi_video_device_lcd_get_level_current(struct acpi_video_device *device,\n \t\t\t\t\tunsigned long long *level)\n {\n-\tif (device->cap._BQC)\n-\t\treturn acpi_evaluate_integer(device->dev->handle, \"_BQC\", NULL,\n-\t\t\t\t\t     level);\n+\tacpi_status status = AE_OK;\n+\n+\tif (device->cap._BQC) {\n+\t\tstatus = acpi_evaluate_integer(device->dev->handle, \"_BQC\",\n+\t\t\t\t\t\tNULL, level);\n+\t\tif (ACPI_SUCCESS(status)) {\n+\t\t\tif (device->brightness->flags._BQC_use_index) {\n+\t\t\t\tif (device->brightness->flags._BCL_reversed)\n+\t\t\t\t\t*level = device->brightness->count\n+\t\t\t\t\t\t\t\t - 3 - (*level);\n+\t\t\t\t*level = device->brightness->levels[*level + 2];\n+\n+\t\t\t}\n+\t\t\tdevice->brightness->curr = *level;\n+\t\t\treturn 0;\n+\t\t} else {\n+\t\t\t/* Fixme:\n+\t\t\t * should we return an error or ignore this failure?\n+\t\t\t * dev->brightness->curr is a cached value which stores\n+\t\t\t * the correct current backlight level in most cases.\n+\t\t\t * ACPI video backlight still works w/ buggy _BQC.\n+\t\t\t * http://bugzilla.kernel.org/show_bug.cgi?id=12233\n+\t\t\t */\n+\t\t\tACPI_WARNING((AE_INFO, \"Evaluating _BQC failed\"));\n+\t\t\tdevice->cap._BQC = 0;\n+\t\t}\n+\t}\n+\n \t*level = device->brightness->curr;\n-\treturn AE_OK;\n+\treturn 0;\n }\n \n static int\n@@ -655,7 +699,8 @@ static int\n acpi_video_init_brightness(struct acpi_video_device *device)\n {\n \tunion acpi_object *obj = NULL;\n-\tint i, max_level = 0, count = 0;\n+\tint i, max_level = 0, count = 0, level_ac_battery = 0;\n+\tunsigned long long level;\n \tunion acpi_object *o;\n \tstruct acpi_video_device_brightness *br = NULL;\n \n@@ -674,7 +719,7 @@ acpi_video_init_brightness(struct acpi_v\n \t\tgoto out;\n \t}\n \n-\tbr->levels = kmalloc(obj->package.count * sizeof *(br->levels),\n+\tbr->levels = kmalloc((obj->package.count + 2) * sizeof *(br->levels),\n \t\t\t\tGFP_KERNEL);\n \tif (!br->levels)\n \t\tgoto out_free;\n@@ -692,16 +737,75 @@ acpi_video_init_brightness(struct acpi_v\n \t\tcount++;\n \t}\n \n-\t/* don't sort the first two brightness levels */\n-\tsort(&br->levels[2], count - 2, sizeof(br->levels[2]),\n-\t\tacpi_video_cmp_level, NULL);\n+\t/*\n+\t * some buggy BIOS don't export the levels\n+\t * when machine is on AC/Battery in _BCL package.\n+\t * In this case, the first two elements in _BCL packages\n+\t * are also supported brightness levels that OS should take care of.\n+\t */\n+\tfor (i = 2; i < count; i++)\n+\t\tif (br->levels[i] == br->levels[0] ||\n+\t\t    br->levels[i] == br->levels[1])\n+\t\t\tlevel_ac_battery++;\n \n-\tif (count < 2)\n+\tif (level_ac_battery > 2) {\n+\t\tACPI_ERROR((AE_INFO, \"Two many duplicates in _BCL package\\n\"));\n+\t\tgoto out_free_levels;\n+\t} else if (level_ac_battery < 2) {\n+\t\tlevel_ac_battery = 2 - level_ac_battery;\n+\t\tbr->flags._BCL_no_ac_battery_levels = 1;\n+\t\tfor (i = (count - 1 + level_ac_battery); i >= 2; i--)\n+\t\t\tbr->levels[i] = br->levels[i - level_ac_battery];\n+\t\tcount += level_ac_battery;\n+\t}\n+\n+\t/* Check if the _BCL package is in a reversed order */\n+\tif (max_level == br->levels[2]) {\n+\t\tbr->flags._BCL_reversed = 1;\n+\t\tsort(&br->levels[2], count - 2, sizeof(br->levels[2]),\n+\t\t\tacpi_video_cmp_level, NULL);\n+\t} else if (max_level != br->levels[count - 1]) {\n+\t\tACPI_ERROR((AE_INFO,\n+\t\t\t    \"Brightness levels in _BCL is in a mess\\n\"));\n \t\tgoto out_free_levels;\n+\t}\n \n \tbr->count = count;\n \tdevice->brightness = br;\n-\tACPI_DEBUG_PRINT((ACPI_DB_INFO, \"found %d brightness levels\\n\", count));\n+\n+\t/* Check the input/output of _BQC/_BCL/_BCM */\n+\tif ((max_level < 100) && (max_level <= (count - 2)))\n+\t\tbr->flags._BCL_use_index = 1;\n+\n+\t/*\n+\t * _BCM is always consistent with _BCL,\n+\t * at least for all the laptops we have ever seen.\n+\t */\n+\tbr->flags._BCM_use_index = br->flags._BCL_use_index;\n+\n+\t/* _BQC uses INDEX while _BCL uses VALUE in some laptops */\n+\tif (acpi_video_device_lcd_set_level(device, max_level))\n+\t\tgoto out_free_levels;\n+\n+\tif (acpi_video_device_lcd_get_level_current(device, &level))\n+\t\tgoto out_free_levels;\n+\n+\tif ((level != max_level) && !br->flags._BCM_use_index) {\n+\t\tif (level_ac_battery != 2) {\n+\t\t\t/*\n+\t\t\t * For now, we don't support the _BCL like this:\n+\t\t\t * 16, 15, 0, 1, 2, 3, ..., 14, 15, 16\n+\t\t\t * because we may mess up the index returned by _BQC.\n+\t\t\t * Plus: we have not got a box like this.\n+\t\t\t */\n+\t\t\tACPI_ERROR((AE_INFO, \"_BCL not supported\\n\"));\n+\t\t\tgoto out_free_levels;\n+\t\t}\n+\t\tbr->flags._BQC_use_index = 1;\n+\t}\n+\n+\tACPI_DEBUG_PRINT((ACPI_DB_INFO,\n+\t\t\t  \"found %d brightness levels\\n\", count - 2));\n \tkfree(obj);\n \treturn max_level;\n \n@@ -773,18 +877,8 @@ static void acpi_video_device_find_cap(s\n \t\tdevice->backlight = backlight_device_register(name,\n \t\t\tNULL, device, &acpi_backlight_ops);\n \t\tdevice->backlight->props.max_brightness = device->brightness->count-3;\n-\t\t/*\n-\t\t * If there exists the _BQC object, the _BQC object will be\n-\t\t * called to get the current backlight brightness. Otherwise\n-\t\t * the brightness will be set to the maximum.\n-\t\t */\n-\t\tif (device->cap._BQC)\n-\t\t\tdevice->backlight->props.brightness =\n-\t\t\t\tacpi_video_get_brightness(device->backlight);\n-\t\telse\n-\t\t\tdevice->backlight->props.brightness =\n-\t\t\t\tdevice->backlight->props.max_brightness;\n-\t\tbacklight_update_status(device->backlight);\n+\t\tdevice->backlight->props.brightness =\n+\t\t\tacpi_video_get_brightness(device->backlight);\n \t\tkfree(name);\n \n \t\tdevice->cdev = thermal_cooling_device_register(\"LCD\",\n@@ -1061,13 +1155,12 @@ acpi_video_device_write_brightness(struc\n \t/* validate through the list of available levels */\n \tfor (i = 2; i < dev->brightness->count; i++)\n \t\tif (level == dev->brightness->levels[i]) {\n-\t\t\tif (ACPI_SUCCESS\n-\t\t\t    (acpi_video_device_lcd_set_level(dev, level)))\n-\t\t\t\tdev->brightness->curr = level;\n+\t\t\tif (!acpi_video_device_lcd_set_level(dev, level))\n+\t\t\t\treturn count;\n \t\t\tbreak;\n \t\t}\n \n-\treturn count;\n+\treturn -EINVAL;\n }\n \n static int acpi_video_device_EDID_seq_show(struct seq_file *seq, void *offset)\n@@ -1749,15 +1842,29 @@ acpi_video_get_next_level(struct acpi_vi\n \t}\n }\n \n-static void\n+static int\n acpi_video_switch_brightness(struct acpi_video_device *device, int event)\n {\n \tunsigned long long level_current, level_next;\n+\tint result = -EINVAL;\n+\n \tif (!device->brightness)\n-\t\treturn;\n-\tacpi_video_device_lcd_get_level_current(device, &level_current);\n+\t\tgoto out;\n+\n+\tresult = acpi_video_device_lcd_get_level_current(device,\n+\t\t\t\t\t\t\t &level_current);\n+\tif (result)\n+\t\tgoto out;\n+\n \tlevel_next = acpi_video_get_next_level(device, level_current, event);\n-\tacpi_video_device_lcd_set_level(device, level_next);\n+\n+\tresult = acpi_video_device_lcd_set_level(device, level_next);\n+\n+out:\n+\tif (result)\n+\t\tprintk(KERN_ERR PREFIX \"Failed to switch the brightness\\n\");\n+\n+\treturn result;\n }\n \n static int\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "Power-Video", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Zhang Rui", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2008-12-26 01:44 UTC by Evgeniy Manachkin", "Modified": "2009-04-07 03:02 UTC", "CC List": "3 users", "See Also": "", "Kernel Version": "2.6.28", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/acpi/video.c"], "methods": ["acpi_video_get_brightness", "video_get_cur_state", "acpi_video_device_lcd_set_level", "acpi_video_device_lcd_get_level_current", "acpi_video_init_brightness", "acpi_video_device_find_cap", "acpi_video_device_write_brightness", "acpi_video_switch_brightness", "struct acpi_video_device_cap", "acpi_video_device_brightness"]}
{"id": "12286", "title": "[Patch] tc1100-wmi: sysfs entries always 0", "description": "Latest working kernel version: 2.6.22\nEarliest failing kernel version: 2.6.25\nDistribution: Ubuntu\n\nProblem Description:\nThe tc1100-wmi driver should print the current states of wireless LAN and jogdial brightness control when \"cat /sys/devices/platform/tc1100-wmi/wireless\" and \"cat /sys/devices/platform/tc1100-wmi/jogdial\" are executed, respectively. What actually happens is that both of those commands print 0 regardless of the hardware state. The cause is that wmi_query_block returns an ACPI_TYPE_INTEGER rather than ACPI_TYPE_BUFFER as the driver assumes. Additionally, the driver intends to return a jogdial state that is inverted with respect to the commands required to set it (e.g. it intends to return 1 after the jogdial file was written with 0).", "patch": ["--- linux-2.6.27/drivers/misc/tc1100-wmi.c\t2008-10-10 00:13:53.000000000 +0200\n+++ linux/drivers/misc/tc1100-wmi.c\t2008-12-25 02:58:48.000000000 +0100\n@@ -95,9 +95,8 @@\n \t\treturn -ENODEV;\n \n \tobj = (union acpi_object *) result.pointer;\n-\tif (obj && obj->type == ACPI_TYPE_BUFFER &&\n-\t\tobj->buffer.length == sizeof(u32)) {\n-\t\ttmp = *((u32 *) obj->buffer.pointer);\n+\tif (obj && obj->type == ACPI_TYPE_INTEGER) {\n+\t\ttmp = obj->integer.value;\n \t} else {\n \t\ttmp = 0;\n \t}\n@@ -110,7 +109,7 @@\n \t\t*out = (tmp == 3) ? 1 : 0;\n \t\treturn 0;\n \tcase TC1100_INSTANCE_JOGDIAL:\n-\t\t*out = (tmp == 1) ? 1 : 0;\n+\t\t*out = (tmp == 1) ? 0 : 1;\n \t\treturn 0;\n \tdefault:\n \t\treturn -ENODEV;\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Platform", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "acpi_platform-drivers@kernel-bugs.osdl.org", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2008-12-24 17:44 UTC by Krzysztof Kosiński", "Modified": "2010-10-08 18:20 UTC", "CC List": "1 user", "See Also": "", "Kernel Version": "2.6.27", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/misc/tc1100-wmi.c"], "methods": ["get_state"]}
{"id": "12270", "title": "Almost all my devices are not recongnized by  kernel-2.6.27, 2.6-28", "description": "Latest working kernel version:kernel 2.6.24\n\nEarliest failing kernel version: kernel 2.6.27\n\nDistribution: Mandriva\nHardware Environment: Atlon AMD 1800+,\n\nSoftware Environment: KDE\n\nProblem Description: As said in the summary, with kernel 2-6-27 and 2-6-28 (thos ones are availables in mandriva repositories), all my devices are not recognized by the kernel. So, I have no printers, no internet, no webcam.....\nWith kernel 2-6-24, everything is fine. The bug is not due to patched  mandriva kernel since I used a pure linux version kernel.\n\nSteps to reproduce:Just boot the kernel", "patch": ["From: Zhang Rui <rui.zhang@intel.com>\nSubject: revert 2f894e\n\ncommit 2f894ef9 and commit d0e184ab are for the same issue.\nrevert 2f894ef9 to keep compatibility with ACPICA.\n\nSigned-off-by: Zhang Rui <rui.zhang@intel.com>\n---\n drivers/acpi/resources/rscreate.c |   27 ++-------------------------\n 1 file changed, 2 insertions(+), 25 deletions(-)\n\nIndex: linux-2.6/drivers/acpi/resources/rscreate.c\n===================================================================\n--- linux-2.6.orig/drivers/acpi/resources/rscreate.c\n+++ linux-2.6/drivers/acpi/resources/rscreate.c\n@@ -190,8 +190,6 @@ acpi_rs_create_pci_routing_table(union a\n \tuser_prt = ACPI_CAST_PTR(struct acpi_pci_routing_table, buffer);\n \n \tfor (index = 0; index < number_of_elements; index++) {\n-\t\tint source_name_index = 2;\n-\t\tint source_index_index = 3;\n \n \t\t/*\n \t\t * Point user_prt past this current structure\n@@ -260,27 +258,6 @@ acpi_rs_create_pci_routing_table(union a\n \t\t\treturn_ACPI_STATUS(AE_BAD_DATA);\n \t\t}\n \n-\t\t/*\n-\t\t * If BIOS erroneously reversed the _PRT source_name and source_index,\n-\t\t * then reverse them back.\n-\t\t */\n-\t\tif (ACPI_GET_OBJECT_TYPE(sub_object_list[3]) !=\n-\t\t    ACPI_TYPE_INTEGER) {\n-\t\t\tif (acpi_gbl_enable_interpreter_slack) {\n-\t\t\t\tsource_name_index = 3;\n-\t\t\t\tsource_index_index = 2;\n-\t\t\t\tprintk(KERN_WARNING\n-\t\t\t\t       \"ACPI: Handling Garbled _PRT entry\\n\");\n-\t\t\t} else {\n-\t\t\t\tACPI_ERROR((AE_INFO,\n-\t\t\t\t\t    \"(PRT[%X].source_index) Need Integer, found %s\",\n-\t\t\t\t\t    index,\n-\t\t\t\t\t    acpi_ut_get_object_type_name\n-\t\t\t\t\t    (sub_object_list[3])));\n-\t\t\t\treturn_ACPI_STATUS(AE_BAD_DATA);\n-\t\t\t}\n-\t\t}\n-\n \t\tuser_prt->pin = (u32) obj_desc->integer.value;\n \n \t\t/*\n@@ -304,7 +281,7 @@ acpi_rs_create_pci_routing_table(union a\n \t\t * 3) Third subobject: Dereference the PRT.source_name\n \t\t * The name may be unresolved (slack mode), so allow a null object\n \t\t */\n-\t\tobj_desc = sub_object_list[source_name_index];\n+\t\tobj_desc = sub_object_list[2];\n \t\tif (obj_desc) {\n \t\t\tswitch (ACPI_GET_OBJECT_TYPE(obj_desc)) {\n \t\t\tcase ACPI_TYPE_LOCAL_REFERENCE:\n@@ -378,7 +355,7 @@ acpi_rs_create_pci_routing_table(union a\n \n \t\t/* 4) Fourth subobject: Dereference the PRT.source_index */\n \n-\t\tobj_desc = sub_object_list[source_index_index];\n+\t\tobj_desc = sub_object_list[3];\n \t\tif (ACPI_GET_OBJECT_TYPE(obj_desc) != ACPI_TYPE_INTEGER) {\n \t\t\tACPI_ERROR((AE_INFO,\n \t\t\t\t    \"(PRT[%X].SourceIndex) Need Integer, found %s\",\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "ACPICA-Core", "Hardware": "All Linux", "Importance": "P1 high", "Assignee": "Zhang Rui", "URL": "", "Keywords": "", "Duplicates (1)": "12976", "Depends on": "", "Blocks": "", "Reported": "2008-12-22 01:20 UTC by paul", "Modified": "2009-06-23 01:40 UTC", "CC List": "5 users", "See Also": "", "Kernel Version": "2.6.27", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/acpi/resources/rscreate.c"], "methods": ["acpi_rs_create_pci_routing_table"]}
{"id": "12239", "title": "Swap breaks after 2x hibernation failure due to lack of swap", "": "Show dependency tree", "description": "Distribution: Ubuntu 8.10\nHardware Environment: x86-64\nProblem Description:\n\nIf there is not enough swap to hibernate sucessfuly, and you try to hibernate twice in a row, the status of swap partitions is corrupted.\n\nSteps to reproduce:\n\n1) Conspire to ensure insufficient swap space for hibernation\n2) Attempt to hibernate, and fail\n3) Attempt to hibernate *again*, and fail\n4) try swapoff\n\nOutcome:\n\n# swapoff /dev/sda6\nswapoff: /dev/sda6: Invalid argument\n# cat /proc/swaps\nFilename                                Type            Size    Used   \nPriority\n/dev/sda6                               partition       1494004 1350564 -1\n\nMore details about the resulting behaviour:\n\nIncidentally \"swapoff -a\" fails silently, which I think is a bug in\nswapoff (i.e. it should report the error).\n\nI don't see any backtraces in dmesg; the only errors it shows is the\nfailure to hibernate\n\nIf I free up some memory and try to hibernate again, I get a different\nerror - \"Cannot find swap device, try swapon -a.\".  Now swapon -a\ndoesn't work, but if I target the specific device...\n\n# swapon /dev/sda6\n# cat /proc/swaps\nFilename                                Type            Size    Used   \nPriority\n/dev/sda6                               partition       1494004 331060  -1\n/dev/sda6                               partition       1494004 0       -2\n\nWheee!  Interestingly I can now hibernate and resume.  But it's not\nsafe; my desktop session dies horribly.\n\nThanks\nAlan\n\n[ 1541.499324] kdeinit[10614]: segfault at 0 ip 00007fbd8515139a sp\n00007fff8e04cf80 error 4 in libc-2.7.so[7fbd850dc000+158000]\n[ 1541.520988] kdeinit[7322]: segfault at 0 ip 00007fbd8515139a sp\n00007fff8e04cf50 error 4 in libc-2.7.so[7fbd850dc000+158000]\n[ 1541.545512] kio_file[7343]: segfault at ffffffff00000000 ip\nffffffff00000000 sp 00007fff8e04c8a8 error 14\n[ 1541.680883] Xorg[6928]: segfault at 692 ip 00007fb391c5bb92 sp\n00007fff99e6a6c0 error 4 in ld-2.7.so[7fb391c4e000+1d000]\n\n(ignore this bit, I think it happens every time X starts)\n[ 1541.686628] Xorg:6928 freeing invalid memtype d0020000-d002a000\n[ 1541.686748] Xorg:6928 freeing invalid memtype d002a000-d0032000\n[ 1541.686848] Xorg:6928 freeing invalid memtype d0032000-d0042000\n[ 1541.686948] Xorg:6928 freeing invalid memtype d0042000-d0043000\n[ 1541.687221] Xorg:6928 freeing invalid memtype d0100000-d0740000\n[ 1541.687421] Xorg:6928 freeing invalid memtype d077f000-d1a00000\n[ 1541.687549] Xorg:6928 freeing invalid memtype d1a00000-d2040000\n[ 1541.687649] Xorg:6928 freeing invalid memtype d2040000-d2680000\n[ 1541.687750] Xorg:6928 freeing invalid memtype d2680000-d4680000\n[ 1542.116794] Xorg:6928 freeing invalid memtype d0000000-d0020000\n\n[ 1542.343673] pidgin[7505] general protection ip:7fcfdab92c92\nsp:7fffe4e46ca0 error:0 in libX11.so.6.2.0[7fcfdab52000+ff000]\n[ 1542.366374] update-notifier[7372] general protection ip:7f543a2acb92\nsp:7fff424bc4a0 error:0 in ld-2.7.so[7f543a29f000+1d000]\n[ 1545.569879] skge eth2: disabling interface\n[ 1545.575729] skge eth2: enabling interface\n[ 1545.579087] ADDRCONF(NETDEV_UP): eth2: link is not ready\n[ 1546.966466] gedit[7423]: segfault at ffff88003740d448 ip\n00007fb76a5d9053 sp 00007fff7ecf11d0 error 5 in\nlibqt-mt.so.3.3.8[7fb76a1f8000+9df000]\n[ 1547.262323] skge eth2: Link is up at 100 Mbps, full duplex, flow\ncontrol both\n[ 1547.262656] ADDRCONF(NETDEV_CHANGE): eth2: link becomes ready\n[ 1547.831519] evince[7916] general protection ip:7f92c525b794\nsp:7fffcd46a680 error:0 in ld-2.7.so[7f92c524d000+1d000]\n[ 1547.964072] python[7526]: segfault at 200515 ip 00007f98515237e3 sp\n00007fff59737530 error 4 in ld-2.7.so[7f985151a000+1d000]\n[ 1549.013419] console-kit-dae[6506]: segfault at 28 ip 00007f310cf8b7c5\nsp 00007fff1519ef40 error 4 in ld-2.7.so[7f310cf82000+1d000]\n[ 1557.926527] eth2: no IPv6 routers present\n[ 1568.747175] dcopserver[7325]: segfault at 4617998 ip 00007fbd85111409\nsp 00007fff8e04c7e0 error 4 in libc-2.7.so[7fbd850dc000+158000]\n[ 1569.959891] eth2: no IPv6 routers present", "patch": ["diff --git a/mm/swapfile.c b/mm/swapfile.c\nindex f48b831..7740478 100644\n--- a/mm/swapfile.c\n+++ b/mm/swapfile.c\n@@ -635,7 +635,7 @@ int swap_type_of(dev_t device, sector_t offset, struct block_device **bdev_p)\n \n \t\tif (!bdev) {\n \t\t\tif (bdev_p)\n-\t\t\t\t*bdev_p = sis->bdev;\n+\t\t\t\t*bdev_p = bdget(sis->bdev->bd_dev);\n \n \t\t\tspin_unlock(&swap_lock);\n \t\t\treturn i;\n@@ -647,7 +647,7 @@ int swap_type_of(dev_t device, sector_t offset, struct block_device **bdev_p)\n \t\t\t\t\tstruct swap_extent, list);\n \t\t\tif (se->start_block == offset) {\n \t\t\t\tif (bdev_p)\n-\t\t\t\t\t*bdev_p = sis->bdev;\n+\t\t\t\t\t*bdev_p = bdget(sis->bdev->bd_dev);\n \n \t\t\t\tspin_unlock(&swap_lock);\n \t\t\t\tbdput(bdev);\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Power Management", "Classification": "Unclassified", "Component": "Hibernation/Suspend", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "power-management_other", "URL": "", "Keywords": "", "Duplicates (1)": "12241", "Depends on": "", "Blocks": "7216", "Reported": "2008-12-16 13:14 UTC by Alan Jenkins", "Modified": "2009-03-19 04:05 UTC", "CC List": "3 users", "See Also": "", "Kernel Version": "2.6.27", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["mm/swapfile.c"], "methods": ["swap_type_of"]}
{"id": "12216", "title": "Error when drm is loaded", "": "Show dependency tree", "description": "Latest working kernel version: maybe 2.6.28-rc6\nEarliest failing kernel version: 2.6.28-rc8\nDistribution: Gentoo\nHardware Environment: Acer Travelmate 4001 Lmi, ATI Radeon Mobility 9700\nSoftware Environment:\nProblem Description:\n\nSteps to reproduce:\n\nWhen the drm module is loaded during X startup, I get the following error:\n\n[   55.642188] [drm] Initialized drm 1.1.0 20060810\n[   55.757559] [drm] Initialized radeon 1.29.0 20080528 on minor 0\n[   56.920297] agpgart-intel 0000:00:00.0: AGP 2.0 bridge\n[   56.920314] agpgart-intel 0000:00:00.0: putting AGP V2 device into 4x mode\n[   56.920347] pci 0000:01:00.0: putting AGP V2 device into 4x mode\n[   57.686654] irq 6: nobody cared (try booting with the \"irqpoll\" option)\n[   57.686660] Pid: 7472, comm: X Not tainted 2.6.28-rc8-git #22\n[   57.686663] Call Trace:\n[   57.686671]  [<c0453414>] __report_bad_irq+0x24/0x90\n[   57.686675]  [<c04535e9>] note_interrupt+0x169/0x1b0\n[   57.686679]  [<c0452575>] handle_IRQ_event+0x25/0x60\n[   57.686683]  [<c0453fa0>] handle_level_irq+0x0/0xa0\n[   57.686686]  [<c045401c>] handle_level_irq+0x7c/0xa0\n[   57.686688]  <IRQ>  [<c04218c0>] __do_softirq+0x0/0x100\n[   57.686695]  [<c0404727>] common_interrupt+0x23/0x28\n[   57.686698]  [<c04218c0>] __do_softirq+0x0/0x100\n[   57.686702]  [<c04218eb>] __do_softirq+0x2b/0x100\n[   57.686705]  [<c04218c0>] __do_softirq+0x0/0x100\n[   57.686707]  <IRQ>  [<c0421895>] irq_exit+0x45/0x70\n[   57.686712]  [<c0405e1f>] do_IRQ+0x7f/0xd0\n[   57.686718]  [<c05dbbbe>] io_schedule+0xe/0x20\n[   57.686721]  [<c0404727>] common_interrupt+0x23/0x28\n[   57.686731]  [<e0ee007b>] radeon_cp_dispatch_vertex+0x22b/0x370 [radeon]\n[   57.686747]  [<e0df591f>] drm_vblank_get+0x3f/0x160 [drm]\n[   57.686751]  [<c0457b61>] filemap_fault+0xe1/0x3d0\n[   57.686763]  [<e0df5f5f>] drm_modeset_ctl+0x9f/0xb0 [drm]\n[   57.686775]  [<e0df5ec0>] drm_modeset_ctl+0x0/0xb0 [drm]\n[   57.686786]  [<e0df43fa>] drm_ioctl+0x1ba/0x2f0 [drm]\n[   57.686791]  [<c046369e>] __do_fault+0x15e/0x390\n[   57.686802]  [<e0df4240>] drm_ioctl+0x0/0x2f0 [drm]\n[   57.686807]  [<c0484dc9>] vfs_ioctl+0x69/0x70\n[   57.686810]  [<c0484f6c>] do_vfs_ioctl+0x5c/0x430\n[   57.686815]  [<c0414680>] do_page_fault+0x0/0x6c0\n[   57.686819]  [<c041490c>] do_page_fault+0x28c/0x6c0\n[   57.686824]  [<c047a2b6>] vfs_write+0x106/0x140\n[   57.686853]  [<e1052c00>] reiserfs_file_write+0x0/0xc0 [reiserfs]\n[   57.686857]  [<c04853a8>] sys_ioctl+0x68/0x80\n[   57.686860]  [<c0403bd9>] sysenter_do_call+0x12/0x25\n[   57.686865]  [<c05d0000>] unix_bind+0xd0/0x2b0\n[   57.686867] handlers:\n[   57.686868] [<e0d604a0>] (usb_hcd_irq+0x0/0x70 [usbcore])\n[   57.686895] [<e0d604a0>] (usb_hcd_irq+0x0/0x70 [usbcore])\n[   57.686915] [<e0d604a0>] (usb_hcd_irq+0x0/0x70 [usbcore])\n[   57.686934] [<e0e1da30>] (b44_interrupt+0x0/0x100 [b44])\n[   57.686944] Disabling IRQ #6\n[   58.899533] [drm] Setting GART location based on new memory map\n[   58.899541] [drm] Loading R300 Microcode\n[   58.899589] [drm] Num pipes: 1\n[   58.899595] [drm] writeback test succeeded in 1 usecs\n\nIt doesn't seems to cause any serious problem. Does anybody have any idea about this error ?", "patch": ["From db029d51a97d908bc981cf53b3ee78c5de30e019 Mon Sep 17 00:00:00 2001\nFrom: Dave Airlie <airlied@redhat.com>\nDate: Mon, 22 Dec 2008 17:11:02 +1000\nSubject: [PATCH] radeon: fix correctness of irq_enabled check for radeon.\n\nThis check was introduced the wrong way around.\n\nSigned-off-by: Dave Airlie <airlied@redhat.com>\n---\n drivers/gpu/drm/radeon/radeon_irq.c |    4 ++--\n 1 files changed, 2 insertions(+), 2 deletions(-)\n\ndiff --git a/drivers/gpu/drm/radeon/radeon_irq.c b/drivers/gpu/drm/radeon/radeon_irq.c\nindex 99be114..8289e16 100644\n--- a/drivers/gpu/drm/radeon/radeon_irq.c\n+++ b/drivers/gpu/drm/radeon/radeon_irq.c\n@@ -44,7 +44,7 @@ void radeon_irq_set_state(struct drm_device *dev, u32 mask, int state)\n \telse\n \t\tdev_priv->irq_enable_reg &= ~mask;\n \n-\tif (!dev->irq_enabled)\n+\tif (dev->irq_enabled)\n \t\tRADEON_WRITE(RADEON_GEN_INT_CNTL, dev_priv->irq_enable_reg);\n }\n \n@@ -57,7 +57,7 @@ static void r500_vbl_irq_set_state(struct drm_device *dev, u32 mask, int state)\n \telse\n \t\tdev_priv->r500_disp_irq_reg &= ~mask;\n \n-\tif (!dev->irq_enabled)\n+\tif (dev->irq_enabled)\n \t\tRADEON_WRITE(R500_DxMODE_INT_MASK, dev_priv->r500_disp_irq_reg);\n }\n \n-- \n1.6.0.3\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Video", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Dave Airlie", "URL": "", "Keywords": "", "Duplicates (1)": "12178", "Depends on": "", "Blocks": "11808", "Reported": "2008-12-13 09:59 UTC by François Valenduc", "Modified": "2009-01-11 10:41 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "2.6.28-rc8", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/gpu/drm/radeon/radeon_irq.c"], "methods": ["radeon_irq_set_state", "r500_vbl_irq_set_state"]}
{"id": "12061", "title": "snd_hda_intel: power_save: sound cracks on powerdown", "": "Show dependency tree", "description": "Latest working kernel version: 2.6.27.6\nEarliest failing kernel version: 2.6.28-rc? (I'm thinking that it works sometime ago with 2.6.28)\nDistribution: Gentoo\nHardware Environment: Dell Latitude D830\nProblem Description:\nIf power_save is greater 0 the speakers make a cracking noise on powerdown after the specified timeout\n\nSteps to reproduce:\nload snd_hda_intel with power_save=5\nPlay a sound and wait 5 secs.\n\n\n---------------------------\n# cat /proc/asound/cards\n 0 [Intel          ]: HDA-Intel - HDA Intel\n                      HDA Intel at 0xf6adc000 irq 21\n\n# cat /proc/asound/pcm\n00-00: STAC92xx Analog : STAC92xx Analog : playback 1 : capture 2", "patch": ["diff --git a/sound/pci/hda/patch_sigmatel.c b/sound/pci/hda/patch_sigmatel.c\nindex 7cd395a..5653ff9 100644\n--- a/sound/pci/hda/patch_sigmatel.c\n+++ b/sound/pci/hda/patch_sigmatel.c\n@@ -4203,7 +4203,7 @@ static int stac92xx_resume(struct hda_codec *codec)\n static int stac92xx_suspend(struct hda_codec *codec, pm_message_t state)\n {\n \tstruct sigmatel_spec *spec = codec->spec;\n-\tif (spec->eapd_mask)\n+\tif (0 && spec->eapd_mask)\n \t\tstac_gpio_set(codec, spec->gpio_mask,\n \t\t\t\tspec->gpio_dir, spec->gpio_data &\n \t\t\t\t~spec->eapd_mask);\n", "diff --git a/sound/pci/hda/patch_sigmatel.c b/sound/pci/hda/patch_sigmatel.c\nindex 9563b5b..c313fd7 100644\n--- a/sound/pci/hda/patch_sigmatel.c\n+++ b/sound/pci/hda/patch_sigmatel.c\n@@ -2305,7 +2305,7 @@ static int stac92xx_capture_pcm_prepare(struct hda_pcm_stream *hinfo,\n \n \tif (spec->powerdown_adcs) {\n \t\tmsleep(40);\n-\t\tsnd_hda_codec_write_cache(codec, nid, 0,\n+\t\tsnd_hda_codec_write(codec, nid, 0,\n \t\t\tAC_VERB_SET_POWER_STATE, AC_PWRST_D0);\n \t}\n \tsnd_hda_codec_setup_stream(codec, nid, stream_tag, 0, format);\n@@ -2321,7 +2321,7 @@ static int stac92xx_capture_pcm_cleanup(struct hda_pcm_stream *hinfo,\n \n \tsnd_hda_codec_cleanup_stream(codec, nid);\n \tif (spec->powerdown_adcs)\n-\t\tsnd_hda_codec_write_cache(codec, nid, 0,\n+\t\tsnd_hda_codec_write(codec, nid, 0,\n \t\t\tAC_VERB_SET_POWER_STATE, AC_PWRST_D3);\n \treturn 0;\n }\n@@ -3679,7 +3679,7 @@ static void stac92xx_power_down(struct hda_codec *codec)\n \tfor (dac = spec->dac_list; *dac; dac++)\n \t\tif (!is_in_dac_nids(spec, *dac) &&\n \t\t\tspec->multiout.hp_nid != *dac)\n-\t\t\tsnd_hda_codec_write_cache(codec, *dac, 0,\n+\t\t\tsnd_hda_codec_write(codec, *dac, 0,\n \t\t\t\t\tAC_VERB_SET_POWER_STATE, AC_PWRST_D3);\n }\n \n@@ -3694,7 +3694,7 @@ static int stac92xx_init(struct hda_codec *codec)\n \t/* power down adcs initially */\n \tif (spec->powerdown_adcs)\n \t\tfor (i = 0; i < spec->num_adcs; i++)\n-\t\t\tsnd_hda_codec_write_cache(codec,\n+\t\t\tsnd_hda_codec_write(codec,\n \t\t\t\tspec->adc_nids[i], 0,\n \t\t\t\tAC_VERB_SET_POWER_STATE, AC_PWRST_D3);\n \t/* set up pins */\n@@ -4395,48 +4395,6 @@ again:\n \treturn 0;\n }\n \n-#ifdef SND_HDA_NEEDS_RESUME\n-static void stac92hd71xx_set_power_state(struct hda_codec *codec, int pwr)\n-{\n-\tstruct sigmatel_spec *spec = codec->spec;\n-\tint i;\n-\tsnd_hda_codec_write_cache(codec, codec->afg, 0,\n-\t\tAC_VERB_SET_POWER_STATE, pwr);\n-\n-\tmsleep(1);\n-\tfor (i = 0; i < spec->num_adcs; i++) {\n-\t\tsnd_hda_codec_write_cache(codec,\n-\t\t\tspec->adc_nids[i], 0,\n-\t\t\tAC_VERB_SET_POWER_STATE, pwr);\n-\t}\n-};\n-\n-static int stac92hd71xx_resume(struct hda_codec *codec)\n-{\n-\tstac92hd71xx_set_power_state(codec, AC_PWRST_D0);\n-\treturn stac92xx_resume(codec);\n-}\n-\n-static int stac92hd71xx_suspend(struct hda_codec *codec, pm_message_t state)\n-{\n-\tstac92hd71xx_set_power_state(codec, AC_PWRST_D3);\n-\treturn 0;\n-};\n-\n-#endif\n-\n-static struct hda_codec_ops stac92hd71bxx_patch_ops = {\n-\t.build_controls = stac92xx_build_controls,\n-\t.build_pcms = stac92xx_build_pcms,\n-\t.init = stac92xx_init,\n-\t.free = stac92xx_free,\n-\t.unsol_event = stac92xx_unsol_event,\n-#ifdef SND_HDA_NEEDS_RESUME\n-\t.resume = stac92hd71xx_resume,\n-\t.suspend = stac92hd71xx_suspend,\n-#endif\n-};\n-\n static struct hda_input_mux stac92hd71bxx_dmux = {\n \t.num_items = 4,\n \t.items = {\n@@ -4511,12 +4469,8 @@ again:\n \t\t\tbreak;\n \t\t}\n \t\tif ((codec->revision_id & 0xf) == 0 ||\n-\t\t\t\t(codec->revision_id & 0xf) == 1) {\n-#ifdef SND_HDA_NEEDS_RESUME\n-\t\t\tcodec->patch_ops = stac92hd71bxx_patch_ops;\n-#endif\n+\t\t\t\t(codec->revision_id & 0xf) == 1)\n \t\t\tspec->stream_delay = 40; /* 40 milliseconds */\n-\t\t}\n \n \t\t/* no output amps */\n \t\tspec->num_pwrs = 0;\n@@ -4528,12 +4482,8 @@ again:\n \t\tstac92xx_set_config_reg(codec, 0xf, 0x40f000f0);\n \t\tbreak;\n \tcase 0x111d7603: /* 6 Port with Analog Mixer */\n-\t\tif ((codec->revision_id & 0xf) == 1) {\n-#ifdef SND_HDA_NEEDS_RESUME\n-\t\t\tcodec->patch_ops = stac92hd71bxx_patch_ops;\n-#endif\n+\t\tif ((codec->revision_id & 0xf) == 1)\n \t\t\tspec->stream_delay = 40; /* 40 milliseconds */\n-\t\t}\n \n \t\t/* no output amps */\n \t\tspec->num_pwrs = 0;\n", "diff --git a/sound/pci/hda/patch_sigmatel.c b/sound/pci/hda/patch_sigmatel.c\nindex 4c851fd..7746d39 100644\n--- a/sound/pci/hda/patch_sigmatel.c\n+++ b/sound/pci/hda/patch_sigmatel.c\n@@ -4344,6 +4344,10 @@ static int stac92xx_suspend(struct hda_codec *codec, pm_message_t state)\n \t\tstac_gpio_set(codec, spec->gpio_mask,\n \t\t\t\tspec->gpio_dir, spec->gpio_data &\n \t\t\t\t~spec->eapd_mask);\n+\t/* analog pins power down */\n+\tif (spec->pwr_nids)\n+\t\tsnd_hda_codec_write(codec, codec->afg, 0, 0x7ec, 0);\n+\n \treturn 0;\n }\n #endif\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Sound", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Takashi Iwai", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "11808", "Reported": "2008-11-18 12:07 UTC by Jens Weibler", "Modified": "2009-11-24 00:39 UTC", "CC List": "7 users", "See Also": "", "Kernel Version": "2.6.28-rc5", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["sound/pci/hda/patch_sigmatel.c"], "methods": ["stac92xx_suspend"]}
{"id": "11957", "title": "oops on reading /proc/capi/controller after removing b1isa", "description": "Latest working kernel version: unknown\nEarliest failing kernel version: unknown\nDistribution: debian, kernel self-built\nHardware Environment: x86 system with B1 ISA ISDN controller\nSoftware Environment: debian unstable\nProblem Description: oops on reading /proc/capi/controller after rmmod b1isa\n\nSteps to reproduce:\n- verify a B1 ISA is shown in /proc/capi/controller\n- rmmod b1isa\n- cat /proc/capi/controller", "patch": ["Reading /proc/capi/controller after removing b1isa oopses because\ncapi_ctrl->procinfo is called for the wrongly not unregistered\ncontroller, which points to b1isa_procinfo(), which was removed on\nmodule unload.\n\nb1isa_exit() did not call b1isa_remove() for its controllers because\nio[0] == 0 on module unload.\n\nBesides, just removing the controllers that where added on module\nload time and not those that were added later via b1isa_add_card() is\nwrong too - the place where all added cards are found is isa_dev[].\n\nSigned-off-by: Wilfried Klaebe <linux-kernel@lebenslange-mailadresse.de>\n\ndiff -pru linux-2.6.27.4.ori/drivers/isdn/hardware/avm/b1isa.c linux-2.6.27.4/drivers/isdn/hardware/avm/b1isa.c\n--- linux-2.6.27.4.ori/drivers/isdn/hardware/avm/b1isa.c\t2008-10-10 00:13:53.000000000 +0200\n+++ linux-2.6.27.4.fixed/drivers/isdn/hardware/avm/b1isa.c\t2008-10-30 15:55:03.000000000 +0100\n@@ -233,10 +233,8 @@ static void __exit b1isa_exit(void)\n \tint i;\n \n \tfor (i = 0; i < MAX_CARDS; i++) {\n-\t\tif (!io[i])\n-\t\t\tbreak;\n-\n-\t\tb1isa_remove(&isa_dev[i]);\n+\t\tif (isa_dev[i].resource[0].start)\n+\t\t\tb1isa_remove(&isa_dev[i]);\n \t}\n \tunregister_capi_driver(&capi_driver_b1isa);\n }\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "ISDN", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "drivers_isdn", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2008-11-05 04:51 UTC by Wilfried Klaebe", "Modified": "2008-12-22 12:39 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "2.6.27", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/isdn/hardware/avm/b1isa.c"], "methods": ["b1isa_exit"]}
{"id": "11926", "title": "[PATCH]sis190 doesn't detect ethernet cable removal (Realtek PHY)", "description": "Latest working kernel version: unknown\nEarliest failing kernel version: tested with 2.6.27.2 (vanilla), it fails, also other version tested was now old 2.6.24, same issue\nDistribution: Mandriva\nHardware Environment: Clevo M540SS\nSoftware Environment:\n\nProblem Description:\nFor the sis190 I have here it doesn't report link change inside interrupt handler after removing ethernet cable. This makes ethernet cable detection to not work correctly. Network works fine, if you don't remove ethernet cable after first connection, keep it removed for some time, and reconnect.\n\nSteps to reproduce:\n- Remove ethernet cable (after booting with it plugged, or after plugging it after boot). Driver doesn't detect link change.\n\nThis is shown on kernel log after sis190 module is loaded with cable connected:\nsis190 Gigabit Ethernet driver 1.2 loaded.\nsis190 0000:00:04.0: PCI INT A -> GSI 19 (level, low) -> IRQ 19\nsis190 0000:00:04.0: setting latency timer to 64\n0000:00:04.0: Read MAC address from EEPROM\n0000:00:04.0: Realtek PHY RTL8201 transceiver at address 1.\n0000:00:04.0: Using transceiver at address 1 as default.\n0000:00:04.0: SiS 191 PCI Gigabit Ethernet adapter at f8c14000 (IRQ: 19), 00:90:f5:69:e8:8b\neth0: GMII mode.\neth0: Enabling Auto-negotiation.\nADDRCONF(NETDEV_UP): eth0: link is not ready\neth0: mii ext = 0000.\neth0: mii lpa = 40a1 adv = 01e1.\neth0: link on 100 Mbps Half Duplex mode.\nADDRCONF(NETDEV_CHANGE): eth0: link becomes ready\neth0: no IPv6 routers present", "patch": ["---\n drivers/net/sis190.c |   23 ++++++++++++++++++-----\n 1 file changed, 18 insertions(+), 5 deletions(-)\n\ndiff --git a/drivers/net/sis190.c b/drivers/net/sis190.c\nindex 80af4a4..760d9e8 100644\n--- a/drivers/net/sis190.c\n+++ b/drivers/net/sis190.c\n@@ -285,6 +285,11 @@ struct sis190_private {\n \tstruct list_head first_phy;\n \tu32 features;\n \tu32 negotiated_lpa;\n+\tenum {\n+\t\tLNK_OFF,\n+\t\tLNK_ON,\n+\t\tLNK_AUTONEG,\n+\t} link_status;\n };\n \n struct sis190_phy {\n@@ -750,6 +755,7 @@ static irqreturn_t sis190_interrupt(int irq, void *__dev)\n \n \tif (status & LinkChange) {\n \t\tnetif_info(tp, intr, dev, \"link change\\n\");\n+\t\tdel_timer(&tp->timer);\n \t\tschedule_work(&tp->phy_task);\n \t}\n \n@@ -922,12 +928,15 @@ static void sis190_phy_task(struct work_struct *work)\n \tif (val & BMCR_RESET) {\n \t\t// FIXME: needlessly high ?  -- FR 02/07/2005\n \t\tmod_timer(&tp->timer, jiffies + HZ/10);\n-\t} else if (!(mdio_read_latched(ioaddr, phy_id, MII_BMSR) &\n-\t\t     BMSR_ANEGCOMPLETE)) {\n+\t\tgoto out_unlock;\n+\t}\n+\n+\tval = mdio_read_latched(ioaddr, phy_id, MII_BMSR);\n+\tif (!(val & BMSR_ANEGCOMPLETE) && tp->link_status != LNK_AUTONEG) {\n \t\tnetif_carrier_off(dev);\n \t\tnetif_warn(tp, link, dev, \"auto-negotiating...\\n\");\n-\t\tmod_timer(&tp->timer, jiffies + SIS190_PHY_TIMEOUT);\n-\t} else {\n+\t\ttp->link_status = LNK_AUTONEG;\n+\t} else if ((val & BMSR_LSTATUS) && tp->link_status != LNK_ON) {\n \t\t/* Rejoice ! */\n \t\tstruct {\n \t\t\tint val;\n@@ -1000,7 +1009,10 @@ static void sis190_phy_task(struct work_struct *work)\n \n \t\tnetif_info(tp, link, dev, \"link on %s mode\\n\", p->msg);\n \t\tnetif_carrier_on(dev);\n-\t}\n+\t\ttp->link_status = LNK_ON;\n+\t} else if (!(val & BMSR_LSTATUS) && tp->link_status != LNK_AUTONEG)\n+\t\ttp->link_status = LNK_OFF;\n+\tmod_timer(&tp->timer, jiffies + SIS190_PHY_TIMEOUT);\n \n out_unlock:\n \trtnl_unlock();\n@@ -1513,6 +1525,7 @@ static struct net_device * __devinit sis190_init_board(struct pci_dev *pdev)\n \n \ttp->pci_dev = pdev;\n \ttp->mmio_addr = ioaddr;\n+\ttp->link_status = LNK_OFF;\n \n \tsis190_irq_mask_and_ack(ioaddr);\n \n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Network", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "drivers_network@kernel-bugs.osdl.org", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2008-10-31 14:37 UTC by Herton Ronaldo Krzesinski", "Modified": "2012-05-22 15:09 UTC", "CC List": "5 users", "See Also": "", "Kernel Version": "2.6.30.1", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/net/sis190.c"], "methods": ["sis190_interrupt", "sis190_phy_task", "sis190_init_board", "sis190_private"]}
{"id": "11879", "title": "Improper ATA cable detection after S2R _only_:  \"limited to UDMA/33 due to 40-wire cable\"", "description": "Latest working kernel version:\nEarliest failing kernel version:\nDistribution: Ubuntu 8.10rc\nHardware Environment: Acer One A110L (Intel 945GSE / ICH7-M), SSD (Samsung P-SSD1800), BIOS v0.3109\nSoftware Environment: Ubuntu 8.10rc, Linux 2.6.27-7-generic\nProblem Description:\n\nBootup machine, no problem with ATA interfacing, full speed connection (leading to\n~40MB/s with hdparm):\n\n[    5.631156] ata1: SATA max UDMA/133 cmd 0x1f0 ctl 0x3f6 bmdma 0x60a0 irq 14\n[    5.631168] ata2: PATA max UDMA/100 cmd 0x170 ctl 0x376 bmdma 0x60a8 irq 15\n[    5.852225] usb 5-5: new high speed USB device using ehci_hcd and address 2\n[    5.961673] ata2.00: ATA-5: P-SSD1800, Ver2.Y0C, max UDMA/66\n[    5.961683] ata2.00: 15761088 sectors, multi 0: LBA \n[    5.969597] ata2.00: configured for UDMA/66\n[    5.969915] scsi 1:0:0:0: Direct-Access     ATA      P-SSD1800        Ver2 PQ: 0 ANSI: 5\n\n\nSuspend to RAM, then resume, witness:\n[  968.980271] ata2.00: ACPI cmd ef/03:0c:00:00:00:a0 filtered out\n[  968.980278] ata2.00: ACPI cmd ef/03:42:00:00:00:a0 filtered out\n[  968.980315] ata2.00: limited to UDMA/33 due to 40-wire cable\n[  968.989637] ata2.00: configured for UDMA/33\n[  968.989781] sd 1:0:0:0: [sda] 15761088 512-byte hardware sectors (8070 MB)\n[  968.989828] sd 1:0:0:0: [sda] Write Protect is off\n[  968.989834] sd 1:0:0:0: [sda] Mode Sense: 00 3a 00 00\n[  968.989913] sd 1:0:0:0: [sda] Write cache: disabled, read cache: enabled, doesn't support DPO or FUA\n\nand a severe hdparm downgrade of about 25MB/s (note that I tried about 5 cycles of boot and resume, always reliably resulting in proper and improper cable detection each).\n(IOW, yet another area where Linux seems to lose massive heaps of speed lately - c.f. absolutely shocking Phoronix Ubuntu distro version testing results)\nAnd with a lame SSD (low write performance), obviously this hurts plenty.\n\nDriver is ata_piix, register PIIX_IOCFG (0x54, responsible for cable detection) is _identical_ (0x00) both after boot and after resume, in fact all PCI registers are identical in both cases:\n\n00:1f.2 IDE interface: Intel Corporation 82801GBM/GHM (ICH7 Family) SATA IDE Controller (rev 02)\n00: 86 80 c4 27 05 00 b0 02 02 80 01 01 00 00 00 00\n10: 01 00 00 00 01 00 00 00 01 00 00 00 01 00 00 00\n20: a1 60 00 00 00 00 00 00 00 00 00 00 25 10 5b 01\n30: 00 00 00 00 70 00 00 00 00 00 00 00 0b 02 00 00\n40: 4c 80 07 e3 00 00 00 00 04 00 00 02 00 00 00 00\n50: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n60: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n70: 01 00 02 40 00 00 00 00 00 00 00 00 00 00 00 00\n80: 05 70 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n90: 02 00 05 0c 80 01 80 da 00 00 00 00 00 00 00 00\na0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\nb0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\nc0: 00 00 00 00 0d 00 00 00 00 00 00 00 00 00 00 00\nd0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\ne0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\nf0: 00 00 00 00 00 00 00 00 86 0f 02 00 00 00 00 00\n\nPossibly the\n[  968.980271] ata2.00: ACPI cmd ef/03:0c:00:00:00:a0 filtered out\n[  968.980278] ata2.00: ACPI cmd ef/03:42:00:00:00:a0 filtered out\nmay be to blame here, since I'm quite sure this is a message about ACPI IDE setup resume method (Tejun Hejo elaborated a bugfix - #9530 - for another box of mine earlier in this area).\n\n# lspci\n00:00.0 Host bridge: Intel Corporation Mobile 945GME Express Memory Controller Hub (rev 03)\n00:02.0 VGA compatible controller: Intel Corporation Mobile 945GME Express Integrated Graphics Controller (rev 03)\n00:02.1 Display controller: Intel Corporation Mobile 945GM/GMS/GME, 943/940GML Express Integrated Graphics Controller (rev 03)\n00:1b.0 Audio device: Intel Corporation 82801G (ICH7 Family) High Definition Audio Controller (rev 02)\n00:1c.0 PCI bridge: Intel Corporation 82801G (ICH7 Family) PCI Express Port 1 (rev 02)\n00:1c.1 PCI bridge: Intel Corporation 82801G (ICH7 Family) PCI Express Port 2 (rev 02)\n00:1c.2 PCI bridge: Intel Corporation 82801G (ICH7 Family) PCI Express Port 3 (rev 02)\n00:1c.3 PCI bridge: Intel Corporation 82801G (ICH7 Family) PCI Express Port 4 (rev 02)\n00:1d.0 USB Controller: Intel Corporation 82801G (ICH7 Family) USB UHCI Controller #1 (rev 02)\n00:1d.1 USB Controller: Intel Corporation 82801G (ICH7 Family) USB UHCI Controller #2 (rev 02)\n00:1d.2 USB Controller: Intel Corporation 82801G (ICH7 Family) USB UHCI Controller #3 (rev 02)\n00:1d.3 USB Controller: Intel Corporation 82801G (ICH7 Family) USB UHCI Controller #4 (rev 02)\n00:1d.7 USB Controller: Intel Corporation 82801G (ICH7 Family) USB2 EHCI Controller (rev 02)\n00:1e.0 PCI bridge: Intel Corporation 82801 Mobile PCI Bridge (rev e2)\n00:1f.0 ISA bridge: Intel Corporation 82801GBM (ICH7-M) LPC Interface Bridge (rev 02)\n00:1f.2 IDE interface: Intel Corporation 82801GBM/GHM (ICH7 Family) SATA IDE Controller (rev 02)\n00:1f.3 SMBus: Intel Corporation 82801G (ICH7 Family) SMBus Controller (rev 02)\n02:00.0 Ethernet controller: Realtek Semiconductor Co., Ltd. RTL8101E/RTL8102E PCI Express Fast Ethernet controller (rev 02)\n03:00.0 Ethernet controller: Atheros Communications Inc. AR242x 802.11abg Wireless PCI Express Adapter (rev 01)\n04:00.0 System peripheral: JMicron Technologies, Inc. SD/MMC Host Controller\n04:00.2 SD Host controller: JMicron Technologies, Inc. Standard SD Host Controller\n04:00.3 System peripheral: JMicron Technologies, Inc. MS Host Controller\n04:00.4 System peripheral: JMicron Technologies, Inc. xD Host Controller\n\nCross-verified on Inspiron 8000 (i815, 2.6.27-rc9, ata_piix), no such issue after resume there, cabling always detected properly.\n\nOK, I could easily add an Acer One A110L entry to the ich_laptop quirk list,\nbut somehow hardcoding this doesn't sound at all like being an acceptable solution (note that this list is full of Acer entries though!! Possibly due to BIOS resume quirks??).\n\nAny thoughts?\n\nThanks,\n\nAndreas Mohr", "patch": [" drivers/ata/ata_piix.c |   49 ++++++++++++++++++++++++++++++++++---------------\n 1 file changed, 34 insertions(+), 15 deletions(-)\n\ndiff --git a/drivers/ata/ata_piix.c b/drivers/ata/ata_piix.c\nindex c11936e..e818df0 100644\n--- a/drivers/ata/ata_piix.c\n+++ b/drivers/ata/ata_piix.c\n@@ -154,11 +154,13 @@ struct piix_map_db {\n \n struct piix_host_priv {\n \tconst int *map;\n+\tu32 saved_iocfg;\n \tvoid __iomem *sidpr;\n };\n \n static int piix_init_one(struct pci_dev *pdev,\n \t\t\t const struct pci_device_id *ent);\n+static void piix_remove_one(struct pci_dev *pdev);\n static int piix_pata_prereset(struct ata_link *link, unsigned long deadline);\n static void piix_set_piomode(struct ata_port *ap, struct ata_device *adev);\n static void piix_set_dmamode(struct ata_port *ap, struct ata_device *adev);\n@@ -296,7 +298,7 @@ static struct pci_driver piix_pci_driver = {\n \t.name\t\t\t= DRV_NAME,\n \t.id_table\t\t= piix_pci_tbl,\n \t.probe\t\t\t= piix_init_one,\n-\t.remove\t\t\t= ata_pci_remove_one,\n+\t.remove\t\t\t= piix_remove_one,\n #ifdef CONFIG_PM\n \t.suspend\t\t= piix_pci_device_suspend,\n \t.resume\t\t\t= piix_pci_device_resume,\n@@ -610,8 +612,9 @@ static const struct ich_laptop ich_laptop[] = {\n static int ich_pata_cable_detect(struct ata_port *ap)\n {\n \tstruct pci_dev *pdev = to_pci_dev(ap->host->dev);\n+\tstruct piix_host_priv *hpriv = ap->host->private_data;\n \tconst struct ich_laptop *lap = &ich_laptop[0];\n-\tu8 tmp, mask;\n+\tu8 mask;\n \n \t/* Check for specials - Acer Aspire 5602WLMi */\n \twhile (lap->device) {\n@@ -625,8 +628,7 @@ static int ich_pata_cable_detect(struct ata_port *ap)\n \n \t/* check BIOS cable detect results */\n \tmask = ap->port_no == 0 ? PIIX_80C_PRI : PIIX_80C_SEC;\n-\tpci_read_config_byte(pdev, PIIX_IOCFG, &tmp);\n-\tif ((tmp & mask) == 0)\n+\tif ((hpriv->saved_iocfg & mask) == 0)\n \t\treturn ATA_CBL_PATA40;\n \treturn ATA_CBL_PATA80;\n }\n@@ -1357,7 +1359,7 @@ static int __devinit piix_init_sidpr(struct ata_host *host)\n \treturn 0;\n }\n \n-static void piix_iocfg_bit18_quirk(struct pci_dev *pdev)\n+static void piix_iocfg_bit18_quirk(struct ata_host *host)\n {\n \tstatic const struct dmi_system_id sysids[] = {\n \t\t{\n@@ -1374,7 +1376,8 @@ static void piix_iocfg_bit18_quirk(struct pci_dev *pdev)\n \n \t\t{ }\t/* terminate list */\n \t};\n-\tu32 iocfg;\n+\tstruct pci_dev *pdev = to_pci_dev(host->dev);\n+\tstruct piix_host_priv *hpriv = host->private_data;\n \n \tif (!dmi_check_system(sysids))\n \t\treturn;\n@@ -1383,12 +1386,11 @@ static void piix_iocfg_bit18_quirk(struct pci_dev *pdev)\n \t * seem to use it to disable a channel.  Clear the bit on the\n \t * affected systems.\n \t */\n-\tpci_read_config_dword(pdev, PIIX_IOCFG, &iocfg);\n-\tif (iocfg & (1 << 18)) {\n+\tif (hpriv->saved_iocfg & (1 << 18)) {\n \t\tdev_printk(KERN_INFO, &pdev->dev,\n \t\t\t   \"applying IOCFG bit18 quirk\\n\");\n-\t\tiocfg &= ~(1 << 18);\n-\t\tpci_write_config_dword(pdev, PIIX_IOCFG, iocfg);\n+\t\tpci_write_config_dword(pdev, PIIX_IOCFG,\n+\t\t\t\t       hpriv->saved_iocfg & ~(1 << 18));\n \t}\n }\n \n@@ -1437,6 +1439,17 @@ static int __devinit piix_init_one(struct pci_dev *pdev,\n \tif (rc)\n \t\treturn rc;\n \n+\thpriv = devm_kzalloc(dev, sizeof(*hpriv), GFP_KERNEL);\n+\tif (!hpriv)\n+\t\treturn -ENOMEM;\n+\n+\t/* Save IOCFG, this will be used for cable detection, quirk\n+\t * detection and restoration on detach.  This is necessary\n+\t * because some ACPI implementations mess up cable related\n+\t * bits on _STM.\n+\t */\n+\tpci_read_config_dword(pdev, PIIX_IOCFG, &hpriv->saved_iocfg);\n+\n \t/* ICH6R may be driven by either ata_piix or ahci driver\n \t * regardless of BIOS configuration.  Make sure AHCI mode is\n \t * off.\n@@ -1448,10 +1461,6 @@ static int __devinit piix_init_one(struct pci_dev *pdev,\n \t}\n \n \t/* SATA map init can change port_info, do it before prepping host */\n-\thpriv = devm_kzalloc(dev, sizeof(*hpriv), GFP_KERNEL);\n-\tif (!hpriv)\n-\t\treturn -ENOMEM;\n-\n \tif (port_flags & ATA_FLAG_SATA)\n \t\thpriv->map = piix_init_sata_map(pdev, port_info,\n \t\t\t\t\tpiix_map_db_table[ent->driver_data]);\n@@ -1470,7 +1479,7 @@ static int __devinit piix_init_one(struct pci_dev *pdev,\n \t}\n \n \t/* apply IOCFG bit18 quirk */\n-\tpiix_iocfg_bit18_quirk(pdev);\n+\tpiix_iocfg_bit18_quirk(host);\n \n \t/* On ICH5, some BIOSen disable the interrupt using the\n \t * PCI_COMMAND_INTX_DISABLE bit added in PCI 2.3.\n@@ -1495,6 +1504,16 @@ static int __devinit piix_init_one(struct pci_dev *pdev,\n \treturn ata_pci_sff_activate_host(host, ata_sff_interrupt, &piix_sht);\n }\n \n+static void piix_remove_one(struct pci_dev *pdev)\n+{\n+\tstruct ata_host *host = dev_get_drvdata(&pdev->dev);\n+\tstruct piix_host_priv *hpriv = host->private_data;\n+\n+\tpci_write_config_dword(pdev, PIIX_IOCFG, hpriv->saved_iocfg);\n+\n+\tata_pci_remove_one(pdev);\n+}\n+\n static int __init piix_init(void)\n {\n \tint rc;\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "IO/Storage", "Classification": "Unclassified", "Component": "Serial ATA", "Hardware": "All Linux", "Importance": "P1 high", "Assignee": "Tejun Heo", "URL": "", "Keywords": "", "Duplicates (1)": "12202", "Depends on": "", "Blocks": "", "Reported": "2008-10-28 13:25 UTC by Andreas Mohr", "Modified": "2012-05-22 15:07 UTC", "CC List": "4 users", "See Also": "", "Kernel Version": "2.6.27", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/ata/ata_piix.c"], "methods": ["ich_pata_cable_detect", "piix_init_sidpr", "piix_iocfg_bit18_quirk", "piix_init_one", "piix_host_priv", "piix_pci_driver", "ich_laptop"]}
{"id": "11865", "title": "WOL for E100 Doesn't Work Anymore", "": "Show dependency tree", "description": "Latest working kernel version: 2.6.27\nEarliest failing kernel version: 2.6.27\nDistribution: Gentoo\nHardware Environment: 2x750P3 1G RAM w/ \n\n00:14.0 Ethernet controller: Intel Corporation 82557/8/9 [Ethernet Pro 100] (rev 08)\n\nProblem Description:\nAs of kernel version 2.6.27, WOL has stopped working.  The box no longer powers on after the magic packet has been sent.  Rebooting using kernel-2.6.26*, WOL *does* work!\n\nSteps to reproduce:\n(Not needed.  Self Explanatory.)\n\n\nI noticed 3 lines of code in e100.c added/modified since 2.6.26*, however, I reversed 2 lines of code to 2.6.26 and the other line was just added an additional pointer, for which I left alone.  Recompiled, rebooted and WOL still didn't work using 2.6.27.  I'm guessing, the source of this bug lies elsewhere.", "patch": ["Author: Rafael J. Wysocki <rjw@sisk.pl>\nSubject: e100: Fix WOL regression\n    \nSince dev->power.should_wakeup bit is used by the PCI core to\ndecide whether the device should wake up the system from sleep\nstates, set/unset this bit whenever WOL is enabled/disabled using\ne100_set_wol().\n\nSigned-off-by: Rafael J. Wysocki <rjw@sisk.pl>\n\ndiff --git a/drivers/net/e100.c b/drivers/net/e100.c\nindex 3d69fae..b0ca300 100644\n--- a/drivers/net/e100.c\n+++ b/drivers/net/e100.c\n@@ -2322,7 +2322,8 @@ static int e100_set_wol(struct net_device *netdev, struct ethtool_wolinfo *wol)\n {\n \tstruct nic *nic = netdev_priv(netdev);\n \n-\tif(wol->wolopts != WAKE_MAGIC && wol->wolopts != 0)\n+\tif ((wol->wolopts && wol->wolopts != WAKE_MAGIC) ||\n+\t    !device_can_wakeup(&nic->pdev->dev))\n \t\treturn -EOPNOTSUPP;\n \n \tif(wol->wolopts)\n@@ -2330,6 +2331,8 @@ static int e100_set_wol(struct net_device *netdev, struct ethtool_wolinfo *wol)\n \telse\n \t\tnic->flags &= ~wol_magic;\n \n+\tdevice_set_wakeup_enable(&nic->pdev->dev, wol->wolopts);\n+\n \te100_exec_cb(nic, NULL, e100_configure);\n \n \treturn 0;\n@@ -2734,8 +2737,10 @@ static int __devinit e100_probe(struct pci_dev *pdev,\n \n \t/* Wol magic packet can be enabled from eeprom */\n \tif((nic->mac >= mac_82558_D101_A4) &&\n-\t   (nic->eeprom[eeprom_id] & eeprom_id_wol))\n+\t   (nic->eeprom[eeprom_id] & eeprom_id_wol)) {\n \t\tnic->flags |= wol_magic;\n+\t\tdevice_set_wakeup_enable(&pdev->dev, true);\n+\t}\n \n \t/* ack any pending wake events, disable PME */\n \tpci_pme_active(pdev, false);\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Network", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Rafael J. Wysocki", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "7216 Regressions-2.6.26", "Reported": "2008-10-26 21:56 UTC by Roger", "Modified": "2009-05-21 15:18 UTC", "CC List": "3 users", "See Also": "", "Kernel Version": "2.6.27", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/net/e100.c"], "methods": ["e100_set_wol", "e100_probe"]}
{"id": "11742", "title": "Device buffer on a DVD multi standard writer runs out burning a CD", "description": "Latest working kernel version: 2.6.26\nEarliest failing kernel version:2.6.27\nDistribution: Debian Unstable\nHardware Environment: Laptop Acer 5920G with a Samsung CDDVDW TS-L632H connected through IDE \nSoftware Environment: KDE 3.5.9; k3b 1.0.5; Brasero\nProblem Description: I have compiled the 2.6.27 kernel using make oldconf, thus almost copying the passed 2.6.26.5 configuration. Since then, when I burn a CD the internal buffer in my DVD burner reaches 0% obliging k3b and brasero to slow down the writing speed. It happens even if I don't run any other application. I have noticed that the device buffer runs out even if the software buffer is full, like there was not a fast transfer from the software buffer to the device buffer. In the end, k3b reports a big amount of buffer under-runs (> 100).Everything works as expected with an older 2.6.26.5 kernel. What I need to do to help solving this bug? See you\n\nValerio\n\nSteps to reproduce: Using 2.6.27 kernel and k3b or brasero to burn a CD. It works in simulation mode too (so you don't waste too much CD's ;))", "patch": ["commit e5318b531b008c79d2a0c0df06a7b8628da38e2f\nAuthor: FUJITA Tomonori <fujita.tomonori@lab.ntt.co.jp>\nDate:   Wed Jul 16 20:33:35 2008 +0200\n\n    ide: use the dma safe check for REQ_TYPE_ATA_PC\n    \n    This uses the dma safe check for REQ_TYPE_ATA_PC. The dma safe check\n    is used for only sg requests but it should be used for other non fs\n    commands.\n    \n    This uses blk_queue_update_dma_pad to make the intention clear though\n    ide don't use the blk APIs so it doesn't change anything.\n    \n    Signed-off-by: FUJITA Tomonori <fujita.tomonori@lab.ntt.co.jp>\n    Acked-by: Borislav Petkov <petkovbb@gmail.com>\n    Cc: Thomas Bogendoerfer <tsbogend@alpha.franken.de>\n    Cc: Tejun Heo <htejun@gmail.com>\n    Cc: Jens Axboe <jens.axboe@oracle.com>\n    Cc: James Bottomley <James.Bottomley@HansenPartnership.com>\n    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>\n    Signed-off-by: Bartlomiej Zolnierkiewicz <bzolnier@gmail.com>\n\ndiff --git a/drivers/ide/ide-cd.c b/drivers/ide/ide-cd.c\nindex d6667c3..e12d602 100644\n--- a/drivers/ide/ide-cd.c\n+++ b/drivers/ide/ide-cd.c\n@@ -1191,12 +1191,17 @@ static ide_startstop_t cdrom_do_block_pc(ide_drive_t *drive, struct request *rq)\n \tinfo->dma = 0;\n \n \t/* sg request */\n-\tif (rq->bio) {\n-\t\tint mask = drive->queue->dma_alignment;\n-\t\tunsigned long addr =\n-\t\t\t(unsigned long)page_address(bio_page(rq->bio));\n+\tif (rq->bio || ((rq->cmd_type == REQ_TYPE_ATA_PC) && rq->data_len)) {\n+\t\tstruct request_queue *q = drive->queue;\n+\t\tunsigned int alignment;\n+\t\tunsigned long addr;\n \t\tunsigned long stack_mask = ~(THREAD_SIZE - 1);\n \n+\t\tif (rq->bio)\n+\t\t\taddr = (unsigned long)bio_data(rq->bio);\n+\t\telse\n+\t\t\taddr = (unsigned long)rq->data;\n+\n \t\tinfo->dma = drive->using_dma;\n \n \t\t/*\n@@ -1205,7 +1210,8 @@ static ide_startstop_t cdrom_do_block_pc(ide_drive_t *drive, struct request *rq)\n \t\t * NOTE! The \"len\" and \"addr\" checks should possibly have\n \t\t * separate masks.\n \t\t */\n-\t\tif ((rq->data_len & 15) || (addr & mask))\n+\t\talignment = queue_dma_alignment(q) | q->dma_pad_mask;\n+\t\tif (addr & alignment || rq->data_len & alignment)\n \t\t\tinfo->dma = 0;\n \n \t\tif (!((addr & stack_mask) ^\n@@ -1877,6 +1883,7 @@ static int ide_cdrom_setup(ide_drive_t *drive)\n \n \tblk_queue_prep_rq(drive->queue, ide_cdrom_prep_fn);\n \tblk_queue_dma_alignment(drive->queue, 31);\n+\tblk_queue_update_dma_pad(drive->queue, 15);\n \tdrive->queue->unplug_delay = (1 * HZ) / 1000;\n \tif (!drive->queue->unplug_delay)\n \t\tdrive->queue->unplug_delay = 1;\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "IO/Storage", "Classification": "Unclassified", "Component": "IDE", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Borislav Petkov", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2008-10-11 15:54 UTC by Valerio Passini", "Modified": "2008-11-03 09:56 UTC", "CC List": "1 user", "See Also": "", "Kernel Version": "2.6.27", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/ide/ide-cd.c"], "methods": ["cdrom_do_block_pc", "ide_cdrom_setup"]}
{"id": "11735", "title": "delkin_cb fails after resume", "description": "Distribution:\ngentoo\nHardware Environment:\nx86 (Dell laptop, yenta cardbus), \"02:00.0 Mass storage controller [0180]: Workbit Corporation Device [1145:f021] (rev 01)\"\nProblem Description:\nThe delkin_cb driver works with ~3 mb/s performance, top shows the CPU in 98% wait state with heavy I/O. If you suspend to ram or disk, the system comes up but any further I/O to a CF card in the adapter will not complete, top shows ~100% wait state but commands to read from the card do not complete. pata_ninja32 not tested because it performs much worse than delkin_cb (~1 mb/s).\nSteps to reproduce: \n1. boot, mount a CF card through the adapter (or have root on the CF card, as I do)\n2. echo mem > /sys/power/state\n3. resume from sleep\n4. do I/O from the card, say \"ls /mnt/card\"\n5. <crickets chirp> ... top shows 100% wait state", "patch": ["From: Bartlomiej Zolnierkiewicz <bzolnier@gmail.com>\nSubject: [PATCH] delkin_cb: add PM support\n\n* Factor out chipset initialization code from delkin_cb_probe()\n  to delkin_cb_init_chipset().\n\n* Assign ->init_chipset in struct delkin_cb_port_info.\n\n* Add delkin_cb_{suspend,resume}() (->suspend/->resume methods).\n\nCc: bumble.bee@xs4all.nl\nCc: Alan Cox <alan@lxorguk.ukuu.org.uk>\nSigned-off-by: Bartlomiej Zolnierkiewicz <bzolnier@gmail.com>\n---\n drivers/ide/pci/delkin_cb.c |   63 +++++++++++++++++++++++++++++++++++++++-----\n 1 file changed, 56 insertions(+), 7 deletions(-)\n\nIndex: b/drivers/ide/pci/delkin_cb.c\n===================================================================\n--- a/drivers/ide/pci/delkin_cb.c\n+++ b/drivers/ide/pci/delkin_cb.c\n@@ -46,10 +46,27 @@ static const struct ide_port_ops delkin_\n \t.quirkproc\t\t= ide_undecoded_slave,\n };\n \n+static unsigned int delkin_cb_init_chipset(struct pci_dev *dev)\n+{\n+\tunsigned long base = pci_resource_start(dev, 0);\n+\tint i;\n+\n+\toutb(0x02, base + 0x1e);\t/* set nIEN to block interrupts */\n+\tinb(base + 0x17);\t\t/* read status to clear interrupts */\n+\n+\tfor (i = 0; i < sizeof(setup); ++i) {\n+\t\tif (setup[i])\n+\t\t\toutb(setup[i], base + i);\n+\t}\n+\n+\treturn 0;\n+}\n+\n static const struct ide_port_info delkin_cb_port_info = {\n \t.port_ops\t\t= &delkin_cb_port_ops,\n \t.host_flags\t\t= IDE_HFLAG_IO_32BIT | IDE_HFLAG_UNMASK_IRQS |\n \t\t\t\t  IDE_HFLAG_NO_DMA,\n+\t.init_chipset\t\t= delkin_cb_init_chipset,\n };\n \n static int __devinit\n@@ -57,7 +74,7 @@ delkin_cb_probe (struct pci_dev *dev, co\n {\n \tstruct ide_host *host;\n \tunsigned long base;\n-\tint i, rc;\n+\tint rc;\n \thw_regs_t hw, *hws[] = { &hw, NULL, NULL, NULL };\n \n \trc = pci_enable_device(dev);\n@@ -72,12 +89,8 @@ delkin_cb_probe (struct pci_dev *dev, co\n \t\treturn rc;\n \t}\n \tbase = pci_resource_start(dev, 0);\n-\toutb(0x02, base + 0x1e);\t/* set nIEN to block interrupts */\n-\tinb(base + 0x17);\t\t/* read status to clear interrupts */\n-\tfor (i = 0; i < sizeof(setup); ++i) {\n-\t\tif (setup[i])\n-\t\t\toutb(setup[i], base + i);\n-\t}\n+\n+\tdelkin_cb_init_chipset(dev);\n \n \tmemset(&hw, 0, sizeof(hw));\n \tide_std_init_ports(&hw, base + 0x10, base + 0x1e);\n@@ -110,6 +123,40 @@ delkin_cb_remove (struct pci_dev *dev)\n \tpci_disable_device(dev);\n }\n \n+#ifdef CONFIG_PM\n+static int delkin_cb_suspend(struct pci_dev *dev, pm_message_t state)\n+{\n+\tpci_save_state(dev);\n+\tpci_disable_device(dev);\n+\tpci_set_power_state(dev, pci_choose_state(dev, state));\n+\n+\treturn 0;\n+}\n+\n+static int delkin_cb_resume(struct pci_dev *dev)\n+{\n+\tstruct ide_host *host = pci_get_drvdata(dev);\n+\tint rc;\n+\n+\tpci_set_power_state(dev, PCI_D0);\n+\n+\trc = pci_enable_device(dev);\n+\tif (rc)\n+\t\treturn rc;\n+\n+\tpci_restore_state(dev);\n+\tpci_set_master(dev);\n+\n+\tif (host->init_chipset)\n+\t\thost->init_chipset(dev);\n+\n+\treturn 0;\n+}\n+#else\n+#define delkin_cb_suspend NULL\n+#define delkin_cb_resume NULL\n+#endif\n+\n static struct pci_device_id delkin_cb_pci_tbl[] __devinitdata = {\n \t{ 0x1145, 0xf021, PCI_ANY_ID, PCI_ANY_ID, 0, 0, 0},\n \t{ 0x1145, 0xf024, PCI_ANY_ID, PCI_ANY_ID, 0, 0, 0},\n@@ -122,6 +169,8 @@ static struct pci_driver delkin_cb_pci_d\n \t.id_table\t= delkin_cb_pci_tbl,\n \t.probe\t\t= delkin_cb_probe,\n \t.remove\t\t= delkin_cb_remove,\n+\t.suspend\t= delkin_cb_suspend,\n+\t.resume\t\t= delkin_cb_resume,\n };\n \n static int __init delkin_cb_init(void)\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "IO/Storage", "Classification": "Unclassified", "Component": "IDE", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Bartlomiej Zolnierkiewicz", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2008-10-10 13:45 UTC by bumble.bee", "Modified": "2008-10-29 11:19 UTC", "CC List": "1 user", "See Also": "", "Kernel Version": "2.6.27", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/ide/pci/delkin_cb.c"], "methods": ["delkin_cb_probe", "delkin_cb_port_info", "driver"]}
{"id": "11568", "title": "spontaneous reboot on resume with 2.6.27", "": "Show dependency tree", "description": "Latest working kernel version: 2.6.26.5\nEarliest failing kernel version: 2.6.27-rc2 (haven't tested earlier versions)\nDistribution: Debian unstable\nHardware Environment: MSI AMD Socket 754 with VIA K8T800 and AMI BIOS\nSoftware Environment:\nProblem Description: Resume from S3 causes machine to reset itself.  \n\nSteps to reproduce:\nEnter S3 with \"echo mem > /sys/power/state\"\nTry to resume.", "patch": ["---\n arch/x86/kernel/acpi/realmode/wakeup.S |    1 +\n 1 file changed, 1 insertion(+)\n\nIndex: linux-2.6/arch/x86/kernel/acpi/realmode/wakeup.S\n===================================================================\n--- linux-2.6.orig/arch/x86/kernel/acpi/realmode/wakeup.S\n+++ linux-2.6/arch/x86/kernel/acpi/realmode/wakeup.S\n@@ -112,6 +112,7 @@ _start:\n \tmovl\t%eax, %cr0\n \tjmp\tpmode_return\n #else\n+\tjmp\tbogus_real_magic\n \tpushw\t$0\n \tpushw\ttrampoline_segment\n \tpushw\t$0\n", "---\n arch/x86/kernel/acpi/wakeup_64.S |    3 ++-\n 1 file changed, 2 insertions(+), 1 deletion(-)\n\nIndex: linux-2.6/arch/x86/kernel/acpi/wakeup_64.S\n===================================================================\n--- linux-2.6.orig/arch/x86/kernel/acpi/wakeup_64.S\n+++ linux-2.6/arch/x86/kernel/acpi/wakeup_64.S\n@@ -17,7 +17,7 @@ wakeup_long64:\n \tmovq\tsaved_magic, %rax\n \tmovq\t$0x123456789abcdef0, %rdx\n \tcmpq\t%rdx, %rax\n-\tjne\tbogus_64_magic\n+\tjmp\tbogus_64_magic\n \n \tmovw\t$__KERNEL_DS, %ax\n \tmovw\t%ax, %ss\t\n@@ -36,6 +36,7 @@ wakeup_long64:\n \tjmp\t*%rax\n \n bogus_64_magic:\n+\thlt\n \tjmp\tbogus_64_magic\n \n \t.align 2\n", "---\n arch/x86/kernel/acpi/sleep.c |   11 ++++++++++-\n 1 file changed, 10 insertions(+), 1 deletion(-)\n\nIndex: linux-2.6/arch/x86/kernel/acpi/sleep.c\n===================================================================\n--- linux-2.6.orig/arch/x86/kernel/acpi/sleep.c\n+++ linux-2.6/arch/x86/kernel/acpi/sleep.c\n@@ -36,6 +36,9 @@ int acpi_save_state_mem(void)\n {\n \tstruct wakeup_header *header;\n \tu16 *wakeup_seg;\n+#ifdef CONFIG_64BIT\n+\tunsigned long trampoline_physaddr;\n+#endif\n \n \tif (!acpi_realmode) {\n \t\tprintk(KERN_ERR \"Could not allocate memory during boot, \"\n@@ -97,7 +100,13 @@ int acpi_save_state_mem(void)\n \theader->pmode_cr3 = (u32)(swsusp_pg_dir - __PAGE_OFFSET);\n \tsaved_magic = 0x12345678;\n #else /* CONFIG_64BIT */\n-\theader->trampoline_segment = setup_trampoline() >> 4;\n+\ttrampoline_physaddr = setup_trampoline();\n+\tif (trampoline_physaddr != TRAMPOLINE_BASE) {\n+\t\tprintk(KERN_ERR \"PM: Invalid trampoline address: 0x%lx\\n\",\n+\t\t\ttrampoline_physaddr);\n+\t\treturn -EINVAL;\n+\t}\n+\theader->trampoline_segment = trampoline_physaddr >> 4;\n #ifdef CONFIG_SMP\n \tstack_start.sp = temp_stack + 4096;\n #endif\n", "---\n arch/x86/kernel/trampoline_64.S |    1 +\n 1 file changed, 1 insertion(+)\n\nIndex: linux-2.6/arch/x86/kernel/trampoline_64.S\n===================================================================\n--- linux-2.6.orig/arch/x86/kernel/trampoline_64.S\n+++ linux-2.6/arch/x86/kernel/trampoline_64.S\n@@ -43,6 +43,7 @@ r_base = .\n \tmov\t%ax, %es\n \tmov\t%ax, %ss\n \n+\tjmp\tno_longmode\n \n \tmovl\t$0xA5A5A5A5, trampoline_data - r_base\n \t\t\t\t# write marker for master knows we're running\n", "---\n arch/x86/kernel/trampoline_64.S |    4 ++++\n 1 file changed, 4 insertions(+)\n\nIndex: linux-2.6/arch/x86/kernel/trampoline_64.S\n===================================================================\n--- linux-2.6.orig/arch/x86/kernel/trampoline_64.S\n+++ linux-2.6/arch/x86/kernel/trampoline_64.S\n@@ -86,6 +86,10 @@ startup_32:\n \tmovl\t$__KERNEL_DS, %eax\t# Initialize the %ds segment register\n \tmovl\t%eax, %ds\n \n+1:\n+\thlt\n+\tjmp\t1b\n+\n \txorl\t%eax, %eax\n \tbtsl\t$5, %eax\t\t# Enable PAE mode\n \tmovl\t%eax, %cr4\n", "---\n arch/x86/kernel/trampoline_64.S |    3 +++\n 1 file changed, 3 insertions(+)\n\nIndex: linux-2.6/arch/x86/kernel/trampoline_64.S\n===================================================================\n--- linux-2.6.orig/arch/x86/kernel/trampoline_64.S\n+++ linux-2.6/arch/x86/kernel/trampoline_64.S\n@@ -115,6 +115,9 @@ startup_32:\n \t.code64\n \t.balign 4\n startup_64:\n+\thlt\n+\tjmp\tstartup_64\n+\n \t# Now jump into the kernel using virtual addresses\n \tmovq\t$secondary_startup_64, %rax\n \tjmp\t*%rax\n", "---\n arch/x86/kernel/acpi/sleep.c |    3 +++\n 1 file changed, 3 insertions(+)\n\nIndex: linux-2.6/arch/x86/kernel/acpi/sleep.c\n===================================================================\n--- linux-2.6.orig/arch/x86/kernel/acpi/sleep.c\n+++ linux-2.6/arch/x86/kernel/acpi/sleep.c\n@@ -10,6 +10,7 @@\n #include <linux/dmi.h>\n #include <linux/cpumask.h>\n #include <asm/segment.h>\n+#include <asm/desc.h>\n \n #include \"realmode/wakeup.h\"\n #include \"sleep.h\"\n@@ -100,6 +101,8 @@ int acpi_save_state_mem(void)\n \theader->trampoline_segment = setup_trampoline() >> 4;\n #ifdef CONFIG_SMP\n \tstack_start.sp = temp_stack + 4096;\n+\tearly_gdt_descr.address =\n+\t\t\t(unsigned long)get_cpu_gdt_table(smp_processor_id());\n #endif\n \tinitial_code = (unsigned long)wakeup_long64;\n \tsaved_magic = 0x123456789abcdef0;\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Platform Specific/Hardware", "Classification": "Unclassified", "Component": "x86-64", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Rafael J. Wysocki", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "7216 Regressions-2.6.26", "Reported": "2008-09-14 20:00 UTC by Andy Wettstein", "Modified": "2008-10-22 22:22 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "2.6.27-rc2", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["arch/x86/kernel/acpi/sleep.c"], "methods": ["acpi_save_state_mem"]}
{"id": "11520", "title": "eeepc_laptop hwmon missing name", "description": "Hardware Environment: EeePC\nProblem Description:\n\nThe hwmon sysfs-interface of the eeepc_laptop module doesn't provide the mandatory attribute \"name\", causing lm-sensors to ignore it.", "patch": ["From: Corentin chary <corentincj@iksaif.net>\nDate: Fri, 3 Oct 2008 15:49:56 +0200\nSubject: [PATCH] eeepc-laptop: Fix hwmon interface\n\nCreates a name file in the sysfs directory, that\nis needed for the libsensors library to work.\nAlso scales correctly the value used with pwm1\n\n\nSigned-off-by: Corentin chary <corentincj@iksaif.net>\n---\n drivers/misc/eeepc-laptop.c |   16 +++++++++++++---\n 1 files changed, 13 insertions(+), 3 deletions(-)\n\ndiff --git a/drivers/misc/eeepc-laptop.c b/drivers/misc/eeepc-laptop.c\nindex facdb98..1ee8501 100644\n--- a/drivers/misc/eeepc-laptop.c\n+++ b/drivers/misc/eeepc-laptop.c\n@@ -450,12 +450,14 @@ static int eeepc_get_fan_pwm(void)\n \tint value = 0;\n \n \tread_acpi_int(NULL, EEEPC_EC_FAN_PWM, &value);\n+\tvalue = value * 255 / 100;\n \treturn (value);\n }\n \n static void eeepc_set_fan_pwm(int value)\n {\n-\tvalue = SENSORS_LIMIT(value, 0, 100);\n+\tvalue = SENSORS_LIMIT(value, 0, 255);\n+\tvalue = value * 100 / 255;\n \tec_write(EEEPC_EC_SC02, value);\n }\n \n@@ -520,15 +522,23 @@ static ssize_t show_sys_hwmon(int (*get)(void), char *buf)\n \tstatic SENSOR_DEVICE_ATTR(_name, _mode, show_##_name, store_##_name, 0);\n \n EEEPC_CREATE_SENSOR_ATTR(fan1_input, S_IRUGO, eeepc_get_fan_rpm, NULL);\n-EEEPC_CREATE_SENSOR_ATTR(fan1_pwm, S_IRUGO | S_IWUSR,\n+EEEPC_CREATE_SENSOR_ATTR(pwm1, S_IRUGO | S_IWUSR,\n \t\t\t eeepc_get_fan_pwm, eeepc_set_fan_pwm);\n EEEPC_CREATE_SENSOR_ATTR(pwm1_enable, S_IRUGO | S_IWUSR,\n \t\t\t eeepc_get_fan_ctrl, eeepc_set_fan_ctrl);\n \n+static ssize_t\n+show_name(struct device *dev, struct device_attribute *attr, char *buf)\n+{\n+\treturn sprintf(buf, \"eeepc\\n\");\n+}\n+static SENSOR_DEVICE_ATTR(name, S_IRUGO, show_name, NULL, 0);\n+\n static struct attribute *hwmon_attributes[] = {\n-\t&sensor_dev_attr_fan1_pwm.dev_attr.attr,\n+\t&sensor_dev_attr_pwm1.dev_attr.attr,\n \t&sensor_dev_attr_fan1_input.dev_attr.attr,\n \t&sensor_dev_attr_pwm1_enable.dev_attr.attr,\n+\t&sensor_dev_attr_name.dev_attr.attr,\n \tNULL\n };\n \n-- \n1.5.4.3\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Hardware Monitoring", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Corentin Chary", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2008-09-08 04:58 UTC by Florian Heimgaertner", "Modified": "2008-10-10 00:41 UTC", "CC List": "1 user", "See Also": "", "Kernel Version": "2.6.26", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/misc/eeepc-laptop.c"], "methods": ["eeepc_get_fan_pwm", "*hwmon_attributes"]}
{"id": "11399", "title": "(patch queued)possible buffer underflow in ib700wdt.c", "description": "Problem Description:\n\nSteps to a possible buffer_underflow bug in ib700wdt.c, function ibwdt_ioctl:\n\n1. new margin is loaded using get_user(new_margin, p) in case WDIOC_SETTIMEOUT in the function ibwdt_ioctl. Important: assume that new_margin == 30\n2. ibwdt_set_heartbeat(new_margin) is called\n3. the check \"if ((t < 0) || (t > 30))\" in ibwdt_set_heartbeat is not going to fail because t == 30 (t is new_margin)\n4. in the loop, the check wd_times[i] > t is never going to be true because none of the wd_times are greater than the value of t (i.e. 30)\n5. we are exiting the loop with i == -1 and therefore setting wd_margin to -1 in the line wd_margin = i;\n6. we are returning from ibwdt_set_heartbeat and wd_margin is -1\n7. we fall through to case WDIOC_GETTIMEOUT\n8. we access the wd_times array with wd_margin == -1 on line \"return put_user(wd_times[wd_margin], p);\"\n\nI found this bug using my own static checker for low-level systems software whose codename is Smack, which I am developing as a part of my PhD. For the sake of my research (and also I am currently in the process of writing a paper about Smack), I would greatly appreciate if you could confirm/dispute the bug as soon as possible.\n\nThanks a lot!\n-- Zvonimir\n\n\nFurthermore, here are the pieces of code which are causing this buffer-underflow bug in ib700wdt.c:\n\nstatic int wd_times[] = {\n\t30,\t/* 0x0 */\n\t28,\t/* 0x1 */\n\t26,\t/* 0x2 */\n\t24,\t/* 0x3 */\n\t22,\t/* 0x4 */\n\t20,\t/* 0x5 */\n\t18,\t/* 0x6 */\n\t16,\t/* 0x7 */\n\t14,\t/* 0x8 */\n\t12,\t/* 0x9 */\n\t10,\t/* 0xA */\n\t8,\t/* 0xB */\n\t6,\t/* 0xC */\n\t4,\t/* 0xD */\n\t2,\t/* 0xE */\n\t0,\t/* 0xF */\n};\n\nfunction ibwdt_ioctl:\n.....\n  case WDIOC_SETTIMEOUT:\n    if (get_user(new_margin, p))\n      return -EFAULT;\n    if (ibwdt_set_heartbeat(new_margin))\n      return -EINVAL;\n    ibwdt_ping();\n    /* Fall */\n\n  case WDIOC_GETTIMEOUT:\n    return put_user(wd_times[wd_margin], p);\n.....\n\nfunction ibwdt_set_heartbeat:\nstatic int\nibwdt_set_heartbeat(int t)\n{\n\tint i;\n\n\tif ((t < 0) || (t > 30))\n\t\treturn -EINVAL;\n\n\tfor (i = 0x0F; i > -1; i--)\n\t\tif (wd_times[i] > t)\n\t\t\tbreak;\n\twd_margin = i;\n\treturn 0;\n}", "patch": ["commit 7c2500f17d65092d93345f3996cf82ebca17e9ff\nAuthor: Wim Van Sebroeck <wim@iguana.be>\nDate:   Wed Oct 15 08:53:06 2008 +0000\n\n    [WATCHDOG] ib700wdt.c - fix buffer_underflow bug\n    \n    This fixes Bug 11399:\n    if ibwdt_set_heartbeat(int t) is called with value 30 then\n    the check \"if ((t < 0) || (t > 30))\" in ibwdt_set_heartbeat\n    is not going to fail because t == 30, but in the loop, the\n    check wd_times[i] > t is never going to be true because\n    none of the wd_times are greater than the value of t (i.e. 30).\n    So we are exiting the loop with i == -1 and therefore setting\n    wd_margin to -1 which is wrong.\n    \n    Reported-by: Zvonimir Rakamaric <zrakamar@cs.ubc.ca>\n    Signed-off-by: Wim Van Sebroeck <wim@iguana.be>\n\ndiff --git a/drivers/watchdog/ib700wdt.c b/drivers/watchdog/ib700wdt.c\nindex 05a2810..8782ec1 100644\n--- a/drivers/watchdog/ib700wdt.c\n+++ b/drivers/watchdog/ib700wdt.c\n@@ -154,7 +154,7 @@ static int ibwdt_set_heartbeat(int t)\n \t\treturn -EINVAL;\n \n \tfor (i = 0x0F; i > -1; i--)\n-\t\tif (wd_times[i] > t)\n+\t\tif (wd_times[i] >= t)\n \t\t\tbreak;\n \twd_margin = i;\n \treturn 0;\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Watchdog", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Alan", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2008-08-21 17:38 UTC by Zvonimir Rakamaric", "Modified": "2008-12-19 02:26 UTC", "CC List": "3 users", "See Also": "", "Kernel Version": "2.6.26", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/watchdog/ib700wdt.c"], "methods": ["ibwdt_set_heartbeat"]}
{"id": "11391", "title": "Kernel NULL pointer dereference in do_notify_parent()", "description": "Latest working kernel version: 2.6.26.3\n\nEarliest failing kernel version: 2.6.25.4 (didn't test with former kernels)\n\nDistribution: CentOS 5.1 (with Vanilla kernel from kernel.org)\n\nHardware Environment: several x86_64 plattforms (AMD Opteron, Intel Xeon)\n\nProblem Description:\n-------------------------------------\nBUG: unable to handle kernel NULL pointer dereference at virtual address 0000000000000020\nIP: [<ffffffff8023d5d0>] do_notify_parent+0x66/0x194\nPGD 0\nOops: 0000 [1] SMP\nCPU 1\nModules linked in: ipv6 autofs4 hidp rfcomm l2cap bluetooth sunrpc dm_mirror dm_\nlog dm_multipath dm_mod video output sbs sbshc battery acpi_memhotplug ac lp sg\nfloppy button tg3 serio_raw parport_pc parport k8temp hwmon i2c_amd756 i2c_amd81\n11 i2c_core amd_rng shpchp pcspkr usb_storage 3w_9xxx sata_sil libata sd_mod scs\ni_mod raid456 async_xor async_memcpy async_tx xor ext3 jbd ehci_hcd ohci_hcd uhc\ni_hcd\nPid: 3800, comm: sshd Not tainted 2.6.26.3 #1\nRIP: 0010 [<ffffffff8023d5d0>]  [<ffffffff8023d5d0>] do_notify_parent+0x66/0x194\nRSP: 0018:ffff8101fd943c78  EFLAGS: 00010046\nRAX: 0000000000000000 RBX: ffff8101fe08f2f0 RCX: ffff8101fd956870\nRDX: ffff8101fe08f4c0 RSI: 0000000000000011 RDI: ffff8101fe08f2f0\nRBP: 0000000000000000 R08: 0000000000000009 R09: 0000000000000009\nR10: 0000000000000002 R11: ffffffff802f1c0e R12: 0000000000000011\nR13: ffff8101fe4e00c0 R14: 0000000000000000 R15: 0000000000000001\nFS:  00007fce4b4b2710(0000) GS:ffff8101ff08c8c0(0000) knlGS:0000000000000000\nCS:  0010 DS: 0000 ES: 0000 CR0: 000000008005003b\nCR2: 0000000000000020 CR3: 0000000000201000 CR4: 00000000000006e0\nDR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000\nDR3: 0000000000000000 DR6: 00000000ffff0ff0 DR7: 0000000000000400\nProcess sshd (pid: 3800, threadinfo ffff8101fd942000, task ffff8101fe4e00d0)\nStack:  0000000000000011 ffff8101fec76630 ffff8101fe0e1180 ffffffff8029d597\n 0000000000000008 ffff8101fe0e1180 ffff8101fe7e87c0 ffffffff802a1915\n ffff8101fd856c40 ffff8101fe0e1180 ffff8101fd856c40 0000000000000000\nCall Trace:\n[<ffffffff8029d597>] dput+0x26/0xe7\n[<ffffffff802a1915>] mntput_no_expire+0x20/0x119\n[<ffffffff8028b557>] filp_close+0x5d/0x65\n[<ffffffff80233cd1>] reparent_thread+0x139/0x14d\n[<ffffffff802350ba>] do_exit+0x39a/0x68c\n[<ffffffff80235412>] do_group_exit+0x66/0x96\n[<ffffffff8023d4f7>] get_signal_to_deliver+0x2ea/0x305\n[<ffffffff8020b166>] do_notify_resume+0xaf/0x7de\n[<ffffffff802435de>] autoremove_wake_function+0x0/0x2e\n[<ffffffff80236198>] current_fd_time+0x1e/0x24\n[<ffffffff8036dfdb>] tty_ldisc_deref+0x62/0x75\n[<ffffffff8025bdfe>] autit_syscall_exit+0x2e4/0x303\n[<ffffffff8020bf8c>] int_signal+x012/0x17\n\nCode: 00 48 39 87 30 02 00 00 74 04 0f 0b eb fe 44 89 24 24 c7 44 24 04 00 00 00\n 00 48 8b 83 b8 01 00 00 48 89 df 48 8b 80 98 04 00 00 <48> 8b 70 20 e8 57 39 00\n 00 48 8b 93 a0 04 00 00 89 44 24 10 8b\nRIP  [<ffffffff8023d5c9>] do_notify_parent+0x66/0x194\n RSP <ffff8101f7535c78>\nCR2: 0000000000000020\n---[ end trace 8df15d3ad47033c0 ]---\nFixing recursive fault but reboot is needed!\n-------------------------------------\n\nProblem happens with PID namespaces enabled. After killing the child reaper of a new namespace with SIGKILL, the kernel crashes. I did some debugging and as far as I could see, the NULL pointer dereference happens on this line:\n\ninfo.si_pid = task_pid_nr_ns(tsk, tsk->parent->nsproxy->pid_ns);\n\nI did a BUG_ON(!tsk->parent->nsproxy) one line above and got an appropriate message before the kernel crashed.\n\nSoftware Environment:\n(test program attached)\n\nSteps to reproduce:\n\nCompile the attached test program with \"gcc -o ns_exec ns_exec.c -lpthread\". After being started, it will create a new PID namespace, mount a proc filesystem herein, create a new thread and fork() into an SSHd.\nLogin via SSH (the port of the started SSHd is hardcoded in the test program, so you'll have to modify it appropriately if you wish to do so ;-) ). Do a \"kill -9 1\". On my machines, the kernel crashed in over 90% of all tests.", "patch": ["--- x/kernel/nsproxy.c~\t2008-07-27 17:28:21.000000000 +0400\n+++ x/kernel/nsproxy.c\t2008-08-21 21:17:43.000000000 +0400\n@@ -225,7 +225,8 @@ void switch_task_namespaces(struct task_\n \n \tns = p->nsproxy;\n \n-\trcu_assign_pointer(p->nsproxy, new);\n+\tif (new)\n+\t\trcu_assign_pointer(p->nsproxy, new);\n \n \tif (ns && atomic_dec_and_test(&ns->count)) {\n \t\t/*\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Process Management", "Classification": "Unclassified", "Component": "Other", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "process_other", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2008-08-21 05:58 UTC by Robert Rex", "Modified": "2008-09-02 23:39 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "2.6.26", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["kernel/nsproxy.c"], "methods": ["switch_task_namespaces"]}
{"id": "11331", "title": "Fan speed setting reset after suspend to disk/ram on Thinkpad X31", "": "Show dependency tree", "description": "Distribution: Debian unstable\nHardware Environment: Thinkpad X31\nSoftware Environment: Debian unstable\nProblem Description:\nAfter waking the system from suspend to disk/ram, the fan speed is reset to the default value. As I understand things, the value should be cached and re-set to what I last set it to.\n\nSteps to reproduce:\n\n# echo \"options thinkpad_acpi fan_control=1\" >> /etc/modprobe.d/options\n# shutdown -r now\n\n# echo level 7 >! /proc/acpi/ibm/fan #fan will spin on fastest level, you will hear this\n# cat /proc/acpi/ibm/fan\nstatus:         enabled\nspeed:          4107\nlevel:          7\ncommands:       level <level> (<level> is 0-7, auto, disengaged, full-speed)\ncommands:       enable, disable\ncommands:       watchdog <timeout> (<timeout> is 0 (off), 1-120 (seconds))\ncommands:       speed <speed> (<speed> is 0-65535)\n# s2ram || s2disk\npress Fn-F4 or power button to wake system\n\n# cat /proc/acpi/ibm/fan\nstatus:         enabled\nspeed:          0\nlevel:          auto\ncommands:       level <level> (<level> is 0-7, auto, disengaged, full-speed)\ncommands:       enable, disable\ncommands:       watchdog <timeout> (<timeout> is 0 (off), 1-120 (seconds))\ncommands:       speed <speed> (<speed> is 0-65535)", "patch": ["commit 6649b589e2ea44abc426da8c542c1156f73cb9d5\nAuthor: Henrique de Moraes Holschuh <hmh@hmh.eng.br>\nDate:   Sun Oct 5 18:52:14 2008 -0300\n\n    ACPI: thinkpad-acpi: attempt to preserve fan state on resume\n    \n    Attempt to preserve fan state across sleep and hibernation if the fan\n    control mode is enabled.\n    \n    For safety reasons, only the PWM OFF (fan at 100%) or maximum\n    closed-loop level (level 7) are preserved.  If the fan state was set\n    to anything else, it will not be restored.\n    \n    Also, should the fan be at PWM OFF mode at resume, it will be left at\n    that state (but this is extremely unlikely, no ThinkPad firmware was\n    ever reported to do this).\n    \n    For reference, the known states used for fan control upon resume by\n    the firmware  are either \"auto\" or \"level 7\" depending on whether the\n    laptop wakes due to normal conditions or a thermal emergency.\n    \n    Fixes: http://bugzilla.kernel.org/show_bug.cgi?id=11331\n    \n    Signed-off-by: Henrique de Moraes Holschuh <hmh@hmh.eng.br>\n    Cc: Richard Hartmann <richih.mailinglist@gmail.com>\n\ndiff --git a/drivers/misc/thinkpad_acpi.c b/drivers/misc/thinkpad_acpi.c\nindex 6b93007..1dcf066 100644\n--- a/drivers/misc/thinkpad_acpi.c\n+++ b/drivers/misc/thinkpad_acpi.c\n@@ -5983,6 +5983,52 @@ static void fan_exit(void)\n \tflush_workqueue(tpacpi_wq);\n }\n \n+static void fan_suspend(pm_message_t state)\n+{\n+\tif (!fan_control_allowed)\n+\t\treturn;\n+\n+\t/* Store fan status in cache */\n+\tfan_get_status_safe(NULL);\n+\tif (tp_features.fan_ctrl_status_undef)\n+\t\tfan_control_desired_level = TP_EC_FAN_AUTO;\n+}\n+\n+static void fan_resume(void)\n+{\n+\tu8 saved_fan_level;\n+\tu8 current_level = 7;\n+\tbool do_set = false;\n+\n+\t/* DSDT *always* updates status on resume */\n+\ttp_features.fan_ctrl_status_undef = 0;\n+\n+\tsaved_fan_level = fan_control_desired_level;\n+\tif (!fan_control_allowed ||\n+\t    (fan_get_status_safe(&current_level) < 0))\n+\t\treturn;\n+\n+\tswitch (fan_control_access_mode) {\n+\tcase TPACPI_FAN_WR_ACPI_SFAN:\n+\t\tdo_set = (saved_fan_level > current_level);\n+\t\tbreak;\n+\tcase TPACPI_FAN_WR_ACPI_FANS:\n+\tcase TPACPI_FAN_WR_TPEC:\n+\t\tdo_set = ((saved_fan_level & TP_EC_FAN_FULLSPEED) ||\n+\t\t\t  (saved_fan_level == 7 &&\n+\t\t\t   !(current_level & TP_EC_FAN_FULLSPEED)));\n+\t\tbreak;\n+\tdefault:\n+\t\treturn;\n+\t}\n+\tif (do_set) {\n+\t\tprintk(TPACPI_NOTICE\n+\t\t\t\"restoring fan level to 0x%02x\\n\",\n+\t\t\tsaved_fan_level);\n+\t\tfan_set_level_safe(saved_fan_level);\n+\t}\n+}\n+\n static int fan_read(char *p)\n {\n \tint len = 0;\n@@ -6174,6 +6220,8 @@ static struct ibm_struct fan_driver_data = {\n \t.read = fan_read,\n \t.write = fan_write,\n \t.exit = fan_exit,\n+\t.suspend = fan_suspend,\n+\t.resume = fan_resume,\n };\n \n /****************************************************************************\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Platform", "Hardware": "All Linux", "Importance": "P1 enhancement", "Assignee": "Henrique de Moraes Holschuh", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "7216 56331", "Reported": "2008-08-14 06:45 UTC by Richard Hartmann", "Modified": "2013-04-09 06:23 UTC", "CC List": "3 users", "See Also": "", "Kernel Version": "2.6.26", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/misc/thinkpad_acpi.c"], "methods": ["fan_driver_data"]}
{"id": "11329", "title": "Incorrect value in /sys/devices/platform/w83627hf.656/cpu0_vid", "": "Show dependency tree", "description": "Latest working kernel version: 2.6.27-rc2-git1\nEarliest failing kernel version: 2.6.27-rc2-git2\nDistribution: Debian Sid\nHardware Environment: Athlon 64 x2 4200+\nSoftware Environment: X86_64\nProblem Description: in git1 and previous, cpu0_vid is reported as 1475 (which is correct). Since git2, it is reported as 725\n\nSteps to reproduce: see in /sys/devices/platform/w83627hf.656/cpu0_vid\n\nAccording to this value, the sensors command reports ccpu0_vid as +0.725V\n\nThis problem occurs in rc2-git2 and was not present in rc2-git1, it is still present in rc3-git1\n\nRegards\n\nJean-Luc", "patch": ["From: Jean Delvare <khali@linux-fr.org>\nSubject: hwmon-vid: Fix AMD K8 VID decoding\n\nNot all AMD K8 have 6 VID pins, contrary to what was assumed in\ncommit 116d0486bdefc11f71e567cadf0c47f788b4dd06. This commit broke\nsupport of older CPU models which have only 5 VID pins:\nhttp://bugzilla.kernel.org/show_bug.cgi?id=11329\n\nWe need two entries in the hwmon-vid table, one for 5-bit VID models\n(K8 revision <= E) and one for 6-bit VID models (K8 revision >= F).\nThis fixes bug #11329.\n\nSigned-off-by: Jean Delvare <khali@linux-fr.org>\nAcked-by: Frank Myhr <fmyhr@fhmtech.com>\nTested-by: Jean-Luc Coulon <jean.luc.coulon@gmail.com>\n---\n drivers/hwmon/hwmon-vid.c |   36 ++++++++++++++++++++++++++++--------\n 1 file changed, 28 insertions(+), 8 deletions(-)\n\n--- linux-2.6.27-rc3.orig/drivers/hwmon/hwmon-vid.c\t2008-08-13 09:50:50.000000000 +0200\n+++ linux-2.6.27-rc3/drivers/hwmon/hwmon-vid.c\t2008-08-15 09:48:17.000000000 +0200\n@@ -37,13 +37,21 @@\n  * For VRD 10.0 and up, \"VRD x.y Design Guide\",\n  * available at http://developer.intel.com/.\n  *\n- * AMD NPT 0Fh (Athlon64 & Opteron), AMD Publication 32559,\n+ * AMD Athlon 64 and AMD Opteron Processors, AMD Publication 26094,\n+ * http://www.amd.com/us-en/assets/content_type/white_papers_and_tech_docs/26094.PDF\n+ * Table 74. VID Code Voltages\n+ * This corresponds to an arbitrary VRM code of 24 in the functions below.\n+ * These CPU models (K8 revision <= E) have 5 VID pins. See also:\n+ * Revision Guide for AMD Athlon 64 and AMD Opteron Processors, AMD Publication 25759,\n+ * http://www.amd.com/us-en/assets/content_type/white_papers_and_tech_docs/25759.pdf\n+ *\n+ * AMD NPT Family 0Fh Processors, AMD Publication 32559,\n  * http://www.amd.com/us-en/assets/content_type/white_papers_and_tech_docs/32559.pdf\n  * Table 71. VID Code Voltages\n- * AMD Opteron processors don't follow the Intel specifications.\n- * I'm going to \"make up\" 2.4 as the spec number for the Opterons.\n- * No good reason just a mnemonic for the 24x Opteron processor\n- * series.\n+ * This corresponds to an arbitrary VRM code of 25 in the functions below.\n+ * These CPU models (K8 revision >= F) have 6 VID pins. See also:\n+ * Revision Guide for AMD NPT Family 0Fh Processors, AMD Publication 33610,\n+ * http://www.amd.com/us-en/assets/content_type/white_papers_and_tech_docs/33610.pdf\n  *\n  * The 17 specification is in fact Intel Mobile Voltage Positioning -\n  * (IMVP-II). You can find more information in the datasheet of Max1718\n@@ -95,7 +103,12 @@ int vid_from_reg(int val, u8 vrm)\n \t\t\treturn 0;\n \t\treturn((1600000 - (val - 2) * 6250 + 500) / 1000);\n \n-\tcase 24:\t\t/* AMD NPT 0Fh (Athlon64 & Opteron) */\n+\tcase 24:\t\t/* Athlon64 & Opteron */\n+\t\tval &= 0x1f;\n+\t\tif (val == 0x1f)\n+\t\t\treturn 0;\n+\t\t\t\t/* fall through */\n+\tcase 25:\t\t/* AMD NPT 0Fh */\n \t\tval &= 0x3f;\n \t\treturn (val < 32) ? 1550 - 25 * val\n \t\t\t: 775 - (25 * (val - 31)) / 2;\n@@ -157,11 +170,16 @@ struct vrm_model {\n \n #ifdef CONFIG_X86\n \n-/* the stepping parameter is highest acceptable stepping for current line */\n+/*\n+ * The stepping parameter is highest acceptable stepping for current line.\n+ * The model match must be exact for 4-bit values. For model values 0x10\n+ * and above (extended model), all models below the parameter will match.\n+ */\n \n static struct vrm_model vrm_models[] = {\n \t{X86_VENDOR_AMD, 0x6, ANY, ANY, 90},\t\t/* Athlon Duron etc */\n-\t{X86_VENDOR_AMD, 0xF, ANY, ANY, 24},\t\t/* Athlon 64, Opteron and above VRM 24 */\n+\t{X86_VENDOR_AMD, 0xF, 0x3F, ANY, 24},\t\t/* Athlon 64, Opteron */\n+\t{X86_VENDOR_AMD, 0xF, ANY, ANY, 25},\t\t/* NPT family 0Fh */\n \t{X86_VENDOR_INTEL, 0x6, 0x9, ANY, 13},\t\t/* Pentium M (130 nm) */\n \t{X86_VENDOR_INTEL, 0x6, 0xB, ANY, 85},\t\t/* Tualatin */\n \t{X86_VENDOR_INTEL, 0x6, 0xD, ANY, 13},\t\t/* Pentium M (90 nm) */\n@@ -189,6 +207,8 @@ static u8 find_vrm(u8 eff_family, u8 eff\n \t\tif (vrm_models[i].vendor==vendor)\n \t\t\tif ((vrm_models[i].eff_family==eff_family)\n \t\t\t && ((vrm_models[i].eff_model==eff_model) ||\n+\t\t\t     (vrm_models[i].eff_model >= 0x10 &&\n+\t\t\t      eff_model <= vrm_models[i].eff_model) ||\n \t\t\t     (vrm_models[i].eff_model==ANY)) &&\n \t\t\t     (eff_stepping <= vrm_models[i].eff_stepping))\n \t\t\t\treturn vrm_models[i].vrm_type;\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Hardware Monitoring", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Jean Delvare", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "Regressions-2.6.26", "Reported": "2008-08-14 02:58 UTC by Jean-Luc Coulon", "Modified": "2008-08-15 12:16 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "2.6.27-rc3", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/hwmon/hwmon-vid.c"], "methods": ["vid_from_reg", "find_vrm", "vrm_model"]}
{"id": "11323", "title": "/proc/diskstats does not contain all disk devices", "": "Show dependency tree", "description": "Latest working kernel version: 2.6.26\nEarliest failing kernel version: 2.6.27-rc1\nDistribution: Debian\nHardware Environment: Dell\nSoftware Environment:\nProblem Description: /proc/diskstats does not contain all the block devices it should. /sys/block has all the devices, but /proc/diskstats does not.\n\nSteps to reproduce: boot a system with >9 (10?) disk devices (24 block devices?)", "patch": ["From: Kay Sievers <kay.sievers@vrfy.org>\nSubject: block: fix partial read() of proc files\n\n/proc/partitions gets truncated if it does not fit into the\nread buffer. We need to move the index from the callback of\nclass_find_device() to the caller of class_find_device().\n\nSigned-off-by: Kay Sievers <kay.sievers@vrfy.org>\n---\n genhd.c |   11 ++++++-----\n 1 file changed, 6 insertions(+), 5 deletions(-)\n\ndiff --git a/block/genhd.c b/block/genhd.c\nindex c13cc77..06b2de0 100644\n--- a/block/genhd.c\n+++ b/block/genhd.c\n@@ -293,25 +293,26 @@ void __init printk_all_partitions(void)\n /* iterator */\n static int find_start(struct device *dev, void *data)\n {\n-\tloff_t k = *(loff_t *)data;\n+\tloff_t *k = data;\n \n \tif (dev->type != &disk_type)\n \t\treturn 0;\n-\tif (!k--)\n+\tif (!*k)\n \t\treturn 1;\n+\t(*k)--;\n \treturn 0;\n }\n \n static void *part_start(struct seq_file *part, loff_t *pos)\n {\n \tstruct device *dev;\n-\tloff_t n = *pos;\n+\tloff_t k = *pos;\n \n-\tif (!n)\n+\tif (!k)\n \t\tseq_puts(part, \"major minor  #blocks  name\\n\\n\");\n \n \tmutex_lock(&block_class_lock);\n-\tdev = class_find_device(&block_class, NULL, (void *)pos, find_start);\n+\tdev = class_find_device(&block_class, NULL, &k, find_start);\n \tif (dev)\n \t\treturn dev_to_disk(dev);\n \treturn NULL;\n", "From: Kay Sievers <kay.sievers@vrfy.org>\nSubject: block: fix partial read() of /proc/{partitions,diskstats}\n\nThe proc files get truncated if they do not fit into the buffer with\na single read(). We need to move the seq_file index from the callback\nof class_find_device() to the caller of class_find_device(), to keep\nits value across multiple invocations of the callback.\n\nSigned-off-by: Kay Sievers <kay.sievers@vrfy.org>\n---\n\n genhd.c |   14 ++++++++------\n 1 file changed, 8 insertions(+), 6 deletions(-)\n\ndiff --git a/block/genhd.c b/block/genhd.c\nindex c13cc77..f34befc 100644\n--- a/block/genhd.c\n+++ b/block/genhd.c\n@@ -293,25 +293,26 @@ void __init printk_all_partitions(void)\n /* iterator */\n static int find_start(struct device *dev, void *data)\n {\n-\tloff_t k = *(loff_t *)data;\n+\tloff_t *k = data;\n \n \tif (dev->type != &disk_type)\n \t\treturn 0;\n-\tif (!k--)\n+\tif (!*k)\n \t\treturn 1;\n+\t(*k)--;\n \treturn 0;\n }\n \n static void *part_start(struct seq_file *part, loff_t *pos)\n {\n \tstruct device *dev;\n-\tloff_t n = *pos;\n+\tloff_t k = *pos;\n \n-\tif (!n)\n+\tif (!k)\n \t\tseq_puts(part, \"major minor  #blocks  name\\n\\n\");\n \n \tmutex_lock(&block_class_lock);\n-\tdev = class_find_device(&block_class, NULL, (void *)pos, find_start);\n+\tdev = class_find_device(&block_class, NULL, &k, find_start);\n \tif (dev)\n \t\treturn dev_to_disk(dev);\n \treturn NULL;\n@@ -568,9 +569,10 @@ static struct device_type disk_type = {\n static void *diskstats_start(struct seq_file *part, loff_t *pos)\n {\n \tstruct device *dev;\n+\tloff_t k = *pos;\n \n \tmutex_lock(&block_class_lock);\n-\tdev = class_find_device(&block_class, NULL, (void *)pos, find_start);\n+\tdev = class_find_device(&block_class, NULL, &k, find_start);\n \tif (dev)\n \t\treturn dev_to_disk(dev);\n \treturn NULL;\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "File System", "Classification": "Unclassified", "Component": "Other", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "fs_other", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "Regressions-2.6.26", "Reported": "2008-08-13 12:12 UTC by Andy Ryan", "Modified": "2008-08-23 12:23 UTC", "CC List": "5 users", "See Also": "", "Kernel Version": "2.6.27-rc1", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["block/genhd.c"], "methods": ["find_start", "*part_start"]}
{"id": "11242", "title": "Regression with handling the DEL key on Thinkpad X31", "description": "Latest working kernel version: 2.6.25.10\nEarliest failing kernel version: 2.6.26\nDistribution: Debian unstable\nHardware Environment: IBM Thinkpad X31\nSoftware Environment: Debian unstable\nProblem Description:\n\nI'm running my system without X11 in a fbcon console. Since the update to 2.6.26 the INSERT key is no longer working properly. It seems to lead to a very strange internal \"lock\": If INSERT is pressed, the arrow keys are no longer accepted. If I press INSERT again, the arrow keys work again. This bug is fairly annoying.\nIn X11 the INSERT key is handled properly. 2.6.25 works just fine. \n\nSteps to reproduce:\nRun elinks with an arbitary web site; scroll a few lines up with the INSERT key.", "patch": ["From 252b7805384d12c6857b8bebf1a373e327afbec9 Mon Sep 17 00:00:00 2001\nFrom: Pascal Terjan <pterjan@mandriva.com>\nDate: Wed, 17 Sep 2008 10:51:01 +0200\nSubject: [PATCH] Only register notifiers when the braille console is used.\n\nhttp://bugzilla.kernel.org/show_bug.cgi?id=11242\n\nSigned-off-by: Pascal Terjan <pterjan@mandriva.com>\n---\n drivers/accessibility/braille/braille_console.c |   13 ++++---------\n 1 files changed, 4 insertions(+), 9 deletions(-)\n\ndiff --git a/drivers/accessibility/braille/braille_console.c b/drivers/accessibility/braille/braille_console.c\nindex 0a5f6b2..d672cfe 100644\n--- a/drivers/accessibility/braille/braille_console.c\n+++ b/drivers/accessibility/braille/braille_console.c\n@@ -376,6 +376,8 @@ int braille_register_console(struct console *console, int index,\n \tconsole->flags |= CON_ENABLED;\n \tconsole->index = index;\n \tbraille_co = console;\n+\tregister_keyboard_notifier(&keyboard_notifier_block);\n+\tregister_vt_notifier(&vt_notifier_block);\n \treturn 0;\n }\n \n@@ -383,15 +385,8 @@ int braille_unregister_console(struct console *console)\n {\n \tif (braille_co != console)\n \t\treturn -EINVAL;\n+\tunregister_keyboard_notifier(&keyboard_notifier_block);\n+\tunregister_vt_notifier(&vt_notifier_block);\n \tbraille_co = NULL;\n \treturn 0;\n }\n-\n-static int __init braille_init(void)\n-{\n-\tregister_keyboard_notifier(&keyboard_notifier_block);\n-\tregister_vt_notifier(&vt_notifier_block);\n-\treturn 0;\n-}\n-\n-console_initcall(braille_init);\n-- \n1.6.0.2\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Console/Framebuffers", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "James Simmons", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2008-08-03 14:10 UTC by Moritz Mühlenhoff", "Modified": "2008-10-02 23:53 UTC", "CC List": "5 users", "See Also": "", "Kernel Version": "2.6.26", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/accessibility/braille/braille_console.c"], "methods": ["braille_register_console", "braille_init"]}
{"id": "11212", "title": "PROBLEM: abituguru3 module does not recognize my ip35 pro since 2.6.26", "description": "Latest working kernel version: 2.6.25\nEarliest failing kernel version: 2.6.26\nDistribution: Debian lenny\nHardware Environment: ABit IP35-pro Bios rev 16 (2008-march-18)\nSoftware Environment: Linux 2.6.26 #2 SMP i686\nabituguru3 is the first module loaded on boot (added in /etc/modules)\n\nProblem Description:\nuguru3 is not recognized on boot since i upgraded to kernel 2.6.26\nbut it works after force.\n\nSteps to reproduce:\n$ modprobe abituguru3 ; dmesg | tail -1\nabituguru3: no Abit uGuru3 found, data = 0x00, cmd = 0x4C\n$ modprobe abituguru3 ; dmesg | tail -2\nabituguru3: Assuming Abit uGuru3 is present because of \"force\" parameter\nabituguru3: found Abit uGuru3, motherboard ID: 001A (Abit IP35 Pro)\n$ rmmod abituguru3\n$ modprobe abituguru3 ; dmesg | tail -1\nabituguru3: found Abit uGuru3, motherboard ID: 001A (Abit IP35 Pro)", "patch": ["diff --git a/MAINTAINERS b/MAINTAINERS\nindex deedc0d..9058be3 100644\n--- a/MAINTAINERS\n+++ b/MAINTAINERS\n@@ -175,12 +175,18 @@ M:\tbcrl@kvack.org\n L:\tlinux-aio@kvack.org\n S:\tSupported\n \n-ABIT UGURU HARDWARE MONITOR DRIVER\n+ABIT UGURU 1,2 HARDWARE MONITOR DRIVER\n P:\tHans de Goede\n M:\tj.w.r.degoede@hhs.nl\n L:\tlm-sensors@lm-sensors.org\n S:\tMaintained\n \n+ABIT UGURU 3 HARDWARE MONITOR DRIVER\n+P:\tAlistair John Strachan\n+M:\talistair@devzero.co.uk\n+L:\tlm-sensors@lm-sensors.org\n+S:\tMaintained\n+\n ACENIC DRIVER\n P:\tJes Sorensen\n M:\tjes@trained-monkey.org\ndiff --git a/drivers/hwmon/abituguru3.c b/drivers/hwmon/abituguru3.c\nindex f00f497..95f4147 100644\n--- a/drivers/hwmon/abituguru3.c\n+++ b/drivers/hwmon/abituguru3.c\n@@ -1,5 +1,8 @@\n /*\n-    abituguru3.c Copyright (c) 2006 Hans de Goede <j.w.r.degoede@hhs.nl>\n+    abituguru3.c\n+\n+    Copyright (c) 2006-2008 Hans de Goede <j.w.r.degoede@hhs.nl>\n+    Copyright (c) 2008 Alistair John Strachan <alistair@devzero.co.uk>\n \n     This program is free software; you can redistribute it and/or modify\n     it under the terms of the GNU General Public License as published by\n@@ -116,7 +119,7 @@ struct abituguru3_sensor_info {\n \n struct abituguru3_motherboard_info {\n \tu16 id;\n-\tconst char *name;\n+\tconst char *dmi_name;\n \t/* + 1 -> end of sensors indicated by a sensor with name == NULL */\n \tstruct abituguru3_sensor_info sensors[ABIT_UGURU3_MAX_NO_SENSORS + 1];\n };\n@@ -161,7 +164,7 @@ struct abituguru3_data {\n \n /* Constants */\n static const struct abituguru3_motherboard_info abituguru3_motherboards[] = {\n-\t{ 0x000C, \"unknown\", {\n+\t{ 0x000C, NULL /* Unknown, need DMI string */, {\n \t\t{ \"CPU Core\",\t\t 0, 0, 10, 1, 0 },\n \t\t{ \"DDR\",\t\t 1, 0, 10, 1, 0 },\n \t\t{ \"DDR VTT\",\t\t 2, 0, 10, 1, 0 },\n@@ -183,7 +186,7 @@ static const struct abituguru3_motherboard_info abituguru3_motherboards[] = {\n \t\t{ \"AUX1 Fan\",\t\t35, 2, 60, 1, 0 },\n \t\t{ NULL, 0, 0, 0, 0, 0 } }\n \t},\n-\t{ 0x000D, \"Abit AW8\", {\n+\t{ 0x000D, NULL /* Abit AW8, need DMI string */, {\n \t\t{ \"CPU Core\",\t\t 0, 0, 10, 1, 0 },\n \t\t{ \"DDR\",\t\t 1, 0, 10, 1, 0 },\n \t\t{ \"DDR VTT\",\t\t 2, 0, 10, 1, 0 },\n@@ -212,7 +215,7 @@ static const struct abituguru3_motherboard_info abituguru3_motherboards[] = {\n \t\t{ \"AUX5 Fan\",\t\t39, 2, 60, 1, 0 },\n \t\t{ NULL, 0, 0, 0, 0, 0 } }\n \t},\n-\t{ 0x000E, \"AL-8\", {\n+\t{ 0x000E, NULL /* AL-8, need DMI string */, {\n \t\t{ \"CPU Core\",\t\t 0, 0, 10, 1, 0 },\n \t\t{ \"DDR\",\t\t 1, 0, 10, 1, 0 },\n \t\t{ \"DDR VTT\",\t\t 2, 0, 10, 1, 0 },\n@@ -233,7 +236,7 @@ static const struct abituguru3_motherboard_info abituguru3_motherboards[] = {\n \t\t{ \"SYS Fan\",\t\t34, 2, 60, 1, 0 },\n \t\t{ NULL, 0, 0, 0, 0, 0 } }\n \t},\n-\t{ 0x000F, \"unknown\", {\n+\t{ 0x000F, NULL /* Unknown, need DMI string */, {\n \t\t{ \"CPU Core\",\t\t 0, 0, 10, 1, 0 },\n \t\t{ \"DDR\",\t\t 1, 0, 10, 1, 0 },\n \t\t{ \"DDR VTT\",\t\t 2, 0, 10, 1, 0 },\n@@ -254,7 +257,7 @@ static const struct abituguru3_motherboard_info abituguru3_motherboards[] = {\n \t\t{ \"SYS Fan\",\t\t34, 2, 60, 1, 0 },\n \t\t{ NULL, 0, 0, 0, 0, 0 } }\n \t},\n-\t{ 0x0010, \"Abit NI8 SLI GR\", {\n+\t{ 0x0010, NULL /* Abit NI8 SLI GR, need DMI string */, {\n \t\t{ \"CPU Core\",\t\t 0, 0, 10, 1, 0 },\n \t\t{ \"DDR\",\t\t 1, 0, 10, 1, 0 },\n \t\t{ \"DDR VTT\",\t\t 2, 0, 10, 1, 0 },\n@@ -276,7 +279,7 @@ static const struct abituguru3_motherboard_info abituguru3_motherboards[] = {\n \t\t{ \"OTES1 Fan\",\t\t36, 2, 60, 1, 0 },\n \t\t{ NULL, 0, 0, 0, 0, 0 } }\n \t},\n-\t{ 0x0011, \"Abit AT8 32X\", {\n+\t{ 0x0011, NULL /* Abit AT8 32X, need DMI string */, {\n \t\t{ \"CPU Core\",\t\t 0, 0, 10, 1, 0 },\n \t\t{ \"DDR\",\t\t 1, 0, 20, 1, 0 },\n \t\t{ \"DDR VTT\",\t\t 2, 0, 10, 1, 0 },\n@@ -302,7 +305,7 @@ static const struct abituguru3_motherboard_info abituguru3_motherboards[] = {\n \t\t{ \"AUX2 Fan\",\t\t36, 2, 60, 1, 0 },\n \t\t{ NULL, 0, 0, 0, 0, 0 } }\n \t},\n-\t{ 0x0012, \"Abit AN8 32X\", {\n+\t{ 0x0012, NULL /* Abit AN8 32X, need DMI string */, {\n \t\t{ \"CPU Core\",\t\t 0, 0, 10, 1, 0 },\n \t\t{ \"DDR\",\t\t 1, 0, 20, 1, 0 },\n \t\t{ \"DDR VTT\",\t\t 2, 0, 10, 1, 0 },\n@@ -324,7 +327,7 @@ static const struct abituguru3_motherboard_info abituguru3_motherboards[] = {\n \t\t{ \"AUX1 Fan\",\t\t36, 2, 60, 1, 0 },\n \t\t{ NULL, 0, 0, 0, 0, 0 } }\n \t},\n-\t{ 0x0013, \"Abit AW8D\", {\n+\t{ 0x0013, NULL /* Abit AW8D, need DMI string */, {\n \t\t{ \"CPU Core\",\t\t 0, 0, 10, 1, 0 },\n \t\t{ \"DDR\",\t\t 1, 0, 10, 1, 0 },\n \t\t{ \"DDR VTT\",\t\t 2, 0, 10, 1, 0 },\n@@ -353,7 +356,7 @@ static const struct abituguru3_motherboard_info abituguru3_motherboards[] = {\n \t\t{ \"AUX5 Fan\",\t\t39, 2, 60, 1, 0 },\n \t\t{ NULL, 0, 0, 0, 0, 0 } }\n \t},\n-\t{ 0x0014, \"Abit AB9 Pro\", {\n+\t{ 0x0014, NULL /* Abit AB9 Pro, need DMI string */, {\n \t\t{ \"CPU Core\",\t\t 0, 0, 10, 1, 0 },\n \t\t{ \"DDR\",\t\t 1, 0, 10, 1, 0 },\n \t\t{ \"DDR VTT\",\t\t 2, 0, 10, 1, 0 },\n@@ -374,7 +377,7 @@ static const struct abituguru3_motherboard_info abituguru3_motherboards[] = {\n \t\t{ \"SYS Fan\",\t\t34, 2, 60, 1, 0 },\n \t\t{ NULL, 0, 0, 0, 0, 0 } }\n \t},\n-\t{ 0x0015, \"unknown\", {\n+\t{ 0x0015, NULL /* Unknown, need DMI string */, {\n \t\t{ \"CPU Core\",\t\t 0, 0, 10, 1, 0 },\n \t\t{ \"DDR\",\t\t 1, 0, 20, 1, 0 },\n \t\t{ \"DDR VTT\",\t\t 2, 0, 10, 1, 0 },\n@@ -398,7 +401,7 @@ static const struct abituguru3_motherboard_info abituguru3_motherboards[] = {\n \t\t{ \"AUX3 Fan\",\t\t36, 2, 60, 1, 0 },\n \t\t{ NULL, 0, 0, 0, 0, 0 } }\n \t},\n-\t{ 0x0016, \"AW9D-MAX\", {\n+\t{ 0x0016, NULL /* AW9D-MAX, need DMI string */, {\n \t\t{ \"CPU Core\",\t\t 0, 0, 10, 1, 0 },\n \t\t{ \"DDR2\",\t\t 1, 0, 20, 1, 0 },\n \t\t{ \"DDR2 VTT\",\t\t 2, 0, 10, 1, 0 },\n@@ -426,7 +429,7 @@ static const struct abituguru3_motherboard_info abituguru3_motherboards[] = {\n \t\t{ \"OTES1 Fan\",\t\t38, 2, 60, 1, 0 },\n \t\t{ NULL, 0, 0, 0, 0, 0 } }\n \t},\n-\t{ 0x0017, \"unknown\", {\n+\t{ 0x0017, NULL /* Unknown, need DMI string */, {\n \t\t{ \"CPU Core\",\t\t 0, 0, 10, 1, 0 },\n \t\t{ \"DDR2\",\t\t 1, 0, 20, 1, 0 },\n \t\t{ \"DDR2 VTT\",\t\t 2, 0, 10, 1, 0 },\n@@ -451,7 +454,7 @@ static const struct abituguru3_motherboard_info abituguru3_motherboards[] = {\n \t\t{ \"AUX3 FAN\",\t\t37, 2, 60, 1, 0 },\n \t\t{ NULL, 0, 0, 0, 0, 0 } }\n \t},\n-\t{ 0x0018, \"unknown\", {\n+\t{ 0x0018, NULL /* Unknown, need DMI string */, {\n \t\t{ \"CPU Core\",\t\t 0, 0, 10, 1, 0 },\n \t\t{ \"DDR2\",\t\t 1, 0, 20, 1, 0 },\n \t\t{ \"DDR2 VTT\",\t\t 2, 0, 10, 1, 0 },\n@@ -478,7 +481,7 @@ static const struct abituguru3_motherboard_info abituguru3_motherboards[] = {\n \t\t{ \"AUX3 Fan\",\t\t36, 2, 60, 1, 0 },\n \t\t{ NULL, 0, 0, 0, 0, 0 } }\n \t},\n-\t{ 0x0019, \"unknown\", {\n+\t{ 0x0019, NULL /* Unknown, need DMI string */, {\n \t\t{ \"CPU Core\",\t\t 7, 0, 10, 1, 0 },\n \t\t{ \"DDR2\",\t\t13, 0, 20, 1, 0 },\n \t\t{ \"DDR2 VTT\",\t\t14, 0, 10, 1, 0 },\n@@ -505,7 +508,7 @@ static const struct abituguru3_motherboard_info abituguru3_motherboards[] = {\n \t\t{ \"AUX3 FAN\",\t\t36, 2, 60, 1, 0 },\n \t\t{ NULL, 0, 0, 0, 0, 0 } }\n \t},\n-\t{ 0x001A, \"Abit IP35 Pro\", {\n+\t{ 0x001A, \"IP35 Pro(Intel P35-ICH9R)\", {\n \t\t{ \"CPU Core\",\t\t 0, 0, 10, 1, 0 },\n \t\t{ \"DDR2\",\t\t 1, 0, 20, 1, 0 },\n \t\t{ \"DDR2 VTT\",\t\t 2, 0, 10, 1, 0 },\n@@ -533,7 +536,7 @@ static const struct abituguru3_motherboard_info abituguru3_motherboards[] = {\n \t\t{ \"AUX4 Fan\",\t\t37, 2, 60, 1, 0 },\n \t\t{ NULL, 0, 0, 0, 0, 0 } }\n \t},\n-\t{ 0x001B, \"unknown\", {\n+\t{ 0x001B, NULL /* Unknown, need DMI string */, {\n \t\t{ \"CPU Core\",\t\t 0, 0, 10, 1, 0 },\n \t\t{ \"DDR3\",\t\t 1, 0, 20, 1, 0 },\n \t\t{ \"DDR3 VTT\",\t\t 2, 0, 10, 1, 0 },\n@@ -560,7 +563,7 @@ static const struct abituguru3_motherboard_info abituguru3_motherboards[] = {\n \t\t{ \"AUX3 Fan\",\t\t36, 2, 60, 1, 0 },\n \t\t{ NULL, 0, 0, 0, 0, 0 } }\n \t},\n-\t{ 0x001C, \"unknown\", {\n+\t{ 0x001C, NULL /* Unknown, need DMI string */, {\n \t\t{ \"CPU Core\",\t\t 0, 0, 10, 1, 0 },\n \t\t{ \"DDR2\",\t\t 1, 0, 20, 1, 0 },\n \t\t{ \"DDR2 VTT\",\t\t 2, 0, 10, 1, 0 },\n@@ -935,9 +938,18 @@ static int __devinit abituguru3_probe(struct platform_device *pdev)\n \t\tgoto abituguru3_probe_error;\n \t}\n \tdata->sensors = abituguru3_motherboards[i].sensors;\n+\n \tprintk(KERN_INFO ABIT_UGURU3_NAME \": found Abit uGuru3, motherboard \"\n-\t\t\"ID: %04X (%s)\\n\", (unsigned int)id,\n-\t\tabituguru3_motherboards[i].name);\n+\t\t\"ID: %04X\\n\", (unsigned int)id);\n+\n+#ifdef CONFIG_DMI\n+\tif (!abituguru3_motherboards[i].dmi_name) {\n+\t\tprintk(KERN_WARNING ABIT_UGURU3_NAME \": this motherboard was \"\n+\t\t\t\"not detected using DMI. Please send the output of \"\n+\t\t\t\"\\\"dmidecode\\\" to the abituguru3 maintainer\"\n+\t\t\t\"(see MAINTAINERS)\\n\");\n+\t}\n+#endif\n \n \t/* Fill the sysfs attr array */\n \tsysfs_attr_i = 0;\n@@ -1109,6 +1121,46 @@ static struct platform_driver abituguru3_driver = {\n \t.resume = abituguru3_resume\n };\n \n+#ifdef CONFIG_DMI\n+\n+static int __init abituguru3_dmi_detect(void)\n+{\n+\tconst char *board_vendor, *board_name;\n+\tint i, err = (force) ? 1 : -ENODEV;\n+\n+\tboard_vendor = dmi_get_system_info(DMI_BOARD_VENDOR);\n+\tif (!board_vendor || strcmp(board_vendor, \"http://www.abit.com.tw/\"))\n+\t\treturn err;\n+\n+\tboard_name = dmi_get_system_info(DMI_BOARD_NAME);\n+\tif (!board_name)\n+\t\treturn err;\n+\n+\tfor (i = 0; abituguru3_motherboards[i].id; i++) {\n+\t\tconst char *dmi_name = abituguru3_motherboards[i].dmi_name;\n+\t\tif (dmi_name && !strcmp(dmi_name, board_name))\n+\t\t\tbreak;\n+\t}\n+\n+\tif (!abituguru3_motherboards[i].id)\n+\t\treturn 1;\n+\n+\treturn 0;\n+}\n+\n+#else /* !CONFIG_DMI */\n+\n+static inline int abituguru3_dmi_detect(void)\n+{\n+\treturn -ENODEV;\n+}\n+\n+#endif /* CONFIG_DMI */\n+\n+/* FIXME: Manual detection should die eventually; we need to collect stable\n+ *        DMI model names first before we can rely entirely on CONFIG_DMI.\n+ */\n+\n static int __init abituguru3_detect(void)\n {\n \t/* See if there is an uguru3 there. An idle uGuru3 will hold 0x00 or\n@@ -1119,7 +1171,7 @@ static int __init abituguru3_detect(void)\n \tif (((data_val == 0x00) || (data_val == 0x08)) &&\n \t\t\t((cmd_val == 0xAC) || (cmd_val == 0x05) ||\n \t\t\t (cmd_val == 0x55)))\n-\t\treturn ABIT_UGURU3_BASE;\n+\t\treturn 0;\n \n \tABIT_UGURU3_DEBUG(\"no Abit uGuru3 found, data = 0x%02X, cmd = \"\n \t\t\"0x%02X\\n\", (unsigned int)data_val, (unsigned int)cmd_val);\n@@ -1127,7 +1179,7 @@ static int __init abituguru3_detect(void)\n \tif (force) {\n \t\tprintk(KERN_INFO ABIT_UGURU3_NAME \": Assuming Abit uGuru3 is \"\n \t\t\t\t\"present because of \\\"force\\\" parameter\\n\");\n-\t\treturn ABIT_UGURU3_BASE;\n+\t\treturn 0;\n \t}\n \n \t/* No uGuru3 found */\n@@ -1138,27 +1190,29 @@ static struct platform_device *abituguru3_pdev;\n \n static int __init abituguru3_init(void)\n {\n-\tint address, err;\n \tstruct resource res = { .flags = IORESOURCE_IO };\n-\n-#ifdef CONFIG_DMI\n-\tconst char *board_vendor = dmi_get_system_info(DMI_BOARD_VENDOR);\n-\n-\t/* safety check, refuse to load on non Abit motherboards */\n-\tif (!force && (!board_vendor ||\n-\t\t\tstrcmp(board_vendor, \"http://www.abit.com.tw/\")))\n-\t\treturn -ENODEV;\n-#endif\n-\n-\taddress = abituguru3_detect();\n-\tif (address < 0)\n-\t\treturn address;\n+\tint err;\n+\n+\t/* Attempt DMI detection first */\n+\terr = abituguru3_dmi_detect();\n+\tif (err < 0)\n+\t\treturn err;\n+\n+\t/* Fall back to manual detection if there was no exact\n+\t * board name match, or force was specified.\n+\t */\n+\tif (err > 0) {\n+\t\terr = abituguru3_detect();\n+\t\tif (err)\n+\t\t\treturn err;\t\n+\t}\n \n \terr = platform_driver_register(&abituguru3_driver);\n \tif (err)\n \t\tgoto exit;\n \n-\tabituguru3_pdev = platform_device_alloc(ABIT_UGURU3_NAME, address);\n+\tabituguru3_pdev = platform_device_alloc(ABIT_UGURU3_NAME,\n+\t\t\t\t\t\tABIT_UGURU3_BASE);\n \tif (!abituguru3_pdev) {\n \t\tprintk(KERN_ERR ABIT_UGURU3_NAME\n \t\t\t\": Device allocation failed\\n\");\n@@ -1166,8 +1220,8 @@ static int __init abituguru3_init(void)\n \t\tgoto exit_driver_unregister;\n \t}\n \n-\tres.start = address;\n-\tres.end = address + ABIT_UGURU3_REGION_LENGTH - 1;\n+\tres.start = ABIT_UGURU3_BASE;\n+\tres.end = ABIT_UGURU3_BASE + ABIT_UGURU3_REGION_LENGTH - 1;\n \tres.name = ABIT_UGURU3_NAME;\n \n \terr = platform_device_add_resources(abituguru3_pdev, &res, 1);\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Hardware Monitoring", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Alistair Strachan", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2008-08-01 00:52 UTC by Alain Cabiran", "Modified": "2008-08-02 09:23 UTC", "CC List": "3 users", "See Also": "", "Kernel Version": "2.6.26", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/hwmon/abituguru3.c"], "methods": ["abituguru3_detect", "abituguru3_init", "abituguru3_motherboard_info", "abituguru3_motherboards", "abituguru3_motherboards", "abituguru3_motherboards", "abituguru3_motherboards", "abituguru3_motherboards", "abituguru3_motherboards", "abituguru3_motherboards", "abituguru3_motherboards", "abituguru3_motherboards", "abituguru3_motherboards", "abituguru3_motherboards", "abituguru3_motherboards", "abituguru3_motherboards", "abituguru3_motherboards", "abituguru3_motherboards", "abituguru3_motherboards", "static struct platform_driver abituguru3_driver", "static struct platform_device *abituguru3_pdev;"]}
{"id": "11178", "title": "Secondary hard drive fails during both hibernation and resume.", "": "Show dependency tree", "description": "Latest working kernel version: 2.6.26\nEarliest failing kernel version: 2.6.27-rc1\nDistribution: Ubuntu Hardy (8.04)\nHardware Environment:Intel C2D.  Two hard drives.\nSoftware Environment:64 bit kernel & userspace.\nProblem Description:\n\nDuring hibernation I get errors on the second hard drive, including\n\nata3 revalidation failed errno=-5\n\nHibernation continues anyway (the swap partition is on the first hard drive).  I think these messages don't show up in dmesg afterwards because they happen too late in the hibernation process.\n\nI get much the same errors on resume as well, which do show up in dmesg.\n\nSteps to reproduce:\nBoot in \"rescue mode\" (didn't try init=/bin/bash) and use \"echo disk > /sys/power/state\"", "patch": ["diff --git a/drivers/pci/msi.c b/drivers/pci/msi.c\nindex 15af618..b5224be 100644\n--- a/drivers/pci/msi.c\n+++ b/drivers/pci/msi.c\n@@ -299,9 +299,8 @@ static void __pci_restore_msi_state(struct pci_dev *dev)\n \t\t\t\t  entry->msi_attrib.masked);\n \n \tpci_read_config_word(dev, pos + PCI_MSI_FLAGS, &control);\n-\tcontrol &= ~(PCI_MSI_FLAGS_QSIZE | PCI_MSI_FLAGS_ENABLE);\n-\tif (entry->msi_attrib.maskbit || !entry->msi_attrib.masked)\n-\t\tcontrol |= PCI_MSI_FLAGS_ENABLE;\n+\tcontrol &= ~PCI_MSI_FLAGS_QSIZE;\n+\tcontrol |= PCI_MSI_FLAGS_ENABLE;\n \tpci_write_config_word(dev, pos + PCI_MSI_FLAGS, control);\n }\n \n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "PCI", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "drivers_pci@kernel-bugs.osdl.org", "URL": "", "Keywords": "", "Duplicates (3)": "11214 11232 11283", "Depends on": "", "Blocks": "7216 Regressions-2.6.26", "Reported": "2008-07-30 04:53 UTC by Alan Jenkins", "Modified": "2008-12-19 19:31 UTC", "CC List": "9 users", "See Also": "", "Kernel Version": "2.6.27-rc1", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/pci/msi.c"], "methods": ["__pci_restore_msi_state"]}
{"id": "11154", "title": "NFS hangs with 2.6.25/2.6.26 despite server being reachable", "": "Show dependency tree", "description": "Latest working kernel version: 2.6.24\nEarliest failing kernel version: 2.6.25\nDistribution: debian etch\nProblem Description:\n\nI'm getting frequent NFS hangs when running 2.6.25 or 2.6.26 on my NFS clients, while 2.6.24 seems to work fine. The hangs most commonly (but not always) happen after a suspend/resume cycle on the client. The client is pingable from the server during the hangs, but the clients can't access their NFS mounted rootfs. 2.6.25 based clients always recover after some time (varies from just seconds to 5 or 10 minutes). 2.6.26 based clients apparently never recover.\n\nHere are a few more details about my setup:\n\n* The NFS server is a linux host (x86-64) running 2.6.22.19;\n\n* I have two diskless clients using different hardware, one is an old\n  AMD K7 with intel pro/100 adapter, the other is x86-64 with on-board\n  intel e1000e networking.\n\n* The clients boot from a small initrd and mount their rootfs using\n  NFS3 over TCP. The initial mounting is done with \"nfsmount -o ro,nolock\"\n  from the klibc-utils package.\n\n* /etc/fstab in the clients describe the nfs root as having the nolock,noatime\n  options. The boot scripts (unmodified from my debian etch distro)\n  remount the root using these. In the end, /proc/mounts shows the rootfs as\n  using the following options:\n  When running 2.6.24 on the client:\n    rw,noatime,vers=3,rsize=131072,wsize=131072,hard,nointr,\n    nolock,proto=tcp,timeo=7,retrans=3,sec=sys\n  When running 2.6.26 on the client:\n    rw,noatime,vers=3,rsize=131072,wsize=131072,namlen=255,hard,nointr,\n    nolock,proto=tcp,timeo=7,retrans=3,sec=sys,mountproto=udp\n\n* I often run suspend-to-ram on the clients, if I think they'll be unused\n  for a few hours.\n\n* The issue most often happens after a resume. The clients hang showing the classic symptoms of what would happen if they can not reach their NFS server: load goes to high values, processes can't access the filesystem and get 'stuck' when they try to do so. Some processes which don't access the filesystem, like xload for example, keep going and display high load values. Shell sessions usualy get stuck before I can do anything useful with them.\n\n* I can log on the server and confirm that the clients are pingable from there during the times where they seem stuck on their NFS accesses.\n\n* 2.6.24 based clients do not exhibit this failure. 2.6.25 based clients always recover after a while (can vary from few seconds to 10 minutes or so). 2.6.26 based clients don't seem to recover, as far as I could see (I only let this happen once on each of my clients, so far, and have gone back to 2.6.25 for further experiments).\n\n* I don't suppose the failure to be related to ACPI suspend issues, given that I've observed it on both of my NFS clients with very different hardware.\n\n* I do not fully understand which parameters trigger this failure. I can sometimes run 2.6.25 for a week without hitting it, and then hit it twice in a row the next day... Not a good candidate for a binary search, I think :/\n\n\nOn a suggestion from J. Bruce Fields, I obtained a couple sysrq-T traces of a client during the NFS freeze, attached below. I'm also open to other suggestions about information to collect - I am, however, not sure if I'll be able to try anything in a root shell session during the NFS hangs, given the very limited functionality of the clients during these... :/", "patch": ["From: Trond Myklebust <Trond.Myklebust@netapp.com>\nDate: Thu, 23 Oct 2008 11:33:59 -0400\nSUNRPC: Respond promptly to server TCP resets\n\nIf the server sends us an RST error while we're in the TCP_ESTABLISHED\nstate, then that will not result in a state change, and so the RPC client\nends up hanging forever (see\nhttp://bugzilla.kernel.org/show_bug.cgi?id=11154)\n\nWe can intercept the reset by setting up an sk->sk_error_report callback,\nwhich will then allow us to initiate a proper shutdown and retry...\n\nWe also make sure that if the send request receives an ECONNRESET, then we\nshutdown too...\n\nSigned-off-by: Trond Myklebust <Trond.Myklebust@netapp.com>\n---\n\n net/sunrpc/xprtsock.c |   58 +++++++++++++++++++++++++++++++++++++++++--------\n 1 files changed, 48 insertions(+), 10 deletions(-)\n\ndiff --git a/net/sunrpc/xprtsock.c b/net/sunrpc/xprtsock.c\nindex 9a288d5..0a50361 100644\n--- a/net/sunrpc/xprtsock.c\n+++ b/net/sunrpc/xprtsock.c\n@@ -249,6 +249,7 @@ struct sock_xprt {\n \tvoid\t\t\t(*old_data_ready)(struct sock *, int);\n \tvoid\t\t\t(*old_state_change)(struct sock *);\n \tvoid\t\t\t(*old_write_space)(struct sock *);\n+\tvoid\t\t\t(*old_error_report)(struct sock *);\n };\n \n /*\n@@ -698,8 +699,9 @@ static int xs_tcp_send_request(struct rpc_task *task)\n \tcase -EAGAIN:\n \t\txs_nospace(task);\n \t\tbreak;\n-\tcase -ECONNREFUSED:\n \tcase -ECONNRESET:\n+\t\txs_tcp_shutdown(xprt);\n+\tcase -ECONNREFUSED:\n \tcase -ENOTCONN:\n \tcase -EPIPE:\n \t\tstatus = -ENOTCONN;\n@@ -742,6 +744,22 @@ out_release:\n \txprt_release_xprt(xprt, task);\n }\n \n+static void xs_save_old_callbacks(struct sock_xprt *transport, struct sock *sk)\n+{\n+\ttransport->old_data_ready = sk->sk_data_ready;\n+\ttransport->old_state_change = sk->sk_state_change;\n+\ttransport->old_write_space = sk->sk_write_space;\n+\ttransport->old_error_report = sk->sk_error_report;\n+}\n+\n+static void xs_restore_old_callbacks(struct sock_xprt *transport, struct sock *sk)\n+{\n+\tsk->sk_data_ready = transport->old_data_ready;\n+\tsk->sk_state_change = transport->old_state_change;\n+\tsk->sk_write_space = transport->old_write_space;\n+\tsk->sk_error_report = transport->old_error_report;\n+}\n+\n /**\n  * xs_close - close a socket\n  * @xprt: transport\n@@ -765,9 +783,8 @@ static void xs_close(struct rpc_xprt *xprt)\n \ttransport->sock = NULL;\n \n \tsk->sk_user_data = NULL;\n-\tsk->sk_data_ready = transport->old_data_ready;\n-\tsk->sk_state_change = transport->old_state_change;\n-\tsk->sk_write_space = transport->old_write_space;\n+\n+\txs_restore_old_callbacks(transport, sk);\n \twrite_unlock_bh(&sk->sk_callback_lock);\n \n \tsk->sk_no_check = 0;\n@@ -1180,6 +1197,28 @@ static void xs_tcp_state_change(struct sock *sk)\n }\n \n /**\n+ * xs_tcp_error_report - callback mainly for catching RST events\n+ * @sk: socket\n+ */\n+static void xs_tcp_error_report(struct sock *sk)\n+{\n+\tstruct rpc_xprt *xprt;\n+\n+\tread_lock(&sk->sk_callback_lock);\n+\tif (sk->sk_err != ECONNRESET || sk->sk_state != TCP_ESTABLISHED)\n+\t\tgoto out;\n+\tif (!(xprt = xprt_from_sock(sk)))\n+\t\tgoto out;\n+\tdprintk(\"RPC:       %s client %p...\\n\"\n+\t\t\t\"RPC:       error %d\\n\",\n+\t\t\t__func__, xprt, sk->sk_err);\n+\n+\txprt_force_disconnect(xprt);\n+out:\n+\tread_unlock(&sk->sk_callback_lock);\n+}\n+\n+/**\n  * xs_udp_write_space - callback invoked when socket buffer space\n  *                             becomes available\n  * @sk: socket whose state has changed\n@@ -1454,10 +1493,9 @@ static void xs_udp_finish_connecting(struct rpc_xprt *xprt, struct socket *sock)\n \n \t\twrite_lock_bh(&sk->sk_callback_lock);\n \n+\t\txs_save_old_callbacks(transport, sk);\n+\n \t\tsk->sk_user_data = xprt;\n-\t\ttransport->old_data_ready = sk->sk_data_ready;\n-\t\ttransport->old_state_change = sk->sk_state_change;\n-\t\ttransport->old_write_space = sk->sk_write_space;\n \t\tsk->sk_data_ready = xs_udp_data_ready;\n \t\tsk->sk_write_space = xs_udp_write_space;\n \t\tsk->sk_no_check = UDP_CSUM_NORCV;\n@@ -1589,13 +1627,13 @@ static int xs_tcp_finish_connecting(struct rpc_xprt *xprt, struct socket *sock)\n \n \t\twrite_lock_bh(&sk->sk_callback_lock);\n \n+\t\txs_save_old_callbacks(transport, sk);\n+\n \t\tsk->sk_user_data = xprt;\n-\t\ttransport->old_data_ready = sk->sk_data_ready;\n-\t\ttransport->old_state_change = sk->sk_state_change;\n-\t\ttransport->old_write_space = sk->sk_write_space;\n \t\tsk->sk_data_ready = xs_tcp_data_ready;\n \t\tsk->sk_state_change = xs_tcp_state_change;\n \t\tsk->sk_write_space = xs_tcp_write_space;\n+\t\tsk->sk_error_report = xs_tcp_error_report;\n \t\tsk->sk_allocation = GFP_ATOMIC;\n \n \t\t/* socket options */\n", "From: Trond Myklebust <Trond.Myklebust@netapp.com>\nDate: Thu, 23 Oct 2008 19:14:55 -0400\nSUNRPC: Fix the setting of xprt->reestablish_timeout when reconnecting\n\nIf the server aborts an established connection, then we should retry\nconnecting immediately. Since xprt->reestablish_timeout is not reset unless\nwe go through a TCP_FIN_WAIT1 state, we may end up waiting unnecessarily.\nThe fix is to reset xprt->reestablish_timeout in TCP_ESTABLISHED, and then\nrely on the fact that we set it to non-zero values in all other cases when\nthe server closes the connection.\n\nAlso fix a race between xs_connect() and xs_tcp_state_change(). The\nvalue of xprt->reestablish_timeout should be updated before we actually\nattempt the connection.\n\nSigned-off-by: Trond Myklebust <Trond.Myklebust@netapp.com>\n---\n\n net/sunrpc/xprtsock.c |   10 ++++++----\n 1 files changed, 6 insertions(+), 4 deletions(-)\n\ndiff --git a/net/sunrpc/xprtsock.c b/net/sunrpc/xprtsock.c\nindex 0a50361..ac2aa52 100644\n--- a/net/sunrpc/xprtsock.c\n+++ b/net/sunrpc/xprtsock.c\n@@ -1144,6 +1144,8 @@ static void xs_tcp_state_change(struct sock *sk)\n \t\t\tstruct sock_xprt *transport = container_of(xprt,\n \t\t\t\t\tstruct sock_xprt, xprt);\n \n+\t\t\txprt->reestablish_timeout = 0;\n+\n \t\t\t/* Reset TCP record info */\n \t\t\ttransport->tcp_offset = 0;\n \t\t\ttransport->tcp_reclen = 0;\n@@ -1158,7 +1160,6 @@ static void xs_tcp_state_change(struct sock *sk)\n \tcase TCP_FIN_WAIT1:\n \t\t/* The client initiated a shutdown of the socket */\n \t\txprt->connect_cookie++;\n-\t\txprt->reestablish_timeout = 0;\n \t\tset_bit(XPRT_CLOSING, &xprt->state);\n \t\tsmp_mb__before_clear_bit();\n \t\tclear_bit(XPRT_CONNECTED, &xprt->state);\n@@ -1793,6 +1794,7 @@ static void xs_connect(struct rpc_task *task)\n {\n \tstruct rpc_xprt *xprt = task->tk_xprt;\n \tstruct sock_xprt *transport = container_of(xprt, struct sock_xprt, xprt);\n+\tunsigned long timeout;\n \n \tif (xprt_test_and_set_connecting(xprt))\n \t\treturn;\n@@ -1801,12 +1803,12 @@ static void xs_connect(struct rpc_task *task)\n \t\tdprintk(\"RPC:       xs_connect delayed xprt %p for %lu \"\n \t\t\t\t\"seconds\\n\",\n \t\t\t\txprt, xprt->reestablish_timeout / HZ);\n-\t\tqueue_delayed_work(rpciod_workqueue,\n-\t\t\t\t   &transport->connect_worker,\n-\t\t\t\t   xprt->reestablish_timeout);\n+\t\ttimeout = xprt->reestablish_timeout;\n \t\txprt->reestablish_timeout <<= 1;\n \t\tif (xprt->reestablish_timeout > XS_TCP_MAX_REEST_TO)\n \t\t\txprt->reestablish_timeout = XS_TCP_MAX_REEST_TO;\n+\t\tqueue_delayed_work(rpciod_workqueue,\n+\t\t\t\t   &transport->connect_worker, timeout);\n \t} else {\n \t\tdprintk(\"RPC:       xs_connect scheduled xprt %p\\n\", xprt);\n \t\tqueue_delayed_work(rpciod_workqueue,\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "File System", "Classification": "Unclassified", "Component": "NFS", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Trond Myklebust", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "7216", "Reported": "2008-07-24 02:57 UTC by walken", "Modified": "2010-02-03 21:02 UTC", "CC List": "11 users", "See Also": "", "Kernel Version": "2.6.25", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["net/sunrpc/xprtsock.c"], "methods": ["xs_tcp_send_request", "xs_close", "xs_udp_finish_connecting", "xs_tcp_finish_connecting", "sock_xprt"]}
{"id": "11141", "title": "no battery or DC status - Dell i1501", "": "Show dependency tree", "description": "Latest working kernel version:2.6.26-git8\nEarliest failing kernel version:2.6.26-git1\nDistribution:Slackware\nHardware Environment:Dell i1501\nSoftware Environment:\nProblem Description:\nhere is my full dmesg:\n[    0.000000] Linux version 2.6.26-g6-+-05253-g14b395e (grissiom@grissiom_slackware) (gcc version 4.2.3) #35 SMP PREEMPT Mon Jul 21 22:04:52 CST 2008\n[    0.000000] BIOS-provided physical RAM map:\n[    0.000000]  BIOS-e820: 0000000000000000 - 000000000009dc00 (usable)\n[    0.000000]  BIOS-e820: 000000000009dc00 - 00000000000a0000 (reserved)\n[    0.000000]  BIOS-e820: 00000000000ce000 - 0000000000100000 (reserved)\n[    0.000000]  BIOS-e820: 0000000000100000 - 0000000037e70000 (usable)\n[    0.000000]  BIOS-e820: 0000000037e70000 - 0000000037e80000 (ACPI data)\n[    0.000000]  BIOS-e820: 0000000037e80000 - 0000000037f00000 (ACPI NVS)\n[    0.000000]  BIOS-e820: 0000000037f00000 - 0000000040000000 (reserved)\n[    0.000000]  BIOS-e820: 00000000e0000000 - 00000000f0000000 (reserved)\n[    0.000000]  BIOS-e820: 00000000fec00000 - 00000000fec10000 (reserved)\n[    0.000000]  BIOS-e820: 00000000fee00000 - 00000000fee01000 (reserved)\n[    0.000000]  BIOS-e820: 00000000fff80000 - 0000000100000000 (reserved)\n[    0.000000] last_pfn = 0x37e70 max_arch_pfn = 0x100000\n[    0.000000] x86 PAT enabled: cpu 0, old 0x7040600070406, new 0x7010600070106\n[    0.000000] kernel direct mapping tables up to 37e70000 @ 7000-d000\n[    0.000000] DMI present.\n[    0.000000] ACPI: RSDP 000F8500, 0014 (r0 PTLTD )\n[    0.000000] ACPI: RSDT 37E79539, 0040 (r1 DELL    M08      6040000  LTP        0)\n[    0.000000] ACPI: FACP 37E7FB58, 0074 (r1 ATI    Bowfin    6040000 ATI     F4240)\n[    0.000000] ACPI: DSDT 37E79579, 65DF (r1    ATI    SB600  6040000 MSFT  3000000)\n[    0.000000] ACPI: FACS 37E90FC0, 0040\n[    0.000000] ACPI: TCPA 37E7FBCC, 0032 (r2 AMD              6040000 PTEC        0)\n[    0.000000] ACPI: SSDT 37E7FBFE, 01C4 (r1 PTLTD  POWERNOW  6040000  LTP        1)\n[    0.000000] ACPI: APIC 37E7FDC2, 0054 (r1 PTLTD       APIC    6040000  LTP        0)\n[    0.000000] ACPI: MCFG 37E7FE16, 003C (r1 PTLTD    MCFG    6040000  LTP        0)\n[    0.000000] ACPI: HPET 37E7FE52, 0038 (r1 PTLTD  HPETTBL   6040000  LTP        1)\n[    0.000000] ACPI: SLIC 37E7FE8A, 0176 (r1 DELL    M08      6040000  LTP        0)\n[    0.000000] ACPI: DMI detected: Dell i1501\n[    0.000000] Entering add_active_range(0, 0x0, 0x9d) 0 entries of 256 used\n[    0.000000] Entering add_active_range(0, 0x100, 0x37e70) 1 entries of 256 used\n[    0.000000] 0MB HIGHMEM available.\n[    0.000000] 894MB LOWMEM available.\n[    0.000000]   mapped low ram: 0 - 37e70000\n[    0.000000]   low ram: 00000000 - 37e70000\n[    0.000000]   bootmap 00009000 - 0000ffd0\n[    0.000000] (8 early reservations) ==> bootmem\n[    0.000000]   #0 [0000000000 - 0000001000]   BIOS data page ==> [0000000000 - 0000001000]\n[    0.000000]   #1 [0000001000 - 0000002000]    EX TRAMPOLINE ==> [0000001000 - 0000002000]\n[    0.000000]   #2 [0000006000 - 0000007000]       TRAMPOLINE ==> [0000006000 - 0000007000]\n[    0.000000]   #3 [0000100000 - 00006ae364]    TEXT DATA BSS ==> [0000100000 - 00006ae364]\n[    0.000000]   #4 [00006af000 - 00006b2000]    INIT_PG_TABLE ==> [00006af000 - 00006b2000]\n[    0.000000]   #5 [000009dc00 - 0000100000]    BIOS reserved ==> [000009dc00 - 0000100000]\n[    0.000000]   #6 [0000007000 - 0000009000]          PGTABLE ==> [0000007000 - 0000009000]\n[    0.000000]   #7 [0000009000 - 0000010000]          BOOTMAP ==> [0000009000 - 0000010000]\n[    0.000000] Scan SMP from c0000000 for 1024 bytes.\n[    0.000000] Scan SMP from c009fc00 for 1024 bytes.\n[    0.000000] Scan SMP from c00f0000 for 65536 bytes.\n[    0.000000] found SMP MP-table at [c00f8530] 000f8530\n[    0.000000] Zone PFN ranges:\n[    0.000000]   DMA      0x00000000 -> 0x00001000\n[    0.000000]   Normal   0x00001000 -> 0x00037e70\n[    0.000000]   HighMem  0x00037e70 -> 0x00037e70\n[    0.000000] Movable zone start PFN for each node\n[    0.000000] early_node_map[2] active PFN ranges\n[    0.000000]     0: 0x00000000 -> 0x0000009d\n[    0.000000]     0: 0x00000100 -> 0x00037e70\n[    0.000000] On node 0 totalpages: 228877\n[    0.000000] free_area_init_node: node 0, pgdat c05adf40, node_mem_map c1000000\n[    0.000000]   DMA zone: 32 pages used for memmap\n[    0.000000]   DMA zone: 0 pages reserved\n[    0.000000]   DMA zone: 3965 pages, LIFO batch:0\n[    0.000000]   Normal zone: 1757 pages used for memmap\n[    0.000000]   Normal zone: 223123 pages, LIFO batch:31\n[    0.000000]   HighMem zone: 0 pages used for memmap\n[    0.000000]   Movable zone: 0 pages used for memmap\n[    0.000000] Detected use of extended apic ids on hypertransport bus\n[    0.000000] ACPI: PM-Timer IO Port: 0x8008\n[    0.000000] ACPI: Local APIC address 0xfee00000\n[    0.000000] ACPI: LAPIC (acpi_id[0x00] lapic_id[0x00] enabled)\n[    0.000000] ACPI: LAPIC (acpi_id[0x01] lapic_id[0x01] enabled)\n[    0.000000] ACPI: LAPIC_NMI (acpi_id[0x00] high edge lint[0x1])\n[    0.000000] ACPI: LAPIC_NMI (acpi_id[0x01] high edge lint[0x1])\n[    0.000000] ACPI: IOAPIC (id[0x02] address[0xfec00000] gsi_base[0])\n[    0.000000] IOAPIC[0]: apic_id 2, version 33, address 0xfec00000, GSI 0-23\n[    0.000000] ACPI: IRQ9 used by override.\n[    0.000000] Enabling APIC mode:  Flat.  Using 1 I/O APICs\n[    0.000000] ACPI: HPET id: 0x43538301 base: 0xfed00000\n[    0.000000] Using ACPI (MADT) for SMP configuration information\n[    0.000000] SMP: Allowing 2 CPUs, 0 hotplug CPUs\n[    0.000000] mapped APIC to ffffb000 (fee00000)\n[    0.000000] mapped IOAPIC to ffffa000 (fec00000)\n[    0.000000] PM: Registered nosave memory: 000000000009d000 - 000000000009e000\n[    0.000000] PM: Registered nosave memory: 000000000009e000 - 00000000000a0000\n[    0.000000] PM: Registered nosave memory: 00000000000a0000 - 00000000000ce000\n[    0.000000] PM: Registered nosave memory: 00000000000ce000 - 0000000000100000\n[    0.000000] Allocating PCI resources starting at 50000000 (gap: 40000000:a0000000)\n[    0.000000] PERCPU: Allocating 38516 bytes of per cpu data\n[    0.000000] NR_CPUS: 2, nr_cpu_ids: 2, nr_node_ids 1\n[    0.000000] Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 227088\n[    0.000000] Kernel command line: root=/dev/sda7 vga=773\n[    0.000000] Enabling fast FPU save and restore... done.\n[    0.000000] Enabling unmasked SIMD FPU exception support... done.\n[    0.000000] Initializing CPU#0\n[    0.000000] PID hash table entries: 4096 (order: 12, 16384 bytes)\n[    0.000000] TSC calibrated against PM_TIMER\n[    0.000000] Detected 1795.492 MHz processor.\n[    0.006666] Console: colour dummy device 80x25\n[    0.006666] console [tty0] enabled\n[    0.006666] Dentry cache hash table entries: 131072 (order: 7, 524288 bytes)\n[    0.006666] Inode-cache hash table entries: 65536 (order: 6, 262144 bytes)\n[    0.006666] Memory: 901504k/915904k available (3667k kernel code, 13928k reserved, 1343k data, 308k init, 0k highmem)\n[    0.006666] virtual kernel memory layout:\n[    0.006666]     fixmap  : 0xfff9f000 - 0xfffff000   ( 384 kB)\n[    0.006666]     pkmap   : 0xff800000 - 0xffc00000   (4096 kB)\n[    0.006666]     vmalloc : 0xf8800000 - 0xff7fe000   ( 111 MB)\n[    0.006666]     lowmem  : 0xc0000000 - 0xf7e70000   ( 894 MB)\n[    0.006666]       .init : 0xc05ec000 - 0xc0639000   ( 308 kB)\n[    0.006666]       .data : 0xc0494fc3 - 0xc05e4dd0   (1343 kB)\n[    0.006666]       .text : 0xc0100000 - 0xc0494fc3   (3667 kB)\n[    0.006666] Checking if this processor honours the WP bit even in supervisor mode...Ok.\n[    0.006666] CPA: page pool initialized 1 of 1 pages preallocated\n[    0.006666] SLUB: Genslabs=12, HWalign=64, Order=0-3, MinObjects=0, CPUs=2, Nodes=1\n[    0.006666] hpet clockevent registered\n[    0.006684] Calibrating delay loop (skipped), value calculated using timer frequency.. <6>3592.60 BogoMIPS (lpj=5984973)\n[    0.006697] Mount-cache hash table entries: 512\n[    0.006753] CPU: L1 I Cache: 64K (64 bytes/line), D cache 64K (64 bytes/line)\n[    0.006756] CPU: L2 Cache: 512K (64 bytes/line)\n[    0.006759] CPU 0(2) -> Core 0\n[    0.006761] Intel machine check architecture supported.\n[    0.006764] Intel machine check reporting enabled on CPU#0.\n[    0.006766] using C1E aware idle routine\n[    0.006771] Checking 'hlt' instruction... OK.\n[    0.018739] ACPI: Core revision 20080609\n[    0.029075] ENABLING IO-APIC IRQs\n[    0.029231] ..TIMER: vector=0x31 apic1=0 pin1=0 apic2=-1 pin2=-1\n[    0.033331] ..MP-BIOS bug: 8254 timer not connected to IO-APIC\n[    0.033331] ...trying to set up timer (IRQ0) through the 8259A ...\n[    0.033331] ..... (found pin 0) ...works.\n[    0.065797] CPU0: AMD Turion(tm) 64 X2 Mobile Technology TL-56 stepping 02\n[    0.069995] Booting processor 1/1 ip 6000\n[    0.079994] Initializing CPU#1\n[    0.163143] Calibrating delay using timer specific routine.. <6>3592.67 BogoMIPS (lpj=5985083)\n[    0.163151] CPU: L1 I Cache: 64K (64 bytes/line), D cache 64K (64 bytes/line)\n[    0.163153] CPU: L2 Cache: 512K (64 bytes/line)\n[    0.163155] CPU 1(2) -> Core 1\n[    0.163157] Intel machine check architecture supported.\n[    0.163160] Intel machine check reporting enabled on CPU#1.\n[    0.163322] x86 PAT enabled: cpu 1, old 0x7040600070406, new 0x7010600070106\n[    0.162029] CPU1: AMD Turion(tm) 64 X2 Mobile Technology TL-56 stepping 02\n[    0.162083] Brought up 2 CPUs\n[    0.162088] Total of 2 processors activated (7184.28 BogoMIPS).\n[    0.163322] System has C1E enabled\n[    0.163322] Switch to broadcast mode on CPU1\n[    0.162126] Switch to broadcast mode on CPU0\n[    0.162247] net_namespace: 420 bytes\n[    0.162402] NET: Registered protocol family 16\n[    0.162501] No dock devices found.\n[    0.162526] ACPI: bus type pci registered\n[    0.162576] PCI: MCFG configuration 0: base e0000000 segment 0 buses 0 - 9\n[    0.162583] PCI: MCFG area at e0000000 reserved in E820\n[    0.162589] PCI: Using MMCONFIG for extended config space\n[    0.162595] PCI: Using configuration type 1 for base access\n[    0.163322] ACPI: EC: Look up EC in DSDT\n[    0.166069] ACPI: BIOS _OSI(Linux) query ignored via DMI\n[    0.166420] ACPI: Interpreter enabled\n[    0.166425] ACPI: (supports S0 S3 S4 S5)\n[    0.166439] ACPI: Using IOAPIC for interrupt routing\n[    0.164251] ACPI: EC: non-query interrupt received, switching to interrupt mode\n[    0.184466] ACPI: EC: GPE = 0x14, I/O: command/status = 0x66, data = 0x62\n[    0.184474] ACPI: EC: driver started in interrupt mode\n[    0.184498] ACPI: PCI Root Bridge [PCI0] (0000:00)\n[    0.184595] pci 0000:00:05.0: PME# supported from D0 D3hot D3cold\n[    0.184602] pci 0000:00:05.0: PME# disabled\n[    0.184718] pci 0000:00:12.0: set SATA to AHCI mode\n[    0.185107] pci 0000:00:13.5: supports D1\n[    0.185109] pci 0000:00:13.5: supports D2\n[    0.185111] pci 0000:00:13.5: PME# supported from D0 D1 D2 D3hot\n[    0.185120] pci 0000:00:13.5: PME# disabled\n[    0.185369] pci 0000:00:14.2: PME# supported from D0 D3hot D3cold\n[    0.185377] pci 0000:00:14.2: PME# disabled\n[    0.185566] pci 0000:01:05.0: supports D1\n[    0.185568] pci 0000:01:05.0: supports D2\n[    0.185737] pci 0000:08:00.0: supports D1\n[    0.185739] pci 0000:08:00.0: supports D2\n[    0.185741] pci 0000:08:00.0: PME# supported from D0 D1 D2 D3hot D3cold\n[    0.185751] pci 0000:08:00.0: PME# disabled\n[    0.185852] pci 0000:08:01.0: supports D1\n[    0.185854] pci 0000:08:01.0: supports D2\n[    0.185856] pci 0000:08:01.0: PME# supported from D0 D1 D2 D3hot D3cold\n[    0.185865] pci 0000:08:01.0: PME# disabled\n[    0.185967] pci 0000:08:01.1: supports D1\n[    0.185968] pci 0000:08:01.1: supports D2\n[    0.185970] pci 0000:08:01.1: PME# supported from D0 D1 D2 D3hot D3cold\n[    0.185980] pci 0000:08:01.1: PME# disabled\n[    0.186048] pci 0000:00:14.4: transparent bridge\n[    0.186075] bus 00 -> node 0\n[    0.186080] ACPI: PCI Interrupt Routing Table [\\_SB_.PCI0._PRT]\n[    0.186284] ACPI: PCI Interrupt Routing Table [\\_SB_.PCI0.PB5_._PRT]\n[    0.186428] ACPI: PCI Interrupt Routing Table [\\_SB_.PCI0.P2P_._PRT]\n[    0.186542] ACPI: PCI Interrupt Routing Table [\\_SB_.PCI0.AGP_._PRT]\n[    0.189146] ACPI: PCI Interrupt Link [LNKA] (IRQs 10 11) *0, disabled.\n[    0.189279] ACPI: PCI Interrupt Link [LNKB] (IRQs 10 11) *0, disabled.\n[    0.189407] ACPI: PCI Interrupt Link [LNKC] (IRQs 10 11) *0, disabled.\n[    0.189535] ACPI: PCI Interrupt Link [LNKD] (IRQs 10 11) *0, disabled.\n[    0.189664] ACPI: PCI Interrupt Link [LNKE] (IRQs 10 11) *0, disabled.\n[    0.189792] ACPI: PCI Interrupt Link [LNKF] (IRQs 10 11) *0, disabled.\n[    0.189920] ACPI: PCI Interrupt Link [LNKG] (IRQs 10 11) *0, disabled.\n[    0.190048] ACPI: PCI Interrupt Link [LNKH] (IRQs 10 11) *0, disabled.\n[    0.190177] ACPI: PCI Interrupt Link [LNKU] (IRQs 3 4 5 7) *0, disabled.\n[    0.190370] ACPI: WMI: Mapper loaded\n[    0.190376] Linux Plug and Play Support v0.97 (c) Adam Belay\n[    0.190391] pnp: PnP ACPI init\n[    0.190400] ACPI: bus type pnp registered\n[    0.192729] pnp 00:09: mem resource (0xe0000-0xfffff) overlaps 0000:00:05.0 BAR 8 (0x0-0xfffff), disabling\n[    0.192741] pnp 00:09: mem resource (0x0-0xfff) overlaps 0000:00:05.0 BAR 8 (0x0-0xfffff), disabling\n[    0.192763] pnp 00:09: mem resource (0x0-0xfff) overlaps 0000:01:05.0 BAR 6 (0x0-0x1ffff), disabling\n[    0.193935] pnp: PnP ACPI: found 11 devices\n[    0.193941] ACPI: ACPI bus type pnp unregistered\n[    0.194094] SCSI subsystem initialized\n[    0.194163] libata version 3.00 loaded.\n[    0.194224] usbcore: registered new interface driver usbfs\n[    0.194244] usbcore: registered new interface driver hub\n[    0.194276] usbcore: registered new device driver usb\n[    0.194392] PCI: Using ACPI for IRQ routing\n[    0.194401] PCI: Cannot allocate resource region 7 of bridge 0000:00:05.0\n[    0.194406] PCI: Cannot allocate resource region 8 of bridge 0000:00:05.0\n[    0.204999] hpet0: at MMIO 0xfed00000, IRQs 2, 8, 0, 0\n[    0.205007] hpet0: 4 32-bit timers, 14318180 Hz\n[    0.206106] ACPI Error (exresop-0103): Needed type [Reference], found [Device] f780ff90 [20080609]\n[    0.206119] ACPI Exception (dswexec-0441): AE_AML_OPERAND_TYPE, While resolving operands for [OpcodeName unavailable] [20080609]\n[    0.206132] ACPI Error (psparse-0530): Method parse/execution failed [\\_SB_.PCI0._OSC] (Node f7816dc8), AE_AML_OPERAND_TYPE\n[    0.206196] ACPI: RTC can wake from S4\n[    0.210618] Switched to high resolution mode on CPU 0\n[    0.211699] system 00:01: iomem range 0xe0000000-0xefffffff could not be reserved\n[    0.211708] system 00:01: iomem range 0xfec00000-0xfec00fff could not be reserved\n[    0.211717] system 00:01: iomem range 0xfee00000-0xfee00fff could not be reserved\n[    0.211731] system 00:08: ioport range 0x1080-0x1080 has been reserved\n[    0.211738] system 00:08: ioport range 0x220-0x22f has been reserved\n[    0.211745] system 00:08: ioport range 0x40b-0x40b has been reserved\n[    0.211752] system 00:08: ioport range 0x4d0-0x4d1 has been reserved\n[    0.211758] system 00:08: ioport range 0x4d6-0x4d6 has been reserved\n[    0.211766] system 00:08: ioport range 0x530-0x537 has been reserved\n[    0.211772] system 00:08: ioport range 0xc00-0xc01 has been reserved\n[    0.211779] system 00:08: ioport range 0xc14-0xc14 has been reserved\n[    0.211786] system 00:08: ioport range 0xc50-0xc52 has been reserved\n[    0.211793] system 00:08: ioport range 0xc6c-0xc6c has been reserved\n[    0.211800] system 00:08: ioport range 0xc6f-0xc6f has been reserved\n[    0.211807] system 00:08: ioport range 0xcd0-0xcd3 has been reserved\n[    0.211814] system 00:08: ioport range 0xcd4-0xcd5 has been reserved\n[    0.211821] system 00:08: ioport range 0xcd6-0xcd7 has been reserved\n[    0.211828] system 00:08: ioport range 0xcd8-0xcdf has been reserved\n[    0.211835] system 00:08: ioport range 0x8000-0x805f has been reserved\n[    0.211842] system 00:08: ioport range 0xf40-0xf47 has been reserved\n[    0.211853] system 00:08: ioport range 0x87f-0x87f has been reserved\n[    0.211864] system 00:09: iomem range 0xfff00000-0xffffffff could not be reserved\n[    0.211872] system 00:09: iomem range 0xc0004800-0xc0004bff has been reserved\n[    0.211880] system 00:09: iomem range 0xfed00000-0xfed003ff has been reserved\n[    0.242116] pci 0000:00:01.0: PCI bridge, secondary bus 0000:01\n[    0.242123] pci 0000:00:01.0:   IO window: 0x9000-0x9fff\n[    0.242130] pci 0000:00:01.0:   MEM window: 0xc0100000-0xc01fffff\n[    0.242136] pci 0000:00:01.0:   PREFETCH window: 0x000000c8000000-0x000000cfffffff\n[    0.242145] pci 0000:00:05.0: PCI bridge, secondary bus 0000:02\n[    0.242150] pci 0000:00:05.0:   IO window: disabled\n[    0.242155] pci 0000:00:05.0:   MEM window: disabled\n[    0.242161] pci 0000:00:05.0:   PREFETCH window: disabled\n[    0.242168] pci 0000:00:14.4: PCI bridge, secondary bus 0000:08\n[    0.242172] pci 0000:00:14.4:   IO window: disabled\n[    0.242181] pci 0000:00:14.4:   MEM window: 0xc0300000-0xc03fffff\n[    0.242189] pci 0000:00:14.4:   PREFETCH window: disabled\n[    0.242208] PCI: Setting latency timer of device 0000:00:05.0 to 64\n[    0.242223] NET: Registered protocol family 2\n[    0.242274] Switched to high resolution mode on CPU 1\n[    0.252607] IP route cache hash table entries: 32768 (order: 5, 131072 bytes)\n[    0.252870] TCP established hash table entries: 131072 (order: 8, 1048576 bytes)\n[    0.253530] TCP bind hash table entries: 65536 (order: 7, 524288 bytes)\n[    0.253866] TCP: Hash tables configured (established 131072 bind 65536)\n[    0.253873] TCP reno registered\n[    0.255958] NET: Registered protocol family 1\n[    0.256218] Machine check exception polling timer started.\n[    0.256556] Total HugeTLB memory allocated, 0\n[    0.257808] DLM (built Jul 21 2008 22:47:24) installed\n[    0.258172] Installing knfsd (copyright (C) 1996 okir@monad.swb.de).\n[    0.258285] msgmni has been set to 1760\n[    0.258401] Block layer SCSI generic (bsg) driver version 0.4 loaded (major 253)\n[    0.258410] io scheduler noop registered\n[    0.258415] io scheduler anticipatory registered\n[    0.258419] io scheduler deadline registered\n[    0.258433] io scheduler cfq registered (default)\n[    0.258442] pci 0000:00:00.0: MSI quirk detected; MSI disabled\n[    0.258548] pci 0000:01:05.0: Boot video device\n[    0.258619] PCI: Setting latency timer of device 0000:00:05.0 to 64\n[    0.258640] pcieport-driver 0000:00:05.0: found MSI capability\n[    0.258648] pci_express 0000:00:05.0:pcie00: allocate port service\n[    0.258665] pci_express 0000:00:05.0:pcie02: allocate port service\n[    0.258723] pci_hotplug: PCI Hot Plug PCI Core version: 0.5\n[    0.258807] vesafb: framebuffer at 0xc8000000, mapped to 0xf8880000, using 1536k, total 16384k\n[    0.258816] vesafb: mode is 1024x768x8, linelength=1024, pages=20\n[    0.258821] vesafb: protected mode interface info at c000:51a0\n[    0.258827] vesafb: pmi: set display start = c00c5234, set palette = c00c5280\n[    0.258832] vesafb: pmi: ports = 9010 9016 9054 9038 903c 905c 9000 9004 90b0 90b2 90b4\n[    0.258845] vesafb: scrolling: redraw\n[    0.258851] vesafb: Pseudocolor: size=8:8:8:8, shift=0:0:0:0\n[    0.258885] fbcon: VESA VGA (fb0) is primary device\n[    0.285578] Console: switching to colour frame buffer device 128x48\n[    0.312477] fb0: VESA VGA frame buffer device\n[    0.314465] ACPI: AC Adapter [ACAD] (on-line)\n[    0.698517] ACPI: Battery Slot [BAT1] (battery present)\n[    0.698845] input: Power Button (FF) as /class/input/input0\n[    0.699124] ACPI: Power Button (FF) [PWRF]\n[    0.699371] input: Power Button (CM) as /class/input/input1\n[    0.699649] ACPI: Power Button (CM) [PWRB]\n[    0.699911] input: Sleep Button (CM) as /class/input/input2\n[    0.700195] ACPI: Sleep Button (CM) [SLPB]\n[    0.700435] input: Lid Switch as /class/input/input3\n[    0.701624] ACPI: Lid Switch [LID]\n[    0.702054] input: Video Bus as /class/input/input4\n[    0.702299] ACPI: Video Device [VGA] (multi-head: yes  rom: no  post: no)\n[    0.704378] ACPI: ACPI0007:00 is registered as cooling_device0\n[    0.704679] ACPI: Processor [CPU0] (supports 8 throttling states)\n[    0.705105] ACPI: ACPI0007:01 is registered as cooling_device1\n[    0.707667] ACPI: LNXTHERM:01 is registered as thermal_zone0\n[    0.708929] ACPI: Thermal Zone [THRM] (59 C)\n[    0.730520] hpet_resources: 0xfed00000 is busy\n[    0.730655] Linux agpgart interface v0.103\n[    0.730877] ipmi message handler version 39.2\n[    0.731104] ipmi device interface\n[    0.731286] IPMI System Interface driver.\n[    0.739240] ipmi_si: Unable to find any System Interface(s)\n[    0.749158] IPMI Watchdog: driver initialized\n[    0.758983] Copyright (C) 2004 MontaVista Software - IPMI Powerdown via sys_reboot.\n[    0.769089] [drm] Initialized drm 1.1.0 20060810\n[    0.779079] Serial: 8250/16550 driver4 ports, IRQ sharing disabled\n[    0.789752] loop: module loaded\n[    0.799728] b44 0000:08:00.0: PCI INT A -> GSI 21 (level, low) -> IRQ 21\n[    0.858410] ssb: Sonics Silicon Backplane found on PCI device 0000:08:00.0\n[    0.868539] b44.c:v2.0\n[    0.895382] eth0: Broadcom 44xx/47xx 10/100BaseT Ethernet 00:19:b9:4e:20:8a\n[    0.906039] Uniform Multi-Platform E-IDE driver\n[    0.916599] SB600_PATA: IDE controller (0x1002:0x438c rev 0x00) at  PCI slot 0000:00:14.1\n[    0.927393] ATIIXP_IDE 0000:00:14.1: PCI INT A -> GSI 16 (level, low) -> IRQ 16\n[    0.938255] SB600_PATA: not 100% native mode: will probe irqs later\n[    0.949114]     ide0: BM-DMA at 0x8420-0x8427\n[    0.959873] Probing IDE interface ide0...\n[    1.658747] hda: HL-DT-ST DVD+/-RW GSA-T11N, ATAPI CD/DVD-ROM drive\n[    1.988359] hda: host max PIO4 wanted PIO255(auto-tune) selected PIO4\n[    1.989170] hda: UDMA/33 mode selected\n[    2.000209] ide0 at 0x1f0-0x1f7,0x3f6 on irq 14\n[    2.014082] ide_generic: please use \"probe_mask=0x3f\" module parameter for probing all legacy ISA IDE ports\n[    2.025153] ide_generic: I/O resource 0x1F0-0x1F7 not free.\n[    2.036143] Probing IDE interface ide1...\n[    2.571686] ide1 at 0x170-0x177,0x376 on irq 15\n[    2.584579] hda: ATAPI 24X DVD-ROM DVD-R CD-R/RW drive, 2048kB Cache\n[    2.595598] Uniform CD-ROM driver Revision: 3.20\n[    2.613977] Driver 'sd' needs updating - please use bus_type methods\n[    2.625108] ahci 0000:00:12.0: version 3.0\n[    2.625120] ahci 0000:00:12.0: PCI INT A -> GSI 22 (level, low) -> IRQ 22\n[    2.636286] ahci 0000:00:12.0: controller can't do 64bit DMA, forcing 32bit\n[    2.647502] ahci 0000:00:12.0: AHCI 0001.0100 32 slots 4 ports 3 Gbps 0xf impl SATA mode\n[    2.658756] ahci 0000:00:12.0: flags: ncq sntf ilck led clo pmp pio\n[    2.670340] scsi0 : ahci\n[    2.681520] scsi1 : ahci\n[    2.692433] scsi2 : ahci\n[    2.703201] scsi3 : ahci\n[    2.720445] ata1: SATA max UDMA/133 irq_stat 0x00400040, connection status changed irq 22\n[    2.728786] ata2: SATA max UDMA/133 abar m1024@0xc0004000 port 0xc0004180 irq 22\n[    2.739616] ata3: SATA max UDMA/133 abar m1024@0xc0004000 port 0xc0004200 irq 22\n[    2.755584] ata4: SATA max UDMA/133 abar m1024@0xc0004000 port 0xc0004280 irq 22\n[    3.637902] ata1: softreset failed (device not ready)\n[    3.648575] ata1: failed due to HW bug, retry pmp=0\n[    3.817921] ata1: SATA link up 1.5 Gbps (SStatus 113 SControl 300)\n[    4.252015] ata1.00: ATA-7: TOSHIBA MK1234GSX, AH001D, max UDMA/100\n[    4.262612] ata1.00: 234441648 sectors, multi 16: LBA48 NCQ (depth 31/32)\n[    4.273227] ata1.00: SB600 AHCI: limiting to 255 sectors per cmd\n[    4.285080] ata1.00: SB600 AHCI: limiting to 255 sectors per cmd\n[    4.294756] ata1.00: configured for UDMA/100\n[    4.625004] ata2: SATA link down (SStatus 0 SControl 300)\n[    4.955247] ata3: SATA link down (SStatus 0 SControl 300)\n[    5.285241] ata4: SATA link down (SStatus 0 SControl 300)\n[    5.295585] scsi 0:0:0:0: Direct-Access     ATA      TOSHIBA MK1234GS AH00 PQ: 0 ANSI: 5\n[    5.306328] sd 0:0:0:0: [sda] 234441648 512-byte hardware sectors (120034 MB)\n[    5.320419] sd 0:0:0:0: [sda] Write Protect is off\n[    5.328750] sd 0:0:0:0: [sda] Mode Sense: 00 3a 00 00\n[    5.330925] sd 0:0:0:0: [sda] Write cache: enabled, read cache: enabled, doesn't support DPO or FUA\n[    5.341567] sd 0:0:0:0: [sda] 234441648 512-byte hardware sectors (120034 MB)\n[    5.355508] sd 0:0:0:0: [sda] Write Protect is off\n[    5.366136] sd 0:0:0:0: [sda] Mode Sense: 00 3a 00 00\n[    5.366136] sd 0:0:0:0: [sda] Write cache: enabled, read cache: enabled, doesn't support DPO or FUA\n[    5.371172]  sda: sda1 sda2 sda3 < sda5 sda6 sda7 sda8 >\n[    5.490166] sd 0:0:0:0: [sda] Attached SCSI disk\n[    5.500667] sd 0:0:0:0: Attached scsi generic sg0 type 0\n[    5.511069] usbmon: debugfs is not available\n[    5.521351] ehci_hcd 0000:00:13.5: PCI INT D -> GSI 19 (level, low) -> IRQ 19\n[    5.531699] ehci_hcd 0000:00:13.5: EHCI Host Controller\n[    5.541866] ehci_hcd 0000:00:13.5: new USB bus registered, assigned bus number 1\n[    5.552039] ehci_hcd 0000:00:13.5: debug port 1\n[    5.562005] ehci_hcd 0000:00:13.5: irq 19, io mem 0xc0004400\n[    5.580772] ehci_hcd 0000:00:13.5: USB 2.0 started, EHCI 1.00, driver 10 Dec 2004\n[    5.590097] usb usb1: configuration #1 chosen from 1 choice\n[    5.599993] hub 1-0:1.0: USB hub found\n[    5.609613] hub 1-0:1.0: 10 ports detected\n[    5.720208] usb usb1: New USB device found, idVendor=1d6b, idProduct=0002\n[    5.729817] usb usb1: New USB device strings: Mfr=3, Product=2, SerialNumber=1\n[    5.739389] usb usb1: Product: EHCI Host Controller\n[    5.748879] usb usb1: Manufacturer: Linux 2.6.26-g6-+-05253-g14b395e ehci_hcd\n[    5.758493] usb usb1: SerialNumber: 0000:00:13.5\n[    5.767993] ohci_hcd: 2006 August 04 USB 1.1 'Open' Host Controller (OHCI) Driver\n[    5.768006] ohci_hcd 0000:00:13.0: PCI INT A -> GSI 16 (level, low) -> IRQ 16\n[    5.777691] ohci_hcd 0000:00:13.0: OHCI Host Controller\n[    5.787240] ohci_hcd 0000:00:13.0: new USB bus registered, assigned bus number 2\n[    5.796782] ohci_hcd 0000:00:13.0: irq 16, io mem 0xc0005000\n[    5.860879] usb usb2: configuration #1 chosen from 1 choice\n[    5.870511] hub 2-0:1.0: USB hub found\n[    5.880256] hub 2-0:1.0: 2 ports detected\n[    5.990194] usb usb2: New USB device found, idVendor=1d6b, idProduct=0001\n[    6.000018] usb usb2: New USB device strings: Mfr=3, Product=2, SerialNumber=1\n[    6.009824] usb usb2: Product: OHCI Host Controller\n[    6.019733] usb usb2: Manufacturer: Linux 2.6.26-g6-+-05253-g14b395e ohci_hcd\n[    6.029962] usb usb2: SerialNumber: 0000:00:13.0\n[    6.040099] ohci_hcd 0000:00:13.1: PCI INT B -> GSI 17 (level, low) -> IRQ 17\n[    6.050443] ohci_hcd 0000:00:13.1: OHCI Host Controller\n[    6.060669] ohci_hcd 0000:00:13.1: new USB bus registered, assigned bus number 3\n[    6.070945] ohci_hcd 0000:00:13.1: irq 17, io mem 0xc0006000\n[    6.138337] usb usb3: configuration #1 chosen from 1 choice\n[    6.148472] hub 3-0:1.0: USB hub found\n[    6.158659] hub 3-0:1.0: 2 ports detected\n[    6.270139] usb usb3: New USB device found, idVendor=1d6b, idProduct=0001\n[    6.280398] usb usb3: New USB device strings: Mfr=3, Product=2, SerialNumber=1\n[    6.290873] usb usb3: Product: OHCI Host Controller\n[    6.301429] usb usb3: Manufacturer: Linux 2.6.26-g6-+-05253-g14b395e ohci_hcd\n[    6.312072] usb usb3: SerialNumber: 0000:00:13.1\n[    6.322548] ohci_hcd 0000:00:13.2: PCI INT C -> GSI 18 (level, low) -> IRQ 18\n[    6.333154] ohci_hcd 0000:00:13.2: OHCI Host Controller\n[    6.343594] ohci_hcd 0000:00:13.2: new USB bus registered, assigned bus number 4\n[    6.354082] ohci_hcd 0000:00:13.2: irq 18, io mem 0xc0007000\n[    6.420804] usb usb4: configuration #1 chosen from 1 choice\n[    6.431148] hub 4-0:1.0: USB hub found\n[    6.441274] hub 4-0:1.0: 2 ports detected\n[    6.553451] usb usb4: New USB device found, idVendor=1d6b, idProduct=0001\n[    6.563318] usb 3-1: new low speed USB device using ohci_hcd and address 2\n[    6.574041] usb usb4: New USB device strings: Mfr=3, Product=2, SerialNumber=1\n[    6.584389] usb usb4: Product: OHCI Host Controller\n[    6.594740] usb usb4: Manufacturer: Linux 2.6.26-g6-+-05253-g14b395e ohci_hcd\n[    6.605263] usb usb4: SerialNumber: 0000:00:13.2\n[    6.615681] ohci_hcd 0000:00:13.3: PCI INT B -> GSI 17 (level, low) -> IRQ 17\n[    6.626349] ohci_hcd 0000:00:13.3: OHCI Host Controller\n[    6.636901] ohci_hcd 0000:00:13.3: new USB bus registered, assigned bus number 5\n[    6.647500] ohci_hcd 0000:00:13.3: irq 17, io mem 0xc0008000\n[    6.714960] usb usb5: configuration #1 chosen from 1 choice\n[    6.725603] hub 5-0:1.0: USB hub found\n[    6.736067] hub 5-0:1.0: 2 ports detected\n[    6.752307] usb 3-1: configuration #1 chosen from 1 choice\n[    6.766339] usb 3-1: New USB device found, idVendor=093a, idProduct=2500\n[    6.776773] usb 3-1: New USB device strings: Mfr=1, Product=2, SerialNumber=0\n[    6.787199] usb 3-1: Product: USB OPTICAL MOUSE\n[    6.797473] usb 3-1: Manufacturer: PIXART\n[    6.846785] usb usb5: New USB device found, idVendor=1d6b, idProduct=0001\n[    6.857167] usb usb5: New USB device strings: Mfr=3, Product=2, SerialNumber=1\n[    6.867577] usb usb5: Product: OHCI Host Controller\n[    6.877942] usb usb5: Manufacturer: Linux 2.6.26-g6-+-05253-g14b395e ohci_hcd\n[    6.888448] usb usb5: SerialNumber: 0000:00:13.3\n[    6.898982] ohci_hcd 0000:00:13.4: PCI INT C -> GSI 18 (level, low) -> IRQ 18\n[    6.909603] ohci_hcd 0000:00:13.4: OHCI Host Controller\n[    6.920108] ohci_hcd 0000:00:13.4: new USB bus registered, assigned bus number 6\n[    6.930704] ohci_hcd 0000:00:13.4: irq 18, io mem 0xc0009000\n[    6.997461] usb usb6: configuration #1 chosen from 1 choice\n[    7.007882] hub 6-0:1.0: USB hub found\n[    7.018164] hub 6-0:1.0: 2 ports detected\n[    7.130113] usb usb6: New USB device found, idVendor=1d6b, idProduct=0001\n[    7.140512] usb usb6: New USB device strings: Mfr=3, Product=2, SerialNumber=1\n[    7.150921] usb usb6: Product: OHCI Host Controller\n[    7.161275] usb usb6: Manufacturer: Linux 2.6.26-g6-+-05253-g14b395e ohci_hcd\n[    7.171787] usb usb6: SerialNumber: 0000:00:13.4\n[    7.182338] Initializing USB Mass Storage driver...\n[    7.192782] usbcore: registered new interface driver usb-storage\n[    7.203276] USB Mass Storage support registered.\n[    7.213717] PNP: PS/2 Controller [PNP0303:KBC0,PNP0f13:MSE0] at 0x60,0x64 irq 1,12\n[    7.226442] serio: i8042 KBD port at 0x60,0x64 irq 1\n[    7.236963] serio: i8042 AUX port at 0x60,0x64 irq 12\n[    7.247334] mice: PS/2 mouse device common for all mice\n[    7.306112] input: AT Translated Set 2 keyboard as /class/input/input5\n[    7.324682] rtc_cmos 00:04: rtc core: registered rtc_cmos as rtc0\n[    7.335278] rtc0: alarms up to one month\n[    7.345696] i2c /dev entries driver\n[    7.356087] piix4_smbus 0000:00:14.0: SMBus Host Controller at 0x8410, revision 0\n[    7.366830] Driver for 1-wire Dallas network protocol.\n[    7.377606] 1-Wire driver for the DS2760 battery monitor  chip  - (c) 2004-2005, Szabolcs Gyurko\n[    7.968734] Synaptics Touchpad, model: 1, fw: 6.3, id: 0x180b1, caps: 0xa04713/0x200000\n[    8.015704] input: SynPS/2 Synaptics TouchPad as /class/input/input6\n[    8.033986] device-mapper: uevent: version 1.0.3\n[    8.044879] device-mapper: ioctl: 4.13.0-ioctl (2007-10-18) initialised: dm-devel@redhat.com\n[    8.056016] EDAC MC: Ver: 2.1.0 Jul 21 2008\n[    8.067190] cpuidle: using governor ladder\n[    8.078080] cpuidle: using governor menu\n[    8.088882] sdhci: Secure Digital Host Controller Interface driver\n[    8.099805] sdhci: Copyright(c) Pierre Ossman\n[    8.110643] usbcore: registered new interface driver hiddev\n[    8.127600] input: PIXART USB OPTICAL MOUSE as /class/input/input7\n[    8.144239] input,hidraw0: USB HID v1.10 Mouse [PIXART USB OPTICAL MOUSE] on usb-0000:00:13.1-1\n[    8.155663] usbcore: registered new interface driver usbhid\n[    8.166952] usbhid: v2.6:USB HID core driver\n[    8.178241] Advanced Linux Sound Architecture Driver Version 1.0.17.\n[    8.189795] HDA Intel 0000:00:14.2: PCI INT A -> GSI 16 (level, low) -> IRQ 16\n[    8.281318] ALSA device list:\n[    8.292709]   #0: HDA ATI SB at 0xc0000000 irq 16\n[    8.304081] oprofile: using NMI interrupt.\n[    8.315861] TCP cubic registered\n[    8.327053] NET: Registered protocol family 10\n[    8.339231] IPv6 over IPv4 tunneling driver\n[    8.350797] NET: Registered protocol family 17\n[    8.361978] RPC: Registered udp transport module.\n[    8.372925] RPC: Registered tcp transport module.\n[    8.384413] SCTP: Hash tables configured (established 65536 bind 65536)\n[    8.400988] powernow-k8: Found 1 AMD Turion(tm) 64 X2 Mobile Technology TL-56 processors (2 cpu cores) (version 2.20.00)\n[    8.414045] powernow-k8:    0 : fid 0xa (1800 MHz), vid 0x13\n[    8.425471] powernow-k8:    1 : fid 0x8 (1600 MHz), vid 0x15\n[    8.436777] powernow-k8:    2 : fid 0x0 (800 MHz), vid 0x1e\n[    8.447971] Starting balanced_irq\n[    8.458958] Using IPI No-Shortcut mode\n[    8.473226] rtc_cmos 00:04: setting system clock to 2008-07-22 09:55:49 UTC (1216720549)\n[    8.526685] kjournald starting.  Commit interval 5 seconds\n[    8.528410] EXT3-fs: mounted filesystem with ordered data mode.\n[    8.528410] VFS: Mounted root (ext3 filesystem) readonly.\n[    8.528410] Freeing unused kernel memory: 308k freed\n[   10.872501] shpchp: Standard Hot Plug PCI Controller Driver version: 0.4\n[   11.019464] Adding 1574328k swap on /dev/sda5.  Priority:-1 extents:1 across:1574328k\n[   11.104435] fuse init (API version 7.9)\n[   12.241082] EXT3 FS on sda7, internal journal\n[   12.230801] kjournald starting.  Commit interval 5 seconds\n[   12.598430] EXT3 FS on sda8, internal journal\n[   12.598430] EXT3-fs: mounted filesystem with ordered data mode.\n[   14.043340] ADDRCONF(NETDEV_UP): eth0: link is not ready\n[   17.350183] b44: eth0: Link is up at 100 Mbps, full duplex.\n[   17.350190] b44: eth0: Flow control is off for TX and off for RX.\n[   17.350851] ADDRCONF(NETDEV_CHANGE): eth0: link becomes ready\n[   25.725442] pci 0000:01:05.0: power state changed by ACPI to D0\n[   25.726157] pci 0000:01:05.0: PCI INT A -> GSI 17 (level, low) -> IRQ 17\n[   25.726410] [drm] Initialized radeon 1.29.0 20080528 on minor 0\n[   26.498359] Clocksource tsc unstable (delta = -164423884 ns)\n[   27.595910] [drm] Setting GART location based on new memory map\n[   27.596278] [drm] Loading R300 Microcode\n[   27.596305] [drm] Num pipes: 3\n[   27.596316] [drm] writeback test succeeded in 1 usecs\n[   27.968364] eth0: no IPv6 routers present\n[   52.858521] hda-intel: Invalid position buffer, using LPIB read method instead.\n[ 1028.112952] ACPI: EC: missing confirmations, switch off interrupt mode.\n[ 1031.163449] ACPI: EC: acpi_ec_wait timeout, status = 0x09, event = \"b0=1\"\n[ 1031.163619] ACPI: EC: read timeout, command = 130\n[ 1042.063581] ACPI: EC: acpi_ec_wait timeout, status = 0x09, event = \"b1=0\"\n[ 1042.063719] ACPI: EC: input buffer is not empty, aborting transaction\n[ 1042.069992] ACPI Exception (evregion-0419): AE_TIME, Returned by Handler for [EmbeddedControl] [20080609]\n[ 1042.070183] ACPI Error (psparse-0530): Method parse/execution failed [\\_SB_.LID_._LID] (Node f7816870), AE_TIME\n[ 1043.195060] ACPI: EC: acpi_ec_wait timeout, status = 0x09, event = \"b1=0\"\n[ 1043.195252] ACPI: EC: input buffer is not empty, aborting transaction\n[ 1043.201509] ACPI Exception (evregion-0419): AE_TIME, Returned by Handler for [EmbeddedControl] [20080609]\n[ 1043.201690] ACPI Error (psparse-0530): Method parse/execution failed [\\_SB_.LID_._LID] (Node f7816870), AE_TIME\n[ 1057.389100] ACPI: EC: acpi_ec_wait timeout, status = 0x09, event = \"b1=0\"\n[ 1057.389269] ACPI: EC: write_cmd timeout, command = 128\n[ 1057.397926] ACPI Exception (evregion-0419): AE_TIME, Returned by Handler for [EmbeddedControl] [20080609]\n[ 1057.398130] ACPI Error (psparse-0530): Method parse/execution failed [\\_SB_.LID_._LID] (Node f7816870), AE_TIME\n[ 1062.253830] ACPI: EC: acpi_ec_wait timeout, status = 0x09, event = \"b1=0\"\n[ 1062.253987] ACPI: EC: input buffer is not empty, aborting transaction\n[ 1062.406885] ACPI Exception (evregion-0419): AE_TIME, Returned by Handler for [EmbeddedControl] [20080609]\n[ 1062.407011] ACPI Error (psparse-0530): Method parse/execution failed [\\_SB_.LID_._LID] (Node f7816870), AE_TIME\n[ 1066.521670] ACPI: EC: acpi_ec_wait timeout, status = 0x09, event = \"b1=0\"\n[ 1066.521678] ACPI: EC: write_cmd timeout, command = 128\n[ 1067.713188] ACPI: EC: acpi_ec_wait timeout, status = 0x09, event = \"b1=0\"\n[ 1067.713196] ACPI: EC: finish-write timeout, command = 131\n[ 1067.713201] ACPI Exception (evregion-0419): AE_TIME, Returned by Handler for [EmbeddedControl] [20080609]\n[ 1067.713215] ACPI Error (psparse-0530): Method parse/execution failed [\\_SB_.LID_._LID] (Node f7816870), AE_TIME\n\nfrom the time about 1028 I could see the battery and DC get lost from KLaptop, ie, it says 'could not find power supply' or something like that.\nSteps to reproduce:", "patch": ["Subject: ACPI: Avoid bogus EC timeout when EC is in Polling mode\nFrom : Zhao Yakui <yakui.zhao@intel.com>\n\n\n\nWhen EC is in Polling mode, OS will check the EC status continually by using\nthe following source code:\n       clear_bit(EC_FLAGS_WAIT_GPE, &ec->flags);\n       while (time_before(jiffies, delay)) {\n               if (acpi_ec_check_status(ec, event))\n       \t            return 0;\n               msleep(1);\n       }\nBut msleep is realized by the function of schedule_timeout. At the same time\nalthough one process is already waken up by some events, it won't be scheduled\nimmediately. So maybe there exists the following phenomena:\n     a. The current jiffies is already after the predefined jiffies.\n\tBut before timeout happens, OS has no chance to check the EC\n\tstatus again.\n     b. If preempt schedule is enabled, maybe preempt schedule will happen\n\tbefore checking loop. When the process is resumed again, maybe\n\ttimeout already happens, which means that OS has no chance to check\n\tthe EC status.\n\nIn such case maybe EC status is already what OS expects when timeout happens.\nBut OS has no chance to check the EC status and regards it as AE_TIME.\n\nSo it will be more appropriate that OS will try to check the EC status again \nwhen timeout happens. If the EC status is what we expect, it won't be regarded\nas timeout. Only when the EC status is not what we expect, it will be regarded\nas timeout, which means that EC controller can't give a response in time.\n\n---\n drivers/acpi/ec.c |    2 ++\n 1 file changed, 2 insertions(+)\n\nIndex: linux-2.6/drivers/acpi/ec.c\n===================================================================\n--- linux-2.6.orig/drivers/acpi/ec.c\n+++ linux-2.6/drivers/acpi/ec.c\n@@ -196,6 +196,8 @@ static int acpi_ec_wait(struct acpi_ec *\n \t\t\t\treturn 0;\n \t\t\tmsleep(1);\n \t\t}\n+\t\tif (acpi_ec_check_status(ec,event))\n+\t\t\treturn 0;\n \t}\n \tpr_err(PREFIX \"acpi_ec_wait timeout, status = 0x%2.2x, event = %s\\n\",\n \t\tacpi_ec_read_status(ec),\n", "Subject: ACPI: Avoid bogus EC mode switch from interrupt to polling\nFrom : Zhao Yakui <yakui.zhao@intel.com>\n\nWhen EC works in GPE interrupt mode, sometimes it will be switched from\ninterrupt mode to polling mode when EC timeout happens.\n     if (wait_event_timeout(ec->wait, acpi_ec_check_status(ec, event),\n                msecs_to_jiffies(ACPI_EC_DELAY)))\n\t      return 0;\n\t\nIn fact in Linux although one process is already by wakeup by some events\n(For example: interrupt wakeup, timeout wakeup), it won't be scheduled\nimmediately. Maybe it will have to wait for some time before it is scheduled\non some CPU. In such case maybe there exists the following phenomena.\n    a. OS will check the EC status before the process is added to sleeping \n        waitqueue.If the EC status is not what we expect, it will be added to\n\tthe sleeping waitqueue. Of course the state of the process will be\n\tchanged to TASK_UNINTERRUPTIBLE.\n    b. When the EC GPE interrupt is triggered, the waiting process will be\n\twaked up in the GPE interrupt service routine. But as the process\n\tcan't be scheduled immediately, maybe the wait_event_timeout will \n\talso return 0, which means that timeout happens and EC will be \n\tswitched from interrupt mode to polling mode. \n\nAs when the EC_FLAGS_WAIT_GPE bit will be cleared in GPE handler, Maybe it \nwill be appropriate that OS check the EC_FLAGS_WAIT_GPE bit of EC flag and \nEC status before mode switch although timeout happens. If the bit of \nEC_FLAGS_WAIT_GPE is changed and EC status is what we expect, OS won't\nswitch EC work mode even when the timeout happens. Otherwise it will continue\nthe orignal routine.\n\n---\n drivers/acpi/ec.c |    9 +++++++++\n 1 file changed, 9 insertions(+)\n\nIndex: linux-2.6/drivers/acpi/ec.c\n===================================================================\n--- linux-2.6.orig/drivers/acpi/ec.c\n+++ linux-2.6/drivers/acpi/ec.c\n@@ -178,6 +178,15 @@ static int acpi_ec_wait(struct acpi_ec *\n \t\tif (wait_event_timeout(ec->wait, acpi_ec_check_status(ec, event),\n \t\t\t\t       msecs_to_jiffies(ACPI_EC_DELAY)))\n \t\t\treturn 0;\n+\t\t/*\n+\t\t * If the EC_FLAGS_WAI_GPE bit is already clear and EC status\n+\t\t * is what OS expects, it won't be switched interrupt mode to\n+\t\t * polling mode.\n+\t\t */\n+\t\tif (!test_bit(EC_FLAGS_WAIT_GPE, &ec->flags) &&\n+\t\t\tacpi_ec_check_status(ec, event))\n+\t\t\treturn 0;\n+\n \t\tclear_bit(EC_FLAGS_WAIT_GPE, &ec->flags);\n \t\tif (acpi_ec_check_status(ec, event)) {\n \t\t\t/* missing GPEs, switch back to poll mode */\n", "Subject : ACPI: Disable the burst access mode for EC device\n---\n drivers/acpi/ec.c |    4 ++--\n 1 file changed, 2 insertions(+), 2 deletions(-)\n\nIndex: linux-2.6/drivers/acpi/ec.c\n===================================================================\n--- linux-2.6.orig/drivers/acpi/ec.c\n+++ linux-2.6/drivers/acpi/ec.c\n@@ -550,7 +550,7 @@ acpi_ec_space_handler(u32 function, acpi\n \tif (bits != 8 && acpi_strict)\n \t\treturn AE_BAD_PARAMETER;\n \n-\tacpi_ec_burst_enable(ec);\n+//\tacpi_ec_burst_enable(ec);\n \n \tif (function == ACPI_READ) {\n \t\tresult = acpi_ec_read(ec, address, &temp);\n@@ -571,7 +571,7 @@ acpi_ec_space_handler(u32 function, acpi\n \t\t}\n \t}\n \n-\tacpi_ec_burst_disable(ec);\n+//\tacpi_ec_burst_disable(ec);\n \n \tswitch (result) {\n \tcase -EINVAL:\n", "Subject: ACPI : Discard EC burst mode when burst mode timeout happens\n\n---\n drivers/acpi/ec.c |   41 ++++++++++++++++++++++++++++++++++++++++-\n 1 file changed, 40 insertions(+), 1 deletion(-)\n\nIndex: linux-2.6/drivers/acpi/ec.c\n===================================================================\n--- linux-2.6.orig/drivers/acpi/ec.c\n+++ linux-2.6/drivers/acpi/ec.c\n@@ -110,6 +110,8 @@ static struct acpi_ec {\n \tu8 handlers_installed;\n } *boot_ec, *first_ec;\n \n+static unsigned int ec_burst_timeout;\n+\n /* --------------------------------------------------------------------------\n                              Transaction Management\n    -------------------------------------------------------------------------- */\n@@ -300,11 +302,48 @@ static int acpi_ec_transaction(struct ac\n int acpi_ec_burst_enable(struct acpi_ec *ec)\n {\n \tu8 d;\n-\treturn acpi_ec_transaction(ec, ACPI_EC_BURST_ENABLE, NULL, 0, &d, 1, 0);\n+\tint status = 0;\n+\n+\t/*\n+\t * If the burst mode is disabled, it will return directly.\n+\t */\n+\tif (ec_burst_timeout)\n+\t\treturn 0;\n+\n+\tstatus = acpi_ec_transaction(ec, ACPI_EC_BURST_ENABLE, NULL, 0,\n+\t\t\t\t\t&d, 1, 0);\n+\tif (status == -ETIME) {\n+\t\t/*\n+\t\t * When timeouts happends, the burst mode will be disabled.\n+\t\t * In such case OS won't use burst mode again in the following\n+\t\t * transaction sequence.\n+\t\t */\n+\t\tec_burst_timeout = 1;\n+\t}\n+\treturn status;\n }\n \n int acpi_ec_burst_disable(struct acpi_ec *ec)\n {\n+\tu8 ec_status;\n+\n+\tif (ec_burst_timeout) {\n+\t\t/*\n+\t\t * If burst mode is disabled, it means that the EC won't\n+\t\t * enter the burst mode again. In such case it is unnecessary\n+\t\t * to issue the BURST_DISABLE command.\n+\t\t */\n+\t\treturn 0;\n+\t}\n+\n+\tec_status = acpi_ec_read_status(ec);\n+\tif (!(ec_status & ACPI_EC_FLAG_BURST)) {\n+\t\t/*\n+\t\t * If the EC has exit the burst mode already,it is unnecessary\n+\t\t * to issue the BURST_DISABLE command again.\n+\t\t */\n+\t\treturn 0;\n+\t}\n \treturn acpi_ec_transaction(ec, ACPI_EC_BURST_DISABLE, NULL, 0, NULL, 0, 0);\n }\n \n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "Power-Battery", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "ykzhao", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "Regressions-2.6.26", "Reported": "2008-07-21 19:43 UTC by Gu Rui", "Modified": "2008-09-28 03:49 UTC", "CC List": "5 users", "See Also": "", "Kernel Version": "2.6.26", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/acpi/ec.c"], "methods": ["acpi_ec_wait"]}
{"id": "11139", "title": "warning in cpufreq.c on E450", "description": "Latest working kernel version: 2.6.24.2\nEarliest failing kernel version: 2.6.26\nDistribution: Debian Sid\nHardware Environment: Sun E450/2x CPU 400Mhz/1GB Ram\nSoftware Environment: Sid\nProblem Description:\nAfter I compile 2.6.26 an boots I get this:\n------------[ cut here ]------------                                            \nWARNING: at drivers/cpufreq/cpufreq.c:1391 cpufreq_register_notifier+0x50/0x60()\nModules linked in:                                                              \nCall Trace:                                                                     \n [0000000000605270] cpufreq_register_notifier+0x58/0x60                         \n [00000000007708e0] start_kernel+0x1f0/0x324                                    \n [0000000000680e08] auxio_probe+0x0/0xe8                                        \n [0000000000000000] 0x8                                                         \n---[ end trace 139ce121c98e96c9 ]---\n\nSteps to reproduce:\nCompile kernel with cpufreq enabled and boot.", "patch": ["From e8d8fa16f2ae1b53af69e2fcabba7b9ee73bbef0 Mon Sep 17 00:00:00 2001\nFrom: Dominik Brodowski <linux@dominikbrodowski.net>\nDate: Wed, 23 Jul 2008 20:56:23 +0200\nSubject: [PATCH 1/1] [PATCH] cpufreq: sparc64 tried to register notifier too early\n\ncpufreq notifiers may only be registered after pure_initcall.\nFixes bugzilla #11139\n\nSigned-off-by: Dominik Brodowski <linux@dominikbrodowski.net>\n---\n arch/sparc64/kernel/time.c |   13 ++++++++-----\n 1 files changed, 8 insertions(+), 5 deletions(-)\n\ndiff --git a/arch/sparc64/kernel/time.c b/arch/sparc64/kernel/time.c\nindex bedc4c1..f6890ca 100644\n--- a/arch/sparc64/kernel/time.c\n+++ b/arch/sparc64/kernel/time.c\n@@ -884,6 +884,14 @@ static struct notifier_block sparc64_cpufreq_notifier_block = {\n \t.notifier_call\t= sparc64_cpufreq_notifier\n };\n \n+\n+static int __init sparc64_cpufreq_register_notifier(void)\n+{\n+\treturn cpufreq_register_notifier(&sparc64_cpufreq_notifier_block,\n+\t\t\t\t\t CPUFREQ_TRANSITION_NOTIFIER);\n+}\n+core_initcall(sparc64_cpufreq_register_notifier); /* needs to be after pure_ */\n+\n #endif /* CONFIG_CPU_FREQ */\n \n static int sparc64_next_event(unsigned long delta,\n@@ -1050,11 +1058,6 @@ void __init time_init(void)\n \t       sparc64_clockevent.mult, sparc64_clockevent.shift);\n \n \tsetup_sparc64_timer();\n-\n-#ifdef CONFIG_CPU_FREQ\n-\tcpufreq_register_notifier(&sparc64_cpufreq_notifier_block,\n-\t\t\t\t  CPUFREQ_TRANSITION_NOTIFIER);\n-#endif\n }\n \n unsigned long long sched_clock(void)\n-- \n1.5.4.3\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Power Management", "Classification": "Unclassified", "Component": "cpufreq", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "cpufreq", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2008-07-21 15:02 UTC by Daniel Smolik", "Modified": "2008-09-24 04:14 UTC", "CC List": "1 user", "See Also": "", "Kernel Version": "2.6.26", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["arch/sparc64/kernel/time.c"], "methods": ["time_init"]}
{"id": "11104", "title": "iwlwifi: printk flood in ad-hoc mode + WEP", "description": "Latest working kernel version: 2.6.25.4\nEarliest failing kernel version: 2.6.26\nDistribution: Debian Sid\nHardware Environment: Fujitsu-Siemens Lifebook E8110, T2400, IWL3945\nSoftware Environment: Gnome 2.22\nProblem Description:\n\nAfter configuring the interface to Ad-hoc mode and WEP, when the remote station tries to connect, the dmesg gets flooded by iwlwifi, and shortly afterwards the remote client disconnects.\n\nSteps to reproduce:\n\n/sbin/iwconfig $WIFI mode ad-hoc \n/sbin/iwconfig $WIFI essid $SSID channel 3\n/sbin/iwconfig $WIFI key s:$PASS", "patch": ["diff --git a/net/mac80211/mlme.c b/net/mac80211/mlme.c\nindex e1d11c9..dce43b5 100644\n--- a/net/mac80211/mlme.c\n+++ b/net/mac80211/mlme.c\n@@ -2866,7 +2866,7 @@ static void ieee80211_rx_bss_info(struct net_device *dev,\n \t\t       jiffies);\n #endif /* CONFIG_MAC80211_IBSS_DEBUG */\n \t\tif (beacon_timestamp > rx_timestamp) {\n-#ifndef CONFIG_MAC80211_IBSS_DEBUG\n+#ifdef CONFIG_MAC80211_IBSS_DEBUG\n \t\t\tprintk(KERN_DEBUG \"%s: beacon TSF higher than \"\n \t\t\t       \"local TSF - IBSS merge with BSSID %s\\n\",\n \t\t\t       dev->name, print_mac(mac, mgmt->bssid));\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "network-wireless", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "drivers_network-wireless@kernel-bugs.osdl.org", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2008-07-16 15:05 UTC by Mircea Gherzan", "Modified": "2015-11-22 07:32 UTC", "CC List": "0 users", "See Also": "", "Kernel Version": "2.6.26", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["net/mac80211/mlme.c"], "methods": ["ieee80211_rx_bss_info"]}
{"id": "10976", "title": "Soft lockup on (intentionally) corrupted filesystem", "description": "Distribution: Debian sid (unstable)\nHardware Environment: qemu x86\nSoftware Environment: Minimal Debian sid\nProblem Description:\n\nMounting one of the attached intentionally corrupted ext3 filesystems and accessing it causes a soft lockup. I believe they probably are the same bug (both happen in __log_wait_for_space()), but the backtraces vary quite a bit so I attach two test cases.\n\nMy kernel is 2.6.25.8 + three patches posted by Duane Griffin for #10882, namely (I hope I understand the git terminology right, at least you can grep lkml archives for these):\n  - 6ae4ecf..8019bf2\n  - 7712682..bc030f4\n  - 0b8cf80..ea0236b\n\n\n\nSteps to reproduce:\n\n1. bunzip2 one of the filesystem images\n2. mount fs.img /mnt\n3. ls /mnt", "patch": ["Subject: [PATCH] jbd: abort instead of waiting for nonexistent transactions\n\nThe __log_wait_for_space function sits in a loop checkpointing transactions\nuntil there is sufficient space free in the journal. However, if there are\nno transactions to be processed (e.g. because the free space calculation is\nwrong due to a corrupted filesystem) it will never progress.\n\nCheck for space being required when no transactions are outstanding and\nabort the journal instead of endlessly looping.\n\nThis patch fixes the bug reported by Sami Liedes at:\nhttp://bugzilla.kernel.org/show_bug.cgi?id=10976\n\nSigned-off-by: Duane Griffin <duaneg@dghda.com>\n---\ndiff --git a/fs/jbd/checkpoint.c b/fs/jbd/checkpoint.c\nindex a5432bb..9fac177 100644\n--- a/fs/jbd/checkpoint.c\n+++ b/fs/jbd/checkpoint.c\n@@ -126,14 +126,29 @@ void __log_wait_for_space(journal_t *journal)\n \n \t\t/*\n \t\t * Test again, another process may have checkpointed while we\n-\t\t * were waiting for the checkpoint lock\n+\t\t * were waiting for the checkpoint lock. If there are no\n+\t\t * outstanding transactions there is nothing to checkpoint and\n+\t\t * we can't make progress. Abort the journal in this case.\n \t\t */\n \t\tspin_lock(&journal->j_state_lock);\n+\t\tspin_lock(&journal->j_list_lock);\n \t\tnblocks = jbd_space_needed(journal);\n \t\tif (__log_space_left(journal) < nblocks) {\n+\t\t\tint chkpt = journal->j_checkpoint_transactions != NULL;\n+\n+\t\t\tspin_unlock(&journal->j_list_lock);\n \t\t\tspin_unlock(&journal->j_state_lock);\n-\t\t\tlog_do_checkpoint(journal);\n+\t\t\tif (chkpt) {\n+\t\t\t\tlog_do_checkpoint(journal);\n+\t\t\t} else {\n+\t\t\t\tprintk(KERN_ERR \"%s: no transactions\\n\",\n+\t\t\t\t       __func__);\n+\t\t\t\tjournal_abort(journal, 0);\n+\t\t\t}\n+\n \t\t\tspin_lock(&journal->j_state_lock);\n+\t\t} else {\n+\t\t\tspin_unlock(&journal->j_list_lock);\n \t\t}\n \t\tmutex_unlock(&journal->j_checkpoint_mutex);\n \t}\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "File System", "Classification": "Unclassified", "Component": "ext3", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Andrew Morton", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2008-06-24 12:42 UTC by Sami Liedes", "Modified": "2008-09-26 06:43 UTC", "CC List": "1 user", "See Also": "", "Kernel Version": "2.6.25", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["fs/jbd/checkpoint.c"], "methods": ["__log_wait_for_space"]}
{"id": "10860", "title": "total system freeze at boot with 2.6.26-rc", "": "Show dependency tree", "description": "Latest working kernel version:2.6.25.4\nEarliest failing kernel version:2.6.24-rc4\nalso fails with -rc5 I was wating for, previous rcs not tested\nDistribution: Bluewhite64 (64 bits slackware)\nHardware Environment: Athlon64 X2 / Ali 1689 north 1563 south\n+ bt848 v4l + PATA and SATA disk (SATA on sata_uli)\nSeems to be related to sata disk detection (see below).\n\nSoftware Environment:\nnone\n\nProblem Description:\nthe computer freeze totally at boot after SATA disk detection.\nI append 2.6.25.4 dmesg, lspci and lsusb.\nThe CPU is not 100% (otherwise I could hear the fan going crazy), the keayboard is dead (unable to scroll the console up or down). Nothings happen.\n\nThe console shows somethings similar to the 2.6.25.4 logs, but hangs after those lines:\nhda: cache flushes not supported\n hda: hda1 hda2\nhdd: ATAPI 40X DVD-ROM DVD-R-RAM CD-R/RW drive, 2048kB Cache\nUniform CD-ROM driver Revision: 3.20\nDriver 'sd' needs updating - please use bus_type methods\nsata_uli 0000:00:0e.1: version 1.3\nACPI: PCI Interrupt 0000:00:0e.1[A] -> GSI 19 (level, low) -> IRQ 19\nscsi0 : sata_uli\nscsi1 : sata_uli\nata1: SATA max UDMA/133 cmd 0xf80 ctl 0xf00 bmdma 0xd880 irq 19\nata2: SATA max UDMA/133 cmd 0xe80 ctl 0xe00 bmdma 0xd888 irq 19\nata1: SATA link up 1.5 Gbps (SStatus 113 SControl 300)\n\n<-- here, 2.6.24 hangs -->\n\nnormal way for 2.6.25 :\n\nata1.00: ATA-7: ST3200826AS, 3.06, max UDMA/133\nata1.00: 390721968 sectors, multi 16: LBA48 NCQ (depth 0/32)\nata1.00: configured for UDMA/133\nata2: SATA link down (SStatus 0 SControl 300)\nscsi 0:0:0:0: Direct-Access     ATA      ST3200826AS      3.06 PQ: 0 ANSI: 5\nsd 0:0:0:0: [sda] 390721968 512-byte hardware sectors (200050 MB)\nsd 0:0:0:0: [sda] Write Protect is off\nsd 0:0:0:0: [sda] Mode Sense: 00 3a 00 00\n\nSteps to reproduce:\nBoot my PC :-)\nI guess any sata_uli device may hang the same way?", "patch": ["diff --git a/drivers/ata/sata_uli.c b/drivers/ata/sata_uli.c\nindex f277cea..db529b8 100644\n--- a/drivers/ata/sata_uli.c\n+++ b/drivers/ata/sata_uli.c\n@@ -83,6 +83,7 @@ static struct ata_port_operations uli_ops = {\n \t.inherits\t\t= &ata_bmdma_port_ops,\n \t.scr_read\t\t= uli_scr_read,\n \t.scr_write\t\t= uli_scr_write,\n+\t.hardreset\t\t= ATA_OP_NULL,\n };\n \n static const struct ata_port_info uli_port_info = {\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "IO/Storage", "Classification": "Unclassified", "Component": "Serial ATA", "Hardware": "All Linux", "Importance": "P1 blocking", "Assignee": "Jeff Garzik", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "10492", "Reported": "2008-06-05 12:38 UTC by Christian Casteyde", "Modified": "2008-07-06 08:55 UTC", "CC List": "1 user", "See Also": "", "Kernel Version": "2.6.26-rc2", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/ata/sata_uli.c"], "methods": ["uli_ops"]}
{"id": "10836", "title": "ELO serial touchscreen driver unload issue", "description": "Latest working kernel version: n/a\nEarliest failing kernel version:  2.6.26-rc4-git2\nDistribution: opensuse 10.1\nHardware Environment: x86 / p4 /gigabyte mobo\nSoftware Environment:\nProblem Description:\n\nelo driver seems to have issues when unloading - at least on system without elo touchscreen attached\n\n[  119.319962] BUG: unable to handle kernel paging request at f8cabfcc\n[  119.319962] IP: [<c0269171>] driver_attach+0x3/0x16\n[  119.319962] *pde = 37e08067 *pte = 00000000\n[  119.319962] Oops: 0000 [#1] SMP\n[  119.319962] Modules linked in: psmouse vboxdrv ipv6 button battery ac loop dm _mod md_mod mousedev evdev rtc_cmos rtc_core rtc_lib 8250_pnp e100 mii ehci_hcd uhci_hcd intel_agp usbcore agpgart i2c_i801 rng_core i2c_core iTCO_wdt iTCO_vend or_support parport_pc lp parport 8250 serial_core edd fan thermal processor ther mal_sys hwmon sg megaraid_mbox sr_mod cdrom megaraid_mm ata_piix libata dock sd_ mod scsi_mod [last unloaded: elo]\n[  119.319962]\n[  119.319962] Pid: 121, comm: kseriod Not tainted (2.6.26-rc4-git2 #1)\n[  119.319962] EIP: 0060:[<c0269171>] EFLAGS: 00010246 CPU: 0\n[  119.319962] EIP is at driver_attach+0x3/0x16\n[  119.319962] EAX: f8cabfc8 EBX: f56adec0 ECX: f8cabfc8 EDX: 00000246\n[  119.319962] ESI: f78ec560 EDI: f8cabfa0 EBP: f7877fd0 ESP: f7877f84\n[  119.319962]  DS: 007b ES: 007b FS: 00d8 GS: 0000 SS: 0068\n[  119.319962] Process kseriod (pid: 121, ti=f7877000 task=f786be80 task.ti=f787 7000)\n[  119.319962] Stack: f7877fd0 c026d651 00000246 00000000 00000000 00000000 0000 0000 00000000\n[  119.319962]        00000001 f7819f28 f7819f2c 00000000 f786be80 c013262d f787 7fbc f7877fbc\n[  119.319962]        00000000 c026d4f5 00000000 f7877fe0 c0132559 c013251e 0000 0000 00000000\n[  119.319962] Call Trace:\n[  119.319962]  [<c026d651>] ? serio_thread+0x15c/0x2f3\n[  119.319962]  [<c013262d>] ? autoremove_wake_function+0x0/0x33\n[  119.319962]  [<c026d4f5>] ? serio_thread+0x0/0x2f3\n[  119.319962]  [<c0132559>] ? kthread+0x3b/0x62\n[  119.319962]  [<c013251e>] ? kthread+0x0/0x62\n[  119.319962]  [<c0104443>] ? kernel_thread_helper+0x7/0x10\n[  119.319962]  =======================\n[  119.319962] Code: 5d c3 55 89 e5 56 8d b0 b8 00 00 00 53 89 c3 89 f0 e8 b1 c9  ec ff 89 d8 e8 6d ff ff ff 89 f0 e8 39 c9 ec ff 5b 5e 5d c3 55 89 c1 <8b> 40 04  89 e5 31 d2 68 70 93 26 c0 e8 23 fa ff ff c9 c3 55 89\n[  119.319962] EIP: [<c0269171>] driver_attach+0x3/0x16 SS:ESP 0068:f7877f84\n[  119.319962] ---[ end trace 9f13a3e20519fbdd ]---\n\n\nSteps to reproduce:\n\nwhile true;do modprobe elo; echo -n load;modprobe -r elo;echo -n unload;done", "patch": ["Signed-off-by: Dmitry Torokhov <dtor@mail.ru>\n---\n drivers/input/serio/serio.c |    9 ++++++---\n 1 file changed, 6 insertions(+), 3 deletions(-)\n\nIndex: linux/drivers/input/serio/serio.c\n===================================================================\n--- linux.orig/drivers/input/serio/serio.c\n+++ linux/drivers/input/serio/serio.c\n@@ -331,9 +331,10 @@ static void serio_handle_event(void)\n }\n \n /*\n- * Remove all events that have been submitted for a given serio port.\n+ * Remove all events that have been submitted for a given\n+ * object, be it serio port or driver.\n  */\n-static void serio_remove_pending_events(struct serio *serio)\n+static void serio_remove_pending_events(void *object)\n {\n \tstruct list_head *node, *next;\n \tstruct serio_event *event;\n@@ -343,7 +344,7 @@ static void serio_remove_pending_events(\n \n \tlist_for_each_safe(node, next, &serio_event_list) {\n \t\tevent = list_entry(node, struct serio_event, node);\n-\t\tif (event->object == serio) {\n+\t\tif (event->object == object) {\n \t\t\tlist_del_init(node);\n \t\t\tserio_free_event(event);\n \t\t}\n@@ -837,7 +838,9 @@ void serio_unregister_driver(struct seri\n \tstruct serio *serio;\n \n \tmutex_lock(&serio_mutex);\n+\n \tdrv->manual_bind = 1;\t/* so serio_find_driver ignores it */\n+\tserio_remove_pending_events(drv);\n \n start_over:\n \tlist_for_each_entry(serio, &serio_list, node) {\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Serial", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Dmitry Torokhov", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2008-05-30 01:26 UTC by Roland Kletzing", "Modified": "2008-07-22 12:46 UTC", "CC List": "0 users", "See Also": "", "Kernel Version": "2.6.26", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/input/serio/serio.c"], "methods": ["serio_remove_pending_events", "serio_unregister_driver"]}
{"id": "10695", "title": "no AC status notification", "description": "Latest working kernel version:2.6.22\nEarliest failing kernel version:\nDistribution: Mandriva\nHardware Environment: Sony vaio fz315s\nProblem Description:\nWhen the ac_adapter is disconnected, acpi in theory should generate 2 events, \n\nac_adapter AC 00000080 00000000\nbattery BAT0 00000080 00000001\n\nbut in my case it only generates the BAT0 event.\n\nSteps to reproduce:\nInstall a 2.6.24 kernel, execute acpi_listen and plug/unplug the ac_adapter.", "patch": ["diff --git a/drivers/acpi/ac.c b/drivers/acpi/ac.c\nindex 5b73f6a..831883b 100644\n--- a/drivers/acpi/ac.c\n+++ b/drivers/acpi/ac.c\n@@ -233,6 +233,9 @@ static void acpi_ac_notify(acpi_handle handle, u32 event, void *data)\n \n \tdevice = ac->device;\n \tswitch (event) {\n+\tdefault:\n+\t\tACPI_DEBUG_PRINT((ACPI_DB_INFO,\n+\t\t\t\t  \"Unsupported event [0x%x]\\n\", event));\n \tcase ACPI_AC_NOTIFY_STATUS:\n \tcase ACPI_NOTIFY_BUS_CHECK:\n \tcase ACPI_NOTIFY_DEVICE_CHECK:\n@@ -244,11 +247,6 @@ static void acpi_ac_notify(acpi_handle handle, u32 event, void *data)\n #ifdef CONFIG_ACPI_SYSFS_POWER\n \t\tkobject_uevent(&ac->charger.dev->kobj, KOBJ_CHANGE);\n #endif\n-\t\tbreak;\n-\tdefault:\n-\t\tACPI_DEBUG_PRINT((ACPI_DB_INFO,\n-\t\t\t\t  \"Unsupported event [0x%x]\\n\", event));\n-\t\tbreak;\n \t}\n \n \treturn;\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "Power-Battery", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Len Brown", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2008-05-14 08:16 UTC by Alex Fiestas", "Modified": "2008-10-16 22:30 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "2.6.24", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/acpi/ac.c"], "methods": ["acpi_ac_notify"]}
{"id": "10590", "title": "rndis_host fails to register HTC P3600 device", "description": "Latest working kernel version: ???\nEarliest failing kernel version: ???, but fails with 2.6.24 too\nDistribution: Debian unstable\nHardware Environment: AMD64 Sempron on a VIA board, HTC P3600 \"phone\" with Samsung SC32442B processor\nSoftware Environment: SynCE 0.11 (host), Microsoft® Windows Mobile® 5.0 (phone)\n\nProblem Description: When I connect my hype phone thingy to my computer, the rdnis_host driver is loaded, but registration of the device fails, with the following logs:\n\n[17069.106611] usb 2-1: new full speed USB device using uhci_hcd and address 7\n[17069.228636] usb 2-1: configuration #1 chosen from 1 choice\n[17069.232878] usb 2-1: New USB device found, idVendor=0bb4, idProduct=0b05\n[17069.232884] usb 2-1: New USB device strings: Mfr=1, Product=2, SerialNumber=3\n[17069.232887] usb 2-1: Product: Generic RNDIS\n[17069.232890] usb 2-1: Manufacturer: HTC\n[17069.232892] usb 2-1: SerialNumber: ********-****-****-****-************\n[17069.367902] usbcore: registered new interface driver cdc_ether\n[17069.446807] rndis_host 2-1:1.0: RNDIS_MSG_QUERY(0x00010202) failed, -110\n[17069.511717] rndis_host 2-1:1.0: RNDIS_MSG_QUERY(0x01010101) failed, -110\n[17069.511725] rndis_host 2-1:1.0: rndis get ethaddr, -110\n[17069.513247] rndis_host: probe of 2-1:1.0 failed with error -110\n[17069.513290] usbcore: registered new interface driver rndis_host\n[17069.613383] rndis_wlan 2-1:1.0: RNDIS_MSG_QUERY(0x00010202) failed, -47\n[17069.614388] usbcore: registered new interface driver rndis_wlan\n\nHowever, the SynCE project provides an alternative patched rndis_host driver, which does work. I narrowed down the diff to the relevant bits, and when patched with those bits, the mainline kernel driver works, with the following logs:\n\n[17039.548771] usb 2-1: new full speed USB device using uhci_hcd and address 6\n[17039.668976] usb 2-1: configuration #1 chosen from 1 choice\n[17039.672000] usb 2-1: New USB device found, idVendor=0bb4, idProduct=0b05\n[17039.672006] usb 2-1: New USB device strings: Mfr=1, Product=2, SerialNumber=3\n[17039.672009] usb 2-1: Product: Generic RNDIS\n[17039.672012] usb 2-1: Manufacturer: HTC\n[17039.672014] usb 2-1: SerialNumber: ********-****-****-****-************\n[17039.808935] usbcore: registered new interface driver cdc_ether\n[17040.343229] rndis_host 2-1:1.0: RNDIS_MSG_QUERY(0x00010202) failed, -47\n[17040.915682] eth2: register 'rndis_host' at usb-0000:00:10.0-1, RNDIS device 80:00:60:0f:e8:00\n[17040.915721] usbcore: registered new interface driver rndis_host\n[17040.931986] usbcore: registered new interface driver rndis_wlan\n[17048.027188] eth2: no IPv6 routers present\n\nThe \"RNDIS_MSG_QUERY(0x00010202) failed, -47\" didn't show up with the 2.6.24 driver. (However, 2.6.24 had a packet reception problem, fixed by some other bits of the SynCE driver, but this doesn't appear on 2.6.25 anymore).\n\nSteps to reproduce: Just turn on the device and plug it into the USB port.\n\nAt least, the patch makes things work...", "patch": ["--- drivers/net/usb/rndis_host.c\t2008-04-17 04:49:44.000000000 +0200\n+++ drivers/net/usb/rndis_host.c\t2008-05-02 13:49:12.000000000 +0200\n@@ -51,6 +51,9 @@\n  * currently rare) \"Ethernet Emulation Model\" (EEM).\n  */\n \n+/* SC_* Samsung processors needs an extra timeout */\n+#define SC_SLEEP_TIMEOUT\t\t20\n+\n /*\n  * RNDIS notifications from device: command completion; \"reverse\"\n  * keepalives; etc\n@@ -116,6 +119,7 @@\n \trsp = buf->msg_type | RNDIS_MSG_COMPLETION;\n \tfor (count = 0; count < 10; count++) {\n \t\tmemset(buf, 0, CONTROL_BUFFER_SIZE);\n+\t\tmsleep(SC_SLEEP_TIMEOUT * 10);\n \t\tretval = usb_control_msg(dev->udev,\n \t\t\tusb_rcvctrlpipe(dev->udev, 0),\n \t\t\tUSB_CDC_GET_ENCAPSULATED_RESPONSE,\n@@ -123,6 +127,7 @@\n \t\t\t0, master_ifnum,\n \t\t\tbuf, CONTROL_BUFFER_SIZE,\n \t\t\tRNDIS_CONTROL_TIMEOUT_MS);\n+\t\tmsleep(SC_SLEEP_TIMEOUT * 10);\n \t\tif (likely(retval >= 8)) {\n \t\t\tmsg_len = le32_to_cpu(buf->msg_len);\n \t\t\trequest_id = (__force u32) buf->request_id;\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Network", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Jeff Garzik", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2008-05-02 06:56 UTC by Pierre Ynard", "Modified": "2008-08-12 01:15 UTC", "CC List": "0 users", "See Also": "", "Kernel Version": "2.6.25", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/net/usb/rndis_host.c"], "methods": ["rndis_command"]}
{"id": "10507", "title": "Kernel fails to properly identify SATA drives", "description": "Latest working kernel version: 2.6.22.9 and 2.6.23.17\n\nEarliest failing kernel version: 2.6.24\n\nDistribution: Ubuntu x86_64\n\nHardware Environment: Asus M2R32-MVP 580X SB600 (AM2)\n                      AMD X2 4000+\n                      4GB DDR2\n                      SATAII HDD\n                      SATA DVD R/W\n\nSoftware Environment: Ubuntu Gutsy w/ distribution kernel (2.6.22-14)\n\nProblem Description: All 2.6.24 and 2.6.25 kernels fail to boot properly, with the following error looping indefinitely:\n\nata1.00: failed to IDENTIFY (I/O error, err_mask=0x4)\nata2.00: failed to IDENTIFY (I/O error, err_mask=0x4)\n\nThe above correspond to my two SATA physical drives.  All 2.6.22 and 2.6.23 kernels work perfectly on this same machine.  Was there some type of change starting with the 2.6.24 kernels that is rendering my PC inoperable?  \nI have tried looking for similar reports on this, and so far I have only found one entry on the mailing list that deals with the same issue.  The problem was apparently solved by a BIOS flash to the latest revision, which I'm reluctant to do since the newest BIOS from ASUS has several bugs that renders my particular system unusable.\n\n\nSteps to reproduce:\nUsing the 0906 BIOS revision for the M2R32-MVP motherboard and SATA drives.", "patch": ["---\n drivers/ata/ahci.c |    2 +-\n 1 file changed, 1 insertion(+), 1 deletion(-)\n\nIndex: tree0/drivers/ata/ahci.c\n===================================================================\n--- tree0.orig/drivers/ata/ahci.c\n+++ tree0/drivers/ata/ahci.c\n@@ -433,7 +433,7 @@ static const struct ata_port_info ahci_p\n \t/* board_ahci_sb600 */\n \t{\n \t\tAHCI_HFLAGS\t(AHCI_HFLAG_IGN_SERR_INTERNAL |\n-\t\t\t\t AHCI_HFLAG_32BIT_ONLY |\n+\t\t\t\t AHCI_HFLAG_32BIT_ONLY | AHCI_HFLAG_NO_MSI |\n \t\t\t\t AHCI_HFLAG_SECT255 | AHCI_HFLAG_NO_PMP),\n \t\t.flags\t\t= AHCI_FLAG_COMMON,\n \t\t.link_flags\t= AHCI_LFLAG_COMMON,\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "IO/Storage", "Classification": "Unclassified", "Component": "Serial ATA", "Hardware": "All Linux", "Importance": "P1 blocking", "Assignee": "Tejun Heo", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2008-04-22 18:38 UTC by Melcar", "Modified": "2008-05-23 14:30 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "2.6.24", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/ata/ahci.c"], "methods": ["ahci_port_info"]}
{"id": "10486", "title": "kernel 2.6.24  4G FC arrays don't work properly with qla2xxx driver", "description": "Latest working kernel version: 2.6.23\nEarliest failing kernel version: 2.6.24\nDistribution: gentoo\nHardware Environment: opteron\nSoftware Environment: x86_64\nProblem Description:\n\nWith 2.6.24 and 25 there are troubles with qla2xxx module. 4G FC\narrays (Infortrend) are not working properly, while 2G FC are OK. \n\nDetecting 4G array gives:\n sd 8:0:0:0: [sdc] Very big device. Trying to use READ CAPACITY(16).\n sd 8:0:0:0: [sdc] 44918798336 512-byte hardware sectors (22998425 MB)\n sd 8:0:0:0: [sdc] Write Protect is off\n sd 8:0:0:0: [sdc] Mode Sense: 8f 00 00 08\n sd 8:0:0:0: [sdc] Write cache: enabled, read cache: enabled, doesn't support\nDPO or FUA\n sd 8:0:0:0: [sdc] Very big device. Trying to use READ CAPACITY(16).\n sd 8:0:0:0: [sdc] 44918798336 512-byte hardware sectors (22998425 MB)\n sd 8:0:0:0: [sdc] Write Protect is off\n sd 8:0:0:0: [sdc] Mode Sense: 8f 00 00 08\n sd 8:0:0:0: [sdc] Write cache: enabled, read cache: enabled, doesn't support\nDPO or FUA\n sdc: sdc1\n sd 8:0:0:0: [sdc] Attached SCSI disk\n\nand later on, generated by vgscan:\n\n sd 8:0:0:0: [sdc] Result: hostbyte=DID_ERROR driverbyte=DRIVER_OK,SUGGEST_OK\n end_request: I/O error, dev sdc, sector 0\n sd 8:0:0:0: [sdc] Result: hostbyte=DID_ERROR driverbyte=DRIVER_OK,SUGGEST_OK\n end_request: I/O error, dev sdc, sector 44918798208\n sd 8:0:0:0: [sdc] Result: hostbyte=DID_ERROR driverbyte=DRIVER_OK,SUGGEST_OK\n end_request: I/O error, dev sdc, sector 44918798320\n sd 8:0:0:0: [sdc] Result: hostbyte=DID_ERROR driverbyte=DRIVER_OK,SUGGEST_OK\n end_request: I/O error, dev sdc, sector 0\n sd 8:0:0:0: [sdc] Result: hostbyte=DID_ERROR driverbyte=DRIVER_OK,SUGGEST_OK\n end_request: I/O error, dev sdc, sector 8\n sd 8:0:0:0: [sdc] Result: hostbyte=DID_ERROR driverbyte=DRIVER_OK,SUGGEST_OK\n end_request: I/O error, dev sdc, sector 0\n sd 8:0:0:0: [sdc] Result: hostbyte=DID_ERROR driverbyte=DRIVER_OK,SUGGEST_OK\n end_request: I/O error, dev sdc, sector 44918798114\n sd 8:0:0:0: [sdc] Result: hostbyte=DID_ERROR driverbyte=DRIVER_OK,SUGGEST_OK\n end_request: I/O error, dev sdc, sector 44918798282\n sd 8:0:0:0: [sdc] Result: hostbyte=DID_ERROR driverbyte=DRIVER_OK,SUGGEST_OK\n end_request: I/O error, dev sdc, sector 34\n sd 8:0:0:0: [sdc] Result: hostbyte=DID_ERROR driverbyte=DRIVER_OK,SUGGEST_OK\n end_request: I/O error, dev sdc, sector 42\n sd 8:0:0:0: [sdc] Result: hostbyte=DID_ERROR driverbyte=DRIVER_OK,SUGGEST_OK\n end_request: I/O error, dev sdc, sector 34\n\n\n2.6.23 (gentoo-sources) works fine. I am not sure whether this is a regression\nin the driver or something else. The controller is\nQLogic QLE220 - PCI-Express to 4Gb FC, Single Channel\nISP5432: PCIe (2.5Gb/s x4)\nand firmware version is 4.02.02 (from sys-block/qla-fc-firmware-20071207)\nOn qlogic site there is a newer firmware (4.03.02), although I doubt the\nfirmware would be the cause of the problems.\n\nTo be honest, I have not checked 2.6.25 release but rather rc8, however there are no qla2xxx related patches since then.\n\n\nSteps to reproduce: boot 2.6.24 or 25, run vgscan", "patch": ["diff --git a/Makefile b/Makefile\nindex d35c524..3dbc826 100644\n--- a/Makefile\n+++ b/Makefile\n@@ -1,7 +1,7 @@\n VERSION = 2\n PATCHLEVEL = 6\n SUBLEVEL = 25\n-EXTRAVERSION = -numa\n+EXTRAVERSION =\n NAME = Funky Weasel is Jiggy wit it\n \n # *DOCUMENTATION*\ndiff --git a/drivers/scsi/qla2xxx/qla_os.c b/drivers/scsi/qla2xxx/qla_os.c\nindex 878a37a..3223fd1 100644\n--- a/drivers/scsi/qla2xxx/qla_os.c\n+++ b/drivers/scsi/qla2xxx/qla_os.c\n@@ -2373,7 +2373,7 @@ qla2x00_do_dpc(void *data)\n \t\t\t\t\t} else {\n \t\t\t\t\t\tfcport->login_retry = 0;\n \t\t\t\t\t}\n-\t\t\t\t\tif (fcport->login_retry == 0)\n+\t\t\t\t\tif (fcport->login_retry == 0 && status != QLA_SUCCESS)\n \t\t\t\t\t\tfcport->loop_id = FC_NO_LOOP_ID;\n \t\t\t\t}\n \t\t\t\tif (test_bit(LOOP_RESYNC_NEEDED, &ha->dpc_flags))\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "SCSI Drivers", "Classification": "Unclassified", "Component": "QLOGIC QLA2XXX", "Hardware": "All Linux", "Importance": "P1 blocking", "Assignee": "scsi_drivers-qla2xxx", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2008-04-19 14:46 UTC by Andrej Filipcic", "Modified": "2008-04-29 14:12 UTC", "CC List": "1 user", "See Also": "", "Kernel Version": "2.6.24", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/scsi/qla2xxx/qla_os.c"], "methods": ["qla2x00_do_dpc"]}
{"id": "10403", "title": "Quotas problem on ext3 FS mounted with data=journal", "description": "Latest working kernel version: none\nEarliest failing kernel version: 2.6.25-rc8\nDistribution: Gentoo\nHardware Environment: x86 (both 32 and 64 bits)\nSoftware Environment: GNU\nProblem Description:\n\nNew quota data is not read (from aquota.user file) after quota enabling\non ext3 FS mounted with \"data=journal\".\nNOTE: data=ordered (default) and data=writeback - are OK.\nThe problem is with quota v2 (old format is not tested).\n\n\nSteps to reproduce:\n\nThe problem is always recreatable.\nJust create an ext3 FS and mount it with \"data=journal\".\nHere is the howto:\n\n# dd if=/dev/zero of=TEST.ext3.fs bs=1M count=1 seek=99\n# mkfs.ext3 TEST.ext3.fs\n# mkdir -p /mnt/1\n# modprobe loop\n# mount TEST.ext3.fs /mnt/1 -ousrquota,data=journal,loop\n# quotacheck /dev/loop0\n# quotaon -a\n\n//  Set quotas for some user (john) both soft and hard (to something like 80000)\n# edquota john\n\n// Put some data into the FS\n# cp -a /usr/src/linux/kernel /mnt/1\n\n// Owned by user john\n# chown -R john:john /mnt/1/kernel\n\n# quota john\nDisk quotas for user john (uid 1003):\n     Filesystem  blocks   quota   limit   grace   files   quota   limit   grace\n     /dev/loop0   40248   80000   80000             412       0       0\n\n// Disable quotas\n# quotaoff -a\n\n// Set quotas to just another value (like 90000)\n# edquota john\n\n// Enable quotas\n# quotaon -a\n\n// And check the user again\n# quota john\nDisk quotas for user john (uid 1003):\n     Filesystem  blocks   quota   limit   grace   files   quota   limit   grace\n     /dev/loop0   40248   80000   80000             412       0       0\n\nProblem: the quotas is not changed.\n\n\nIf:\n- the FS is mounted by default (with data=ordered)\n- or with data=writeback\n- or \"edquota john\" is running with enabled quotas on the FS\n\nthe problem is not arising.", "patch": ["From b8a292fee9e8a68125070d3309f0ca821263ba23 Mon Sep 17 00:00:00 2001\nFrom: Jan Kara <jack@suse.cz>\nDate: Thu, 10 Apr 2008 19:01:28 +0200\nSubject: [PATCH] ext3: Fix synchronization of quota files in journal=data mode\n\nIn journal=data mode, it is not enough to do write_inode_now as done in\nvfs_quota_on() to write all data to their final location (which is needed\nfor quota_read to work correctly). Calling journal_flush() does its job.\n\nSigned-off-by: Jan Kara <jack@suse.cz>\n---\n fs/ext3/super.c |   42 +++++++++++++++++++++++++++++-------------\n 1 files changed, 29 insertions(+), 13 deletions(-)\n\ndiff --git a/fs/ext3/super.c b/fs/ext3/super.c\nindex 77e9702..5235630 100644\n--- a/fs/ext3/super.c\n+++ b/fs/ext3/super.c\n@@ -2756,23 +2756,39 @@ static int ext3_quota_on(struct super_block *sb, int type, int format_id,\n \n \tif (!test_opt(sb, QUOTA))\n \t\treturn -EINVAL;\n-\t/* Not journalling quota? */\n-\tif (!EXT3_SB(sb)->s_qf_names[USRQUOTA] &&\n-\t    !EXT3_SB(sb)->s_qf_names[GRPQUOTA])\n-\t\treturn vfs_quota_on(sb, type, format_id, path);\n+\n \terr = path_lookup(path, LOOKUP_FOLLOW, &nd);\n \tif (err)\n \t\treturn err;\n-\t/* Quotafile not on the same filesystem? */\n-\tif (nd.path.mnt->mnt_sb != sb) {\n-\t\tpath_put(&nd.path);\n-\t\treturn -EXDEV;\n+\n+\t/* Not journalling quota? */\n+\tif (EXT3_SB(sb)->s_qf_names[type]) {\n+\t\t/* Quotafile not on the same filesystem? */\n+\t\tif (nd.path.mnt->mnt_sb != sb) {\n+\t\t\tpath_put(&nd.path);\n+\t\t\treturn -EXDEV;\n+\t\t}\n+\t\t/* Quotafile not of fs root? */\n+\t\tif (nd.path.dentry->d_parent->d_inode != sb->s_root->d_inode)\n+\t\t\tprintk(KERN_WARNING\n+\t\t\t\t\"EXT3-fs: Quota file not on filesystem root. \"\n+\t\t\t\t\"Journalled quota will not work.\\n\");\n \t}\n-\t/* Quotafile not of fs root? */\n-\tif (nd.path.dentry->d_parent->d_inode != sb->s_root->d_inode)\n-\t\tprintk(KERN_WARNING\n-\t\t\t\"EXT3-fs: Quota file not on filesystem root. \"\n-\t\t\t\"Journalled quota will not work.\\n\");\n+\n+\t/*\n+\t * When we journal data on quota file, we have to flush journal to see\n+\t * all updates to the file when we bypass pagecache...\n+\t */\n+\tif (ext3_should_journal_data(nd.path.dentry->d_inode)) {\n+\t\t/*\n+\t\t * We don't need to lock updates but journal_flush() could\n+\t\t * otherwise be livelocked...\n+\t\t */\n+\t\tjournal_lock_updates(EXT3_SB(sb)->s_journal);\n+\t\tjournal_flush(EXT3_SB(sb)->s_journal);\n+\t\tjournal_unlock_updates(EXT3_SB(sb)->s_journal);\n+\t}\n+\n \tpath_put(&nd.path);\n \treturn vfs_quota_on(sb, type, format_id, path);\n }\n-- \n1.5.2.4\n\n", "diff --git a/fs/ext3/super.c b/fs/ext3/super.c\nindex cb14de1..18564eb 100644\n--- a/fs/ext3/super.c\n+++ b/fs/ext3/super.c\n@@ -2727,23 +2727,39 @@ static int ext3_quota_on(struct super_block *sb, int type, int format_id,\n \n \tif (!test_opt(sb, QUOTA))\n \t\treturn -EINVAL;\n-\t/* Not journalling quota? */\n-\tif (!EXT3_SB(sb)->s_qf_names[USRQUOTA] &&\n-\t    !EXT3_SB(sb)->s_qf_names[GRPQUOTA])\n-\t\treturn vfs_quota_on(sb, type, format_id, path);\n+\n \terr = path_lookup(path, LOOKUP_FOLLOW, &nd);\n \tif (err)\n \t\treturn err;\n-\t/* Quotafile not on the same filesystem? */\n-\tif (nd.mnt->mnt_sb != sb) {\n-\t\tpath_release(&nd);\n-\t\treturn -EXDEV;\n+\n+\t/* Not journalling quota? */\n+\tif (EXT3_SB(sb)->s_qf_names[type]) {\n+\t\t/* Quotafile not on the same filesystem? */\n+\t\tif (nd.mnt->mnt_sb != sb) {\n+\t\t\tpath_release(&nd);\n+\t\t\treturn -EXDEV;\n+\t\t}\n+\t\t/* Quotafile not of fs root? */\n+\t\tif (nd.dentry->d_parent->d_inode != sb->s_root->d_inode)\n+\t\t\tprintk(KERN_WARNING\n+\t\t\t\t\"EXT3-fs: Quota file not on filesystem root. \"\n+\t\t\t\t\"Journalled quota will not work.\\n\");\n \t}\n-\t/* Quotafile not of fs root? */\n-\tif (nd.dentry->d_parent->d_inode != sb->s_root->d_inode)\n-\t\tprintk(KERN_WARNING\n-\t\t\t\"EXT3-fs: Quota file not on filesystem root. \"\n-\t\t\t\"Journalled quota will not work.\\n\");\n+\n+\t/*\n+\t * When we journal data on quota file, we have to flush journal to see\n+\t * all updates to the file when we bypass pagecache...\n+\t */\n+\tif (ext3_should_journal_data(nd.dentry->d_inode)) {\n+\t\t/*\n+\t\t * We don't need to lock updates but journal_flush() could\n+\t\t * otherwise be livelocked...\n+\t\t */\n+\t\tjournal_lock_updates(EXT3_SB(sb)->s_journal);\n+\t\tjournal_flush(EXT3_SB(sb)->s_journal);\n+\t\tjournal_unlock_updates(EXT3_SB(sb)->s_journal);\n+\t}\n+\n \tpath_release(&nd);\n \treturn vfs_quota_on(sb, type, format_id, path);\n }\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "File System", "Classification": "Unclassified", "Component": "ext3", "Hardware": "All Linux", "Importance": "P1 low", "Assignee": "Jan Kara", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2008-04-05 23:19 UTC by Nick", "Modified": "2009-01-17 19:32 UTC", "CC List": "1 user", "See Also": "", "Kernel Version": "2.6.25", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["fs/ext3/super.c"], "methods": ["ext3_quota_on"]}
{"id": "10389", "title": "kernel 2.6.24-1 doesn't detect my laptop correctly", "description": "Latest working kernel version: 2.6.22-3\nEarliest failing kernel version: 2.6.24-1\nDistribution: debian testing (lenny)\nHardware Environment: Toshiba Satellite L40-17R laptop\nSoftware Environment: gnome\nProblem Description:\nAfter upgading to kernel 2.6.24-1 I noticed, that my system started to dump the same lines to /var/log/acpid, slowing down overall performance. Here is beginning of log:\n\n[Thu Apr  3 19:36:36 2008] starting up\n[Thu Apr  3 19:36:36 2008] 75 rules loaded\n[Thu Apr  3 19:36:40 2008] client connected from 3185[107:110]\n[Thu Apr  3 19:36:40 2008] 1 client rule loaded\n[Thu Apr  3 19:36:43 2008] received event \"hotkey ATKD 0000005f 00000000\"\n[Thu Apr  3 19:36:43 2008] notifying client 3185[107:110]\n[Thu Apr  3 19:36:43 2008] executing action \"/etc/acpi/asus-wireless.sh on\"\n[Thu Apr  3 19:36:43 2008] BEGIN HANDLER MESSAGES\n[Thu Apr  3 19:36:43 2008] END HANDLER MESSAGES\n[Thu Apr  3 19:36:43 2008] action exited with status 0\n[Thu Apr  3 19:36:43 2008] completed event \"hotkey ATKD 0000005f 00000000\"\n[Thu Apr  3 19:36:43 2008] received event \"hotkey ATKD 0000005f 00000001\"\n[Thu Apr  3 19:36:43 2008] notifying client 3185[107:110]\n[Thu Apr  3 19:36:43 2008] executing action \"/etc/acpi/asus-wireless.sh on\"\n[Thu Apr  3 19:36:43 2008] BEGIN HANDLER MESSAGES\n\n... and so on.\n\ndmesg shows correct detection of Toshiba laptop:\n\nACPI: SSDT 3F7B8CC0, 04E6 (r1  PmRef    CpuPm     3000 INTL 20051117)\nACPI: DMI detected: Toshiba\nACPI: PM-Timer IO Port: 0x808\n\nBut later it fails to determine exact model and chooses Asus:\n\nAsus Laptop ACPI Extras version 0.30\n  unsupported model T20, trying default values\n  send /proc/acpi/dsdt to the developers\n\nSteps to reproduce: Just login.", "patch": ["From: Zhang Rui <rui.zhang@intel.com>\nSubject: don't load asus-acpi if model is not supported\n\nasus_hotk_get_info should return -ENODEV if the model is not supported.\nhttp://bugzilla.kernel.org/show_bug.cgi?id=10389\n\nSigned-off-by: Zhang Rui <rui.zhang@intel.com>\n---\n drivers/acpi/asus_acpi.c |    2 ++\n 1 file changed, 2 insertions(+)\n\nIndex: linux-2.6/drivers/acpi/asus_acpi.c\n===================================================================\n--- linux-2.6.orig/drivers/acpi/asus_acpi.c\n+++ linux-2.6/drivers/acpi/asus_acpi.c\n@@ -1244,6 +1244,8 @@ static int asus_hotk_get_info(void)\n \t\t\t       \"default values\\n\", string);\n \t\t\tprintk(KERN_NOTICE\n \t\t\t       \"  send /proc/acpi/dsdt to the developers\\n\");\n+\t\t\tkfree(model);\n+\t\t\treturn -ENODEV;\n \t\t}\n \t\thotk->methods = &model_conf[hotk->model];\n \t\treturn AE_OK;\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "ACPICA-Core", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Zhang Rui", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2008-04-03 10:28 UTC by Alexei Kouznetsov", "Modified": "2008-10-24 23:05 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "2.6.24", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/acpi/asus_acpi.c"], "methods": ["asus_hotk_get_info"]}
{"id": "10246", "title": "\"in\" after successful ioperm() results in SEGV after kvm use", "description": "Latest working kernel version: N/A\nEarliest failing kernel version: 2.6.24\nDistribution: Ubuntu, but tested with mainline\nHardware Environment: intel mobo, Intel(R) Core(TM)2 Quad CPU Q6600@2.40GHz\nSoftware Environment: kvm 62 (x86_64)\nProblem Description:\n\nAfter a successful ioperm() call, otherwise valid \"in\" instructions will segv if a kvm VM has started.\n\nSteps to reproduce:\n\n1) run attached reproducer prior to starting a kvm VM, results are:\n# ./ioperm\ngetting 0x3b4-0x3df permission...\nfetching 0x3cc...\nok: 1\n\n2) start a kvm VM (bug exists only after actually starting a guest VM)\n\n3) run reproducer, which now fails:\n# ./ioperm\ngetting 0x3b4-0x3df permission...\nfetching 0x3cc...\nSegmentation fault (core dumped)\n\nNote that it does not always fail.  Running within gdb seems to reduce the chances that it will fail.  But when it does, it is clearly the \"in\" that is failing:\n\nProgram received signal SIGSEGV, Segmentation fault.\n0x00000000004006e4 in inb ()\n(gdb) x/1i $pc\n0x4006e4 <inb+12>:      in     (%dx),%al\n(gdb) info reg rdx\nrdx            0x3cc    972\n\nI have had the sense that running the CPUs at full load (niced) increases the chance for failure.", "patch": ["diff --git a/arch/x86/kvm/vmx.c b/arch/x86/kvm/vmx.c\nindex 9951ec9..9810608 100644\n--- a/arch/x86/kvm/vmx.c\n+++ b/arch/x86/kvm/vmx.c\n@@ -383,8 +383,6 @@ static void update_exception_bitmap(struct kvm_vcpu *vcpu)\n \n static void reload_tss(void)\n {\n-#ifndef CONFIG_X86_64\n-\n \t/*\n \t * VT restores TR but not its size.  Useless.\n \t */\n@@ -395,7 +393,6 @@ static void reload_tss(void)\n \tdescs = (void *)gdt.base;\n \tdescs[GDT_ENTRY_TSS].type = 9; /* available TSS */\n \tload_TR_desc();\n-#endif\n }\n \n static void load_transition_efer(struct vcpu_vmx *vmx)\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Virtualization", "Classification": "Unclassified", "Component": "kvm", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Avi Kivity", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2008-03-14 18:48 UTC by Kees Cook", "Modified": "2008-03-26 06:49 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "2.6.25-rc5", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["arch/x86/kvm/vmx.c"], "methods": ["reload_tss"]}
{"id": "10201", "title": "Yum update of Kernel broke sis900 ethernet driver", "description": "Latest working kernel version:  2.6.23.15-137.fc8.i686\nEarliest failing kernel version: 2.6.24.3-12.fc8.i686\nDistribution:  Fedora Core 8\nHardware Environment:  PC\nSoftware Environment:  Following YUM update\nProblem Description:  After reboot following YUM update to new kernel - SiS 900 PCI Fast Ethernet (driver sis900) can not ifconfig eth0.  Configuration fails with  message \"SIOCSIFFLAGS: Invalid argument\".  System does boot.  SO  To recover, insert FC8 DVD and copy original kernel RPM's to the hard drive.  Then install the old Kernel with \"rpm -ivh --force --hash *.rpm\" and reboot.  System comes up and configures the sis900 eth0 correctly at startup.\n\nSteps to reproduce:  A machine with a SiS 900 PCI Fast Ethernet installed.  INstall RC8 and apply the updates.  After 2.6.24.3, reboot and notice the trouble.\n\n\nDan", "patch": ["--- a/drivers/net/sis900.c\t2008-12-31 09:15:17.000000000 +0100\n+++ b/drivers/net/sis900.c\t2008-12-31 09:24:47.000000000 +0100\n@@ -382,6 +382,25 @@ static int __devinit sis96x_get_mac_addr\n }\n \n /**\n+ *      sis900_check_mac_addr - Check the MAc adress for validity\n+ *\t@net_dev: the net device that has the address to check\n+ *\n+ * \tReturn false (0) if the mac address read from the hardware is\n+ * \tcomposed of all zeros.\n+ */\n+\n+static int __devinit sis900_check_mac_addr(struct net_device *net_dev)\n+{\n+\tint i;\n+\n+\tfor (i = 0; i < 6; i++)\n+\t\tif (net_dev->dev_addr[i] != 0)\n+\t\t\treturn 1;\n+\n+\treturn 0;\n+}\n+\n+/**\n  *\tsis900_probe - Probe for sis900 device\n  *\t@pci_dev: the sis900 pci device\n  *\t@pci_id: the pci device ID\n@@ -504,6 +523,9 @@ static int __devinit sis900_probe(struct\n \telse\n \t\tret = sis900_get_mac_addr(pci_dev, net_dev);\n \n+\tif (sis900_check_mac_addr(net_dev) == 0)\n+\t\tprintk(KERN_WARNING \"%s: Read an invalid MAC address, remember to set one manually\\n\", dev_name);\n+\n \tif (ret == 0) {\n \t\tprintk(KERN_WARNING \"%s: Cannot read MAC address.\\n\", dev_name);\n \t\tret = -ENODEV;\n"], "Status": "CLOSED CODE_FIX", "Alias": "ETH0_sis900_Trouble", "Product": "Drivers", "Classification": "Unclassified", "Component": "Network", "Hardware": "All Linux", "Importance": "P1 blocking", "Assignee": "Daniele Venzano", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2008-03-08 15:36 UTC by Dan McNaul", "Modified": "2008-12-31 00:39 UTC", "CC List": "3 users", "See Also": "", "Kernel Version": "2.6.24", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/net/sis900.c"], "methods": ["sis900_probe"]}
{"id": "10077", "title": "nozomi (driver for Qualcomm 3G PCMCIA adapter) crashes", "description": "Earliest failing kernel version: 2.6.23 with gregkh patches\nDistribution: Gentoo Linux\nHardware Environment: Option N.V. Qualcomm MSM6275 UMTS chip [1931:000c]\n\nProblem Description:\n\nWhen I boot my system with the Option card inserted I get the following in my syslog:\n\npccard: CardBus card inserted into slot 0\nInitializing Nozomi driver 2.1d (build date: Feb 22 2008 21:34:48)\nnozomi 0000:03:00.0: Init, new card found\nnozomi 0000:03:00.0: Card type is: 2048\nPCI: Enabling device 0000:03:00.0 (0000 -> 0002)\nACPI: PCI Interrupt 0000:03:00.0[A] -> GSI 18 (level, low) -> IRQ 18\n------------[ cut here ]------------\nWARNING: at arch/x86/mm/ioremap.c:137 __ioremap+0x1c2/0x1e3()\nModules linked in: nozomi(+) evdev isofs zlib_inflate loop yenta_socket rsrc_nonstatic pcmcia pcmcia_core firewire_ohci firewire_core crc_itu_t arc4 ecb ohci1394 ieee1394 snd_hda_intel snd_pcm snd_timer snd soundcore sdhci snd_page_alloc mmc_core tifm_7xx1 hci_usb tifm_core iwl3945 mac80211 bluetooth cfg80211 tpm_infineon tpm tpm_bios tg3 sg psmouse\nPid: 3480, comm: modprobe Not tainted 2.6.25-rc2-git6 #1\n [<c01249ea>] warn_on_slowpath+0x4e/0x5e\n [<c0258d1d>] ? acpi_pci_allocate_irq+0x65/0x6f\n [<c012a282>] ? __request_region+0x6a/0xa0\n [<c021f549>] ? pci_request_region+0x81/0x21a\n [<c0116619>] __ioremap+0x1c2/0x1e3\n [<c021f82d>] ? pci_request_selected_regions+0x32/0x67\n [<c0116653>] ioremap_nocache+0xa/0xc\n [<f8eb5023>] nozomi_card_init+0x209/0x642 [nozomi]\n [<c0180f8b>] ? find_inode+0x3a/0x64\n [<c01acbc0>] ? sysfs_ilookup_test+0x0/0x11\n [<c01acbc0>] ? sysfs_ilookup_test+0x0/0x11\n [<c0181076>] ? ifind+0x2a/0x88\n [<c01acbc0>] ? sysfs_ilookup_test+0x0/0x11\n [<c01ad12d>] ? sysfs_addrm_finish+0x16/0x1b8\n [<c01aced1>] ? sysfs_add_one+0x3e/0x8f\n [<c01acf6d>] ? sysfs_addrm_start+0x4b/0x87\n [<c022155a>] ? pci_match_device+0xa1/0xa9\n [<c0221622>] pci_device_probe+0x44/0x5f\n [<c0282c04>] driver_probe_device+0x81/0x157\n [<c0282e0d>] __driver_attach+0x8c/0x8e\n [<c02820f8>] bus_for_each_dev+0x41/0x5f\n [<c0282ab3>] driver_attach+0x19/0x1b\n [<c0282d81>] ? __driver_attach+0x0/0x8e\n [<c028297a>] bus_add_driver+0x1a5/0x20b\n [<c022158d>] ? pci_device_remove+0x0/0x3a\n [<c0282f9f>] driver_register+0x3d/0xe9\n [<c01720d3>] ? cdev_add+0x31/0x33\n [<c0374b42>] ? mutex_lock+0xe/0x20\n [<c0171f8c>] ? exact_lock+0x0/0x11\n [<c0221800>] __pci_register_driver+0x35/0x65\n [<f8d160e2>] nozomi_init+0xe2/0x100 [nozomi]\n [<c014493c>] sys_init_module+0x119/0x1bef\n [<c0280b0c>] ? device_remove_file+0x0/0x11\n [<c016fba2>] ? rw_verify_area+0x5a/0xb9\n [<c0170748>] ? sys_read+0x3d/0x64\n [<c0103f1a>] sysenter_past_esp+0x5f/0x85\n =======================\n---[ end trace f44e4108df509696 ]---\n\nI also tried removing the module (modprobe -r), loading it again (with the card still inserted) and then running a perl script that sends some data to the /dev/noz0 port. Here's what I get in my kernel log then:\n\nUnloading Nozomi driver\npccard: CardBus card inserted into slot 0\nInitializing Nozomi driver 2.1d (build date: Feb 22 2008 21:34:48)\nnozomi 0000:03:00.0: Init, new card found\nnozomi 0000:03:00.0: Card type is: 2048\nPCI: Enabling device 0000:03:00.0 (0000 -> 0002)\nACPI: PCI Interrupt 0000:03:00.0[A] -> GSI 18 (level, low) -> IRQ 18\nBUG: unable to handle kernel NULL pointer dereference at 00000008\nIP: [<f8eb3c1b>] :nozomi:ntty_write_room+0x5a/0x6e\n*pdpt = 0000000030c8e001 *pde = 0000000000000000 \nOops: 0000 [#1] SMP \nModules linked in: nozomi sit tunnel4 aes_i586 aes_generic tun ipv6 bridge llc snd_seq snd_seq_device snd_pcm_oss snd_mixer_oss snd_indigoio fuse evdev isofs zlib_inflate loop yenta_socket rsrc_nonstatic pcmcia pcmcia_core firewire_ohci firewire_core crc_itu_t arc4 ecb ohci1394 ieee1394 snd_hda_intel snd_pcm snd_timer snd soundcore sdhci snd_page_alloc mmc_core tifm_7xx1 hci_usb tifm_core iwl3945 mac80211 bluetooth cfg80211 tpm_infineon tpm tpm_bios tg3 sg psmouse [last unloaded: nozomi]\n\nPid: 13425, comm: perl Not tainted (2.6.25-rc2-git6 #1)\nEIP: 0060:[<f8eb3c1b>] EFLAGS: 00010202 CPU: 0\nEIP is at ntty_write_room+0x5a/0x6e [nozomi]\nEAX: 00000000 EBX: f287d060 ECX: 00000000 EDX: 00000001\nESI: 00000000 EDI: f287d09c EBP: f1bf8efc ESP: f1bf8ef0\n DS: 007b ES: 007b FS: 00d8 GS: 0033 SS: 0068\nProcess perl (pid: 13425, ti=f1bf8000 task=f1c74e00 task.ti=f1bf8000)\nStack: 0000000f 0000000f f1c33000 f1bf8f38 c026c0e5 f1c33c00 f2358840 f1c33130 \n       f1c33c00 f1bf8f38 00000000 f1c74e00 c011d086 f1c33134 f1c33134 0000000f \n       f1c33000 f2358840 f1bf8f6c c0269ac7 0000000f 0000000f 08872980 c026bfeb \nCall Trace:\n [<c026c0e5>] ? write_chan+0xfa/0x304\n [<c011d086>] ? default_wake_function+0x0/0xd\n [<c0269ac7>] ? tty_write+0x11c/0x1a7\n [<c026bfeb>] ? write_chan+0x0/0x304\n [<c01701c2>] ? vfs_write+0x8b/0x11f\n [<c02699ab>] ? tty_write+0x0/0x1a7\n [<c01707ac>] ? sys_write+0x3d/0x64\n [<c0103f1a>] ? sysenter_past_esp+0x5f/0x85\n [<c0370000>] ? init_centaur+0x1a9/0x2e9\n =======================\nCode: f5 0e 4c c7 85 c0 74 17 31 f6 8b 43 38 85 c0 75 17 89 f8 e8 d2 0e 4c c7 89 f0 5b 5e 5f 5d c3 31 f6 89 f0 5b 5e 5f 5d c3 8b 43 08 <8b> 50 08 2b 50 0c 8b 70 04 29 d6 89 f8 e8 ad 0e 4c c7 eb d9 55 \nEIP: [<f8eb3c1b>] ntty_write_room+0x5a/0x6e [nozomi] SS:ESP 0068:f1bf8ef0\n---[ end trace f44e4108df509696 ]---", "patch": ["From: Frank Seidel <fseidel@suse.de>\nSubject: nozomi: cleanups, improved locking and device initialization\n\n- added trivial state machine for device state (fixes oopses on\n  too early access to tty devices)\n- minor further initialization cleanup and write check\n- pci (ordering) cleanup\n- fix new locking extension\n- enhance locking and check return of copy_to_user\n- increased version to mark next step development begins here,\n  transition from old i/o memory fonction to new ioread/iowrite\n  fucntions\n\nSigned-off-by: Frank Seidel <fseidel@suse.de>\n---\n drivers/char/nozomi.c |  176 ++++++++++++++++++++++++++++---------------------\n 1 files changed, 101 insertions(+), 75 deletions(-)\n\ndiff --git a/drivers/char/nozomi.c b/drivers/char/nozomi.c\nindex dfaab23..688a7fe 100644\n--- a/drivers/char/nozomi.c\n+++ b/drivers/char/nozomi.c\n@@ -59,7 +59,7 @@\n #include <linux/delay.h>\n \n \n-#define VERSION_STRING DRIVER_DESC \" 2.1d (build date: \" \\\n+#define VERSION_STRING DRIVER_DESC \" 2.1e (build date: \" \\\n \t\t\t\t\t__DATE__ \" \" __TIME__ \")\"\n \n /*    Macros definitions */\n@@ -179,6 +179,11 @@ static int debug;\n #define NOZOMI_MAX_PORTS\t5\n #define NOZOMI_MAX_CARDS\t(NTTY_TTY_MAXMINORS / MAX_PORT)\n \n+#define NOZOMI_STATE_UKNOWN\t0\n+#define NOZOMI_STATE_ENABLED\t1\t/* pci device enabled */\n+#define NOZOMI_STATE_ALLOCATED\t2\t/* config setup */\n+#define NOZOMI_STATE_READY\t3\t/* flowcontrols received */\n+\n /*    Type definitions */\n \n /*\n@@ -385,6 +390,7 @@ struct nozomi {\n \tspinlock_t spin_mutex;\t/* secures access to registers and tty */\n \n \tunsigned int index_start;\n+\tunsigned int state;\n \tu32 open_ttys;\n };\n \n@@ -397,7 +403,7 @@ struct buffer {\n /*    Global variables */\n static const struct pci_device_id nozomi_pci_tbl[] __devinitconst = {\n \t{PCI_DEVICE(VENDOR1, DEVICE1)},\n-\t{},\n+\t{0,},\n };\n \n MODULE_DEVICE_TABLE(pci, nozomi_pci_tbl);\n@@ -439,11 +445,11 @@ static void read_mem32(u32 *buf, const void __iomem *mem_addr_start,\n \tswitch (size_bytes) {\n \tcase 2:\t/* 2 bytes */\n \t\tbuf16 = (u16 *) buf;\n-\t\t*buf16 = __le16_to_cpu(readw((void __iomem *)ptr));\n+\t\t*buf16 = __le16_to_cpu(ioread16((void __iomem *)ptr));\n \t\tgoto out;\n \t\tbreak;\n \tcase 4:\t/* 4 bytes */\n-\t\t*(buf) = __le32_to_cpu(readl((void __iomem *)ptr));\n+\t\t*(buf) = __le32_to_cpu(ioread32((void __iomem *)ptr));\n \t\tgoto out;\n \t\tbreak;\n \t}\n@@ -452,11 +458,11 @@ static void read_mem32(u32 *buf, const void __iomem *mem_addr_start,\n \t\tif (size_bytes - i == 2) {\n \t\t\t/* Handle 2 bytes in the end */\n \t\t\tbuf16 = (u16 *) buf;\n-\t\t\t*(buf16) = __le16_to_cpu(readw((void __iomem *)ptr));\n+\t\t\t*(buf16) = __le16_to_cpu(ioread16((void __iomem *)ptr));\n \t\t\ti += 2;\n \t\t} else {\n \t\t\t/* Read 4 bytes */\n-\t\t\t*(buf) = __le32_to_cpu(readl((void __iomem *)ptr));\n+\t\t\t*(buf) = __le32_to_cpu(ioread32((void __iomem *)ptr));\n \t\t\ti += 4;\n \t\t}\n \t\tbuf++;\n@@ -485,7 +491,7 @@ static u32 write_mem32(void __iomem *mem_addr_start, const u32 *buf,\n \tswitch (size_bytes) {\n \tcase 2:\t/* 2 bytes */\n \t\tbuf16 = (const u16 *)buf;\n-\t\twritew(__cpu_to_le16(*buf16), (void __iomem *)ptr);\n+\t\tiowrite16(__cpu_to_le16(*buf16), (void __iomem *)ptr);\n \t\treturn 2;\n \t\tbreak;\n \tcase 1: /*\n@@ -493,7 +499,7 @@ static u32 write_mem32(void __iomem *mem_addr_start, const u32 *buf,\n \t\t * so falling through..\n \t\t */\n \tcase 4: /* 4 bytes */\n-\t\twritel(__cpu_to_le32(*buf), (void __iomem *)ptr);\n+\t\tiowrite32(__cpu_to_le32(*buf), (void __iomem *)ptr);\n \t\treturn 4;\n \t\tbreak;\n \t}\n@@ -502,11 +508,11 @@ static u32 write_mem32(void __iomem *mem_addr_start, const u32 *buf,\n \t\tif (size_bytes - i == 2) {\n \t\t\t/* 2 bytes */\n \t\t\tbuf16 = (const u16 *)buf;\n-\t\t\twritew(__cpu_to_le16(*buf16), (void __iomem *)ptr);\n+\t\t\tiowrite16(__cpu_to_le16(*buf16), (void __iomem *)ptr);\n \t\t\ti += 2;\n \t\t} else {\n \t\t\t/* 4 bytes */\n-\t\t\twritel(__cpu_to_le32(*buf), (void __iomem *)ptr);\n+\t\t\tiowrite32(__cpu_to_le32(*buf), (void __iomem *)ptr);\n \t\t\ti += 4;\n \t\t}\n \t\tbuf++;\n@@ -684,8 +690,9 @@ static int nozomi_read_config_table(struct nozomi *dc)\n \n \t\t/* Enable control channel */\n \t\tdc->last_ier = dc->last_ier | CTRL_DL;\n-\t\twritew(dc->last_ier, dc->reg_ier);\n+\t\tiowrite16(dc->last_ier, dc->reg_ier);\n \n+\t\tdc->state = NOZOMI_STATE_ALLOCATED;\n \t\tdev_info(&dc->pdev->dev, \"Initialization OK!\\n\");\n \t\treturn 1;\n \t}\n@@ -712,7 +719,7 @@ static int nozomi_read_config_table(struct nozomi *dc)\n \t\twrite_mem32(dc->port[PORT_MDM].ul_addr[CH_B],\n \t\t\t(u32 *) &offset, 4);\n \n-\t\twritew(MDM_UL | DIAG_DL | MDM_DL, dc->reg_fcr);\n+\t\tiowrite16(MDM_UL | DIAG_DL | MDM_DL, dc->reg_fcr);\n \n \t\tDBG1(\"First phase done\");\n \t}\n@@ -727,7 +734,7 @@ static void enable_transmit_ul(enum port_type port, struct nozomi *dc)\n \n \tif (port < NOZOMI_MAX_PORTS) {\n \t\tdc->last_ier |= mask[port];\n-\t\twritew(dc->last_ier, dc->reg_ier);\n+\t\tiowrite16(dc->last_ier, dc->reg_ier);\n \t} else {\n \t\tdev_err(&dc->pdev->dev, \"Called with wrong port?\\n\");\n \t}\n@@ -741,7 +748,7 @@ static void disable_transmit_ul(enum port_type port, struct nozomi *dc)\n \n \tif (port < NOZOMI_MAX_PORTS) {\n \t\tdc->last_ier &= mask[port];\n-\t\twritew(dc->last_ier, dc->reg_ier);\n+\t\tiowrite16(dc->last_ier, dc->reg_ier);\n \t} else {\n \t\tdev_err(&dc->pdev->dev, \"Called with wrong port?\\n\");\n \t}\n@@ -754,7 +761,7 @@ static void enable_transmit_dl(enum port_type port, struct nozomi *dc)\n \n \tif (port < NOZOMI_MAX_PORTS) {\n \t\tdc->last_ier |= mask[port];\n-\t\twritew(dc->last_ier, dc->reg_ier);\n+\t\tiowrite16(dc->last_ier, dc->reg_ier);\n \t} else {\n \t\tdev_err(&dc->pdev->dev, \"Called with wrong port?\\n\");\n \t}\n@@ -768,7 +775,7 @@ static void disable_transmit_dl(enum port_type port, struct nozomi *dc)\n \n \tif (port < NOZOMI_MAX_PORTS) {\n \t\tdc->last_ier &= mask[port];\n-\t\twritew(dc->last_ier, dc->reg_ier);\n+\t\tiowrite16(dc->last_ier, dc->reg_ier);\n \t} else {\n \t\tdev_err(&dc->pdev->dev, \"Called with wrong port?\\n\");\n \t}\n@@ -944,6 +951,14 @@ static int receive_flow_control(struct nozomi *dc)\n \tcase CTRL_APP2:\n \t\tport = PORT_APP2;\n \t\tenable_ier = APP2_DL;\n+\t\tif (dc->state == NOZOMI_STATE_ALLOCATED) {\n+\t\t\t/*\n+\t\t\t * After card initialization the flow control\n+\t\t\t * received for APP2 is always the last\n+\t\t\t */\n+\t\t\tdc->state = NOZOMI_STATE_READY;\n+\t\t\tdev_info(&dc->pdev->dev, \"Device READY!\\n\");\n+\t\t}\n \t\tbreak;\n \tdefault:\n \t\tdev_err(&dc->pdev->dev,\n@@ -1056,25 +1071,25 @@ static int handle_data_dl(struct nozomi *dc, enum port_type port, u8 *toggle,\n {\n \tif (*toggle == 0 && read_iir & mask1) {\n \t\tif (receive_data(port, dc)) {\n-\t\t\twritew(mask1, dc->reg_fcr);\n+\t\t\tiowrite16(mask1, dc->reg_fcr);\n \t\t\t*toggle = !(*toggle);\n \t\t}\n \n \t\tif (read_iir & mask2) {\n \t\t\tif (receive_data(port, dc)) {\n-\t\t\t\twritew(mask2, dc->reg_fcr);\n+\t\t\t\tiowrite16(mask2, dc->reg_fcr);\n \t\t\t\t*toggle = !(*toggle);\n \t\t\t}\n \t\t}\n \t} else if (*toggle == 1 && read_iir & mask2) {\n \t\tif (receive_data(port, dc)) {\n-\t\t\twritew(mask2, dc->reg_fcr);\n+\t\t\tiowrite16(mask2, dc->reg_fcr);\n \t\t\t*toggle = !(*toggle);\n \t\t}\n \n \t\tif (read_iir & mask1) {\n \t\t\tif (receive_data(port, dc)) {\n-\t\t\t\twritew(mask1, dc->reg_fcr);\n+\t\t\t\tiowrite16(mask1, dc->reg_fcr);\n \t\t\t\t*toggle = !(*toggle);\n \t\t\t}\n \t\t}\n@@ -1097,47 +1112,47 @@ static int handle_data_ul(struct nozomi *dc, enum port_type port, u16 read_iir)\n \n \tif (*toggle == 0 && read_iir & MDM_UL1) {\n \t\tdc->last_ier &= ~MDM_UL;\n-\t\twritew(dc->last_ier, dc->reg_ier);\n+\t\tiowrite16(dc->last_ier, dc->reg_ier);\n \t\tif (send_data(port, dc)) {\n-\t\t\twritew(MDM_UL1, dc->reg_fcr);\n+\t\t\tiowrite16(MDM_UL1, dc->reg_fcr);\n \t\t\tdc->last_ier = dc->last_ier | MDM_UL;\n-\t\t\twritew(dc->last_ier, dc->reg_ier);\n+\t\t\tiowrite16(dc->last_ier, dc->reg_ier);\n \t\t\t*toggle = !*toggle;\n \t\t}\n \n \t\tif (read_iir & MDM_UL2) {\n \t\t\tdc->last_ier &= ~MDM_UL;\n-\t\t\twritew(dc->last_ier, dc->reg_ier);\n+\t\t\tiowrite16(dc->last_ier, dc->reg_ier);\n \t\t\tif (send_data(port, dc)) {\n-\t\t\t\twritew(MDM_UL2, dc->reg_fcr);\n+\t\t\t\tiowrite16(MDM_UL2, dc->reg_fcr);\n \t\t\t\tdc->last_ier = dc->last_ier | MDM_UL;\n-\t\t\t\twritew(dc->last_ier, dc->reg_ier);\n+\t\t\t\tiowrite16(dc->last_ier, dc->reg_ier);\n \t\t\t\t*toggle = !*toggle;\n \t\t\t}\n \t\t}\n \n \t} else if (*toggle == 1 && read_iir & MDM_UL2) {\n \t\tdc->last_ier &= ~MDM_UL;\n-\t\twritew(dc->last_ier, dc->reg_ier);\n+\t\tiowrite16(dc->last_ier, dc->reg_ier);\n \t\tif (send_data(port, dc)) {\n-\t\t\twritew(MDM_UL2, dc->reg_fcr);\n+\t\t\tiowrite16(MDM_UL2, dc->reg_fcr);\n \t\t\tdc->last_ier = dc->last_ier | MDM_UL;\n-\t\t\twritew(dc->last_ier, dc->reg_ier);\n+\t\t\tiowrite16(dc->last_ier, dc->reg_ier);\n \t\t\t*toggle = !*toggle;\n \t\t}\n \n \t\tif (read_iir & MDM_UL1) {\n \t\t\tdc->last_ier &= ~MDM_UL;\n-\t\t\twritew(dc->last_ier, dc->reg_ier);\n+\t\t\tiowrite16(dc->last_ier, dc->reg_ier);\n \t\t\tif (send_data(port, dc)) {\n-\t\t\t\twritew(MDM_UL1, dc->reg_fcr);\n+\t\t\t\tiowrite16(MDM_UL1, dc->reg_fcr);\n \t\t\t\tdc->last_ier = dc->last_ier | MDM_UL;\n-\t\t\t\twritew(dc->last_ier, dc->reg_ier);\n+\t\t\t\tiowrite16(dc->last_ier, dc->reg_ier);\n \t\t\t\t*toggle = !*toggle;\n \t\t\t}\n \t\t}\n \t} else {\n-\t\twritew(read_iir & MDM_UL, dc->reg_fcr);\n+\t\tiowrite16(read_iir & MDM_UL, dc->reg_fcr);\n \t\tdev_err(&dc->pdev->dev, \"port out of sync!\\n\");\n \t\treturn 0;\n \t}\n@@ -1154,7 +1169,7 @@ static irqreturn_t interrupt_handler(int irq, void *dev_id)\n \t\treturn IRQ_NONE;\n \n \tspin_lock(&dc->spin_mutex);\n-\tread_iir = readw(dc->reg_iir);\n+\tread_iir = ioread16(dc->reg_iir);\n \n \t/* Card removed */\n \tif (read_iir == (u16)-1)\n@@ -1175,11 +1190,11 @@ static irqreturn_t interrupt_handler(int irq, void *dev_id)\n \tif (read_iir & RESET) {\n \t\tif (unlikely(!nozomi_read_config_table(dc))) {\n \t\t\tdc->last_ier = 0x0;\n-\t\t\twritew(dc->last_ier, dc->reg_ier);\n+\t\t\tiowrite16(dc->last_ier, dc->reg_ier);\n \t\t\tdev_err(&dc->pdev->dev, \"Could not read status from \"\n \t\t\t\t\"card, we should disable interface\\n\");\n \t\t} else {\n-\t\t\twritew(RESET, dc->reg_fcr);\n+\t\t\tiowrite16(RESET, dc->reg_fcr);\n \t\t}\n \t\t/* No more useful info if this was the reset interrupt. */\n \t\tgoto exit_handler;\n@@ -1187,16 +1202,16 @@ static irqreturn_t interrupt_handler(int irq, void *dev_id)\n \tif (read_iir & CTRL_UL) {\n \t\tDBG1(\"CTRL_UL\");\n \t\tdc->last_ier &= ~CTRL_UL;\n-\t\twritew(dc->last_ier, dc->reg_ier);\n+\t\tiowrite16(dc->last_ier, dc->reg_ier);\n \t\tif (send_flow_control(dc)) {\n-\t\t\twritew(CTRL_UL, dc->reg_fcr);\n+\t\t\tiowrite16(CTRL_UL, dc->reg_fcr);\n \t\t\tdc->last_ier = dc->last_ier | CTRL_UL;\n-\t\t\twritew(dc->last_ier, dc->reg_ier);\n+\t\t\tiowrite16(dc->last_ier, dc->reg_ier);\n \t\t}\n \t}\n \tif (read_iir & CTRL_DL) {\n \t\treceive_flow_control(dc);\n-\t\twritew(CTRL_DL, dc->reg_fcr);\n+\t\tiowrite16(CTRL_DL, dc->reg_fcr);\n \t}\n \tif (read_iir & MDM_DL) {\n \t\tif (!handle_data_dl(dc, PORT_MDM,\n@@ -1222,37 +1237,37 @@ static irqreturn_t interrupt_handler(int irq, void *dev_id)\n \t}\n \tif (read_iir & DIAG_UL) {\n \t\tdc->last_ier &= ~DIAG_UL;\n-\t\twritew(dc->last_ier, dc->reg_ier);\n+\t\tiowrite16(dc->last_ier, dc->reg_ier);\n \t\tif (send_data(PORT_DIAG, dc)) {\n-\t\t\twritew(DIAG_UL, dc->reg_fcr);\n+\t\t\tiowrite16(DIAG_UL, dc->reg_fcr);\n \t\t\tdc->last_ier = dc->last_ier | DIAG_UL;\n-\t\t\twritew(dc->last_ier, dc->reg_ier);\n+\t\t\tiowrite16(dc->last_ier, dc->reg_ier);\n \t\t}\n \t}\n \tif (read_iir & APP1_DL) {\n \t\tif (receive_data(PORT_APP1, dc))\n-\t\t\twritew(APP1_DL, dc->reg_fcr);\n+\t\t\tiowrite16(APP1_DL, dc->reg_fcr);\n \t}\n \tif (read_iir & APP1_UL) {\n \t\tdc->last_ier &= ~APP1_UL;\n-\t\twritew(dc->last_ier, dc->reg_ier);\n+\t\tiowrite16(dc->last_ier, dc->reg_ier);\n \t\tif (send_data(PORT_APP1, dc)) {\n-\t\t\twritew(APP1_UL, dc->reg_fcr);\n+\t\t\tiowrite16(APP1_UL, dc->reg_fcr);\n \t\t\tdc->last_ier = dc->last_ier | APP1_UL;\n-\t\t\twritew(dc->last_ier, dc->reg_ier);\n+\t\t\tiowrite16(dc->last_ier, dc->reg_ier);\n \t\t}\n \t}\n \tif (read_iir & APP2_DL) {\n \t\tif (receive_data(PORT_APP2, dc))\n-\t\t\twritew(APP2_DL, dc->reg_fcr);\n+\t\t\tiowrite16(APP2_DL, dc->reg_fcr);\n \t}\n \tif (read_iir & APP2_UL) {\n \t\tdc->last_ier &= ~APP2_UL;\n-\t\twritew(dc->last_ier, dc->reg_ier);\n+\t\tiowrite16(dc->last_ier, dc->reg_ier);\n \t\tif (send_data(PORT_APP2, dc)) {\n-\t\t\twritew(APP2_UL, dc->reg_fcr);\n+\t\t\tiowrite16(APP2_UL, dc->reg_fcr);\n \t\t\tdc->last_ier = dc->last_ier | APP2_UL;\n-\t\t\twritew(dc->last_ier, dc->reg_ier);\n+\t\t\tiowrite16(dc->last_ier, dc->reg_ier);\n \t\t}\n \t}\n \n@@ -1366,22 +1381,12 @@ static int __devinit nozomi_card_init(struct pci_dev *pdev,\n \n \tdc->pdev = pdev;\n \n-\t/* Find out what card type it is */\n-\tnozomi_get_card_type(dc);\n-\n \tret = pci_enable_device(dc->pdev);\n \tif (ret) {\n \t\tdev_err(&pdev->dev, \"Failed to enable PCI Device\\n\");\n \t\tgoto err_free;\n \t}\n \n-\tstart = pci_resource_start(dc->pdev, 0);\n-\tif (start == 0) {\n-\t\tdev_err(&pdev->dev, \"No I/O address for card detected\\n\");\n-\t\tret = -ENODEV;\n-\t\tgoto err_disable_device;\n-\t}\n-\n \tret = pci_request_regions(dc->pdev, NOZOMI_NAME);\n \tif (ret) {\n \t\tdev_err(&pdev->dev, \"I/O address 0x%04x already in use\\n\",\n@@ -1389,6 +1394,16 @@ static int __devinit nozomi_card_init(struct pci_dev *pdev,\n \t\tgoto err_disable_device;\n \t}\n \n+\tstart = pci_resource_start(dc->pdev, 0);\n+\tif (start == 0) {\n+\t\tdev_err(&pdev->dev, \"No I/O address for card detected\\n\");\n+\t\tret = -ENODEV;\n+\t\tgoto err_rel_regs;\n+\t}\n+\n+\t/* Find out what card type it is */\n+\tnozomi_get_card_type(dc);\n+\n \tdc->base_addr = ioremap(start, dc->card_type);\n \tif (!dc->base_addr) {\n \t\tdev_err(&pdev->dev, \"Unable to map card MMIO\\n\");\n@@ -1407,9 +1422,13 @@ static int __devinit nozomi_card_init(struct pci_dev *pdev,\n \n \tnozomi_setup_private_data(dc);\n \n-\t/* Disable all interrupts */\n+\t/* Disable all interrupts and check write */\n \tdc->last_ier = 0;\n-\twritew(dc->last_ier, dc->reg_ier);\n+\tiowrite16(dc->last_ier, dc->reg_ier);\n+\tif (ioread16(dc->reg_ier) != dc->last_ier) {\n+\t\tdev_err(&pdev->dev, \"Consistency check failed.\\n\");\n+\t\tgoto err_free_sbuf;\n+\t}\n \n \tret = request_irq(pdev->irq, &interrupt_handler, IRQF_SHARED,\n \t\t\tNOZOMI_NAME, dc);\n@@ -1425,6 +1444,14 @@ static int __devinit nozomi_card_init(struct pci_dev *pdev,\n \tdc->index_start = ndev_idx * MAX_PORT;\n \tndevs[ndev_idx] = dc;\n \n+\tpci_set_drvdata(pdev, dc);\n+\n+\t/* Enable RESET interrupt */\n+\tdc->last_ier = RESET;\n+\tiowrite16(dc->last_ier, dc->reg_ier);\n+\n+\tdc->state = NOZOMI_STATE_ENABLED;\n+\n \tfor (i = 0; i < MAX_PORT; i++) {\n \t\tmutex_init(&dc->port[i].tty_sem);\n \t\tdc->port[i].tty_open_count = 0;\n@@ -1433,12 +1460,6 @@ static int __devinit nozomi_card_init(struct pci_dev *pdev,\n \t\t\t\t\t\t\t&pdev->dev);\n \t}\n \n-\t/* Enable  RESET interrupt. */\n-\tdc->last_ier = RESET;\n-\twritew(dc->last_ier, dc->reg_ier);\n-\n-\tpci_set_drvdata(pdev, dc);\n-\n \treturn 0;\n \n err_free_sbuf:\n@@ -1483,7 +1504,7 @@ static void __devexit nozomi_card_exit(struct pci_dev *pdev)\n \n \t/* Disable all interrupts */\n \tdc->last_ier = 0;\n-\twritew(dc->last_ier, dc->reg_ier);\n+\tiowrite16(dc->last_ier, dc->reg_ier);\n \n \ttty_exit(dc);\n \n@@ -1497,7 +1518,7 @@ static void __devexit nozomi_card_exit(struct pci_dev *pdev)\n \n \t/* Setup dc->reg addresses to we can use defines here */\n \twrite_mem32(dc->port[PORT_CTRL].ul_addr[0], (u32 *)&ctrl, 2);\n-\twritew(CTRL_UL, dc->reg_fcr);\t/* push the token to the card. */\n+\tiowrite16(CTRL_UL, dc->reg_fcr);\t/* push the token to the card */\n \n \tremove_sysfs_files(dc);\n \n@@ -1553,7 +1574,7 @@ static int ntty_open(struct tty_struct *tty, struct file *file)\n \tstruct nozomi *dc = get_dc_by_tty(tty);\n \tunsigned long flags;\n \n-\tif (!port || !dc)\n+\tif (!port || !dc || dc->state != NOZOMI_STATE_READY)\n \t\treturn -ENODEV;\n \n \tif (mutex_lock_interruptible(&port->tty_sem))\n@@ -1570,7 +1591,7 @@ static int ntty_open(struct tty_struct *tty, struct file *file)\n \t\tDBG1(\"open: %d\", port->token_dl);\n \t\tspin_lock_irqsave(&dc->spin_mutex, flags);\n \t\tdc->last_ier = dc->last_ier | port->token_dl;\n-\t\twritew(dc->last_ier, dc->reg_ier);\n+\t\tiowrite16(dc->last_ier, dc->reg_ier);\n \t\tspin_unlock_irqrestore(&dc->spin_mutex, flags);\n \t}\n \n@@ -1602,7 +1623,7 @@ static void ntty_close(struct tty_struct *tty, struct file *file)\n \t\tDBG1(\"close: %d\", port->token_dl);\n \t\tspin_lock_irqsave(&dc->spin_mutex, flags);\n \t\tdc->last_ier &= ~(port->token_dl);\n-\t\twritew(dc->last_ier, dc->reg_ier);\n+\t\tiowrite16(dc->last_ier, dc->reg_ier);\n \t\tspin_unlock_irqrestore(&dc->spin_mutex, flags);\n \t}\n \n@@ -1716,6 +1737,10 @@ static int ntty_tiocmget(struct tty_struct *tty, struct file *file)\n static int ntty_tiocmset(struct tty_struct *tty, struct file *file,\n \tunsigned int set, unsigned int clear)\n {\n+\tstruct nozomi *dc = get_dc_by_tty(tty);\n+\tunsigned long flags;\n+\n+\tspin_lock_irqsave(&dc->spin_mutex, flags);\n \tif (set & TIOCM_RTS)\n \t\tset_rts(tty, 1);\n \telse if (clear & TIOCM_RTS)\n@@ -1725,6 +1750,7 @@ static int ntty_tiocmset(struct tty_struct *tty, struct file *file,\n \t\tset_dtr(tty, 1);\n \telse if (clear & TIOCM_DTR)\n \t\tset_dtr(tty, 0);\n+\tspin_unlock_irqrestore(&dc->spin_mutex, flags);\n \n \treturn 0;\n }\n@@ -1762,7 +1788,7 @@ static int ntty_ioctl_tiocgicount(struct port *port, void __user *argp)\n \ticount.brk = cnow.brk;\n \ticount.buf_overrun = cnow.buf_overrun;\n \n-\treturn copy_to_user(argp, &icount, sizeof(icount));\n+\treturn copy_to_user(argp, &icount, sizeof(icount)) ? -EFAULT : 0;\n }\n \n static int ntty_ioctl(struct tty_struct *tty, struct file *file,\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "PCMCIA", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Frank Seidel", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2008-02-23 13:29 UTC by Antek Grzymala", "Modified": "2008-04-19 15:22 UTC", "CC List": "1 user", "See Also": "", "Kernel Version": "2.6.25", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/char/nozomi.c"], "methods": ["read_mem32", "write_mem32", "nozomi_read_config_table", "enable_transmit_ul", "disable_transmit_ul", "enable_transmit_dl", "disable_transmit_dl", "receive_flow_control", "handle_data_dl", "handle_data_ul", "interrupt_handler", "nozomi_card_init", "nozomi_card_exit", "ntty_open", "ntty_close", "ntty_tiocmset", "ntty_ioctl_tiocgicount", "nozomi", "nozomi_pci_tbl"]}
{"id": "10042", "title": "Unreal actual_brightness and other strange behavior of video module on FSC Amilo Pi 2515", "description": "Distribution:Gentoo\nHardware Environment:Fujitsu-Siemens Amilo Pi 2515\n\nProblem Description:When video module is loaded, /sys/class/backlight/acpi_video0/ entries are created. Dmesg output is ACPI: Video Device [GFX0] (multi-head: yes  rom: no  post: no) \nThe values, however, are strange. actual_brightness is always a big integer like e.g. 2102324320 (changes every time module is loaded, remains unchanged afterwards regardless of brightness level).\nInitial value of acpi_video0/brightness is 0 (although the display is at maximum brightness). max_brightness is set to 100. \nI am able to change the brightness if I echo 25,50 or 75. Any other value makes my display return to maximum brightness. \nActually, the display is supposed to have brightness levels from 1 to 7, AFAIK.\nIf I load with ACPI_DEBUG, initial value of brightness is also a great number such as 2099887552.\n\nSteps to reproduce:always", "patch": ["/*\n * Intel ACPI Component Architecture\n * AML Disassembler version 20061109\n *\n * Disassembly of DSDT.dat, Tue Feb 26 08:56:39 2008\n *\n *\n * Original Table Header:\n *     Signature        \"DSDT\"\n *     Length           0x00005B7B (23419)\n *     Revision         0x02\n *     OEM ID           \"FSC   \"\n *     OEM Table ID     \"F43     \"\n *     OEM Revision     0x06040000 (100925440)\n *     Creator ID       \"INTL\"\n *     Creator Revision 0x20061109 (537268489)\n */\nDefinitionBlock (\"DSDT.aml\", \"DSDT\", 2, \"FSC   \", \"F43     \", 0x06040000)\n{\n    External (PDC1)\n    External (PDC0)\n    External (CFGD)\n    External (\\_PR_.CPU0._PPC)\n\n    Mutex (MUTX, 0x00)\n    OperationRegion (CMS2, SystemIO, 0x72, 0x02)\n    Field (CMS2, ByteAcc, NoLock, Preserve)\n    {\n        INDX,   8, \n        DATA,   8\n    }\n\n    IndexField (INDX, DATA, ByteAcc, NoLock, Preserve)\n    {\n                Offset (0xA0), \n        LBLM,   1, \n                Offset (0xB0), \n        LCDL,   3, \n                Offset (0xF2), \n        S4FG,   1\n    }\n\n    OperationRegion (PRT0, SystemIO, 0x80, 0x04)\n    Field (PRT0, DWordAcc, Lock, Preserve)\n    {\n        P80H,   32\n    }\n\n    Method (P8XH, 2, Serialized)\n    {\n        If (LEqual (Arg0, Zero))\n        {\n            Store (Or (And (P80D, 0xFFFFFF00), Arg1), P80D)\n        }\n\n        If (LEqual (Arg0, One))\n        {\n            Store (Or (And (P80D, 0xFFFF00FF), ShiftLeft (Arg1, 0x08)\n                ), P80D)\n        }\n\n        If (LEqual (Arg0, 0x02))\n        {\n            Store (Or (And (P80D, 0xFF00FFFF), ShiftLeft (Arg1, 0x10)\n                ), P80D)\n        }\n\n        If (LEqual (Arg0, 0x03))\n        {\n            Store (Or (And (P80D, 0x00FFFFFF), ShiftLeft (Arg1, 0x18)\n                ), P80D)\n        }\n\n        Store (P80D, P80H)\n    }\n\n    Method (_PIC, 1, NotSerialized)\n    {\n        Store (Arg0, GPIC)\n    }\n\n    Method (_PTS, 1, NotSerialized)\n    {\n        Store (Zero, P80D)\n        P8XH (Zero, Arg0)\n        If (LEqual (Arg0, 0x04))\n        {\n            Store (Zero, \\_SB.PCI0.LPCB.EC0.APCE)\n            Store (Zero, \\_SB.PCI0.LPCB.EC0.SLMS)\n            Store (One, S4FG)\n        }\n\n        If (LEqual (Arg0, 0x05))\n        {\n            Store (Zero, \\_SB.PCI0.LPCB.EC0.APCE)\n            Store (0x02, TCO2)\n            Store (0x02, TTIV)\n            Store (Zero, TCTV)\n            Store (Zero, HALT)\n            Store (Zero, __NR)\n        }\n    }\n\n    Method (_WAK, 1, NotSerialized)\n    {\n        P8XH (Zero, 0xAB)\n        If (LEqual (Arg0, 0x03))\n        {\n            If (LOr (LEqual (OSYS, 0x07D1), LEqual (OSYS, 0x07D2)))\n            {\n                TRAP (0x3E)\n            }\n        }\n\n        If (LOr (LEqual (Arg0, 0x03), LEqual (Arg0, 0x04)))\n        {\n            If (And (CFGD, 0x01000000))\n            {\n                If (LAnd (And (CFGD, 0xF0), LEqual (OSYS, 0x07D1)))\n                {\n                    TRAP (0x3D)\n                }\n            }\n        }\n\n        \\_SB.PCI0.LPCB.EC0._REG (0x03, One)\n        Notify (\\_SB.PCI0, 0x08)\n        If (NEXP)\n        {\n            If (And (OSCC, 0x02))\n            {\n                \\_SB.PCI0.NHPG ()\n            }\n\n            If (And (OSCC, 0x04))\n            {\n                \\_SB.PCI0.NPME ()\n            }\n        }\n\n        If (LEqual (RP1D, Zero))\n        {\n            Notify (\\_SB.PCI0.RP01, Zero)\n        }\n\n        If (LEqual (RP2D, Zero))\n        {\n            Notify (\\_SB.PCI0.RP02, Zero)\n        }\n\n        If (LEqual (RP3D, Zero))\n        {\n            Notify (\\_SB.PCI0.RP03, Zero)\n        }\n\n        If (LEqual (RP4D, Zero))\n        {\n            Notify (\\_SB.PCI0.RP04, Zero)\n        }\n\n        If (LEqual (RP5D, Zero))\n        {\n            Notify (\\_SB.PCI0.RP05, Zero)\n        }\n\n        If (LEqual (RP6D, Zero))\n        {\n            Notify (\\_SB.PCI0.RP06, Zero)\n        }\n\n        If (LEqual (Arg0, 0x03))\n        {\n            If (LNot (RTCW))\n            {\n                Notify (\\_SB.PWRB, 0x02)\n            }\n        }\n\n        If (LEqual (Arg0, 0x04))\n        {\n            Notify (\\_SB.PWRB, 0x02)\n        }\n\n        \\_PR.RPPC ()\n        Store (Zero, \\_SB.PCI0.LPCB.EC0.APST)\n        Store (Zero, \\_SB.PCI0.LPCB.EC0.APCT)\n        \\_SB.PCI0.LPCB.EC0._Q07 ()\n        P8XH (Zero, 0xCD)\n        Return (Package (0x02)\n        {\n            Zero, \n            Zero\n        })\n    }\n\n    Method (GETB, 3, Serialized)\n    {\n        Multiply (Arg0, 0x08, Local0)\n        Multiply (Arg1, 0x08, Local1)\n        CreateField (Arg2, Local0, Local1, TBF3)\n        Return (TBF3)\n    }\n\n    Method (PNOT, 0, Serialized)\n    {\n        If (MPEN)\n        {\n            If (And (PDC0, 0x08))\n            {\n                Notify (\\_PR.CPU0, 0x80)\n                If (And (PDC0, 0x10))\n                {\n                    Sleep (0x64)\n                    Notify (\\_PR.CPU0, 0x81)\n                }\n            }\n\n            If (And (PDC1, 0x08))\n            {\n                Notify (\\_PR.CPU1, 0x80)\n                If (And (PDC1, 0x10))\n                {\n                    Sleep (0x64)\n                    Notify (\\_PR.CPU1, 0x81)\n                }\n            }\n        }\n        Else\n        {\n            Notify (\\_PR.CPU0, 0x80)\n            Sleep (0x64)\n            Notify (\\_PR.CPU0, 0x81)\n        }\n    }\n\n    Method (TRAP, 1, Serialized)\n    {\n        Store (Arg0, SMIF)\n        Store (Zero, TRP0)\n        Return (SMIF)\n    }\n\n    Scope (_SB)\n    {\n        Method (_INI, 0, NotSerialized)\n        {\n            Store (0x07D0, OSYS)\n            If (CondRefOf (_OSI, Local0))\n            {\n                If (_OSI (\"Linux\"))\n                {\n                    Store (One, LINX)\n                }\n\n                If (_OSI (\"Windows 2001\"))\n                {\n                    Store (0x07D1, OSYS)\n                }\n\n                If (_OSI (\"Windows 2001 SP1\"))\n                {\n                    Store (0x07D1, OSYS)\n                }\n\n                If (_OSI (\"Windows 2001 SP2\"))\n                {\n                    Store (0x07D2, OSYS)\n                }\n\n                If (_OSI (\"Windows 2006\"))\n                {\n                    Store (0x07D6, OSYS)\n                }\n            }\n        }\n    }\n\n    OperationRegion (GNVS, SystemMemory, 0x7F6DEDBC, 0x0100)\n    Field (GNVS, AnyAcc, Lock, Preserve)\n    {\n        OSYS,   16, \n        SMIF,   8, \n        PRM0,   8, \n        PRM1,   8, \n        SCIF,   8, \n        PRM2,   8, \n        PRM3,   8, \n        LCKF,   8, \n        PRM4,   8, \n        PRM5,   8, \n        P80D,   32, \n        LIDS,   8, \n        PWRS,   8, \n        DBGS,   8, \n        LINX,   8, \n                Offset (0x14), \n        ACT1,   8, \n        ACTT,   8, \n        PSVT,   8, \n        TC1V,   8, \n        TC2V,   8, \n        TSPV,   8, \n        CRTT,   8, \n        DTSE,   8, \n        DTS1,   8, \n        DTS2,   8, \n                Offset (0x28), \n        APIC,   8, \n        MPEN,   8, \n        PCP0,   8, \n        PCP1,   8, \n        PPCM,   8, \n                Offset (0x32), \n                Offset (0x3C), \n        IGDS,   8, \n        TLST,   8, \n        CADL,   8, \n        PADL,   8, \n        CSTE,   16, \n        NSTE,   16, \n        SSTE,   16, \n        NDID,   8, \n        DID1,   32, \n        DID2,   32, \n        DID3,   32, \n        DID4,   32, \n        DID5,   32, \n                Offset (0x67), \n        BLCS,   8, \n        BRTL,   8, \n        ALSE,   8, \n        ALAF,   8, \n        LLOW,   8, \n        LHIH,   8, \n                Offset (0x6E), \n        EMAE,   8, \n        EMAP,   16, \n        EMAL,   16, \n                Offset (0x74), \n        MEFE,   8, \n                Offset (0x78), \n        TPMP,   8, \n        TPME,   8, \n                Offset (0x82), \n        GTF0,   56, \n        GTF2,   56, \n        IDEM,   8, \n        GTF1,   56, \n                Offset (0xAA), \n        ASLB,   32, \n        IBTT,   8, \n        IPAT,   8, \n        ITVF,   8, \n        ITVM,   8, \n        IPSC,   8, \n        IBLC,   8, \n        IBIA,   8, \n        ISSC,   8, \n        I409,   8, \n        I509,   8, \n        I609,   8, \n        I709,   8, \n        IDMM,   8, \n        IDMS,   8, \n        IF1E,   8, \n        HVCO,   8, \n        NXD1,   32, \n        NXD2,   32, \n        NXD3,   32, \n        NXD4,   32, \n        NXD5,   32, \n        NXD6,   32, \n        NXD7,   32, \n        NXD8,   32, \n        OSCC,   8, \n        OSCS,   8, \n        NEXP,   8\n    }\n\n    Name (DSEN, One)\n    Name (ECON, Zero)\n    Name (GPIC, Zero)\n    Name (CTYP, Zero)\n    Name (L01C, Zero)\n    Name (VFN0, Zero)\n    Name (VFN1, Zero)\n    Scope (_GPE)\n    {\n        Method (_L01, 0, NotSerialized)\n        {\n            Add (L01C, One, L01C)\n            P8XH (Zero, One)\n            P8XH (One, L01C)\n            If (LAnd (LEqual (RP1D, Zero), \\_SB.PCI0.RP01.HPSX))\n            {\n                Sleep (0x0258)\n                If (\\_SB.PCI0.RP01.PDCX)\n                {\n                    Store (One, \\_SB.PCI0.RP01.PDCX)\n                    Store (One, \\_SB.PCI0.RP01.HPSX)\n                    Notify (\\_SB.PCI0.RP01, Zero)\n                }\n                Else\n                {\n                    Store (One, \\_SB.PCI0.RP01.HPSX)\n                }\n            }\n\n            If (LAnd (LEqual (RP2D, Zero), \\_SB.PCI0.RP02.HPSX))\n            {\n                Sleep (0x64)\n                If (\\_SB.PCI0.RP02.PDCX)\n                {\n                    Store (One, \\_SB.PCI0.RP02.PDCX)\n                    Store (One, \\_SB.PCI0.RP02.HPSX)\n                    Notify (\\_SB.PCI0.RP02, Zero)\n                }\n                Else\n                {\n                    Store (One, \\_SB.PCI0.RP02.HPSX)\n                }\n            }\n\n            If (LAnd (LEqual (RP3D, Zero), \\_SB.PCI0.RP03.HPSX))\n            {\n                Sleep (0x64)\n                If (\\_SB.PCI0.RP03.PDCX)\n                {\n                    Store (One, \\_SB.PCI0.RP03.PDCX)\n                    Store (One, \\_SB.PCI0.RP03.HPSX)\n                    Notify (\\_SB.PCI0.RP03, Zero)\n                }\n                Else\n                {\n                    Store (One, \\_SB.PCI0.RP03.HPSX)\n                }\n            }\n\n            If (LAnd (LEqual (RP4D, Zero), \\_SB.PCI0.RP04.HPSX))\n            {\n                Sleep (0x64)\n                If (\\_SB.PCI0.RP04.PDCX)\n                {\n                    Store (One, \\_SB.PCI0.RP04.PDCX)\n                    Store (One, \\_SB.PCI0.RP04.HPSX)\n                    Notify (\\_SB.PCI0.RP04, Zero)\n                }\n                Else\n                {\n                    Store (One, \\_SB.PCI0.RP04.HPSX)\n                }\n            }\n\n            If (LAnd (LEqual (RP5D, Zero), \\_SB.PCI0.RP05.HPSX))\n            {\n                Sleep (0x64)\n                If (\\_SB.PCI0.RP05.PDCX)\n                {\n                    Store (One, \\_SB.PCI0.RP05.PDCX)\n                    Store (One, \\_SB.PCI0.RP05.HPSX)\n                    Notify (\\_SB.PCI0.RP05, Zero)\n                }\n                Else\n                {\n                    Store (One, \\_SB.PCI0.RP05.HPSX)\n                }\n            }\n\n            If (LAnd (LEqual (RP6D, Zero), \\_SB.PCI0.RP06.HPSX))\n            {\n                Sleep (0x64)\n                If (\\_SB.PCI0.RP06.PDCX)\n                {\n                    Store (One, \\_SB.PCI0.RP06.PDCX)\n                    Store (One, \\_SB.PCI0.RP06.HPSX)\n                    Notify (\\_SB.PCI0.RP06, Zero)\n                }\n                Else\n                {\n                    Store (One, \\_SB.PCI0.RP06.HPSX)\n                }\n            }\n        }\n\n        Method (_L02, 0, NotSerialized)\n        {\n            Store (Zero, GPEC)\n        }\n\n        Method (_L03, 0, NotSerialized)\n        {\n            Notify (\\_SB.PCI0.USB1, 0x02)\n        }\n\n        Method (_L04, 0, NotSerialized)\n        {\n            Notify (\\_SB.PCI0.USB2, 0x02)\n        }\n\n        Method (_L05, 0, NotSerialized)\n        {\n            Notify (\\_SB.PCI0.USB5, 0x02)\n        }\n\n        Method (_L06, 0, NotSerialized)\n        {\n            If (\\_SB.PCI0.GFX0.GSSE)\n            {\n                \\_SB.PCI0.GFX0.GSCI ()\n            }\n            Else\n            {\n                Store (One, SCIS)\n            }\n        }\n\n        Method (_L07, 0, NotSerialized)\n        {\n            Store (0x20, \\_SB.PCI0.SBUS.HSTS)\n        }\n\n        Method (_L09, 0, NotSerialized)\n        {\n            If (\\_SB.PCI0.RP01.PSPX)\n            {\n                Store (One, \\_SB.PCI0.RP01.PSPX)\n                Store (One, \\_SB.PCI0.RP01.PMSX)\n                Notify (\\_SB.PCI0.RP01, 0x02)\n            }\n\n            If (\\_SB.PCI0.RP02.PSPX)\n            {\n                Store (One, \\_SB.PCI0.RP02.PSPX)\n                Store (One, \\_SB.PCI0.RP02.PMSX)\n                Notify (\\_SB.PCI0.RP02, 0x02)\n            }\n\n            If (\\_SB.PCI0.RP03.PSPX)\n            {\n                Store (One, \\_SB.PCI0.RP03.PSPX)\n                Store (One, \\_SB.PCI0.RP03.PMSX)\n                Notify (\\_SB.PCI0.RP03, 0x02)\n            }\n\n            If (\\_SB.PCI0.RP04.PSPX)\n            {\n                Store (One, \\_SB.PCI0.RP04.PSPX)\n                Store (One, \\_SB.PCI0.RP04.PMSX)\n                Notify (\\_SB.PCI0.RP04, 0x02)\n            }\n\n            If (\\_SB.PCI0.RP05.PSPX)\n            {\n                Store (One, \\_SB.PCI0.RP05.PSPX)\n                Store (One, \\_SB.PCI0.RP05.PMSX)\n                Notify (\\_SB.PCI0.RP05, 0x02)\n            }\n\n            If (\\_SB.PCI0.RP06.PSPX)\n            {\n                Store (One, \\_SB.PCI0.RP06.PSPX)\n                Store (One, \\_SB.PCI0.RP06.PMSX)\n                Notify (\\_SB.PCI0.RP06, 0x02)\n            }\n        }\n\n        Method (_L0B, 0, NotSerialized)\n        {\n            Notify (\\_SB.PCI0.PCIB, 0x02)\n        }\n\n        Method (_L0C, 0, NotSerialized)\n        {\n            Notify (\\_SB.PCI0.USB3, 0x02)\n        }\n\n        Method (_L0D, 0, NotSerialized)\n        {\n            If (\\_SB.PCI0.EHC1.PMES)\n            {\n                Store (One, \\_SB.PCI0.EHC1.PMES)\n                Notify (\\_SB.PCI0.EHC1, 0x02)\n            }\n\n            If (\\_SB.PCI0.EHC2.PMES)\n            {\n                Store (One, \\_SB.PCI0.EHC2.PMES)\n                Notify (\\_SB.PCI0.EHC2, 0x02)\n            }\n\n            If (\\_SB.PCI0.HDEF.PMES)\n            {\n                Store (One, \\_SB.PCI0.HDEF.PMES)\n                Notify (\\_SB.PCI0.HDEF, 0x02)\n            }\n        }\n\n        Method (_L0E, 0, NotSerialized)\n        {\n            Notify (\\_SB.PCI0.USB4, 0x02)\n        }\n    }\n\n    Scope (_PR)\n    {\n        Processor (CPU0, 0x00, 0x00001010, 0x06) {}\n        Processor (CPU1, 0x01, 0x00001010, 0x06) {}\n        Method (RPPC, 0, NotSerialized)\n        {\n            If (LEqual (OSYS, 0x07D2))\n            {\n                If (And (CFGD, One))\n                {\n                    If (LGreater (^CPU0._PPC, Zero))\n                    {\n                        Subtract (^CPU0._PPC, One, ^CPU0._PPC)\n                        PNOT ()\n                        Add (^CPU0._PPC, One, ^CPU0._PPC)\n                        PNOT ()\n                    }\n                    Else\n                    {\n                        Add (^CPU0._PPC, One, ^CPU0._PPC)\n                        PNOT ()\n                        Subtract (^CPU0._PPC, One, ^CPU0._PPC)\n                        PNOT ()\n                    }\n                }\n            }\n        }\n    }\n\n    Scope (_TZ)\n    {\n        Name (THPP, Zero)\n        ThermalZone (THRM)\n        {\n            Method (KELV, 1, NotSerialized)\n            {\n                If (LGreater (Arg0, 0x7F))\n                {\n                    XOr (Arg0, 0xFF, Local0)\n                    Add (Local0, One, Local0)\n                    Multiply (Local0, 0x0A, Local0)\n                    Subtract (0x0AAC, Local0, Local1)\n                }\n                Else\n                {\n                    Multiply (Arg0, 0x0A, Local0)\n                    Add (Local0, 0x0AAC, Local1)\n                }\n\n                Return (Local1)\n            }\n\n            Method (_TMP, 0, NotSerialized)\n            {\n                If (LEqual (\\_SB.PCI0.LPCB.EC0.FGEC, Zero))\n                {\n                    Return (KELV (0x1E))\n                }\n\n                If (THPP)\n                {\n                    Return (KELV (THPP))\n                }\n                Else\n                {\n                    Return (KELV (\\_SB.PCI0.LPCB.EC0.XHPP))\n                }\n            }\n\n            Method (_CRT, 0, NotSerialized)\n            {\n                Return (KELV (0x77))\n            }\n\n            Method (_TSP, 0, NotSerialized)\n            {\n                Return (0x0A)\n            }\n        }\n    }\n\n    Scope (_SB)\n    {\n        Device (PCI0)\n        {\n            Method (_S3D, 0, NotSerialized)\n            {\n                Return (0x02)\n            }\n\n            Method (_S4D, 0, NotSerialized)\n            {\n                Return (0x02)\n            }\n\n            Name (_HID, EisaId (\"PNP0A08\"))\n            Name (_CID, 0x030AD041)\n            Device (MCHC)\n            {\n                Name (_ADR, Zero)\n                OperationRegion (HBUS, PCI_Config, 0x40, 0xC0)\n                Field (HBUS, DWordAcc, NoLock, Preserve)\n                {\n                    EPEN,   1, \n                        ,   11, \n                    EPBR,   20, \n                            Offset (0x08), \n                    MHEN,   1, \n                        ,   13, \n                    MHBR,   18, \n                            Offset (0x20), \n                    PXEN,   1, \n                    PXSZ,   2, \n                        ,   23, \n                    PXBR,   6, \n                            Offset (0x28), \n                    DIEN,   1, \n                        ,   11, \n                    DIBR,   20, \n                            Offset (0x30), \n                    IPEN,   1, \n                        ,   11, \n                    IPBR,   20, \n                            Offset (0x50), \n                        ,   4, \n                    PM0H,   2, \n                            Offset (0x51), \n                    PM1L,   2, \n                        ,   2, \n                    PM1H,   2, \n                            Offset (0x52), \n                    PM2L,   2, \n                        ,   2, \n                    PM2H,   2, \n                            Offset (0x53), \n                    PM3L,   2, \n                        ,   2, \n                    PM3H,   2, \n                            Offset (0x54), \n                    PM4L,   2, \n                        ,   2, \n                    PM4H,   2, \n                            Offset (0x55), \n                    PM5L,   2, \n                        ,   2, \n                    PM5H,   2, \n                            Offset (0x56), \n                    PM6L,   2, \n                        ,   2, \n                    PM6H,   2, \n                            Offset (0x57), \n                        ,   7, \n                    HENA,   1, \n                            Offset (0x62), \n                    TUUD,   16, \n                            Offset (0x70), \n                        ,   4, \n                    TLUD,   12\n                }\n            }\n\n            Name (BUF0, ResourceTemplate ()\n            {\n                WordBusNumber (ResourceProducer, MinFixed, MaxFixed, PosDecode,\n                    0x0000,             // Granularity\n                    0x0000,             // Range Minimum\n                    0x00FF,             // Range Maximum\n                    0x0000,             // Translation Offset\n                    0x0100,             // Length\n                    ,, )\n                DWordIO (ResourceProducer, MinFixed, MaxFixed, PosDecode, EntireRange,\n                    0x00000000,         // Granularity\n                    0x00000000,         // Range Minimum\n                    0x00000CF7,         // Range Maximum\n                    0x00000000,         // Translation Offset\n                    0x00000CF8,         // Length\n                    ,, , TypeStatic)\n                IO (Decode16,\n                    0x0CF8,             // Range Minimum\n                    0x0CF8,             // Range Maximum\n                    0x01,               // Alignment\n                    0x08,               // Length\n                    )\n                DWordIO (ResourceProducer, MinFixed, MaxFixed, PosDecode, EntireRange,\n                    0x00000000,         // Granularity\n                    0x00000D00,         // Range Minimum\n                    0x0000FFFF,         // Range Maximum\n                    0x00000000,         // Translation Offset\n                    0x0000F300,         // Length\n                    ,, , TypeStatic)\n                DWordMemory (ResourceProducer, PosDecode, MinFixed, MaxFixed, Cacheable, ReadWrite,\n                    0x00000000,         // Granularity\n                    0x000A0000,         // Range Minimum\n                    0x000BFFFF,         // Range Maximum\n                    0x00000000,         // Translation Offset\n                    0x00020000,         // Length\n                    ,, , AddressRangeMemory, TypeStatic)\n                DWordMemory (ResourceProducer, PosDecode, MinFixed, MaxFixed, Cacheable, ReadWrite,\n                    0x00000000,         // Granularity\n                    0x000C0000,         // Range Minimum\n                    0x000C3FFF,         // Range Maximum\n                    0x00000000,         // Translation Offset\n                    0x00004000,         // Length\n                    ,, _Y00, AddressRangeMemory, TypeStatic)\n                DWordMemory (ResourceProducer, PosDecode, MinFixed, MaxFixed, Cacheable, ReadWrite,\n                    0x00000000,         // Granularity\n                    0x000C4000,         // Range Minimum\n                    0x000C7FFF,         // Range Maximum\n                    0x00000000,         // Translation Offset\n                    0x00004000,         // Length\n                    ,, _Y01, AddressRangeMemory, TypeStatic)\n                DWordMemory (ResourceProducer, PosDecode, MinFixed, MaxFixed, Cacheable, ReadWrite,\n                    0x00000000,         // Granularity\n                    0x000C8000,         // Range Minimum\n                    0x000CBFFF,         // Range Maximum\n                    0x00000000,         // Translation Offset\n                    0x00004000,         // Length\n                    ,, _Y02, AddressRangeMemory, TypeStatic)\n                DWordMemory (ResourceProducer, PosDecode, MinFixed, MaxFixed, Cacheable, ReadWrite,\n                    0x00000000,         // Granularity\n                    0x000CC000,         // Range Minimum\n                    0x000CFFFF,         // Range Maximum\n                    0x00000000,         // Translation Offset\n                    0x00004000,         // Length\n                    ,, _Y03, AddressRangeMemory, TypeStatic)\n                DWordMemory (ResourceProducer, PosDecode, MinFixed, MaxFixed, Cacheable, ReadWrite,\n                    0x00000000,         // Granularity\n                    0x000D0000,         // Range Minimum\n                    0x000D3FFF,         // Range Maximum\n                    0x00000000,         // Translation Offset\n                    0x00004000,         // Length\n                    ,, _Y04, AddressRangeMemory, TypeStatic)\n                DWordMemory (ResourceProducer, PosDecode, MinFixed, MaxFixed, Cacheable, ReadWrite,\n                    0x00000000,         // Granularity\n                    0x000D4000,         // Range Minimum\n                    0x000D7FFF,         // Range Maximum\n                    0x00000000,         // Translation Offset\n                    0x00004000,         // Length\n                    ,, _Y05, AddressRangeMemory, TypeStatic)\n                DWordMemory (ResourceProducer, PosDecode, MinFixed, MaxFixed, Cacheable, ReadWrite,\n                    0x00000000,         // Granularity\n                    0x000D8000,         // Range Minimum\n                    0x000DBFFF,         // Range Maximum\n                    0x00000000,         // Translation Offset\n                    0x00004000,         // Length\n                    ,, _Y06, AddressRangeMemory, TypeStatic)\n                DWordMemory (ResourceProducer, PosDecode, MinFixed, MaxFixed, Cacheable, ReadWrite,\n                    0x00000000,         // Granularity\n                    0x000DC000,         // Range Minimum\n                    0x000DFFFF,         // Range Maximum\n                    0x00000000,         // Translation Offset\n                    0x00004000,         // Length\n                    ,, _Y07, AddressRangeMemory, TypeStatic)\n                DWordMemory (ResourceProducer, PosDecode, MinFixed, MaxFixed, Cacheable, ReadWrite,\n                    0x00000000,         // Granularity\n                    0x000E0000,         // Range Minimum\n                    0x000E3FFF,         // Range Maximum\n                    0x00000000,         // Translation Offset\n                    0x00004000,         // Length\n                    ,, _Y08, AddressRangeMemory, TypeStatic)\n                DWordMemory (ResourceProducer, PosDecode, MinFixed, MaxFixed, Cacheable, ReadWrite,\n                    0x00000000,         // Granularity\n                    0x000E4000,         // Range Minimum\n                    0x000E7FFF,         // Range Maximum\n                    0x00000000,         // Translation Offset\n                    0x00004000,         // Length\n                    ,, _Y09, AddressRangeMemory, TypeStatic)\n                DWordMemory (ResourceProducer, PosDecode, MinFixed, MaxFixed, Cacheable, ReadWrite,\n                    0x00000000,         // Granularity\n                    0x000E8000,         // Range Minimum\n                    0x000EBFFF,         // Range Maximum\n                    0x00000000,         // Translation Offset\n                    0x00004000,         // Length\n                    ,, _Y0A, AddressRangeMemory, TypeStatic)\n                DWordMemory (ResourceProducer, PosDecode, MinFixed, MaxFixed, Cacheable, ReadWrite,\n                    0x00000000,         // Granularity\n                    0x000EC000,         // Range Minimum\n                    0x000EFFFF,         // Range Maximum\n                    0x00000000,         // Translation Offset\n                    0x00004000,         // Length\n                    ,, _Y0B, AddressRangeMemory, TypeStatic)\n                DWordMemory (ResourceProducer, PosDecode, MinFixed, MaxFixed, Cacheable, ReadWrite,\n                    0x00000000,         // Granularity\n                    0x000F0000,         // Range Minimum\n                    0x000FFFFF,         // Range Maximum\n                    0x00000000,         // Translation Offset\n                    0x00010000,         // Length\n                    ,, _Y0C, AddressRangeMemory, TypeStatic)\n                DWordMemory (ResourceProducer, PosDecode, MinFixed, MaxFixed, Cacheable, ReadWrite,\n                    0x00000000,         // Granularity\n                    0x00000000,         // Range Minimum\n                    0xDFFFFFFF,         // Range Maximum\n                    0x00000000,         // Translation Offset\n                    0x00000000,         // Length\n                    ,, _Y0D, AddressRangeMemory, TypeStatic)\n                DWordMemory (ResourceProducer, PosDecode, MinFixed, MaxFixed, Cacheable, ReadWrite,\n                    0x00000000,         // Granularity\n                    0xF0000000,         // Range Minimum\n                    0xFEBFFFFF,         // Range Maximum\n                    0x00000000,         // Translation Offset\n                    0x0EC00000,         // Length\n                    ,, _Y0E, AddressRangeMemory, TypeStatic)\n                DWordMemory (ResourceProducer, PosDecode, MinFixed, MaxFixed, Cacheable, ReadWrite,\n                    0x00000000,         // Granularity\n                    0xFED40000,         // Range Minimum\n                    0xFED44FFF,         // Range Maximum\n                    0x00000000,         // Translation Offset\n                    0x00000000,         // Length\n                    ,, , AddressRangeMemory, TypeStatic)\n            })\n            Method (_CRS, 0, Serialized)\n            {\n                If (^MCHC.PM1L)\n                {\n                    CreateDWordField (BUF0, \\_SB.PCI0._Y00._LEN, C0LN)\n                    Store (Zero, C0LN)\n                }\n\n                If (LEqual (^MCHC.PM1L, One))\n                {\n                    CreateBitField (BUF0, \\_SB.PCI0._Y00._RW, C0RW)\n                    Store (Zero, C0RW)\n                }\n\n                If (^MCHC.PM1H)\n                {\n                    CreateDWordField (BUF0, \\_SB.PCI0._Y01._LEN, C4LN)\n                    Store (Zero, C4LN)\n                }\n\n                If (LEqual (^MCHC.PM1H, One))\n                {\n                    CreateBitField (BUF0, \\_SB.PCI0._Y01._RW, C4RW)\n                    Store (Zero, C4RW)\n                }\n\n                If (^MCHC.PM2L)\n                {\n                    CreateDWordField (BUF0, \\_SB.PCI0._Y02._LEN, C8LN)\n                    Store (Zero, C8LN)\n                }\n\n                If (LEqual (^MCHC.PM2L, One))\n                {\n                    CreateBitField (BUF0, \\_SB.PCI0._Y02._RW, C8RW)\n                    Store (Zero, C8RW)\n                }\n\n                If (^MCHC.PM2H)\n                {\n                    CreateDWordField (BUF0, \\_SB.PCI0._Y03._LEN, CCLN)\n                    Store (Zero, CCLN)\n                }\n\n                If (LEqual (^MCHC.PM2H, One))\n                {\n                    CreateBitField (BUF0, \\_SB.PCI0._Y03._RW, CCRW)\n                    Store (Zero, CCRW)\n                }\n\n                If (^MCHC.PM3L)\n                {\n                    CreateDWordField (BUF0, \\_SB.PCI0._Y04._LEN, D0LN)\n                    Store (Zero, D0LN)\n                }\n\n                If (LEqual (^MCHC.PM3L, One))\n                {\n                    CreateBitField (BUF0, \\_SB.PCI0._Y04._RW, D0RW)\n                    Store (Zero, D0RW)\n                }\n\n                If (^MCHC.PM3H)\n                {\n                    CreateDWordField (BUF0, \\_SB.PCI0._Y05._LEN, D4LN)\n                    Store (Zero, D4LN)\n                }\n\n                If (LEqual (^MCHC.PM3H, One))\n                {\n                    CreateBitField (BUF0, \\_SB.PCI0._Y05._RW, D4RW)\n                    Store (Zero, D4RW)\n                }\n\n                If (^MCHC.PM4L)\n                {\n                    CreateDWordField (BUF0, \\_SB.PCI0._Y06._LEN, D8LN)\n                    Store (Zero, D8LN)\n                }\n\n                If (LEqual (^MCHC.PM4L, One))\n                {\n                    CreateBitField (BUF0, \\_SB.PCI0._Y06._RW, D8RW)\n                    Store (Zero, D8RW)\n                }\n\n                If (^MCHC.PM4H)\n                {\n                    CreateDWordField (BUF0, \\_SB.PCI0._Y07._LEN, DCLN)\n                    Store (Zero, DCLN)\n                }\n\n                If (LEqual (^MCHC.PM4H, One))\n                {\n                    CreateBitField (BUF0, \\_SB.PCI0._Y07._RW, DCRW)\n                    Store (Zero, DCRW)\n                }\n\n                If (^MCHC.PM5L)\n                {\n                    CreateDWordField (BUF0, \\_SB.PCI0._Y08._LEN, E0LN)\n                    Store (Zero, E0LN)\n                }\n\n                If (LEqual (^MCHC.PM5L, One))\n                {\n                    CreateBitField (BUF0, \\_SB.PCI0._Y08._RW, E0RW)\n                    Store (Zero, E0RW)\n                }\n\n                If (^MCHC.PM5H)\n                {\n                    CreateDWordField (BUF0, \\_SB.PCI0._Y09._LEN, E4LN)\n                    Store (Zero, E4LN)\n                }\n\n                If (LEqual (^MCHC.PM5H, One))\n                {\n                    CreateBitField (BUF0, \\_SB.PCI0._Y09._RW, E4RW)\n                    Store (Zero, E4RW)\n                }\n\n                If (^MCHC.PM6L)\n                {\n                    CreateDWordField (BUF0, \\_SB.PCI0._Y0A._LEN, E8LN)\n                    Store (Zero, E8LN)\n                }\n\n                If (LEqual (^MCHC.PM6L, One))\n                {\n                    CreateBitField (BUF0, \\_SB.PCI0._Y0A._RW, E8RW)\n                    Store (Zero, E8RW)\n                }\n\n                If (^MCHC.PM6H)\n                {\n                    CreateDWordField (BUF0, \\_SB.PCI0._Y0B._LEN, ECLN)\n                    Store (Zero, ECLN)\n                }\n\n                If (LEqual (^MCHC.PM6H, One))\n                {\n                    CreateBitField (BUF0, \\_SB.PCI0._Y0B._RW, ECRW)\n                    Store (Zero, ECRW)\n                }\n\n                If (^MCHC.PM0H)\n                {\n                    CreateDWordField (BUF0, \\_SB.PCI0._Y0C._LEN, F0LN)\n                    Store (Zero, F0LN)\n                }\n\n                If (LEqual (^MCHC.PM0H, One))\n                {\n                    CreateBitField (BUF0, \\_SB.PCI0._Y0C._RW, F0RW)\n                    Store (Zero, F0RW)\n                }\n\n                CreateDWordField (BUF0, \\_SB.PCI0._Y0D._MIN, M1MN)\n                CreateDWordField (BUF0, \\_SB.PCI0._Y0D._MAX, M1MX)\n                CreateDWordField (BUF0, \\_SB.PCI0._Y0D._LEN, M1LN)\n                CreateDWordField (BUF0, \\_SB.PCI0._Y0E._MIN, M2MN)\n                CreateDWordField (BUF0, \\_SB.PCI0._Y0E._MAX, M2MX)\n                CreateDWordField (BUF0, \\_SB.PCI0._Y0E._LEN, M2LN)\n                ShiftLeft (^MCHC.PXBR, 0x1A, M1MX)\n                ShiftRight (0x10000000, ^MCHC.PXSZ, Local0)\n                Add (M1MX, Local0, M2MN)\n                Add (Subtract (M2MX, M2MN), One, M2LN)\n                Subtract (M1MX, One, M1MX)\n                ShiftLeft (^MCHC.TLUD, 0x14, M1MN)\n                Add (Subtract (M1MX, M1MN), One, M1LN)\n                Return (BUF0)\n            }\n\n            Name (GUID, Buffer (0x10)\n            {\n                /* 0000 */    0x5B, 0x4D, 0xDB, 0x33, 0xF7, 0x1F, 0x1C, 0x40, \n                /* 0008 */    0x96, 0x57, 0x74, 0x41, 0xC0, 0x3D, 0xD7, 0x66\n            })\n           /* Store (Zero, OSCS)\n            Store (Zero, OSCC) */\n            Method (_OSC, 4, Serialized)\n            {\n            \tStore (Zero, OSCS)\n            \tStore (Zero, OSCC)\n                If (LAnd (LEqual (Arg0, GUID), NEXP))\n                {\n                    Store (Arg3, Local0)\n                    CreateDWordField (Local0, Zero, CDW1)\n                    CreateDWordField (Local0, 0x04, CDW2)\n                    CreateDWordField (Local0, 0x08, CDW3)\n                    Store (CDW2, OSCS)\n                    Store (CDW3, OSCC)\n                    If (Not (And (CDW1, One)))\n                    {\n                        If (And (OSCC, 0x02))\n                        {\n                            NHPG ()\n                        }\n\n                        If (And (OSCC, 0x04))\n                        {\n                            NPME ()\n                        }\n                    }\n\n                    If (LNotEqual (Arg1, One))\n                    {\n                        Or (CDW1, 0x08, CDW1)\n                    }\n\n                    If (LNotEqual (CDW3, OSCC))\n                    {\n                        Or (CDW1, 0x10, CDW1)\n                    }\n\n                    Store (OSCC, CDW3)\n                    Return (Local0)\n                }\n                Else\n                {\n                    Or (CDW1, 0x04, CDW1)\n                    Return (Local0)\n                }\n            }\n\n            Method (_PRT, 0, NotSerialized)\n            {\n                If (GPIC)\n                {\n                    Return (Package (0x17)\n                    {\n                        Package (0x04)\n                        {\n                            0x0001FFFF, \n                            Zero, \n                            Zero, \n                            0x10\n                        }, \n\n                        Package (0x04)\n                        {\n                            0x0002FFFF, \n                            Zero, \n                            Zero, \n                            0x10\n                        }, \n\n                        Package (0x04)\n                        {\n                            0x0003FFFF, \n                            Zero, \n                            Zero, \n                            0x10\n                        }, \n\n                        Package (0x04)\n                        {\n                            0x0003FFFF, \n                            One, \n                            Zero, \n                            0x11\n                        }, \n\n                        Package (0x04)\n                        {\n                            0x0003FFFF, \n                            0x02, \n                            Zero, \n                            0x12\n                        }, \n\n                        Package (0x04)\n                        {\n                            0x0003FFFF, \n                            0x03, \n                            Zero, \n                            0x13\n                        }, \n\n                        Package (0x04)\n                        {\n                            0x0007FFFF, \n                            Zero, \n                            Zero, \n                            0x10\n                        }, \n\n                        Package (0x04)\n                        {\n                            0x0019FFFF, \n                            Zero, \n                            Zero, \n                            0x14\n                        }, \n\n                        Package (0x04)\n                        {\n                            0x001AFFFF, \n                            Zero, \n                            Zero, \n                            0x10\n                        }, \n\n                        Package (0x04)\n                        {\n                            0x001AFFFF, \n                            One, \n                            Zero, \n                            0x15\n                        }, \n\n                        Package (0x04)\n                        {\n                            0x001AFFFF, \n                            0x02, \n                            Zero, \n                            0x12\n                        }, \n\n                        Package (0x04)\n                        {\n                            0x001BFFFF, \n                            Zero, \n                            Zero, \n                            0x16\n                        }, \n\n                        Package (0x04)\n                        {\n                            0x001CFFFF, \n                            Zero, \n                            Zero, \n                            0x11\n                        }, \n\n                        Package (0x04)\n                        {\n                            0x001CFFFF, \n                            One, \n                            Zero, \n                            0x10\n                        }, \n\n                        Package (0x04)\n                        {\n                            0x001CFFFF, \n                            0x02, \n                            Zero, \n                            0x12\n                        }, \n\n                        Package (0x04)\n                        {\n                            0x001CFFFF, \n                            0x03, \n                            Zero, \n                            0x13\n                        }, \n\n                        Package (0x04)\n                        {\n                            0x001DFFFF, \n                            Zero, \n                            Zero, \n                            0x17\n                        }, \n\n                        Package (0x04)\n                        {\n                            0x001DFFFF, \n                            One, \n                            Zero, \n                            0x13\n                        }, \n\n                        Package (0x04)\n                        {\n                            0x001DFFFF, \n                            0x02, \n                            Zero, \n                            0x12\n                        }, \n\n                        Package (0x04)\n                        {\n                            0x001FFFFF, \n                            Zero, \n                            Zero, \n                            0x13\n                        }, \n\n                        Package (0x04)\n                        {\n                            0x001FFFFF, \n                            One, \n                            Zero, \n                            0x13\n                        }, \n\n                        Package (0x04)\n                        {\n                            0x001FFFFF, \n                            0x02, \n                            Zero, \n                            0x13\n                        }, \n\n                        Package (0x04)\n                        {\n                            0x001FFFFF, \n                            0x03, \n                            Zero, \n                            0x10\n                        }\n                    })\n                }\n                Else\n                {\n                    Return (Package (0x17)\n                    {\n                        Package (0x04)\n                        {\n                            0x0001FFFF, \n                            Zero, \n                            ^LPCB.LNKA, \n                            Zero\n                        }, \n\n                        Package (0x04)\n                        {\n                            0x0002FFFF, \n                            Zero, \n                            ^LPCB.LNKA, \n                            Zero\n                        }, \n\n                        Package (0x04)\n                        {\n                            0x0003FFFF, \n                            Zero, \n                            ^LPCB.LNKA, \n                            Zero\n                        }, \n\n                        Package (0x04)\n                        {\n                            0x0003FFFF, \n                            One, \n                            ^LPCB.LNKB, \n                            Zero\n                        }, \n\n                        Package (0x04)\n                        {\n                            0x0003FFFF, \n                            0x02, \n                            ^LPCB.LNKC, \n                            Zero\n                        }, \n\n                        Package (0x04)\n                        {\n                            0x0003FFFF, \n                            0x03, \n                            ^LPCB.LNKD, \n                            Zero\n                        }, \n\n                        Package (0x04)\n                        {\n                            0x0007FFFF, \n                            Zero, \n                            ^LPCB.LNKA, \n                            Zero\n                        }, \n\n                        Package (0x04)\n                        {\n                            0x0019FFFF, \n                            Zero, \n                            ^LPCB.LNKE, \n                            Zero\n                        }, \n\n                        Package (0x04)\n                        {\n                            0x001AFFFF, \n                            Zero, \n                            ^LPCB.LNKA, \n                            Zero\n                        }, \n\n                        Package (0x04)\n                        {\n                            0x001AFFFF, \n                            One, \n                            ^LPCB.LNKF, \n                            Zero\n                        }, \n\n                        Package (0x04)\n                        {\n                            0x001AFFFF, \n                            0x02, \n                            ^LPCB.LNKC, \n                            Zero\n                        }, \n\n                        Package (0x04)\n                        {\n                            0x001BFFFF, \n                            Zero, \n                            ^LPCB.LNKG, \n                            Zero\n                        }, \n\n                        Package (0x04)\n                        {\n                            0x001CFFFF, \n                            Zero, \n                            ^LPCB.LNKB, \n                            Zero\n                        }, \n\n                        Package (0x04)\n                        {\n                            0x001CFFFF, \n                            One, \n                            ^LPCB.LNKA, \n                            Zero\n                        }, \n\n                        Package (0x04)\n                        {\n                            0x001CFFFF, \n                            0x02, \n                            ^LPCB.LNKC, \n                            Zero\n                        }, \n\n                        Package (0x04)\n                        {\n                            0x001CFFFF, \n                            0x03, \n                            ^LPCB.LNKD, \n                            Zero\n                        }, \n\n                        Package (0x04)\n                        {\n                            0x001DFFFF, \n                            Zero, \n                            ^LPCB.LNKH, \n                            Zero\n                        }, \n\n                        Package (0x04)\n                        {\n                            0x001DFFFF, \n                            One, \n                            ^LPCB.LNKD, \n                            Zero\n                        }, \n\n                        Package (0x04)\n                        {\n                            0x001DFFFF, \n                            0x02, \n                            ^LPCB.LNKC, \n                            Zero\n                        }, \n\n                        Package (0x04)\n                        {\n                            0x001FFFFF, \n                            Zero, \n                            ^LPCB.LNKD, \n                            Zero\n                        }, \n\n                        Package (0x04)\n                        {\n                            0x001FFFFF, \n                            One, \n                            ^LPCB.LNKD, \n                            Zero\n                        }, \n\n                        Package (0x04)\n                        {\n                            0x001FFFFF, \n                            0x02, \n                            ^LPCB.LNKD, \n                            Zero\n                        }, \n\n                        Package (0x04)\n                        {\n                            0x001FFFFF, \n                            0x03, \n                            ^LPCB.LNKA, \n                            Zero\n                        }\n                    })\n                }\n            }\n\n            Device (PDRC)\n            {\n                Name (_HID, EisaId (\"PNP0C02\"))\n                Name (_UID, One)\n                Name (BUF0, ResourceTemplate ()\n                {\n                    Memory32Fixed (ReadWrite,\n                        0x00000000,         // Address Base\n                        0x00004000,         // Address Length\n                        _Y0F)\n                    Memory32Fixed (ReadWrite,\n                        0x00000000,         // Address Base\n                        0x00004000,         // Address Length\n                        _Y10)\n                    Memory32Fixed (ReadWrite,\n                        0x00000000,         // Address Base\n                        0x00001000,         // Address Length\n                        _Y11)\n                    Memory32Fixed (ReadWrite,\n                        0x00000000,         // Address Base\n                        0x00001000,         // Address Length\n                        _Y12)\n                    Memory32Fixed (ReadWrite,\n                        0x00000000,         // Address Base\n                        0x00000000,         // Address Length\n                        _Y13)\n                    Memory32Fixed (ReadWrite,\n                        0xFED20000,         // Address Base\n                        0x00020000,         // Address Length\n                        )\n                    Memory32Fixed (ReadWrite,\n                        0xFED40000,         // Address Base\n                        0x00005000,         // Address Length\n                        )\n                    Memory32Fixed (ReadWrite,\n                        0xFED45000,         // Address Base\n                        0x0004B000,         // Address Length\n                        )\n                    Memory32Fixed (ReadOnly,\n                        0xF0401000,         // Address Base\n                        0x00001000,         // Address Length\n                        )\n                })\n                Method (_CRS, 0, Serialized)\n                {\n                    CreateDWordField (BUF0, \\_SB.PCI0.PDRC._Y0F._BAS, RBR0)\n                    ShiftLeft (^^LPCB.RCBA, 0x0E, RBR0)\n                    CreateDWordField (BUF0, \\_SB.PCI0.PDRC._Y10._BAS, MBR0)\n                    ShiftLeft (^^MCHC.MHBR, 0x0E, MBR0)\n                    CreateDWordField (BUF0, \\_SB.PCI0.PDRC._Y11._BAS, DBR0)\n                    ShiftLeft (^^MCHC.DIBR, 0x0C, DBR0)\n                    CreateDWordField (BUF0, \\_SB.PCI0.PDRC._Y12._BAS, EBR0)\n                    ShiftLeft (^^MCHC.EPBR, 0x0C, EBR0)\n                    CreateDWordField (BUF0, \\_SB.PCI0.PDRC._Y13._BAS, XBR0)\n                    ShiftLeft (^^MCHC.PXBR, 0x1A, XBR0)\n                    CreateDWordField (BUF0, \\_SB.PCI0.PDRC._Y13._LEN, XSZ0)\n                    ShiftRight (0x10000000, ^^MCHC.PXSZ, XSZ0)\n                    Return (BUF0)\n                }\n            }\n\n            Device (PEGP)\n            {\n                Name (_ADR, 0x00010000)\n                Method (_PRT, 0, NotSerialized)\n                {\n                    If (GPIC)\n                    {\n                        Return (Package (0x04)\n                        {\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                Zero, \n                                Zero, \n                                0x10\n                            }, \n\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                One, \n                                Zero, \n                                0x11\n                            }, \n\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                0x02, \n                                Zero, \n                                0x12\n                            }, \n\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                0x03, \n                                Zero, \n                                0x13\n                            }\n                        })\n                    }\n                    Else\n                    {\n                        Return (Package (0x04)\n                        {\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                Zero, \n                                ^^LPCB.LNKA, \n                                Zero\n                            }, \n\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                One, \n                                ^^LPCB.LNKB, \n                                Zero\n                            }, \n\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                0x02, \n                                ^^LPCB.LNKC, \n                                Zero\n                            }, \n\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                0x03, \n                                ^^LPCB.LNKD, \n                                Zero\n                            }\n                        })\n                    }\n                }\n            }\n\n            Device (GFX0)\n            {\n                Name (_ADR, 0x00020000)\n                Method (_DOS, 1, NotSerialized)\n                {\n                    If (LNot (^^LPCB.EC0.C3EN))\n                    {\n                        Store (One, ^^LPCB.EC0.C3EN)\n                        Notify (\\_PR.CPU0, 0x81)\n                        Sleep (0x64)\n                        If (MPEN)\n                        {\n                            Notify (\\_PR.CPU1, 0x81)\n                        }\n                    }\n\n                    Store (And (Arg0, 0x07), DSEN)\n                }\n\n                Method (_DOD, 0, NotSerialized)\n                {\n                    Store (Zero, NDID)\n                    If (LNotEqual (DIDL, Zero))\n                    {\n                        Store (SDDL (DID1), DID1)\n                    }\n\n                    If (LNotEqual (DDL2, Zero))\n                    {\n                        Store (SDDL (DID2), DID2)\n                    }\n\n                    If (LNotEqual (DDL3, Zero))\n                    {\n                        Store (SDDL (DID3), DID3)\n                    }\n\n                    If (LNotEqual (DDL4, Zero))\n                    {\n                        Store (SDDL (DID4), DID4)\n                    }\n\n                    If (LNotEqual (DDL5, Zero))\n                    {\n                        Store (SDDL (DID5), DID5)\n                    }\n\n                    If (LEqual (NDID, One))\n                    {\n                        Name (TMP1, Package (0x01)\n                        {\n                            0xFFFFFFFF\n                        })\n                        Store (Or (0x00010000, DID1), Index (TMP1, Zero))\n                        Return (TMP1)\n                    }\n\n                    If (LEqual (NDID, 0x02))\n                    {\n                        Name (TMP2, Package (0x02)\n                        {\n                            0xFFFFFFFF, \n                            0xFFFFFFFF\n                        })\n                        Store (Or (0x00010000, DID1), Index (TMP2, Zero))\n                        Store (Or (0x00010000, DID2), Index (TMP2, One))\n                        Return (TMP2)\n                    }\n\n                    If (LEqual (NDID, 0x03))\n                    {\n                        Name (TMP3, Package (0x03)\n                        {\n                            0xFFFFFFFF, \n                            0xFFFFFFFF, \n                            0xFFFFFFFF\n                        })\n                        Store (Or (0x00010000, DID1), Index (TMP3, Zero))\n                        Store (Or (0x00010000, DID2), Index (TMP3, One))\n                        Store (Or (0x00010000, DID3), Index (TMP3, 0x02))\n                        Return (TMP3)\n                    }\n\n                    If (LEqual (NDID, 0x04))\n                    {\n                        Name (TMP4, Package (0x04)\n                        {\n                            0xFFFFFFFF, \n                            0xFFFFFFFF, \n                            0xFFFFFFFF, \n                            0xFFFFFFFF\n                        })\n                        Store (Or (0x00010000, DID1), Index (TMP4, Zero))\n                        Store (Or (0x00010000, DID2), Index (TMP4, One))\n                        Store (Or (0x00010000, DID3), Index (TMP4, 0x02))\n                        Store (Or (0x00010000, DID4), Index (TMP4, 0x03))\n                        Return (TMP4)\n                    }\n\n                    If (LGreater (NDID, 0x04))\n                    {\n                        Name (TMP5, Package (0x05)\n                        {\n                            0xFFFFFFFF, \n                            0xFFFFFFFF, \n                            0xFFFFFFFF, \n                            0xFFFFFFFF, \n                            0xFFFFFFFF\n                        })\n                        Store (Or (0x00010000, DID1), Index (TMP5, Zero))\n                        Store (Or (0x00010000, DID2), Index (TMP5, One))\n                        Store (Or (0x00010000, DID3), Index (TMP5, 0x02))\n                        Store (Or (0x00010000, DID4), Index (TMP5, 0x03))\n                        Store (Or (0x00010000, DID4), Index (TMP5, 0x04))\n                        Return (TMP5)\n                    }\n\n                    Return (Package (0x01)\n                    {\n                        0x0400\n                    })\n                }\n\n                Device (DD01)\n                {\n                    Method (_ADR, 0, Serialized)\n                    {\n                        If (LEqual (DID1, Zero))\n                        {\n                            Return (One)\n                        }\n                        Else\n                        {\n                            Return (And (0xFFFF, DID1))\n                        }\n                    }\n\n                    Method (_DCS, 0, NotSerialized)\n                    {\n                        Return (CDDS (DID1))\n                    }\n\n                    Method (_DGS, 0, NotSerialized)\n                    {\n                        Return (NDDS (DID1))\n                    }\n\n                    Method (_DSS, 1, NotSerialized)\n                    {\n                        If (LEqual (And (Arg0, 0xC0000000), 0xC0000000))\n                        {\n                            Store (NSTE, CSTE)\n                        }\n                    }\n                }\n\n                Device (DD02)\n                {\n                    Method (_ADR, 0, Serialized)\n                    {\n                        If (LEqual (DID2, Zero))\n                        {\n                            Return (0x02)\n                        }\n                        Else\n                        {\n                            Return (And (0xFFFF, DID2))\n                        }\n                    }\n\n                    Method (_DCS, 0, NotSerialized)\n                    {\n                        Return (CDDS (DID2))\n                    }\n\n                    Method (_DGS, 0, NotSerialized)\n                    {\n                        Return (NDDS (DID2))\n                    }\n\n                    Method (_DSS, 1, NotSerialized)\n                    {\n                        If (LEqual (And (Arg0, 0xC0000000), 0xC0000000))\n                        {\n                            Store (NSTE, CSTE)\n                        }\n                    }\n                }\n\n                Device (DD03)\n                {\n                    Method (_ADR, 0, Serialized)\n                    {\n                        If (LEqual (DID3, Zero))\n                        {\n                            Return (0x03)\n                        }\n                        Else\n                        {\n                            Return (And (0xFFFF, DID3))\n                        }\n                    }\n\n                    Method (_DCS, 0, NotSerialized)\n                    {\n                        If (LEqual (DID3, Zero))\n                        {\n                            Return (0x0B)\n                        }\n                        Else\n                        {\n                            Return (CDDS (DID3))\n                        }\n                    }\n\n                    Method (_DGS, 0, NotSerialized)\n                    {\n                        Return (NDDS (DID3))\n                    }\n\n                    Method (_DSS, 1, NotSerialized)\n                    {\n                        If (LEqual (And (Arg0, 0xC0000000), 0xC0000000))\n                        {\n                            Store (NSTE, CSTE)\n                        }\n                    }\n                }\n\n                Device (DD04)\n                {\n                    Method (_ADR, 0, Serialized)\n                    {\n                        If (LEqual (DID4, Zero))\n                        {\n                            Return (0x04)\n                        }\n                        Else\n                        {\n                            Return (And (0xFFFF, DID4))\n                        }\n                    }\n\n                    Method (_DCS, 0, NotSerialized)\n                    {\n                        If (LEqual (DID4, Zero))\n                        {\n                            Return (0x0B)\n                        }\n                        Else\n                        {\n                            Return (CDDS (DID4))\n                        }\n                    }\n\n                    Method (_DGS, 0, NotSerialized)\n                    {\n                        Return (NDDS (DID4))\n                    }\n\n                    Method (_DSS, 1, NotSerialized)\n                    {\n                        If (LEqual (And (Arg0, 0xC0000000), 0xC0000000))\n                        {\n                            Store (NSTE, CSTE)\n                        }\n                    }\n                }\n\n                Device (DD05)\n                {\n                    Method (_ADR, 0, Serialized)\n                    {\n                        If (LEqual (DID5, Zero))\n                        {\n                            Return (0x05)\n                        }\n                        Else\n                        {\n                            Return (And (0xFFFF, DID5))\n                        }\n                    }\n\n                    Method (_DCS, 0, NotSerialized)\n                    {\n                        If (LEqual (DID5, Zero))\n                        {\n                            Return (0x0B)\n                        }\n                        Else\n                        {\n                            Return (CDDS (DID5))\n                        }\n                    }\n\n                    Method (_DGS, 0, NotSerialized)\n                    {\n                        Return (NDDS (DID5))\n                    }\n\n                    Method (_DSS, 1, NotSerialized)\n                    {\n                        If (LEqual (And (Arg0, 0xC0000000), 0xC0000000))\n                        {\n                            Store (NSTE, CSTE)\n                        }\n                    }\n                }\n\n                Method (SDDL, 1, NotSerialized)\n                {\n                    Increment (NDID)\n                    Store (And (Arg0, 0x0F0F), Local0)\n                    Or (0x80000000, Local0, Local1)\n                    If (LEqual (DIDL, Local0))\n                    {\n                        Return (Local1)\n                    }\n\n                    If (LEqual (DDL2, Local0))\n                    {\n                        Return (Local1)\n                    }\n\n                    If (LEqual (DDL3, Local0))\n                    {\n                        Return (Local1)\n                    }\n\n                    If (LEqual (DDL4, Local0))\n                    {\n                        Return (Local1)\n                    }\n\n                    If (LEqual (DDL5, Local0))\n                    {\n                        Return (Local1)\n                    }\n\n                    If (LEqual (DDL6, Local0))\n                    {\n                        Return (Local1)\n                    }\n\n                    If (LEqual (DDL7, Local0))\n                    {\n                        Return (Local1)\n                    }\n\n                    If (LEqual (DDL8, Local0))\n                    {\n                        Return (Local1)\n                    }\n\n                    Return (Zero)\n                }\n\n                Method (CDDS, 1, NotSerialized)\n                {\n                    If (LEqual (CADL, And (Arg0, 0x0F0F)))\n                    {\n                        Return (0x1F)\n                    }\n\n                    If (LEqual (CAL2, And (Arg0, 0x0F0F)))\n                    {\n                        Return (0x1F)\n                    }\n\n                    If (LEqual (CAL3, And (Arg0, 0x0F0F)))\n                    {\n                        Return (0x1F)\n                    }\n\n                    If (LEqual (CAL4, And (Arg0, 0x0F0F)))\n                    {\n                        Return (0x1F)\n                    }\n\n                    If (LEqual (CAL5, And (Arg0, 0x0F0F)))\n                    {\n                        Return (0x1F)\n                    }\n\n                    If (LEqual (CAL6, And (Arg0, 0x0F0F)))\n                    {\n                        Return (0x1F)\n                    }\n\n                    If (LEqual (CAL7, And (Arg0, 0x0F0F)))\n                    {\n                        Return (0x1F)\n                    }\n\n                    If (LEqual (CAL8, And (Arg0, 0x0F0F)))\n                    {\n                        Return (0x1F)\n                    }\n\n                    Return (0x1D)\n                }\n\n                Method (NDDS, 1, NotSerialized)\n                {\n                    If (LEqual (NADL, And (Arg0, 0x0F0F)))\n                    {\n                        Return (One)\n                    }\n\n                    If (LEqual (NDL2, And (Arg0, 0x0F0F)))\n                    {\n                        Return (One)\n                    }\n\n                    If (LEqual (NDL3, And (Arg0, 0x0F0F)))\n                    {\n                        Return (One)\n                    }\n\n                    If (LEqual (NDL4, And (Arg0, 0x0F0F)))\n                    {\n                        Return (One)\n                    }\n\n                    If (LEqual (NDL5, And (Arg0, 0x0F0F)))\n                    {\n                        Return (One)\n                    }\n\n                    If (LEqual (NDL6, And (Arg0, 0x0F0F)))\n                    {\n                        Return (One)\n                    }\n\n                    If (LEqual (NDL7, And (Arg0, 0x0F0F)))\n                    {\n                        Return (One)\n                    }\n\n                    If (LEqual (NDL8, And (Arg0, 0x0F0F)))\n                    {\n                        Return (One)\n                    }\n\n                    Return (Zero)\n                }\n\n                Scope (^^PCI0)\n                {\n                    OperationRegion (MCHP, PCI_Config, 0x40, 0xC0)\n                    Field (MCHP, AnyAcc, NoLock, Preserve)\n                    {\n                                Offset (0x60), \n                        TASM,   10, \n                                Offset (0x62)\n                    }\n                }\n\n                OperationRegion (IGDP, PCI_Config, 0x40, 0xC0)\n                Field (IGDP, AnyAcc, NoLock, Preserve)\n                {\n                            Offset (0x12), \n                        ,   1, \n                    GIVD,   1, \n                        ,   2, \n                    GUMA,   3, \n                            Offset (0x14), \n                        ,   4, \n                    GMFN,   1, \n                            Offset (0x18), \n                            Offset (0xA4), \n                    ASLE,   8, \n                            Offset (0xA8), \n                    GSSE,   1, \n                    GSSB,   14, \n                    GSES,   1, \n                            Offset (0xB0), \n                            Offset (0xB1), \n                    CDVL,   5, \n                            Offset (0xB2), \n                            Offset (0xB5), \n                    LBPC,   8, \n                            Offset (0xBC), \n                    ASLS,   32\n                }\n\n                OperationRegion (IGDM, SystemMemory, ASLB, 0x2000)\n                Field (IGDM, AnyAcc, NoLock, Preserve)\n                {\n                    SIGN,   128, \n                    SIZE,   32, \n                    OVER,   32, \n                    SVER,   256, \n                    VVER,   128, \n                    GVER,   128, \n                    MBOX,   32, \n                            Offset (0x100), \n                    DRDY,   32, \n                    CSTS,   32, \n                    CEVT,   32, \n                            Offset (0x120), \n                    DIDL,   32, \n                    DDL2,   32, \n                    DDL3,   32, \n                    DDL4,   32, \n                    DDL5,   32, \n                    DDL6,   32, \n                    DDL7,   32, \n                    DDL8,   32, \n                    CPDL,   32, \n                    CPL2,   32, \n                    CPL3,   32, \n                    CPL4,   32, \n                    CPL5,   32, \n                    CPL6,   32, \n                    CPL7,   32, \n                    CPL8,   32, \n                    CADL,   32, \n                    CAL2,   32, \n                    CAL3,   32, \n                    CAL4,   32, \n                    CAL5,   32, \n                    CAL6,   32, \n                    CAL7,   32, \n                    CAL8,   32, \n                    NADL,   32, \n                    NDL2,   32, \n                    NDL3,   32, \n                    NDL4,   32, \n                    NDL5,   32, \n                    NDL6,   32, \n                    NDL7,   32, \n                    NDL8,   32, \n                    ASLP,   32, \n                    TIDX,   32, \n                    CHPD,   32, \n                    CLID,   32, \n                    CDCK,   32, \n                    SXSW,   32, \n                    EVTS,   32, \n                    CNOT,   32, \n                    NRDY,   32, \n                            Offset (0x200), \n                    SCIE,   1, \n                    GEFC,   4, \n                    GXFC,   3, \n                    GESF,   8, \n                            Offset (0x204), \n                    PARM,   32, \n                    DSLP,   32, \n                            Offset (0x300), \n                    ARDY,   32, \n                    ASLC,   32, \n                    TCHE,   32, \n                    ALSI,   32, \n                    BCLP,   32, \n                    PFIT,   32, \n                    CBLV,   32, \n                    BCLM,   320, \n                    CPFM,   32, \n                    EPFM,   32, \n                            Offset (0x400), \n                    GVD1,   57344\n                }\n\n                Name (DBTB, Package (0x15)\n                {\n                    Zero, \n                    0x07, \n                    0x38, \n                    0x01C0, \n                    0x0E00, \n                    0x3F, \n                    0x01C7, \n                    0x0E07, \n                    0x01F8, \n                    0x0E38, \n                    0x0FC0, \n                    Zero, \n                    Zero, \n                    Zero, \n                    Zero, \n                    Zero, \n                    0x7000, \n                    0x7007, \n                    0x7038, \n                    0x71C0, \n                    0x7E00\n                })\n                Name (CDCT, Package (0x03)\n                {\n                    Package (0x03)\n                    {\n                        0xC8, \n                        0x0140, \n                        0x0190\n                    }, \n\n                    Package (0x03)\n                    {\n                        0xC8, \n                        0x014D, \n                        0x0190\n                    }, \n\n                    Package (0x03)\n                    {\n                        0xDE, \n                        0x014D, \n                        0x017D\n                    }\n                })\n                Name (SUCC, One)\n                Name (NVLD, 0x02)\n                Name (CRIT, 0x04)\n                Name (NCRT, 0x06)\n                Method (GSCI, 0, Serialized)\n                {\n                    Method (GBDA, 0, Serialized)\n                    {\n                        If (LEqual (GESF, Zero))\n                        {\n                            Store (0x0279, PARM)\n                            Store (Zero, GESF)\n                            Return (SUCC)\n                        }\n\n                        If (LEqual (GESF, One))\n                        {\n                            Store (0x0240, PARM)\n                            Store (Zero, GESF)\n                            Return (SUCC)\n                        }\n\n                        If (LEqual (GESF, 0x04))\n                        {\n                            And (PARM, 0xEFFF0000, PARM)\n                            And (PARM, ShiftLeft (DerefOf (Index (DBTB, IBTT)), 0x10), \n                                PARM)\n                            Or (IBTT, PARM, PARM)\n                            Store (Zero, GESF)\n                            Return (SUCC)\n                        }\n\n                        If (LEqual (GESF, 0x05))\n                        {\n                            Store (IPSC, PARM)\n                            Or (PARM, ShiftLeft (IPAT, 0x08), PARM)\n                            Add (PARM, 0x0100, PARM)\n                            Or (PARM, ShiftLeft (LIDS, 0x10), PARM)\n                            Add (PARM, 0x00010000, PARM)\n                            Or (PARM, ShiftLeft (IBIA, 0x14), PARM)\n                            Store (Zero, GESF)\n                            Return (SUCC)\n                        }\n\n                        If (LEqual (GESF, 0x06))\n                        {\n                            Store (ITVF, PARM)\n                            Or (PARM, ShiftLeft (ITVM, 0x04), PARM)\n                            Store (Zero, GESF)\n                            Return (SUCC)\n                        }\n\n                        If (LEqual (GESF, 0x07))\n                        {\n                            Store (GIVD, PARM)\n                            XOr (PARM, One, PARM)\n                            Or (PARM, ShiftLeft (GMFN, One), PARM)\n                            Or (PARM, 0x1000, PARM)\n                            If (IDMM)\n                            {\n                                Or (PARM, ShiftLeft (IDMS, 0x11), PARM)\n                            }\n                            Else\n                            {\n                                Or (PARM, ShiftLeft (IDMS, 0x0D), PARM)\n                            }\n\n                            Or (ShiftLeft (DerefOf (Index (DerefOf (Index (CDCT, HVCO)), Subtract (\n                                CDVL, One))), 0x15), PARM, PARM)\n                            Store (One, GESF)\n                            Return (SUCC)\n                        }\n\n                        If (LEqual (GESF, 0x0A))\n                        {\n                            Store (Zero, PARM)\n                            If (ISSC)\n                            {\n                                Or (PARM, 0x03, PARM)\n                            }\n\n                            Store (Zero, GESF)\n                            Return (SUCC)\n                        }\n\n                        Store (Zero, GESF)\n                        Return (CRIT)\n                    }\n\n                    Method (SBCB, 0, Serialized)\n                    {\n                        If (LEqual (GESF, Zero))\n                        {\n                            Store (0x40, PARM)\n                            Store (0xF7FD, PARM)\n                            Store (Zero, GESF)\n                            Return (SUCC)\n                        }\n\n                        If (LEqual (GESF, One))\n                        {\n                            Store (Zero, GESF)\n                            Store (Zero, PARM)\n                            Return (SUCC)\n                        }\n\n                        If (LEqual (GESF, 0x03))\n                        {\n                            Store (Zero, GESF)\n                            Store (Zero, PARM)\n                            Return (SUCC)\n                        }\n\n                        If (LEqual (GESF, 0x04))\n                        {\n                            Store (Zero, GESF)\n                            Store (Zero, PARM)\n                            Return (SUCC)\n                        }\n\n                        If (LEqual (GESF, 0x05))\n                        {\n                            Store (Zero, GESF)\n                            Store (Zero, PARM)\n                            Return (SUCC)\n                        }\n\n                        If (LEqual (GESF, 0x06))\n                        {\n                            Store (And (PARM, 0x0F), ITVF)\n                            Store (ShiftRight (And (PARM, 0xF0), 0x04), ITVM)\n                            Store (Zero, GESF)\n                            Store (Zero, PARM)\n                            Return (SUCC)\n                        }\n\n                        If (LEqual (GESF, 0x07))\n                        {\n                            If (LEqual (PARM, Zero))\n                            {\n                                Store (CLID, Local0)\n                                If (And (0x80000000, Local0))\n                                {\n                                    And (CLID, 0x0F, CLID)\n                                    GLID (CLID)\n                                }\n                            }\n\n                            Store (Zero, GESF)\n                            Store (Zero, PARM)\n                            Return (SUCC)\n                        }\n\n                        If (LEqual (GESF, 0x08))\n                        {\n                            Store (Zero, GESF)\n                            Store (Zero, PARM)\n                            Return (SUCC)\n                        }\n\n                        If (LEqual (GESF, 0x09))\n                        {\n                            And (PARM, 0xFF, IBTT)\n                            Store (Zero, GESF)\n                            Store (Zero, PARM)\n                            Return (SUCC)\n                        }\n\n                        If (LEqual (GESF, 0x0A))\n                        {\n                            And (PARM, 0xFF, IPSC)\n                            If (And (ShiftRight (PARM, 0x08), 0xFF))\n                            {\n                                And (ShiftRight (PARM, 0x08), 0xFF, IPAT)\n                                Decrement (IPAT)\n                            }\n\n                            And (ShiftRight (PARM, 0x14), 0x07, IBIA)\n                            Store (Zero, GESF)\n                            Store (Zero, PARM)\n                            Return (SUCC)\n                        }\n\n                        If (LEqual (GESF, 0x0B))\n                        {\n                            And (ShiftRight (PARM, One), One, IF1E)\n                            If (And (PARM, 0x0001E000))\n                            {\n                                And (ShiftRight (PARM, 0x0D), 0x0F, IDMS)\n                                Store (Zero, IDMM)\n                            }\n                            Else\n                            {\n                                And (ShiftRight (PARM, 0x11), 0x0F, IDMS)\n                                Store (One, IDMM)\n                            }\n\n                            Store (Zero, GESF)\n                            Store (Zero, PARM)\n                            Return (SUCC)\n                        }\n\n                        If (LEqual (GESF, 0x10))\n                        {\n                            Store (Zero, GESF)\n                            Store (Zero, PARM)\n                            Return (SUCC)\n                        }\n\n                        If (LEqual (GESF, 0x11))\n                        {\n                            Store (ShiftLeft (LIDS, 0x08), PARM)\n                            Add (PARM, 0x0100, PARM)\n                            Store (Zero, GESF)\n                            Return (SUCC)\n                        }\n\n                        If (LEqual (GESF, 0x12))\n                        {\n                            If (And (PARM, One))\n                            {\n                                If (LEqual (ShiftRight (PARM, One), One))\n                                {\n                                    Store (One, ISSC)\n                                }\n                                Else\n                                {\n                                    Store (Zero, GESF)\n                                    Return (CRIT)\n                                }\n                            }\n                            Else\n                            {\n                                Store (Zero, ISSC)\n                            }\n\n                            Store (Zero, GESF)\n                            Store (Zero, PARM)\n                            Return (SUCC)\n                        }\n\n                        If (LEqual (GESF, 0x13))\n                        {\n                            Store (Zero, GESF)\n                            Store (Zero, PARM)\n                            Return (SUCC)\n                        }\n\n                        Store (Zero, GESF)\n                        Return (SUCC)\n                    }\n\n                    If (LEqual (GEFC, 0x04))\n                    {\n                        Store (GBDA (), GXFC)\n                    }\n\n                    If (LEqual (GEFC, 0x06))\n                    {\n                        Store (SBCB (), GXFC)\n                    }\n\n                    Store (Zero, GEFC)\n                    Store (One, SCIS)\n                    Store (Zero, GSSE)\n                    Store (Zero, SCIE)\n                    Return (Zero)\n                }\n\n                Method (PDRD, 0, NotSerialized)\n                {\n                    If (LNot (DRDY))\n                    {\n                        Sleep (ASLP)\n                    }\n\n                    Return (LNot (DRDY))\n                }\n\n                Method (PSTS, 0, NotSerialized)\n                {\n                    If (LGreater (CSTS, 0x02))\n                    {\n                        Sleep (ASLP)\n                    }\n\n                    Return (LEqual (CSTS, 0x03))\n                }\n\n                Method (GNOT, 2, NotSerialized)\n                {\n                    If (PDRD ())\n                    {\n                        Return (One)\n                    }\n\n                    Store (Arg0, CEVT)\n                    Store (0x03, CSTS)\n                    If (LAnd (LEqual (CHPD, Zero), LEqual (Arg1, Zero)))\n                    {\n                        If (LOr (LGreater (OSYS, 0x07D0), LLess (OSYS, 0x07D6)))\n                        {\n                            Notify (PCI0, Arg1)\n                        }\n                        Else\n                        {\n                            Notify (GFX0, Arg1)\n                        }\n                    }\n\n                    Notify (GFX0, 0x80)\n                    Return (Zero)\n                }\n\n                Method (GHDS, 1, NotSerialized)\n                {\n                    Store (Arg0, TIDX)\n                    Return (GNOT (One, Zero))\n                }\n\n                Method (GLID, 1, NotSerialized)\n                {\n                    Store (Arg0, CLID)\n                    Return (GNOT (0x02, Zero))\n                }\n\n                Method (GDCK, 1, NotSerialized)\n                {\n                    Store (Arg0, CDCK)\n                    Return (GNOT (0x04, Zero))\n                }\n\n                Method (PARD, 0, NotSerialized)\n                {\n                    If (LNot (ARDY))\n                    {\n                        Sleep (ASLP)\n                    }\n\n                    Return (LNot (ARDY))\n                }\n\n                Method (AINT, 2, NotSerialized)\n                {\n                    If (LNot (And (TCHE, ShiftLeft (One, Arg0))))\n                    {\n                        Return (One)\n                    }\n\n                    If (PARD ())\n                    {\n                        Return (One)\n                    }\n\n                    If (LEqual (Arg0, 0x02))\n                    {\n                        If (CPFM)\n                        {\n                            And (CPFM, 0x0F, Local0)\n                            And (EPFM, 0x0F, Local1)\n                            If (LEqual (Local0, One))\n                            {\n                                If (And (Local1, 0x06))\n                                {\n                                    Store (0x06, PFIT)\n                                }\n                                Else\n                                {\n                                    If (And (Local1, 0x08))\n                                    {\n                                        Store (0x08, PFIT)\n                                    }\n                                    Else\n                                    {\n                                        Store (One, PFIT)\n                                    }\n                                }\n                            }\n\n                            If (LEqual (Local0, 0x06))\n                            {\n                                If (And (Local1, 0x08))\n                                {\n                                    Store (0x08, PFIT)\n                                }\n                                Else\n                                {\n                                    If (And (Local1, One))\n                                    {\n                                        Store (One, PFIT)\n                                    }\n                                    Else\n                                    {\n                                        Store (0x06, PFIT)\n                                    }\n                                }\n                            }\n\n                            If (LEqual (Local0, 0x08))\n                            {\n                                If (And (Local1, One))\n                                {\n                                    Store (One, PFIT)\n                                }\n                                Else\n                                {\n                                    If (And (Local1, 0x06))\n                                    {\n                                        Store (0x06, PFIT)\n                                    }\n                                    Else\n                                    {\n                                        Store (0x08, PFIT)\n                                    }\n                                }\n                            }\n                        }\n                        Else\n                        {\n                            XOr (PFIT, 0x07, PFIT)\n                        }\n\n                        Or (PFIT, 0x80000000, PFIT)\n                        Store (0x04, ASLC)\n                    }\n                    Else\n                    {\n                        If (LEqual (Arg0, One))\n                        {\n                            Store (Divide (Multiply (Arg1, 0xFF), 0x64, ), BCLP)\n                            Or (BCLP, 0x80000000, BCLP)\n                            Store (0x02, ASLC)\n                        }\n                        Else\n                        {\n                            If (LEqual (Arg0, Zero))\n                            {\n                                Store (Arg1, ALSI)\n                                Store (One, ASLC)\n                            }\n                            Else\n                            {\n                                Return (One)\n                            }\n                        }\n                    }\n\n                    Store (Zero, LBPC)\n                    Return (Zero)\n                }\n            }\n\n            Scope (\\)\n            {\n                Method (BRTW, 1, Serialized)\n                {\n                    Store (Arg0, Local1)\n                    If (LEqual (ALSE, 0x02))\n                    {\n                        Store (Divide (Multiply (ALAF, Arg0), 0x64, ), Local1)\n                        If (LGreater (Local1, 0x64))\n                        {\n                            Store (0x64, Local1)\n                        }\n                    }\n\n                    Store (Divide (Multiply (0xFF, Local1), 0x64, ), Local0)\n                    Store (Local0, PRM0)\n                    Store (Arg0, BRTL)\n                    If (LEqual (TRAP (0x12), Zero))\n                    {\n                        P8XH (0x02, Local0)\n                    }\n                }\n\n                Method (HKDS, 1, Serialized)\n                {\n                    If (LEqual (Zero, And (0x03, DSEN)))\n                    {\n                        If (LEqual (TRAP (Arg0), Zero))\n                        {\n                            If (LNotEqual (CADL, PADL))\n                            {\n                                Store (CADL, PADL)\n                                If (LOr (LGreater (OSYS, 0x07D0), LLess (OSYS, 0x07D6)))\n                                {\n                                    Notify (\\_SB.PCI0, Zero)\n                                }\n                                Else\n                                {\n                                    Notify (\\_SB.PCI0.GFX0, Zero)\n                                }\n\n                                Sleep (0x02EE)\n                            }\n\n                            Notify (\\_SB.PCI0.GFX0, 0x80)\n                        }\n                    }\n\n                    If (LEqual (One, And (0x03, DSEN)))\n                    {\n                        If (LEqual (TRAP (Increment (Arg0)), Zero))\n                        {\n                            Notify (\\_SB.PCI0.GFX0, 0x81)\n                        }\n                    }\n                }\n\n                Method (LSDS, 1, Serialized)\n                {\n                    If (Arg0)\n                    {\n                        HKDS (0x0C)\n                    }\n                    Else\n                    {\n                        HKDS (0x0E)\n                    }\n\n                    If (LNotEqual (And (0x03, DSEN), One))\n                    {\n                        Sleep (0x32)\n                        While (LEqual (And (0x03, DSEN), 0x02))\n                        {\n                            Sleep (0x32)\n                        }\n                    }\n                }\n\n                Method (BRTN, 1, Serialized)\n                {\n                    If (LEqual (And (DID1, 0x0F00), 0x0400))\n                    {\n                        Notify (\\_SB.PCI0.GFX0.DD01, Arg0)\n                    }\n\n                    If (LEqual (And (DID2, 0x0F00), 0x0400))\n                    {\n                        Notify (\\_SB.PCI0.GFX0.DD02, Arg0)\n                    }\n\n                    If (LEqual (And (DID3, 0x0F00), 0x0400))\n                    {\n                        Notify (\\_SB.PCI0.GFX0.DD03, Arg0)\n                    }\n\n                    If (LEqual (And (DID4, 0x0F00), 0x0400))\n                    {\n                        Notify (\\_SB.PCI0.GFX0.DD04, Arg0)\n                    }\n\n                    If (LEqual (And (DID5, 0x0F00), 0x0400))\n                    {\n                        Notify (\\_SB.PCI0.GFX0.DD05, Arg0)\n                    }\n                }\n            }\n\n            Scope (\\)\n            {\n                OperationRegion (IO_T, SystemIO, 0x0800, 0x10)\n                Field (IO_T, ByteAcc, NoLock, Preserve)\n                {\n                            Offset (0x08), \n                    TRP0,   8\n                }\n\n                OperationRegion (PMIO, SystemIO, 0x1000, 0x80)\n                Field (PMIO, ByteAcc, NoLock, Preserve)\n                {\n                            Offset (0x01), \n                        ,   2, \n                    RTCW,   1, \n                        ,   3, \n                    PCIW,   1, \n                            Offset (0x10), \n                    THRT,   8, \n                            Offset (0x42), \n                        ,   1, \n                    GPEC,   1, \n                            Offset (0x60), \n                    TCTV,   8, \n                            Offset (0x64), \n                        ,   9, \n                    SCIS,   1, \n                            Offset (0x66), \n                    TCO2,   3, \n                            Offset (0x68), \n                        ,   11, \n                    HALT,   1, \n                            Offset (0x72), \n                    TTIV,   10\n                }\n\n                OperationRegion (GPIO, SystemIO, 0x1180, 0x3C)\n                Field (GPIO, ByteAcc, NoLock, Preserve)\n                {\n                    GU00,   8, \n                    GU01,   8, \n                    GU02,   8, \n                    GU03,   8, \n                    GIO0,   8, \n                    GIO1,   8, \n                    GIO2,   8, \n                    GIO3,   8, \n                            Offset (0x0C), \n                    GL00,   8, \n                    GL01,   8, \n                    GL02,   8, \n                        ,   3, \n                    GP27,   1, \n                    GP28,   1, \n                            Offset (0x10), \n                            Offset (0x18), \n                    GB00,   8, \n                    GB01,   8, \n                    GB02,   8, \n                    GB03,   8, \n                            Offset (0x2C), \n                    GIV0,   8, \n                    GIV1,   8, \n                    GIV2,   8, \n                    GIV3,   8, \n                    GU04,   8, \n                    GU05,   8, \n                    GU06,   8, \n                    GU07,   8, \n                    GIO4,   8, \n                    GIO5,   8, \n                    GIO6,   8, \n                    GIO7,   8, \n                        ,   5, \n                    GP37,   1, \n                            Offset (0x39), \n                    GL05,   8, \n                    GL06,   8, \n                    GL07,   8\n                }\n\n                OperationRegion (RCRB, SystemMemory, 0xFED1C000, 0x4000)\n                Field (RCRB, DWordAcc, Lock, Preserve)\n                {\n                            Offset (0x1000), \n                            Offset (0x3000), \n                            Offset (0x3404), \n                    HPAS,   2, \n                        ,   5, \n                    HPAE,   1, \n                            Offset (0x3410), \n                        ,   5, \n                    __NR,   1, \n                            Offset (0x3418), \n                        ,   1, \n                    PATD,   1, \n                    SATD,   1, \n                    SMBD,   1, \n                    HDAD,   1, \n                            Offset (0x341A), \n                    RP1D,   1, \n                    RP2D,   1, \n                    RP3D,   1, \n                    RP4D,   1, \n                    RP5D,   1, \n                    RP6D,   1\n                }\n\n                Name (_S0, Package (0x03)\n                {\n                    Zero, \n                    Zero, \n                    Zero\n                })\n                Name (_S3, Package (0x03)\n                {\n                    0x05, \n                    0x05, \n                    Zero\n                })\n                Name (_S4, Package (0x03)\n                {\n                    0x06, \n                    0x06, \n                    Zero\n                })\n                Name (_S5, Package (0x03)\n                {\n                    0x07, \n                    0x07, \n                    Zero\n                })\n                Method (GETP, 1, Serialized)\n                {\n                    If (LEqual (And (Arg0, 0x09), Zero))\n                    {\n                        Return (0xFFFFFFFF)\n                    }\n\n                    If (LEqual (And (Arg0, 0x09), 0x08))\n                    {\n                        Return (0x0384)\n                    }\n\n                    ShiftRight (And (Arg0, 0x0300), 0x08, Local0)\n                    ShiftRight (And (Arg0, 0x3000), 0x0C, Local1)\n                    Return (Multiply (0x1E, Subtract (0x09, Add (Local0, Local1))\n                        ))\n                }\n\n                Method (GDMA, 5, Serialized)\n                {\n                    If (Arg0)\n                    {\n                        If (LAnd (Arg1, Arg4))\n                        {\n                            Return (0x14)\n                        }\n\n                        If (LAnd (Arg2, Arg4))\n                        {\n                            Return (Multiply (Subtract (0x04, Arg3), 0x0F))\n                        }\n\n                        Return (Multiply (Subtract (0x04, Arg3), 0x1E))\n                    }\n\n                    Return (0xFFFFFFFF)\n                }\n\n                Method (GETT, 1, Serialized)\n                {\n                    Return (Multiply (0x1E, Subtract (0x09, Add (And (ShiftRight (Arg0, 0x02\n                        ), 0x03), And (Arg0, 0x03)))))\n                }\n\n                Method (GETF, 3, Serialized)\n                {\n                    Name (TMPF, Zero)\n                    If (Arg0)\n                    {\n                        Or (TMPF, One, TMPF)\n                    }\n\n                    If (And (Arg2, 0x02))\n                    {\n                        Or (TMPF, 0x02, TMPF)\n                    }\n\n                    If (Arg1)\n                    {\n                        Or (TMPF, 0x04, TMPF)\n                    }\n\n                    If (And (Arg2, 0x20))\n                    {\n                        Or (TMPF, 0x08, TMPF)\n                    }\n\n                    If (And (Arg2, 0x4000))\n                    {\n                        Or (TMPF, 0x10, TMPF)\n                    }\n\n                    Return (TMPF)\n                }\n\n                Method (SETP, 3, Serialized)\n                {\n                    If (LGreater (Arg0, 0xF0))\n                    {\n                        Return (0x08)\n                    }\n                    Else\n                    {\n                        If (And (Arg1, 0x02))\n                        {\n                            If (LAnd (LLessEqual (Arg0, 0x78), And (Arg2, 0x02)))\n                            {\n                                Return (0x2301)\n                            }\n\n                            If (LAnd (LLessEqual (Arg0, 0xB4), And (Arg2, One)))\n                            {\n                                Return (0x2101)\n                            }\n                        }\n\n                        Return (0x1001)\n                    }\n                }\n\n                Method (SDMA, 1, Serialized)\n                {\n                    If (LLessEqual (Arg0, 0x14))\n                    {\n                        Return (One)\n                    }\n\n                    If (LLessEqual (Arg0, 0x1E))\n                    {\n                        Return (0x02)\n                    }\n\n                    If (LLessEqual (Arg0, 0x2D))\n                    {\n                        Return (One)\n                    }\n\n                    If (LLessEqual (Arg0, 0x3C))\n                    {\n                        Return (0x02)\n                    }\n\n                    If (LLessEqual (Arg0, 0x5A))\n                    {\n                        Return (One)\n                    }\n\n                    Return (Zero)\n                }\n\n                Method (SETT, 3, Serialized)\n                {\n                    If (And (Arg1, 0x02))\n                    {\n                        If (LAnd (LLessEqual (Arg0, 0x78), And (Arg2, 0x02)))\n                        {\n                            Return (0x0B)\n                        }\n\n                        If (LAnd (LLessEqual (Arg0, 0xB4), And (Arg2, One)))\n                        {\n                            Return (0x09)\n                        }\n                    }\n\n                    Return (0x04)\n                }\n            }\n\n            Device (HDEF)\n            {\n                Name (_ADR, 0x001B0000)\n                OperationRegion (HDAR, PCI_Config, 0x4C, 0x10)\n                Field (HDAR, WordAcc, NoLock, Preserve)\n                {\n                    DCKA,   1, \n                            Offset (0x01), \n                    DCKM,   1, \n                        ,   6, \n                    DCKS,   1, \n                            Offset (0x08), \n                        ,   15, \n                    PMES,   1\n                }\n\n                Name (_PRW, Package (0x02)\n                {\n                    0x0D, \n                    0x04\n                })\n            }\n\n            Device (RP01)\n            {\n                Name (_ADR, 0x001C0000)\n                OperationRegion (PXCS, PCI_Config, 0x40, 0xC0)\n                Field (PXCS, AnyAcc, NoLock, WriteAsZeros)\n                {\n                            Offset (0x12), \n                        ,   13, \n                    LASX,   1, \n                            Offset (0x1A), \n                    ABPX,   1, \n                        ,   2, \n                    PDCX,   1, \n                        ,   2, \n                    PDSX,   1, \n                            Offset (0x1B), \n                    LSCX,   1, \n                            Offset (0x20), \n                            Offset (0x22), \n                    PSPX,   1, \n                            Offset (0x98), \n                        ,   30, \n                    HPEX,   1, \n                    PMEX,   1, \n                        ,   30, \n                    HPSX,   1, \n                    PMSX,   1\n                }\n\n                Device (PXSX)\n                {\n                    Name (_ADR, Zero)\n                    Name (_PRW, Package (0x02)\n                    {\n                        0x09, \n                        0x04\n                    })\n                }\n\n                Name (PXSX._RMV, One)\n                Method (_PRT, 0, NotSerialized)\n                {\n                    If (GPIC)\n                    {\n                        Return (Package (0x04)\n                        {\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                Zero, \n                                Zero, \n                                0x10\n                            }, \n\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                One, \n                                Zero, \n                                0x11\n                            }, \n\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                0x02, \n                                Zero, \n                                0x12\n                            }, \n\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                0x03, \n                                Zero, \n                                0x13\n                            }\n                        })\n                    }\n                    Else\n                    {\n                        Return (Package (0x04)\n                        {\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                Zero, \n                                ^^LPCB.LNKA, \n                                Zero\n                            }, \n\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                One, \n                                ^^LPCB.LNKB, \n                                Zero\n                            }, \n\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                0x02, \n                                ^^LPCB.LNKC, \n                                Zero\n                            }, \n\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                0x03, \n                                ^^LPCB.LNKD, \n                                Zero\n                            }\n                        })\n                    }\n                }\n            }\n\n            Device (RP02)\n            {\n                Name (_ADR, 0x001C0001)\n                OperationRegion (PXCS, PCI_Config, 0x40, 0xC0)\n                Field (PXCS, AnyAcc, NoLock, WriteAsZeros)\n                {\n                            Offset (0x12), \n                        ,   13, \n                    LASX,   1, \n                            Offset (0x1A), \n                    ABPX,   1, \n                        ,   2, \n                    PDCX,   1, \n                        ,   2, \n                    PDSX,   1, \n                            Offset (0x1B), \n                    LSCX,   1, \n                            Offset (0x20), \n                            Offset (0x22), \n                    PSPX,   1, \n                            Offset (0x98), \n                        ,   30, \n                    HPEX,   1, \n                    PMEX,   1, \n                        ,   30, \n                    HPSX,   1, \n                    PMSX,   1\n                }\n\n                Device (PXSX)\n                {\n                    Name (_ADR, Zero)\n                    Name (_PRW, Package (0x02)\n                    {\n                        0x09, \n                        0x04\n                    })\n                }\n\n                Name (PXSX._RMV, One)\n                Method (_PRT, 0, NotSerialized)\n                {\n                    If (GPIC)\n                    {\n                        Return (Package (0x04)\n                        {\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                Zero, \n                                Zero, \n                                0x11\n                            }, \n\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                One, \n                                Zero, \n                                0x12\n                            }, \n\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                0x02, \n                                Zero, \n                                0x13\n                            }, \n\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                0x03, \n                                Zero, \n                                0x10\n                            }\n                        })\n                    }\n                    Else\n                    {\n                        Return (Package (0x04)\n                        {\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                Zero, \n                                ^^LPCB.LNKB, \n                                Zero\n                            }, \n\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                One, \n                                ^^LPCB.LNKC, \n                                Zero\n                            }, \n\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                0x02, \n                                ^^LPCB.LNKD, \n                                Zero\n                            }, \n\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                0x03, \n                                ^^LPCB.LNKA, \n                                Zero\n                            }\n                        })\n                    }\n                }\n            }\n\n            Device (RP03)\n            {\n                Name (_ADR, 0x001C0002)\n                OperationRegion (PXCS, PCI_Config, 0x40, 0xC0)\n                Field (PXCS, AnyAcc, NoLock, WriteAsZeros)\n                {\n                            Offset (0x12), \n                        ,   13, \n                    LASX,   1, \n                            Offset (0x1A), \n                    ABPX,   1, \n                        ,   2, \n                    PDCX,   1, \n                        ,   2, \n                    PDSX,   1, \n                            Offset (0x1B), \n                    LSCX,   1, \n                            Offset (0x20), \n                            Offset (0x22), \n                    PSPX,   1, \n                            Offset (0x98), \n                        ,   30, \n                    HPEX,   1, \n                    PMEX,   1, \n                        ,   30, \n                    HPSX,   1, \n                    PMSX,   1\n                }\n\n                Device (PXSX)\n                {\n                    Name (_ADR, Zero)\n                    Name (_PRW, Package (0x02)\n                    {\n                        0x09, \n                        0x04\n                    })\n                }\n\n                Method (_PRT, 0, NotSerialized)\n                {\n                    If (GPIC)\n                    {\n                        Return (Package (0x04)\n                        {\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                Zero, \n                                Zero, \n                                0x12\n                            }, \n\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                One, \n                                Zero, \n                                0x13\n                            }, \n\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                0x02, \n                                Zero, \n                                0x10\n                            }, \n\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                0x03, \n                                Zero, \n                                0x11\n                            }\n                        })\n                    }\n                    Else\n                    {\n                        Return (Package (0x04)\n                        {\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                Zero, \n                                ^^LPCB.LNKC, \n                                Zero\n                            }, \n\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                One, \n                                ^^LPCB.LNKD, \n                                Zero\n                            }, \n\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                0x02, \n                                ^^LPCB.LNKA, \n                                Zero\n                            }, \n\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                0x03, \n                                ^^LPCB.LNKB, \n                                Zero\n                            }\n                        })\n                    }\n                }\n            }\n\n            Device (RP04)\n            {\n                Name (_ADR, 0x001C0003)\n                OperationRegion (PXCS, PCI_Config, 0x40, 0xC0)\n                Field (PXCS, AnyAcc, NoLock, WriteAsZeros)\n                {\n                            Offset (0x12), \n                        ,   13, \n                    LASX,   1, \n                            Offset (0x1A), \n                    ABPX,   1, \n                        ,   2, \n                    PDCX,   1, \n                        ,   2, \n                    PDSX,   1, \n                            Offset (0x1B), \n                    LSCX,   1, \n                            Offset (0x20), \n                            Offset (0x22), \n                    PSPX,   1, \n                            Offset (0x98), \n                        ,   30, \n                    HPEX,   1, \n                    PMEX,   1, \n                        ,   30, \n                    HPSX,   1, \n                    PMSX,   1\n                }\n\n                Device (PXSX)\n                {\n                    Name (_ADR, Zero)\n                    Name (_PRW, Package (0x02)\n                    {\n                        0x09, \n                        0x04\n                    })\n                }\n\n                Method (_PRT, 0, NotSerialized)\n                {\n                    If (GPIC)\n                    {\n                        Return (Package (0x04)\n                        {\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                Zero, \n                                Zero, \n                                0x13\n                            }, \n\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                One, \n                                Zero, \n                                0x10\n                            }, \n\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                0x02, \n                                Zero, \n                                0x11\n                            }, \n\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                0x03, \n                                Zero, \n                                0x12\n                            }\n                        })\n                    }\n                    Else\n                    {\n                        Return (Package (0x04)\n                        {\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                Zero, \n                                ^^LPCB.LNKD, \n                                Zero\n                            }, \n\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                One, \n                                ^^LPCB.LNKA, \n                                Zero\n                            }, \n\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                0x02, \n                                ^^LPCB.LNKB, \n                                Zero\n                            }, \n\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                0x03, \n                                ^^LPCB.LNKC, \n                                Zero\n                            }\n                        })\n                    }\n                }\n            }\n\n            Device (RP05)\n            {\n                Name (_ADR, 0x001C0004)\n                OperationRegion (PXCS, PCI_Config, 0x40, 0xC0)\n                Field (PXCS, AnyAcc, NoLock, WriteAsZeros)\n                {\n                            Offset (0x12), \n                        ,   13, \n                    LASX,   1, \n                            Offset (0x1A), \n                    ABPX,   1, \n                        ,   2, \n                    PDCX,   1, \n                        ,   2, \n                    PDSX,   1, \n                            Offset (0x1B), \n                    LSCX,   1, \n                            Offset (0x20), \n                            Offset (0x22), \n                    PSPX,   1, \n                            Offset (0x98), \n                        ,   30, \n                    HPEX,   1, \n                    PMEX,   1, \n                        ,   30, \n                    HPSX,   1, \n                    PMSX,   1\n                }\n\n                Device (PXSX)\n                {\n                    Name (_ADR, Zero)\n                    Name (_PRW, Package (0x02)\n                    {\n                        0x09, \n                        0x04\n                    })\n                }\n\n                Name (PXSX._RMV, One)\n                Method (_PRT, 0, NotSerialized)\n                {\n                    If (GPIC)\n                    {\n                        Return (Package (0x04)\n                        {\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                Zero, \n                                Zero, \n                                0x10\n                            }, \n\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                One, \n                                Zero, \n                                0x11\n                            }, \n\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                0x02, \n                                Zero, \n                                0x12\n                            }, \n\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                0x03, \n                                Zero, \n                                0x13\n                            }\n                        })\n                    }\n                    Else\n                    {\n                        Return (Package (0x04)\n                        {\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                Zero, \n                                ^^LPCB.LNKA, \n                                Zero\n                            }, \n\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                One, \n                                ^^LPCB.LNKB, \n                                Zero\n                            }, \n\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                0x02, \n                                ^^LPCB.LNKC, \n                                Zero\n                            }, \n\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                0x03, \n                                ^^LPCB.LNKD, \n                                Zero\n                            }\n                        })\n                    }\n                }\n            }\n\n            Device (RP06)\n            {\n                Name (_ADR, 0x001C0005)\n                OperationRegion (PXCS, PCI_Config, 0x40, 0xC0)\n                Field (PXCS, AnyAcc, NoLock, WriteAsZeros)\n                {\n                            Offset (0x12), \n                        ,   13, \n                    LASX,   1, \n                            Offset (0x1A), \n                    ABPX,   1, \n                        ,   2, \n                    PDCX,   1, \n                        ,   2, \n                    PDSX,   1, \n                            Offset (0x1B), \n                    LSCX,   1, \n                            Offset (0x20), \n                            Offset (0x22), \n                    PSPX,   1, \n                            Offset (0x98), \n                        ,   30, \n                    HPEX,   1, \n                    PMEX,   1, \n                        ,   30, \n                    HPSX,   1, \n                    PMSX,   1\n                }\n\n                Device (PXSX)\n                {\n                    Name (_ADR, Zero)\n                    Name (_PRW, Package (0x02)\n                    {\n                        0x09, \n                        0x04\n                    })\n                }\n\n                Name (PXSX._RMV, One)\n                Method (_PRT, 0, NotSerialized)\n                {\n                    If (GPIC)\n                    {\n                        Return (Package (0x04)\n                        {\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                Zero, \n                                Zero, \n                                0x11\n                            }, \n\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                One, \n                                Zero, \n                                0x12\n                            }, \n\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                0x02, \n                                Zero, \n                                0x13\n                            }, \n\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                0x03, \n                                Zero, \n                                0x10\n                            }\n                        })\n                    }\n                    Else\n                    {\n                        Return (Package (0x04)\n                        {\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                Zero, \n                                ^^LPCB.LNKB, \n                                Zero\n                            }, \n\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                One, \n                                ^^LPCB.LNKC, \n                                Zero\n                            }, \n\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                0x02, \n                                ^^LPCB.LNKD, \n                                Zero\n                            }, \n\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                0x03, \n                                ^^LPCB.LNKA, \n                                Zero\n                            }\n                        })\n                    }\n                }\n            }\n\n            Method (NHPG, 0, Serialized)\n            {\n                Store (Zero, ^RP01.HPEX)\n                Store (Zero, ^RP02.HPEX)\n                Store (Zero, ^RP03.HPEX)\n                Store (Zero, ^RP04.HPEX)\n                Store (One, ^RP01.HPSX)\n                Store (One, ^RP02.HPSX)\n                Store (One, ^RP03.HPSX)\n                Store (One, ^RP04.HPSX)\n            }\n\n            Method (NPME, 0, Serialized)\n            {\n                Store (Zero, ^RP01.PMEX)\n                Store (Zero, ^RP02.PMEX)\n                Store (Zero, ^RP03.PMEX)\n                Store (Zero, ^RP04.PMEX)\n                Store (Zero, ^RP05.PMEX)\n                Store (Zero, ^RP06.PMEX)\n                Store (One, ^RP01.PMSX)\n                Store (One, ^RP02.PMSX)\n                Store (One, ^RP03.PMSX)\n                Store (One, ^RP04.PMSX)\n                Store (One, ^RP05.PMSX)\n                Store (One, ^RP06.PMSX)\n            }\n\n            Device (USB1)\n            {\n                Name (_ADR, 0x001D0000)\n                OperationRegion (U1CS, PCI_Config, 0xC4, 0x04)\n                Field (U1CS, DWordAcc, NoLock, Preserve)\n                {\n                    U1EN,   2\n                }\n\n                Name (_PRW, Package (0x02)\n                {\n                    0x03, \n                    0x03\n                })\n                Method (_PSW, 1, NotSerialized)\n                {\n                    If (Arg0)\n                    {\n                        Store (0x03, U1EN)\n                    }\n                    Else\n                    {\n                        Store (Zero, U1EN)\n                    }\n                }\n\n                Method (_S3D, 0, NotSerialized)\n                {\n                    Return (0x02)\n                }\n\n                Method (_S4D, 0, NotSerialized)\n                {\n                    Return (0x02)\n                }\n            }\n\n            Device (USB2)\n            {\n                Name (_ADR, 0x001D0001)\n                OperationRegion (U2CS, PCI_Config, 0xC4, 0x04)\n                Field (U2CS, DWordAcc, NoLock, Preserve)\n                {\n                    U2EN,   2\n                }\n\n                Name (_PRW, Package (0x02)\n                {\n                    0x04, \n                    0x03\n                })\n                Method (_PSW, 1, NotSerialized)\n                {\n                    If (Arg0)\n                    {\n                        Store (0x03, U2EN)\n                    }\n                    Else\n                    {\n                        Store (Zero, U2EN)\n                    }\n                }\n\n                Method (_S3D, 0, NotSerialized)\n                {\n                    Return (0x02)\n                }\n\n                Method (_S4D, 0, NotSerialized)\n                {\n                    Return (0x02)\n                }\n            }\n\n            Device (USB3)\n            {\n                Name (_ADR, 0x001D0002)\n                OperationRegion (U2CS, PCI_Config, 0xC4, 0x04)\n                Field (U2CS, DWordAcc, NoLock, Preserve)\n                {\n                    U3EN,   2\n                }\n\n                Name (_PRW, Package (0x02)\n                {\n                    0x0C, \n                    0x03\n                })\n                Method (_PSW, 1, NotSerialized)\n                {\n                    If (Arg0)\n                    {\n                        Store (0x03, U3EN)\n                    }\n                    Else\n                    {\n                        Store (Zero, U3EN)\n                    }\n                }\n\n                Method (_S3D, 0, NotSerialized)\n                {\n                    Return (0x02)\n                }\n\n                Method (_S4D, 0, NotSerialized)\n                {\n                    Return (0x02)\n                }\n            }\n\n            Device (USB4)\n            {\n                Name (_ADR, 0x001A0000)\n                OperationRegion (U4CS, PCI_Config, 0xC4, 0x04)\n                Field (U4CS, DWordAcc, NoLock, Preserve)\n                {\n                    U4EN,   2\n                }\n\n                Name (_PRW, Package (0x02)\n                {\n                    0x0E, \n                    0x03\n                })\n                Method (_PSW, 1, NotSerialized)\n                {\n                    If (Arg0)\n                    {\n                        Store (0x03, U4EN)\n                    }\n                    Else\n                    {\n                        Store (Zero, U4EN)\n                    }\n                }\n\n                Method (_S3D, 0, NotSerialized)\n                {\n                    Return (0x02)\n                }\n\n                Method (_S4D, 0, NotSerialized)\n                {\n                    Return (0x02)\n                }\n            }\n\n            Device (USB5)\n            {\n                Name (_ADR, 0x001A0001)\n                OperationRegion (U5CS, PCI_Config, 0xC4, 0x04)\n                Field (U5CS, DWordAcc, NoLock, Preserve)\n                {\n                    U5EN,   2\n                }\n\n                Name (_PRW, Package (0x02)\n                {\n                    0x05, \n                    0x03\n                })\n                Method (_PSW, 1, NotSerialized)\n                {\n                    If (Arg0)\n                    {\n                        Store (0x03, U5EN)\n                    }\n                    Else\n                    {\n                        Store (Zero, U5EN)\n                    }\n                }\n\n                Method (_S3D, 0, NotSerialized)\n                {\n                    Return (0x02)\n                }\n\n                Method (_S4D, 0, NotSerialized)\n                {\n                    Return (0x02)\n                }\n            }\n\n            Device (EHC1)\n            {\n                Name (_ADR, 0x001D0007)\n                OperationRegion (U7CS, PCI_Config, 0x54, 0x04)\n                Field (U7CS, DWordAcc, NoLock, Preserve)\n                {\n                        ,   15, \n                    PMES,   1\n                }\n\n                Device (HUB7)\n                {\n                    Name (_ADR, Zero)\n                    Device (PRT1)\n                    {\n                        Name (_ADR, One)\n                    }\n\n                    Device (PRT2)\n                    {\n                        Name (_ADR, 0x02)\n                    }\n\n                    Device (PRT3)\n                    {\n                        Name (_ADR, 0x03)\n                    }\n\n                    Device (PRT4)\n                    {\n                        Name (_ADR, 0x04)\n                    }\n\n                    Device (PRT5)\n                    {\n                        Name (_ADR, 0x05)\n                    }\n\n                    Device (PRT6)\n                    {\n                        Name (_ADR, 0x06)\n                    }\n                }\n\n                Name (_PRW, Package (0x02)\n                {\n                    0x0D, \n                    0x03\n                })\n                Method (_S3D, 0, NotSerialized)\n                {\n                    Return (0x02)\n                }\n\n                Method (_S4D, 0, NotSerialized)\n                {\n                    Return (0x02)\n                }\n            }\n\n            Device (EHC2)\n            {\n                Name (_ADR, 0x001A0007)\n                OperationRegion (UFCS, PCI_Config, 0x54, 0x04)\n                Field (UFCS, DWordAcc, NoLock, Preserve)\n                {\n                        ,   15, \n                    PMES,   1\n                }\n\n                Device (HUB7)\n                {\n                    Name (_ADR, Zero)\n                    Device (PRT1)\n                    {\n                        Name (_ADR, One)\n                    }\n\n                    Device (PRT2)\n                    {\n                        Name (_ADR, 0x02)\n                    }\n\n                    Device (PRT3)\n                    {\n                        Name (_ADR, 0x03)\n                    }\n\n                    Device (PRT4)\n                    {\n                        Name (_ADR, 0x04)\n                    }\n                }\n\n                Name (_PRW, Package (0x02)\n                {\n                    0x0D, \n                    0x03\n                })\n                Method (_S3D, 0, NotSerialized)\n                {\n                    Return (0x02)\n                }\n\n                Method (_S4D, 0, NotSerialized)\n                {\n                    Return (0x02)\n                }\n            }\n\n            Device (PCIB)\n            {\n                Name (_ADR, 0x001E0000)\n                Method (_PRT, 0, NotSerialized)\n                {\n                    If (GPIC)\n                    {\n                        Return (Package (0x00) {})\n                    }\n                    Else\n                    {\n                        Return (Package (0x10)\n                        {\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                Zero, \n                                ^^LPCB.LNKF, \n                                Zero\n                            }, \n\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                One, \n                                ^^LPCB.LNKG, \n                                Zero\n                            }, \n\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                0x02, \n                                ^^LPCB.LNKH, \n                                Zero\n                            }, \n\n                            Package (0x04)\n                            {\n                                0xFFFF, \n                                0x03, \n                                ^^LPCB.LNKE, \n                                Zero\n                            }, \n\n                            Package (0x04)\n                            {\n                                0x0001FFFF, \n                                Zero, \n                                ^^LPCB.LNKG, \n                                Zero\n                            }, \n\n                            Package (0x04)\n                            {\n                                0x0001FFFF, \n                                One, \n                                ^^LPCB.LNKF, \n                                Zero\n                            }, \n\n                            Package (0x04)\n                            {\n                                0x0001FFFF, \n                                0x02, \n                                ^^LPCB.LNKE, \n                                Zero\n                            }, \n\n                            Package (0x04)\n                            {\n                                0x0001FFFF, \n                                0x03, \n                                ^^LPCB.LNKH, \n                                Zero\n                            }, \n\n                            Package (0x04)\n                            {\n                                0x0002FFFF, \n                                Zero, \n                                ^^LPCB.LNKC, \n                                Zero\n                            }, \n\n                            Package (0x04)\n                            {\n                                0x0002FFFF, \n                                One, \n                                ^^LPCB.LNKD, \n                                Zero\n                            }, \n\n                            Package (0x04)\n                            {\n                                0x0002FFFF, \n                                0x02, \n                                ^^LPCB.LNKB, \n                                Zero\n                            }, \n\n                            Package (0x04)\n                            {\n                                0x0002FFFF, \n                                0x03, \n                                ^^LPCB.LNKA, \n                                Zero\n                            }, \n\n                            Package (0x04)\n                            {\n                                0x0005FFFF, \n                                Zero, \n                                ^^LPCB.LNKB, \n                                Zero\n                            }, \n\n                            Package (0x04)\n                            {\n                                0x0005FFFF, \n                                One, \n                                ^^LPCB.LNKE, \n                                Zero\n                            }, \n\n                            Package (0x04)\n                            {\n                                0x0005FFFF, \n                                0x02, \n                                ^^LPCB.LNKG, \n                                Zero\n                            }, \n\n                            Package (0x04)\n                            {\n                                0x0005FFFF, \n                                0x03, \n                                ^^LPCB.LNKF, \n                                Zero\n                            }\n                        })\n                    }\n                }\n            }\n\n            Device (LPCB)\n            {\n                Name (_ADR, 0x001F0000)\n                OperationRegion (LPC0, PCI_Config, 0x40, 0xC0)\n                Field (LPC0, AnyAcc, NoLock, Preserve)\n                {\n                            Offset (0x20), \n                    PARC,   8, \n                    PBRC,   8, \n                    PCRC,   8, \n                    PDRC,   8, \n                            Offset (0x28), \n                    PERC,   8, \n                    PFRC,   8, \n                    PGRC,   8, \n                    PHRC,   8, \n                            Offset (0x40), \n                    IOD0,   8, \n                    IOD1,   8, \n                            Offset (0xB0), \n                    RAEN,   1, \n                        ,   13, \n                    RCBA,   18\n                }\n\n                Device (LNKA)\n                {\n                    Name (_HID, EisaId (\"PNP0C0F\"))\n                    Name (_UID, One)\n                    Method (_DIS, 0, Serialized)\n                    {\n                        Store (0x80, PARC)\n                    }\n\n                    Name (_PRS, ResourceTemplate ()\n                    {\n                        IRQ (Level, ActiveLow, Shared, )\n                            {1,3,4,5,6,7,10,12,14,15}\n                    })\n                    Method (_CRS, 0, Serialized)\n                    {\n                        Name (RTLA, ResourceTemplate ()\n                        {\n                            IRQ (Level, ActiveLow, Shared, )\n                                {}\n                        })\n                        CreateWordField (RTLA, One, IRQ0)\n                        Store (Zero, IRQ0)\n                        ShiftLeft (One, And (PARC, 0x0F), IRQ0)\n                        Return (RTLA)\n                    }\n\n                    Method (_SRS, 1, Serialized)\n                    {\n                        CreateWordField (Arg0, One, IRQ0)\n                        FindSetRightBit (IRQ0, Local0)\n                        Decrement (Local0)\n                        Store (Local0, PARC)\n                    }\n\n                    Method (_STA, 0, Serialized)\n                    {\n                        If (And (PARC, 0x80))\n                        {\n                            Return (0x09)\n                        }\n                        Else\n                        {\n                            Return (0x0B)\n                        }\n                    }\n                }\n\n                Device (LNKB)\n                {\n                    Name (_HID, EisaId (\"PNP0C0F\"))\n                    Name (_UID, 0x02)\n                    Method (_DIS, 0, Serialized)\n                    {\n                        Store (0x80, PBRC)\n                    }\n\n                    Name (_PRS, ResourceTemplate ()\n                    {\n                        IRQ (Level, ActiveLow, Shared, )\n                            {1,3,4,5,6,7,11,12,14,15}\n                    })\n                    Method (_CRS, 0, Serialized)\n                    {\n                        Name (RTLB, ResourceTemplate ()\n                        {\n                            IRQ (Level, ActiveLow, Shared, )\n                                {}\n                        })\n                        CreateWordField (RTLB, One, IRQ0)\n                        Store (Zero, IRQ0)\n                        ShiftLeft (One, And (PBRC, 0x0F), IRQ0)\n                        Return (RTLB)\n                    }\n\n                    Method (_SRS, 1, Serialized)\n                    {\n                        CreateWordField (Arg0, One, IRQ0)\n                        FindSetRightBit (IRQ0, Local0)\n                        Decrement (Local0)\n                        Store (Local0, PBRC)\n                    }\n\n                    Method (_STA, 0, Serialized)\n                    {\n                        If (And (PBRC, 0x80))\n                        {\n                            Return (0x09)\n                        }\n                        Else\n                        {\n                            Return (0x0B)\n                        }\n                    }\n                }\n\n                Device (LNKC)\n                {\n                    Name (_HID, EisaId (\"PNP0C0F\"))\n                    Name (_UID, 0x03)\n                    Method (_DIS, 0, Serialized)\n                    {\n                        Store (0x80, PCRC)\n                    }\n\n                    Name (_PRS, ResourceTemplate ()\n                    {\n                        IRQ (Level, ActiveLow, Shared, )\n                            {1,3,4,5,6,7,10,12,14,15}\n                    })\n                    Method (_CRS, 0, Serialized)\n                    {\n                        Name (RTLC, ResourceTemplate ()\n                        {\n                            IRQ (Level, ActiveLow, Shared, )\n                                {}\n                        })\n                        CreateWordField (RTLC, One, IRQ0)\n                        Store (Zero, IRQ0)\n                        ShiftLeft (One, And (PCRC, 0x0F), IRQ0)\n                        Return (RTLC)\n                    }\n\n                    Method (_SRS, 1, Serialized)\n                    {\n                        CreateWordField (Arg0, One, IRQ0)\n                        FindSetRightBit (IRQ0, Local0)\n                        Decrement (Local0)\n                        Store (Local0, PCRC)\n                    }\n\n                    Method (_STA, 0, Serialized)\n                    {\n                        If (And (PCRC, 0x80))\n                        {\n                            Return (0x09)\n                        }\n                        Else\n                        {\n                            Return (0x0B)\n                        }\n                    }\n                }\n\n                Device (LNKD)\n                {\n                    Name (_HID, EisaId (\"PNP0C0F\"))\n                    Name (_UID, 0x04)\n                    Method (_DIS, 0, Serialized)\n                    {\n                        Store (0x80, PDRC)\n                    }\n\n                    Name (_PRS, ResourceTemplate ()\n                    {\n                        IRQ (Level, ActiveLow, Shared, )\n                            {1,3,4,5,6,7,11,12,14,15}\n                    })\n                    Method (_CRS, 0, Serialized)\n                    {\n                        Name (RTLD, ResourceTemplate ()\n                        {\n                            IRQ (Level, ActiveLow, Shared, )\n                                {}\n                        })\n                        CreateWordField (RTLD, One, IRQ0)\n                        Store (Zero, IRQ0)\n                        ShiftLeft (One, And (PDRC, 0x0F), IRQ0)\n                        Return (RTLD)\n                    }\n\n                    Method (_SRS, 1, Serialized)\n                    {\n                        CreateWordField (Arg0, One, IRQ0)\n                        FindSetRightBit (IRQ0, Local0)\n                        Decrement (Local0)\n                        Store (Local0, PDRC)\n                    }\n\n                    Method (_STA, 0, Serialized)\n                    {\n                        If (And (PDRC, 0x80))\n                        {\n                            Return (0x09)\n                        }\n                        Else\n                        {\n                            Return (0x0B)\n                        }\n                    }\n                }\n\n                Device (LNKE)\n                {\n                    Name (_HID, EisaId (\"PNP0C0F\"))\n                    Name (_UID, 0x05)\n                    Method (_DIS, 0, Serialized)\n                    {\n                        Store (0x80, PERC)\n                    }\n\n                    Name (_PRS, ResourceTemplate ()\n                    {\n                        IRQ (Level, ActiveLow, Shared, )\n                            {1,3,4,5,6,7,10,12,14,15}\n                    })\n                    Method (_CRS, 0, Serialized)\n                    {\n                        Name (RTLE, ResourceTemplate ()\n                        {\n                            IRQ (Level, ActiveLow, Shared, )\n                                {}\n                        })\n                        CreateWordField (RTLE, One, IRQ0)\n                        Store (Zero, IRQ0)\n                        ShiftLeft (One, And (PERC, 0x0F), IRQ0)\n                        Return (RTLE)\n                    }\n\n                    Method (_SRS, 1, Serialized)\n                    {\n                        CreateWordField (Arg0, One, IRQ0)\n                        FindSetRightBit (IRQ0, Local0)\n                        Decrement (Local0)\n                        Store (Local0, PERC)\n                    }\n\n                    Method (_STA, 0, Serialized)\n                    {\n                        If (And (PERC, 0x80))\n                        {\n                            Return (0x09)\n                        }\n                        Else\n                        {\n                            Return (0x0B)\n                        }\n                    }\n                }\n\n                Device (LNKF)\n                {\n                    Name (_HID, EisaId (\"PNP0C0F\"))\n                    Name (_UID, 0x06)\n                    Method (_DIS, 0, Serialized)\n                    {\n                        Store (0x80, PFRC)\n                    }\n\n                    Name (_PRS, ResourceTemplate ()\n                    {\n                        IRQ (Level, ActiveLow, Shared, )\n                            {1,3,4,5,6,7,11,12,14,15}\n                    })\n                    Method (_CRS, 0, Serialized)\n                    {\n                        Name (RTLF, ResourceTemplate ()\n                        {\n                            IRQ (Level, ActiveLow, Shared, )\n                                {}\n                        })\n                        CreateWordField (RTLF, One, IRQ0)\n                        Store (Zero, IRQ0)\n                        ShiftLeft (One, And (PFRC, 0x0F), IRQ0)\n                        Return (RTLF)\n                    }\n\n                    Method (_SRS, 1, Serialized)\n                    {\n                        CreateWordField (Arg0, One, IRQ0)\n                        FindSetRightBit (IRQ0, Local0)\n                        Decrement (Local0)\n                        Store (Local0, PFRC)\n                    }\n\n                    Method (_STA, 0, Serialized)\n                    {\n                        If (And (PFRC, 0x80))\n                        {\n                            Return (0x09)\n                        }\n                        Else\n                        {\n                            Return (0x0B)\n                        }\n                    }\n                }\n\n                Device (LNKG)\n                {\n                    Name (_HID, EisaId (\"PNP0C0F\"))\n                    Name (_UID, 0x07)\n                    Method (_DIS, 0, Serialized)\n                    {\n                        Store (0x80, PGRC)\n                    }\n\n                    Name (_PRS, ResourceTemplate ()\n                    {\n                        IRQ (Level, ActiveLow, Shared, )\n                            {1,3,4,5,6,7,10,12,14,15}\n                    })\n                    Method (_CRS, 0, Serialized)\n                    {\n                        Name (RTLG, ResourceTemplate ()\n                        {\n                            IRQ (Level, ActiveLow, Shared, )\n                                {}\n                        })\n                        CreateWordField (RTLG, One, IRQ0)\n                        Store (Zero, IRQ0)\n                        ShiftLeft (One, And (PGRC, 0x0F), IRQ0)\n                        Return (RTLG)\n                    }\n\n                    Method (_SRS, 1, Serialized)\n                    {\n                        CreateWordField (Arg0, One, IRQ0)\n                        FindSetRightBit (IRQ0, Local0)\n                        Decrement (Local0)\n                        Store (Local0, PGRC)\n                    }\n\n                    Method (_STA, 0, Serialized)\n                    {\n                        If (And (PGRC, 0x80))\n                        {\n                            Return (0x09)\n                        }\n                        Else\n                        {\n                            Return (0x0B)\n                        }\n                    }\n                }\n\n                Device (LNKH)\n                {\n                    Name (_HID, EisaId (\"PNP0C0F\"))\n                    Name (_UID, 0x08)\n                    Method (_DIS, 0, Serialized)\n                    {\n                        Store (0x80, PHRC)\n                    }\n\n                    Name (_PRS, ResourceTemplate ()\n                    {\n                        IRQ (Level, ActiveLow, Shared, )\n                            {1,3,4,5,6,7,11,12,14,15}\n                    })\n                    Method (_CRS, 0, Serialized)\n                    {\n                        Name (RTLH, ResourceTemplate ()\n                        {\n                            IRQ (Level, ActiveLow, Shared, )\n                                {}\n                        })\n                        CreateWordField (RTLH, One, IRQ0)\n                        Store (Zero, IRQ0)\n                        ShiftLeft (One, And (PHRC, 0x0F), IRQ0)\n                        Return (RTLH)\n                    }\n\n                    Method (_SRS, 1, Serialized)\n                    {\n                        CreateWordField (Arg0, One, IRQ0)\n                        FindSetRightBit (IRQ0, Local0)\n                        Decrement (Local0)\n                        Store (Local0, PHRC)\n                    }\n\n                    Method (_STA, 0, Serialized)\n                    {\n                        If (And (PHRC, 0x80))\n                        {\n                            Return (0x09)\n                        }\n                        Else\n                        {\n                            Return (0x0B)\n                        }\n                    }\n                }\n\n                Device (EC0)\n                {\n                    Name (_HID, EisaId (\"PNP0C09\"))\n                    Name (_CRS, ResourceTemplate ()\n                    {\n                        IO (Decode16,\n                            0x0062,             // Range Minimum\n                            0x0062,             // Range Maximum\n                            0x00,               // Alignment\n                            0x01,               // Length\n                            )\n                        IO (Decode16,\n                            0x0066,             // Range Minimum\n                            0x0066,             // Range Maximum\n                            0x00,               // Alignment\n                            0x01,               // Length\n                            )\n                    })\n                    Name (FGEC, Zero)\n                    Name (SLMS, Zero)\n                    Name (LPST, Zero)\n                    Name (APST, Zero)\n                    Name (APCT, Zero)\n                    Name (C3EN, Zero)\n                    Device (BAT0)\n                    {\n                        Name (_HID, EisaId (\"PNP0C0A\"))\n                        Name (_UID, Zero)\n                        Method (_STA, 0, NotSerialized)\n                        {\n                            Store (\"BAT_STA Start\", Debug)\n                            If (LEqual (FGEC, Zero))\n                            {\n                                Return (0x0F)\n                            }\n                            Else\n                            {\n                                Store (XTIN, Local0)\n                            }\n\n                            If (Local0)\n                            {\n                                Return (0x1F)\n                            }\n                            Else\n                            {\n                                Return (0x0F)\n                            }\n\n                            Store (\"BAT_STA END\", Debug)\n                        }\n\n                        Name (PAK1, Package (0x0D)\n                        {\n                            Zero, \n                            0x0C56, \n                            0x0C56, \n                            Zero, \n                            0x2A30, \n                            0x013B, \n                            0x9D, \n                            0x10, \n                            0x08, \n                            \"L53II\", \n                            \"00001\", \n                            \"LiON\", \n                            \"FSC\"\n                        })\n                        Method (_BIF, 0, NotSerialized)\n                        {\n                            Store (\"BIF\", Debug)\n                            Store (XIF0, Index (PAK1, Zero))\n                            Store (XIF1, Index (PAK1, One))\n                            Store (XIF2, Local0)\n                            Store (Local0, Index (PAK1, 0x02))\n                            Store (XIF3, Index (PAK1, 0x03))\n                            Store (XIF4, Index (PAK1, 0x04))\n                            Store (Divide (Local0, 0x0A, ), Index (PAK1, 0x05))\n                            Store (Divide (Local0, 0x78, ), Index (PAK1, 0x06))\n                            Store (XIF7, Index (PAK1, 0x07))\n                            Return (PAK1)\n                        }\n\n                        Name (BFB0, Package (0x04)\n                        {\n                            Zero, \n                            0xFFFFFFFF, \n                            0x1034, \n                            0x2A30\n                        })\n                        Method (_BST, 0, NotSerialized)\n                        {\n                            Store (\"BST Start\", Debug)\n                            Store (XST0, Index (BFB0, Zero))\n                            Store (XST2, Index (BFB0, 0x02))\n                            Store (XST3, Index (BFB0, 0x03))\n                            Store (\"BST End\", Debug)\n                            Return (BFB0)\n                        }\n\n                        Method (_BTP, 1, NotSerialized)\n                        {\n                            Store (Arg0, XTP0)\n                        }\n\n                        Method (_PCL, 0, NotSerialized)\n                        {\n                            Return (_SB)\n                        }\n                    }\n\n                    Method (_REG, 2, NotSerialized)\n                    {\n                        If (LEqual (Arg0, 0x03))\n                        {\n                            Store (Arg1, FGEC)\n                            Add (PPCM, One, TPST)\n                            If (LNotEqual (LSTE, ^^^GFX0.CLID))\n                            {\n                                If (LNot (^^^GFX0.GLID (LSTE)))\n                                {\n                                    Store (LSTE, LIDS)\n                                    Notify (LID, 0x80)\n                                }\n                            }\n\n                            Store (0x04, XSEC)\n                            Store (XCIN, PWRS)\n                            Store (Zero, S4FG)\n                            If (LNot (And (CFGD, One)))\n                            {\n                                Store (One, APCE)\n                            }\n                        }\n                    }\n\n                    OperationRegion (ECXP, EmbeddedControl, Zero, 0x0100)\n                    Field (ECXP, ByteAcc, Lock, Preserve)\n                    {\n                        XIF0,   16, \n                        XIF1,   16, \n                        XIF2,   16, \n                        XIF3,   16, \n                        XIF4,   16, \n                        XIF5,   16, \n                        XIF6,   16, \n                        XIF7,   16, \n                        XIF8,   16, \n                        XIF9,   64, \n                        XIFA,   64, \n                        XIFB,   64, \n                        XIFC,   64, \n                        XST0,   16, \n                        XST1,   16, \n                        XST2,   16, \n                        XST3,   16, \n                        XTP0,   16, \n                        XCIN,   1, \n                            ,   1, \n                        XTIN,   1, \n                                Offset (0x3D), \n                                Offset (0x3E), \n                        XHPP,   7, \n                                Offset (0x3F), \n                                Offset (0x40), \n                        XSEC,   8, \n                                Offset (0x43), \n                        BKLG,   3, \n                        ADIM,   1, \n                                Offset (0x71), \n                        LSTE,   1, \n                        APCE,   1, \n                                Offset (0x74), \n                        TPST,   8, \n                                Offset (0xC0), \n                        BIF0,   16, \n                        BIF1,   16, \n                        BIF2,   16, \n                        BIF3,   16, \n                        BIF4,   16, \n                        BIF5,   16, \n                        BIF6,   16, \n                        BIF7,   16, \n                        BIF8,   16, \n                        BIF9,   64, \n                        BIFA,   64, \n                        BIFB,   64, \n                        BIFC,   64, \n                        BST0,   16, \n                        BST1,   16, \n                        BST2,   16, \n                        BST3,   16, \n                        BTP0,   16, \n                        ACIN,   1, \n                            ,   1, \n                        BTIN,   1, \n                                Offset (0xFD)\n                    }\n\n                    Name (_GPE, 0x11)\n                    Method (_Q06, 0, NotSerialized)\n                    {\n                        Notify (BAT0, 0x81)\n                        Notify (BAT0, 0x80)\n                    }\n\n                    Method (_Q07, 0, NotSerialized)\n                    {\n                        Store (XCIN, PWRS)\n                        Subtract (PPCM, One, LPST)\n                        If (LOr (LBLM, LLess (XIF1, 0x0BB8)))\n                        {\n                            Store (PPCM, LPST)\n                        }\n\n                        If (XCIN)\n                        {\n                            Store (Zero, LPST)\n                        }\n\n                        FPPC ()\n                        Notify (AC0, 0x80)\n                    }\n\n                    Method (_Q0A, 0, NotSerialized)\n                    {\n                        Store (0xF1, P80H)\n                        Notify (SLPB, 0x80)\n                    }\n\n                    Method (_Q0B, 0, NotSerialized)\n                    {\n                        Store (0xF2, P80H)\n                    }\n\n                    Method (_Q0C, 0, NotSerialized)\n                    {\n                        Store (0xF3, P80H)\n                    }\n\n                    Method (_Q0D, 0, NotSerialized)\n                    {\n                        Store (0xF4, P80H)\n                        ^^^GFX0.GHDS (Zero)\n                    }\n\n                    Method (_Q0E, 0, NotSerialized)\n                    {\n                        Store (0xF5, P80H)\n                    }\n\n                    Method (_Q0F, 0, NotSerialized)\n                    {\n                        Store (0xF6, P80H)\n                    }\n\n                    Method (_Q10, 0, NotSerialized)\n                    {\n                        Store (0xF7, P80H)\n                        If (LEqual (OSYS, 0x07D6))\n                        {\n                            If (LEqual (And (0xFFFF, DID1), 0x0400))\n                            {\n                                Notify (^^^GFX0.DD01, 0x86)\n                            }\n\n                            If (LEqual (And (0xFFFF, DID2), 0x0400))\n                            {\n                                Notify (^^^GFX0.DD02, 0x86)\n                            }\n\n                            If (LEqual (And (0xFFFF, DID3), 0x0400))\n                            {\n                                Notify (^^^GFX0.DD03, 0x86)\n                            }\n\n                            If (LEqual (And (0xFFFF, DID4), 0x0400))\n                            {\n                                Notify (^^^GFX0.DD04, 0x86)\n                            }\n\n                            If (LEqual (And (0xFFFF, DID5), 0x0400))\n                            {\n                                Notify (^^^GFX0.DD05, 0x86)\n                            }\n                        }\n                        Else\n                        {\n                            If (LLess (LCDL, 0x07))\n                            {\n                                Increment (LCDL)\n                                Store (LCDL, BKLG)\n                            }\n                        }\n                    }\n\n                    Method (_Q11, 0, NotSerialized)\n                    {\n                        Store (0xF8, P80H)\n                        If (LEqual (OSYS, 0x07D6))\n                        {\n                            If (LEqual (And (0xFFFF, DID1), 0x0400))\n                            {\n                                Notify (^^^GFX0.DD01, 0x87)\n                            }\n\n                            If (LEqual (And (0xFFFF, DID2), 0x0400))\n                            {\n                                Notify (^^^GFX0.DD02, 0x87)\n                            }\n\n                            If (LEqual (And (0xFFFF, DID3), 0x0400))\n                            {\n                                Notify (^^^GFX0.DD03, 0x87)\n                            }\n\n                            If (LEqual (And (0xFFFF, DID4), 0x0400))\n                            {\n                                Notify (^^^GFX0.DD04, 0x87)\n                            }\n\n                            If (LEqual (And (0xFFFF, DID5), 0x0400))\n                            {\n                                Notify (^^^GFX0.DD05, 0x87)\n                            }\n                        }\n                        Else\n                        {\n                            If (LCDL)\n                            {\n                                Decrement (LCDL)\n                                Store (LCDL, BKLG)\n                            }\n                        }\n                    }\n\n                    Method (_Q16, 0, NotSerialized)\n                    {\n                        Store (0x16, P80H)\n                        Store (LSTE, LIDS)\n                        ^^^GFX0.GLID (LIDS)\n                        Notify (LID, 0x80)\n                    }\n\n                    Method (_Q17, 0, NotSerialized)\n                    {\n                        Store (0x17, P80H)\n                    }\n\n                    Method (_Q19, 0, NotSerialized)\n                    {\n                        Store (0x19, P80H)\n                        Store (Zero, LIDS)\n                        Notify (LID, 0x80)\n                    }\n\n                    Method (_Q27, 0, NotSerialized)\n                    {\n                        Store (0x78, \\_TZ.THPP)\n                        Notify (\\_TZ.THRM, 0x80)\n                    }\n\n                    Method (_Q2E, 0, NotSerialized)\n                    {\n                        XOr (One, SLMS, SLMS)\n                        FPPC ()\n                    }\n\n                    Method (_Q40, 0, NotSerialized)\n                    {\n                        Store (Zero, APST)\n                        Store (Zero, APCT)\n                        FPPC ()\n                        Store (0x40, P80H)\n                    }\n\n                    Method (_Q41, 0, NotSerialized)\n                    {\n                        Store (One, APST)\n                        Store (0x1E, APCT)\n                        FPPC ()\n                        Store (0x41, P80H)\n                    }\n\n                    Method (_Q42, 0, NotSerialized)\n                    {\n                        Store (0x02, APST)\n                        Store (0x1C, APCT)\n                        FPPC ()\n                        Store (0x42, P80H)\n                    }\n\n                    Method (_Q43, 0, NotSerialized)\n                    {\n                        Store (0x03, APST)\n                        Store (0x1A, APCT)\n                        FPPC ()\n                        Store (0x43, P80H)\n                    }\n\n                    Method (_Q44, 0, NotSerialized)\n                    {\n                        Store (0x04, APST)\n                        Store (0x18, APCT)\n                        FPPC ()\n                        Store (0x44, P80H)\n                    }\n\n                    Method (_Q45, 0, NotSerialized)\n                    {\n                        Store (0x05, APST)\n                        Store (0x16, APCT)\n                        FPPC ()\n                        Store (0x45, P80H)\n                    }\n\n                    Method (_Q46, 0, NotSerialized)\n                    {\n                        Store (0x06, APST)\n                        Store (0x14, APCT)\n                        FPPC ()\n                        Store (0x46, P80H)\n                    }\n\n                    Method (_Q47, 0, NotSerialized)\n                    {\n                        Store (0x07, APST)\n                        Store (0x12, APCT)\n                        FPPC ()\n                        Store (0x47, P80H)\n                    }\n\n                    Method (FPPC, 0, NotSerialized)\n                    {\n                        Store (PPCM, Local0)\n                        If (LLess (APST, Local0))\n                        {\n                            Store (APST, Local0)\n                        }\n\n                        If (LGreater (LPST, Local0))\n                        {\n                            Store (LPST, Local0)\n                        }\n\n                        If (SLMS)\n                        {\n                            Store (PPCM, Local0)\n                        }\n\n                        If (And (CFGD, One))\n                        {\n                            Store (Local0, \\_PR.CPU0._PPC)\n                            PNOT ()\n                        }\n                        Else\n                        {\n                            If (LAnd (LLess (APST, 0x03), SLMS))\n                            {\n                                Store (0x1C, THRT)\n                            }\n                            Else\n                            {\n                                Store (APCT, THRT)\n                            }\n                        }\n                    }\n                }\n\n                Scope (\\_SB)\n                {\n                    Device (PWRB)\n                    {\n                        Name (_HID, EisaId (\"PNP0C0C\"))\n                    }\n\n                    Device (AC0)\n                    {\n                        Name (_HID, \"ACPI0003\")\n                        Method (_PSR, 0, NotSerialized)\n                        {\n                            If (LEqual (^^PCI0.LPCB.EC0.FGEC, Zero))\n                            {\n                                Store (One, Local0)\n                            }\n                            Else\n                            {\n                                Store (^^PCI0.LPCB.EC0.XCIN, Local0)\n                            }\n\n                            Return (Local0)\n                        }\n\n                        Name (_PCL, Package (0x01)\n                        {\n                            PCI0\n                        })\n                    }\n\n                    Device (LID)\n                    {\n                        Name (_HID, EisaId (\"PNP0C0D\"))\n                        Method (_LID, 0, NotSerialized)\n                        {\n                            Return (LIDS)\n                        }\n                    }\n\n                    Device (SLPB)\n                    {\n                        Name (_HID, EisaId (\"PNP0C0E\"))\n                    }\n                }\n\n                Device (DMAC)\n                {\n                    Name (_HID, EisaId (\"PNP0200\"))\n                    Name (_CRS, ResourceTemplate ()\n                    {\n                        IO (Decode16,\n                            0x0000,             // Range Minimum\n                            0x0000,             // Range Maximum\n                            0x01,               // Alignment\n                            0x20,               // Length\n                            )\n                        IO (Decode16,\n                            0x0081,             // Range Minimum\n                            0x0081,             // Range Maximum\n                            0x01,               // Alignment\n                            0x11,               // Length\n                            )\n                        IO (Decode16,\n                            0x0093,             // Range Minimum\n                            0x0093,             // Range Maximum\n                            0x01,               // Alignment\n                            0x0D,               // Length\n                            )\n                        IO (Decode16,\n                            0x00C0,             // Range Minimum\n                            0x00C0,             // Range Maximum\n                            0x01,               // Alignment\n                            0x20,               // Length\n                            )\n                        DMA (Compatibility, NotBusMaster, Transfer8_16, )\n                            {4}\n                    })\n                }\n\n                Device (FWHD)\n                {\n                    Name (_HID, EisaId (\"INT0800\"))\n                    Name (_CRS, ResourceTemplate ()\n                    {\n                        Memory32Fixed (ReadOnly,\n                            0xFF000000,         // Address Base\n                            0x01000000,         // Address Length\n                            )\n                    })\n                }\n\n                Device (HPET)\n                {\n                    Name (_HID, EisaId (\"PNP0103\"))\n                    Name (_CID, 0x010CD041)\n                    Name (BUF0, ResourceTemplate ()\n                    {\n                        Memory32Fixed (ReadOnly,\n                            0xFED00000,         // Address Base\n                            0x00000400,         // Address Length\n                            _Y14)\n                    })\n                    Method (_STA, 0, NotSerialized)\n                    {\n                        If (LGreaterEqual (OSYS, 0x07D1))\n                        {\n                            If (HPAE)\n                            {\n                                Return (0x0F)\n                            }\n                        }\n                        Else\n                        {\n                            If (HPAE)\n                            {\n                                Return (0x0B)\n                            }\n                        }\n\n                        Return (Zero)\n                    }\n\n                    Method (_CRS, 0, Serialized)\n                    {\n                        If (HPAE)\n                        {\n                            CreateDWordField (BUF0, \\_SB.PCI0.LPCB.HPET._Y14._BAS, HPT0)\n                            If (LEqual (HPAS, One))\n                            {\n                                Store (0xFED01000, HPT0)\n                            }\n\n                            If (LEqual (HPAS, 0x02))\n                            {\n                                Store (0xFED02000, HPT0)\n                            }\n\n                            If (LEqual (HPAS, 0x03))\n                            {\n                                Store (0xFED03000, HPT0)\n                            }\n                        }\n\n                        Return (BUF0)\n                    }\n                }\n\n                Device (IPIC)\n                {\n                    Name (_HID, EisaId (\"PNP0000\"))\n                    Name (_CRS, ResourceTemplate ()\n                    {\n                        IO (Decode16,\n                            0x0020,             // Range Minimum\n                            0x0020,             // Range Maximum\n                            0x01,               // Alignment\n                            0x02,               // Length\n                            )\n                        IO (Decode16,\n                            0x0024,             // Range Minimum\n                            0x0024,             // Range Maximum\n                            0x01,               // Alignment\n                            0x02,               // Length\n                            )\n                        IO (Decode16,\n                            0x0028,             // Range Minimum\n                            0x0028,             // Range Maximum\n                            0x01,               // Alignment\n                            0x02,               // Length\n                            )\n                        IO (Decode16,\n                            0x002C,             // Range Minimum\n                            0x002C,             // Range Maximum\n                            0x01,               // Alignment\n                            0x02,               // Length\n                            )\n                        IO (Decode16,\n                            0x0030,             // Range Minimum\n                            0x0030,             // Range Maximum\n                            0x01,               // Alignment\n                            0x02,               // Length\n                            )\n                        IO (Decode16,\n                            0x0034,             // Range Minimum\n                            0x0034,             // Range Maximum\n                            0x01,               // Alignment\n                            0x02,               // Length\n                            )\n                        IO (Decode16,\n                            0x0038,             // Range Minimum\n                            0x0038,             // Range Maximum\n                            0x01,               // Alignment\n                            0x02,               // Length\n                            )\n                        IO (Decode16,\n                            0x003C,             // Range Minimum\n                            0x003C,             // Range Maximum\n                            0x01,               // Alignment\n                            0x02,               // Length\n                            )\n                        IO (Decode16,\n                            0x00A0,             // Range Minimum\n                            0x00A0,             // Range Maximum\n                            0x01,               // Alignment\n                            0x02,               // Length\n                            )\n                        IO (Decode16,\n                            0x00A4,             // Range Minimum\n                            0x00A4,             // Range Maximum\n                            0x01,               // Alignment\n                            0x02,               // Length\n                            )\n                        IO (Decode16,\n                            0x00A8,             // Range Minimum\n                            0x00A8,             // Range Maximum\n                            0x01,               // Alignment\n                            0x02,               // Length\n                            )\n                        IO (Decode16,\n                            0x00AC,             // Range Minimum\n                            0x00AC,             // Range Maximum\n                            0x01,               // Alignment\n                            0x02,               // Length\n                            )\n                        IO (Decode16,\n                            0x00B0,             // Range Minimum\n                            0x00B0,             // Range Maximum\n                            0x01,               // Alignment\n                            0x02,               // Length\n                            )\n                        IO (Decode16,\n                            0x00B4,             // Range Minimum\n                            0x00B4,             // Range Maximum\n                            0x01,               // Alignment\n                            0x02,               // Length\n                            )\n                        IO (Decode16,\n                            0x00B8,             // Range Minimum\n                            0x00B8,             // Range Maximum\n                            0x01,               // Alignment\n                            0x02,               // Length\n                            )\n                        IO (Decode16,\n                            0x00BC,             // Range Minimum\n                            0x00BC,             // Range Maximum\n                            0x01,               // Alignment\n                            0x02,               // Length\n                            )\n                        IO (Decode16,\n                            0x04D0,             // Range Minimum\n                            0x04D0,             // Range Maximum\n                            0x01,               // Alignment\n                            0x02,               // Length\n                            )\n                        IRQNoFlags ()\n                            {2}\n                    })\n                }\n\n                Device (MATH)\n                {\n                    Name (_HID, EisaId (\"PNP0C04\"))\n                    Name (_CRS, ResourceTemplate ()\n                    {\n                        IO (Decode16,\n                            0x00F0,             // Range Minimum\n                            0x00F0,             // Range Maximum\n                            0x01,               // Alignment\n                            0x01,               // Length\n                            )\n                        IRQNoFlags ()\n                            {13}\n                    })\n                }\n\n                Device (LDRC)\n                {\n                    Name (_HID, EisaId (\"PNP0C02\"))\n                    Name (_UID, 0x02)\n                    Name (_CRS, ResourceTemplate ()\n                    {\n                        IO (Decode16,\n                            0x002E,             // Range Minimum\n                            0x002E,             // Range Maximum\n                            0x01,               // Alignment\n                            0x02,               // Length\n                            )\n                        IO (Decode16,\n                            0x004E,             // Range Minimum\n                            0x004E,             // Range Maximum\n                            0x01,               // Alignment\n                            0x02,               // Length\n                            )\n                        IO (Decode16,\n                            0x0061,             // Range Minimum\n                            0x0061,             // Range Maximum\n                            0x01,               // Alignment\n                            0x01,               // Length\n                            )\n                        IO (Decode16,\n                            0x0063,             // Range Minimum\n                            0x0063,             // Range Maximum\n                            0x01,               // Alignment\n                            0x01,               // Length\n                            )\n                        IO (Decode16,\n                            0x0065,             // Range Minimum\n                            0x0065,             // Range Maximum\n                            0x01,               // Alignment\n                            0x01,               // Length\n                            )\n                        IO (Decode16,\n                            0x0067,             // Range Minimum\n                            0x0067,             // Range Maximum\n                            0x01,               // Alignment\n                            0x01,               // Length\n                            )\n                        IO (Decode16,\n                            0x0068,             // Range Minimum\n                            0x0068,             // Range Maximum\n                            0x01,               // Alignment\n                            0x05,               // Length\n                            )\n                        IO (Decode16,\n                            0x0070,             // Range Minimum\n                            0x0070,             // Range Maximum\n                            0x01,               // Alignment\n                            0x01,               // Length\n                            )\n                        IO (Decode16,\n                            0x0080,             // Range Minimum\n                            0x0080,             // Range Maximum\n                            0x01,               // Alignment\n                            0x01,               // Length\n                            )\n                        IO (Decode16,\n                            0x0092,             // Range Minimum\n                            0x0092,             // Range Maximum\n                            0x01,               // Alignment\n                            0x01,               // Length\n                            )\n                        IO (Decode16,\n                            0x00B2,             // Range Minimum\n                            0x00B2,             // Range Maximum\n                            0x01,               // Alignment\n                            0x02,               // Length\n                            )\n                        IO (Decode16,\n                            0x0200,             // Range Minimum\n                            0x0200,             // Range Maximum\n                            0x01,               // Alignment\n                            0x10,               // Length\n                            )\n                        IO (Decode16,\n                            0x0260,             // Range Minimum\n                            0x0260,             // Range Maximum\n                            0x01,               // Alignment\n                            0x10,               // Length\n                            )\n                        IO (Decode16,\n                            0x0300,             // Range Minimum\n                            0x0300,             // Range Maximum\n                            0x01,               // Alignment\n                            0x10,               // Length\n                            )\n                        IO (Decode16,\n                            0x0378,             // Range Minimum\n                            0x0378,             // Range Maximum\n                            0x01,               // Alignment\n                            0x10,               // Length\n                            )\n                        IO (Decode16,\n                            0x03F0,             // Range Minimum\n                            0x03F0,             // Range Maximum\n                            0x01,               // Alignment\n                            0x10,               // Length\n                            )\n                        IO (Decode16,\n                            0x0680,             // Range Minimum\n                            0x0680,             // Range Maximum\n                            0x01,               // Alignment\n                            0x20,               // Length\n                            )\n                        IO (Decode16,\n                            0x0800,             // Range Minimum\n                            0x0800,             // Range Maximum\n                            0x01,               // Alignment\n                            0x10,               // Length\n                            )\n                        IO (Decode16,\n                            0x1000,             // Range Minimum\n                            0x1000,             // Range Maximum\n                            0x01,               // Alignment\n                            0x80,               // Length\n                            )\n                        IO (Decode16,\n                            0x1180,             // Range Minimum\n                            0x1180,             // Range Maximum\n                            0x01,               // Alignment\n                            0x40,               // Length\n                            )\n                        IO (Decode16,\n                            0x1640,             // Range Minimum\n                            0x1640,             // Range Maximum\n                            0x01,               // Alignment\n                            0x10,               // Length\n                            )\n                        IO (Decode16,\n                            0xFE00,             // Range Minimum\n                            0xFE00,             // Range Maximum\n                            0x01,               // Alignment\n                            0x01,               // Length\n                            )\n                    })\n                }\n\n                Device (RTC)\n                {\n                    Name (_HID, EisaId (\"PNP0B00\"))\n                    Name (_CRS, ResourceTemplate ()\n                    {\n                        IO (Decode16,\n                            0x0070,             // Range Minimum\n                            0x0070,             // Range Maximum\n                            0x01,               // Alignment\n                            0x08,               // Length\n                            )\n                        IRQNoFlags ()\n                            {8}\n                    })\n                }\n\n                Device (TIMR)\n                {\n                    Name (_HID, EisaId (\"PNP0100\"))\n                    Name (_CRS, ResourceTemplate ()\n                    {\n                        IO (Decode16,\n                            0x0040,             // Range Minimum\n                            0x0040,             // Range Maximum\n                            0x01,               // Alignment\n                            0x04,               // Length\n                            )\n                        IO (Decode16,\n                            0x0050,             // Range Minimum\n                            0x0050,             // Range Maximum\n                            0x10,               // Alignment\n                            0x04,               // Length\n                            )\n                        IRQNoFlags ()\n                            {0}\n                    })\n                }\n\n                Device (PS2K)\n                {\n                    Name (_HID, EisaId (\"PNP0303\"))\n                    Name (_CRS, ResourceTemplate ()\n                    {\n                        IO (Decode16,\n                            0x0060,             // Range Minimum\n                            0x0060,             // Range Maximum\n                            0x01,               // Alignment\n                            0x01,               // Length\n                            )\n                        IO (Decode16,\n                            0x0064,             // Range Minimum\n                            0x0064,             // Range Maximum\n                            0x01,               // Alignment\n                            0x01,               // Length\n                            )\n                        IRQ (Edge, ActiveHigh, Exclusive, )\n                            {1}\n                    })\n                }\n\n                Device (PS2M)\n                {\n                    Name (_HID, EisaId (\"PNP0F13\"))\n                    Name (_CRS, ResourceTemplate ()\n                    {\n                        IRQ (Edge, ActiveHigh, Exclusive, )\n                            {12}\n                    })\n                }\n            }\n\n            Device (PATA)\n            {\n                Name (_ADR, 0x001F0001)\n                OperationRegion (PACS, PCI_Config, 0x40, 0xC0)\n                Field (PACS, DWordAcc, NoLock, Preserve)\n                {\n                    PRIT,   16, \n                            Offset (0x04), \n                    PSIT,   4, \n                            Offset (0x08), \n                    SYNC,   4, \n                            Offset (0x0A), \n                    SDT0,   2, \n                        ,   2, \n                    SDT1,   2, \n                            Offset (0x14), \n                    ICR0,   4, \n                    ICR1,   4, \n                    ICR2,   4, \n                    ICR3,   4, \n                    ICR4,   4, \n                    ICR5,   4\n                }\n\n                Device (PRID)\n                {\n                    Name (_ADR, Zero)\n                    Method (_GTM, 0, NotSerialized)\n                    {\n                        Name (PBUF, Buffer (0x14)\n                        {\n                            /* 0000 */    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, \n                            /* 0008 */    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, \n                            /* 0010 */    0x00, 0x00, 0x00, 0x00\n                        })\n                        CreateDWordField (PBUF, Zero, PIO0)\n                        CreateDWordField (PBUF, 0x04, DMA0)\n                        CreateDWordField (PBUF, 0x08, PIO1)\n                        CreateDWordField (PBUF, 0x0C, DMA1)\n                        CreateDWordField (PBUF, 0x10, FLAG)\n                        Store (GETP (PRIT), PIO0)\n                        Store (GDMA (And (SYNC, One), And (ICR3, One), \n                            And (ICR0, One), SDT0, And (ICR1, One)), DMA0)\n                        If (LEqual (DMA0, 0xFFFFFFFF))\n                        {\n                            Store (PIO0, DMA0)\n                        }\n\n                        If (And (PRIT, 0x4000))\n                        {\n                            If (LEqual (And (PRIT, 0x90), 0x80))\n                            {\n                                Store (0x0384, PIO1)\n                            }\n                            Else\n                            {\n                                Store (GETT (PSIT), PIO1)\n                            }\n                        }\n                        Else\n                        {\n                            Store (0xFFFFFFFF, PIO1)\n                        }\n\n                        Store (GDMA (And (SYNC, 0x02), And (ICR3, 0x02), \n                            And (ICR0, 0x02), SDT1, And (ICR1, 0x02)), DMA1)\n                        If (LEqual (DMA1, 0xFFFFFFFF))\n                        {\n                            Store (PIO1, DMA1)\n                        }\n\n                        Store (GETF (And (SYNC, One), And (SYNC, 0x02), \n                            PRIT), FLAG)\n                        If (And (LEqual (PIO0, 0xFFFFFFFF), LEqual (DMA0, 0xFFFFFFFF)))\n                        {\n                            Store (0x78, PIO0)\n                            Store (0x14, DMA0)\n                            Store (0x03, FLAG)\n                        }\n\n                        Return (PBUF)\n                    }\n\n                    Method (_STM, 3, NotSerialized)\n                    {\n                        CreateDWordField (Arg0, Zero, PIO0)\n                        CreateDWordField (Arg0, 0x04, DMA0)\n                        CreateDWordField (Arg0, 0x08, PIO1)\n                        CreateDWordField (Arg0, 0x0C, DMA1)\n                        CreateDWordField (Arg0, 0x10, FLAG)\n                        If (LEqual (SizeOf (Arg1), 0x0200))\n                        {\n                            And (PRIT, 0xC0F0, PRIT)\n                            And (SYNC, 0x02, SYNC)\n                            Store (Zero, SDT0)\n                            And (ICR0, 0x02, ICR0)\n                            And (ICR1, 0x02, ICR1)\n                            And (ICR3, 0x02, ICR3)\n                            And (ICR5, 0x02, ICR5)\n                            CreateWordField (Arg1, 0x62, W490)\n                            CreateWordField (Arg1, 0x6A, W530)\n                            CreateWordField (Arg1, 0x7E, W630)\n                            CreateWordField (Arg1, 0x80, W640)\n                            CreateWordField (Arg1, 0xB0, W880)\n                            CreateWordField (Arg1, 0xBA, W930)\n                            Or (PRIT, 0x8004, PRIT)\n                            If (LAnd (And (FLAG, 0x02), And (W490, 0x0800)))\n                            {\n                                Or (PRIT, 0x02, PRIT)\n                            }\n\n                            Or (PRIT, SETP (PIO0, W530, W640), PRIT)\n                            If (And (FLAG, One))\n                            {\n                                Or (SYNC, One, SYNC)\n                                Store (SDMA (DMA0), SDT0)\n                                If (LLess (DMA0, 0x1E))\n                                {\n                                    Or (ICR3, One, ICR3)\n                                }\n\n                                If (LLess (DMA0, 0x3C))\n                                {\n                                    Or (ICR0, One, ICR0)\n                                }\n\n                                If (And (W930, 0x2000))\n                                {\n                                    Or (ICR1, One, ICR1)\n                                }\n                            }\n                        }\n\n                        If (LEqual (SizeOf (Arg2), 0x0200))\n                        {\n                            And (PRIT, 0xBF0F, PRIT)\n                            Store (Zero, PSIT)\n                            And (SYNC, One, SYNC)\n                            Store (Zero, SDT1)\n                            And (ICR0, One, ICR0)\n                            And (ICR1, One, ICR1)\n                            And (ICR3, One, ICR3)\n                            And (ICR5, One, ICR5)\n                            CreateWordField (Arg2, 0x62, W491)\n                            CreateWordField (Arg2, 0x6A, W531)\n                            CreateWordField (Arg2, 0x7E, W631)\n                            CreateWordField (Arg2, 0x80, W641)\n                            CreateWordField (Arg2, 0xB0, W881)\n                            CreateWordField (Arg2, 0xBA, W931)\n                            Or (PRIT, 0x8040, PRIT)\n                            If (LAnd (And (FLAG, 0x08), And (W491, 0x0800)))\n                            {\n                                Or (PRIT, 0x20, PRIT)\n                            }\n\n                            If (And (FLAG, 0x10))\n                            {\n                                Or (PRIT, 0x4000, PRIT)\n                                If (LGreater (PIO1, 0xF0))\n                                {\n                                    Or (PRIT, 0x80, PRIT)\n                                }\n                                Else\n                                {\n                                    Or (PRIT, 0x10, PRIT)\n                                    Store (SETT (PIO1, W531, W641), PSIT)\n                                }\n                            }\n\n                            If (And (FLAG, 0x04))\n                            {\n                                Or (SYNC, 0x02, SYNC)\n                                Store (SDMA (DMA1), SDT1)\n                                If (LLess (DMA1, 0x1E))\n                                {\n                                    Or (ICR3, 0x02, ICR3)\n                                }\n\n                                If (LLess (DMA1, 0x3C))\n                                {\n                                    Or (ICR0, 0x02, ICR0)\n                                }\n\n                                If (And (W931, 0x2000))\n                                {\n                                    Or (ICR1, 0x02, ICR1)\n                                }\n                            }\n                        }\n                    }\n\n                    Device (P_D0)\n                    {\n                        Name (_ADR, Zero)\n                        Method (_GTF, 0, NotSerialized)\n                        {\n                            Name (PIB0, Buffer (0x0E)\n                            {\n                                /* 0000 */    0x03, 0x00, 0x00, 0x00, 0x00, 0xA0, 0xEF, 0x03, \n                                /* 0008 */    0x00, 0x00, 0x00, 0x00, 0xA0, 0xEF\n                            })\n                            CreateByteField (PIB0, One, PMD0)\n                            CreateByteField (PIB0, 0x08, DMD0)\n                            If (And (PRIT, 0x02))\n                            {\n                                If (LEqual (And (PRIT, 0x09), 0x08))\n                                {\n                                    Store (0x08, PMD0)\n                                }\n                                Else\n                                {\n                                    Store (0x0A, PMD0)\n                                    ShiftRight (And (PRIT, 0x0300), 0x08, Local0)\n                                    ShiftRight (And (PRIT, 0x3000), 0x0C, Local1)\n                                    Add (Local0, Local1, Local2)\n                                    If (LEqual (0x03, Local2))\n                                    {\n                                        Store (0x0B, PMD0)\n                                    }\n\n                                    If (LEqual (0x05, Local2))\n                                    {\n                                        Store (0x0C, PMD0)\n                                    }\n                                }\n                            }\n                            Else\n                            {\n                                Store (One, PMD0)\n                            }\n\n                            If (And (SYNC, One))\n                            {\n                                Store (Or (SDT0, 0x40), DMD0)\n                                If (And (ICR1, One))\n                                {\n                                    If (And (ICR0, One))\n                                    {\n                                        Add (DMD0, 0x02, DMD0)\n                                    }\n\n                                    If (And (ICR3, One))\n                                    {\n                                        Store (0x45, DMD0)\n                                    }\n                                }\n                            }\n                            Else\n                            {\n                                Or (Subtract (And (PMD0, 0x07), 0x02), 0x20, DMD0)\n                            }\n\n                            Return (PIB0)\n                        }\n                    }\n\n                    Device (P_D1)\n                    {\n                        Name (_ADR, One)\n                        Method (_GTF, 0, NotSerialized)\n                        {\n                            Name (PIB1, Buffer (0x0E)\n                            {\n                                /* 0000 */    0x03, 0x00, 0x00, 0x00, 0x00, 0xB0, 0xEF, 0x03, \n                                /* 0008 */    0x00, 0x00, 0x00, 0x00, 0xB0, 0xEF\n                            })\n                            CreateByteField (PIB1, One, PMD1)\n                            CreateByteField (PIB1, 0x08, DMD1)\n                            If (And (PRIT, 0x20))\n                            {\n                                If (LEqual (And (PRIT, 0x90), 0x80))\n                                {\n                                    Store (0x08, PMD1)\n                                }\n                                Else\n                                {\n                                    Add (And (PSIT, 0x03), ShiftRight (And (PSIT, 0x0C), \n                                        0x02), Local0)\n                                    If (LEqual (0x05, Local0))\n                                    {\n                                        Store (0x0C, PMD1)\n                                    }\n                                    Else\n                                    {\n                                        If (LEqual (0x03, Local0))\n                                        {\n                                            Store (0x0B, PMD1)\n                                        }\n                                        Else\n                                        {\n                                            Store (0x0A, PMD1)\n                                        }\n                                    }\n                                }\n                            }\n                            Else\n                            {\n                                Store (One, PMD1)\n                            }\n\n                            If (And (SYNC, 0x02))\n                            {\n                                Store (Or (SDT1, 0x40), DMD1)\n                                If (And (ICR1, 0x02))\n                                {\n                                    If (And (ICR0, 0x02))\n                                    {\n                                        Add (DMD1, 0x02, DMD1)\n                                    }\n\n                                    If (And (ICR3, 0x02))\n                                    {\n                                        Store (0x45, DMD1)\n                                    }\n                                }\n                            }\n                            Else\n                            {\n                                Or (Subtract (And (PMD1, 0x07), 0x02), 0x20, DMD1)\n                            }\n\n                            Return (PIB1)\n                        }\n                    }\n                }\n            }\n\n            Device (SATA)\n            {\n                Name (_ADR, 0x001F0002)\n                OperationRegion (SACS, PCI_Config, 0x40, 0xC0)\n                Field (SACS, DWordAcc, NoLock, Preserve)\n                {\n                    PRIT,   16, \n                    SECT,   16, \n                    PSIT,   4, \n                    SSIT,   4, \n                            Offset (0x08), \n                    SYNC,   4, \n                            Offset (0x0A), \n                    SDT0,   2, \n                        ,   2, \n                    SDT1,   2, \n                            Offset (0x0B), \n                    SDT2,   2, \n                        ,   2, \n                    SDT3,   2, \n                            Offset (0x14), \n                    ICR0,   4, \n                    ICR1,   4, \n                    ICR2,   4, \n                    ICR3,   4, \n                    ICR4,   4, \n                    ICR5,   4, \n                            Offset (0x50), \n                    MAPV,   2\n                }\n            }\n\n            Device (SBUS)\n            {\n                Name (_ADR, 0x001F0003)\n                OperationRegion (SMBP, PCI_Config, 0x40, 0xC0)\n                Field (SMBP, DWordAcc, NoLock, Preserve)\n                {\n                        ,   2, \n                    I2CE,   1\n                }\n\n                OperationRegion (SMBI, SystemIO, 0x1C20, 0x10)\n                Field (SMBI, ByteAcc, NoLock, Preserve)\n                {\n                    HSTS,   8, \n                            Offset (0x02), \n                    HCON,   8, \n                    HCOM,   8, \n                    TXSA,   8, \n                    DAT0,   8, \n                    DAT1,   8, \n                    HBDR,   8, \n                    PECR,   8, \n                    RXSA,   8, \n                    SDAT,   16\n                }\n\n                Method (SSXB, 2, Serialized)\n                {\n                    If (STRT ())\n                    {\n                        Return (Zero)\n                    }\n\n                    Store (Zero, I2CE)\n                    Store (0xBF, HSTS)\n                    Store (Arg0, TXSA)\n                    Store (Arg1, HCOM)\n                    Store (0x48, HCON)\n                    If (COMP ())\n                    {\n                        Or (HSTS, 0xFF, HSTS)\n                        Return (One)\n                    }\n\n                    Return (Zero)\n                }\n\n                Method (SRXB, 1, Serialized)\n                {\n                    If (STRT ())\n                    {\n                        Return (0xFFFF)\n                    }\n\n                    Store (Zero, I2CE)\n                    Store (0xBF, HSTS)\n                    Store (Or (Arg0, One), TXSA)\n                    Store (0x44, HCON)\n                    If (COMP ())\n                    {\n                        Or (HSTS, 0xFF, HSTS)\n                        Return (DAT0)\n                    }\n\n                    Return (0xFFFF)\n                }\n\n                Method (SWRB, 3, Serialized)\n                {\n                    If (STRT ())\n                    {\n                        Return (Zero)\n                    }\n\n                    Store (Zero, I2CE)\n                    Store (0xBF, HSTS)\n                    Store (Arg0, TXSA)\n                    Store (Arg1, HCOM)\n                    Store (Arg2, DAT0)\n                    Store (0x48, HCON)\n                    If (COMP ())\n                    {\n                        Or (HSTS, 0xFF, HSTS)\n                        Return (One)\n                    }\n\n                    Return (Zero)\n                }\n\n                Method (SRDB, 2, Serialized)\n                {\n                    If (STRT ())\n                    {\n                        Return (0xFFFF)\n                    }\n\n                    Store (Zero, I2CE)\n                    Store (0xBF, HSTS)\n                    Store (Or (Arg0, One), TXSA)\n                    Store (Arg1, HCOM)\n                    Store (0x48, HCON)\n                    If (COMP ())\n                    {\n                        Or (HSTS, 0xFF, HSTS)\n                        Return (DAT0)\n                    }\n\n                    Return (0xFFFF)\n                }\n\n                Method (SWRW, 3, Serialized)\n                {\n                    If (STRT ())\n                    {\n                        Return (Zero)\n                    }\n\n                    Store (Zero, I2CE)\n                    Store (0xBF, HSTS)\n                    Store (Arg0, TXSA)\n                    Store (Arg1, HCOM)\n                    And (Arg2, 0xFF, DAT0)\n                    And (ShiftRight (Arg2, 0x08), 0xFF, DAT1)\n                    Store (0x4C, HCON)\n                    If (COMP ())\n                    {\n                        Or (HSTS, 0xFF, HSTS)\n                        Return (One)\n                    }\n\n                    Return (Zero)\n                }\n\n                Method (SRDW, 2, Serialized)\n                {\n                    If (STRT ())\n                    {\n                        Return (0xFFFF)\n                    }\n\n                    Store (Zero, I2CE)\n                    Store (0xBF, HSTS)\n                    Store (Or (Arg0, One), TXSA)\n                    Store (Arg1, HCOM)\n                    Store (0x4C, HCON)\n                    If (COMP ())\n                    {\n                        Or (HSTS, 0xFF, HSTS)\n                        Return (Or (ShiftLeft (DAT1, 0x08), DAT0))\n                    }\n\n                    Return (0xFFFFFFFF)\n                }\n\n                Method (SBLW, 4, Serialized)\n                {\n                    If (STRT ())\n                    {\n                        Return (Zero)\n                    }\n\n                    Store (Arg3, I2CE)\n                    Store (0xBF, HSTS)\n                    Store (Arg0, TXSA)\n                    Store (Arg1, HCOM)\n                    Store (SizeOf (Arg2), DAT0)\n                    Store (Zero, Local1)\n                    Store (DerefOf (Index (Arg2, Zero)), HBDR)\n                    Store (0x54, HCON)\n                    While (LGreater (SizeOf (Arg2), Local1))\n                    {\n                        Store (0x0FA0, Local0)\n                        While (LAnd (LNot (And (HSTS, 0x80)), Local0))\n                        {\n                            Decrement (Local0)\n                            Stall (0x32)\n                        }\n\n                        If (LNot (Local0))\n                        {\n                            KILL ()\n                            Return (Zero)\n                        }\n\n                        Store (0x80, HSTS)\n                        Increment (Local1)\n                        If (LGreater (SizeOf (Arg2), Local1))\n                        {\n                            Store (DerefOf (Index (Arg2, Local1)), HBDR)\n                        }\n                    }\n\n                    If (COMP ())\n                    {\n                        Or (HSTS, 0xFF, HSTS)\n                        Return (One)\n                    }\n\n                    Return (Zero)\n                }\n\n                Method (SBLR, 3, Serialized)\n                {\n                    Name (TBUF, Buffer (0x0100) {})\n                    If (STRT ())\n                    {\n                        Return (Zero)\n                    }\n\n                    Store (Arg2, I2CE)\n                    Store (0xBF, HSTS)\n                    Store (Or (Arg0, One), TXSA)\n                    Store (Arg1, HCOM)\n                    Store (0x54, HCON)\n                    Store (0x0FA0, Local0)\n                    While (LAnd (LNot (And (HSTS, 0x80)), Local0))\n                    {\n                        Decrement (Local0)\n                        Stall (0x32)\n                    }\n\n                    If (LNot (Local0))\n                    {\n                        KILL ()\n                        Return (Zero)\n                    }\n\n                    Store (DAT0, Index (TBUF, Zero))\n                    Store (0x80, HSTS)\n                    Store (One, Local1)\n                    While (LLess (Local1, DerefOf (Index (TBUF, Zero))))\n                    {\n                        Store (0x0FA0, Local0)\n                        While (LAnd (LNot (And (HSTS, 0x80)), Local0))\n                        {\n                            Decrement (Local0)\n                            Stall (0x32)\n                        }\n\n                        If (LNot (Local0))\n                        {\n                            KILL ()\n                            Return (Zero)\n                        }\n\n                        Store (HBDR, Index (TBUF, Local1))\n                        Store (0x80, HSTS)\n                        Increment (Local1)\n                    }\n\n                    If (COMP ())\n                    {\n                        Or (HSTS, 0xFF, HSTS)\n                        Return (TBUF)\n                    }\n\n                    Return (Zero)\n                }\n\n                Method (STRT, 0, Serialized)\n                {\n                    Store (0xC8, Local0)\n                    While (Local0)\n                    {\n                        If (And (HSTS, 0x40))\n                        {\n                            Decrement (Local0)\n                            Sleep (One)\n                            If (LEqual (Local0, Zero))\n                            {\n                                Return (One)\n                            }\n                        }\n                        Else\n                        {\n                            Store (Zero, Local0)\n                        }\n                    }\n\n                    Store (0x0FA0, Local0)\n                    While (Local0)\n                    {\n                        If (And (HSTS, One))\n                        {\n                            Decrement (Local0)\n                            Stall (0x32)\n                            If (LEqual (Local0, Zero))\n                            {\n                                KILL ()\n                            }\n                        }\n                        Else\n                        {\n                            Return (Zero)\n                        }\n                    }\n\n                    Return (One)\n                }\n\n                Method (COMP, 0, Serialized)\n                {\n                    Store (0x0FA0, Local0)\n                    While (Local0)\n                    {\n                        If (And (HSTS, 0x02))\n                        {\n                            Return (One)\n                        }\n                        Else\n                        {\n                            Decrement (Local0)\n                            Stall (0x32)\n                            If (LEqual (Local0, Zero))\n                            {\n                                KILL ()\n                            }\n                        }\n                    }\n\n                    Return (Zero)\n                }\n\n                Method (KILL, 0, Serialized)\n                {\n                    Or (HCON, 0x02, HCON)\n                    Or (HSTS, 0xFF, HSTS)\n                }\n            }\n        }\n    }\n    Scope (\\_SB.PCI0.GFX0.DD02)\n    {\n        Method (_BCL, 0, NotSerialized)\n        {\n            Return (Package (0x0A)\n            {\n                0x4B,\n                0x0D,\n                0x0D,\n                0x19,\n                0x26,\n                0x32,\n                0x3F,\n                0x4B,\n                0x58,\n                0x64\n            })\n        }\n\n        Name (BTBL, Package (0x08)\n        {\n            0x0D,\n            0x19,\n            0x26,\n            0x32,\n            0x3F,\n            0x4B,\n            0x58,\n            0x64\n        })\n\t Method (_BCM, 1, NotSerialized)\n        {\n            Store (Match (BTBL, MEQ, Arg0, MTR, 0x00, 0x00), Local0)\n            Store (Local0, \\_SB.PCI0.LPCB.EC0.BKLG)\n            Store (Local0, BRTL)\n            Store (Local0, LCDL)\n        }\n\n        Method (_BQC, 0, NotSerialized)\n        {\n            Return (Derefof(Index (BTBL, \\_SB.PCI0.LPCB.EC0.BKLG)))\n        }\n    }\n\n\n}\n\n", "diff --git a/drivers/acpi/namespace/nsxfeval.c b/drivers/acpi/namespace/nsxfeval.c\nindex b92133f..e385f7c 100644\n--- a/drivers/acpi/namespace/nsxfeval.c\n+++ b/drivers/acpi/namespace/nsxfeval.c\n@@ -260,6 +260,22 @@ acpi_evaluate_object(acpi_handle handle,\n \t}\n \n \t/*\n+\t * workaround for acpi_evaluate_object of an Index Reference\n+\t * Resolve the Index reference first and then use the resolved object in this function\n+\t * AML_INDEX_OP is not accessable in this file, so use hardcode 0x88 instead\n+\t */\n+    \tif (info->return_object && info->return_object->reference.opcode == 0x88)\n+    \t{\n+        \tunion acpi_operand_object *tmp_obj;\n+\n+        \ttmp_obj = info->return_object;\n+        \tinfo->return_object = *(tmp_obj->reference.where);\n+\n+        \tacpi_ut_add_reference (info->return_object);\n+        \tacpi_ut_remove_reference (tmp_obj);\n+    \t}\n+\n+\t/*\n \t * If we are expecting a return value, and all went well above,\n \t * copy the return value to an external object.\n \t */\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "Power-Video", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Zhang Rui", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2008-02-19 09:14 UTC by Erik Boritsch", "Modified": "2008-06-13 22:11 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "2.6.24", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/acpi/namespace/nsxfeval.c"], "methods": ["acpi_evaluate_object"]}
{"id": "9843", "title": "CIFS doesn't like the new fair group CPU scheduler", "description": "Latest working kernel version: 2.6.23.14\nEarliest failing kernel version: 2.6.24\nDistribution: Debian/Sid\nHardware Environment: AMD K7 (x86_32)\nSoftware Environment:\nProblem Description:\n\nWith 2.6.23.14, uploading 'linux-2.6.24.tar.bz2' to a CIFS mount takes 5 s. (~ 9.5 MB/s), which is ok for a 100Mbps network:\n\nuser1@client$ time cp linux-2.6.24.tar.bz2 /cifs_srv\n\nreal    0m4.784s\nuser    0m0.000s\nsys     0m0.090s\n\n\nWith 2.6.24 and CONFIG_FAIR_GROUP_SCHED=y, the same test can take up to 28 s :\n\n* Test #1\n\n# idle CPU (no process running other than 'cp')\n=> 5 s.\n\n* Test #2\n\n(same user)\nuser1@client$ while do :; do :; done # priority: 0\nuser1@client$ time cp linux-2.6.24.tar.bz2 /cifs_srv\n=> 5 s.\n\n* Test #3\n\n(different user)\nuser1@client$ while do :; do :; done # priority: 19\nuser2@client$ time cp linux-2.6.24.tar.bz2 /cifs_srv\n=> 28 s.\n\nI consider it's a bug because one process only wants network bandwidth (and very few CPU cycles) and the other one only wants the remaining CPU resources.\n\n\nThe problem doesn't happen with a simple netcat transfer. In any condition, I reach 12 MB/s :\n\nclient$ dd if=/dev/zero bs=1M count=64 | nc srv 2000\n64+0 enregistrements lus\n64+0 enregistrements écrits\n67108864 octets (67 MB) copiés, 5,61611 seconde, 11,9 MB/s\n\n\nNote that with CONFIG_FAIR_GROUP_SCHED not set, it can still be slower than 2.6.23.14, but that may be a different bug :\n\n* Test #4\n\n(different user)\nuser1@client$ while do :; do :; done # priority: 0\nuser2@client$ time cp linux-2.6.24.tar.bz2 /cifs_srv\n=> 5 s.\n\n* Test #5\n\nuser1@client$ while do :; do :; done # priority: 19\nuser1@client$ time cp linux-2.6.24.tar.bz2 /cifs_srv\n=> 10 s. !!\n\n\n(The server runs Linux 2.6.23.14 and Samba 3.0.28.)", "patch": ["From ef9884e6f29bbe1075204f962a00f7533bf7e8f3 Mon Sep 17 00:00:00 2001\nFrom: Peter Zijlstra <a.p.zijlstra@chello.nl>\nDate: Thu, 31 Jan 2008 22:45:22 +0100\nSubject: [PATCH] sched: let +nice tasks have smaller impact\nMIME-Version: 1.0\nContent-Type: text/plain; charset=utf-8\nContent-Transfer-Encoding: 8bit\n\nMichel Dänzr has bisected an interactivity problem with\nplus-reniced tasks back to this commit:\n\n 810e95ccd58d91369191aa4ecc9e6d4a10d8d0c8 is first bad commit\n commit 810e95ccd58d91369191aa4ecc9e6d4a10d8d0c8\n Author: Peter Zijlstra <a.p.zijlstra@chello.nl>\n Date:   Mon Oct 15 17:00:14 2007 +0200\n\n sched: another wakeup_granularity fix\n\n      unit mis-match: wakeup_gran was used against a vruntime\n\nfix this by assymetrically scaling the vtime of positive reniced\ntasks.\n\nBisected-by: Michel Dänzer <michel@tungstengraphics.com>\nSigned-off-by: Peter Zijlstra <a.p.zijlstra@chello.nl>\nSigned-off-by: Ingo Molnar <mingo@elte.hu>\n---\n kernel/sched_fair.c |    6 +++++-\n 1 files changed, 5 insertions(+), 1 deletions(-)\n\ndiff --git a/kernel/sched_fair.c b/kernel/sched_fair.c\nindex cf958ae..6c091d6 100644\n--- a/kernel/sched_fair.c\n+++ b/kernel/sched_fair.c\n@@ -1106,7 +1106,11 @@ static void check_preempt_wakeup(struct rq *rq, struct task_struct *p)\n \t}\n \n \tgran = sysctl_sched_wakeup_granularity;\n-\tif (unlikely(se->load.weight != NICE_0_LOAD))\n+\t/*\n+\t * More easily preempt - nice tasks, while not making\n+\t * it harder for + nice tasks.\n+\t */\n+\tif (unlikely(se->load.weight > NICE_0_LOAD))\n \t\tgran = calc_delta_fair(gran, &se->load);\n \n \tif (pse->vruntime + gran < se->vruntime)\n-- \n1.5.2.5\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "File System", "Classification": "Unclassified", "Component": "CIFS", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "fs_cifs", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2008-01-29 09:13 UTC by Julien Muchembled", "Modified": "2008-02-08 13:44 UTC", "CC List": "3 users", "See Also": "", "Kernel Version": "2.6.24", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["kernel/sched_fair.c"], "methods": ["check_preempt_wakeup"]}
{"id": "9779", "title": "Setting cpu_share to 1 freezes system", "description": "Distribution: Ubuntu\nHardware Environment: amd64, x86 kernel\nProblem Description:\n\nThe following command locks up my system:\necho 1 | sudo tee /sys/kernel/uids/`id -u`/cpu_share\n\nWhile I have not reproduced it for this command, it locked up my system twice when trying it with the uid of my system user \"boinc\".\n\nOthers on the IRC channel ##kernel could not confirm it (using virtual machines on 64bit and 32bit), but I think it's grave enough to report it anyway.\n\nI'm using the 2.6.24 kernel from Ubuntu (but someone on ##kernel could not confirm it using the ubuntu-server kernel).\n\nMy CPU is AMD64 3000+.\n\nPlease ask for any details you need to understand the problem.\n\n\nSteps to reproduce:\necho 1 | sudo tee /sys/kernel/uids/`id -u`/cpu_share", "patch": ["Subject: sched: group scheduler, set uid share fix\nFrom: Ingo Molnar <mingo@elte.hu>\n\nsetting cpu share to 1 causes hangs, as reported in:\n\n    http://bugzilla.kernel.org/show_bug.cgi?id=9779\n\nas the default share is 1024, the values of 0 and 1 can indeed\ncause problems. Limit it to 2 or higher values.\n\nThese values can only be set by the root user - but still it\nmakes sense to protect against nonsensical values.\n\nSigned-off-by: Ingo Molnar <mingo@elte.hu>\n---\n kernel/sched.c |    8 ++++++++\n 1 file changed, 8 insertions(+)\n\nIndex: linux/kernel/sched.c\n===================================================================\n--- linux.orig/kernel/sched.c\n+++ linux/kernel/sched.c\n@@ -7153,6 +7153,14 @@ int sched_group_set_shares(struct task_g\n {\n \tint i;\n \n+\t/*\n+\t * A weight of 0 or 1 can cause arithmetics problems.\n+\t * (The default weight is 1024 - so there's no practical\n+\t *  limitation from this.)\n+\t */\n+\tif (shares < 2)\n+\t\tshares = 2;\n+\n \tspin_lock(&tg->lock);\n \tif (tg->shares == shares)\n \t\tgoto done;\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Process Management", "Classification": "Unclassified", "Component": "Scheduler", "Hardware": "All Linux", "Importance": "P1 high", "Assignee": "Ingo Molnar", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2008-01-19 16:12 UTC by Daniel Hahler", "Modified": "2008-01-22 20:39 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "2.6.24", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["kernel/sched.c"], "methods": ["sched_group_set_shares"]}
{"id": "9761", "title": "unsupported ACPI video device - Samsung R70", "description": "Latest working kernel version: unknown\nEarliest failing kernel version:unknown\nDistribution: Mandriva 2008.1 Alpha 2\nHardware Environment: Samsung R70 (BIOS UE6)\nSoftware Environment: 64Bit\nProblem Description:\nWhen booting up my system, I can see this error in my dmesg.\nAs requested on the linux-acpi mailing list, I'm opening that bug.\n\nHere come the dmesg :\n\nACPI Error (utglobal-0126): Unknown exception code: 0xFFFFFFFE [20070126]\nPid: 1952, comm: modprobe Not tainted 2.6.24-laptop-0.rc7.2mdv #1\n\nCall Trace:\n [<ffffffff8038bd2e>] acpi_ut_update_ref_count+0x50/0x9d\n [<ffffffff8038c1d9>] acpi_format_exception+0x2c/0x35\n [<ffffffff8038af73>] acpi_ut_exception+0x25/0x8c\n [<ffffffff803765cc>] acpi_evaluate_integer+0xb6/0xc7\n [<ffffffff881dcd0a>] :video:acpi_video_bus_add+0xcc9/0xce2\n [<ffffffff802c46a8>] ifind+0x58/0xd0\n [<ffffffff8038f2e8>] acpi_device_probe+0x43/0x91\n [<ffffffff803c321c>] driver_probe_device+0x9c/0x1b0\n [<ffffffff803c34e9>] __driver_attach+0xc9/0xd0\n [<ffffffff803c3420>] __driver_attach+0x0/0xd0\n [<ffffffff803c23fd>] bus_for_each_dev+0x4d/0x80\n [<ffffffff803c286c>] bus_add_driver+0xac/0x220\n [<ffffffff8814603c>] :video:acpi_video_init+0x3c/0x5e\n [<ffffffff8026236e>] sys_init_module+0x18e/0x19a0\n [<ffffffff802522f0>] autoremove_wake_function+0x0/0x30\n [<ffffffff8020c34e>] system_call+0x7e/0x83\n\nACPI Exception (video-1721): UNKNOWN_STATUS_CODE, Cant attach device [20070126]\n\nSteps to reproduce:\nJust bootup on that system.", "patch": ["From: Zhang Rui <rui.zhang@intel.com>\n\nThe child of a video bus device is not alway a video device.\nIt should be a warn message rather than an exception here.\nhttp://bugzilla.kernel.org/show_bug.cgi?id=9761\n\nSigned-off-by: Zhang Rui <rui.zhang@intel.com>\n---\n drivers/acpi/video.c |    3 ++-\n 1 file changed, 2 insertions(+), 1 deletion(-)\n\nIndex: linux-2.6/drivers/acpi/video.c\n===================================================================\n--- linux-2.6.orig/drivers/acpi/video.c\n+++ linux-2.6/drivers/acpi/video.c\n@@ -1705,7 +1705,8 @@ acpi_video_bus_get_devices(struct acpi_v\n \n \t\tstatus = acpi_video_bus_get_one_device(dev, video);\n \t\tif (ACPI_FAILURE(status)) {\n-\t\t\tACPI_EXCEPTION((AE_INFO, status, \"Cant attach device\"));\n+\t\t\tACPI_DEBUG_PRINT((ACPI_DB_WARN,\n+\t\t\t\t\t\"Cant attach device\"));\n \t\t\tcontinue;\n \t\t}\n \t}\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "Other", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Zhang Rui", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2008-01-16 00:08 UTC by Erwan Velu", "Modified": "2008-06-23 13:45 UTC", "CC List": "3 users", "See Also": "", "Kernel Version": "2.6.24", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/acpi/video.c"], "methods": ["acpi_video_bus_get_devices"]}
{"id": "9751", "title": "conversion of denormal floats to double is wrong", "description": "Latest working kernel version: none\nEarliest failing kernel version: tested on 2.6.18, but should not work anywhere\nDistribution: Debian\nHardware Environment: alphaev56, alphaev68\nSoftware Environment: mathemu=y\nProblem Description: conversion from denormal float to double is wrong\n\nSteps to reproduce:\n\nCompile with -O0 -mieee or -O2 -mieee:\n\n#include <stdio.h>\nfloat x = 1.0;\ndouble y;\n\nint g(float z)\n{\n  printf (\"%g\\n\", z);\n}\n\nint main()\n{\n  x *= (1.0f / 65536.0f);\n  x *= (1.0f / 65536.0f);\n  x *= (1.0f / 65536.0f);\n  x *= (1.0f / 65536.0f);\n  x *= (1.0f / 65536.0f);\n  x *= (1.0f / 65536.0f);\n  x *= (1.0f / 65536.0f);\n  x *= (1.0f / 65536.0f);\n  x *= (1.0f / 65536.0f);\n  x *= (1.0f / 32.0f);\n  g(x);\n  y = x;\n  g(y);\n}\n\nCorrect value should be:\n\n1.4013e-45\n1.4013e-45\n\nActual value is:\n\n2.65249e-315\n2.65249e-315\n\nor\n\n2.65249e-315\n0\n\nThe right value is 2-149, that is 1.4013e-45, but the alpha does not do it.  The architecture handbook says \"A trap handler can convert an S_ floating denormal value into the corresponding T_ floating finite value by adding 896 to the exponent and normalizing\", but here 896 is not added (math-emu should, at least on older alphas where it is relevant) and I get a denormal double, 2.65249e-315.\n\nActually both compiled programs are correct.  You get a zero if the denormal is casted back to float (which makes a zero, because it is way off the range of a float); you get 2.65249e-315 if the compiler performs some copy propagation and sees through the conversion (because if it was not for the errata, the two values should indeed have been equal).\n\nThe bug reproduces both on alphaev56 and on alphaev68 (where math-emu should not be relevant, or so I'm told), both with CONFIG_MATHEMU=y.", "patch": ["alpha: fix conversion from denormal float to double\n\nThe trap handler does properly update the fraction,\nbut not the exponent...\n\nThanks to Paolo Bonzini <bonzini@gnu.org> for the bug report\nand the testcase.\n\nSigned-off-by: Ivan Kokshaysky <ink@jurassic.park.msu.ru>\n---\n arch/alpha/math-emu/math.c |    2 +-\n 1 files changed, 1 insertions(+), 1 deletions(-)\n\ndiff --git a/arch/alpha/math-emu/math.c b/arch/alpha/math-emu/math.c\nindex ae79dd9..58c2669 100644\n--- a/arch/alpha/math-emu/math.c\n+++ b/arch/alpha/math-emu/math.c\n@@ -225,7 +225,7 @@ alpha_fp_emul (unsigned long pc)\n \t\t\t\tFP_UNPACK_SP(SB, &vb);\n \t\t\t\tDR_c = DB_c;\n \t\t\t\tDR_s = DB_s;\n-\t\t\t\tDR_e = DB_e;\n+\t\t\t\tDR_e = DB_e + (1024 - 128);\n \t\t\t\tDR_f = SB_f << (52 - 23);\n \t\t\t\tgoto pack_d;\n \t\t\t}\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Platform Specific/Hardware", "Classification": "Unclassified", "Component": "Alpha", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Richard Henderson", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2008-01-15 00:43 UTC by Paolo Bonzini", "Modified": "2008-06-02 20:56 UTC", "CC List": "1 user", "See Also": "", "Kernel Version": "2.6.18", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["arch/alpha/math-emu/math.c"], "methods": ["alpha_fp_emul"]}
{"id": "9747", "title": "Oops on boot from laptop mode writing to /proc/acpi/processor/CPU0/throttling", "": "Show dependency tree", "description": "Latest working kernel version: Unsure.  Later than 2.6.24-rc2\nEarliest failing kernel version: 2.6.24-rc6 (possibly earlier)\nDistribution: Debian\nHardware Environment: Toshiba Portege r500\nSoftware Environment:\nProblem Description:\n\nWhen I boot laptop-mode fires up and tries to write to /proc/acpi/processor/CPU0/throttling which contains <not supported>\n\nI don't quite know what I've done to get it to contain <not supported> but anyway that'll be more fun to track down I'm sure.\n\nIn any case, in this configuration I get this oops even if all I do is\necho stuff >/proc/acpi/processor/CPU0/throttling\n\n[   32.378673] Unable to handle kernel NULL pointer dereference at 0000000000000\n000 RIP: \n[   32.378761]  [<0000000000000000>] _stext+0x7fdf7000/0x1a\n[   32.378965] PGD 37bb3067 PUD 37b2a067 PMD 0 \n[   32.379182] Oops: 0010 [1] SMP \n[   32.379350] CPU 0 \n[   32.379466] Modules linked in: rfcomm l2cap bluetooth acpi_cpufreq cpufreq_st\nats cpufreq_userspace cpufreq_powersave cpufreq_ondemand freq_table sg sr_mod cd\nrom loop arc4 ecb blkcipher snd_hda_intel snd_pcm_oss snd_pcm snd_mixer_oss snd_\nseq_dummy pcmcia snd_seq_oss snd_seq_midi snd_rawmidi snd_seq_midi_event iwl4965\n snd_seq firmware_class sdhci snd_timer snd_seq_device mmc_core mac80211 yenta_s\nocket rsrc_nonstatic pcmcia_core snd psmouse soundcore cfg80211 snd_page_alloc i\nntel_agp battery ac button evdev usb_storage ext3 jbd mbcache dm_mirror dm_snaps\nhot dm_mod ehci_hcd uhci_hcd e1000 sd_mod thermal processor fan\n[   32.382717] Pid: 3267, comm: laptop_mode Not tainted 2.6.24-rc7 #1\n[   32.382797] RIP: 0010:[<0000000000000000>]  [<0000000000000000>] _stext+0x7fd\nf7000/0x1a\n[   32.382948] RSP: 0018:ffff81007b84de80  EFLAGS: 00010296\n[   32.383027] RAX: 0000000000000000 RBX: ffff81007d8c7800 RCX: 0000000000000000\n[   32.383110] RDX: ffff8100826b9000 RSI: 0000000000000000 RDI: ffff81007d8c7800\n[   32.383193] RBP: fffffffffffffffb R08: 000000000000002d R09: 0000000000000000\n[   32.383276] R10: 740174016f017201 R11: ffffffff802d03ef R12: 0000000000000000\n[   32.383359] R13: 0000000000000003 R14: 0000000000000003 R15: 00000000005c5808\n[   32.383442] FS:  00002b6898b11dc0(0000) GS:ffffffff804cd000(0000) knlGS:0000000000000000\n[   32.383545] CS:  0010 DS: 0000 ES: 0000 CR0: 000000008005003b\n[   32.383625] CR2: 0000000000000000 CR3: 000000007ba46000 CR4: 00000000000006e0\n[   32.383707] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000\n[   32.383790] DR3: 0000000000000000 DR6: 00000000ffff0ff0 DR7: 0000000000000400\n[   32.383873] Process laptop_mode (pid: 3267, threadinfo ffff81007b84c000, task ffff81007ba40040)\n[   32.383977] Stack:  ffffffff88003c3d 0000000000000003 ffff81007d8c7800 ffff81007b84df50\n[   32.384314]  ffffffff88003e43 00000000000a312d ffff810000000000 ffff81007d897cc0\n[   32.384603]  fffffffffffffffb ffff81007ba57540 ffffffff802b717d ffff81007ba57780\n[   32.384829] Call Trace:\n[   32.384973]  [<ffffffff88003c3d>] :processor:acpi_processor_set_throttling+0x37/0x52\n[   32.385083]  [<ffffffff88003e43>] :processor:acpi_processor_write_throttling+0x61/0x74\n[   32.385191]  [<ffffffff802b717d>] proc_reg_write+0x7e/0x99\n[   32.385273]  [<ffffffff8028205f>] vfs_write+0xc6/0x14f\n[   32.385354]  [<ffffffff802825ad>] sys_write+0x45/0x6e\n[   32.385435]  [<ffffffff8020beee>] system_call+0x7e/0x83\n[   32.385517] \n[   32.385585] \n[   32.385585] Code:  Bad RIP value.\n[   32.385819] RIP  [<0000000000000000>] _stext+0x7fdf7000/0x1a\n[   32.385947]  RSP <ffff81007b84de80>\n[   32.386020] CR2: 0000000000000000\n[   32.386109] ---[ end trace 2ded1a5f4094ec80 ]---", "patch": ["ACPI: processor: Fix null pointer dereference in throttling\n\nFrom: Alexey Starikovskiy <astarikovskiy@suse.de>\n\nSigned-off-by: Alexey Starikovskiy <astarikovskiy@suse.de>\n---\n\n drivers/acpi/processor_throttling.c |    4 ++--\n 1 files changed, 2 insertions(+), 2 deletions(-)\n\ndiff --git a/drivers/acpi/processor_throttling.c b/drivers/acpi/processor_throttling.c\nindex 6742d7b..1685b40 100644\n--- a/drivers/acpi/processor_throttling.c\n+++ b/drivers/acpi/processor_throttling.c\n@@ -775,12 +775,12 @@ int acpi_processor_get_throttling_info(struct acpi_processor *pr)\n \t\tacpi_processor_get_throttling_states(pr) ||\n \t\tacpi_processor_get_platform_limit(pr))\n \t{\n-\t\tif (acpi_processor_get_fadt_info(pr))\n-\t\t\treturn 0;\n \t\tpr->throttling.acpi_processor_get_throttling =\n \t\t    &acpi_processor_get_throttling_fadt;\n \t\tpr->throttling.acpi_processor_set_throttling =\n \t\t    &acpi_processor_set_throttling_fadt;\n+\t\tif (acpi_processor_get_fadt_info(pr))\n+\t\t\treturn 0;\n \t} else {\n \t\tpr->throttling.acpi_processor_get_throttling =\n \t\t    &acpi_processor_get_throttling_ptc;\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "Config-Processors", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Alexey Starikovskiy", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "9243", "Reported": "2008-01-14 11:19 UTC by Simon Huggins", "Modified": "2008-01-24 12:46 UTC", "CC List": "3 users", "See Also": "", "Kernel Version": "2.6.24-rc7", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/acpi/processor_throttling.c"], "methods": ["acpi_processor_get_throttling_info"]}
{"id": "9704", "title": "ACPI: processor throttling set error", "description": "Most recent kernel where this bug did not occur: None\nDistribution: FC8\nHardware Environment: All\nSoftware Environment: All\nProblem Description: \nWhen echo some invalid values to /proc/acpi/processor/*/throttling,\nthere isn't any error info returned, on the contray, it sets\nthrottling value to some T* successfully, obviously, this is incorrect,\na correct way should be to let it fail and return error info.\n\nSteps to reproduce:\n\n[root@localhost /]# echo \"2xxxx\" > /proc/acpi/processor/CPU0/throttling\n[root@localhost /]# cat /proc/acpi/processor/CPU0/throttling\nstate count:             8\nactive state:            T2\nstate available: T0 to T7\nstates:\n    T0:                  100%\n    T1:                  87%\n   *T2:                  75%\n    T3:                  62%\n    T4:                  50%\n    T5:                  37%\n    T6:                  25%\n    T7:                  12%\n[root@localhost /]# echo \"\" > /proc/acpi/processor/CPU0/throttling\n[root@localhost /]# cat /proc/acpi/processor/CPU0/throttling\nstate count:             8\nactive state:            T0\nstate available: T0 to T7\nstates:\n   *T0:                  100%\n    T1:                  87%\n    T2:                  75%\n    T3:                  62%\n    T4:                  50%\n    T5:                  37%\n    T6:                  25%\n    T7:                  12%\n[root@localhost /]# echo \"7xxx\" > /proc/acpi/processor/CPU0/throttling\n[root@localhost /]# cat /proc/acpi/processor/CPU0/throttling\nstate count:             8\nactive state:            T7\nstate available: T0 to T7\nstates:\n    T0:                  100%\n    T1:                  87%\n    T2:                  75%\n    T3:                  62%\n    T4:                  50%\n    T5:                  37%\n    T6:                  25%\n   *T7:                  12%\n[root@localhost /]#", "patch": ["Subject: ACPI: fix processor throttling set error\nFrom: Yi Yang <yi.y.yang@intel.com>\n\nWhen echo some invalid values to /proc/acpi/processor/*/throttling,\nthere isn't any error info returned, on the contray, it sets\nthrottling value to some T* successfully, obviously, this is incorrect,\na correct way should be to let it fail and return error info.\n\nThis patch fixed the aforementioned issue, it also enables\n/proc/acpi/processor/*/throttling to accept such values as 't0' and 'T0',\nit also strictly limits /proc/acpi/processor/*/throttling only to accept\n \"*\", \"t*\" and \"T*\", \"*\" is the throttling state value the processor can\nsupport, current, it is 0 - 7.\n\nBefore applying this patch, the test result is below:\n\n[root@localhost acpi]# cat /proc/acpi/processor/CPU0/throttling\nstate count:             8\nactive state:            T1\nstate available: T0 to T7\nstates:\n    T0:                  100%\n   *T1:                  87%\n    T2:                  75%\n    T3:                  62%\n    T4:                  50%\n    T5:                  37%\n    T6:                  25%\n    T7:                  12%\n[root@localhost acpi]# echo \"1xxxxxx\" > /proc/acpi/processor/CPU0/throttling\n[root@localhost acpi]# cat /proc/acpi/processor/CPU0/throttling\nstate count:             8\nactive state:            T1\nstate available: T0 to T7\nstates:\n    T0:                  100%\n   *T1:                  87%\n    T2:                  75%\n    T3:                  62%\n    T4:                  50%\n    T5:                  37%\n    T6:                  25%\n    T7:                  12%\n[root@localhost acpi]# echo \"0\" > /proc/acpi/processor/CPU0/throttling\n[root@localhost acpi]# cat /proc/acpi/processor/CPU0/throttling\nstate count:             8\nactive state:            T0\nstate available: T0 to T7\nstates:\n   *T0:                  100%\n    T1:                  87%\n    T2:                  75%\n    T3:                  62%\n    T4:                  50%\n    T5:                  37%\n    T6:                  25%\n    T7:                  12%\n[root@localhost acpi]# cd /\n[root@localhost /]# cat /proc/acpi/processor/CPU0/throttling\nstate count:             8\nactive state:            T0\nstate available: T0 to T7\nstates:\n   *T0:                  100%\n    T1:                  87%\n    T2:                  75%\n    T3:                  62%\n    T4:                  50%\n    T5:                  37%\n    T6:                  25%\n    T7:                  12%\n[root@localhost /]# echo \"T0\" > /proc/acpi/processor/CPU0/throttling\n[root@localhost /]# cat /proc/acpi/processor/CPU0/throttling\nstate count:             8\nactive state:            T0\nstate available: T0 to T7\nstates:\n   *T0:                  100%\n    T1:                  87%\n    T2:                  75%\n    T3:                  62%\n    T4:                  50%\n    T5:                  37%\n    T6:                  25%\n    T7:                  12%\n[root@localhost /]# echo \"T7\" > /proc/acpi/processor/CPU0/throttling\n[root@localhost /]# cat /proc/acpi/processor/CPU0/throttling\nstate count:             8\nactive state:            T0\nstate available: T0 to T7\nstates:\n   *T0:                  100%\n    T1:                  87%\n    T2:                  75%\n    T3:                  62%\n    T4:                  50%\n    T5:                  37%\n    T6:                  25%\n    T7:                  12%\n[root@localhost /]# echo \"T100\" > /proc/acpi/processor/CPU0/throttling\n[root@localhost /]# cat /proc/acpi/processor/CPU0/throttling\nstate count:             8\nactive state:            T0\nstate available: T0 to T7\nstates:\n   *T0:                  100%\n    T1:                  87%\n    T2:                  75%\n    T3:                  62%\n    T4:                  50%\n    T5:                  37%\n    T6:                  25%\n    T7:                  12%\n[root@localhost /]# echo \"xxx\" > /proc/acpi/processor/CPU0/throttling\n[root@localhost /]# cat /proc/acpi/processor/CPU0/throttling\nstate count:             8\nactive state:            T0\nstate available: T0 to T7\nstates:\n   *T0:                  100%\n    T1:                  87%\n    T2:                  75%\n    T3:                  62%\n    T4:                  50%\n    T5:                  37%\n    T6:                  25%\n    T7:                  12%\n[root@localhost /]# echo \"2xxxx\" > /proc/acpi/processor/CPU0/throttling\n[root@localhost /]# cat /proc/acpi/processor/CPU0/throttling\nstate count:             8\nactive state:            T2\nstate available: T0 to T7\nstates:\n    T0:                  100%\n    T1:                  87%\n   *T2:                  75%\n    T3:                  62%\n    T4:                  50%\n    T5:                  37%\n    T6:                  25%\n    T7:                  12%\n[root@localhost /]# echo \"\" > /proc/acpi/processor/CPU0/throttling\n[root@localhost /]# cat /proc/acpi/processor/CPU0/throttling\nstate count:             8\nactive state:            T0\nstate available: T0 to T7\nstates:\n   *T0:                  100%\n    T1:                  87%\n    T2:                  75%\n    T3:                  62%\n    T4:                  50%\n    T5:                  37%\n    T6:                  25%\n    T7:                  12%\n[root@localhost /]# echo \"7777\" > /proc/acpi/processor/CPU0/throttling\n-bash: echo: write error: Invalid argument\n[root@localhost /]# echo \"7xxx\" > /proc/acpi/processor/CPU0/throttling\n[root@localhost /]# cat /proc/acpi/processor/CPU0/throttling\nstate count:             8\nactive state:            T7\nstate available: T0 to T7\nstates:\n    T0:                  100%\n    T1:                  87%\n    T2:                  75%\n    T3:                  62%\n    T4:                  50%\n    T5:                  37%\n    T6:                  25%\n   *T7:                  12%\n[root@localhost /]#\n\n\nAfter applying this patch, the test result is below:\n\n[root@localhost linux-2.6.24-rc6]# echo > /proc/acpi/processor/CPU0/throttling\n-bash: echo: write error: Invalid argument\n[root@localhost linux-2.6.24-rc6]# echo \"\" > /proc/acpi/processor/CPU0/throttling\n-bash: echo: write error: Invalid argument\n[root@localhost linux-2.6.24-rc6]# echo \"0\" > /proc/acpi/processor/CPU0/throttling\n[root@localhost linux-2.6.24-rc6]# echo \"t0\" > /proc/acpi/processor/CPU0/throttling\n[root@localhost linux-2.6.24-rc6]# echo \"T0\" > /proc/acpi/processor/CPU0/throttling\n[root@localhost linux-2.6.24-rc6]# cat /proc/acpi/processor/CPU0/throttling\nstate count:             8\nactive state:            T0\nstate available: T0 to T7\nstates:\n   *T0:                  100%\n    T1:                  87%\n    T2:                  75%\n    T3:                  62%\n    T4:                  50%\n    T5:                  37%\n    T6:                  25%\n    T7:                  12%\n[root@localhost linux-2.6.24-rc6]# echo \"T7\" > /proc/acpi/processor/CPU0/throttling\n[root@localhost linux-2.6.24-rc6]# cat /proc/acpi/processor/CPU0/throttling\nstate count:             8\nactive state:            T7\nstate available: T0 to T7\nstates:\n    T0:                  100%\n    T1:                  87%\n    T2:                  75%\n    T3:                  62%\n    T4:                  50%\n    T5:                  37%\n    T6:                  25%\n   *T7:                  12%\n[root@localhost linux-2.6.24-rc6]# echo \"T8\" > /proc/acpi/processor/CPU0/throttling\n-bash: echo: write error: Invalid argument\n[root@localhost linux-2.6.24-rc6]# vi drivers/acpi/processor_throttling.c\n[root@localhost linux-2.6.24-rc6]# echo \"T8\" > /proc/acpi/processor/CPU0/throttling\n-bash: echo: write error: Invalid argument\n[root@localhost linux-2.6.24-rc6]# echo \"t7\" > /proc/acpi/processor/CPU0/throttling\n[root@localhost linux-2.6.24-rc6]# echo \"t70\" > /proc/acpi/processor/CPU0/throttling\n-bash: echo: write error: Invalid argument\n[root@localhost linux-2.6.24-rc6]# echo \"70\" > /proc/acpi/processor/CPU0/throttling\n-bash: echo: write error: Invalid argument\n[root@localhost linux-2.6.24-rc6]# echo \"7000\" > /proc/acpi/processor/CPU0/throttling\n-bash: echo: write error: Invalid argument\n[root@localhost linux-2.6.24-rc6]# echo \"70\" > /proc/acpi/processor/CPU0/throttling\n-bash: echo: write error: Invalid argument\n[root@localhost linux-2.6.24-rc6]# echo \"xxx\" > /proc/acpi/processor/CPU0/throttling\n-bash: echo: write error: Invalid argument\n[root@localhost linux-2.6.24-rc6]# echo > /proc/acpi/processor/CPU0/throttling\n-bash: echo: write error: Invalid argument\n[root@localhost linux-2.6.24-rc6]# echo -n > /proc/acpi/processor/CPU0/throttling\n[root@localhost linux-2.6.24-rc6]# echo -n \"\" > /proc/acpi/processor/CPU0/throttling\n[root@localhost linux-2.6.24-rc6]# echo $?\n0\n[root@localhost linux-2.6.24-rc6]# echo -n \"\" > /proc/acpi/processor/CPU0/throttling\n[root@localhost linux-2.6.24-rc6]# cat /proc/acpi/processor/CPU0/throttling\nstate count:             8\nactive state:            T7\nstate available: T0 to T7\nstates:\n    T0:                  100%\n    T1:                  87%\n    T2:                  75%\n    T3:                  62%\n    T4:                  50%\n    T5:                  37%\n    T6:                  25%\n   *T7:                  12%\n[root@localhost linux-2.6.24-rc6]# echo -n \"\" > /proc/acpi/processor/CPU0/throttling\n[root@localhost linux-2.6.24-rc6]# cat /proc/acpi/processor/CPU0/throttling\nstate count:             8\nactive state:            T7\nstate available: T0 to T7\nstates:\n    T0:                  100%\n    T1:                  87%\n    T2:                  75%\n    T3:                  62%\n    T4:                  50%\n    T5:                  37%\n    T6:                  25%\n   *T7:                  12%\n[root@localhost linux-2.6.24-rc6]# echo t0 > /proc/acpi/processor/CPU0/throttling\n[root@localhost linux-2.6.24-rc6]# echo T0 > /proc/acpi/processor/CPU0/throttling\n[root@localhost linux-2.6.24-rc6]# echo Tt0 > /proc/acpi/processor/CPU0/throttling\n-bash: echo: write error: Invalid argument\n[root@localhost linux-2.6.24-rc6]# echo T > /proc/acpi/processor/CPU0/throttling\n-bash: echo: write error: Invalid argument\n[root@localhost linux-2.6.24-rc6]#\n\nSigned-off-by: Yi Yang <yi.y.yang@intel.com>\n---\n processor_throttling.c |   24 ++++++++++++++++++++----\n 1 file changed, 20 insertions(+), 4 deletions(-)\n\ndiff --git a/drivers/acpi/processor_throttling.c b/drivers/acpi/processor_throttling.c\nindex 6742d7b..10035a6 100644\n--- a/drivers/acpi/processor_throttling.c\n+++ b/drivers/acpi/processor_throttling.c\n@@ -898,7 +898,10 @@ static ssize_t acpi_processor_write_throttling(struct file *file,\n \tint result = 0;\n \tstruct seq_file *m = file->private_data;\n \tstruct acpi_processor *pr = m->private;\n-\tchar state_string[12] = { '\\0' };\n+\tchar state_string[5] = \"\";\n+\tchar *charp = NULL;\n+\tsize_t state_val = 0;\n+\tchar tmpbuf[5] = \"\";\n \n \tif (!pr || (count > sizeof(state_string) - 1))\n \t\treturn -EINVAL;\n@@ -907,10 +910,23 @@ static ssize_t acpi_processor_write_throttling(struct file *file,\n \t\treturn -EFAULT;\n \n \tstate_string[count] = '\\0';\n+\tif ((count > 0) && (state_string[count-1] == '\\n'))\n+\t\tstate_string[count-1] = '\\0';\n \n-\tresult = acpi_processor_set_throttling(pr,\n-\t\t\t\t\t       simple_strtoul(state_string,\n-\t\t\t\t\t\t\t      NULL, 0));\n+\tcharp = state_string;\n+\tif ((state_string[0] == 't') || (state_string[0] == 'T'))\n+\t\tcharp++;\n+\n+\tstate_val = simple_strtoul(charp, NULL, 0);\n+\tif (state_val >= pr->throttling.state_count)\n+\t\treturn -EINVAL;\n+\n+\tsnprintf(tmpbuf, 5, \"%d\", state_val);\n+\n+\tif (strcmp(tmpbuf, charp) != 0)\n+\t\treturn -EINVAL;\n+\n+\tresult = acpi_processor_set_throttling(pr, state_val);\n \tif (result)\n \t\treturn result;\n \n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "Config-Processors", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "acpi_config-processors", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2008-01-06 23:36 UTC by Yi Yang", "Modified": "2008-07-16 15:40 UTC", "CC List": "3 users", "See Also": "", "Kernel Version": "2.6.24", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/acpi/processor_throttling.c"], "methods": ["acpi_processor_write_throttling"]}
{"id": "9699", "title": "radio-sf16fmr2 probably buggy - system inconsistent after probe", "description": "Most recent kernel where this bug did not occur: not known\n\nDistribution: OpenSuSE 10.3 with suse kernel & vanilla 2.6.24rc6,  grml (live-cd) daily build\n\nHardware Environment: running inside VMware Workstation 6.x on FSC Lifebook e-series, running native on older FSC Lifebook\n\nSoftware Environment: ???\n\nProblem Description:\nloading radio-sf16fmr2 on a system without that hardware leaves the system in an inconsistent state after probe, leading to weird behaviour or even system crash\n\nSteps to reproduce:\n\neither:\nopensuse103:~ # modprobe radio-sf16fmr2\nFATAL: Error inserting radio_sf16fmr2 (/lib/modules/2.6.24-rc6/kernel/drivers/media/radio/radio-sf16fmr2.ko): Device or resource busy\nopensuse103:~ # cat /proc/ioports\nSegmentation fault\n\nor:\nopensuse103:~ # modprobe radio-sf16fmr2\nFATAL: Error inserting radio_sf16fmr2 (/lib/modules/2.6.24-rc6/kernel/drivers/media/radio/radio-sf16fmr2.ko): Device or resource busy\n\nopensuse103:~ # modprobe esp\n<system freeze>\n\n\ndmesg after cat /proc/ioports:\nfmr2: port 0x384 already in use\nBUG: unable to handle kernel paging request at virtual address e09e467a\nprinting eip: c01d6c8e *pde = 1f41b067 *pte = 00000000\nOops: 0000 [#1] SMP\nModules linked in: videodev v4l2_common v4l1_compat compat_ioctl32 edd iptable_filter ip_tables ip6table_filter ip6_tables x_tables ipv6 af_packet microcode firmware_class fuse loop dm_mod ide_cd cdrom pata_acpi ata_piix ahci ata_generic libata container piix pcnet32 thermal generic shpchp mii ac intel_agp parport_pc pci_hotplug processor ide_core i2c_piix4 parport rtc_cmos agpgart power_supply button rtc_core i2c_core rtc_lib sg ext3 jbd mbcache sd_mod ehci_hcd mptspi mptscsih mptbase uhci_hcd scsi_transport_spi scsi_mod usbcore\n\nPid: 2551, comm: cat Not tainted (2.6.24-rc6-vanilla+suseconfig #11)\nEIP: 0060:[<c01d6c8e>] EFLAGS: 00010297 CPU: 0\nEIP is at strnlen+0x6/0x18\nEAX: e09e467a EBX: e09e467a ECX: e09e467a EDX: fffffffe\nESI: dec4f15e EDI: dee89f10 EBP: ffffffff ESP: dee89e88\n DS: 007b ES: 007b FS: 00d8 GS: 0033 SS: 0068\nProcess cat (pid: 2551, ti=dee88000 task=dea14e70 task.ti=dee88000)\nStack: c01d63d6 00000000 00000000 00000010 00000004 ffffffff 00000001 00000eae\n       dec4f152 00000010 dec50000 00000000 ffffffff c03233cb dec4f152 de82ac80\n       de82ac80 00000400 c018a6b2 dee89ef0 dee89ef0 00000000 c0368774 c012ab4c\nCall Trace:\n [<c01d63d6>] vsnprintf+0x29c/0x469\n [<c018a6b2>] seq_printf+0x2e/0x4b\n [<c012ab4c>] r_show+0x7f/0x88\n [<c018ac63>] seq_read+0x1a1/0x27e\n [<c018aac2>] seq_read+0x0/0x27e\n [<c01a1125>] proc_reg_read+0x5e/0x71\n [<c01a10c7>] proc_reg_read+0x0/0x71\n [<c017557a>] vfs_read+0x9f/0x127\n [<c017596f>] sys_read+0x41/0x67\n [<c0104f52>] sysenter_past_esp+0x6b/0xa9\n =======================\nCode: c9 74 0c f2 ae 74 05 bf 01 00 00 00 4f 89 fa 5f 89 d0 c3 85 c9 57 89 c7 89 d0 74 05 f2 ae 75 01 4f 89 f8 5f c3 89 c1 89 c8 eb 06 <80> 38 00 74 07 40 4a 83 fa ff 75 f4 29 c8 c3 90 90 90 57 83 c9\nEIP: [<c01d6c8e>] strnlen+0x6/0x18 SS:ESP 0068:dee89e88\n---[ end trace 598964de8ea8972c ]---", "patch": ["diff -r c0b10134f05b linux/drivers/media/radio/radio-sf16fmr2.c\n--- a/linux/drivers/media/radio/radio-sf16fmr2.c\tSun Jan 06 10:54:17 2008 -0200\n+++ b/linux/drivers/media/radio/radio-sf16fmr2.c\tWed Jan 09 07:35:18 2008 -0200\n@@ -475,7 +475,7 @@ static int __init fmr2_init(void)\n \n \tmutex_init(&lock);\n \n-\tif (request_region(io, 2, \"sf16fmr2\"))\n+\tif (!request_region(io, 2, \"sf16fmr2\"))\n \t{\n \t\tprintk(KERN_ERR \"fmr2: port 0x%x already in use\\n\", io);\n \t\treturn -EBUSY;\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "v4l-dvb", "Classification": "Unclassified", "Component": "radio", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Mauro Carvalho Chehab", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2008-01-05 15:08 UTC by Roland Kletzing", "Modified": "2008-01-12 03:20 UTC", "CC List": "1 user", "See Also": "", "Kernel Version": "2.6.24", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/media/radio/radio-sf16fmr2.c"], "methods": ["fmr2_init"]}
{"id": "9643", "title": "/proc/acpi/alarm set error", "description": "Most recent kernel where this bug did not occur: none\nDistribution: FC8\nHardware Environment: All\nSoftware Environment: All\nProblem Description: after echo \"2007 12\" > /proc/acpi/alarm, you'll get 2007-12-12 12:12:12 by cat /proc/acpi/alarm, obviously it is wrong, it should consider \"2007 12\" as an invalid input.\n\nSteps to reproduce:\n\n[root@localhost /]# echo \"2006 09\" > /proc/acpi/alarm\n[root@localhost /]# cat /proc/acpi/alarm\n2007-12-09 09:09:09\n[root@localhost /]# echo \"2006 04\" > /proc/acpi/alarm\n[root@localhost /]# cat /proc/acpi/alarm\n2007-12-04 04:04:04", "patch": ["/proc/acpi/alarm can't be set correctly, here is a sample:\n\n[root@localhost /]# echo \"2006 09\" > /proc/acpi/alarm\n[root@localhost /]# cat /proc/acpi/alarm\n2007-12-09 09:09:09\n[root@localhost /]# echo \"2006 04\" > /proc/acpi/alarm\n[root@localhost /]# cat /proc/acpi/alarm\n2007-12-04 04:04:04\n[root@localhost /]#\n\nObviously, it is wrong, it should consider it as an invalid input.\n\nThis patch'll fix this issue, after applying this patch, the result is:\n\n[root@localhost /]# echo \"2008 09\" > /proc/acpi/alarm\n-bash: echo: write error: Invalid argument\n[root@localhost /]#\n\nSigned-off by Yi Yang <yi.y.yang@intel.com>\n \ndiff --git a/drivers/acpi/sleep/proc.c b/drivers/acpi/sleep/proc.c\nindex 1538355..fce78fb 100644\n--- a/drivers/acpi/sleep/proc.c\n+++ b/drivers/acpi/sleep/proc.c\n@@ -178,6 +178,9 @@ static int get_date_field(char **p, u32 * value)\n \t * Try to find delimeter, only to insert null.  The end of the\n \t * string won't have one, but is still valid.\n \t */\n+\tif (*p == NULL)\n+\t\treturn result;\n+\n \tnext = strpbrk(*p, \"- :\");\n \tif (next)\n \t\t*next++ = '\\0';\n@@ -190,6 +193,8 @@ static int get_date_field(char **p, u32 * value)\n \n \tif (next)\n \t\t*p = next;\n+\telse\n+\t\t*p = NULL;\n \n \treturn result;\n }\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "Other", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Yi Yang", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2007-12-26 22:06 UTC by Yi Yang", "Modified": "2008-02-10 14:44 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "2.6.24", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/acpi/sleep/proc.c"], "methods": ["get_date_field"]}
{"id": "9385", "title": "scroll wheel on BTC 8193 doesn't work", "description": "Scroll wheel on BTC 8193 keyboard is not working in Linux. On another keyboard (Genius SlimStar Pro) and the scroll wheel works there.\n\nWhen I rotate or click the wheel, nothing happens, nothing is appearing in the relevant /dev/input/eventNN file, nothing bad in dmesg.\n\nHere's the hardware info I was able to collect:\n\n# dmesg | tail -n 6 \nusb 1-6.1.2: new low speed USB device using ehci_hcd and address 16\nusb 1-6.1.2: configuration #1 chosen from 1 choice\ninput: USB-compliant keyboard as /class/input/input18\ninput: USB HID v1.10 Keyboard [USB-compliant keyboard] on usb-0000:00:1a.7-6.1.2\ninput: USB-compliant keyboard as /class/input/input19\ninput: USB HID v1.10 Device [USB-compliant keyboard] on usb-0000:00:1a.7-6.1.2\n\n# /sbin/lsusb | grep KEY\nBus 001 Device 016: ID 0518:0002 EzKEY Corp. \n\n# /sbin/lsusb -d 0518:0002 -v\nBus 001 Device 016: ID 0518:0002 EzKEY Corp. \nDevice Descriptor:\n  bLength                18\n  bDescriptorType         1\n  bcdUSB               1.10\n  bDeviceClass            0 (Defined at Interface level)\n  bDeviceSubClass         0 \n  bDeviceProtocol         0 \n  bMaxPacketSize0         8\n  idVendor           0x0518 EzKEY Corp.\n  idProduct          0x0002 \n  bcdDevice            1.00\n  iManufacturer           0 \n  iProduct                1 USB-compliant keyboard\n  iSerial                 0 \n  bNumConfigurations      1\n  Configuration Descriptor:\n    bLength                 9\n    bDescriptorType         2\n    wTotalLength           59\n    bNumInterfaces          2\n    bConfigurationValue     1\n    iConfiguration          0 \n    bmAttributes         0xa0\n      Remote Wakeup\n    MaxPower              100mA\n    Interface Descriptor:\n      bLength                 9\n      bDescriptorType         4\n      bInterfaceNumber        0\n      bAlternateSetting       0\n      bNumEndpoints           1\n      bInterfaceClass         3 Human Interface Devices\n      bInterfaceSubClass      1 Boot Interface Subclass\n      bInterfaceProtocol      1 Keyboard\n      iInterface              0 \n        HID Device Descriptor:\n          bLength                 9\n          bDescriptorType        33\n          bcdHID               1.10\n          bCountryCode            0 Not supported\n          bNumDescriptors         1\n          bDescriptorType        34 Report\n          wDescriptorLength      65\n         Report Descriptors: \n           ** UNAVAILABLE **\n      Endpoint Descriptor:\n        bLength                 7\n        bDescriptorType         5\n        bEndpointAddress     0x81  EP 1 IN\n        bmAttributes            3\n          Transfer Type            Interrupt\n          Synch Type               None\n          Usage Type               Data\n        wMaxPacketSize     0x0008  1x 8 bytes\n        bInterval              10\n    Interface Descriptor:\n      bLength                 9\n      bDescriptorType         4\n      bInterfaceNumber        1\n      bAlternateSetting       0\n      bNumEndpoints           1\n      bInterfaceClass         3 Human Interface Devices\n      bInterfaceSubClass      1 Boot Interface Subclass\n      bInterfaceProtocol      2 Mouse\n      iInterface              0 \n        HID Device Descriptor:\n          bLength                 9\n          bDescriptorType        33\n          bcdHID               1.10\n          bCountryCode            0 Not supported\n          bNumDescriptors         1\n          bDescriptorType        34 Report\n          wDescriptorLength      50\n         Report Descriptors: \n           ** UNAVAILABLE **\n      Endpoint Descriptor:\n        bLength                 7\n        bDescriptorType         5\n        bEndpointAddress     0x82  EP 2 IN\n        bmAttributes            3\n          Transfer Type            Interrupt\n          Synch Type               None\n          Usage Type               Data\n        wMaxPacketSize     0x0003  1x 3 bytes\n        bInterval              10\n\nIf there is anything else I should report here -- please ask.", "patch": ["diff --git a/drivers/hid/hid-input.c b/drivers/hid/hid-input.c\nindex 0b27da7..a8a3c9b 100644\n--- a/drivers/hid/hid-input.c\n+++ b/drivers/hid/hid-input.c\n@@ -655,6 +655,12 @@ static void hidinput_configure_usage(struct hid_input *hidinput, struct hid_fiel\n \t\t\t\tcase 0x22d: map_key_clear(KEY_ZOOMIN);\t\tbreak;\n \t\t\t\tcase 0x22e: map_key_clear(KEY_ZOOMOUT);\t\tbreak;\n \t\t\t\tcase 0x22f: map_key_clear(KEY_ZOOMRESET);\tbreak;\n+\n+\t\t\t\t/* BTC 8193 ugly hack */\n+\t\t\t\tcase 0x230: map_key(BTN_MOUSE);\t\t\tbreak;\n+\t\t\t\tcase 0x231: map_rel(REL_WHEEL);\t\t\tbreak;\n+\t\t\t\tcase 0x232: map_rel(REL_HWHEEL);\t\tbreak;\n+\n \t\t\t\tcase 0x233: map_key_clear(KEY_SCROLLUP);\tbreak;\n \t\t\t\tcase 0x234: map_key_clear(KEY_SCROLLDOWN);\tbreak;\n \t\t\t\tcase 0x238: map_rel(REL_HWHEEL);\t\tbreak;\n@@ -972,6 +978,18 @@ void hidinput_hid_event(struct hid_device *hid, struct hid_field *field, struct\n \t\treturn;\n \t}\n \n+\t/* BTC 8193 ugly hack */\n+\tif (hid->vendor == 0x0518 && hid->product == 0x0002) {\n+\t\tif (usage->code == REL_HWHEEL) {\n+\t\t\tinput_event(input, usage->type, REL_WHEEL, -value);\n+\t\t\treturn;\n+\t\t}\n+\t\telse if (usage->code == REL_WHEEL) {\n+\t\t\tinput_event(input, usage->type, usage->code, value);\n+\t\t\treturn;\n+\t\t}\n+\t}\n+\n \tif ((hid->quirks & HID_QUIRK_2WHEEL_MOUSE_HACK_ON) && (usage->code == REL_WHEEL)) {\n \t\tinput_event(input, usage->type, REL_HWHEEL, value);\n \t\treturn;\n", "diff --git a/drivers/hid/hid-input.c b/drivers/hid/hid-input.c\nindex 0b27da7..32e3226 100644\n--- a/drivers/hid/hid-input.c\n+++ b/drivers/hid/hid-input.c\n@@ -655,6 +655,12 @@ static void hidinput_configure_usage(struct hid_input *hidinput, struct hid_fiel\n \t\t\t\tcase 0x22d: map_key_clear(KEY_ZOOMIN);\t\tbreak;\n \t\t\t\tcase 0x22e: map_key_clear(KEY_ZOOMOUT);\t\tbreak;\n \t\t\t\tcase 0x22f: map_key_clear(KEY_ZOOMRESET);\tbreak;\n+\n+\t\t\t\t/* BTC 8193 ugly hack */\n+\t\t\t\tcase 0x230: map_key(BTN_MOUSE);\t\t\tbreak;\n+\t\t\t\tcase 0x231: map_rel(REL_WHEEL);\t\t\tbreak;\n+\t\t\t\tcase 0x232: map_rel(REL_HWHEEL);\t\tbreak;\n+\n \t\t\t\tcase 0x233: map_key_clear(KEY_SCROLLUP);\tbreak;\n \t\t\t\tcase 0x234: map_key_clear(KEY_SCROLLDOWN);\tbreak;\n \t\t\t\tcase 0x238: map_rel(REL_HWHEEL);\t\tbreak;\n@@ -972,6 +978,18 @@ void hidinput_hid_event(struct hid_device *hid, struct hid_field *field, struct\n \t\treturn;\n \t}\n \n+\t/* BTC 8193 ugly hack */\n+\tif (hid->vendor == 0x0518 && hid->product == 0x0002) {\n+\t\tif (usage->type == EV_REL && usage->code == REL_HWHEEL) {\n+\t\t\tinput_event(input, usage->type, REL_WHEEL, -value);\n+\t\t\treturn;\n+\t\t}\n+\t\telse if (usage->type == EV_REL && usage->code == REL_WHEEL) {\n+\t\t\tinput_event(input, usage->type, usage->code, value);\n+\t\t\treturn;\n+\t\t}\n+\t}\n+\n \tif ((hid->quirks & HID_QUIRK_2WHEEL_MOUSE_HACK_ON) && (usage->code == REL_WHEEL)) {\n \t\tinput_event(input, usage->type, REL_HWHEEL, value);\n \t\treturn;\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Input Devices", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "drivers_input-devices", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2007-11-15 05:50 UTC by Kir Kolyshkin", "Modified": "2010-02-23 22:42 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "2.6.23", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/hid/hid-input.c"], "methods": ["hidinput_configure_usage", "hidinput_hid_event"]}
{"id": "9374", "title": "[ICH7 snd_hda_intel] Volume control broken", "": "Show dependency tree", "description": "Most recent kernel where this bug did not occur: 2.6.23\nDistribution: Debian\n\nHardware Environment:\nx86_64 Pentium D system; ICH7 chipset\n00:1b.0 Audio device [0403]: Intel Corporation 82801G (ICH7 Family) High Definition Audio Controller [8086:27d8] (rev 01)\n\nSoftware Environment: Debian Unstable, KDE Desktop\n\nProblem Description:\nIf I change the volume using the master control slider in KDE, the sound will first go down to a very low volume (almost muted with slider at 2/3 _up_) and then, in about 10 seconds, come slowly back up to its \"normal\" volume for the position of the slider. The volume does vary while I move the slider, but even at the very top it is very low at first.\nThis only happens with the master slider, the PCM and front sliders behave normally.\n\nThere were some changes from 2.6.23 to 2.6.24. During first boot of .24 I get:\nSetting up ALSA...warning: 'alsactl restore' failed with error message '\nalsactl: set_control:989: warning: name mismatch (Capture Volume/Input Source) for control #2\nalsactl: set_control:991: warning: index mismatch (0/1) for control #2\nalsactl: set_control:993: failed to obtain info for control #2 (Operation not permitted)'\n\nI also suddenly have a lot more controls (some probably bogus):\nOutput: master, PCM, front, surround, center, LFE, digital, mux, mux\nInput:  capture, capture, digital, mux, mux\n\nAlso, the rear output jack responds to the \"front\" output slider, as does the front output jack. Not sure if that is a regression or not; will check.\n\nCan provide any additional info needed.", "patch": ["[ALSA] hda-codec - Check PINCAP only for PIN widgets\n\nThe recent addition of checking PINCAP for EAPD seems to break some\nsystems due to unexpected response from the codec chip.  We shouldn't\nissue GET_PINCAP verb to non-PIN widgets.  Now checks the widget type\nbefore checking EAPD bit.\n\nSigned-off-by: Takashi Iwai <tiwai@suse.de>\n\n---\ncommit 62cb6114ba1e333615b32d124827844e82ff999a\ntree 0e01116568c051e0844b00177127ee12f24bcffb\nparent 73e4b31c14ec7feeecfa1acab1ff72f0bf1ac223\nauthor Takashi Iwai <tiwai@suse.de> Wed, 14 Nov 2007 16:13:33 +0100\ncommitter Takashi Iwai <tiwai@suse.de> Wed, 14 Nov 2007 16:13:33 +0100\n\n sound/pci/hda/hda_codec.c |   33 ++++++++++++++++++++-------------\n 1 files changed, 20 insertions(+), 13 deletions(-)\n\ndiff --git a/sound/pci/hda/hda_codec.c b/sound/pci/hda/hda_codec.c\nindex 8462235..39240e0 100644\n--- a/sound/pci/hda/hda_codec.c\n+++ b/sound/pci/hda/hda_codec.c\n@@ -1626,19 +1626,26 @@ static void hda_set_power_state(struct hda_codec *codec, hda_nid_t fg,\n \n \tnid = codec->start_nid;\n \tfor (i = 0; i < codec->num_nodes; i++, nid++) {\n-\t\tif (get_wcaps(codec, nid) & AC_WCAP_POWER) {\n-\t\t\tunsigned int pincap;\n-\t\t\t/*\n-\t\t\t * don't power down the widget if it controls eapd\n-\t\t\t * and EAPD_BTLENABLE is set.\n-\t\t\t */\n-\t\t\tpincap = snd_hda_param_read(codec, nid, AC_PAR_PIN_CAP);\n-\t\t\tif (pincap & AC_PINCAP_EAPD) {\n-\t\t\t\tint eapd = snd_hda_codec_read(codec, nid,\n-\t\t\t\t\t0, AC_VERB_GET_EAPD_BTLENABLE, 0);\n-\t\t\t\teapd &= 0x02;\n-\t\t\t\tif (power_state == AC_PWRST_D3 && eapd)\n-\t\t\t\t\tcontinue;\n+\t\tunsigned int wcaps = get_wcaps(codec, nid);\n+\t\tif (wcaps & AC_WCAP_POWER) {\n+\t\t\tunsigned int wid_type = (wcaps & AC_WCAP_TYPE) >>\n+\t\t\t\tAC_WCAP_TYPE_SHIFT;\n+\t\t\tif (wid_type == AC_WID_PIN) {\n+\t\t\t\tunsigned int pincap;\n+\t\t\t\t/*\n+\t\t\t\t * don't power down the widget if it controls\n+\t\t\t\t * eapd and EAPD_BTLENABLE is set.\n+\t\t\t\t */\n+\t\t\t\tpincap = snd_hda_param_read(codec, nid,\n+\t\t\t\t\t\t\t    AC_PAR_PIN_CAP);\n+\t\t\t\tif (pincap & AC_PINCAP_EAPD) {\n+\t\t\t\t\tint eapd = snd_hda_codec_read(codec,\n+\t\t\t\t\t\tnid, 0,\n+\t\t\t\t\t\tAC_VERB_GET_EAPD_BTLENABLE, 0);\n+\t\t\t\t\teapd &= 0x02;\n+\t\t\t\t\tif (power_state == AC_PWRST_D3 && eapd)\n+\t\t\t\t\t\tcontinue;\n+\t\t\t\t}\n \t\t\t}\n \t\t\tsnd_hda_codec_write(codec, nid, 0,\n \t\t\t\t\t    AC_VERB_SET_POWER_STATE,\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Sound", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Jaroslav Kysela", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "9243", "Reported": "2007-11-13 16:56 UTC by Frans Pop", "Modified": "2007-12-01 13:24 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "2.6.24-rc2", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["sound/pci/hda/hda_codec.c"], "methods": ["hda_set_power_state"]}
{"id": "9327", "title": "2.6.24-rc2 (esthetic?) regression: auto select interrupt bouncing", "": "Show dependency tree", "description": "Most recent kernel where this bug did not occur: 2.6.24-rc1\nDistribution: Ubuntu Feisty\nHardware Environment: Laptop Toshiba Satellite U305-S5077\nProblem Description:\n\nAfter the ACPI changes between 2.6.24-rc1 and -rc2 I have my logs\n\"spammed\" (every 2-3 seconds) by: \n\n[  423.112903] ACPI: EC: missing IBF_1 confirmations,switch off interrupt mode.\n[  423.113020] ACPI: EC: non-query interrupt received, switching to interrupt mode\n[  426.078972] ACPI: EC: missing IBF_1 confirmations,switch off interrupt mode.\n[  426.079645] ACPI: EC: non-query interrupt received, switching to interrupt mode\n[  426.622773] ACPI: EC: missing IBF_1 confirmations,switch off interrupt mode.\n[  426.622889] ACPI: EC: non-query interrupt received, switching to interrupt mode\n\nIt seems that no harm is done, apart (but it could be another thing)\nthat gnome-panel is much slower on startup.", "patch": ["Add debug printks.\n\nFrom: Alexey Starikovskiy <astarikovskiy@suse.de>\n\n\n---\n\n drivers/acpi/ec.c |   40 +++++++++++++++++++++++++---------------\n 1 files changed, 25 insertions(+), 15 deletions(-)\n\ndiff --git a/drivers/acpi/ec.c b/drivers/acpi/ec.c\nindex 06b78e5..5afb3a2 100644\n--- a/drivers/acpi/ec.c\n+++ b/drivers/acpi/ec.c\n@@ -47,6 +47,9 @@\n #undef PREFIX\n #define PREFIX\t\t\t\t\"ACPI: EC: \"\n \n+/* Uncomment next line to get verbose print outs*/\n+#define DEBUG\n+\n /* EC status register */\n #define ACPI_EC_FLAG_OBF\t0x01\t/* Output buffer full */\n #define ACPI_EC_FLAG_IBF\t0x02\t/* Input buffer full */\n@@ -131,21 +134,27 @@ static struct acpi_ec {\n \n static inline u8 acpi_ec_read_status(struct acpi_ec *ec)\n {\n-\treturn inb(ec->command_addr);\n+\tu8 x = inb(ec->command_addr);\n+\tpr_debug(PREFIX \"---> status = 0x%2x\\n\", x);\n+\treturn x;\n }\n \n static inline u8 acpi_ec_read_data(struct acpi_ec *ec)\n {\n+\tu8 x = inb(ec->data_addr);\n+\tpr_debug(PREFIX \"---> data = 0x%2x\\n\", x);\n \treturn inb(ec->data_addr);\n }\n \n static inline void acpi_ec_write_cmd(struct acpi_ec *ec, u8 command)\n {\n+\tpr_debug(PREFIX \"<--- command = 0x%2x\\n\", command);\n \toutb(command, ec->command_addr);\n }\n \n static inline void acpi_ec_write_data(struct acpi_ec *ec, u8 data)\n {\n+\tpr_debug(PREFIX \"<--- data = 0x%2x\\n\", data);\n \toutb(data, ec->data_addr);\n }\n \n@@ -175,12 +184,12 @@ static int acpi_ec_wait(struct acpi_ec *ec, enum ec_event event, int force_poll)\n \t\tif (acpi_ec_check_status(ec, event)) {\n \t\t\tif (event == ACPI_EC_EVENT_OBF_1) {\n \t\t\t\t/* miss OBF = 1 GPE, don't expect it anymore */\n-\t\t\t\tprintk(KERN_INFO PREFIX \"missing OBF_1 confirmation,\"\n+\t\t\t\tpr_info(PREFIX \"missing OBF_1 confirmation,\"\n \t\t\t\t\t\"switching to degraded mode.\\n\");\n \t\t\t\tset_bit(EC_FLAGS_ONLY_IBF_GPE, &ec->flags);\n \t\t\t} else {\n \t\t\t\t/* missing GPEs, switch back to poll mode */\n-\t\t\t\tprintk(KERN_INFO PREFIX \"missing IBF_1 confirmations,\"\n+\t\t\t\tpr_info(PREFIX \"missing IBF_1 confirmations,\"\n \t\t\t\t\t\"switch off interrupt mode.\\n\");\n \t\t\t\tclear_bit(EC_FLAGS_GPE_MODE, &ec->flags);\n \t\t\t}\n@@ -194,7 +203,7 @@ static int acpi_ec_wait(struct acpi_ec *ec, enum ec_event event, int force_poll)\n \t\t\t\treturn 0;\n \t\t}\n \t}\n-\tprintk(KERN_ERR PREFIX \"acpi_ec_wait timeout,\"\n+\tpr_err(PREFIX \"acpi_ec_wait timeout,\"\n \t\t\t       \" status = %d, expect_event = %d\\n\",\n \t\t\t       acpi_ec_read_status(ec), event);\n \treturn -ETIME;\n@@ -208,11 +217,11 @@ static int acpi_ec_transaction_unlocked(struct acpi_ec *ec, u8 command,\n \tint result = 0;\n \tset_bit(EC_FLAGS_WAIT_GPE, &ec->flags);\n \tacpi_ec_write_cmd(ec, command);\n-\n+\tpr_debug(PREFIX \"transaction start\\n\");\n \tfor (; wdata_len > 0; --wdata_len) {\n \t\tresult = acpi_ec_wait(ec, ACPI_EC_EVENT_IBF_0, force_poll);\n \t\tif (result) {\n-\t\t\tprintk(KERN_ERR PREFIX\n+\t\t\tpr_err(PREFIX\n \t\t\t       \"write_cmd timeout, command = %d\\n\", command);\n \t\t\tgoto end;\n \t\t}\n@@ -223,7 +232,7 @@ static int acpi_ec_transaction_unlocked(struct acpi_ec *ec, u8 command,\n \tif (!rdata_len) {\n \t\tresult = acpi_ec_wait(ec, ACPI_EC_EVENT_IBF_0, force_poll);\n \t\tif (result) {\n-\t\t\tprintk(KERN_ERR PREFIX\n+\t\t\tpr_err(PREFIX\n \t\t\t       \"finish-write timeout, command = %d\\n\", command);\n \t\t\tgoto end;\n \t\t}\n@@ -235,7 +244,7 @@ static int acpi_ec_transaction_unlocked(struct acpi_ec *ec, u8 command,\n \t\t\tforce_poll = 1;\n \t\tresult = acpi_ec_wait(ec, ACPI_EC_EVENT_OBF_1, force_poll);\n \t\tif (result) {\n-\t\t\tprintk(KERN_ERR PREFIX \"read timeout, command = %d\\n\",\n+\t\t\tpr_err(PREFIX \"read timeout, command = %d\\n\",\n \t\t\t       command);\n \t\t\tgoto end;\n \t\t}\n@@ -245,6 +254,7 @@ static int acpi_ec_transaction_unlocked(struct acpi_ec *ec, u8 command,\n \t\t*(rdata++) = acpi_ec_read_data(ec);\n \t}\n       end:\n+\tpr_debug(PREFIX \"transaction end\\n\");\n \treturn result;\n }\n \n@@ -273,7 +283,7 @@ static int acpi_ec_transaction(struct acpi_ec *ec, u8 command,\n \n \tstatus = acpi_ec_wait(ec, ACPI_EC_EVENT_IBF_0, 0);\n \tif (status) {\n-\t\tprintk(KERN_ERR PREFIX\n+\t\tpr_err(PREFIX\n \t\t       \"input buffer is not empty, aborting transaction\\n\");\n \t\tgoto end;\n \t}\n@@ -498,7 +508,7 @@ static u32 acpi_ec_gpe_handler(void *data)\n \t\t\t\tacpi_ec_gpe_query, ec);\n \t} else if (unlikely(!test_bit(EC_FLAGS_GPE_MODE, &ec->flags))) {\n \t\t/* this is non-query, must be confirmation */\n-\t\tprintk(KERN_INFO PREFIX \"non-query interrupt received,\"\n+\t\tpr_info(PREFIX \"non-query interrupt received,\"\n \t\t\t\" switching to interrupt mode\\n\");\n \t\tset_bit(EC_FLAGS_GPE_MODE, &ec->flags);\n \t}\n@@ -701,10 +711,10 @@ static void ec_remove_handlers(struct acpi_ec *ec)\n {\n \tif (ACPI_FAILURE(acpi_remove_address_space_handler(ec->handle,\n \t\t\t\tACPI_ADR_SPACE_EC, &acpi_ec_space_handler)))\n-\t\tprintk(KERN_ERR PREFIX \"failed to remove space handler\\n\");\n+\t\tpr_err(PREFIX \"failed to remove space handler\\n\");\n \tif (ACPI_FAILURE(acpi_remove_gpe_handler(NULL, ec->gpe,\n \t\t\t\t&acpi_ec_gpe_handler)))\n-\t\tprintk(KERN_ERR PREFIX \"failed to remove gpe handler\\n\");\n+\t\tpr_err(PREFIX \"failed to remove gpe handler\\n\");\n \tec->handlers_installed = 0;\n }\n \n@@ -747,9 +757,9 @@ static int acpi_ec_add(struct acpi_device *device)\n \t\tfirst_ec = ec;\n \tacpi_driver_data(device) = ec;\n \tacpi_ec_add_fs(device);\n-\tprintk(KERN_INFO PREFIX \"GPE = 0x%lx, I/O: command/status = 0x%lx, data = 0x%lx\\n\",\n+\tpr_info(PREFIX \"GPE = 0x%lx, I/O: command/status = 0x%lx, data = 0x%lx\\n\",\n \t\t\t  ec->gpe, ec->command_addr, ec->data_addr);\n-\tprintk(KERN_INFO PREFIX \"driver started in %s mode\\n\",\n+\tpr_info(PREFIX \"driver started in %s mode\\n\",\n \t\t(test_bit(EC_FLAGS_GPE_MODE, &ec->flags))?\"interrupt\":\"poll\");\n \treturn 0;\n }\n@@ -875,7 +885,7 @@ int __init acpi_ec_ecdt_probe(void)\n \tstatus = acpi_get_table(ACPI_SIG_ECDT, 1,\n \t\t\t\t(struct acpi_table_header **)&ecdt_ptr);\n \tif (ACPI_SUCCESS(status)) {\n-\t\tprintk(KERN_INFO PREFIX \"EC description table is found, configuring boot EC\\n\");\n+\t\tpr_info(PREFIX \"EC description table is found, configuring boot EC\\n\");\n \t\tboot_ec->command_addr = ecdt_ptr->control.address;\n \t\tboot_ec->data_addr = ecdt_ptr->data.address;\n \t\tboot_ec->gpe = ecdt_ptr->gpe;\n", "ACPI: EC: Workaround for optimized controllers\n\nFrom: Alexey Starikovskiy <astarikovskiy@suse.de>\n\nSome controllers fail to send confirmation GPE after address write.\nDetect this and don't expect such confirmation in future.\nThis is a generalization of previous workaround \n(66c5f4e7367b0085652931b2f3366de29e7ff5ec), which did only read address.\n\nReference: http://bugzilla.kernel.org/show_bug.cgi?id=9327\n\nSigned-off-by: Alexey Starikovskiy <astarikovskiy@suse.de>\nTested-by: Romano Giannetti <romano.giannetti@gmail.com>\n---\n\n drivers/acpi/ec.c |   46 +++++++++++++++++++++++++++++++++-------------\n 1 files changed, 33 insertions(+), 13 deletions(-)\n\ndiff --git a/drivers/acpi/ec.c b/drivers/acpi/ec.c\nindex 5afb3a2..e25d649 100644\n--- a/drivers/acpi/ec.c\n+++ b/drivers/acpi/ec.c\n@@ -78,7 +78,10 @@ enum {\n \tEC_FLAGS_WAIT_GPE = 0,\t\t/* Don't check status until GPE arrives */\n \tEC_FLAGS_QUERY_PENDING,\t\t/* Query is pending */\n \tEC_FLAGS_GPE_MODE,\t\t/* Expect GPE to be sent for status change */\n-\tEC_FLAGS_ONLY_IBF_GPE,\t\t/* Expect GPE only for IBF = 0 event */\n+\tEC_FLAGS_NO_ADDRESS_GPE,\t/* Expect GPE only for non-address event */\n+\tEC_FLAGS_ADDRESS,\t\t/* Address is being written */\n+\tEC_FLAGS_NO_WDATA_GPE,\t\t/* Don't expect WDATA GPE event */\n+\tEC_FLAGS_WDATA,\t\t\t/* Data is being written */\n };\n \n static int acpi_ec_remove(struct acpi_device *device, int type);\n@@ -175,38 +178,53 @@ static inline int acpi_ec_check_status(struct acpi_ec *ec, enum ec_event event)\n \n static int acpi_ec_wait(struct acpi_ec *ec, enum ec_event event, int force_poll)\n {\n+\tint ret = 0;\n+\tif (unlikely(test_bit(EC_FLAGS_ADDRESS, &ec->flags) &&\n+\t\t     test_bit(EC_FLAGS_NO_ADDRESS_GPE, &ec->flags)))\n+\t\tforce_poll = 1;\n+\tif (unlikely(test_bit(EC_FLAGS_WDATA, &ec->flags) &&\n+\t\t     test_bit(EC_FLAGS_NO_WDATA_GPE, &ec->flags)))\n+\t\tforce_poll = 1;\n \tif (likely(test_bit(EC_FLAGS_GPE_MODE, &ec->flags)) &&\n \t    likely(!force_poll)) {\n \t\tif (wait_event_timeout(ec->wait, acpi_ec_check_status(ec, event),\n \t\t\t\t       msecs_to_jiffies(ACPI_EC_DELAY)))\n-\t\t\treturn 0;\n+\t\t\tgoto end;\n \t\tclear_bit(EC_FLAGS_WAIT_GPE, &ec->flags);\n \t\tif (acpi_ec_check_status(ec, event)) {\n-\t\t\tif (event == ACPI_EC_EVENT_OBF_1) {\n-\t\t\t\t/* miss OBF = 1 GPE, don't expect it anymore */\n-\t\t\t\tpr_info(PREFIX \"missing OBF_1 confirmation,\"\n-\t\t\t\t\t\"switching to degraded mode.\\n\");\n-\t\t\t\tset_bit(EC_FLAGS_ONLY_IBF_GPE, &ec->flags);\n+\t\t\tif (test_bit(EC_FLAGS_ADDRESS, &ec->flags)) {\n+\t\t\t\t/* miss address GPE, don't expect it anymore */\n+\t\t\t\tpr_info(PREFIX \"missing address confirmation, \"\n+\t\t\t\t\t\"don't expect it any longer.\\n\");\n+\t\t\t\tset_bit(EC_FLAGS_NO_ADDRESS_GPE, &ec->flags);\n+\t\t\t} else if (test_bit(EC_FLAGS_WDATA, &ec->flags)) {\n+\t\t\t\t/* miss write data GPE, don't expect it */\n+\t\t\t\tpr_info(PREFIX \"missing write data confirmation, \"\n+\t\t\t\t\t\"don't expect it any longer.\\n\");\n+\t\t\t\tset_bit(EC_FLAGS_NO_WDATA_GPE, &ec->flags);\n \t\t\t} else {\n \t\t\t\t/* missing GPEs, switch back to poll mode */\n-\t\t\t\tpr_info(PREFIX \"missing IBF_1 confirmations,\"\n+\t\t\t\tpr_info(PREFIX \"missing confirmations, \"\n \t\t\t\t\t\"switch off interrupt mode.\\n\");\n \t\t\t\tclear_bit(EC_FLAGS_GPE_MODE, &ec->flags);\n \t\t\t}\n-\t\t\treturn 0;\n+\t\t\tgoto end;\n \t\t}\n \t} else {\n \t\tunsigned long delay = jiffies + msecs_to_jiffies(ACPI_EC_DELAY);\n \t\tclear_bit(EC_FLAGS_WAIT_GPE, &ec->flags);\n \t\twhile (time_before(jiffies, delay)) {\n \t\t\tif (acpi_ec_check_status(ec, event))\n-\t\t\t\treturn 0;\n+\t\t\t\tgoto end;\n \t\t}\n \t}\n \tpr_err(PREFIX \"acpi_ec_wait timeout,\"\n \t\t\t       \" status = %d, expect_event = %d\\n\",\n \t\t\t       acpi_ec_read_status(ec), event);\n-\treturn -ETIME;\n+\tret = -ETIME;\n+      end:\n+\tclear_bit(EC_FLAGS_ADDRESS, &ec->flags);\n+\treturn ret;\n }\n \n static int acpi_ec_transaction_unlocked(struct acpi_ec *ec, u8 command,\n@@ -225,11 +243,15 @@ static int acpi_ec_transaction_unlocked(struct acpi_ec *ec, u8 command,\n \t\t\t       \"write_cmd timeout, command = %d\\n\", command);\n \t\t\tgoto end;\n \t\t}\n+\t\t/* mark the address byte written to EC */\n+\t\tif (rdata_len + wdata_len > 1)\n+\t\t\tset_bit(EC_FLAGS_ADDRESS, &ec->flags);\n \t\tset_bit(EC_FLAGS_WAIT_GPE, &ec->flags);\n \t\tacpi_ec_write_data(ec, *(wdata++));\n \t}\n \n \tif (!rdata_len) {\n+\t\tset_bit(EC_FLAGS_WDATA, &ec->flags);\n \t\tresult = acpi_ec_wait(ec, ACPI_EC_EVENT_IBF_0, force_poll);\n \t\tif (result) {\n \t\t\tpr_err(PREFIX\n@@ -240,8 +262,6 @@ static int acpi_ec_transaction_unlocked(struct acpi_ec *ec, u8 command,\n \t\tclear_bit(EC_FLAGS_QUERY_PENDING, &ec->flags);\n \n \tfor (; rdata_len > 0; --rdata_len) {\n-\t\tif (test_bit(EC_FLAGS_ONLY_IBF_GPE, &ec->flags))\n-\t\t\tforce_poll = 1;\n \t\tresult = acpi_ec_wait(ec, ACPI_EC_EVENT_OBF_1, force_poll);\n \t\tif (result) {\n \t\t\tpr_err(PREFIX \"read timeout, command = %d\\n\",\n"], "Status": "CLOSED CODE_FIX", "Alias": "ECINTBOUNCING", "Product": "ACPI", "Classification": "Unclassified", "Component": "EC", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Alexey Starikovskiy", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "9243", "Reported": "2007-11-08 04:30 UTC by Romano Giannetti", "Modified": "2008-10-17 21:27 UTC", "CC List": "4 users", "See Also": "", "Kernel Version": "2.6.24-rc2", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/acpi/ec.c"], "methods": ["acpi_ec_read_status", "acpi_ec_read_data", "acpi_ec_write_cmd", "acpi_ec_write_data", "acpi_ec_wait", "acpi_ec_transaction_unlocked", "acpi_ec_transaction", "acpi_ec_gpe_handler", "ec_remove_handlers", "acpi_ec_add", "acpi_ec_ecdt_probe"]}
{"id": "9272", "title": "kernel BUG at drivers/md/raid5.c:143", "": "Show dependency tree", "description": "Most recent kernel where this bug did not occur:\n2.6.23.1\n\nDistribution: Debian Etch 4.0\n\nHardware Environment:\nIntel P-III-800 EB (x86_32)\n512 MB RAM\nAIC7xxx SCSI Controller for RAID-1 RootFS\nsata_sil Controller (3114) with 4x 300GB SATA Disks as RAID-5\n\nSoftware Environment:\nmdadm version 2.5.6\n\nProblem Description:\nshortly after the raid5 array is initialized the kernel stops with\nkernel BUG at drivers/md/raid5.c:143!\ninvalid opcode: 0000 [#1]\nModules linked in: xfs tcp_cubic raid456 async_xor async_memcpy async_tx xor deadline_iosched w83781d hwmon_vid hwmon eeprom netconsole configfs e1000 3c59x mii sata_sil button ata_piix uhci_hcd parport_pc i2c_i801 8250_pnp 8250 serial_core parport evdev usbcore libata i2c_core rng_core intel_agp agpgart pcspkr rtc sg st sr_mod cdrom ch dm_mirror dm_snapshot thermal processor fan unix ext3 jbd mbcache raid1 md_mod sd_mod dm_mod aic7xxx scsi_transport_spi scsi_mod\n\nPid: 1666, comm: md2_raid5 Not tainted (2.6.24-rc1-git10 #1)\nEIP: 0060:[<e0b019e9>] EFLAGS: 00010002 CPU: 0\nEIP is at __release_stripe+0x9f/0x121 [raid456]\nEAX: 00000000 EBX: c1a0d208 ECX: c1a0d210 EDX: c1a0d208\nESI: c1b4bb00 EDI: c28f6fcc EBP: 00000000 ESP: c28f6f48\n DS: 007b ES: 007b FS: 0000 GS: 0000 SS: 0068\nProcess md2_raid5 (pid: 1666, ti=c28f6000 task=c1952530 task.ti=c28f6000)\nStack: 7fffffff 00000282 7fffffff e0b01a79 c1a0d208 e0b06390 7fffffff 7fffffff\n       c28f6fcc 00000000 c0235242 c1afbc00 c1b4bb00 00000003 00000001 c02fa6a0\n       00000d94 c02fa730 00000000 c02fa640 c1952530 00000008 00000000 c1a0f1e0\nCall Trace:\n [<e0b01a79>] release_stripe+0xe/0x12 [raid456]\n [<e0b06390>] raid5d+0x33c/0x341 [raid456]\n [<c0235242>] schedule_timeout+0x13/0x8b\n [<e08bc69d>] md_thread+0xb5/0xcb [md_mod]\n [<c0124a81>] autoremove_wake_function+0x0/0x35\n [<e08bc5e8>] md_thread+0x0/0xcb [md_mod]\n [<c012491d>] kthread+0x36/0x5d\n [<c01248e7>] kthread+0x0/0x5d\n [<c01046b7>] kernel_thread_helper+0x7/0x10\n =======================\nCode: e8 30 dc 68 df e9 8e 00 00 00 0f ba 73 20 08 8d 46 38 8b 48 04 8d 53 08 89 50 04 89 43 08 89 4a 04 89 11 eb 73 83 7a 30 00 74 04 <0f> 0b eb fe 0f ba 72 20 05 19 c0 85 c0 74 17 ff 4e 58 83 7e 58\nEIP: [<e0b019e9>] __release_stripe+0x9f/0x121 [raid456] SS:ESP 0068:c28f6f48\n\nSteps to reproduce:\n* Build current -rc Kernel\n* reboot\n* assemble an raid5 array\n* mount the volume from that array\n* try to read/write data\nIt will crash here a second or two after mounting, but during my tests I've seen it sometimes advances past that point and dies when data is written.", "patch": ["Signed-off-by: Neil Brown <neilb@suse.de>\n\n### Diffstat output\n ./drivers/md/raid5.c |   14 +++++++-------\n 1 file changed, 7 insertions(+), 7 deletions(-)\n\ndiff .prev/drivers/md/raid5.c ./drivers/md/raid5.c\n--- .prev/drivers/md/raid5.c\t2007-11-02 12:10:49.000000000 +1100\n+++ ./drivers/md/raid5.c\t2007-11-02 12:25:31.000000000 +1100\n@@ -2607,40 +2607,47 @@ static void handle_stripe5(struct stripe\n \tstruct bio *return_bi = NULL;\n \tstruct stripe_head_state s;\n \tstruct r5dev *dev;\n \tunsigned long pending = 0;\n \n \tmemset(&s, 0, sizeof(s));\n \tpr_debug(\"handling stripe %llu, state=%#lx cnt=%d, pd_idx=%d \"\n \t\t\"ops=%lx:%lx:%lx\\n\", (unsigned long long)sh->sector, sh->state,\n \t\tatomic_read(&sh->count), sh->pd_idx,\n \t\tsh->ops.pending, sh->ops.ack, sh->ops.complete);\n \n \tspin_lock(&sh->lock);\n \tclear_bit(STRIPE_HANDLE, &sh->state);\n \tclear_bit(STRIPE_DELAYED, &sh->state);\n \n \ts.syncing = test_bit(STRIPE_SYNCING, &sh->state);\n \ts.expanding = test_bit(STRIPE_EXPAND_SOURCE, &sh->state);\n \ts.expanded = test_bit(STRIPE_EXPAND_READY, &sh->state);\n \t/* Now to look around and see what can be done */\n \n+\t/* clean-up completed biofill operations */\n+\tif (test_bit(STRIPE_OP_BIOFILL, &sh->ops.complete)) {\n+\t\tclear_bit(STRIPE_OP_BIOFILL, &sh->ops.pending);\n+\t\tclear_bit(STRIPE_OP_BIOFILL, &sh->ops.ack);\n+\t\tclear_bit(STRIPE_OP_BIOFILL, &sh->ops.complete);\n+\t}\n+\n \trcu_read_lock();\n \tfor (i=disks; i--; ) {\n \t\tmdk_rdev_t *rdev;\n \t\tstruct r5dev *dev = &sh->dev[i];\n \t\tclear_bit(R5_Insync, &dev->flags);\n \n \t\tpr_debug(\"check %d: state 0x%lx toread %p read %p write %p \"\n \t\t\t\"written %p\\n\",\ti, dev->flags, dev->toread, dev->read,\n \t\t\tdev->towrite, dev->written);\n \n \t\t/* maybe we can request a biofill operation\n \t\t *\n \t\t * new wantfill requests are only permitted while\n \t\t * STRIPE_OP_BIOFILL is clear\n \t\t */\n \t\tif (test_bit(R5_UPTODATE, &dev->flags) && dev->toread &&\n \t\t\t!test_bit(STRIPE_OP_BIOFILL, &sh->ops.pending))\n \t\t\tset_bit(R5_Wantfill, &dev->flags);\n \n \t\t/* now count some things */\n@@ -2880,47 +2887,40 @@ static void handle_stripe6(struct stripe\n \tstruct stripe_head_state s;\n \tstruct r6_state r6s;\n \tstruct r5dev *dev, *pdev, *qdev;\n \n \tr6s.qd_idx = raid6_next_disk(pd_idx, disks);\n \tpr_debug(\"handling stripe %llu, state=%#lx cnt=%d, \"\n \t\t\"pd_idx=%d, qd_idx=%d\\n\",\n \t       (unsigned long long)sh->sector, sh->state,\n \t       atomic_read(&sh->count), pd_idx, r6s.qd_idx);\n \tmemset(&s, 0, sizeof(s));\n \n \tspin_lock(&sh->lock);\n \tclear_bit(STRIPE_HANDLE, &sh->state);\n \tclear_bit(STRIPE_DELAYED, &sh->state);\n \n \ts.syncing = test_bit(STRIPE_SYNCING, &sh->state);\n \ts.expanding = test_bit(STRIPE_EXPAND_SOURCE, &sh->state);\n \ts.expanded = test_bit(STRIPE_EXPAND_READY, &sh->state);\n \t/* Now to look around and see what can be done */\n \n-\t/* clean-up completed biofill operations */\n-\tif (test_bit(STRIPE_OP_BIOFILL, &sh->ops.complete)) {\n-\t\tclear_bit(STRIPE_OP_BIOFILL, &sh->ops.pending);\n-\t\tclear_bit(STRIPE_OP_BIOFILL, &sh->ops.ack);\n-\t\tclear_bit(STRIPE_OP_BIOFILL, &sh->ops.complete);\n-\t}\n-\n \trcu_read_lock();\n \tfor (i=disks; i--; ) {\n \t\tmdk_rdev_t *rdev;\n \t\tdev = &sh->dev[i];\n \t\tclear_bit(R5_Insync, &dev->flags);\n \n \t\tpr_debug(\"check %d: state 0x%lx read %p write %p written %p\\n\",\n \t\t\ti, dev->flags, dev->toread, dev->towrite, dev->written);\n \t\t/* maybe we can reply to a read */\n \t\tif (test_bit(R5_UPTODATE, &dev->flags) && dev->toread) {\n \t\t\tstruct bio *rbi, *rbi2;\n \t\t\tpr_debug(\"Return read for disc %d\\n\", i);\n \t\t\tspin_lock_irq(&conf->device_lock);\n \t\t\trbi = dev->toread;\n \t\t\tdev->toread = NULL;\n \t\t\tif (test_and_clear_bit(R5_Overlap, &dev->flags))\n \t\t\t\twake_up(&conf->wait_for_overlap);\n \t\t\tspin_unlock_irq(&conf->device_lock);\n \t\t\twhile (rbi && rbi->bi_sector < dev->sector + STRIPE_SECTORS) {\n \t\t\t\tcopy_data(0, rbi, dev->page, dev->sector);\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "IO/Storage", "Classification": "Unclassified", "Component": "MD", "Hardware": "All Linux", "Importance": "P1 blocking", "Assignee": "Neil Brown", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "9243", "Reported": "2007-11-01 05:03 UTC by Puzin, Dimitri", "Modified": "2007-11-07 16:15 UTC", "CC List": "0 users", "See Also": "", "Kernel Version": "2.6.24-rc1", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/md/raid5.c"], "methods": ["handle_stripe5", "handle_stripe6"]}
{"id": "9206", "title": "Negative internal write-intent bitmap offset with metadata 1.0 REDUX in raid 6: kernel refuses to start the array", "description": "Most recent kernel where this bug did not occur: 2.6.22\nDistribution: gentoo (vanilla k.o kernel)\nHardware Environment: pentium4\nSoftware Environment: gentoo stable\nProblem Description: \nI believe is directly related to \"[PATCH 007 of 7] md: Change bitmap_unplug and others to void functions.\"\n\nI have confirmed that this problem occurs during initial creation of the MD device with mdadm 2.6.4.\n\nThe specific error I am getting is \nmd3: bitmap initialized from disk: read 28/28 pages, set 0 bits\ncreated bitmap (442 pages) for device md3\nmd3: disabling internal bitmap due to errors\nmd3: failed to create bitmap (-5)\nmd: pers->run() failed ...\n\nsuperblock information from mdstat\nmdadm -E /dev/sx8/0p5\n/dev/sx8/0p5:\n          Magic : a92b4efc\n        Version : 01\n    Feature Map : 0x1\n     Array UUID : b772776b:e2810279:bf64284e:65700530\n           Name : data2\n  Creation Time : Wed Jul 18 11:21:56 2007\n     Raid Level : raid6\n   Raid Devices : 12\n\n  Used Dev Size : 462671664 (220.62 GiB 236.89 GB)\n     Array Size : 4626716160 (2206.19 GiB 2368.88 GB)\n      Used Size : 462671616 (220.62 GiB 236.89 GB)\n   Super Offset : 462671920 sectors\n          State : clean\n    Device UUID : 94d99dda:bad0be35:e7277499:669fbc48\n\nInternal Bitmap : -222 sectors from superblock\n    Update Time : Sat Sep 15 01:09:44 2007\n       Checksum : 403e2ba6 - correct\n         Events : 8\n\n     Chunk Size : 64K\n\n    Array Slot : 0 (0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11)\n   Array State : Uuuuuuuuuuuu\n\n\nSteps to reproduce:\nevery partition used is 462672000 sectors, 28800 cyls on a 500GB drive, and is a LOGICAL volume not a primary volume\nmdadm -C -e 1.0 -l 6 -b internal /dev/md3 -vv -n 12", "patch": ["Status: ok\n\nFix an unsigned compare to allow creation of bitmaps with v1.0 metadata.\n\nAs page->index is unsigned, this all becomes an unsigned comparison, which\n almost always returns an error.\n\nSigned-off-by: Neil Brown <neilb@suse.de>\n\n### Diffstat output\n ./drivers/md/bitmap.c |    2 +-\n 1 file changed, 1 insertion(+), 1 deletion(-)\n\ndiff .prev/drivers/md/bitmap.c ./drivers/md/bitmap.c\n--- .prev/drivers/md/bitmap.c\t2007-10-22 16:47:52.000000000 +1000\n+++ ./drivers/md/bitmap.c\t2007-10-22 16:50:10.000000000 +1000\n@@ -274,7 +274,7 @@ static int write_sb_page(struct bitmap *\n \t\t\tif (bitmap->offset < 0) {\n \t\t\t\t/* DATA  BITMAP METADATA  */\n \t\t\t\tif (bitmap->offset\n-\t\t\t\t    + page->index * (PAGE_SIZE/512)\n+\t\t\t\t    + (long)(page->index * (PAGE_SIZE/512))\n \t\t\t\t    + size/512 > 0)\n \t\t\t\t\t/* bitmap runs in to metadata */\n \t\t\t\t\treturn -EINVAL;\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "IO/Storage", "Classification": "Unclassified", "Component": "MD", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Neil Brown", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2007-10-21 21:49 UTC by Joshua Charles Campbell", "Modified": "2007-10-22 22:34 UTC", "CC List": "1 user", "See Also": "", "Kernel Version": "2.6.23", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/md/bitmap.c"], "methods": ["write_sb_page"]}
{"id": "9133", "title": "aacraid driver fails with Dell PowerEdge Expandable RAID Controller 3/Di", "description": "Most recent kernel where this bug did not occur: 2.6.20.4 (see description)\nDistribution: PLD Linux Distribution 2.0 (Ac)\n\nHardware Environment:\nDell PowerEdge 1650 with Dell PowerEdge Expandable RAID Controller 3/Di (rev 01), 2 disks, mirror, PCI ID 1028:000a\n\nProblem Description:\n\nSystem does not boot at all using aacraid SCSI driver with Dell PERC 3/Di controller. Machine is currently running kernel 2.6.20.4 and it works perfectly. Few days ago I was trying upgrade to 2.6.22.9 and system failed to boot.\n\nDriver correctly detects controller and then following messages are displayed on console:\n\nscsi 0:0:0:0 Direct-Access DELL mirror V1.0 PQ: 0 ANSI: 2\nAAC:AAC received an unrecognized command [601]\naacraid: Host adapter abort request (0,1,0,0)\naacraid: Host adapter abort request (0,1,0,0)\naacraid: Host adapter reset request. SCSI hang ?\nscsi 0:1:0:0 scsi: Device offlined - not ready after error recovery\n\n... and so on for every scsi id and scsi host (0:1:1:0, 0:1:2:0, ... , 0:2:15:0). Then system fails with kernel panic: unable to mount root filesystem which is obvious.\n\nI wasn't trying to build 2.6.20.x kernel series newer than .4. I've tried 2.6.21.4 and 2.6.22.5 and they failed same way 2.6.22.9 did.\n\nSteps to reproduce: try to boot with root fs on machine with Dell PERC 3/Di.", "patch": ["diff -ru a/drivers/scsi/aacraid/aachba.c b/drivers/scsi/aacraid/aachba.c\n--- a/drivers/scsi/aacraid/aachba.c\t2007-10-10 12:19:01.535349381 -0400\n+++ b/drivers/scsi/aacraid/aachba.c\t2007-10-10 12:19:57.353314177 -0400\n@@ -1190,6 +1190,15 @@\n \t\t\t\t  (fib_callback) aac_srb_callback, (void *) cmd);\n }\n \n+static int aac_scsi_32_64(struct fib * fib, struct scsi_cmnd * cmd)\n+{\n+\tif ((sizeof(dma_addr_t) > 4) &&\n+\t (num_physpages > (0xFFFFFFFFULL >> PAGE_SHIFT)) &&\n+\t (fib->dev->adapter_info.options & AAC_OPT_SGMAP_HOST64))\n+\t\treturn FAILED;\n+\treturn aac_scsi_32(fib, cmd);\n+}\n+\n int aac_get_adapter_info(struct aac_dev* dev)\n {\n \tstruct fib* fibptr;\n@@ -1376,7 +1385,9 @@\n \t * interface.\n \t */\n \tdev->a_ops.adapter_scsi = (dev->dac_support)\n-\t\t\t\t? aac_scsi_64\n+\t  ? ((aac_get_driver_ident(dev->cardtype)->quirks & AAC_QUIRK_31BIT)\n+\t\t\t\t? aac_scsi_32_64\n+\t\t\t\t: aac_scsi_64)\n \t\t\t\t: aac_scsi_32;\n \tif (dev->raw_io_interface) {\n \t\tdev->a_ops.adapter_bounds = (dev->raw_io_64)\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "SCSI Drivers", "Classification": "Unclassified", "Component": "AACRAID", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "scsi_drivers-aacraid", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2007-10-08 10:14 UTC by Marcin Krol", "Modified": "2009-03-24 09:19 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "2.6.22", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/scsi/aacraid/aachba.c"], "methods": ["aac_get_adapter_info"]}
{"id": "8995", "title": "/proc/acpi/alarm worked; update to 2.6.22.2 and /sys/class/rtc/rtc0/wakealarm don't", "": "Show dependency tree", "description": "Most recent kernel where this bug did not occur:2.6.20\nDistribution: FC6\nHardware Environment: ASUS A8N-SLI mobo, Athlon 64 3200+, PATA Disk\nSoftware Environment: FC6, MythTV 0.20.2-164\nProblem Description:\nChange in kernel code from support for /proc/acpi/alarm to /sys/class/rtc/rtc0/wakealarm and supporting code borked working system.  Will no longer wake at set time.\nTime set <> time reported by cat /sys.../wakealarm.  Return value off by large constant.  Note: Mobo doesn't support month, day, or year in alarm setting.\n\nSteps to reproduce:\nBefore upgrade from 2.6.20 to 2.6.22.2, suspend-to-disk with powerdown to standby would wake at time echoed into /proc/acpi/alarm.  Change of wakeup time setting code to echo 0 to /sys/class/rtc/rtc0/wakealarm followed by echo of seconds since epoch of desired wakeup time under 2.6.22.2 does not work.  System will not wake up at specified time.  Will wake by keyboard keystroke, such as Ctrl+Esc.  Tried enabling APM (BIOS) alarm setting and all entries under /proc/acpi/wakeup (all on at once), but no improvement.\nTest sequence:\n# echo 0 > /sys/class/rtc/rtc0/wakealarm\n# t=`date +%s`; w=`expr $t + 60`; echo $w > /sys/class/rtc/rtc0/wakealarm\n# echo $w\n1189268800\n# cat /sys/class/rtc/rtc0/wakealarm\n2076101696\n# expr 2076101696 - 1189268800\n886832896\n<invoke your favorite code to suspend to disk and power down system leaving standby power on>\n<wait>\n<wait some more>\n<hit power on button>", "patch": ["---\n kernel/power/disk.c |    9 ++++++---\n 1 file changed, 6 insertions(+), 3 deletions(-)\n\nIndex: linux-2.6/kernel/power/disk.c\n===================================================================\n--- linux-2.6.orig/kernel/power/disk.c\n+++ linux-2.6/kernel/power/disk.c\n@@ -378,9 +378,12 @@ int hibernation_platform_enter(void)\n \t\treturn error;\n \n \tsuspend_console();\n-\terror = device_suspend(PMSG_SUSPEND);\n-\tif (error)\n-\t\tgoto Resume_console;\n+\t/*\n+\t * FIXME: device_suspend(PMSG_SUSPEND) should be called here, but\n+\t * some EHCI controllers make boxes reboot instead of going into the\n+\t * S4 sleep state in that case.\n+\t */\n+\tdevice_shutdown();\n \n \terror = hibernation_ops->prepare();\n \tif (error)\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Power Management", "Classification": "Unclassified", "Component": "Hibernation/Suspend", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Rafael J. Wysocki", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "7216", "Reported": "2007-09-08 09:29 UTC by Craig Huff", "Modified": "2008-01-24 15:48 UTC", "CC List": "3 users", "See Also": "", "Kernel Version": "2.6.22", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["kernel/power/disk.c"], "methods": ["hibernation_platform_enter"]}
{"id": "8848", "title": "(pata HPT370) UDMA100 mode isn't available since LibATA has been incorporated to the kernel", "description": "Most recent kernel where this bug did not occur: 2.6.17\n\nDistribution: Linux Debian 3.1 Sarge\n\nHardware Environment: \nm/b ABIT BE6-II ( HPT BIOS updated for LBA48), HDD Seagate ST3160212A 160GB PATA firmware version 3AAJ\n\nSoftware Environment: GRUB boot loader\n\nProblem Description:\nHPT370 max UDMA mode is UDMA66 with the IDE (non-experimantal) driver, and UDMA44 with the LibATA (experimantal) one.\n\nSteps to reproduce:\n\njust boot with kernel newer than 2.6.17. The drive is bootable.\n\nThe GIT versions of kernel ( containing some HPT patches ) don't fix the problem.", "patch": ["diff -u --new-file --recursive --exclude-from /usr/src/exclude linux.vanilla-2.6.24-rc1/drivers/ata/pata_hpt37x.c linux-2.6.24-rc1/drivers/ata/pata_hpt37x.c\n--- linux.vanilla-2.6.24-rc1/drivers/ata/pata_hpt37x.c\t2007-11-01 11:41:54.000000000 +0000\n+++ linux-2.6.24-rc1/drivers/ata/pata_hpt37x.c\t2007-11-05 15:14:34.534443824 +0000\n@@ -295,7 +295,7 @@\n \n static unsigned long hpt370a_filter(struct ata_device *adev, unsigned long mask)\n {\n-\tif (adev->class != ATA_DEV_ATA) {\n+\tif (adev->class == ATA_DEV_ATA) {\n \t\tif (hpt_dma_blacklisted(adev, \"UDMA100\", bad_ata100_5))\n \t\t\tmask &= ~ (0x1F << ATA_SHIFT_UDMA);\n \t}\n@@ -359,28 +359,25 @@\n \t\t{ 0x50, 1, 0x04, 0x04 },\n \t\t{ 0x54, 1, 0x04, 0x04 }\n \t};\n-\tu16 mcr3, mcr6;\n+\tu16 mcr3;\n \tu8 ata66;\n \tstruct ata_port *ap = link->ap;\n \tstruct pci_dev *pdev = to_pci_dev(ap->host->dev);\n+\tunsigned int mcrbase = 0x50 + 4 * ap->port_no;\n \n \tif (!pci_test_config_bits(pdev, &hpt37x_enable_bits[ap->port_no]))\n \t\treturn -ENOENT;\n \n \t/* Do the extra channel work */\n-\tpci_read_config_word(pdev, 0x52, &mcr3);\n-\tpci_read_config_word(pdev, 0x56, &mcr6);\n+\tpci_read_config_word(pdev, mcrbase + 2, &mcr3);\n \t/* Set bit 15 of 0x52 to enable TCBLID as input\n-\t   Set bit 15 of 0x56 to enable FCBLID as input\n \t */\n-\tpci_write_config_word(pdev, 0x52, mcr3 | 0x8000);\n-\tpci_write_config_word(pdev, 0x56, mcr6 | 0x8000);\n+\tpci_write_config_word(pdev, mcrbase + 2, mcr3 | 0x8000);\n \tpci_read_config_byte(pdev, 0x5A, &ata66);\n \t/* Reset TCBLID/FCBLID to output */\n \tpci_write_config_word(pdev, 0x52, mcr3);\n-\tpci_write_config_word(pdev, 0x56, mcr6);\n \n-\tif (ata66 & (1 << ap->port_no))\n+\tif (ata66 & (2 >> ap->port_no))\n \t\tap->cbl = ATA_CBL_PATA40;\n \telse\n \t\tap->cbl = ATA_CBL_PATA80;\n@@ -844,6 +841,22 @@\n \t/* Never went stable */\n \treturn 0;\n }\n+\n+static u32 hpt374_read_freq(struct pci_dev *pdev)\n+{\n+\tu32 freq;\n+\tunsigned long io_base = pci_resource_start(pdev, 4);\n+\tif (PCI_FUNC(pdev->devfn) & 1) {\n+\t\tstruct pci_dev *pdev_0 = pci_get_slot(pdev->bus, pdev->devfn - 1);\n+\t\tio_base = pci_resource_start(pdev_0, 4);\n+\t\tfreq = inl(io_base + 0x90);\n+\t\tpci_dev_put(pdev_0);\n+\t}\n+\telse\n+\t\tfreq = inl(io_base + 0x90);\n+\treturn freq;\n+}\n+\n /**\n  *\thpt37x_init_one\t\t-\tInitialise an HPT37X/302\n  *\t@dev: PCI device\n@@ -902,7 +915,7 @@\n \t\t.flags = ATA_FLAG_SLAVE_POSS,\n \t\t.pio_mask = 0x1f,\n \t\t.mwdma_mask = 0x07,\n-\t\t.udma_mask = 0x0f,\n+\t\t.udma_mask = ATA_UDMA5,\n \t\t.port_ops = &hpt370_port_ops\n \t};\n \t/* HPT370A - UDMA100 */\n@@ -911,7 +924,7 @@\n \t\t.flags = ATA_FLAG_SLAVE_POSS,\n \t\t.pio_mask = 0x1f,\n \t\t.mwdma_mask = 0x07,\n-\t\t.udma_mask = 0x0f,\n+\t\t.udma_mask = ATA_UDMA5,\n \t\t.port_ops = &hpt370a_port_ops\n \t};\n \t/* HPT371, 372 and friends - UDMA133 */\n@@ -1047,9 +1060,14 @@\n \t\toutb(0x0e, iobase + 0x9c);\n \n \t/* Some devices do not let this value be accessed via PCI space\n-\t   according to the old driver */\n+\t   according to the old driver. In addition we must use the value\n+\t   from FN 0 on the HPT374 */\n+\n+\tif (chip_table == &hpt374)\n+\t\tfreq = hpt374_read_freq(dev);\n+\telse\n+\t\tfreq = inl(iobase + 0x90);\n \n-\tfreq = inl(iobase + 0x90);\n \tif ((freq >> 12) != 0xABCDE) {\n \t\tint i;\n \t\tu8 sr;\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "IO/Storage", "Classification": "Unclassified", "Component": "Serial ATA", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Alan", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2007-08-06 22:59 UTC by IvankoB", "Modified": "2007-11-11 17:38 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "2.6.22", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/ata/pata_hpt37x.c"], "methods": ["hpt370a_filter", "hpt374_pre_reset", " hpt37x_init_one", "info_hpt370_33"]}
{"id": "8838", "title": "Random data in files created on NFS (over OCFS2 over DRBD)", "description": "Most recent kernel where this bug did not occur: 2.6.21.6\nDistribution: very custom based on slackware (quite old glibc 2.3 gcc 3.4)\nHardware Environment:\nMB: 2 opteron X64  raid controler 3com series 95XX\nSoftware Environment:\nOCFS2 over DRBD 8.0.4 (active/active) over hardware raid volume\nNFS servers (version 1.1 from source)\nProblem Description:\nNFS shares ocfs2 file systems. \nProblem appears on NFS3 and NFS4 (both over tcp )\n\nWhen I write to file over NFS - content of the file is destroyed and contains random bytes. Size of file is preserved. Kernel report no errors.  Read works correctly. \nFile written directly on nfs server is OK (I can read it on server and client station). \nOn the same server NFS over reiserfs works correctly.\n\n\nSteps to reproduce:\ntry to mount nfs share on client workstation, and execute echo \"test\" >> mytestfile", "patch": ["From 5792765939156bd6560220c3d8bde06840ffd1ec Mon Sep 17 00:00:00 2001\nFrom: Mark Fasheh <mark.fasheh@oracle.com>\nDate: Fri, 10 Aug 2007 14:17:04 -0700\nSubject: ocfs2: Fix bad source start calculation during kernel writes\n\nFor in-kernel writes ocfs2_get_write_source() should be starting the buffer\nat a page boundary as the math in ocfs2_map_and_write_user_data() will pad\nit back out to the correct write offset. Instead, we were passing the raw\noffset, which caused ocfs2_map_and_write_user_data() start too far into the\nbuffer, resulting in corruptions from nfs client writes.\n\nSigned-off-by: Mark Fasheh <mark.fasheh@oracle.com>\n---\n fs/ocfs2/file.c |    2 +-\n 1 files changed, 1 insertions(+), 1 deletions(-)\n\ndiff --git a/fs/ocfs2/file.c b/fs/ocfs2/file.c\nindex ac6c964..e0cd750 100644\n--- a/fs/ocfs2/file.c\n+++ b/fs/ocfs2/file.c\n@@ -1353,7 +1353,7 @@ static struct page * ocfs2_get_write_source(struct ocfs2_buffered_write_priv *bp\n \t\telse\n \t\t\tsrc_page = ERR_PTR(-EFAULT);\n \t} else {\n-\t\tbp->b_src_buf = buf;\n+\t\tbp->b_src_buf = (char *)((unsigned long)buf & PAGE_CACHE_MASK);\n \t}\n \n \treturn src_page;\n-- \n1.5.0.6\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "File System", "Classification": "Unclassified", "Component": "Other", "Hardware": "All Linux", "Importance": "P1 high", "Assignee": "Mark Fasheh", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2007-08-02 02:36 UTC by Pawel Zawora", "Modified": "2008-02-25 17:22 UTC", "CC List": "5 users", "See Also": "", "Kernel Version": "2.6.22", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["fs/ocfs2/file.c"], "methods": ["*ocfs2_get_write_source"]}
{"id": "8721", "title": "trace dump: \"kobject_add failed for audio with -EEXIST, ...\"", "description": "Most recent kernel where this bug did not occur: dunno - jumped from 2.4.34.5 to 2.6.21.5\nDistribution: Debian 3.1\nHardware Environment: pc\nSoftware Environment: Linux 2.6.21.5 + patch suspend2-2.2.10\nProblem Description: trace dump loading module snd-pcm-oss\n\nSteps to reproduce: load the module\n\nhere's the dmesg dump:\n\nSoftware Watchdog Timer: 0.07 initialized. soft_noboot=0 soft_margin=60 sec (nowayout= 0)\nDevice driver i2c-9191 lacks bus and class support for being resumed.\nPCI driver via686a lacks driver specific resume support.\ninput: Power Button (FF) as /class/input/input3\nACPI: Power Button (FF) [PWRF]\ninput: Power Button (CM) as /class/input/input4\nACPI: Power Button (CM) [PWRB]\ni2c /dev entries driver\nDevice driver i2c-0 lacks bus and class support for being resumed.\nPCI driver vt596_smbus lacks driver specific resume support.\nit87: Found IT8712F chip at 0x290, revision 5\nCapability LSM initialized\nkobject_add failed for audio with -EEXIST, don't try to register things with the same name in the same directory.\n [<c01f5016>] kobject_shadow_add+0x86/0x130\n [<c027001d>] device_add+0x9d/0x570\n [<c027086e>] device_create+0x8e/0xc0\n [<f881c1ac>] sound_insert_unit+0xcc/0x110 [soundcore]\n [<f881c2e9>] register_sound_special_device+0x79/0x140 [soundcore]\n [<f88e332d>] snd_register_oss_device+0xed/0x180 [snd]\n [<f8b6d8ef>] register_oss_dsp+0x5f/0xa0 [snd_pcm_oss]\n [<c01f47eb>] idr_get_new_above_int+0x6b/0x130\n [<c01f48ea>] idr_get_new+0xa/0x30\n [<c01a988d>] get_inode_number+0x3d/0x80\n [<c01aa0c2>] create_proc_entry+0x72/0xb0\n [<f88e0595>] snd_info_register+0x85/0xb0 [snd]\n [<f8b6d838>] snd_pcm_oss_proc_init+0x78/0x90 [snd_pcm_oss]\n [<f8b6d9b9>] snd_pcm_oss_register_minor+0x89/0x100 [snd_pcm_oss]\n [<c013f0c2>] load_module+0xa82/0xcf0\n [<c03337c4>] __mutex_lock_slowpath+0x174/0x220\n [<f892d6f7>] snd_pcm_notify+0xa7/0xc0 [snd_pcm]\n [<f8874030>] alsa_pcm_oss_init+0x30/0x82 [snd_pcm_oss]\n [<c013f425>] sys_init_module+0xd5/0x140\n [<c01041b0>] syscall_call+0x7/0xb\n =======================\nusbcore: registered new interface driver usbkbd\nUSB driver usbkbd lacks resume support.\ndrivers/usb/input/usbkbd.c: :USB HID Boot Protocol keyboard driver\nusbcore: registered new interface driver usbmouse\n\nlspci:\n0000:00:00.0 Host bridge: VIA Technologies, Inc. VT8377 [KT400/KT600 AGP] Host Bridge (rev 80)\n0000:00:01.0 PCI bridge: VIA Technologies, Inc. VT8237 PCI Bridge\n0000:00:10.0 USB Controller: VIA Technologies, Inc. VT82xxxxx UHCI USB 1.1 Controller (rev 80)\n0000:00:10.1 USB Controller: VIA Technologies, Inc. VT82xxxxx UHCI USB 1.1 Controller (rev 80)\n0000:00:10.2 USB Controller: VIA Technologies, Inc. VT82xxxxx UHCI USB 1.1 Controller (rev 80)\n0000:00:10.3 USB Controller: VIA Technologies, Inc. USB 2.0 (rev 82)\n0000:00:11.0 ISA bridge: VIA Technologies, Inc. VT8235 ISA Bridge\n0000:00:11.1 IDE interface: VIA Technologies, Inc. VT82C586A/B/VT82C686/A/B/VT823x/A/C PIPC Bus Master IDE (rev 06)\n0000:00:11.5 Multimedia audio controller: VIA Technologies, Inc. VT8233/A/8235/8237 AC97 Audio Controller (rev 50)\n0000:00:12.0 Ethernet controller: VIA Technologies, Inc. VT6102 [Rhine-II] (rev 74)\n0000:01:00.0 VGA compatible controller: ATI Technologies Inc RV280 [Radeon 9200 SE] (rev 01)\n0000:01:00.1 Display controller: ATI Technologies Inc RV280 [Radeon 9200 SE] (Secondary) (rev 01)\n\ndmidecode:\nBIOS Information\n        Vendor: Award Software, Inc.\n        Version: ASUS A7V8X-X ACPI BIOS Revision 1008\n        Release Date: 12/29/2003\n\ngot same trace on another pc with same MB, so I think hw failure can be reasonably excluded.\n\nthanks\n--\npaolo", "patch": ["--- sound/sound_core.c.orig\t2007-09-04 23:50:42.000000000 +0200\n+++ sound/sound_core.c\t2007-09-05 02:03:38.000000000 +0200\n@@ -166,9 +166,9 @@\n \tif (r < 0)\n \t\tgoto fail;\n \telse if (r < SOUND_STEP)\n-\t\tsprintf(s->name, \"sound/%s\", name);\n+\t\tsprintf(s->name, \"%s\", name);\n \telse\n-\t\tsprintf(s->name, \"sound/%s%d\", name, r / SOUND_STEP);\n+\t\tsprintf(s->name, \"%s%d\", name, r / SOUND_STEP);\n \n \tdevice_create(sound_class, dev, MKDEV(SOUND_MAJOR, s->unit_minor),\n \t\t      s->name+6);\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Sound", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Jaroslav Kysela", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2007-07-07 07:58 UTC by paolo", "Modified": "2009-03-23 11:14 UTC", "CC List": "4 users", "See Also": "", "Kernel Version": "2.6.21", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["sound/sound_core.c"], "methods": ["sound_insert_unit"]}
{"id": "8709", "title": "regression: EmbeddedControl AE_TIME errors, /proc/acpi/battery/* not present", "description": "Most recent kernel where this bug did not occur:\nBattery and other ACPI-related features used to work in 2.6.20\n\nDistribution: Ubuntu (7.04 with 2.6.20 - works, alpha 7.10 with 2.6.22-rc - does not work)\n\nHardware Environment:\nASUS M6r\n\nProblem Description:\n2.6.22-rc kernels are unable to check battery status. \nThe following errors show up in dmesg at boot:\n\nACPI: EC: acpi_ec_wait timeout, status = 255, expect_event = 2\nACPI: EC: input buffer is not empty, aborting transaction\nACPI Exception (evregion-0420): AE_TIME, Returned by Handler for [EmbeddedControl] [20070126]\nACPI Error (psparse-0537): Method parse/execution failed [\\_SB_.PCI0.SBRG.EC0_.RDC3] (Node ddf07f04), AE_TIME\nACPI Error (psparse-0537): Method parse/execution failed [\\ECIO] (Node ddf0975c), AE_TIME\nACPI Error (psparse-0537): Method parse/execution failed [\\_SB_.PCI0.SBRG.EC0_.ACPS] (Node ddf07f68), AE_TIME\nACPI Error (psparse-0537): Method parse/execution failed [\\ACPS] (Node ddf04c70), AE_TIME\nACPI Error (psparse-0537): Method parse/execution failed [\\_SB_.PCI0.AC0_._PSR] (Node ddf07b80), AE_TIME\nACPI Exception (ac-0095): AE_TIME, Error reading AC Adapter state [20070126]\nACPI: EC: acpi_ec_wait timeout, status = 255, expect_event = 2\nACPI: EC: input buffer is not empty, aborting transaction\nACPI Exception (evregion-0420): AE_TIME, Returned by Handler for [EmbeddedControl] [20070126]\nACPI Exception (dswexec-0462): AE_TIME, While resolving operands for [OpcodeName unavailable] [20070126]\nACPI Error (psparse-0537): Method parse/execution failed [\\_SB_.PCI0.SBRG.EC0_.SMBR] (Node ddf07d24), AE_TIME\nACPI Error (psparse-0537): Method parse/execution failed [\\_SB_.PCI0.SBRG.EC0_.BIF0] (Node ddf07900), AE_TIME\nACPI Error (psparse-0537): Method parse/execution failed [\\_SB_.PCI0.BAT0._BIF] (Node ddf07a2c), AE_TIME\nACPI Exception (battery-0147): AE_TIME, Evaluating _BIF [20070126]\n\nThis laptop experienced EC problems before (described in bug 4150 and bug 6111).", "patch": ["Debug printk for EC initialization\n\nFrom: Alexey Starikovskiy <astarikivskiy@suse.de>\n\n\n---\n\n drivers/acpi/ec.c |   13 +++++++++----\n 1 files changed, 9 insertions(+), 4 deletions(-)\n\ndiff --git a/drivers/acpi/ec.c b/drivers/acpi/ec.c\nindex 82f496c..a7c6ee1 100644\n--- a/drivers/acpi/ec.c\n+++ b/drivers/acpi/ec.c\n@@ -704,12 +704,15 @@ ec_parse_io_ports(struct acpi_resource *resource, void *context)\n static int ec_install_handlers(struct acpi_ec *ec)\n {\n \tacpi_status status;\n+\n+printk(KERN_DEBUG PREFIX \"start ec_install_handlers()\\n\");\n \tstatus = acpi_install_gpe_handler(NULL, ec->gpe,\n \t\t\t\t\t  ACPI_GPE_EDGE_TRIGGERED,\n \t\t\t\t\t  &acpi_ec_gpe_handler, ec);\n-\tif (ACPI_FAILURE(status))\n+\tif (ACPI_FAILURE(status)) {\n+printk(KERN_DEBUG PREFIX \"acpi_install_gpe_handler() failed with %d\\n\", status);\n \t\treturn -ENODEV;\n-\n+\t}\n \tacpi_set_gpe_type(NULL, ec->gpe, ACPI_GPE_TYPE_RUNTIME);\n \tacpi_enable_gpe(NULL, ec->gpe, ACPI_NOT_ISR);\n \n@@ -718,6 +721,7 @@ static int ec_install_handlers(struct acpi_ec *ec)\n \t\t\t\t\t\t    &acpi_ec_space_handler,\n \t\t\t\t\t\t    &acpi_ec_space_setup, ec);\n \tif (ACPI_FAILURE(status)) {\n+printk(KERN_DEBUG PREFIX \"acpi_install_address_space_handler() failed with %d\\n\", status);\n \t\tacpi_remove_gpe_handler(NULL, ec->gpe, &acpi_ec_gpe_handler);\n \t\treturn -ENODEV;\n \t}\n@@ -731,7 +735,7 @@ static int ec_install_handlers(struct acpi_ec *ec)\n static int acpi_ec_start(struct acpi_device *device)\n {\n \tstruct acpi_ec *ec;\n-\n+printk(KERN_DEBUG PREFIX \"start acpi_ec_start()\\n\");\n \tif (!device)\n \t\treturn -EINVAL;\n \n@@ -754,7 +758,7 @@ static int acpi_ec_stop(struct acpi_device *device, int type)\n {\n \tacpi_status status;\n \tstruct acpi_ec *ec;\n-\n+printk(KERN_DEBUG PREFIX \"start acpi_ec_stop()\\n\");\n \tif (!device)\n \t\treturn -EINVAL;\n \n@@ -773,6 +777,7 @@ static int acpi_ec_stop(struct acpi_device *device, int type)\n \t\treturn -ENODEV;\n \n \tstatus = acpi_remove_gpe_handler(NULL, ec->gpe, &acpi_ec_gpe_handler);\n+printk(KERN_DEBUG PREFIX \"acpi_remove_gpe_handler called() for #%x gpe\\n\", ec->gpe);\n \tif (ACPI_FAILURE(status))\n \t\treturn -ENODEV;\n \n", "Switch from boot_ec as soon as we find its desc in DSDT.\n\nFrom: Alexey Starikovskiy <astarikivskiy@suse.de>\n\n\n---\n\n drivers/acpi/ec.c |   43 +++++++++++++++----------------------------\n 1 files changed, 15 insertions(+), 28 deletions(-)\n\ndiff --git a/drivers/acpi/ec.c b/drivers/acpi/ec.c\nindex 82f496c..0d949b8 100644\n--- a/drivers/acpi/ec.c\n+++ b/drivers/acpi/ec.c\n@@ -614,6 +614,14 @@ static struct acpi_ec *make_acpi_ec(void)\n \treturn ec;\n }\n \n+static void ec_remove_handlers(struct acpi_ec *ec)\n+{\n+\tacpi_remove_address_space_handler(ec->handle,\n+\t\t\t\t\t  ACPI_ADR_SPACE_EC,\n+\t\t\t\t\t  &acpi_ec_space_handler);\n+\tacpi_remove_gpe_handler(NULL, ec->gpe, &acpi_ec_gpe_handler);\n+}\n+\n static int acpi_ec_add(struct acpi_device *device)\n {\n \tacpi_status status = AE_OK;\n@@ -638,14 +646,15 @@ static int acpi_ec_add(struct acpi_device *device)\n \t/* Check if we found the boot EC */\n \tif (boot_ec) {\n \t\tif (boot_ec->gpe == ec->gpe) {\n-\t\t\t/* We might have incorrect info for GL at boot time */\n \t\t\tmutex_lock(&boot_ec->lock);\n-\t\t\tboot_ec->global_lock = ec->global_lock;\n+\t\t\tec_remove_handlers(boot_ec);\n \t\t\tmutex_unlock(&boot_ec->lock);\n-\t\t\tkfree(ec);\n-\t\t\tec = boot_ec;\n+\t\t\tmutex_destroy(&boot_ec->lock);\n+\t\t\tkfree(boot_ec);\n+\t\t\tfirst_ec = boot_ec = NULL;\n \t\t}\n-\t} else\n+\t}\n+\tif (!first_ec)\n \t\tfirst_ec = ec;\n \tec->handle = device->handle;\n \tacpi_driver_data(device) = ec;\n@@ -672,9 +681,6 @@ static int acpi_ec_remove(struct acpi_device *device, int type)\n \tif (ec == first_ec)\n \t\tfirst_ec = NULL;\n \n-\t/* Don't touch boot EC */\n-\tif (boot_ec != ec)\n-\t\tkfree(ec);\n \treturn 0;\n }\n \n@@ -743,16 +749,11 @@ static int acpi_ec_start(struct acpi_device *device)\n \tACPI_DEBUG_PRINT((ACPI_DB_INFO, \"gpe=0x%02lx, ports=0x%2lx,0x%2lx\",\n \t\t\t  ec->gpe, ec->command_addr, ec->data_addr));\n \n-\t/* Boot EC is already working */\n-\tif (ec == boot_ec)\n-\t\treturn 0;\n-\n \treturn ec_install_handlers(ec);\n }\n \n static int acpi_ec_stop(struct acpi_device *device, int type)\n {\n-\tacpi_status status;\n \tstruct acpi_ec *ec;\n \n \tif (!device)\n@@ -761,21 +762,7 @@ static int acpi_ec_stop(struct acpi_device *device, int type)\n \tec = acpi_driver_data(device);\n \tif (!ec)\n \t\treturn -EINVAL;\n-\n-\t/* Don't touch boot EC */\n-\tif (ec == boot_ec)\n-\t\treturn 0;\n-\n-\tstatus = acpi_remove_address_space_handler(ec->handle,\n-\t\t\t\t\t\t   ACPI_ADR_SPACE_EC,\n-\t\t\t\t\t\t   &acpi_ec_space_handler);\n-\tif (ACPI_FAILURE(status))\n-\t\treturn -ENODEV;\n-\n-\tstatus = acpi_remove_gpe_handler(NULL, ec->gpe, &acpi_ec_gpe_handler);\n-\tif (ACPI_FAILURE(status))\n-\t\treturn -ENODEV;\n-\n+\tec_remove_handlers(ec);\n \treturn 0;\n }\n \n", "commit f9319f903f898dd4b15dbc386499725ce6c59776\nAuthor: Alexey Starikovskiy <astarikovskiy@novell.com>\nDate:   Fri Aug 24 08:10:11 2007 +0400\n\n    ACPI: EC: revert fix for bugzilla 8709\n    \n    This is a manual revert of 7c010de7506954e973abfab5c5999c5a97f7a73e,\n    a fix that broke another ASUS in 8909 and 8919.\n    \n    Signed-off-by: Alexey Starikovskiy <astarikovskiy@suse.de>\n    Signed-off-by: Len Brown <len.brown@intel.com>\n\ndiff --git a/drivers/acpi/ec.c b/drivers/acpi/ec.c\nindex 56bee9e..43749c8 100644\n--- a/drivers/acpi/ec.c\n+++ b/drivers/acpi/ec.c\n@@ -696,14 +696,6 @@ ec_parse_device(acpi_handle handle, u32 Level, void *context, void **retval)\n \treturn AE_CTRL_TERMINATE;\n }\n \n-static void ec_remove_handlers(struct acpi_ec *ec)\n-{\n-\tacpi_remove_address_space_handler(ec->handle,\n-\t\t\t\t\t  ACPI_ADR_SPACE_EC,\n-\t\t\t\t\t  &acpi_ec_space_handler);\n-\tacpi_remove_gpe_handler(NULL, ec->gpe, &acpi_ec_gpe_handler);\n-}\n-\n static int acpi_ec_add(struct acpi_device *device)\n {\n \tstruct acpi_ec *ec = NULL;\n@@ -727,13 +719,16 @@ static int acpi_ec_add(struct acpi_device *device)\n \t/* Check if we found the boot EC */\n \tif (boot_ec) {\n \t\tif (boot_ec->gpe == ec->gpe) {\n-\t\t\tec_remove_handlers(boot_ec);\n-\t\t\tmutex_destroy(&boot_ec->lock);\n-\t\t\tkfree(boot_ec);\n-\t\t\tfirst_ec = boot_ec = NULL;\n+\t\t\t/* We might have incorrect info for GL at boot time */\n+\t\t\tmutex_lock(&boot_ec->lock);\n+\t\t\tboot_ec->global_lock = ec->global_lock;\n+\t\t\t/* Copy handlers from new ec into boot ec */\n+\t\t\tlist_splice(&ec->list, &boot_ec->list);\n+\t\t\tmutex_unlock(&boot_ec->lock);\n+\t\t\tkfree(ec);\n+\t\t\tec = boot_ec;\n \t\t}\n-\t}\n-\tif (!first_ec)\n+\t} else\n \t\tfirst_ec = ec;\n \tec->handle = device->handle;\n \tacpi_driver_data(device) = ec;\n@@ -762,6 +757,9 @@ static int acpi_ec_remove(struct acpi_device *device, int type)\n \tif (ec == first_ec)\n \t\tfirst_ec = NULL;\n \n+\t/* Don't touch boot EC */\n+\tif (boot_ec != ec)\n+\t\tkfree(ec);\n \treturn 0;\n }\n \n@@ -825,7 +823,9 @@ static int acpi_ec_start(struct acpi_device *device)\n \tif (!ec)\n \t\treturn -EINVAL;\n \n-\tret = ec_install_handlers(ec);\n+\t/* Boot EC is already working */\n+\tif (ec != boot_ec)\n+\t\tret = ec_install_handlers(ec);\n \n \t/* EC is fully operational, allow queries */\n \tatomic_set(&ec->query_pending, 0);\n@@ -835,6 +835,7 @@ static int acpi_ec_start(struct acpi_device *device)\n \n static int acpi_ec_stop(struct acpi_device *device, int type)\n {\n+\tacpi_status status;\n \tstruct acpi_ec *ec;\n \n \tif (!device)\n@@ -843,7 +844,21 @@ static int acpi_ec_stop(struct acpi_device *device, int type)\n \tec = acpi_driver_data(device);\n \tif (!ec)\n \t\treturn -EINVAL;\n-\tec_remove_handlers(ec);\n+\n+\t/* Don't touch boot EC */\n+\tif (ec == boot_ec)\n+\t\treturn 0;\n+\n+\tstatus = acpi_remove_address_space_handler(ec->handle,\n+\t\t\t\t\t\t   ACPI_ADR_SPACE_EC,\n+\t\t\t\t\t\t   &acpi_ec_space_handler);\n+\tif (ACPI_FAILURE(status))\n+\t\treturn -ENODEV;\n+\n+\tstatus = acpi_remove_gpe_handler(NULL, ec->gpe, &acpi_ec_gpe_handler);\n+\tif (ACPI_FAILURE(status))\n+\t\treturn -ENODEV;\n+\n \treturn 0;\n }\n \n", "ACPI: EC: Drop ECDT-based boot_ec as soon as we find DSDT-based one.\n\nFrom: Alexey Starikovskiy <astarikovskiy@suse.de>\n\nASUS notebooks have numerous problems with EC initialization\nThis patch tries to work around three known issues reported in 8598, 8709\nand 8909/8919.\nSigned-off-by: Alexey Starikovskiy <astarikovskiy@suse.de>\n---\n\n drivers/acpi/ec.c |   92 +++++++++++++++++++++++------------------------------\n 1 files changed, 40 insertions(+), 52 deletions(-)\n\ndiff --git a/drivers/acpi/ec.c b/drivers/acpi/ec.c\nindex 3f7935a..94c9c4f 100644\n--- a/drivers/acpi/ec.c\n+++ b/drivers/acpi/ec.c\n@@ -121,6 +121,7 @@ static struct acpi_ec {\n \tatomic_t event_count;\n \twait_queue_head_t wait;\n \tstruct list_head list;\n+\tu8 handlers_installed;\n } *boot_ec, *first_ec;\n \n /* --------------------------------------------------------------------------\n@@ -680,32 +681,50 @@ ec_parse_device(acpi_handle handle, u32 Level, void *context, void **retval)\n \tstatus = acpi_evaluate_integer(handle, \"_GPE\", NULL, &ec->gpe);\n \tif (ACPI_FAILURE(status))\n \t\treturn status;\n-\n \t/* Find and register all query methods */\n \tacpi_walk_namespace(ACPI_TYPE_METHOD, handle, 1,\n \t\t\t    acpi_ec_register_query_methods, ec, NULL);\n-\n \t/* Use the global lock for all EC transactions? */\n \tacpi_evaluate_integer(handle, \"_GLK\", NULL, &ec->global_lock);\n-\n \tec->handle = handle;\n-\n-\tprintk(KERN_INFO PREFIX \"GPE = 0x%lx, I/O: command/status = 0x%lx, data = 0x%lx\\n\",\n-\t\t\t  ec->gpe, ec->command_addr, ec->data_addr);\n-\n \treturn AE_CTRL_TERMINATE;\n }\n \n+static void ec_remove_handlers(struct acpi_ec *ec)\n+{\n+\tif (ACPI_FAILURE(acpi_remove_address_space_handler(ec->handle,\n+\t\t\t\tACPI_ADR_SPACE_EC, &acpi_ec_space_handler)))\n+\t\tprintk(KERN_ERR PREFIX \"failed to remove space handler\\n\");\n+\tif (ACPI_FAILURE(acpi_remove_gpe_handler(NULL, ec->gpe,\n+\t\t\t\t&acpi_ec_gpe_handler)))\n+\t\tprintk(KERN_ERR PREFIX \"failed to remove gpe handler\\n\");\n+\tec->handlers_installed = 0;\n+}\n+\n static int acpi_ec_add(struct acpi_device *device)\n {\n \tstruct acpi_ec *ec = NULL;\n \n \tif (!device)\n \t\treturn -EINVAL;\n-\n \tstrcpy(acpi_device_name(device), ACPI_EC_DEVICE_NAME);\n \tstrcpy(acpi_device_class(device), ACPI_EC_CLASS);\n \n+\t/* Check for boot EC */\n+\tif (boot_ec) {\n+\t\tif (boot_ec->handle == device->handle) {\n+\t\t\t/* Pre-loaded EC from DSDT, just move pointer */\n+\t\t\tec = boot_ec;\n+\t\t\tboot_ec = NULL;\n+\t\t\tgoto end;\n+\t\t} else if (boot_ec->handle == ACPI_ROOT_OBJECT) {\n+\t\t\t/* ECDT-based EC, time to shut it down */\n+\t\t\tec_remove_handlers(boot_ec);\n+\t\t\tkfree(boot_ec);\n+\t\t\tfirst_ec = boot_ec = NULL;\n+\t\t}\n+\t}\n+\n \tec = make_acpi_ec();\n \tif (!ec)\n \t\treturn -ENOMEM;\n@@ -715,25 +734,14 @@ static int acpi_ec_add(struct acpi_device *device)\n \t\tkfree(ec);\n \t\treturn -EINVAL;\n \t}\n-\n-\t/* Check if we found the boot EC */\n-\tif (boot_ec) {\n-\t\tif (boot_ec->gpe == ec->gpe) {\n-\t\t\t/* We might have incorrect info for GL at boot time */\n-\t\t\tmutex_lock(&boot_ec->lock);\n-\t\t\tboot_ec->global_lock = ec->global_lock;\n-\t\t\t/* Copy handlers from new ec into boot ec */\n-\t\t\tlist_splice(&ec->list, &boot_ec->list);\n-\t\t\tmutex_unlock(&boot_ec->lock);\n-\t\t\tkfree(ec);\n-\t\t\tec = boot_ec;\n-\t\t}\n-\t} else\n-\t\tfirst_ec = ec;\n \tec->handle = device->handle;\n+      end:\n+\tif (!first_ec)\n+\t\tfirst_ec = ec;\n \tacpi_driver_data(device) = ec;\n-\n \tacpi_ec_add_fs(device);\n+\tprintk(KERN_INFO PREFIX \"GPE = 0x%lx, I/O: command/status = 0x%lx, data = 0x%lx\\n\",\n+\t\t\t  ec->gpe, ec->command_addr, ec->data_addr);\n \treturn 0;\n }\n \n@@ -756,10 +764,7 @@ static int acpi_ec_remove(struct acpi_device *device, int type)\n \tacpi_driver_data(device) = NULL;\n \tif (ec == first_ec)\n \t\tfirst_ec = NULL;\n-\n-\t/* Don't touch boot EC */\n-\tif (boot_ec != ec)\n-\t\tkfree(ec);\n+\tkfree(ec);\n \treturn 0;\n }\n \n@@ -789,6 +794,8 @@ ec_parse_io_ports(struct acpi_resource *resource, void *context)\n static int ec_install_handlers(struct acpi_ec *ec)\n {\n \tacpi_status status;\n+\tif (ec->handlers_installed)\n+\t\treturn 0;\n \tstatus = acpi_install_gpe_handler(NULL, ec->gpe,\n \t\t\t\t\t  ACPI_GPE_EDGE_TRIGGERED,\n \t\t\t\t\t  &acpi_ec_gpe_handler, ec);\n@@ -807,6 +814,7 @@ static int ec_install_handlers(struct acpi_ec *ec)\n \t\treturn -ENODEV;\n \t}\n \n+\tec->handlers_installed = 1;\n \treturn 0;\n }\n \n@@ -822,42 +830,23 @@ static int acpi_ec_start(struct acpi_device *device)\n \n \tif (!ec)\n \t\treturn -EINVAL;\n-\n-\t/* Boot EC is already working */\n-\tif (ec != boot_ec)\n-\t\tret = ec_install_handlers(ec);\n+\t\n+\tret = ec_install_handlers(ec);\n \n \t/* EC is fully operational, allow queries */\n \tatomic_set(&ec->query_pending, 0);\n-\n \treturn ret;\n }\n \n static int acpi_ec_stop(struct acpi_device *device, int type)\n {\n-\tacpi_status status;\n \tstruct acpi_ec *ec;\n-\n \tif (!device)\n \t\treturn -EINVAL;\n-\n \tec = acpi_driver_data(device);\n \tif (!ec)\n \t\treturn -EINVAL;\n-\n-\t/* Don't touch boot EC */\n-\tif (ec == boot_ec)\n-\t\treturn 0;\n-\n-\tstatus = acpi_remove_address_space_handler(ec->handle,\n-\t\t\t\t\t\t   ACPI_ADR_SPACE_EC,\n-\t\t\t\t\t\t   &acpi_ec_space_handler);\n-\tif (ACPI_FAILURE(status))\n-\t\treturn -ENODEV;\n-\n-\tstatus = acpi_remove_gpe_handler(NULL, ec->gpe, &acpi_ec_gpe_handler);\n-\tif (ACPI_FAILURE(status))\n-\t\treturn -ENODEV;\n+\tec_remove_handlers(ec);\n \n \treturn 0;\n }\n@@ -877,7 +866,7 @@ int __init acpi_ec_ecdt_probe(void)\n \tstatus = acpi_get_table(ACPI_SIG_ECDT, 1,\n \t\t\t\t(struct acpi_table_header **)&ecdt_ptr);\n \tif (ACPI_SUCCESS(status)) {\n-\t\tprintk(KERN_INFO PREFIX \"EC description table is found, configuring boot EC\\n\\n\");\n+\t\tprintk(KERN_INFO PREFIX \"EC description table is found, configuring boot EC\\n\");\n \t\tboot_ec->command_addr = ecdt_ptr->control.address;\n \t\tboot_ec->data_addr = ecdt_ptr->data.address;\n \t\tboot_ec->gpe = ecdt_ptr->gpe;\n@@ -899,7 +888,6 @@ int __init acpi_ec_ecdt_probe(void)\n       error:\n \tkfree(boot_ec);\n \tboot_ec = NULL;\n-\n \treturn -ENODEV;\n }\n \n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "EC", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Alexey Starikovskiy", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2007-07-03 01:39 UTC by Piotr Keplicz", "Modified": "2008-10-17 21:36 UTC", "CC List": "5 users", "See Also": "", "Kernel Version": "2.6.23-rc3", "Subsystem": "", "Regression": "Yes", "Bisected commit-id": "", "paths": ["drivers/acpi/ec.c"], "methods": ["ec_install_handlers", "acpi_ec_stop"]}
{"id": "8671", "title": "CPU frequency always on highest frequency after wakeup from suspend to disk", "": "Show dependency tree", "description": "Most recent kernel where this bug did not occur: unkown\nDistribution: Gentoo Linux\nHardware Environment: IBM Thinkpad T43\nSoftware Environment:\nProblem Description: cpufreq_conservative doesn't scale CPU frequency anymore after wakeup from suspend to disk, instead CPU runs always with the highest available frequency. Scaling driver is acpi-cpufreq.\n\nSteps to reproduce: Choose cpufreq_conservative as scaling driver and execute \"echo disk > /sys/power/state\".", "patch": ["Restore previously used governor on a hot-replugged CPU\n\nNegative side effect: needs NR_CPUs pointer array of memory in\nCONFIG_HOTPLUG_CPU case.\nMove of policy->user_policy.governor assignment is just a minor cleanup.\n\nSigned-off-by: Thomas Renninger <trenn@suse.de>\n\n---\n drivers/cpufreq/cpufreq.c |   23 ++++++++++++++++++++++-\n 1 file changed, 22 insertions(+), 1 deletion(-)\n\nIndex: linux-2.6.22-rc6/drivers/cpufreq/cpufreq.c\n===================================================================\n--- linux-2.6.22-rc6.orig/drivers/cpufreq/cpufreq.c\n+++ linux-2.6.22-rc6/drivers/cpufreq/cpufreq.c\n@@ -39,6 +39,10 @@\n  */\n static struct cpufreq_driver *cpufreq_driver;\n static struct cpufreq_policy *cpufreq_cpu_data[NR_CPUS];\n+#ifdef CONFIG_HOTPLUG_CPU\n+/* This one keeps track of the previously set governor of a removed CPU */\n+static struct cpufreq_governor *cpufreq_cpu_governor[NR_CPUS];\n+#endif\n static DEFINE_SPINLOCK(cpufreq_driver_lock);\n \n /*\n@@ -770,9 +774,17 @@ static int cpufreq_add_dev (struct sys_d\n \t}\n \tpolicy->user_policy.min = policy->cpuinfo.min_freq;\n \tpolicy->user_policy.max = policy->cpuinfo.max_freq;\n-\tpolicy->user_policy.governor = policy->governor;\n \n #ifdef CONFIG_SMP\n+\n+#ifdef CONFIG_HOTPLUG_CPU\n+\tif (cpufreq_cpu_governor[cpu]){\n+\t\tpolicy->governor = cpufreq_cpu_governor[cpu];\n+\t\tdprintk(\"Restoring governor %s for cpu %d\\n\",\n+\t\t       policy->governor->name, cpu);\n+\t}\n+#endif\n+\n \tfor_each_cpu_mask(j, policy->cpus) {\n \t\tif (cpu == j)\n \t\t\tcontinue;\n@@ -865,6 +877,7 @@ static int cpufreq_add_dev (struct sys_d\n \t/* set default policy */\n \tret = __cpufreq_set_policy(policy, &new_policy);\n \tpolicy->user_policy.policy = policy->policy;\n+\tpolicy->user_policy.governor = policy->governor;\n \n \tunlock_policy_rwsem_write(cpu);\n \n@@ -961,6 +974,11 @@ static int __cpufreq_remove_dev (struct \n \t}\n \n #ifdef CONFIG_SMP\n+\n+#ifdef CONFIG_HOTPLUG_CPU\n+\tcpufreq_cpu_governor[cpu] = data->governor;\n+#endif\n+\n \t/* if we have other CPUs still registered, we need to unlink them,\n \t * or else wait_for_completion below will lock up. Clean the\n \t * cpufreq_cpu_data[] while holding the lock, and remove the sysfs\n@@ -981,6 +999,9 @@ static int __cpufreq_remove_dev (struct \n \t\t\tif (j == cpu)\n \t\t\t\tcontinue;\n \t\t\tdprintk(\"removing link for cpu %u\\n\", j);\n+#ifdef CONFIG_HOTPLUG_CPU\n+\t\t\tcpufreq_cpu_governor[j] = data->governor;\n+#endif\n \t\t\tcpu_sys_dev = get_cpu_sysdev(j);\n \t\t\tsysfs_remove_link(&cpu_sys_dev->kobj, \"cpufreq\");\n \t\t\tcpufreq_cpu_put(data);\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Power Management", "Classification": "Unclassified", "Component": "cpufreq", "Hardware": "All Linux", "Importance": "P1 low", "Assignee": "cpufreq", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "7216", "Reported": "2007-06-25 05:01 UTC by Markus Schaub", "Modified": "2007-08-09 07:14 UTC", "CC List": "3 users", "See Also": "", "Kernel Version": "2.6.22", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/cpufreq/cpufreq.c"], "methods": ["cpufreq_add_dev", "__cpufreq_remove_dev"]}
{"id": "8667", "title": "sky2 crash when return from resume to ram", "description": "Distribution: Debian Etch\nHardware Environment: Laptop Toshiba M45-S355\n\nProblem Description:\nSuspend to ram work fine in my Toshiba M45-S355, but when laptop return (from RAM), my network connection crash, and I need unload and load again my sky2 module.\n\nMy NIC is:\nMarvell Technology Group Ltd. 88E8036 PCI-E Fast Ethernet Controller (rev 10)\n\nRafael J. Wysocki (from LKML) recommend open this issue on this category (Power Management).\n\nkernel: sky2 eth1: disabling interface\nkernel: sky2 eth1: enabling interface\nkernel: sky2 eth1: ram buffer 4K\nkernel: ADDRCONF(NETDEV_UP): eth1: link is not ready\nkernel: uhci_hcd 0000:00:1d.3: remove, state 4\nkernel: usb usb4: USB disconnect, address 1\nkernel: uhci_hcd 0000:00:1d.3: USB bus 4 deregistered\nkernel: ACPI: PCI interrupt for device 0000:00:1d.3 disabled\nkernel: uhci_hcd 0000:00:1d.2: remove, state 4\nkernel: usb usb3: USB disconnect, address 1\nkernel: uhci_hcd 0000:00:1d.2: USB bus 3 deregistered\nkernel: ACPI: PCI interrupt for device 0000:00:1d.2 disabled\nkernel: uhci_hcd 0000:00:1d.1: remove, state 4\nkernel: usb usb2: USB disconnect, address 1\nkernel: uhci_hcd 0000:00:1d.1: USB bus 2 deregistered\nkernel: ACPI: PCI interrupt for device 0000:00:1d.1 disabled\nkernel: uhci_hcd 0000:00:1d.0: remove, state 1\nkernel: usb usb1: USB disconnect, address 1\nkernel: usb 1-1: USB disconnect, address 4\nkernel: uhci_hcd 0000:00:1d.0: USB bus 1 deregistered\nkernel: ACPI: PCI interrupt for device 0000:00:1d.0 disabled\nkernel: Stopping tasks ... done.\nkernel: Suspending console(s)\nkernel: sky2 eth1: Link is up at 100 Mbps, full duplex, flow control both\nkernel: ADDRCONF(NETDEV_CHANGE): eth1: link becomes ready\nkernel: ACPI: PCI interrupt for device 0000:05:06.4 disabled\nkernel: ACPI: PCI interrupt for device 0000:05:06.3 disabled\nkernel: eth2: Going into suspend...\nkernel: ACPI: PCI interrupt for device 0000:05:04.0 disabled\nkernel: sky2 eth1: disabling interface\nkernel: ACPI: PCI interrupt for device 0000:00:1f.2 disabled\nkernel: ACPI: PCI interrupt for device 0000:00:1e.3 disabled\nkernel: ACPI: PCI interrupt for device 0000:00:1e.2 disabled\nkernel: ACPI: PCI interrupt for device 0000:00:1d.7 disabled\nkernel: Intel machine check architecture supported.\nkernel: Intel machine check reporting enabled on CPU#0.\nkernel: ACPI: PCI Interrupt 0000:00:02.0[A] -> Link [LNKA] -> GSI 11 (level, low) -> IRQ 11\nkernel: ACPI: PCI Interrupt 0000:00:1c.0[A] -> Link [LNKB] -> GSI 10 (level, low) -> IRQ 10\nkernel: ACPI: PCI Interrupt 0000:00:1c.1[B] -> Link [LNKA] -> GSI 11 (level, low) -> IRQ 11\nkernel: PCI: Enabling device 0000:00:1d.7 (0000 -> 0002)\nkernel: ACPI: PCI Interrupt 0000:00:1d.7[A] -> Link [LNKH] -> GSI 10 (level, low) -> IRQ 10\nkernel: ACPI: PCI Interrupt 0000:00:1e.2[A] -> Link [LNKB] -> GSI 10 (level, low) -> IRQ 10\nkernel: ACPI: PCI Interrupt 0000:00:1e.3[B] -> Link [LNKE] -> GSI 5 (level, low) -> IRQ 5\nkernel: ACPI: PCI Interrupt 0000:00:1f.2[B] -> Link [LNKD] -> GSI 11 (level, low) -> IRQ 11\nkernel: sky2 eth1: enabling interface\nkernel: sky2 eth1: ram buffer 4K\nkernel: eth2: Coming out of suspend...\nkernel: PCI: Enabling device 0000:05:04.0 (0000 -> 0002)\nkernel: ACPI: PCI Interrupt 0000:05:04.0[A] -> Link [LNKA] -> GSI 11 (level, low) -> IRQ 11\nkernel: ACPI: PCI Interrupt 0000:05:06.2[C] -> Link [LNKG] -> GSI 6 (level, low) -> IRQ 6\nkernel: ACPI: PCI Interrupt 0000:05:06.3[D] -> Link [LNKE] -> GSI 5 (level, low) -> IRQ 5\nkernel: ACPI: PCI Interrupt 0000:05:06.4[A] -> Link [LNKC] -> GSI 11 (level, low) -> IRQ 11\nkernel: ata1.00: configured for UDMA/100\nkernel: SCSI device sda: 195371568 512-byte hdwr sectors (100030 MB)\nkernel: sda: Write Protect is off\nkernel: SCSI device sda: write cache: enabled, read cache: enabled, doesn't support DPO or FUA\nkernel: sky2 eth1: Link is up at 100 Mbps, full duplex, flow control both\nkernel: ata2.00: configured for UDMA/33\nkernel: Restarting tasks ... done.\nkernel: ipw2200: Radio Frequency Kill Switch is On:\nkernel: Kill switch must be turned off for wireless networking to work.\nkernel: ohci1394: fw-host0: OHCI-1394 1.1 (PCI): IRQ=[11] MMIO=[b8000000-b80007ff]  Max Packet=[2048]  IR/IT contexts=[4/8]\nkernel: eth1394: eth0: IEEE-1394 IPv4 over 1394 Ethernet (fw-host0)\nkernel: USB Universal Host Controller Interface driver v3.0\nkernel: ACPI: PCI Interrupt 0000:00:1d.0[A] -> Link [LNKH] -> GSI 10 (level, low) -> IRQ 10\nkernel: uhci_hcd 0000:00:1d.0: UHCI Host Controller\nkernel: uhci_hcd 0000:00:1d.0: new USB bus registered, assigned bus number 1\nkernel: uhci_hcd 0000:00:1d.0: irq 10, io base 0x00001200\nkernel: usb usb1: configuration #1 chosen from 1 choice\nkernel: hub 1-0:1.0: USB hub found\nkernel: hub 1-0:1.0: 2 ports detected\nkernel: ACPI: PCI Interrupt 0000:00:1d.1[B] -> Link [LNKD] -> GSI 11 (level, low) -> IRQ 11\nkernel: uhci_hcd 0000:00:1d.1: UHCI Host Controller\nkernel: uhci_hcd 0000:00:1d.1: new USB bus registered, assigned bus number 2\nkernel: uhci_hcd 0000:00:1d.1: irq 11, io base 0x00001220\nkernel: usb usb2: configuration #1 chosen from 1 choice\nkernel: hub 2-0:1.0: USB hub found\nkernel: hub 2-0:1.0: 2 ports detected\nkernel: ACPI: PCI Interrupt 0000:00:1d.2[C] -> Link [LNKC] -> GSI 11 (level, low) -> IRQ 11\nkernel: uhci_hcd 0000:00:1d.2: UHCI Host Controller\nkernel: uhci_hcd 0000:00:1d.2: new USB bus registered, assigned bus number 3\nkernel: uhci_hcd 0000:00:1d.2: irq 11, io base 0x00001240\nkernel: usb usb3: configuration #1 chosen from 1 choice\nkernel: hub 3-0:1.0: USB hub found\nkernel: hub 3-0:1.0: 2 ports detected\nkernel: ACPI: PCI Interrupt 0000:00:1d.3[D] -> Link [LNKA] -> GSI 11 (level, low) -> IRQ 11\nkernel: uhci_hcd 0000:00:1d.3: UHCI Host Controller\nkernel: uhci_hcd 0000:00:1d.3: new USB bus registered, assigned bus number 4\nkernel: uhci_hcd 0000:00:1d.3: irq 11, io base 0x00001260\nkernel: usb usb4: configuration #1 chosen from 1 choice\nkernel: hub 4-0:1.0: USB hub found\nkernel: hub 4-0:1.0: 2 ports detected\nkernel: usb 1-1: new low speed USB device using uhci_hcd and address 2\nkernel: sky2 eth1: disabling interface\nkernel: sky2 eth1: enabling interface\nkernel: sky2 eth1: ram buffer 4K\nkernel: ADDRCONF(NETDEV_UP): eth1: link is not ready\nkernel: usb 1-1: configuration #1 chosen from 1 choice\nkernel: input: Microsoft Microsoft 3-Button Mouse with IntelliEye? as /class/input/input8\nkernel: input: USB HID v1.00 Mouse [Microsoft Microsoft 3-Button Mouse with IntelliEye?] on usb-0000:00:1d.0-1\nkernel: ADDRCONF(NETDEV_UP): eth2: link is not ready\nkernel: sky2 eth1: Link is up at 100 Mbps, full duplex, flow control both\nkernel: ADDRCONF(NETDEV_CHANGE): eth1: link becomes ready\ndhcdbd: message_handler: message handler not found under /com/redhat/dhcp/eth1 for sub-path eth1.dbus.get.host_name\ndhcdbd: message_handler: message handler not found under /com/redhat/dhcp/eth1 for sub-path eth1.dbus.get.domain_name\ndhcdbd: message_handler: message handler not found under /com/redhat/dhcp/eth1 for sub-path eth1.dbus.get.nis_domain\ndhcdbd: message_handler: message handler not found under /com/redhat/dhcp/eth1 for sub-path eth1.dbus.get.nis_servers\ngconfd (yamane-5230): starting (versão 2.16.1), pid 5230 user 'yamane'\ngconfd (yamane-5230): Address \"xml:readonly:/etc/gconf/gconf.xml.mandatory\" resolved from a config source with only read permissions in position 0\ngconfd (yamane-5230): Address \"xml:readwrite:/home/yamane/.gconf\" resolved from a config source with write permissions in positiono 1\ngconfd (yamane-5230): Address \"xml:readonly:/etc/gconf/gconf.xml.defaults\" resolved from a config source with only read permissions in position 2\ngconfd (yamane-5230): Address \"xml:readonly:/var/lib/gconf/debian.defaults\" resolved from a config source with only read permissions in position 3\ngconfd (yamane-5230): Address \"xml:readonly:/var/lib/gconf/defaults\" resolved from a config source with only read permissions in position 4", "patch": ["Subject: sky2: fix transmit state on resume\n\nAfter resume, driver has reset the chip so the current state\nof transmit checksum offload state machine and DMA state machine\nwill be undefined.\n\nThe fix is to set the state so that first Tx will set MSS and offset\nvalues.\n\nSigned-off-by: Stephen Hemminger <shemminger@linux-foundation.org>\n\n--- a/drivers/net/sky2.c\t2007-09-27 08:45:13.000000000 -0700\n+++ b/drivers/net/sky2.c\t2007-09-27 09:39:49.000000000 -0700\n@@ -910,6 +910,20 @@ static inline struct sky2_tx_le *get_tx_\n \treturn le;\n }\n \n+static void tx_init(struct sky2_port *sky2)\n+{\n+\tstruct sky2_tx_le *le;\n+\n+\tsky2->tx_prod = sky2->tx_cons = 0;\n+\tsky2->tx_tcpsum = 0;\n+\tsky2->tx_last_mss = 0;\n+\n+\tle = get_tx_le(sky2);\n+\tle->addr = 0;\n+\tle->opcode = OP_ADDR64 | HW_OWNER;\n+\tsky2->tx_addr64 = 0;\n+}\n+\n static inline struct tx_ring_info *tx_le_re(struct sky2_port *sky2,\n \t\t\t\t\t    struct sky2_tx_le *le)\n {\n@@ -1320,7 +1334,8 @@ static int sky2_up(struct net_device *de\n \t\t\t\tGFP_KERNEL);\n \tif (!sky2->tx_ring)\n \t\tgoto err_out;\n-\tsky2->tx_prod = sky2->tx_cons = 0;\n+\n+\ttx_init(sky2);\n \n \tsky2->rx_le = pci_alloc_consistent(hw->pdev, RX_LE_BYTES,\n \t\t\t\t\t   &sky2->rx_le_map);\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Power Management", "Classification": "Unclassified", "Component": "Hibernation/Suspend", "Hardware": "All Linux", "Importance": "P1 normal", "Assignee": "Stephen Hemminger", "URL": "", "Keywords": "", "Duplicates (1)": "9089", "Depends on": "", "Blocks": "", "Reported": "2007-06-24 14:51 UTC by Renato S. Yamane", "Modified": "2009-04-02 04:47 UTC", "CC List": "6 users", "See Also": "", "Kernel Version": "2.6.21", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/net/sky2.c"], "methods": ["sky2_up"]}
{"id": "8569", "title": "no touchpad since kernel 2.6.18", "description": "Most recent kernel where this bug did *NOT* occur: 2.6.18\nDistribution: gentoo\nHardware Environment: amd64\nProblem Description: \ni can't find a touchpad in /proc/bus/input/devices since kernel 2.6.18 anymore.\ni've tried kernel 2.6.19 to 2.6.22-rc3 (suspend2, gentoo & vanilla).\nevdev and psmouse modules are loaded. i don't think it's a configuration issue,\nsince recent livecd distros work neither. a clue?\n\noutput of /proc/bus/input/devices on kernel 2.6.18:\nI: Bus=0011 Vendor=0001 Product=0001 Version=ab41\nN: Name=\"AT Translated Set 2 keyboard\"\nP: Phys=isa0060/serio0/input0\nS: Sysfs=/class/input/input0\nH: Handlers=kbd\nB: EV=120013\nB: KEY=402000000 3802078f840d001 feffffdfffefffff fffffffffffffffe\nB: MSC=10\nB: LED=7\n\nI: Bus=0011 Vendor=0002 Product=0007 Version=0000\nN: Name=\"SynPS/2 Synaptics TouchPad\"\nP: Phys=isa0060/serio1/input0\nS: Sysfs=/class/input/input1\nH: Handlers=mouse0\nB: EV=b\nB: KEY=6420 70000 0 0 0 0\nB: ABS=11000003\n\n\noutput of /proc/bus/input/devices on kernel 2.6.21:\nI: Bus=0011 Vendor=0001 Product=0001 Version=ab41\nN: Name=\"AT Translated Set 2 keyboard\"\nP: Phys=isa0060/serio0/input0\nS: Sysfs=/class/input/input0\nH: Handlers=kbd event0\nB: EV=120013\nB: KEY=402000000 3802078f840d001 feffffdfffefffff fffffffffffffffe\nB: MSC=10\nB: LED=7\n\nI: Bus=0019 Vendor=0000 Product=0002 Version=0000\nN: Name=\"Power Button (FF)\"\nP: Phys=button_power/button/input0\nS: Sysfs=/class/input/input1\nH: Handlers=kbd event1\nB: EV=3\nB: KEY=10000000000000 0\n\nI: Bus=0019 Vendor=0000 Product=0003 Version=0000\nN: Name=\"Sleep Button (CM)\"\nP: Phys=PNP0C0E/button/input0\nS: Sysfs=/class/input/input2\nH: Handlers=kbd event2\nB: EV=3\nB: KEY=4000 0 0\n\nI: Bus=0019 Vendor=0000 Product=0005 Version=0000\nN: Name=\"Lid Switch\"\nP: Phys=PNP0C0D/button/input0\nS: Sysfs=/class/input/input3\nH: Handlers=event3\nB: EV=21\nB: SW=1\n\n\noutput lspci:\n00:00.0 Host bridge: ATI Technologies Inc RS480 Host Bridge (rev 10)\n00:01.0 PCI bridge: ATI Technologies Inc RS480 PCI Bridge\n00:10.0 CardBus bridge: Texas Instruments PCIxx21/x515 Cardbus Controller\n00:10.2 FireWire (IEEE 1394): Texas Instruments OHCI Compliant IEEE 1394 Host\nController\n00:10.3 Mass storage controller: Texas Instruments PCIxx21 Integrated FlashMedia\nController\n00:10.4 Class 0805: Texas Instruments PCI6411, PCI6421, PCI6611, PCI6621,\nPCI7411, PCI7421, PCI7611, PCI7621 Secure Digital (SD) Controller\n00:11.0 Network controller: RaLink RT2500 802.11g Cardbus/mini-PCI (rev 01)\n00:12.0 Ethernet controller: Realtek Semiconductor Co., Ltd. RTL-8169 Gigabit\nEthernet (rev 10)\n00:18.0 Host bridge: Advanced Micro Devices [AMD] K8 [Athlon64/Opteron]\nHyperTransport Technology Configuration\n00:18.1 Host bridge: Advanced Micro Devices [AMD] K8 [Athlon64/Opteron] Address Map\n00:18.2 Host bridge: Advanced Micro Devices [AMD] K8 [Athlon64/Opteron] DRAM\nController\n00:18.3 Host bridge: Advanced Micro Devices [AMD] K8 [Athlon64/Opteron]\nMiscellaneous Control\n00:19.0 PCI bridge: ALi Corporation M5249 HTT to PCI Bridge\n00:1c.0 USB Controller: ALi Corporation USB 1.1 Controller (rev 03)\n00:1c.1 USB Controller: ALi Corporation USB 1.1 Controller (rev 03)\n00:1c.2 USB Controller: ALi Corporation USB 1.1 Controller (rev 03)\n00:1c.3 USB Controller: ALi Corporation USB 2.0 Controller (rev 01)\n00:1d.0 Audio device: ALi Corporation High Definition Audio/AC'97 Host Controller\n00:1e.0 ISA bridge: ALi Corporation PCI to LPC Controller (rev 31)\n00:1e.1 Bridge: ALi Corporation M7101 Power Management Controller [PMU]\n00:1f.0 IDE interface: ALi Corporation M5229 IDE (rev c7)\n01:05.0 VGA compatible controller: ATI Technologies Inc ATI Radeon XPRESS 200M\n5955 (PCIE)\n\ni tried the recent 2.6.22-rc3 kernel today - no success. i thought it's time to\nfile a bug now. thanks. best regards robert", "patch": ["Input: i8042 - add ULI EV4873 to noloop list\n\nThe box does not implement AUX LOOP command properly and so we\ncan't test for AUX IRQ delivery so blacklist it via DMI and\nassume that AUX port is present.\n\nSigned-off-by: Dmitry Torokhov <dtor@mail.ru>\n---\n drivers/input/serio/i8042-x86ia64io.h |    8 ++++++++\n 1 file changed, 8 insertions(+)\n\nIndex: linux/drivers/input/serio/i8042-x86ia64io.h\n===================================================================\n--- linux.orig/drivers/input/serio/i8042-x86ia64io.h\n+++ linux/drivers/input/serio/i8042-x86ia64io.h\n@@ -92,6 +92,14 @@ static struct dmi_system_id __initdata i\n \t\t\tDMI_MATCH(DMI_PRODUCT_VERSION, \"00\"),\n \t\t},\n \t},\n+\t\t/* AUX LOOP does not work properly */\n+\t\t.ident = \"ULI EV4873\",\n+\t\t.matches = {\n+\t\t\tDMI_MATCH(DMI_SYS_VENDOR, \"ULI\"),\n+\t\t\tDMI_MATCH(DMI_PRODUCT_NAME, \"EV4873\"),\n+\t\t\tDMI_MATCH(DMI_PRODUCT_VERSION, \"5a\"),\n+\t\t},\n+\t},\n \t{ }\n };\n \n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Input Devices", "Hardware": "i386 Linux", "Importance": "P2 normal", "Assignee": "Dmitry Torokhov", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2007-06-02 12:44 UTC by robert", "Modified": "2007-09-21 06:24 UTC", "CC List": "0 users", "See Also": "", "Kernel Version": "2.6.19", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/input/serio/i8042-x86ia64io.h"], "methods": ["i8042_dmi_noloop_table"]}
{"id": "8559", "title": "no smartbattery status on Laptop", "description": "Most recent kernel where this bug did *NOT* occur: none\nDistribution: Fedora 6\nHardware Environment: Kontron Revolution Weatherproof Laptop\nSoftware Environment: Stock standard environment.  All modules are Fedora\ndistribution. Updated to latest.\nProblem Description: No samrtbattery entry in /proc/acpi/battery\n\nHave a specialised weatherproof laptop with a smartbattery running FC6\nlatest kernel. I cannot get battey monitoring going. Have loaded\nmodules i2c_ec and sbs with out any errors.\n\nlog/messages indicate that the EC driver loads with\nACPI: EC HC smbus [SMB1]\n\nThere is nothing from the sbs module though it is loaded and\nthe /proc/acpi/battery directory is empty.\n\nThe smartbattery can be recognized. If I run the following command ...\n\n   smartbattery 1             (1 is to specify the i2c dev,\n                            needs i2c-dev module loaded)\n\nthen I get battery status, which behaves properly (changes if I unplug\nAC etc). It shows Battery name, status , charge or discharge current,\ntime to full/left, temperature etc.  The smartbattery command came\nwith the initial code exploring the ec-smbus interface a couple of\nyears ago by Bruno Ducrot.\n \nHowever nothing shows up in the proc/acpi/battery directory under the\nsbs module, and therefore the gui battery indicators do not work\n\nAny suggestions?\n\nLove to get this working in the gui.\n\nPosted this to acpi group, and Alexey Starikovskiy asked me to post here with\noutput from acpidump will be attached next\n\nJohn", "patch": ["Connect SBS to SMBus host controller.\n\nFrom: Alexey Starikovskiy <aystarik@gmail.com>\n\n\n---\n\n drivers/acpi/sbs.c |   33 +++++++--------------------------\n 1 files changed, 7 insertions(+), 26 deletions(-)\n\ndiff --git a/drivers/acpi/sbs.c b/drivers/acpi/sbs.c\nindex c1bae10..974d00c 100644\n--- a/drivers/acpi/sbs.c\n+++ b/drivers/acpi/sbs.c\n@@ -127,7 +127,7 @@ static int acpi_sbs_resume(struct acpi_device *device);\n static struct acpi_driver acpi_sbs_driver = {\n \t.name = \"sbs\",\n \t.class = ACPI_SBS_CLASS,\n-\t.ids = ACPI_SBS_HID,\n+\t.ids = \"ACPI0001,ACPI0005\",\n \t.ops = {\n \t\t.add = acpi_sbs_add,\n \t\t.remove = acpi_sbs_remove,\n@@ -176,10 +176,8 @@ struct acpi_battery {\n };\n \n struct acpi_sbs {\n-\tacpi_handle handle;\n \tint base;\n \tstruct acpi_device *device;\n-\tstruct acpi_ec_smbus *smbus;\n \tstruct mutex mutex;\n \tint sbsm_present;\n \tint sbsm_batteries_supported;\n@@ -511,7 +509,7 @@ static int acpi_sbsm_get_info(struct acpi_sbs *sbs)\n \t\t\t\t\"acpi_sbs_read_word() failed\"));\n \t\tgoto end;\n \t}\n-\n+\tsbs->sbsm_present = 1;\n \tsbs->sbsm_batteries_supported = battery_system_info & 0x000f;\n \n       end:\n@@ -1630,13 +1628,12 @@ static int acpi_sbs_add(struct acpi_device *device)\n {\n \tstruct acpi_sbs *sbs = NULL;\n \tint result = 0, remove_result = 0;\n-\tunsigned long sbs_obj;\n \tint id;\n \tacpi_status status = AE_OK;\n \tunsigned long val;\n \n \tstatus =\n-\t    acpi_evaluate_integer(device->parent->handle, \"_EC\", NULL, &val);\n+\t    acpi_evaluate_integer(device->handle, \"_EC\", NULL, &val);\n \tif (ACPI_FAILURE(status)) {\n \t\tACPI_EXCEPTION((AE_INFO, AE_ERROR, \"Error obtaining _EC\"));\n \t\treturn -EIO;\n@@ -1653,7 +1650,7 @@ static int acpi_sbs_add(struct acpi_device *device)\n \n \tsbs_mutex_lock(sbs);\n \n-\tsbs->base = (val & 0xff00ull) >> 8;\n+\tsbs->base = 0xff & (val >> 8);\n \tsbs->device = device;\n \n \tstrcpy(acpi_device_name(device), ACPI_SBS_DEVICE_NAME);\n@@ -1665,24 +1662,10 @@ static int acpi_sbs_add(struct acpi_device *device)\n \t\tACPI_EXCEPTION((AE_INFO, AE_ERROR, \"acpi_ac_add() failed\"));\n \t\tgoto end;\n \t}\n-\tstatus = acpi_evaluate_integer(device->handle, \"_SBS\", NULL, &sbs_obj);\n-\tif (status) {\n-\t\tACPI_EXCEPTION((AE_INFO, status,\n-\t\t\t\t\"acpi_evaluate_integer() failed\"));\n-\t\tresult = -EIO;\n-\t\tgoto end;\n-\t}\n-\tif (sbs_obj > 0) {\n-\t\tresult = acpi_sbsm_get_info(sbs);\n-\t\tif (result) {\n-\t\t\tACPI_EXCEPTION((AE_INFO, AE_ERROR,\n-\t\t\t\t\t\"acpi_sbsm_get_info() failed\"));\n-\t\t\tgoto end;\n-\t\t}\n-\t\tsbs->sbsm_present = 1;\n-\t}\n \n-\tif (sbs->sbsm_present == 0) {\n+\tacpi_sbsm_get_info(sbs);\n+\n+\tif (!sbs->sbsm_present) {\n \t\tresult = acpi_battery_add(sbs, 0);\n \t\tif (result) {\n \t\t\tACPI_EXCEPTION((AE_INFO, AE_ERROR,\n@@ -1702,8 +1685,6 @@ static int acpi_sbs_add(struct acpi_device *device)\n \t\t}\n \t}\n \n-\tsbs->handle = device->handle;\n-\n \tinit_timer(&sbs->update_timer);\n \tresult = acpi_check_update_proc(sbs);\n \tif (result)\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "Power-Battery", "Hardware": "i386 Linux", "Importance": "P2 normal", "Assignee": "acpi_power-battery", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2007-05-31 15:43 UTC by John Floyd", "Modified": "2007-07-25 23:01 UTC", "CC List": "0 users", "See Also": "", "Kernel Version": "2.6.20", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/acpi/sbs.c"], "methods": ["acpi_sbsm_get_info", "acpi_sbs_add", "acpi_sbs", "acpi_sbs_driver"]}
{"id": "8535", "title": "USB input death then system freeze", "description": "Most recent kernel where this bug did *NOT* occur: pre 2.6.21 mm kernels, non-mm\n2.6.22-rc2\nDistribution: Fedora Devel\nHardware Environment: EHCI input on external powered hub with CK804 mainboard\nSoftware Environment: Nothing specific\nProblem Description:\n\nAfter a few hours of activity 2.6.22-rc1-mm1 and 2.6.22-rc2-mm1 will lose USB\nHID INPUT (keyboard or mice with no priority), then the system will freeze\n\nIf the mouse/tackball is lost first switching to the console and moving the ball\nwill output random text. Restarting gpm will rescue the mouse (but the system\nwill lock up soon after anyway)\n\nSame system with similar config works fine with mainline or older mm kernels\n\nLast trace capture in logs before lockup:\n\nKernel:\ndrivers/hid/usbhid/hid-core.c: input irq status -75 received\n\nXorg:\nProcXCloseDevice to close or not ?\nProcXCloseDevice to close or not ?\n(II) nek4k-enhanced-usb-0000:00:02.1-8.1/input1: Off\n(II) track-expl-usb-0000:00:02.1-8.3/input0: Off\n\n\nSteps to reproduce:\nJust run the system for some time", "patch": ["--- linux-2.6.22-rc1-mm1-orig/drivers/usb/host/ehci-sched.c\t2007-07-30 06:07:11.000000000 -0500\n+++ linux-2.6.22-rc1-mm1/drivers/usb/host/ehci-sched.c\t2007-07-30 08:39:54.000000000 -0500\n@@ -547,6 +547,19 @@ static void qh_inactivate_split_intr_qhs\n \twmb();\n }\n \n+static inline struct ehci_qtd *current_qtd (struct ehci_qh *qh)\n+{\n+\tstruct list_head\t*entry, *tmp;\n+\tstruct ehci_qtd\t\t*qtd;\n+\n+\tlist_for_each_safe (entry, tmp, &qh->qtd_list) {\n+\t\tqtd = list_entry (entry, struct ehci_qtd, qtd_list);\n+\t\tif (cpu_to_le32 (qtd->qtd_dma) == qh->hw_current)\n+\t\t\treturn qtd;\n+\t}\n+\treturn NULL;\n+}\n+\n static void qh_reactivate_split_intr_qhs (struct ehci_hcd *ehci)\n {\n \tstruct ehci_qh\t*qh;\n@@ -566,12 +579,21 @@ static void qh_reactivate_split_intr_qhs\n \t\t\tif (safe == 0) {\n \t\t\t\tnot_done = 1;\n \t\t\t} else if (safe > 0) {\n+\t\t\t\tstruct ehci_qtd *qtd;\n+\n \t\t\t\t/* See EHCI 1.0 section 4.15.2.4. */\n+\t\t\t\tqtd = current_qtd(qh);\t\n \t\t\t\ttoken = qh->hw_token;\n \t\t\t\tqh->hw_token = (token | HALT_BIT) & ~ACTIVE_BIT;\n \t\t\t\twmb();\n \t\t\t\tqh->hw_info1 &= ~INACTIVATE_BIT;\n \t\t\t\twmb();\n+\t\t\t\t/*\n+\t\t\t\t * nVidia controllers write overlay back to qtd\n+\t\t\t\t * when qh is inactivated, so reactivate it too.\n+\t\t\t\t */\n+\t\t\t\tif (qtd)\n+\t\t\t\t\tqtd->hw_token = token | qh->was_active;\n \t\t\t\tqh->hw_token = (token & ~HALT_BIT) | qh->was_active;\n \t\t\t}\n \t\t}\n", "--- linux-2.6.22-rc1-mm1-orig/drivers/usb/host/ehci-sched.c\t2007-07-30 06:07:11.000000000 -0500\n+++ linux-2.6.22-rc1-mm1/drivers/usb/host/ehci-sched.c\t2007-07-30 08:39:54.000000000 -0500\n@@ -547,6 +547,19 @@ static void qh_inactivate_split_intr_qhs\n \twmb();\n }\n \n+static inline struct ehci_qtd *current_qtd (struct ehci_qh *qh)\n+{\n+\tstruct list_head\t*entry, *tmp;\n+\tstruct ehci_qtd\t\t*qtd;\n+\n+\tlist_for_each_safe (entry, tmp, &qh->qtd_list) {\n+\t\tqtd = list_entry (entry, struct ehci_qtd, qtd_list);\n+\t\tif (cpu_to_le32 (qtd->qtd_dma) == qh->hw_current)\n+\t\t\treturn qtd;\n+\t}\n+\treturn NULL;\n+}\n+\n static void qh_reactivate_split_intr_qhs (struct ehci_hcd *ehci)\n {\n \tstruct ehci_qh\t*qh;\n@@ -566,12 +582,21 @@ static void qh_reactivate_split_intr_qhs\n \t\t\tif (safe == 0) {\n \t\t\t\tnot_done = 1;\n \t\t\t} else if (safe > 0) {\n+\t\t\t\tstruct ehci_qtd *qtd;\n+\n \t\t\t\t/* See EHCI 1.0 section 4.15.2.4. */\n+\t\t\t\tqtd = current_qtd(qh);\t\n \t\t\t\ttoken = qh->hw_token;\n \t\t\t\tqh->hw_token = (token | halt) & ~active;\n \t\t\t\twmb();\n \t\t\t\tqh->hw_info1 &= ~inactivate;\n \t\t\t\twmb();\n+\t\t\t\t/*\n+\t\t\t\t * nVidia controllers write overlay back to qtd\n+\t\t\t\t * when qh is inactivated, so reactivate it too.\n+\t\t\t\t */\n+\t\t\t\tif (qtd)\n+\t\t\t\t\tqtd->hw_token = token | qh->was_active;\n \t\t\t\tqh->hw_token = (token & ~halt) | qh->was_active;\n \t\t\t}\n \t\t}\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Input Devices", "Hardware": "i386 Linux", "Importance": "P2 normal", "Assignee": "Andrew Morton", "URL": "", "Keywords": "", "Duplicates (1)": "8534", "Depends on": "", "Blocks": "", "Reported": "2007-05-24 11:02 UTC by Nicolas Mailhot", "Modified": "2008-09-23 11:18 UTC", "CC List": "9 users", "See Also": "", "Kernel Version": "2.6.23-rc1", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/usb/host/ehci-sched.c"], "methods": ["qh_reactivate_split_intr_qhs"]}
{"id": "8450", "title": "ip6sic causes bug during interrupt handling", "description": "Most recent kernel where this bug did *NOT* occur: had this since 2.6.20, didnt\ntest earlier versions\nDistribution: gentoo\nHardware Environment: p3\nSoftware Environment: gcc 4.1.2\nProblem Description:\n\nrunning ip6sic with the following seed\n\nip6sic -i lo -d ::1 -p 2000 -r 32321\n\ncauses this oops\n\n[   69.293000] Oops: 0000 [#1]\n[   69.293000] PREEMPT \n[   69.293000] Modules linked in:\n[   69.293000] CPU:    0\n[   69.293000] EIP:    0060:[<c0548b76>]    Not tainted VLI\n[   69.293000] EFLAGS: 00010282   (2.6.21-ga989705c #7)\n[   69.293000] EIP is at ipv6_hop_jumbo+0x26/0x180\n[   69.293000] eax: 00000000   ebx: ce61bc08   ecx: 00000001   edx: 00000103\n[   69.293000] esi: ce750166   edi: 000000fd   ebp: c0773ed8   esp: c0773ec0\n[   69.293000] ds: 007b   es: 007b   fs: 0000  gs: 0033  ss: 0068\n[   69.293000] Process ip6sic (pid: 4607, ti=c0773000 task=cf332070\ntask.ti=cf002000)\n[   69.293000] Stack: c06c4ccc 000000fb c0773ef8 00000246 c071ae9c 0000002a\nc0773f08 c054837f \n[   69.293000]        ce61bc08 c055a39d c0773f38 c071ae94 ce61bc08 ce75013c\n00000306 ce61bc08 \n[   69.293000]        c0773f38 ce61bc44 c0773f18 c0548ed1 00000000 cf8bdd84\nc0773f48 c052807e \n[   69.293000] Call Trace:\n[   69.293000]  [<c010485a>] show_trace_log_lvl+0x1a/0x30\n[   69.293000]  [<c0104919>] show_stack_log_lvl+0xa9/0xd0\n[   69.293000]  [<c0104b5b>] show_registers+0x21b/0x3a0\n[   69.293000]  [<c0104de3>] die+0x103/0x260\n[   69.293000]  [<c01162c2>] do_page_fault+0x2d2/0x610\n[   69.293000]  [<c05a5732>] error_code+0x6a/0x70\n[   69.293000]  [<c054837f>] ip6_parse_tlv+0xef/0x130\n[   69.293000]  [<c0548ed1>] ipv6_parse_hopopts+0x41/0xb0\n[   69.293000]  [<c052807e>] ipv6_rcv+0x1be/0x370\n[   69.293000]  [<c04b32fb>] netif_receive_skb+0x21b/0x2b0\n[   69.293000]  [<c04b52d2>] process_backlog+0x82/0xf0\n[   69.293000]  [<c04b558b>] net_rx_action+0xab/0x1c0\n[   69.293000]  [<c0120cd2>] __do_softirq+0x72/0xe0\n[   69.293000]  [<c010627a>] do_softirq+0x8a/0xf0\n[   69.293000]  [<c0120fd5>] local_bh_enable+0xa5/0x160\n[   69.293000]  [<c04b5738>] dev_queue_xmit+0x98/0x330\n[   69.293000]  [<c055a678>] packet_sendmsg+0x208/0x260\n[   69.293000]  [<c04a8594>] sock_sendmsg+0xc4/0xf0\n[   69.293000]  [<c04a889f>] sys_sendto+0xbf/0xe0\n[   69.293000]  [<c04a97c7>] sys_socketcall+0x187/0x260\n[   69.293000]  [<c0104132>] sysenter_past_esp+0x5f/0x99\n[   69.293000]  =======================\n[   69.293000] Code: 90 8d 74 26 00 55 89 e5 56 53 83 ec 10 8b 18 8b 4b 78 8d\n34 11 80 7e 01 04 74 3b a1 10 3c 72 c0 85 c0 0f 85 7d 00 00 00 8b 43 1c <8b>\n80 8c 00 00 00 85 c0 74 09 8b 80 38 01 00 00 ff 40 08 a1 e4 \n[   69.293000] EIP: [<c0548b76>] ipv6_hop_jumbo+0x26/0x180 SS:ESP\n0068:c0773ec0\n[   69.305000] Kernel panic - not syncing: Fatal exception in interrupt\n\n\n\nSteps to reproduce:", "patch": ["--- linux-2.6/include/net/ip6_fib.h.orig\t2007-05-08 01:10:35.000000000 +0200\n+++ linux-2.6/include/net/ip6_fib.h\t2007-05-08 01:10:59.000000000 +0200\n@@ -109,6 +109,9 @@ struct rt6_info\n \n static inline struct inet6_dev *ip6_dst_idev(struct dst_entry *dst)\n {\n+\tif (!dst)\n+\t\treturn NULL;\n+\n \treturn ((struct rt6_info *)dst)->rt6i_idev;\n }\n \n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Networking", "Classification": "Unclassified", "Component": "IPV6", "Hardware": "i386 Linux", "Importance": "P2 normal", "Assignee": "Hideaki YOSHIFUJI", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2007-05-08 02:47 UTC by Eric Sesterhenn", "Modified": "2007-07-15 11:13 UTC", "CC List": "1 user", "See Also": "", "Kernel Version": "2.6.21", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["include/net/ip6_fib.h"], "methods": ["*ip6_dst_idev"]}
{"id": "8381", "title": "(net forcedeth) doesn't wol on suspend", "": "Show dependency tree", "description": "Distribution: debian unstable\nHardware Environment: Athlon 3000+ on a K8N-E-Deluxe\nSoftware Environment: Linux 2.6.21-rc5\nProblem Description: The integrated NIC of my motherboard supports wol propertly\nwhen I hald my computer. But when I use suspend to ram or suspend to disk, wol\ndoesn't work anymore. \n\nSteps to reproduce:\n\nSteps that works :\n\n1/ power on the computer\n2/ boot linux\n3/ execute \"ethtool -s eth0 wol g\"\n4/ halt\n5/ send a magic packet with wakeonlan from another computer\n\nSteps that doesn't work :\n\n1/ power on the computer\n2/ boot linux\n3/ execute \"ethtool -s eth0 wol g\"\n4/ cat mem > /sys/power/state\n5/ send a magic packet with wakeonlan from another computer\n\nSame thing with s2disk.\n\nI'd like to use wol + suspend to ram.\n\n#lspci\nserver:/home/matthieu# lspci\n00:00.0 Host bridge: nVidia Corporation nForce3 250Gb Host Bridge (rev a1)\n00:01.0 ISA bridge: nVidia Corporation nForce3 250Gb LPC Bridge (rev a2)\n00:01.1 SMBus: nVidia Corporation nForce 250Gb PCI System Management (rev a1)\n00:02.0 USB Controller: nVidia Corporation CK8S USB Controller (rev a1)\n00:02.1 USB Controller: nVidia Corporation CK8S USB Controller (rev a1)\n00:02.2 USB Controller: nVidia Corporation nForce3 EHCI USB 2.0 Controller (rev a2)\n00:05.0 Bridge: nVidia Corporation CK8S Ethernet Controller (rev a2)\n00:06.0 Multimedia audio controller: nVidia Corporation nForce3 250Gb AC'97\nAudio Controller (rev a1)\n00:08.0 IDE interface: nVidia Corporation CK8S Parallel ATA Controller (v2.5)\n(rev a2)\n00:0a.0 IDE interface: nVidia Corporation CK8S Serial ATA Controller (v2.5) (rev a2)\n00:0b.0 PCI bridge: nVidia Corporation nForce3 250Gb AGP Host to PCI Bridge (rev a2)\n00:0e.0 PCI bridge: nVidia Corporation nForce3 250Gb PCI-to-PCI Bridge (rev a2)\n00:18.0 Host bridge: Advanced Micro Devices [AMD] K8 [Athlon64/Opteron]\nHyperTransport Technology Configuration\n00:18.1 Host bridge: Advanced Micro Devices [AMD] K8 [Athlon64/Opteron] Address Map\n00:18.2 Host bridge: Advanced Micro Devices [AMD] K8 [Athlon64/Opteron] DRAM\nController\n00:18.3 Host bridge: Advanced Micro Devices [AMD] K8 [Athlon64/Opteron]\nMiscellaneous Control\n01:00.0 VGA compatible controller: ATI Technologies Inc RV280 [Radeon 9200 SE]\n(rev 01)\n02:0a.0 Ethernet controller: 3Com Corporation 3c905B 100BaseTX [Cyclone] (rev 24)\n02:0b.0 FireWire (IEEE 1394): VIA Technologies, Inc. IEEE 1394 Host Controller\n(rev 80)\n02:0c.0 Mass storage controller: Silicon Image, Inc. SiI 3114\n[SATALink/SATARaid] Serial ATA Controller (rev 02)\n\nserver:/home/matthieu# lsmod\nModule                  Size  Used by\nnfs                   242008  0 \nnfsd                  253320  17 \nexportfs                6080  1 nfsd\nlockd                  65904  3 nfs,nfsd\nnfs_acl                 4160  2 nfs,nfsd\nsunrpc                172840  13 nfs,nfsd,lockd,nfs_acl\nppdev                   9864  0 \nlp                     13128  0 \ncpufreq_powersave       2368  1 \nbutton                  9568  0 \nac                      6536  0 \nbattery                11720  0 \next2                   63952  1 \nxfs                   485096  7 \nradeonfb              103552  1 \nfb_ddc                  3136  1 radeonfb\ni2c_algo_bit            8328  1 radeonfb\nit87                   23632  0 \nhwmon_vid               3328  1 it87\ni2c_isa                 6784  1 it87\neeprom                  8656  0 \npowernow_k8            11032  1 \nfreq_table              5320  1 powernow_k8\nsbp2                   23940  0 \nloop                   17872  0 \nanalog                 11424  0 \nsnd_intel8x0           36200  0 \nsnd_mpu401              9576  0 \nsnd_mpu401_uart         8896  1 snd_mpu401\nsnd_ac97_codec        110936  1 snd_intel8x0\ni2c_nforce2             6592  0 \nsnd_rawmidi            26080  1 snd_mpu401_uart\nsnd_seq_device          9044  1 snd_rawmidi\npsmouse                39760  0 \ngameport               16784  1 analog\nshpchp                 34460  0 \npci_hotplug            16520  1 shpchp\nac97_bus                3136  1 snd_ac97_codec\ni2c_core               24216  7\nradeonfb,fb_ddc,i2c_algo_bit,it87,i2c_isa,eeprom,i2c_nforce2\nparport_pc             36968  1 \nparport                39308  3 ppdev,lp,parport_pc\nserio_raw               7748  0 \npcspkr                  3456  0 \nsnd_pcm                82572  2 snd_intel8x0,snd_ac97_codec\nsnd_timer              23560  1 snd_pcm\nsnd                    60456  8\nsnd_intel8x0,snd_mpu401,snd_mpu401_uart,snd_ac97_codec,snd_rawmidi,snd_seq_device,snd_pcm,snd_timer\nsoundcore               8928  1 snd\nsnd_page_alloc         10768  2 snd_intel8x0,snd_pcm\nk8temp                  6656  0 \nevdev                  11328  0 \next3                  130640  1 \njbd                    57392  1 ext3\nmbcache                 9480  2 ext2,ext3\ndm_mirror              20416  0 \ndm_snapshot            17032  0 \ndm_mod                 59312  19 dm_mirror,dm_snapshot\nraid456               118560  1 \nmd_mod                 76188  3 raid456\nxor                     6288  1 raid456\nide_cd                 40672  0 \ncdrom                  36072  1 ide_cd\nide_disk               16832  3 \nsd_mod                 22040  10 \npata_amd               15584  0 \nsata_nv                22468  1 \nata_generic             9860  0 \nfloppy                 61640  0 \nsata_sil               13704  4 \nohci1394               34312  0 \nlibata                119656  4 pata_amd,sata_nv,ata_generic,sata_sil\nscsi_mod              155544  3 sbp2,sd_mod,libata\nieee1394              100408  2 sbp2,ohci1394\n3c59x                  46388  0 \nmii                     6272  1 3c59x\ngeneric                 6468  0 [permanent]\namd74xx                15728  0 [permanent]\nide_core              139744  4 ide_cd,ide_disk,generic,amd74xx\nforcedeth              46280  0 \nehci_hcd               32780  0 \nohci_hcd               20932  0 \nthermal                16400  0 \nprocessor              27004  2 powernow_k8,thermal\nfan                     6152  0", "patch": ["From 72cf6252abf9ddc18ad557791fed6d3134350a42 Mon Sep 17 00:00:00 2001\nFrom: Francois Romieu <romieu@fr.zoreil.com>\nDate: Mon, 4 Jun 2007 21:53:37 +0200\nSubject: [PATCH] forcedeth: power management fixes\n\nExtracted from Ayaz Abdulla's message on netdev the 21 of may 2007\n(see \"[PATCH 2/4] forcedeth: fix power management support\").\n---\n drivers/net/forcedeth.c |   58 ++++++++++++++++++++++++++++++++++++----------\n 1 files changed, 45 insertions(+), 13 deletions(-)\n\ndiff --git a/drivers/net/forcedeth.c b/drivers/net/forcedeth.c\nindex 4154fd0..393a497 100644\n--- a/drivers/net/forcedeth.c\n+++ b/drivers/net/forcedeth.c\n@@ -794,6 +794,10 @@ struct fe_priv {\n \n \t/* flow control */\n \tu32 pause_flags;\n+\n+\t/* power saved state */\n+\tu32 saved_config_space[64];\n+\tu32 saved_phyinterface;\n };\n \n /*\n@@ -5264,39 +5268,67 @@ static int nv_suspend(struct pci_dev *pdev, pm_message_t state)\n {\n \tstruct net_device *dev = pci_get_drvdata(pdev);\n \tstruct fe_priv *np = netdev_priv(dev);\n+\tu8 __iomem *base = get_hwbase(dev);\n \n-\tif (!netif_running(dev))\n-\t\tgoto out;\n-\n-\tnetif_device_detach(dev);\n+\tif (netif_running(dev)) {\n+\t\tnetif_device_detach(dev);\n \n-\t// Gross.\n-\tnv_close(dev);\n+\t\t/* bring down the adapter */\n+\t\tnv_close(dev);\n+\t}\n \n+\t/* save any device state */\n+\tnp->saved_phyinterface = readl(base + NvRegPhyInterface);\n \tpci_save_state(pdev);\n+\n \tpci_enable_wake(pdev, pci_choose_state(pdev, state), np->wolenabled);\n \tpci_set_power_state(pdev, pci_choose_state(pdev, state));\n-out:\n+\n \treturn 0;\n }\n \n static int nv_resume(struct pci_dev *pdev)\n {\n \tstruct net_device *dev = pci_get_drvdata(pdev);\n+\tstruct fe_priv *np = netdev_priv(dev);\n+\tu8 __iomem *base = get_hwbase(dev);\n \tint rc = 0;\n+\tu32 txreg;\n \n-\tif (!netif_running(dev))\n-\t\tgoto out;\n+\trc = pci_set_power_state(pdev, PCI_D0);\n+\tif (rc < 0)\n+\t\tgoto out_disable;\n \n-\tnetif_device_attach(dev);\n+\trc = pci_restore_state(pdev);\n+\tif (rc < 0)\n+\t\tgoto out_disable;\n \n-\tpci_set_power_state(pdev, PCI_D0);\n-\tpci_restore_state(pdev);\n \tpci_enable_wake(pdev, PCI_D0, 0);\n \n-\trc = nv_open(dev);\n+\t/* restore saved driver state */\n+\ttxreg = readl(base + NvRegTransmitPoll);\n+\ttxreg |= NVREG_TRANSMITPOLL_MAC_ADDR_REV;\n+\twritel(txreg, base + NvRegTransmitPoll);\n+\twritel(np->saved_phyinterface, base + NvRegPhyInterface);\n+\twritel(np->orig_mac[0], base + NvRegMacAddrA);\n+\twritel(np->orig_mac[1], base + NvRegMacAddrB);\n+\n+\t/* re-initialize the phy */\n+\tphy_init(dev);\n+\n+\tif (netif_running(dev)) {\n+\t\tnetif_device_attach(dev);\n+\n+\t\t/* bring up the adapter */\n+\t\trc = nv_open(dev);\n+\t}\n out:\n \treturn rc;\n+\n+out_disable:\n+\tpci_disable_device(pdev);\n+\tdev_err(&pdev->dev, \"resume failed (%d)\\n\", rc);\n+\tgoto out;\n }\n #else\n #define nv_suspend NULL\n-- \n1.5.2\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Network", "Hardware": "i386 Linux", "Importance": "P2 normal", "Assignee": "Ayaz Abdulla", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "7216", "Reported": "2007-04-27 14:51 UTC by Matthieu Baechler", "Modified": "2009-10-25 10:37 UTC", "CC List": "6 users", "See Also": "", "Kernel Version": "2.6.21", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/net/forcedeth.c"], "methods": ["nv_suspend", "fe_priv"]}
{"id": "8374", "title": "ACPI: Unable to turn cooling device [c146aec8] 'on'", "description": "Most recent kernel where this bug did *NOT* occur: None\nDistribution: Debian 4.0 - Etch (Final)\nHardware Environment: HP/Compaq nc6000 (laptop), Pentium M 1.6 GHz, Intel ICH4,\nATI Radeon Mobility 9600, 512 MB RAM, newest available BIOS\nSoftware Environment: Debian Etch, no self-compiled tools but the kernel\nProblem Description: This is gonna be quite a long but hopefully equally useful\ndescription:\nShortly after I bought the laptop and installed Linux on it, I noticed that it\nsometimes turned itself off while I was away and did not turn off the computer.\nIt took me quite a while to figure out what was wrong until the laptop shut down\nby itself while I was using it.\nThe kernel printed a message that a ACPI critical trip point was reached and\nshut the system down to prevent damage. After I knew there was a temperature\nproblem I wrote a script to log the temperatures and after it happend again I\nsaw that the temperatures suddenly started to rise from about 40", "patch": ["From: Thomas Renninger <trenn@suse.de>\n\nexport acpi_handle to user space doesn't make sense.\nuse the object name shown in ACPI namespace instead.\n\nSigned-off-by: Zhang Rui <rui.zhang@intel.com>\n---\n drivers/acpi/thermal.c |   33 +++++++++++++++++----------------\n 1 files changed, 17 insertions(+), 16 deletions(-)\n\nIndex: linux-2.6.21-rc5/drivers/acpi/thermal.c\n===================================================================\n--- linux-2.6.21-rc5.orig/drivers/acpi/thermal.c\t2007-03-26 14:24:41.000000000 +0800\n+++ linux-2.6.21-rc5/drivers/acpi/thermal.c\t2007-04-29 11:37:18.000000000 +0800\n@@ -586,7 +586,7 @@ static void acpi_thermal_active(struct a\n \tint i = 0;\n \tint j = 0;\n \tunsigned long maxtemp = 0;\n-\n+\tstruct acpi_device *device;\n \n \tif (!tz)\n \t\treturn;\n@@ -612,17 +612,17 @@ static void acpi_thermal_active(struct a\n \t\t\t\t    acpi_bus_set_power(active->devices.\n \t\t\t\t\t\t       handles[j],\n \t\t\t\t\t\t       ACPI_STATE_D0);\n+\t\t\t\tacpi_bus_get_device(active->devices.handles[j], &device);\n \t\t\t\tif (result) {\n \t\t\t\t\tprintk(KERN_WARNING PREFIX\n-\t\t\t\t\t\t      \"Unable to turn cooling device [%p] 'on'\\n\",\n-\t\t\t\t\t\t      active->devices.\n-\t\t\t\t\t\t      handles[j]);\n+\t\t\t\t\t\t      \"Unable to turn cooling device [%4.4s] 'on', result is %d\\n\",\n+\t\t\t\t\t\t      acpi_device_bid(device), result);\n \t\t\t\t\tcontinue;\n \t\t\t\t}\n \t\t\t\tactive->flags.enabled = 1;\n \t\t\t\tACPI_DEBUG_PRINT((ACPI_DB_INFO,\n-\t\t\t\t\t\t  \"Cooling device [%p] now 'on'\\n\",\n-\t\t\t\t\t\t  active->devices.handles[j]));\n+\t\t\t\t\t\t  \"Cooling device [%4.4s] now 'on'\\n\",\n+\t\t\t\t\t\t  acpi_device_bid(device)));\n \t\t\t}\n \t\t\tcontinue;\n \t\t}\n@@ -637,16 +637,17 @@ static void acpi_thermal_active(struct a\n \t\tfor (j = 0; j < active->devices.count; j++) {\n \t\t\tresult = acpi_bus_set_power(active->devices.handles[j],\n \t\t\t\t\t\t    ACPI_STATE_D3);\n+\t\t\tacpi_bus_get_device(active->devices.handles[j], &device);\n \t\t\tif (result) {\n \t\t\t\tprintk(KERN_WARNING PREFIX\n-\t\t\t\t\t      \"Unable to turn cooling device [%p] 'off'\\n\",\n-\t\t\t\t\t      active->devices.handles[j]);\n+\t\t\t\t\t      \"Unable to turn cooling device [%4.4s] 'off'\\n\",\n+\t\t\t\t\t      acpi_device_bid(device));\n \t\t\t\tcontinue;\n \t\t\t}\n \t\t\tactive->flags.enabled = 0;\n \t\t\tACPI_DEBUG_PRINT((ACPI_DB_INFO,\n \t\t\t\t\t  \"Cooling device [%p] now 'off'\\n\",\n-\t\t\t\t\t  active->devices.handles[j]));\n+\t\t\t\t\t  acpi_device_bid(device)));\n \t\t}\n \t}\n }\n@@ -840,7 +841,7 @@ static int acpi_thermal_trip_seq_show(st\n \tstruct acpi_thermal *tz = seq->private;\n \tint i = 0;\n \tint j = 0;\n-\n+\tstruct acpi_device *device;\n \n \tif (!tz)\n \t\tgoto end;\n@@ -860,9 +861,8 @@ static int acpi_thermal_trip_seq_show(st\n \t\t\t   tz->trips.passive.tc1, tz->trips.passive.tc2,\n \t\t\t   tz->trips.passive.tsp);\n \t\tfor (j = 0; j < tz->trips.passive.devices.count; j++) {\n-\n-\t\t\tseq_printf(seq, \"0x%p \",\n-\t\t\t\t   tz->trips.passive.devices.handles[j]);\n+\t\t\tacpi_bus_get_device(tz->trips.passive.devices.handles[j], &device);\n+\t\t\tseq_printf(seq, \"%4.4s \", acpi_device_bid(device));\n \t\t}\n \t\tseq_puts(seq, \"\\n\");\n \t}\n@@ -873,9 +873,10 @@ static int acpi_thermal_trip_seq_show(st\n \t\tseq_printf(seq, \"active[%d]:               %ld C: devices=\",\n \t\t\t   i,\n \t\t\t   KELVIN_TO_CELSIUS(tz->trips.active[i].temperature));\n-\t\tfor (j = 0; j < tz->trips.active[i].devices.count; j++)\n-\t\t\tseq_printf(seq, \"0x%p \",\n-\t\t\t\t   tz->trips.active[i].devices.handles[j]);\n+\t\tfor (j = 0; j < tz->trips.active[i].devices.count; j++) {\n+\t\t\tacpi_bus_get_device(tz->trips.active[i].devices.handles[j], &device);\n+\t\t\tseq_printf(seq, \"%4.4s \", acpi_device_bid(device));\n+\t\t}\n \t\tseq_puts(seq, \"\\n\");\n \t}\n \n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "Power-Fan", "Hardware": "i386 Linux", "Importance": "P2 normal", "Assignee": "Zhang Rui", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2007-04-27 01:16 UTC by Peter Ganzhorn", "Modified": "2008-08-07 21:04 UTC", "CC List": "3 users", "See Also": "", "Kernel Version": "2.6.21", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/acpi/thermal.c"], "methods": ["acpi_thermal_active", "acpi_thermal_trip_seq_show"]}
{"id": "8269", "title": "pnp: Failed to activate device 00:0a - Samsung P35 XVM 1600 III", "description": "Most recent kernel where this bug did *NOT* occur: did occur since S3 works on P35\nDistribution: Gentoo 2006.1\nHardware Environment: Samsung P35 XVM 1600 III\nSoftware Environment:\nProblem Description:\nAfter doing the 2nd resume cycle after S3 dmesg shows this:\n\n1st S3:\npnp: Device 00:08 disabled.\npnp: Device 00:06 disabled.\n1st Resume:\nBoth gets activated.\n\n2nd S3:\npnp: Device 00:08 disabled.\npnp: Device 00:06 disabled.\n2nd Resume:\npnp: Evaluate _CRS failed\npnp: Failed to activate device 00:06.\npnp: Evaluate _CRS failed\npnp: Failed to activate device 00:08.\npnp: Device 00:09 does not support activation.\npnp: Failed to activate device 00:0a.\n\nFor every S3 & Resume again the last messages are there again.\nAlso my irda (nsc_ircc) does not work anymore after second resume as the chip\ntype is wrong now, at first boot its all ok.\n\nSteps to reproduce:\n\nTake a P35 and do two S3 & Resume Cycles. Happens all the time.\n\nkind regards\n\nTorsten", "patch": ["PNP_WRITE requires protocol supports .set. If ACPI doesn't support _SRS, .set ismeanless, so PNP_WRITE.\n\nSigned-off-by: Shaohua Li <shaohua.li@intel.com>\n\n---\n drivers/pnp/pnpacpi/core.c |    2 +-\n 1 file changed, 1 insertion(+), 1 deletion(-)\n\nIndex: linux/drivers/pnp/pnpacpi/core.c\n===================================================================\n--- linux.orig/drivers/pnp/pnpacpi/core.c\t2007-10-19 17:00:43.000000000 +0800\n+++ linux/drivers/pnp/pnpacpi/core.c\t2007-11-15 09:18:18.000000000 +0800\n@@ -183,7 +183,7 @@ static int __init pnpacpi_add_device(str\n \tif (ACPI_SUCCESS(status))\n \t\tdev->capabilities |= PNP_CONFIGURABLE;\n \tdev->capabilities |= PNP_READ;\n-\tif (device->flags.dynamic_status)\n+\tif (device->flags.dynamic_status && (dev->capabilities & PNP_CONFIGURABLE))\n \t\tdev->capabilities |= PNP_WRITE;\n \tif (device->flags.removable)\n \t\tdev->capabilities |= PNP_REMOVABLE;\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "Power-Sleep-Wake", "Hardware": "i386 Linux", "Importance": "P2 normal", "Assignee": "Shaohua", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2007-03-27 06:07 UTC by Torsten Krah", "Modified": "2008-02-10 14:22 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "2.6.20", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/pnp/pnpacpi/core.c"], "methods": ["pnpacpi_add_device"]}
{"id": "8262", "title": "PCMCIA: socket *** DANGER *** unable to remove socket power", "description": "Most recent kernel where this bug did *NOT* occur: I don't know any.\nDistribution: Debian Etch\nHardware Environment: Thinkpad T41p\nSoftware Environment: pccardctl eject\nProblem Description: \n\nThe command \"pccardctl eject\" gives the following warning:\n\nkernel: PCMCIA: socket f793c428: *** DANGER *** unable to remove socket power\n\nIt seems that this warning is wrong, because the pcmcia-card is offline. (LED \nis off.)\n\nSteps to reproduce:\nInserting a pcmcia-card (I use the merlin u740.) and after this use \"pccardctl \neject\". If I remove the card without pccardctl eject I get no warning from the \nkernel.\n\ncat /proc/iomem  | grep -C1 yenta\nb0000000-b0000fff : 0000:02:00.0\n  b0000000-b0000fff : yenta_socket\nb1000000-b1000fff : 0000:02:00.1\n  b1000000-b1000fff : yenta_socket\n\nlspci -vv  | grep -A14 Card\n02:00.0 CardBus bridge: Texas Instruments PCI4520 PC card Cardbus Controller \n(rev 01)\n        Subsystem: IBM Unknown device 0552\n        Control: I/O+ Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr- \nStepping- SERR- FastB2B-\n        Status: Cap+ 66MHz- UDF- FastB2B- ParErr- DEVSEL=medium >TAbort- \n<TAbort- <MAbort- >SERR- <PERR-\n        Latency: 168, Cache Line Size: 64 bytes\n        Interrupt: pin A routed to IRQ 11\n        Region 0: Memory at b0000000 (32-bit, non-prefetchable) [size=4K]\n        Bus: primary=02, secondary=03, subordinate=06, sec-latency=176\n        Memory window 0: e8000000-ebfff000 (prefetchable)\n        Memory window 1: c4000000-c7fff000\n        I/O window 0: 00004000-000040ff\n        I/O window 1: 00004400-000044ff\n        BridgeCtl: Parity- SERR- ISA- VGA- MAbort- >Reset+ 16bInt+ PostWrite+\n        16-bit legacy interface ports at 0001\n\n02:00.1 CardBus bridge: Texas Instruments PCI4520 PC card Cardbus Controller \n(rev 01)\n        Subsystem: IBM Unknown device 0552\n        Control: I/O+ Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr- \nStepping- SERR- FastB2B-\n        Status: Cap+ 66MHz- UDF- FastB2B- ParErr- DEVSEL=medium >TAbort- \n<TAbort- <MAbort- >SERR- <PERR-\n        Latency: 168, Cache Line Size: 64 bytes\n        Interrupt: pin B routed to IRQ 11\n        Region 0: Memory at b1000000 (32-bit, non-prefetchable) [size=4K]\n        Bus: primary=02, secondary=07, subordinate=07, sec-latency=176\n        Memory window 0: ec000000-effff000 (prefetchable)\n        Memory window 1: c8000000-cbfff000\n        I/O window 0: 00004800-000048ff\n        I/O window 1: 00004c00-00004cff\n        BridgeCtl: Parity- SERR- ISA- VGA- MAbort- >Reset+ 16bInt- PostWrite+\n        16-bit legacy interface ports at 0001\n\nkernel: BIOS-e820: 00000000000dc000 - 0000000000100000 (reserved)\nkernel: BIOS-e820: 0000000000100000 - 000000003ff40000 (usable)\nkernel: BIOS-e820: 000000003ff40000 - 000000003ff52000 (ACPI data)\nkernel: BIOS-e820: 000000003ff52000 - 000000003ff54000 (ACPI NVS)\nkernel: BIOS-e820: 000000003ff80000 - 0000000040000000 (reserved)\nkernel: BIOS-e820: 00000000ff800000 - 0000000100000000 (reserved)", "patch": ["diff --git a/drivers/pcmcia/cs.c b/drivers/pcmcia/cs.c\nindex 7c93a10..262313e 100644\n--- a/drivers/pcmcia/cs.c\n+++ b/drivers/pcmcia/cs.c\n@@ -53,7 +53,6 @@ MODULE_LICENSE(\"GPL\");\n \n INT_MODULE_PARM(setup_delay,\t10);\t\t/* centiseconds */\n INT_MODULE_PARM(resume_delay,\t20);\t\t/* centiseconds */\n-INT_MODULE_PARM(shutdown_delay,\t3);\t\t/* centiseconds */\n INT_MODULE_PARM(vcc_settle,\t40);\t\t/* centiseconds */\n INT_MODULE_PARM(reset_time,\t10);\t\t/* usecs */\n INT_MODULE_PARM(unreset_delay,\t10);\t\t/* centiseconds */\n@@ -393,8 +392,6 @@ static void socket_shutdown(struct pcmcia_socket *s)\n \tcs_dbg(s, 4, \"shutdown\\n\");\n \n \tsocket_remove_drivers(s);\n-\ts->state &= SOCKET_INUSE | SOCKET_PRESENT;\n-\tmsleep(shutdown_delay * 10);\n \ts->state &= SOCKET_INUSE;\n \n \t/* Blank out the socket state */\n@@ -409,6 +406,9 @@ static void socket_shutdown(struct pcmcia_socket *s)\n #endif\n \ts->functions = 0;\n \n+\t/* give socket some time to power down */\n+\tmsleep(100);\n+\n \ts->ops->get_status(s, &status);\n \tif (status & SS_POWERON) {\n \t\tprintk(KERN_ERR \"PCMCIA: socket %p: *** DANGER *** unable to remove socket power\\n\", s);\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "PCMCIA", "Hardware": "i386 Linux", "Importance": "P2 high", "Assignee": "Dominik Brodowski", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2007-03-26 00:50 UTC by Nils Neumann", "Modified": "2009-10-17 12:11 UTC", "CC List": "6 users", "See Also": "", "Kernel Version": "2.6.20", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["drivers/pcmcia/cs.c"], "methods": ["socket_shutdown"]}
{"id": "8110", "title": "insanely high temperature on bootup (e.g. 3517 C) - HP/Compaq nx8220, nc6000, nc8000 - 2.6.19 regression", "description": "Most recent kernel where this bug did *NOT* occur: 2.6.18.2\nDistribution: Debian/SID\nHardware Environment: HP/Compaq nx8220 (and nc6000, nc8000)\nSoftware Environment:\nProblem Description:\n\nSince I'm using kernel 2.6.20, on some fresh start-ups ACPI reports insanely\nhigh temperatures of some thousand degrees C for thermal zone TZ3. I don't\nexactly know what this sensor does - TZ1 is CPU temperature, TZ2 graphics chip,\nTZ4 shows speed of CPU fan in % - I guess TZ3 shows some kind of case\ntemperature. Normal values for TZ3 are about 32C.\n\nAnother user on some forum has the same problem using a nc6000, yet another one\nuses a nc8000 and kernel 2.6.19 (which I personally never installed/used). So I\nguess the problem began with 2.6.19.\n\nAs I'm using powersaved, the system immediately shuts down on boot time, when\npowersaved starts. Messages in syslog are sth. like:\n\nACPI: Critical trip point\nCritical temperature reached (3264 C), shutting down.\n\nThe temperature shown is always different, mostly around 3000C. A new startup\nafter this shutdown (booting the same kernel) leads to the same situation, until I:\n- boot with acpi=off - only resolves the issue for that boot up\n- OR boot older kernel 2.6.18.2 - after that you can reboot into 2.6.20 w/o the\nproblem\n- OR remove AC and battery and plug it in again\n\nSteps to reproduce:\nissue happens sporadically on \"fresh\" power-on - no way to reproduce it, yet...", "patch": ["Don't read status register until we get new event\n\nFrom: Alexey Starikovskiy <alexey.y.starikovskiy@intel.com>\n\n\n---\n\n drivers/acpi/ec.c |   40 +++++++++++++++++++++++-----------------\n 1 files changed, 23 insertions(+), 17 deletions(-)\n\ndiff --git a/drivers/acpi/ec.c b/drivers/acpi/ec.c\nindex ab68883..1e525dd 100644\n--- a/drivers/acpi/ec.c\n+++ b/drivers/acpi/ec.c\n@@ -100,6 +100,7 @@ static struct acpi_ec {\n \tunsigned long global_lock;\n \tstruct mutex lock;\n \tatomic_t query_pending;\n+\tatomic_t event_count;\n \tatomic_t leaving_burst;\t/* 0 : No, 1 : Yes, 2: abort */\n \twait_queue_head_t wait;\n } *ec_ecdt;\n@@ -131,10 +132,12 @@ static inline void acpi_ec_write_data(struct acpi_ec *ec, u8 data)\n \toutb(data, ec->data_addr);\n }\n \n-static inline int acpi_ec_check_status(struct acpi_ec *ec, enum ec_event event)\n+static inline int acpi_ec_check_status(struct acpi_ec *ec, enum ec_event event,\n+\t\t\t\t       unsigned old_count)\n {\n \tu8 status = acpi_ec_read_status(ec);\n-\n+\tif (old_count == atomic_read(&ec->event_count))\n+\t\treturn 0;\n \tif (event == ACPI_EC_EVENT_OBF_1) {\n \t\tif (status & ACPI_EC_FLAG_OBF)\n \t\t\treturn 1;\n@@ -146,19 +149,19 @@ static inline int acpi_ec_check_status(struct acpi_ec *ec, enum ec_event event)\n \treturn 0;\n }\n \n-static int acpi_ec_wait(struct acpi_ec *ec, enum ec_event event)\n+static int acpi_ec_wait(struct acpi_ec *ec, enum ec_event event, unsigned count)\n {\n \tif (acpi_ec_mode == EC_POLL) {\n \t\tunsigned long delay = jiffies + msecs_to_jiffies(ACPI_EC_DELAY);\n \t\twhile (time_before(jiffies, delay)) {\n-\t\t\tif (acpi_ec_check_status(ec, event))\n+\t\t\tif (acpi_ec_check_status(ec, event, 0))\n \t\t\t\treturn 0;\n \t\t}\n \t} else {\n \t\tif (wait_event_timeout(ec->wait,\n-\t\t\t\t       acpi_ec_check_status(ec, event),\n+\t\t\t\t       acpi_ec_check_status(ec, event, count),\n \t\t\t\t       msecs_to_jiffies(ACPI_EC_DELAY)) ||\n-\t\t    acpi_ec_check_status(ec, event)) {\n+\t\t    acpi_ec_check_status(ec, event, 0)) {\n \t\t\treturn 0;\n \t\t} else {\n \t\t\tprintk(KERN_ERR PREFIX \"acpi_ec_wait timeout,\"\n@@ -225,21 +228,22 @@ static int acpi_ec_transaction_unlocked(struct acpi_ec *ec, u8 command,\n \t\t\t\t\tu8 * rdata, unsigned rdata_len)\n {\n \tint result = 0;\n-\n+\tunsigned count = atomic_read(&ec->event_count);\n \tacpi_ec_write_cmd(ec, command);\n \n \tfor (; wdata_len > 0; --wdata_len) {\n-\t\tresult = acpi_ec_wait(ec, ACPI_EC_EVENT_IBF_0);\n+\t\tresult = acpi_ec_wait(ec, ACPI_EC_EVENT_IBF_0, count);\n \t\tif (result) {\n \t\t\tprintk(KERN_ERR PREFIX\n \t\t\t       \"write_cmd timeout, command = %d\\n\", command);\n \t\t\tgoto end;\n \t\t}\n+\t\tcount = atomic_read(&ec->event_count);\n \t\tacpi_ec_write_data(ec, *(wdata++));\n \t}\n \n \tif (!rdata_len) {\n-\t\tresult = acpi_ec_wait(ec, ACPI_EC_EVENT_IBF_0);\n+\t\tresult = acpi_ec_wait(ec, ACPI_EC_EVENT_IBF_0, count);\n \t\tif (result) {\n \t\t\tprintk(KERN_ERR PREFIX\n \t\t\t       \"finish-write timeout, command = %d\\n\", command);\n@@ -250,13 +254,13 @@ static int acpi_ec_transaction_unlocked(struct acpi_ec *ec, u8 command,\n \t}\n \n \tfor (; rdata_len > 0; --rdata_len) {\n-\t\tresult = acpi_ec_wait(ec, ACPI_EC_EVENT_OBF_1);\n+\t\tresult = acpi_ec_wait(ec, ACPI_EC_EVENT_OBF_1, count);\n \t\tif (result) {\n \t\t\tprintk(KERN_ERR PREFIX \"read timeout, command = %d\\n\",\n \t\t\t       command);\n \t\t\tgoto end;\n \t\t}\n-\n+\t\tcount = atomic_read(&ec->event_count);\n \t\t*(rdata++) = acpi_ec_read_data(ec);\n \t}\n       end:\n@@ -288,7 +292,7 @@ static int acpi_ec_transaction(struct acpi_ec *ec, u8 command,\n \t/* Make sure GPE is enabled before doing transaction */\n \tacpi_enable_gpe(NULL, ec->gpe, ACPI_NOT_ISR);\n \n-\tstatus = acpi_ec_wait(ec, ACPI_EC_EVENT_IBF_0);\n+\tstatus = acpi_ec_wait(ec, ACPI_EC_EVENT_IBF_0, 0);\n \tif (status) {\n \t\tprintk(KERN_DEBUG PREFIX\n \t\t       \"input buffer is not empty, aborting transaction\\n\");\n@@ -369,8 +373,8 @@ int ec_write(u8 addr, u8 val)\n EXPORT_SYMBOL(ec_write);\n \n int ec_transaction(u8 command,\n-\t\t\t  const u8 * wdata, unsigned wdata_len,\n-\t\t\t  u8 * rdata, unsigned rdata_len)\n+\t\t   const u8 * wdata, unsigned wdata_len,\n+\t\t   u8 * rdata, unsigned rdata_len)\n {\n \tstruct acpi_ec *ec;\n \n@@ -435,7 +439,7 @@ static u32 acpi_ec_gpe_handler(void *data)\n \tacpi_status status = AE_OK;\n \tu8 value;\n \tstruct acpi_ec *ec = (struct acpi_ec *)data;\n-\n+\tatomic_inc(&ec->event_count);\n \tif (acpi_ec_mode == EC_INTR) {\n \t\twake_up(&ec->wait);\n \t}\n@@ -633,6 +637,7 @@ static int acpi_ec_add(struct acpi_device *device)\n \tec->uid = -1;\n \tmutex_init(&ec->lock);\n \tatomic_set(&ec->query_pending, 0);\n+\tatomic_set(&ec->event_count, 1);\n \tif (acpi_ec_mode == EC_INTR) {\n \t\tatomic_set(&ec->leaving_burst, 1);\n \t\tinit_waitqueue_head(&ec->wait);\n@@ -807,6 +812,7 @@ acpi_fake_ecdt_callback(acpi_handle handle,\n \tacpi_status status;\n \n \tmutex_init(&ec_ecdt->lock);\n+\tatomic_set(&ec->event_count, 1);\n \tif (acpi_ec_mode == EC_INTR) {\n \t\tinit_waitqueue_head(&ec_ecdt->wait);\n \t}\n@@ -888,6 +894,7 @@ static int __init acpi_ec_get_real_ecdt(void)\n \t\treturn -ENOMEM;\n \n \tmutex_init(&ec_ecdt->lock);\n+\tatomic_set(&ec_ecdt->event_count, 1);\n \tif (acpi_ec_mode == EC_INTR) {\n \t\tinit_waitqueue_head(&ec_ecdt->wait);\n \t}\n@@ -1016,8 +1023,7 @@ static int __init acpi_ec_set_intr_mode(char *str)\n \t\tacpi_ec_mode = EC_POLL;\n \t}\n \tacpi_ec_driver.ops.add = acpi_ec_add;\n-\tprintk(KERN_NOTICE PREFIX \"%s mode.\\n\",\n-\t\t\t  intr ? \"interrupt\" : \"polling\");\n+\tprintk(KERN_NOTICE PREFIX \"%s mode.\\n\", intr ? \"interrupt\" : \"polling\");\n \n \treturn 1;\n }\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "EC", "Hardware": "i386 Linux", "Importance": "P2 high", "Assignee": "Alexey Starikovskiy", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2007-03-02 04:34 UTC by Martin", "Modified": "2008-10-17 21:40 UTC", "CC List": "1 user", "See Also": "", "Kernel Version": "2.6.19", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/acpi/ec.c"], "methods": ["acpi_ec_check_status", "acpi_ec_transaction_unlocked", "acpi_ec_transaction", "ec_transaction", "acpi_ec_gpe_handler", "acpi_ec_add", "acpi_fake_ecdt_callback", "acpi_ec_get_real_ecdt", "acpi_ec_set_intr_mode", "acpi_ec"]}
{"id": "7950", "title": "Network traffic stops inexplicably when running at gigabit speed.", "description": "Most recent kernel where this bug did *NOT* occur: 2.6.18.6\n\nDistribution: CentOS 4.4\n\nHardware Environment:\n\nASUS M2N-E (nForce 570 chipset)\nAMD64 X2 Dual Core 5200+\nBuilt in nic hooked up to a HP ProCurve 2428 gigabit switch.\n\nSoftware Environment:\nUsing a plain kernel without any distro patches.\nUsing forcedeth network driver.\nNo nVidia binary drivers what so ever.\nIP tables is turned off.\n\nProblem Description:\nAt random all network traffic just stops without apparent reason.\nRunning tcpdump shows outgoing packets but no incoming packets.\nIfconfig does not show any rx or tx errors.\nNo error messages show up in dmesg.\nTransfering data at high speed triggers the problem almost right away.\nWhen running an interactive session in ssh it tends to happen after 5-10 \nminutes.\nKernel 2.6.19.2 has the same problem as well.\n\nDoing a ifdown eth0 + ifup eth0 makes things work again for a while, but sooner \nor later it happens again.\nWhen hooking it up to a 100 megabit switch it works perfectly.\n\nI've tried messing around with all parameters you can set with ethtool but \nnothing helped.", "patch": ["--- orig/drivers/net/forcedeth.c\t2007-02-08 21:41:59.000000000 -0500\n+++ new/drivers/net/forcedeth.c\t2007-02-08 21:44:53.000000000 -0500\n@@ -3104,13 +3104,17 @@\n \tstruct fe_priv *np = netdev_priv(dev);\r\n \tu8 __iomem *base = get_hwbase(dev);\r\n \tunsigned long flags;\r\n+\tu32 retcode;\r\n \r\n-\tif (np->desc_ver == DESC_VER_1 || np->desc_ver == DESC_VER_2)\r\n+\tif (np->desc_ver == DESC_VER_1 || np->desc_ver == DESC_VER_2) {\r\n \t\tpkts = nv_rx_process(dev, limit);\r\n-\telse\r\n+\t\tretcode = nv_alloc_rx(dev);\r\n+\t} else {\r\n \t\tpkts = nv_rx_process_optimized(dev, limit);\r\n+\t\tretcode = nv_alloc_rx_optimized(dev);\r\n+\t}\r\n \r\n-\tif (nv_alloc_rx(dev)) {\r\n+\tif (retcode) {\r\n \t\tspin_lock_irqsave(&np->lock, flags);\r\n \t\tif (!np->in_shutdown)\r\n \t\t\tmod_timer(&np->oom_kick, jiffies + OOM_REFILL);\r\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Networking", "Classification": "Unclassified", "Component": "Other", "Hardware": "i386 Linux", "Importance": "P2 blocking", "Assignee": "Chuck Ebbert", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2007-02-06 08:57 UTC by Fredrik Ohrn", "Modified": "2007-03-26 15:55 UTC", "CC List": "4 users", "See Also": "", "Kernel Version": "2.6.20", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/net/forcedeth.c"], "methods": ["phy_reset"]}
{"id": "7942", "title": "ohci1394 module broken and cannot be removed", "description": "Most recent kernel where this bug did *NOT* occur: 2.6.19\nDistribution: Fedora Core 5\nHardware Environment: 4-processor IWill H8502 (2.8GHz single core Opterons) w/\n10GB of RAM installed 4/2/2/2 across 4 nodes.\nSoftware Environment:\n\nThis is from the working kernel.  All have been built with the same versions of\nsoftware:\n\nLinux bubba.tuc.us.ray.com 2.6.19_00 #2 SMP PREEMPT Mon Feb 5 15:20:05 MST 2007\nx86_64 x86_64 x86_64 GNU/Linux\n\nGnu C                  4.1.1\nGnu make               3.80\nbinutils               2.16.91.0.6\nutil-linux             2.13-pre6\nmount                  2.13-pre6\nmodule-init-tools      3.2-pre9\ne2fsprogs              1.38\nquota-tools            3.13.\nPPP                    2.4.3\nLinux C Library        > libc.2.4\nDynamic linker (ldd)   2.4\nProcps                 3.2.6\nNet-tools              1.60\nKbd                    1.12\nSh-utils               5.93\nudev                   084\nModules Loaded         raw1394 ohci1394 ieee1394 tg3\n\n\nProblem Description:\n\nLooks like something broke between 2.6.19 and 2.6.20-rc1.\n\nImmediately after boot, I tried to run a program that uses the bus via\nlibraw1394, but no ports are detected.  ohci1394 indicates via lsmod that it has\n1 user immediately after boot before raw1394 was loaded (normally its 0). \nAdditionally, the module cannot be unloaded, even with --force.\n\n[root@bubba rcrocomb]# uptime\n 16:03:14 up 2 min,  1 user,  load average: 2.03, 0.86, 0.32\n[root@bubba rcrocomb]# lsmod\nModule                  Size  Used by\nohci1394               41947  1\nieee1394              103984  1 ohci1394\ntg3                   106884  0\n[root@bubba rcrocomb]# rmmod ohci1394\nERROR: Module ohci1394 is in use\n\nI have confirmed this with:\n\n2.6.20-rt2\n2.6.20\n2.6.20-rc5\n2.6.20-rc5-rt10\n2.6.20-rc1\n\n2.6.19 is okay.  Kernel configs are as identical as possible.\n\nWhen booting 2.6.20-rt2 (only), an Oops is displayed: behavior is identical to\nother kernels.\n\nFeb  5 14:49:01 bubba kernel: ieee1394: nodemgr and IRM functionality disabled\nFeb  5 14:49:01 bubba kernel: ACPI: PCI Interrupt 0000:02:04.0[A] -> GSI 72\n(level, low) -> IRQ 72\nFeb  5 14:49:01 bubba kernel: stopped custom tracer.\nFeb  5 14:49:01 bubba kernel: Unable to handle kernel NULL pointer dereference\nat 0000000000000000 RIP:\nFeb  5 14:49:01 bubba kernel:  [<ffffffff803f3c2b>] klist_add_tail+0x39/0x49\nFeb  5 14:49:01 bubba kernel: PGD 279aee067 PUD 180383067 PMD 0\nFeb  5 14:49:01 bubba kernel: Oops: 0002 [1] PREEMPT SMP\nFeb  5 14:49:01 bubba kernel: CPU 0\nFeb  5 14:49:01 bubba kernel: Modules linked in: ohci1394 ieee1394 tg3\nFeb  5 14:49:01 bubba kernel: Pid: 1344, comm: modprobe Not tainted 2.6.20-rt2_00 #2\nFeb  5 14:49:01 bubba kernel: RIP: 0010:[<ffffffff803f3c2b>] \n[<ffffffff803f3c2b>] klist_add_tail+0x39/0x49\nFeb  5 14:49:01 bubba kernel: RSP: 0018:ffff810279b3bce8  EFLAGS: 00010246\nFeb  5 14:49:01 bubba kernel: RAX: ffffffff880342d0 RBX: ffffffff88034298 RCX:\n0000000000000000\nFeb  5 14:49:01 bubba kernel: RDX: ffff810002bf41f8 RSI: ffffffff80487511 RDI:\nffffffff88034298\nFeb  5 14:49:01 bubba kernel: RBP: ffff810002bf43b8 R08: ffff810037c4cf40 R09:\nffffffff880337a0\nFeb  5 14:49:01 bubba kernel: R10: 000000000000003b R11: ffffffff80536a40 R12:\nffff810002bf41f0\nFeb  5 14:49:01 bubba kernel: R13: 0000000000000000 R14: 0000000000000000 R15:\n000000000000000f\nFeb  5 14:49:01 bubba kernel: FS:  00002b71f7fd81f0(0000)\nGS:ffffffff80515100(0000) knlGS:0000000000000000\nFeb  5 14:49:01 bubba kernel: CS:  0010 DS: 0000 ES: 0000 CR0: 000000008005003b\nFeb  5 14:49:01 bubba kernel: CR2: 0000000000000000 CR3: 0000000279b8e000 CR4:\n00000000000006e0\nFeb  5 14:49:01 bubba kernel: Process modprobe (pid: 1344, threadinfo\nffff810279b3a000, task ffff8102797a7080)\nFeb  5 14:49:01 bubba kernel: Stack:  ffff810037c4cf40 ffff810002bf4128\n0000000000000000 ffffffff8034af87\nFeb  5 14:49:01 bubba kernel:  ffff810002bf4128 ffffffff8034afba\nffff810002bf4430 ffff810002bf4128\nFeb  5 14:49:01 bubba kernel:  ffffffff880337a0 ffffffff8034a15d\n0000000000000000 0000000000000000\nFeb  5 14:49:01 bubba kernel: Call Trace:\nFeb  5 14:49:01 bubba kernel:  [<ffffffff8034af87>] device_bind_driver+0x9/0x12\nFeb  5 14:49:01 bubba kernel:  [<ffffffff8034afba>] device_attach+0x2a/0x5d\nFeb  5 14:49:01 bubba kernel:  [<ffffffff8034a15d>] bus_attach_device+0x23/0x49\nFeb  5 14:49:01 bubba kernel:  [<ffffffff803492b7>] device_add+0x359/0x509\nFeb  5 14:49:01 bubba kernel:  [<ffffffff8801e318>]\n:ieee1394:hpsb_alloc_host+0x20d/0x24e\nFeb  5 14:49:01 bubba kernel:  [<ffffffff8803b010>]\n:ohci1394:ohci1394_pci_probe+0x45/0x625\nFeb  5 14:49:01 bubba kernel:  [<ffffffff8030a92e>] pci_device_probe+0xcd/0x134\nFeb  5 14:49:01 bubba kernel:  [<ffffffff8034add8>] really_probe+0x87/0x10c\nFeb  5 14:49:01 bubba kernel:  [<ffffffff8034af52>] __driver_attach+0x46/0x6d\nFeb  5 14:49:02 bubba kernel:  [<ffffffff8034af0c>] __driver_attach+0x0/0x6d\nFeb  5 14:49:02 bubba kernel:  [<ffffffff8034a414>] bus_for_each_dev+0x43/0x6e\nFeb  5 14:49:02 bubba kernel:  [<ffffffff8034a70b>] bus_add_driver+0x6e/0x190\nFeb  5 14:49:02 bubba kernel:  [<ffffffff8030ab32>] __pci_register_driver+0x85/0xba\nFeb  5 14:49:02 bubba kernel:  [<ffffffff80292f74>] sys_init_module+0xab/0x169\nFeb  5 14:49:02 bubba kernel:  [<ffffffff8025639e>] system_call+0x7e/0x83\nFeb  5 14:49:02 bubba kernel:\nFeb  5 14:49:02 bubba kernel:\nFeb  5 14:49:02 bubba kernel: Code: 48 89 11 48 89 4a 08 59 5b 41 5c e9 ee 75 e6\nff 41 54 49 89\nFeb  5 14:49:02 bubba kernel: RIP  [<ffffffff803f3c2b>] klist_add_tail+0x39/0x49\nFeb  5 14:49:02 bubba kernel:  RSP <ffff810279b3bce8>\nFeb  5 14:49:02 bubba kernel: CR2: 0000000000000000\n\n\nSteps to reproduce:\n\nBoot any of aforementioned kernels.", "patch": ["Date: Tue, 6 Feb 2007 02:20:06 +0100 (CET)\nFrom: Stefan Richter <stefanr@s5r6.in-berlin.de>\nSubject: ieee1394: fix host device registering when nodemgr disabled\n\nSince my commit 8252bbb1363b7fe963a3eb6f8a36da619a6f5a65 in 2.6.20-rc1,\nhost devices have a dummy driver attached.  Alas the driver was not\nregistered before use if ieee1394 was loaded with disable_nodemgr=1.\n\nSigned-off-by: Stefan Richter <stefanr@s5r6.in-berlin.de>\n---\n\nUpdate:  - work without extern variables,\n         - better error checks,\n\t - add missing driver_unregister.\n\n drivers/ieee1394/nodemgr.c |   26 ++++++++++++++++++--------\n 1 file changed, 18 insertions(+), 8 deletions(-)\n\nIndex: linux-2.6.20-rc5/drivers/ieee1394/nodemgr.c\n===================================================================\n--- linux-2.6.20-rc5.orig/drivers/ieee1394/nodemgr.c\n+++ linux-2.6.20-rc5/drivers/ieee1394/nodemgr.c\n@@ -258,7 +258,6 @@ static struct device_driver nodemgr_mid_\n struct device nodemgr_dev_template_host = {\n \t.bus\t\t= &ieee1394_bus_type,\n \t.release\t= nodemgr_release_host,\n-\t.driver\t\t= &nodemgr_mid_layer_driver,\n };\n \n \n@@ -1850,22 +1849,33 @@ int init_ieee1394_nodemgr(void)\n \n \terror = class_register(&nodemgr_ne_class);\n \tif (error)\n-\t\treturn error;\n-\n+\t\tgoto fail_ne;\n \terror = class_register(&nodemgr_ud_class);\n-\tif (error) {\n-\t\tclass_unregister(&nodemgr_ne_class);\n-\t\treturn error;\n-\t}\n+\tif (error)\n+\t\tgoto fail_ud;\n+\n+\t/* don't show this driver if nodemgr is off (disable_nodmgr=1) */\n+\tnodemgr_dev_template_host.driver = &nodemgr_mid_layer_driver;\n+\n \terror = driver_register(&nodemgr_mid_layer_driver);\n+\tif (error)\n+\t\tgoto fail_ml;\n+\n \thpsb_register_highlevel(&nodemgr_highlevel);\n \treturn 0;\n+\n+fail_ml:\n+\tclass_unregister(&nodemgr_ud_class);\n+fail_ud:\n+\tclass_unregister(&nodemgr_ne_class);\n+fail_ne:\n+\treturn error;\n }\n \n void cleanup_ieee1394_nodemgr(void)\n {\n \thpsb_unregister_highlevel(&nodemgr_highlevel);\n-\n+\tdriver_unregister(&nodemgr_mid_layer_driver);\n \tclass_unregister(&nodemgr_ud_class);\n \tclass_unregister(&nodemgr_ne_class);\n }\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "IEEE1394", "Hardware": "i386 Linux", "Importance": "P2 normal", "Assignee": "Stefan Richter", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2007-02-05 14:58 UTC by Robert Crocombe", "Modified": "2007-02-09 15:41 UTC", "CC List": "0 users", "See Also": "", "Kernel Version": "2.6.20", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/ieee1394/nodemgr.c"], "methods": ["init_ieee1394_nodemgr", "cleanup_ieee1394_nodemgr", "nodemgr_dev_template_host"]}
{"id": "7838", "title": "Missing important feature: libata bus shutdown and device shutdown", "description": "Problem Description:\n\nThe Linux kernel does not handle device_shutdown() for the libata buses.  The\nbus has no .shutdown method.  The devices have no .shutdown handlers.\n\nTherefore, device caches are not flushed prior to a system restart, system sleep\nor system powerdown, and device heads are not unloaded before a system sleep or\npowerdown, be it a transition to ACPI S3, S4 or S5 state, APM sleep/poweroff, or\nnon-PM-poweroff (the one that just asks the user to powerdown the machine).\n\nThis causes:\n  * Potential data loss if userspace does not manage to flush caches using the\npassthrough\n  * The need for the userspace halt(8) utility to try to avoid the above\nmentioned data loss (incidently, the lack of a proper high-level kernel\ninterface to do device cache flushes or device head unloads also means the\nuserspace code to do it is disgusting)\n  * Uneeded device wear (disk head assembly) if userspace or ACPI BIOS firmware\ndoes not unload heads prior to power off.\n\nThe disk's \"head auto-park\" on power off is actually called \"emergency head\nunload\" on modern disk drives by the HD manufacturers for a reason, and wears\ndown the drive mechanics a lot more, causing the drive's lifetime to be\ndrastically reduced.  Hitachi documentation for laptop HDs mention an emergency\nunload as being from 20 to 100 times more stressfull to the drive mechanics, and\nmakes it clear it should be avoided.\n\nNote that it is important to avoid unloading disk heads without a reason\n(especially on non-laptop drives), so the shutdown handler must differentiate a\nsystem restart (which should just sync caches) from a system power off (which\nneeds to sync caches and also to unload heads).\n\nThe fact that userspace will likely try to unload heads if it can before a\nshutdown means that either the kernel needs to snoop the few ATA commands that\ncause head unloads and spin-downs, to avoid reissuing such commands needlessly,\nor it needs to be easy for userspace to detect that the running kernel is one\nthat can handle disk device shutdowns by itself.  Otherwise, during a system\nshutdown sequence, the HDs are likely to be spun down (due to userspace\ncommand), only to be spun up and down again when the kernel attempts to shutdown\nthe device.\n\nAlso note that it is basically impossible for userspace to cover up for the lack\nof disk device shutdown handling by the kernel for ACPI S4 (suspend-to-disk),\nand that userspace code may fail to do it even for the normal shutdown if it\ndoesn't find the devices, or doesn't know how to do it or that it should do it\n(e.g. Debian Sarge cannot properly shutdown libata devices).\n\nSteps to reproduce:\n  * Patch halt(8) or the shutdown scripts to not attempt to issue commands to\npark heands and sync caches, and listen closely to the ammount of noise the HD\nwill make when the system powers down.  Note: this could conceivably kill the\nHD, and even if it doesn't, it will most surely reduce its working lifetime as\nmuch as pulling the plug with the machine running would.\n  * Try to suspend-to-disk using ACPI S4 a ThinkPad T43 (other models might also\nhave the same issue, but I have personally verified that a T43 BIOS does not\nunload disc heads for ACPI S4).", "patch": ["diff --git a/drivers/scsi/sd.c b/drivers/scsi/sd.c\nindex 978bfc1..f21e5fe 100644\n--- a/drivers/scsi/sd.c\n+++ b/drivers/scsi/sd.c\n@@ -90,6 +90,12 @@ MODULE_ALIAS_BLOCKDEV_MAJOR(SCSI_DISK13_MAJOR);\n MODULE_ALIAS_BLOCKDEV_MAJOR(SCSI_DISK14_MAJOR);\n MODULE_ALIAS_BLOCKDEV_MAJOR(SCSI_DISK15_MAJOR);\n \n+static int sd_stop_on_shutdown_dfl = 0;\n+module_param_named(stop_on_shutdown_default, sd_stop_on_shutdown_dfl,\n+\t\t   bool, 0644);\n+MODULE_PARM_DESC(stop_on_shutdown_default, \"Default setting for stopping \"\n+\t\t \"disk on shutdown (0=disable, 1=enable)\");\n+\n /*\n  * This is limited by the naming scheme enforced in sd_probe,\n  * add another character to it if you really need more disks.\n@@ -126,6 +132,7 @@ struct scsi_disk {\n \tunsigned\tWCE : 1;\t/* state of disk WCE bit */\n \tunsigned\tRCD : 1;\t/* state of disk RCD bit, unused */\n \tunsigned\tDPOFUA : 1;\t/* state of disk DPOFUA bit */\n+\tunsigned\tstop_on_shutdown : 1; /* stop on device shutdown */\n };\n #define to_scsi_disk(obj) container_of(obj,struct scsi_disk,cdev)\n \n@@ -207,6 +214,19 @@ static ssize_t sd_store_cache_type(struct class_device *cdev, const char *buf,\n \treturn count;\n }\n \n+static ssize_t sd_store_stop_on_shutdown(struct class_device *cdev,\n+\t\t\t\t\t const char *buf, size_t count)\n+{\n+\tstruct scsi_disk *sdkp = to_scsi_disk(cdev);\n+\n+\tif (!capable(CAP_SYS_ADMIN))\n+\t\treturn -EACCES;\n+\n+\tsdkp->stop_on_shutdown = simple_strtoul(buf, NULL, 10);\n+\n+\treturn count;\n+}\n+\n static ssize_t sd_store_allow_restart(struct class_device *cdev, const char *buf,\n \t\t\t\t      size_t count)\n {\n@@ -239,6 +259,13 @@ static ssize_t sd_show_fua(struct class_device *cdev, char *buf)\n \treturn snprintf(buf, 20, \"%u\\n\", sdkp->DPOFUA);\n }\n \n+static ssize_t sd_show_stop_on_shutdown(struct class_device *cdev, char *buf)\n+{\n+\tstruct scsi_disk *sdkp = to_scsi_disk(cdev);\n+\n+\treturn snprintf(buf, 20, \"%u\\n\", sdkp->stop_on_shutdown);\n+}\n+\n static ssize_t sd_show_allow_restart(struct class_device *cdev, char *buf)\n {\n \tstruct scsi_disk *sdkp = to_scsi_disk(cdev);\n@@ -252,6 +279,8 @@ static struct class_device_attribute sd_disk_attrs[] = {\n \t__ATTR(FUA, S_IRUGO, sd_show_fua, NULL),\n \t__ATTR(allow_restart, S_IRUGO|S_IWUSR, sd_show_allow_restart,\n \t       sd_store_allow_restart),\n+\t__ATTR(stop_on_shutdown, S_IRUGO|S_IWUSR, sd_show_stop_on_shutdown,\n+\t       sd_store_stop_on_shutdown),\n \t__ATTR_NULL,\n };\n \n@@ -1662,6 +1691,7 @@ static int sd_probe(struct device *dev)\n \tsdkp->disk = gd;\n \tsdkp->index = index;\n \tsdkp->openers = 0;\n+\tsdkp->stop_on_shutdown = sd_stop_on_shutdown_dfl;\n \n \tif (!sdp->timeout) {\n \t\tif (sdp->type != TYPE_MOD)\n@@ -1766,6 +1796,29 @@ static void scsi_disk_release(struct class_device *cdev)\n \tkfree(sdkp);\n }\n \n+static int sd_stop_device(struct scsi_device *sdp)\n+{\n+\tunsigned char cmd[6] = { START_STOP }; /* START_VALID and START == 0 */\n+\tstruct scsi_sense_hdr sshdr;\n+\tint res;\n+\n+\tif (!scsi_device_online(sdp))\n+\t\treturn -ENODEV;\n+\n+\tres = scsi_execute_req(sdp, cmd, DMA_NONE, NULL, 0, &sshdr,\n+\t\t\t       SD_TIMEOUT, SD_MAX_RETRIES);\n+\tif (res) {\n+\t\tprintk(KERN_WARNING \"FAILED\\n  status = %x, message = %02x, \"\n+\t\t       \"host = %d, driver = %02x\\n  \",\n+\t\t       status_byte(res), msg_byte(res),\n+\t\t       host_byte(res), driver_byte(res));\n+\t\tif (driver_byte(res) & DRIVER_SENSE)\n+\t\t\tscsi_print_sense_hdr(\"sd\", &sshdr);\n+\t}\n+\n+\treturn res;\n+}\n+\n /*\n  * Send a SYNCHRONIZE CACHE instruction down to the device through\n  * the normal SCSI command structure.  Wait for the command to\n@@ -1784,6 +1837,13 @@ static void sd_shutdown(struct device *dev)\n \t\t\t\tsdkp->disk->disk_name);\n \t\tsd_sync_cache(sdp);\n \t}\n+\n+\tif (system_state != SYSTEM_RESTART && sdkp->stop_on_shutdown) {\n+ \t\tprintk(KERN_NOTICE \"Stopping disk %s: \\n\",\n+\t\t       sdkp->disk->disk_name);\n+\t\tsd_stop_device(sdp);\n+\t}\n+\n \tscsi_disk_put(sdkp);\n }\n \n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "IO/Storage", "Classification": "Unclassified", "Component": "Serial ATA", "Hardware": "i386 Linux", "Importance": "P2 normal", "Assignee": "Tejun Heo", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2007-01-16 17:27 UTC by Henrique de Moraes Holschuh", "Modified": "2008-10-06 10:46 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "2.6.20", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/scsi/sd.c"], "methods": ["sd_probe", "sd_shutdown", "scsi_disk", "sd_disk_attrs"]}
{"id": "7800", "title": "Unable to read DVDs on external IEEE1394 DVD-RW", "description": "Most recent kernel where this bug did *NOT* occur: 2.6.18 (to my best knowledge)\nDistribution: Archlinux\nHardware Environment: 1 IDE disk, 1 IDE CD-RW (plextor), 1 IEEE1394 DVD-RW\nSoftware Environment: Using udev, 2.6.19.1 with modules sg, sbp2, sr_mod, ieee1394 \nProblem Description: \n\nMy DVD drive is being detected as a CD-ROM drive and seems to only be able to\nplay CDs. I can produce the error when I have the device plugged in via firewire\nand modprobe sbp2. This creates (using udev rules) sr0, sg0 and cdrom1 (cdrom0\nis IDE CD-RW) nodes in /dev. Udev is not getting the message that it is a DVD.\nHowever, even if I manually link /dev/dvd (for the DVD players) to /dev/sr0, I\nget the following errors:\n\nJan  9 19:01:27 neptune end_request: I/O error, dev sr0, sector 15557132\nJan  9 19:01:27 neptune end_request: I/O error, dev sr0, sector 15557128\n\nThis has started happening since I upgraded to 2.6.19. \n\nJan  9 18:54:56 neptune ieee1394: sbp2: Logged out of SBP-2 device\nJan  9 18:55:04 neptune ieee1394: sbp2: Driver forced to serialize I/O\n(serialize_io=1)\nJan  9 18:55:04 neptune ieee1394: sbp2: Try serialize_io=0 for better performance\nJan  9 18:55:04 neptune scsi8 : SBP-2 IEEE-1394\nJan  9 18:55:05 neptune ieee1394: sbp2: Logged into SBP-2 device\nJan  9 18:55:07 neptune scsi 8:0:0:0: CD-ROM            SONY     DVD RW DRU-810A\n 2.0b PQ: 0 ANSI: 0\nJan  9 18:55:13 neptune sr0: scsi-1 drive\nJan  9 18:55:13 neptune sr 8:0:0:0: Attached scsi generic sg0 type 5\n\nSteps to reproduce:\nrmmod sbp2\nmodprobe sbp2", "patch": ["Date: Wed, 10 Jan 2007 20:17:15 +0100 (CET)\nFrom: Stefan Richter <stefanr@s5r6.in-berlin.de>\nSubject: ieee1394: sbp2: fix probing of some DVD-ROM/RWs\n\nSince commit 98e238cd42be6c0852da519303cf0182690f8d9f in Linux 2.6.19,\n\"ieee1394: sbp2: don't prefer MODE SENSE 10\", some FireWire DVD-ROMs and\nDVD-RWs were mistaken as CD-ROM because sr_mod now sent MODE SENSE 6.\nThe MMC command set includes only MODE SENSE 10.\nhttp://bugzilla.kernel.org/show_bug.cgi?id=7800\n\nThis fix lets sbp2 switch scsi_device.use_10_for_rw on for MMC LUs.\nThis should rather be done in the command set driver sr_mod, not in the\nsbp2 transport driver, and an according patch will follow for a next\nLinux release.\n\nSigned-off-by: Stefan Richter <stefanr@s5r6.in-berlin.de>\n---\nIndex: linux-2.6.19.1/drivers/ieee1394/sbp2.c\n===================================================================\n--- linux-2.6.19.1.orig/drivers/ieee1394/sbp2.c\n+++ linux-2.6.19.1/drivers/ieee1394/sbp2.c\n@@ -2530,6 +2530,8 @@ static int sbp2scsi_slave_configure(stru\n \tblk_queue_dma_alignment(sdev->request_queue, (512 - 1));\n \tsdev->use_10_for_rw = 1;\n \n+\tif (sdev->type == TYPE_ROM)\n+\t\tsdev->use_10_for_ms = 1;\n \tif (sdev->type == TYPE_DISK &&\n \t    scsi_id->workarounds & SBP2_WORKAROUND_MODE_SENSE_8)\n \t\tsdev->skip_ms_page_8 = 1;\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "IEEE1394", "Hardware": "i386 Linux", "Importance": "P2 normal", "Assignee": "Stefan Richter", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2007-01-09 10:57 UTC by Daniel Nolan-Neylan", "Modified": "2007-01-10 23:46 UTC", "CC List": "1 user", "See Also": "", "Kernel Version": "2.6.19", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/ieee1394/sbp2.c"], "methods": ["sbp2scsi_slave_configure"]}
{"id": "7657", "title": "BUG: NULL pointer dereference in ieee80211softmac_get_network_by_bssid_locked", "description": "Most recent kernel where this bug did *NOT* occur: 2.6.18.x\nDistribution: Ubuntu Dapper\n\nHardware Environment: \nModel: Compaq r4000\nCPU: AMD Athlon64 3200+\nWireless Controller: BCM4306\n\nlspci:\n0000:00:00.0 Host bridge: ATI Technologies Inc RS480 Host Bridge\n0000:00:01.0 PCI bridge: ATI Technologies Inc: Unknown device 5a3f\n0000:00:04.0 PCI bridge: ATI Technologies Inc: Unknown device 5a36\n0000:00:13.0 USB Controller: ATI Technologies Inc IXP SB400 USB Host Controller\n0000:00:13.1 USB Controller: ATI Technologies Inc IXP SB400 USB Host Controller\n0000:00:13.2 USB Controller: ATI Technologies Inc IXP SB400 USB2 Host\nController0000:00:14.0 SMBus: ATI Technologies Inc IXP SB400 SMBus Controller\n(rev 10)\n0000:00:14.1 IDE interface: ATI Technologies Inc Standard Dual Channel PCI IDE\nController ATI\n0000:00:14.3 ISA bridge: ATI Technologies Inc IXP SB400 PCI-ISA Bridge\n0000:00:14.4 PCI bridge: ATI Technologies Inc IXP SB400 PCI-PCI Bridge\n0000:00:14.5 Multimedia audio controller: ATI Technologies Inc IXP SB400 AC'97\nAudio Controller (rev 01)\n0000:00:14.6 Modem: ATI Technologies Inc ATI SB400 - AC'97 Modem Controller (rev 01)\n0000:00:18.0 Host bridge: Advanced Micro Devices [AMD] K8 [Athlon64/Opteron]\nHyperTransport Technology Configuration\n0000:00:18.1 Host bridge: Advanced Micro Devices [AMD] K8 [Athlon64/Opteron]\nAddress Map\n0000:00:18.2 Host bridge: Advanced Micro Devices [AMD] K8 [Athlon64/Opteron]\nDRAM Controller\n0000:00:18.3 Host bridge: Advanced Micro Devices [AMD] K8 [Athlon64/Opteron]\nMiscellaneous Control\n0000:01:05.0 VGA compatible controller: ATI Technologies Inc ATI Radeon XPRESS\n200M 5955 (PCIE)\n0000:03:00.0 FireWire (IEEE 1394): Texas Instruments TSB43AB22/A IEEE-1394a-2000\nController (PHY/Link)\n0000:03:02.0 Network controller: Broadcom Corporation BCM4306 802.11b/g Wireless\nLAN Controller (rev 03)\n0000:03:04.0 CardBus bridge: Texas Instruments PCIxx21/x515 Cardbus Controller\n0000:03:04.3 Mass storage controller: Texas Instruments PCIxx21 Integrated\nFlashMedia Controller\n0000:03:04.4 0805: Texas Instruments PCI6411, PCI6421, PCI6611, PCI6621,\nPCI7411, PCI7421, PCI7611, PCI7621 Secure Digital (SD) Controller\n0000:03:06.0 Ethernet controller: Realtek Semiconductor Co., Ltd.\nRTL-8139/8139C/8139C+ (rev 10)\n\nSoftware Environment:\nver_linux:\nGnu C                  4.0.3\nGnu make               3.81beta4\nbinutils               2.16.91\nutil-linux             2.12r\nmount                  2.12r\nmodule-init-tools      3.2.2\ne2fsprogs              1.38\njfsutils               1.1.8\nreiserfsprogs          3.6.19\nreiser4progs           1.0.5\nxfsprogs               2.7.7\npcmciautils            012\npcmcia-cs              3.2.8\nPPP                    2.4.4b1\nLinux C Library        2.3.6\nDynamic linker (ldd)   2.3.6\nProcps                 3.2.6\nNet-tools              1.60\nConsole-tools          0.2.3\nSh-utils               5.93\nudev                   079\nwireless-tools         28\n\nProblem Description:\nDec  9 14:22:05 metagnosis kernel: [  109.616000] BUG: unable to handle kernel\nNULL pointer dereference at virtual address 00000000\nDec  9 14:22:05 metagnosis kernel: [  109.616000]  printing eip:\nDec  9 14:22:05 metagnosis kernel: [  109.616000] c0310113\nDec  9 14:22:05 metagnosis kernel: [  109.616000] *pde = 00000000\nDec  9 14:22:05 metagnosis kernel: [  109.616000] Oops: 0000 [#1]\nDec  9 14:22:05 metagnosis kernel: [  109.616000] Modules linked in: xfs\nnls_utf8 ntfs sr_mod scsi_mod usbhid snd_atiixp snd_atiixp_modem snd_ac97_codec\nsnd_ac97_bus snd_pcm_oss snd_mixer_oss snd_pcm snd_timer snd soundcore pcspkr\npsmouse serio_raw snd_page_alloc ehci_hcd ohci_hcd usbcore\nDec  9 14:22:05 metagnosis kernel: [  109.616000] CPU:    0\nDec  9 14:22:05 metagnosis kernel: [  109.616000] EIP:   \n0060:[ieee80211softmac_get_network_by_bssid_locked+35/96]    Not tainted VLI\nDec  9 14:22:05 metagnosis kernel: [  109.616000] EFLAGS: 00010086  \n(2.6.19-git13 #2)\nDec  9 14:22:05 metagnosis kernel: [  109.616000] EIP is at\nieee80211softmac_get_network_by_bssid_locked+0x23/0x60\nDec  9 14:22:05 metagnosis kernel: [  109.616000] eax: edce8980   ebx: 00000206\n  ecx: 00000000   edx: 00000000\nDec  9 14:22:05 metagnosis kernel: [  109.616000] esi: 00000008   edi: edce8a20\n  ebp: edce8ca4   esp: c16a7e84\nDec  9 14:22:05 metagnosis kernel: [  109.616000] ds: 007b   es: 007b   ss: 0068\nDec  9 14:22:05 metagnosis kernel: [  109.616000] Process events/0 (pid: 4,\nti=c16a6000 task=edecba90 task.ti=c16a6000)\nDec  9 14:22:05 metagnosis kernel: [  109.616000] Stack: c16a7e94 edce8a0c\n00000206 00000008 edce8a20 edce8980 c0310159 edce8980 \nDec  9 14:22:05 metagnosis kernel: [  109.616000]        c031179e edce8980\n000000c0 edce8a20 c0311b7f 00000001 00000003 edee4450 \nDec  9 14:22:05 metagnosis kernel: [  109.616000]        00000000 00000086\n00000086 c16a7ee8 edce89bc 00000000 00000000 e2bff0d0 \nDec  9 14:22:05 metagnosis kernel: [  109.616000] Call Trace:\nDec  9 14:22:05 metagnosis kernel: [  109.616000] \n[ieee80211softmac_get_network_by_bssid+9/16]\nieee80211softmac_get_network_by_bssid+0x9/0x10\nDec  9 14:22:05 metagnosis kernel: [  109.616000] \n[ieee80211softmac_send_disassoc_req+62/112]\nieee80211softmac_send_disassoc_req+0x3e/0x70\nDec  9 14:22:05 metagnosis kernel: [  109.616000] \n[ieee80211softmac_assoc_work+271/1152] ieee80211softmac_assoc_work+0x10f/0x480\nDec  9 14:22:05 metagnosis kernel: [  109.616000] \n[ieee80211softmac_assoc_notify_scan+0/16]\nieee80211softmac_assoc_notify_scan+0x0/0x10\nDec  9 14:22:05 metagnosis kernel: [  109.616000] \n[ieee80211softmac_notify_callback+76/96] ieee80211softmac_notify_callback+0x4c/0x60\nDec  9 14:22:05 metagnosis kernel: [  109.616000] \n[ieee80211softmac_notify_callback+0/96] ieee80211softmac_notify_callback+0x0/0x60\nDec  9 14:22:05 metagnosis kernel: [  109.616000] \n[ieee80211softmac_assoc_notify_scan+0/16]\nieee80211softmac_assoc_notify_scan+0x0/0x10\nDec  9 14:22:05 metagnosis kernel: [  109.616000] \n[ieee80211softmac_notify_callback+0/96] ieee80211softmac_notify_callback+0x0/0x60\nDec  9 14:22:05 metagnosis kernel: [  109.616000]  [run_workqueue+99/288]\nrun_workqueue+0x63/0x120\nDec  9 14:22:05 metagnosis kernel: [  109.616000]  [worker_thread+254/352]\nworker_thread+0xfe/0x160\nDec  9 14:22:05 metagnosis kernel: [  109.616000]  [default_wake_function+0/16]\ndefault_wake_function+0x0/0x10\nDec  9 14:22:05 metagnosis kernel: [  109.616000]  [worker_thread+0/352]\nworker_thread+0x0/0x160\nDec  9 14:22:05 metagnosis kernel: [  109.616000]  [kthread+215/224]\nkthread+0xd7/0xe0\nDec  9 14:22:05 metagnosis kernel: [  109.616000]  [kthread+0/224] kthread+0x0/0xe0\nDec  9 14:22:05 metagnosis kernel: [  109.616000]  [kernel_thread_helper+7/24]\nkernel_thread_helper+0x7/0x18\nDec  9 14:22:05 metagnosis kernel: [  109.616000]  =======================\nDec  9 14:22:05 metagnosis kernel: [  109.616000] Code: ff 53 9d 5b c3 8d 76 00\n55 8d a8 24 03 00 00 57 56 53 83 ec 08 89 54 24 04 8b 90 24 03 00 00 eb 0a 8d b4\n26 00 00 00 00 8b 14 24 <8b> 02 89 04 24 0f 18 00 90 39 ea 74 1f 8b 7c 24 04 8d\n72 08 b8 \nDec  9 14:22:05 metagnosis kernel: [  109.616000] EIP:\n[ieee80211softmac_get_network_by_bssid_locked+35/96]\nieee80211softmac_get_network_by_bssid_locked+0x23/0x60 SS:ESP 0068:c16a7e84\n\nSteps to reproduce:\n$ iwconfig eth1 essid ...\n\nThis has occured since at least -git7 and I've tested up to -git13 (didn't see\nany relevant changes in -git14, although if someone thinks otherwise I can try\nagain).\n\nAfter the OOPS, the keyboard goes dead although other non-network operation is\nfine.  Obviously the machine is also unable to shutdown when init hangs trying\nto shut network interfaces off.\n\nHere are the configurations I've tried:\n* bcm43xx data transfer:\n** DMA\n** DMA + PIO\n* MSI\n** on\n** off\n* Preemption \n** voluntary\n** full\n* ieee80211 and bcm43xx\n** as module\n** as static\n\nHave been busy as of late and not watching mailing list, so other than the dmesg\nand giving the list of flags I've flipped, I can't offer much other direction.", "patch": ["--- net/ieee80211/softmac/ieee80211softmac_assoc.c\t2006-12-13 11:23:03.000000000 -0500\n+++ net/ieee80211/softmac/ieee80211softmac_assoc.c\t2006-12-13 11:24:26.000000000 -0500\n@@ -167,7 +167,7 @@\n ieee80211softmac_assoc_notify_scan(struct net_device *dev, int event_type, void *context)\n {\n \tstruct ieee80211softmac_device *mac = ieee80211_priv(dev);\n-\tieee80211softmac_assoc_work((void*)mac);\n+\tieee80211softmac_assoc_work(&mac->associnfo.work.work);\n }\n \n static void\n@@ -177,7 +177,7 @@\n \n \tswitch (event_type) {\n \tcase IEEE80211SOFTMAC_EVENT_AUTHENTICATED:\n-\t\tieee80211softmac_assoc_work((void*)mac);\n+\t        ieee80211softmac_assoc_work(&mac->associnfo.work.work);\n \t\tbreak;\n \tcase IEEE80211SOFTMAC_EVENT_AUTH_FAILED:\n \tcase IEEE80211SOFTMAC_EVENT_AUTH_TIMEOUT:\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Networking", "Classification": "Unclassified", "Component": "Wireless", "Hardware": "i386 Linux", "Importance": "P2 high", "Assignee": "networking_wireless@kernel-bugs.osdl.org", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2006-12-09 12:11 UTC by Michael Bommarito", "Modified": "2006-12-15 05:58 UTC", "CC List": "0 users", "See Also": "", "Kernel Version": "2.6.19", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["net/ieee80211/softmac/ieee80211softmac_assoc.c"], "methods": ["ieee80211softmac_assoc_notify_scan", "ieee80211softmac_assoc_notify_auth"]}
{"id": "7601", "title": "irq 18: nobody cared - Intel STL2 SCI INT_SRC_OVR", "description": "Most recent kernel where this bug did *NOT* occur:\n2.6.18.3\n\nDistribution:\nFedora Core 6\n\nHardware Environment:\n00:00.0 Host bridge: Intel Corporation 82815 815 Chipset Host Bridge and Memory\nController Hub (rev 02)\n00:01.0 PCI bridge: Intel Corporation 82815 815 Chipset AGP Bridge (rev 02)\n00:1e.0 PCI bridge: Intel Corporation 82801 PCI Bridge (rev 05)\n00:1f.0 ISA bridge: Intel Corporation 82801BA ISA Bridge (LPC) (rev 05)\n00:1f.1 IDE interface: Intel Corporation 82801BA IDE U100 (rev 05)\n00:1f.2 USB Controller: Intel Corporation 82801BA/BAM USB (Hub #1) (rev 05)\n00:1f.3 SMBus: Intel Corporation 82801BA/BAM SMBus (rev 05)\n00:1f.4 USB Controller: Intel Corporation 82801BA/BAM USB (Hub #2) (rev 05)\n01:00.0 VGA compatible controller: nVidia Corporation NV34 [GeForce FX 5200]\n(rev a1)\n02:09.0 FireWire (IEEE 1394): Texas Instruments TSB12LV23 IEEE-1394 Controller\n02:0a.0 Multimedia video controller: Brooktree Corporation Bt848 Video Capture\n(rev 12)\n02:0b.0 USB Controller: NEC Corporation USB (rev 43)\n02:0b.1 USB Controller: NEC Corporation USB (rev 43)\n02:0b.2 USB Controller: NEC Corporation USB 2.0 (rev 04)\n02:0c.0 Multimedia audio controller: Ensoniq ES1370 [AudioPCI] (rev 01)\n02:0e.0 Ethernet controller: Intel Corporation 82557/8/9 [Ethernet Pro 100] (rev 08)\n\nSoftware Environment:\nMainline kernel, gcc 4.1.1, glibc 2.5\n\nProblem Description:\nSince kernel 2.6.19 (today), the message \"irq 18: nobody cared ...\" appeared.\nI do not know how serious this could be, but it does not look good, expecially\nconsidering that kernel 2.6.18.3 was fine.\n\nSteps to reproduce:\nReboot the box with 2.6.19... :-)\n\nI tried with PNP OS (in BIOS) yes/no with same result.\nI also create dmesg and /proc/interrupts output with 2.6.18.3, 2.6.19 and 2.6.19\nwith \"irqpoll\". The last one seems to work properly, i.e. the irq 18 is assigned\nproperly. Performace wise, I don't know.\nIf I found the way :-) all attach the files here.", "patch": ["commit 281ea49b0c294649a6de47a6f8fbe5611137726b\nAuthor: Kimball Murray <kimball.murray@gmail.com>\nDate:   Tue Oct 10 14:20:33 2006 -0700\n\n    ACPI: SCI interrupt source override\n    \n    The Linux group at Stratus Technologies has come across an issue with SCI\n    routing under ACPI.  We were bitten by this when we made an x86_64 platform\n    whose BIOS provides an Interrupt Source Override for the SCI itself.\n    Apparently the override has no effect for the System Control Interrupt, and\n    this appears to be because of the way the SCI is setup in the ACPI code.\n    It does not handle the case where busirq != gsi.\n    \n    The code that sets up the SCI routing assumes that bus irq == global irq.\n    So there is simply no provision for telling it otherwise.  The attached\n    patch provides this mechanism.\n    \n    This patch provided by David Bulkow, was tested on an i386 platform, which\n    does not use the SCI override, and also on an x86_64 platform which does\n    use an override.\n    \n    Signed-off-by: David Bulkow <david.bulkow@stratus.com>\n    Cc: Andi Kleen <ak@muc.de>\n    Signed-off-by: Andrew Morton <akpm@osdl.org>\n    Signed-off-by: Len Brown <len.brown@intel.com>\n\ndiff --git a/arch/i386/kernel/acpi/boot.c b/arch/i386/kernel/acpi/boot.c\nindex 92f79cd..ab974ff 100644\n--- a/arch/i386/kernel/acpi/boot.c\n+++ b/arch/i386/kernel/acpi/boot.c\n@@ -332,7 +332,7 @@ acpi_parse_ioapic(acpi_table_entry_header * header, const unsigned long end)\n /*\n  * Parse Interrupt Source Override for the ACPI SCI\n  */\n-static void acpi_sci_ioapic_setup(u32 gsi, u16 polarity, u16 trigger)\n+static void acpi_sci_ioapic_setup(u32 bus_irq, u32 gsi, u16 polarity, u16 trigger)\n {\n \tif (trigger == 0)\t/* compatible SCI trigger is level */\n \t\ttrigger = 3;\n@@ -352,13 +352,13 @@ static void acpi_sci_ioapic_setup(u32 gsi, u16 polarity, u16 trigger)\n \t * If GSI is < 16, this will update its flags,\n \t * else it will create a new mp_irqs[] entry.\n \t */\n-\tmp_override_legacy_irq(gsi, polarity, trigger, gsi);\n+\tmp_override_legacy_irq(bus_irq, polarity, trigger, gsi);\n \n \t/*\n \t * stash over-ride to indicate we've been here\n \t * and for later update of acpi_fadt\n \t */\n-\tacpi_sci_override_gsi = gsi;\n+\tacpi_sci_override_gsi = bus_irq;\n \treturn;\n }\n \n@@ -376,7 +376,7 @@ acpi_parse_int_src_ovr(acpi_table_entry_header * header,\n \tacpi_table_print_madt_entry(header);\n \n \tif (intsrc->bus_irq == acpi_fadt.sci_int) {\n-\t\tacpi_sci_ioapic_setup(intsrc->global_irq,\n+\t\tacpi_sci_ioapic_setup(intsrc->bus_irq, intsrc->global_irq,\n \t\t\t\t      intsrc->flags.polarity,\n \t\t\t\t      intsrc->flags.trigger);\n \t\treturn 0;\n@@ -879,7 +879,7 @@ static int __init acpi_parse_madt_ioapic_entries(void)\n \t * pretend we got one so we can set the SCI flags.\n \t */\n \tif (!acpi_sci_override_gsi)\n-\t\tacpi_sci_ioapic_setup(acpi_fadt.sci_int, 0, 0);\n+\t\tacpi_sci_ioapic_setup(acpi_fadt.sci_int, acpi_fadt.sci_int, 0, 0);\n \n \t/* Fill in identity legacy mapings where no override */\n \tmp_config_acpi_legacy_irqs();\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "Config-Interrupts", "Hardware": "i386 Linux", "Importance": "P2 normal", "Assignee": "Len Brown", "URL": "", "Keywords": "", "Duplicates (1)": "7628", "Depends on": "", "Blocks": "", "Reported": "2006-11-30 12:50 UTC by piergiorgio.sartor", "Modified": "2007-02-15 23:33 UTC", "CC List": "4 users", "See Also": "", "Kernel Version": "2.6.19", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["arch/i386/kernel/acpi/boot.c"], "methods": ["acpi_sci_ioapic_setup", "acpi_parse_int_src_ovr", "acpi_parse_madt_ioapic_entries"]}
{"id": "7527", "title": "isicom segmentation fault", "description": "Most recent kernel where this bug did *NOT* occur:\nDistribution: Redhat EL 4\nHardware Environment: Intel x86\nSoftware Environment:\nProblem Description: Unable to access Modem\n\nSteps to reproduce:\n\n[root@dialin-0 ~]# setserial -g /dev/ttyM0\nSegmentation fault\n[root@dialin-0 ~]#\nMessage from syslogd@dialin-0 at Tue Nov 14 14:41:38 2006 ...\ndialin-0 kernel: Oops: 0000 [#1]\n\nMessage from syslogd@dialin-0 at Tue Nov 14 14:41:38 2006 ...\ndialin-0 kernel: SMP\n\nMessage from syslogd@dialin-0 at Tue Nov 14 14:41:38 2006 ...\ndialin-0 kernel: CPU:    0\n\nMessage from syslogd@dialin-0 at Tue Nov 14 14:41:38 2006 ...\ndialin-0 kernel: EIP is at isicom_close+0x12/0x1ab [isicom]\n\nMessage from syslogd@dialin-0 at Tue Nov 14 14:41:38 2006 ...\ndialin-0 kernel: eax: f5f14000   ebx: 00000000   ecx: f8922cf0   edx: f7f7fa40\n\nMessage from syslogd@dialin-0 at Tue Nov 14 14:41:38 2006 ...\ndialin-0 kernel: esi: 00000000   edi: 00000000   ebp: f5f14000   esp: f5fc7e08\n\nMessage from syslogd@dialin-0 at Tue Nov 14 14:41:38 2006 ...\ndialin-0 kernel: ds: 007b   es: 007b   ss: 0068\n\nMessage from syslogd@dialin-0 at Tue Nov 14 14:41:38 2006 ...\ndialin-0 kernel: Process setserial (pid: 4258, ti=f5fc7000 task=f665ad30\ntask.ti=f5fc7000)\n\nMessage from syslogd@dialin-0 at Tue Nov 14 14:41:38 2006 ...\ndialin-0 kernel: Stack: f8922cf0 f7f7fa40 f5f14000 00000000 00000000 00000000\nc020c208 00000000\n\nMessage from syslogd@dialin-0 at Tue Nov 14 14:41:38 2006 ...\ndialin-0 kernel:        00000000 000200d0 00000002 00000000 f7f7fa40 c033f600\n000000d0 c034c5e0\n\nMessage from syslogd@dialin-0 at Tue Nov 14 14:41:38 2006 ...\ndialin-0 kernel:        00000003 c034c5d0 00000000 00000001 f5fc7e7c c0117e96\n00000000 00000000\n\nMessage from syslogd@dialin-0 at Tue Nov 14 14:41:38 2006 ...\ndialin-0 kernel: Call Trace:\n\nMessage from syslogd@dialin-0 at Tue Nov 14 14:41:38 2006 ...\ndialin-0 kernel: Code: 89 4d 06 89 c2 89 d8 59 5b 5b 5e 5f 5d e9 79 4e 9b c7 5f\n5d 5b 5e 5f 5d c3 55 89 c5 57 56 53 51 51 89 54 24 04 8b 98 c0 01 00 00 <8b> 43\n1c 85 db 89 04 24 0f 84 84 01 00 00 89 c6 83 c6 14 89 f0\n\nMessage from syslogd@dialin-0 at Tue Nov 14 14:41:38 2006 ...\ndialin-0 kernel: EIP: [<f8922d02>] isicom_close+0x12/0x1ab [isicom] SS:ESP\n0068:f5fc7e08\n\nDMESG:\n\nBUG: unable to handle kernel NULL pointer dereference at virtual address 0000001c\n printing eip:\nf8922d02\n*pde = 35f5c001\nOops: 0000 [#1]\nSMP\nModules linked in: ipv6 autofs4 sunrpc ipt_REJECT xt_tcpudp xt_state\nip_conntrack iptable_filter ip_tables x_tables dm_mirror dm_mod button battery\nasus_acpi ac uhci_hcd ehci_hcd isicom shpchp i2c_i801 i2c_core e1000 floppy ext3\njbd raid1 ata_piix libata sd_mod scsi_mod\nCPU:    0\nEIP:    0060:[<f8922d02>]    Not tainted VLI\nEFLAGS: 00010286   (2.6.18.2 #1)\nEIP is at isicom_close+0x12/0x1ab [isicom]\neax: f5f14000   ebx: 00000000   ecx: f8922cf0   edx: f7f7fa40\nesi: 00000000   edi: 00000000   ebp: f5f14000   esp: f5fc7e08\nds: 007b   es: 007b   ss: 0068\nProcess setserial (pid: 4258, ti=f5fc7000 task=f665ad30 task.ti=f5fc7000)\nStack: f8922cf0 f7f7fa40 f5f14000 00000000 00000000 00000000 c020c208 00000000\n       00000000 000200d0 00000002 00000000 f7f7fa40 c033f600 000000d0 c034c5e0\n       00000003 c034c5d0 00000000 00000001 f5fc7e7c c0117e96 00000000 00000000\nCall Trace:\n [<f8922cf0>] isicom_close+0x0/0x1ab [isicom]\n [<c020c208>] release_dev+0x19b/0x5d4\n [<c0117e96>] __wake_up+0x29/0x3c\n [<c020ac44>] tty_ldisc_enable+0x20/0x22\n [<c020bda0>] init_dev+0x370/0x483\n [<c020c7ef>] tty_open+0x1ae/0x2bb\n [<c01621fb>] chrdev_open+0x12f/0x14c\n [<c01620cc>] chrdev_open+0x0/0x14c\n [<c0159b98>] __dentry_open+0xc6/0x19e\n [<c0159d2a>] nameidata_to_filp+0x19/0x28\n [<c0159c9b>] do_filp_open+0x2b/0x31\n [<c01ca096>] strncpy_from_user+0x3c/0x5b\n [<c0159f03>] do_sys_open+0x3c/0xaf\n [<c0159f8c>] sys_open+0x16/0x18\n [<c0103235>] sysenter_past_esp+0x56/0x79\nCode: 89 4d 06 89 c2 89 d8 59 5b 5b 5e 5f 5d e9 79 4e 9b c7 5f 5d 5b 5e 5f 5d c3\n55 89 c5 57 56 53 51 51 89 54 24 04 8b 98 c0 01 00 00 <8b> 43 1c 85 db 89 04 24\n0f 84 84 01 00 00 89 c6 83 c6 14 89 f0\nEIP: [<f8922d02>] isicom_close+0x12/0x1ab [isicom] SS:ESP 0068:f5fc7e08", "patch": ["diff --git a/drivers/char/isicom.c b/drivers/char/isicom.c\nindex 18a3a40..dcd3ead 100644\n--- a/drivers/char/isicom.c\n+++ b/drivers/char/isicom.c\n@@ -1044,11 +1044,12 @@ static void isicom_shutdown_port(struct \n static void isicom_close(struct tty_struct *tty, struct file *filp)\n {\n \tstruct isi_port *port = tty->driver_data;\n-\tstruct isi_board *card = port->card;\n+\tstruct isi_board *card;\n \tunsigned long flags;\n \n \tif (!port)\n \t\treturn;\n+\tcard = port->card;\n \tif (isicom_paranoia_check(port, tty->name, \"isicom_close\"))\n \t\treturn;\n \n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Serial", "Hardware": "i386 Linux", "Importance": "P2 normal", "Assignee": "Jiri Slaby", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2006-11-14 14:47 UTC by Eric", "Modified": "2006-11-19 08:02 UTC", "CC List": "1 user", "See Also": "", "Kernel Version": "2.6.18", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/char/isicom.c"], "methods": ["isicom_close"]}
{"id": "7517", "title": "r8169: Packet corruption on receive for 8111B chip", "description": "Most recent kernel where this bug did not occur: N/A\nDistribution: Debian (but stock vanilla kernel.org kernel tree)\nHardware Environment: Intel Core 2 Duo E6300 on Gigabyte GA-945GM-S2 mainboard,\nNIC under test running 100Mbps, full duplex\nSoftware Environment: Debian testing installation (last updated early Nov 2006)\nProblem Description: About 2/3 of received packet data corrupted when using the\nr8169 driver to operate the onboard Realtek 8111B gigabit ethernet chip\n\nSteps to reproduce:\nmodprobe r8169, configure appropriate for operation on your ethernet\nping the NIC from another machine\nNotice that over 60% of the pings don't return\n\nAn examination of the traffic with wireshark running on the test machine reveals\nthat the machine is not returning most of the pings because the received packet\ndata is being corrupted.  The nature of the corruption is that the first 4 bytes\nof the corrupted packet data is simply missing (and there's 4 bytes of garbage\nappended at the end so the overall packet size stays the same).  Smells like a\nfencepost error somewhere...\n\nI have not tried this with older kernels, but then before 2.6.19, the r8169\ndriver apparently did not support this chip.", "patch": ["From 79416cabb44bbe99e6fdab464c3c620ca43d56c1 Mon Sep 17 00:00:00 2001\nFrom: Francois Romieu <romieu@fr.zoreil.com>\nDate: Thu, 2 Nov 2006 00:10:16 +0100\nSubject: [PATCH] r8169: more magic during initialization of the hardware\n\nMostly taken from Realtek's driver.\n\nIt's a bit yucky but the original is even worse.\n\nSigned-off-by: Francois Romieu <romieu@fr.zoreil.com>\nSigned-off-by: Darren Salt <linux@youmustbejoking.demon.co.uk>\n---\n drivers/net/r8169.c |   58 +++++++++++++++++++++++++++++++++++++++------------\n 1 files changed, 44 insertions(+), 14 deletions(-)\n\ndiff --git a/drivers/net/r8169.c b/drivers/net/r8169.c\nindex f668f0a..eb1821d 100644\n--- a/drivers/net/r8169.c\n+++ b/drivers/net/r8169.c\n@@ -1852,12 +1852,25 @@ static void rtl8169_hw_reset(void __iome\n \tRTL_R8(ChipCmd);\n }\n \n-static void\n-rtl8169_hw_start(struct net_device *dev)\n+static void rtl8169_set_rx_tx_config_registers(struct rtl8169_private *tp)\n+{\n+\tvoid __iomem *ioaddr = tp->mmio_addr;\n+\tu32 cfg = rtl8169_rx_config;\n+\n+\tcfg |= (RTL_R32(RxConfig) & rtl_chip_info[tp->chipset].RxConfigMask);\n+\tRTL_W32(RxConfig, cfg);\n+\n+\t/* Set DMA burst size and Interframe Gap Time */\n+\tRTL_W32(TxConfig, (TX_DMA_BURST << TxDMAShift) |\n+\t\t(InterFrameGap << TxInterFrameGapShift));\n+}\n+\n+static void rtl8169_hw_start(struct net_device *dev)\n {\n \tstruct rtl8169_private *tp = netdev_priv(dev);\n \tvoid __iomem *ioaddr = tp->mmio_addr;\n \tstruct pci_dev *pdev = tp->pci_dev;\n+\tu16 cmd;\n \tu32 i;\n \n \t/* Soft reset the chip. */\n@@ -1870,6 +1883,11 @@ rtl8169_hw_start(struct net_device *dev)\n \t\tmsleep_interruptible(1);\n \t}\n \n+\tif (tp->mac_version == RTL_GIGA_MAC_VER_05) {\n+\t\tRTL_W16(CPlusCmd, RTL_R16(CPlusCmd) | PCIMulRW);\n+\t\tpci_write_config_byte(pdev, PCI_CACHE_LINE_SIZE, 0x08);\n+\t}\n+\n \tif (tp->mac_version == RTL_GIGA_MAC_VER_13) {\n \t\tpci_write_config_word(pdev, 0x68, 0x00);\n \t\tpci_write_config_word(pdev, 0x69, 0x08);\n@@ -1877,8 +1895,6 @@ rtl8169_hw_start(struct net_device *dev)\n \n \t/* Undocumented stuff. */\n \tif (tp->mac_version == RTL_GIGA_MAC_VER_05) {\n-\t\tu16 cmd;\n-\n \t\t/* Realtek's r1000_n.c driver uses '&& 0x01' here. Well... */\n \t\tif ((RTL_R8(Config2) & 0x07) & 0x01)\n \t\t\tRTL_W32(0x7c, 0x0007ffff);\n@@ -1890,23 +1906,29 @@ rtl8169_hw_start(struct net_device *dev)\n \t\tpci_write_config_word(pdev, PCI_COMMAND, cmd);\n \t}\n \n-\n \tRTL_W8(Cfg9346, Cfg9346_Unlock);\n+\tif ((tp->mac_version == RTL_GIGA_MAC_VER_01) ||\n+\t    (tp->mac_version == RTL_GIGA_MAC_VER_02) ||\n+\t    (tp->mac_version == RTL_GIGA_MAC_VER_03) ||\n+\t    (tp->mac_version == RTL_GIGA_MAC_VER_04))\n+\t\tRTL_W8(ChipCmd, CmdTxEnb | CmdRxEnb);\n+\n \tRTL_W8(EarlyTxThres, EarlyTxThld);\n \n \t/* Low hurts. Let's disable the filtering. */\n \tRTL_W16(RxMaxSize, 16383);\n \n-\t/* Set Rx Config register */\n-\ti = rtl8169_rx_config |\n-\t\t(RTL_R32(RxConfig) & rtl_chip_info[tp->chipset].RxConfigMask);\n-\tRTL_W32(RxConfig, i);\n+\tif ((tp->mac_version == RTL_GIGA_MAC_VER_01) ||\n+\t    (tp->mac_version == RTL_GIGA_MAC_VER_02) ||\n+\t    (tp->mac_version == RTL_GIGA_MAC_VER_03) ||\n+\t    (tp->mac_version == RTL_GIGA_MAC_VER_04))\n+\t\tRTL_W8(ChipCmd, CmdTxEnb | CmdRxEnb);\n+\t\trtl8169_set_rx_tx_config_registers(tp);\n \n-\t/* Set DMA burst size and Interframe Gap Time */\n-\tRTL_W32(TxConfig, (TX_DMA_BURST << TxDMAShift) |\n-\t\t(InterFrameGap << TxInterFrameGapShift));\n+\tcmd = RTL_R16(CPlusCmd);\n+\tRTL_W16(CPlusCmd, cmd);\n \n-\ttp->cp_cmd |= RTL_R16(CPlusCmd) | PCIMulRW;\n+\ttp->cp_cmd |= cmd | PCIMulRW;\n \n \tif ((tp->mac_version == RTL_GIGA_MAC_VER_02) ||\n \t    (tp->mac_version == RTL_GIGA_MAC_VER_03)) {\n@@ -1932,7 +1954,15 @@ rtl8169_hw_start(struct net_device *dev)\n \tRTL_W32(TxDescStartAddrLow, ((u64) tp->TxPhyAddr & DMA_32BIT_MASK));\n \tRTL_W32(RxDescAddrHigh, ((u64) tp->RxPhyAddr >> 32));\n \tRTL_W32(RxDescAddrLow, ((u64) tp->RxPhyAddr & DMA_32BIT_MASK));\n-\tRTL_W8(ChipCmd, CmdTxEnb | CmdRxEnb);\n+\n+\tif ((tp->mac_version != RTL_GIGA_MAC_VER_01) &&\n+\t    (tp->mac_version != RTL_GIGA_MAC_VER_02) &&\n+\t    (tp->mac_version != RTL_GIGA_MAC_VER_03) &&\n+\t    (tp->mac_version != RTL_GIGA_MAC_VER_04)) {\n+\t\tRTL_W8(ChipCmd, CmdTxEnb | CmdRxEnb);\n+\t\trtl8169_set_rx_tx_config_registers(tp);\n+\t}\n+\n \tRTL_W8(Cfg9346, Cfg9346_Lock);\n \n \t/* Initially a 10 us delay. Turned it into a PCI commit. - FR */\n-- \n1.4.2.4\n\n", "diff --git a/drivers/net/r8169.c b/drivers/net/r8169.c\nindex 27f90b2..41bc6dc 100644\n--- a/drivers/net/r8169.c\n+++ b/drivers/net/r8169.c\n@@ -2509,6 +2509,9 @@ rtl8169_rx_interrupt(struct net_device *\n \t\t\t\tle64_to_cpu(desc->addr), tp->rx_buf_sz,\n \t\t\t\tPCI_DMA_FROMDEVICE);\n \n+\t\t\tprintk(KERN_INFO \"%s: %p %08x %08x %08x\\n\", dev->name, skb->data,\n+\t\t\t       *(u32 *)(skb->data - 4), *(u32 *)skb->data, *(u32 *)(skb->data + 4));\n+\n \t\t\tif (rtl8169_try_rx_copy(&skb, pkt_size, desc,\n \t\t\t\t\t\ttp->rx_buf_sz, tp->align)) {\n \t\t\t\tpci_action = pci_unmap_single;\n", "From: Francois Romieu <romieu@fr.zoreil.com>\nDate: Fri, 17 Nov 2006 23:15:17 +0100\nSubject: [PATCH] r8169: more alignment for the 0x8168\n\nTwo thirds of packets are lost because of misalignment. Users of\nAsus laptop did apparently not notice it.\n\nReported on Gigabyte GA-945GM-S2.\n\nFix for http://bugzilla.kernel.org/show_bug.cgi?id=7617\n\nSigned-off-by: Francois Romieu <romieu@fr.zoreil.com>\n---\n drivers/net/r8169.c |    4 ++--\n 1 files changed, 2 insertions(+), 2 deletions(-)\n\ndiff --git a/drivers/net/r8169.c b/drivers/net/r8169.c\nindex 27f90b2..462d95d 100644\n--- a/drivers/net/r8169.c\n+++ b/drivers/net/r8169.c\n@@ -1972,7 +1972,7 @@ static int rtl8169_alloc_rx_skb(struct p\n \tif (!skb)\n \t\tgoto err_out;\n \n-\tskb_reserve(skb, align);\n+\tskb_reserve(skb, (align - 1) & (u32)skb->data);\n \t*sk_buff = skb;\n \n \tmapping = pci_map_single(pdev, skb->data, rx_buf_sz,\n@@ -2434,7 +2434,7 @@ static inline int rtl8169_try_rx_copy(st\n \n \t\tskb = dev_alloc_skb(pkt_size + align);\n \t\tif (skb) {\n-\t\t\tskb_reserve(skb, align);\n+\t\t\tskb_reserve(skb, (align - 1) & (u32)skb->data);\n \t\t\teth_copy_and_sum(skb, sk_buff[0]->data, pkt_size, 0);\n \t\t\t*sk_buff = skb;\n \t\t\trtl8169_mark_to_asic(desc, rx_buf_sz);\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Network", "Hardware": "i386 Linux", "Importance": "P2 blocking", "Assignee": "Francois Romieu", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2006-11-14 00:00 UTC by Mike Isely", "Modified": "2006-12-07 16:40 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "2.6.19", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/net/r8169.c"], "methods": ["rtl8169_hw_start"]}
{"id": "7487", "title": "(net sundance) driver fails to recognize carrier status", "description": "Most recent kernel where this bug did not occur: Don't know. Only began checking\non 2.6.17, and it didn't work there.\n\nDistribution: Linux from Scratch\n\nHardware Environment: PIII 500.\n\n$ lspci\n00:00.0 Host bridge: Intel Corporation 440BX/ZX/DX - 82443BX/ZX/DX Host bridge\n(rev 03)\n00:01.0 PCI bridge: Intel Corporation 440BX/ZX/DX - 82443BX/ZX/DX AGP bridge\n(rev 03)\n00:07.0 ISA bridge: Intel Corporation 82371AB/EB/MB PIIX4 ISA (rev 02)\n00:07.1 IDE interface: Intel Corporation 82371AB/EB/MB PIIX4 IDE (rev 01)\n00:07.2 USB Controller: Intel Corporation 82371AB/EB/MB PIIX4 USB (rev 01)\n00:07.3 Bridge: Intel Corporation 82371AB/EB/MB PIIX4 ACPI (rev 02)\n00:0c.0 Multimedia audio controller: Yamaha Corporation YMF-724F [DS-1 Audio\nController] (rev 03)\n00:0e.0 USB Controller: NEC Corporation USB (rev 43)\n00:0e.1 USB Controller: NEC Corporation USB (rev 43)\n00:0e.2 USB Controller: NEC Corporation USB 2.0 (rev 04)\n00:0f.0 Ethernet controller: D-Link System Inc DL10050 Sundance Ethernet (rev 12)\n00:10.0 Serial controller: 3Com Corp, Modem Division 56K FaxModem Model 5610\n(rev 01)\n01:00.0 VGA compatible controller: ATI Technologies Inc RV280 [Radeon 9200 PRO]\n(rev 01)\n01:00.1 Display controller: ATI Technologies Inc RV280 [Radeon 9200 PRO]\n(Secondary) (rev 01)\n\nSoftware Environment:\n\nLinux silky 2.6.18.1-1 #1 PREEMPT Wed Oct 18 18:04:39 PDT 2006 i686 pentium3\ni386 GNU/Linux\n\nGnu C                  4.0.3\nGnu make               3.80\nbinutils               2.16.1\nutil-linux             2.12r\nmount                  2.12r\nmodule-init-tools      3.2.2\ne2fsprogs              1.38\nLinux C Library        2.3.6\nDynamic linker (ldd)   2.3.6\nLinux C++ Library      6.0.7\nProcps                 3.2.6\nNet-tools              1.60\nKbd                    1.12\nSh-utils               5.94\nudev                   096\nModules Loaded         radeon drm ipv6 ipt_REJECT xt_tcpudp iptable_nat ip_nat\nipt_LOG xt_state ip_conntrack_ftp ip_conntrack nfnetlink iptable_filter\nip_tables x_tables binfmt_misc nls_iso8859_1 nls_cp437 vfat fat joydev usbhid\nusblp snd_ymfpci gameport snd_ac97_codec snd_ac97_bus snd_pcm_oss snd_mixer_oss\nsnd_pcm snd_opl3_lib snd_timer snd_hwdep snd_page_alloc snd_mpu401_uart\nsnd_rawmidi snd_seq_device evdev snd sundance intel_agp soundcore agpgart\nehci_hcd mii uhci_hcd ohci_hcd dm_crypt dm_mod fuse\n\nProblem Description:\n\nUsing the D-Link 550-TX with the sundance driver fails to change the carrier\nstatus when plugging/unplugging network cable. Some userspace stats:\n\n# cat /sys/class/net/eth0/carrier\n1\n# ip link show eth0\n2: eth0: <BROADCAST,MULTICAST,NOTRAILERS,UP,10000> mtu 1500 qdisc pfifo_fast\nqlen 1000\n    link/ether 00:05:5d:e5:ae:08 brd ff:ff:ff:ff:ff:ff\n# ifconfig eth0\neth0      Link encap:Ethernet  HWaddr 00:05:5D:E5:AE:08\n          inet addr:192.168.1.2  Bcast:192.168.1.255  Mask:255.255.255.0\n          UP BROADCAST NOTRAILERS RUNNING MULTICAST  MTU:1500  Metric:1\n          RX packets:2 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:44 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:1000\n          RX bytes:608 (608.0 b)  TX bytes:7777 (7.5 Kb)\n          Interrupt:10 Base address:0x1000\n# grep . /sys/class/net/eth0/*\n/sys/class/net/eth0/address:00:05:5d:e5:ae:08\n/sys/class/net/eth0/addr_len:6\n/sys/class/net/eth0/broadcast:ff:ff:ff:ff:ff:ff\n/sys/class/net/eth0/carrier:1\n/sys/class/net/eth0/dormant:0\n/sys/class/net/eth0/features:0x0\n/sys/class/net/eth0/flags:0x1023\n/sys/class/net/eth0/ifindex:2\n/sys/class/net/eth0/iflink:2\n/sys/class/net/eth0/link_mode:0\n/sys/class/net/eth0/mtu:1500\n/sys/class/net/eth0/operstate:unknown\n/sys/class/net/eth0/tx_queue_len:1000\n/sys/class/net/eth0/type:1\ngrep: /sys/class/net/eth0/uevent: Permission denied\n/sys/class/net/eth0/weight:0\n\nThese are all exactly the same when the cable is unplugged.\n\nSteps to reproduce:\n\nBring up network interface, unplug cable. Carrier status doesn't change.", "patch": ["commit 0f38375561438eae2e4fc187231205b2700111a1\nAuthor: Dan Nicholson <dbn.lists@gmail.com>\nDate:   Sat Apr 5 00:06:39 2008 -0700\n\n    sundance: Set carrier status on link change events\n    \n    Check if the link is available when a changed interrupt has been\n    received and set the carrier status appropriately. The code is copied\n    nearly verbatim from the dl2k module. The link status could be used in\n    more places in the driver, but this is enough to get the carrier status\n    reported to userspace. Fixes kernel bug #7487:\n    \n        http://bugzilla.kernel.org/show_bug.cgi?id=7487\n\ndiff --git a/drivers/net/sundance.c b/drivers/net/sundance.c\nindex 7d5561b..79ca0f6 100644\n--- a/drivers/net/sundance.c\n+++ b/drivers/net/sundance.c\n@@ -409,6 +409,7 @@ static int  change_mtu(struct net_device *dev, int new_mtu);\n static int  eeprom_read(void __iomem *ioaddr, int location);\n static int  mdio_read(struct net_device *dev, int phy_id, int location);\n static void mdio_write(struct net_device *dev, int phy_id, int location, int value);\n+static int  mdio_wait_link (struct net_device *dev, int wait);\n static int  netdev_open(struct net_device *dev);\n static void check_duplex(struct net_device *dev);\n static void netdev_timer(unsigned long data);\n@@ -785,6 +786,24 @@ static void mdio_write(struct net_device *dev, int phy_id, int location, int val\n \treturn;\n }\n \n+static int mdio_wait_link (struct net_device *dev, int wait)\n+{\n+\tint bmsr;\n+\tint phy_id;\n+\tstruct netdev_private *np;\n+\n+\tnp = netdev_priv(dev);\n+\tphy_id = np->phys[0];\n+\n+\tdo {\n+\t\tbmsr = mdio_read (dev, phy_id, MII_BMSR);\n+\t\tif (bmsr & 0x0004)\n+\t\t\treturn 0;\n+\t\tmdelay (1);\n+\t} while (--wait > 0);\n+\treturn -1;\n+}\n+\n static int netdev_open(struct net_device *dev)\n {\n \tstruct netdev_private *np = netdev_priv(dev);\n@@ -1393,41 +1412,50 @@ static void netdev_error(struct net_device *dev, int intr_status)\n \tint speed;\n \n \tif (intr_status & LinkChange) {\n-\t\tif (np->an_enable) {\n-\t\t\tmii_advertise = mdio_read (dev, np->phys[0], MII_ADVERTISE);\n-\t\t\tmii_lpa= mdio_read (dev, np->phys[0], MII_LPA);\n-\t\t\tmii_advertise &= mii_lpa;\n-\t\t\tprintk (KERN_INFO \"%s: Link changed: \", dev->name);\n-\t\t\tif (mii_advertise & ADVERTISE_100FULL) {\n-\t\t\t\tnp->speed = 100;\n-\t\t\t\tprintk (\"100Mbps, full duplex\\n\");\n-\t\t\t} else if (mii_advertise & ADVERTISE_100HALF) {\n-\t\t\t\tnp->speed = 100;\n-\t\t\t\tprintk (\"100Mbps, half duplex\\n\");\n-\t\t\t} else if (mii_advertise & ADVERTISE_10FULL) {\n-\t\t\t\tnp->speed = 10;\n-\t\t\t\tprintk (\"10Mbps, full duplex\\n\");\n-\t\t\t} else if (mii_advertise & ADVERTISE_10HALF) {\n-\t\t\t\tnp->speed = 10;\n-\t\t\t\tprintk (\"10Mbps, half duplex\\n\");\n-\t\t\t} else\n-\t\t\t\tprintk (\"\\n\");\n+\t\tif (mdio_wait_link (dev, 10) == 0) {\n+\t\t\tprintk (KERN_INFO \"%s: Link up\\n\", dev->name);\n+\t\t\tif (np->an_enable) {\n+\t\t\t\tmii_advertise = mdio_read (dev, np->phys[0],\n+\t\t\t\t\t\t\t   MII_ADVERTISE);\n+\t\t\t\tmii_lpa= mdio_read (dev, np->phys[0], MII_LPA);\n+\t\t\t\tmii_advertise &= mii_lpa;\n+\t\t\t\tprintk (KERN_INFO \"%s: Link changed: \",\n+\t\t\t\t\tdev->name);\n+\t\t\t\tif (mii_advertise & ADVERTISE_100FULL) {\n+\t\t\t\t\tnp->speed = 100;\n+\t\t\t\t\tprintk (\"100Mbps, full duplex\\n\");\n+\t\t\t\t} else if (mii_advertise & ADVERTISE_100HALF) {\n+\t\t\t\t\tnp->speed = 100;\n+\t\t\t\t\tprintk (\"100Mbps, half duplex\\n\");\n+\t\t\t\t} else if (mii_advertise & ADVERTISE_10FULL) {\n+\t\t\t\t\tnp->speed = 10;\n+\t\t\t\t\tprintk (\"10Mbps, full duplex\\n\");\n+\t\t\t\t} else if (mii_advertise & ADVERTISE_10HALF) {\n+\t\t\t\t\tnp->speed = 10;\n+\t\t\t\t\tprintk (\"10Mbps, half duplex\\n\");\n+\t\t\t\t} else\n+\t\t\t\t\tprintk (\"\\n\");\n \n+\t\t\t} else {\n+\t\t\t\tmii_ctl = mdio_read (dev, np->phys[0], MII_BMCR);\n+\t\t\t\tspeed = (mii_ctl & BMCR_SPEED100) ? 100 : 10;\n+\t\t\t\tnp->speed = speed;\n+\t\t\t\tprintk (KERN_INFO \"%s: Link changed: %dMbps ,\",\n+\t\t\t\t\tdev->name, speed);\n+\t\t\t\tprintk (\"%s duplex.\\n\", (mii_ctl & BMCR_FULLDPLX) ?\n+\t\t\t\t\t\"full\" : \"half\");\n+\t\t\t}\n+\t\t\tcheck_duplex (dev);\n+\t\t\tif (np->flowctrl && np->mii_if.full_duplex) {\n+\t\t\t\tiowrite16(ioread16(ioaddr + MulticastFilter1+2) | 0x0200,\n+\t\t\t\t\tioaddr + MulticastFilter1+2);\n+\t\t\t\tiowrite16(ioread16(ioaddr + MACCtrl0) | EnbFlowCtrl,\n+\t\t\t\t\tioaddr + MACCtrl0);\n+\t\t\t}\n+\t\t\tnetif_carrier_on(dev);\n \t\t} else {\n-\t\t\tmii_ctl = mdio_read (dev, np->phys[0], MII_BMCR);\n-\t\t\tspeed = (mii_ctl & BMCR_SPEED100) ? 100 : 10;\n-\t\t\tnp->speed = speed;\n-\t\t\tprintk (KERN_INFO \"%s: Link changed: %dMbps ,\",\n-\t\t\t\tdev->name, speed);\n-\t\t\tprintk (\"%s duplex.\\n\", (mii_ctl & BMCR_FULLDPLX) ?\n-\t\t\t\t\"full\" : \"half\");\n-\t\t}\n-\t\tcheck_duplex (dev);\n-\t\tif (np->flowctrl && np->mii_if.full_duplex) {\n-\t\t\tiowrite16(ioread16(ioaddr + MulticastFilter1+2) | 0x0200,\n-\t\t\t\tioaddr + MulticastFilter1+2);\n-\t\t\tiowrite16(ioread16(ioaddr + MACCtrl0) | EnbFlowCtrl,\n-\t\t\t\tioaddr + MACCtrl0);\n+\t\t\tprintk (KERN_INFO \"%s: Link down\\n\", dev->name);\n+\t\t\tnetif_carrier_off(dev);\n \t\t}\n \t}\n \tif (intr_status & StatsMax) {\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Network", "Hardware": "i386 Linux", "Importance": "P2 normal", "Assignee": "Jeff Garzik", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2006-11-10 08:18 UTC by Dan Nicholson", "Modified": "2009-03-18 08:51 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "2.6.19", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/net/sundance.c"], "methods": ["netdev_error"]}
{"id": "7462", "title": "hda_intel: insufficient memory for buffer", "description": "Most recent kernel where this bug did not occur:\nDistribution:\nHardware Environment:\nSoftware Environment:\nProblem Description:\nhda_intel driver from ALSA up to 1.0.13 allocates insufficient memory for buffer\nSteps to reproduce:", "patch": ["--- sound/pci/hda/hda_intel.c.orig\t2006-09-29 13:40:36.000000000 +0200\n+++ sound/pci/hda/hda_intel.c\t2006-11-05 16:45:13.000000000 +0100\n@@ -1270,5 +1270,5 @@\n \tsnd_pcm_lib_preallocate_pages_for_all(pcm, SNDRV_DMA_TYPE_DEV,\n \t\t\t\t\t      snd_dma_pci_data(chip->pci),\n-\t\t\t\t\t      1024 * 64, 1024 * 128);\n+\t\t\t\t\t      1024 * 256, 1024 * 4096);\n \tchip->pcm[pcm_dev] = pcm;\n \tif (chip->pcm_devs < pcm_dev + 1)\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Sound", "Hardware": "i386 Linux", "Importance": "P2 normal", "Assignee": "Jaroslav Kysela", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2006-11-05 08:03 UTC by wbrana", "Modified": "2007-07-15 04:48 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "2.6.19", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["sound/pci/hda/hda_intel.c"], "methods": ["create_codec_pcm"]}
{"id": "7385", "title": "nfs4 broken in vanilla-sources 2.6.19", "description": "Most recent kernel where this bug did not occur: 2.6.18\nDistribution: gentoo (vanilla_sources)\nHardware Environment: \nSoftware Environment: nfs-utils 1.0.10, vanilla-sources 2.6.19\nProblem Description:\nIt is not possible to mount a nfs4 export. It fails with the error message can't\nread superblock.\nSteps to reproduce:\ninstall gentoo with vanilla-sources 2.6.19_rc1 or rc2 and nfs-utils 1.0.10 and\nunmask the necessary dependencies\n\nentries in /etc/export\n/export *(rw,fsid=0,insecure,no_subtree_check,sync)\n/export/bla *(rw,nohide,root_squash,insecure,no_subtree_check,async)\n/export/user *(rw,nohide,root_squash,insecure,no_subtree_check,async\n\n/export and /export/bla have group and owner root and chmod 0777\n\ncommands:\nmodprobe nfs\n/etc/init.d/nfs start\n/etc/init.d/nfsmount start\nmount -t nfs4 127.0.0.1:/bla /bla\n\nWatch the computer hanging and then responding with an error in\n/var/log/messages that the server wouldn't respond and mount responding with\n\"... can't read superblock\".\n\nThe problem I had why I tested the kernel was that it is possible to read and\nwrite files on an nfs4 mount as a normal user having none permissions (chmod\n0000) but owning the file. But I can't test it on kernel 2.6.19 because I can't\nmount nfs4 exports.", "patch": ["From: Trond Myklebust <Trond.Myklebust@netapp.com>\nDate: 1158352316 -0400\nSubject: NFSv4: Fix thinko in fs/nfs/super.c\n\nDuh. addr.sin_port should be in network byte order.\n\nSigned-off-by: Trond Myklebust <Trond.Myklebust@netapp.com>\n---\n\n fs/nfs/super.c |    2 +-\n 1 files changed, 1 insertions(+), 1 deletions(-)\n\ndiff --git a/fs/nfs/super.c b/fs/nfs/super.c\nindex 28659a9..28108c8 100644\n--- a/fs/nfs/super.c\n+++ b/fs/nfs/super.c\n@@ -834,7 +834,7 @@ static int nfs4_get_sb(struct file_syste\n \t}\n \t/* RFC3530: The default port for NFS is 2049 */\n \tif (addr.sin_port == 0)\n-\t\taddr.sin_port = NFS_PORT;\n+\t\taddr.sin_port = htons(NFS_PORT);\n \n \t/* Grab the authentication type */\n \tauthflavour = RPC_AUTH_UNIX;\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "File System", "Classification": "Unclassified", "Component": "NFS", "Hardware": "i386 Linux", "Importance": "P2 normal", "Assignee": "Trond Myklebust", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2006-10-19 06:31 UTC by Huemi", "Modified": "2006-10-19 08:23 UTC", "CC List": "0 users", "See Also": "", "Kernel Version": "2.6.19-rc2", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["fs/nfs/super.c"], "methods": ["nfs4_get_sb"]}
{"id": "7306", "title": "Yenta-socket causes oops on insertion of any PCMCIA card", "description": "Most recent kernel where this bug did not occur: 2.6.12\nDistribution: Gentoo 2006.1\nHardware Environment: Apple PowerBook G3 (Lombard)\nSoftware Environment: Gentoo Linux 2006.1 (GCC 4.1.1)\nProblem Description: Machine panics with \"Oops: ...machine check...\" message on insertion of (also if card \nis already in slot on boot) any PCMCIA card with Yenta-socket driver, either as module, or compiled in.  \nFailure appears to be caused by pcmcia_read_cis_mem call according to stacktrace.\n\nSteps to reproduce: Compile yenta-socket support either into kernel or as module and insert PCMCIA card.", "patch": ["Index: linux-work/arch/powerpc/kernel/pci-common.c\n===================================================================\n--- linux-work.orig/arch/powerpc/kernel/pci-common.c\t2008-07-31 14:45:20.000000000 +1000\n+++ linux-work/arch/powerpc/kernel/pci-common.c\t2008-07-31 14:57:31.000000000 +1000\n@@ -650,11 +650,18 @@ void __devinit pci_process_bridge_OF_ran\n \t\t}\n \t}\n \n-\t/* Out of paranoia, let's put the ISA hole last if any */\n-\tif (isa_hole >= 0 && memno > 0 && isa_hole != (memno-1)) {\n-\t\tstruct resource tmp = hose->mem_resources[isa_hole];\n-\t\those->mem_resources[isa_hole] = hose->mem_resources[memno-1];\n-\t\those->mem_resources[memno-1] = tmp;\n+\t/* If there's an ISA hole and the pci_mem_offset is -not- matching\n+\t * the ISA hole offset, then we need to remove the ISA hole from\n+\t * the resource list for that brige\n+\t */\n+\tif (isa_hole >= 0 && hose->pci_mem_offset != isa_mb) {\n+\t\tunsigned int next = isa_hole + 1;\n+\t\tprintk(KERN_INFO \" Removing ISA hole at 0x%016llx\\n\", isa_mb);\n+\t\tif (next < memno)\n+\t\t\tmemmove(&hose->mem_resources[isa_hole],\n+\t\t\t\t&hose->mem_resources[next],\n+\t\t\t\tsizeof(struct resource) * (memno - next));\n+\t\those->mem_resources[--memno].flags = 0;\n \t}\n }\n \n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "PCMCIA", "Hardware": "i386 Linux", "Importance": "P2 high", "Assignee": "Jon Sharp", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2006-10-11 07:17 UTC by Jon Sharp", "Modified": "2009-03-18 08:50 UTC", "CC List": "5 users", "See Also": "", "Kernel Version": "2.6.26", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["arch/powerpc/kernel/pci-common.c"], "methods": ["pci_process_bridge_OF_ranges"]}
{"id": "7303", "title": "Dock driver: Scheduling while atomic BUG during docking.", "description": "Distribution: Debian Unstable\nHardware Environment: Thinkpad T40p and ThinkPad Dock II\nSoftware Environment: ACPI dock driver from vanilla 2.6.18\nProblem Description: If I dock my notebook to the dockingstation, I get the\nattached 'Scheduling while atomic BUG' in my dmesg.\n\nI can still work with this machine afterwards.\n\nSteps to reproduce: Dock the Thinkpad. I tested this with undocking first until\nnow. If you like, I can boot the notebook outside the dock, dock it and see if\nit gives the same result.", "patch": ["Use a mutex instead of a spinlock for locking the\nhotplug list because we need to call into the acpi\nsubsystem which might sleep.\n\nSigned-off-by: Kristen Carlson Accardi <kristen.c.accardi@intel.com>\n---\n drivers/acpi/dock.c |   16 ++++++++--------\n 1 file changed, 8 insertions(+), 8 deletions(-)\n\n--- 2.6-git.orig/drivers/acpi/dock.c\n+++ 2.6-git/drivers/acpi/dock.c\n@@ -44,7 +44,7 @@ struct dock_station {\n \tunsigned long last_dock_time;\n \tu32 flags;\n \tspinlock_t dd_lock;\n-\tspinlock_t hp_lock;\n+\tstruct mutex hp_lock;\n \tstruct list_head dependent_devices;\n \tstruct list_head hotplug_devices;\n };\n@@ -114,9 +114,9 @@ static void\n dock_add_hotplug_device(struct dock_station *ds,\n \t\t\tstruct dock_dependent_device *dd)\n {\n-\tspin_lock(&ds->hp_lock);\n+\tmutex_lock(&ds->hp_lock);\n \tlist_add_tail(&dd->hotplug_list, &ds->hotplug_devices);\n-\tspin_unlock(&ds->hp_lock);\n+\tmutex_unlock(&ds->hp_lock);\n }\n \n /**\n@@ -130,9 +130,9 @@ static void\n dock_del_hotplug_device(struct dock_station *ds,\n \t\t\tstruct dock_dependent_device *dd)\n {\n-\tspin_lock(&ds->hp_lock);\n+\tmutex_lock(&ds->hp_lock);\n \tlist_del(&dd->hotplug_list);\n-\tspin_unlock(&ds->hp_lock);\n+\tmutex_unlock(&ds->hp_lock);\n }\n \n /**\n@@ -295,7 +295,7 @@ static void hotplug_dock_devices(struct \n {\n \tstruct dock_dependent_device *dd;\n \n-\tspin_lock(&ds->hp_lock);\n+\tmutex_lock(&ds->hp_lock);\n \n \t/*\n \t * First call driver specific hotplug functions\n@@ -317,7 +317,7 @@ static void hotplug_dock_devices(struct \n \t\telse\n \t\t\tdock_create_acpi_device(dd->handle);\n \t}\n-\tspin_unlock(&ds->hp_lock);\n+\tmutex_unlock(&ds->hp_lock);\n }\n \n static void dock_event(struct dock_station *ds, u32 event, int num)\n@@ -625,7 +625,7 @@ static int dock_add(acpi_handle handle)\n \tINIT_LIST_HEAD(&dock_station->dependent_devices);\n \tINIT_LIST_HEAD(&dock_station->hotplug_devices);\n \tspin_lock_init(&dock_station->dd_lock);\n-\tspin_lock_init(&dock_station->hp_lock);\n+\tmutex_init(&dock_station->hp_lock);\n \tATOMIC_INIT_NOTIFIER_HEAD(&dock_notifier_list);\n \n \t/* Find dependent devices */\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "Config-Hotplug", "Hardware": "i386 Linux", "Importance": "P2 normal", "Assignee": "Kristen", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2006-10-10 23:53 UTC by Stefan Schmidt", "Modified": "2007-03-08 01:16 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "2.6.18", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/acpi/dock.c"], "methods": ["dock_add_hotplug_device", "dock_del_hotplug_device", "hotplug_dock_devices", "dock_add", "dock_station"]}
{"id": "7234", "title": "bttv initialisation hang, may be i2c locking deadlock", "description": "Most recent kernel where this bug did not occur:\n2.6.18_rc2-mm1\nKernel that have this bug:\nMM-Kernel from 2.6.18_rc6-mm1\n2.6.18-git11 also has this bug\nDistribution: Gentoo-2006.1\nHardware Environment: \n00:00.0 Host bridge: VIA Technologies, Inc. VT8363/8365 [KT133/KM133] (rev 03)\n00:01.0 PCI bridge: VIA Technologies, Inc. VT8363/8365 [KT133/KM133 AGP]\n00:07.0 ISA bridge: VIA Technologies, Inc. VT82C686 [Apollo Super South] (rev \n22)\n00:07.1 IDE interface: VIA Technologies, Inc. \nVT82C586A/B/VT82C686/A/B/VT823x/A/C PIPC Bus Master IDE (rev 10)\n00:07.2 USB Controller: VIA Technologies, Inc. VT82xxxxx UHCI USB 1.1 \nController (rev 10)\n00:07.3 USB Controller: VIA Technologies, Inc. VT82xxxxx UHCI USB 1.1 \nController (rev 10)\n00:07.4 Host bridge: VIA Technologies, Inc. VT82C686 [Apollo Super ACPI] (rev \n30)\n00:07.5 Multimedia audio controller: VIA Technologies, Inc. VT82C686 AC97 Audio \nController (rev 20)\n00:07.6 Communication controller: VIA Technologies, Inc. AC'97 Modem Controller \n(rev 20)\n00:08.0 Ethernet controller: MYSON Technology Inc SURECOM EP-320X-S 100/10M \nEthernet PCI Adapter\n00:09.0 Multimedia video controller: Brooktree Corporation Bt878 Video Capture \n(rev 11)\n00:09.1 Multimedia controller: Brooktree Corporation Bt878 Audio Capture (rev \n11)\n01:00.0 VGA compatible controller: nVidia Corporation NV11 [GeForce2 MX/MX 400] \n(rev a1)\n\n(I only use the Xorg-nv-driver and FB_NVIDIA included in the kernel)\n\nSoftware Environment:\nuptodate Gentoo x86 unstable:\nbinutils-2.17; gcc-4.1.1; udev-100-r2; module-init-tools-3.2.2-r1\nProblem Description:\n\nbooting with bttv compiled into the kernel hangs completly.\nUsing bttv (and its submodules) as modules udev fails to load all needed \nsubmodules, because one modprobe process hangs in state D.\n\nThe system still functions normaly, only my tv-card no longer works.\n\nSteps to reproduce:\nBooting any of the affected kernels on this systems.\n\nMore infos about the hanging processes:\nps axf after booting with bttv as module and then switch to runlevel 1:\n  PID TTY      STAT   TIME COMMAND\n    1 ?        Ss     0:01 init [1]\n    2 ?        SN     0:00 [ksoftirqd/0]\n    3 ?        S<     0:00 [events/0]\n    4 ?        S<     0:00 [khelper]\n 2469 ?        S<     0:00  \\_ [khelper]\n 2470 ?        D<     0:00      \\_ /sbin/modprobe -q -- msp3400\n    5 ?        S<     0:00 [kthread]\n    8 ?        S<     0:00  \\_ [kblockd/0]\n    9 ?        S<     0:00  \\_ [kacpid]\n   71 ?        S<     0:00  \\_ [ksuspend_usbd]\n   74 ?        S<     0:00  \\_ [khubd]\n   76 ?        S<     0:00  \\_ [kseriod]\n  147 ?        S      0:00  \\_ [pdflush]\n  148 ?        S      0:00  \\_ [pdflush]\n  149 ?        S<     0:00  \\_ [kswapd0]\n  150 ?        S<     0:00  \\_ [aio/0]\n  151 ?        S<     0:00  \\_ [xfslogd/0]\n  152 ?        S<     0:00  \\_ [xfsdatad/0]\n  754 ?        S<     0:00  \\_ [ata/0]\n  755 ?        S<     0:00  \\_ [ata_aux]\n  757 ?        S<     0:00  \\_ [scsi_eh_0]\n  758 ?        S<     0:00  \\_ [scsi_eh_1]\n  782 ?        S<     0:00  \\_ [khpsbpkt]\n  809 ?        S<     0:00  \\_ [kpsmoused]\n  843 ?        S<     0:00  \\_ [ac97/0]\n  855 ?        S<     0:00  \\_ [xfsbufd]\n  856 ?        S<     0:00  \\_ [xfssyncd]\n 2480 ?        S<     0:00  \\_ [msp34xx]\n 3514 ?        S<     0:00  \\_ [xfsbufd]\n 3522 ?        S<     0:00  \\_ [xfssyncd]\n 1033 ?        S<s    0:01 /sbin/udevd --daemon\n 1946 ?        D<     0:00 /sbin/modprobe \npci:v0000109Ed0000036Esv00000070sd000013EBbc04sc00i00\n10548 tty1     Ss     0:00 /bin/login --\n10596 tty1     S      0:00  \\_ -bash\n10615 tty1     R+     0:00      \\_ ps axf\n\nrelevant parts of SysRq-T:\n[  204.620000] khelper       S 00000282     0     4      1  2469       5     3 \n(L-TLB)\n[  204.620000]        dffc7f80 00000046 00000086 00000282 dffc7f54 00000086 \n00000000 00000000\n[  204.620000]        0000000a dffc6ab0 4e6ec800 0000001b 00000000 dffc6bc0 \n003d97cf dffe5438\n[  204.620000]        008b20d9 00000000 dffe5428 dffe5430 dffe5420 dffc7f9c \nc0128517 00000001\n[  204.620000] Call Trace:\n[  204.620000]  [<c0128517>] worker_thread+0x107/0x140\n[  204.620000]  [<c01169a0>] default_wake_function+0x0/0x10\n[  204.620000]  [<c0128410>] worker_thread+0x0/0x140\n[  204.620000]  [<c012ace4>] kthread+0xe4/0xf0\n[  204.620000]  [<c012ac00>] kthread+0x0/0xf0\n[  204.620000]  [<c0103a23>] kernel_thread_helper+0x7/0x14\n[  204.620000]  =======================\n[  204.620000] kthread       S 00000296     0     5      1     8    1033     4 \n(L-TLB)\n[  204.620000]        dffd0f80 00000046 00000086 00000296 dffd0f54 00000086 \n00000000 00000000\n[  204.620000]        0000000a dffc6580 e6b47f00 00000012 00000000 dffc6690 \n00000000 dffe5478\n[  204.620000]        00026817 00000000 dffe5468 dffe5470 dffe5460 dffd0f9c \nc0128517 00000001\n[  204.620000] Call Trace:\n[  204.620000]  [<c0128517>] worker_thread+0x107/0x140\n[  204.620000]  [<c01169a0>] default_wake_function+0x0/0x10\n[  204.620000]  [<c0128410>] worker_thread+0x0/0x140\n[  204.620000]  [<c012ace4>] kthread+0xe4/0xf0\n[  204.620000]  [<c012ac00>] kthread+0x0/0xf0\n[  204.620000]  [<c0103a23>] kernel_thread_helper+0x7/0x14\n[  204.620000]  =======================\n[  204.620000] udevd         S 00000246     0  1033      1         10548     5 \n(NOTLB)\n[  204.620000]        df37ab50 00000086 00000046 00000246 df670760 00000246 \n43ba3000 00000027\n[  204.620000]        00000008 dff20580 1623b580 0000002c 00000000 dff20690 \n00000000 00000000\n[  204.620000]        4ead9a00 00000000 00000008 00000000 00000000 00000000 \nc0408eda df103600\n[  204.620000] Call Trace:\n[  204.620000]  [<c0408eda>] schedule_timeout+0x7a/0xd0\n[  204.620000]  [<c0409188>] mutex_lock+0x8/0x20\n[  204.620000]  [<c017b897>] inotify_poll+0x47/0x70\n[  204.620000]  [<c0166c81>] do_select+0x3a1/0x490\n[  204.620000]  [<c0167360>] __pollwait+0x0/0x100\n[  204.620000]  [<c01169a0>] default_wake_function+0x0/0x10\n[  204.620000]  [<c01169a0>] default_wake_function+0x0/0x10\n[  204.620000]  [<c01169a0>] default_wake_function+0x0/0x10\n[  204.620000]  [<c01169a0>] default_wake_function+0x0/0x10\n[  204.620000]  [<c01150a0>] do_page_fault+0x4d0/0x610\n[  204.620000]  [<c0114bd0>] do_page_fault+0x0/0x610\n[  204.620000]  [<c040a089>] error_code+0x39/0x40\n[  204.620000]  [<c013c0a2>] __pagevec_free+0x22/0x30\n[  204.620000]  [<c013e355>] release_pages+0xe5/0x100\n[  204.620000]  [<c036c7e9>] skb_copy_datagram_iovec+0x169/0x220\n[  204.620000]  [<c0184d0e>] proc_alloc_inode+0x3e/0x70\n[  204.620000]  [<c016c8da>] alloc_inode+0xca/0x180\n[  204.620000]  [<c016d688>] iget_locked+0x88/0x140\n[  204.620000]  [<c0184e2d>] proc_get_inode+0xed/0x160\n[  204.620000]  [<c016aff9>] d_instantiate+0x49/0x80\n[  204.620000]  [<c018879d>] proc_lookup+0x7d/0x90\n[  204.620000]  [<c01611f5>] do_lookup+0x65/0x190\n[  204.620000]  [<c0161518>] permission+0xd8/0x100\n[  204.620000]  [<c016b583>] dput+0xb3/0x120\n[  204.620000]  [<c0162d93>] __link_path_walk+0x343/0xdf0\n[  204.620000]  [<c0166f2b>] core_sys_select+0x1bb/0x2f0\n[  204.620000]  [<c0161518>] permission+0xd8/0x100\n[  204.620000]  [<c016f05b>] mntput_no_expire+0x1b/0x70\n[  204.620000]  [<c0162d93>] __link_path_walk+0x343/0xdf0\n[  204.620000]  [<c0161fef>] vfs_rename+0x30f/0x480\n[  204.620000]  [<c016f05b>] mntput_no_expire+0x1b/0x70\n[  204.620000]  [<c01638af>] link_path_walk+0x6f/0xe0\n[  204.620000]  [<c0161518>] permission+0xd8/0x100\n[  204.620000]  [<c011bfe8>] do_wait+0x458/0xa60\n[  204.620000]  [<c016b583>] dput+0xb3/0x120\n[  204.620000]  [<c016b583>] dput+0xb3/0x120\n[  204.620000]  [<c016770b>] sys_select+0x4b/0x1c0\n[  204.620000]  [<c011c621>] sys_wait4+0x31/0x40\n[  204.620000]  [<c0102e2d>] sysenter_past_esp+0x56/0x79\n[  204.620000]  =======================\n[  204.620000] modprobe      D 00000003     0  1946      1               10548 \n(NOTLB)\n[  204.620000]        c17fecb0 00000082 515dbe80 00000003 00000005 dffc6ab0 \n4cc1927a 00000003\n[  204.620000]        00000005 dfade560 515dbe80 00000003 00000000 dfade670 \n01f24b7a 00000000\n[  204.620000]        07270e00 00000000 c17fed24 dffc33e0 c17fed08 c17fecd0 \nc0408a58 00000001\n[  204.620000] Call Trace:\n[  204.620000]  [<c0408a58>] wait_for_completion+0x58/0x90\n[  204.620000]  [<c01169a0>] default_wake_function+0x0/0x10\n[  204.620000]  [<c012798f>] call_usermodehelper_keys+0xbf/0xd0\n[  204.620000]  [<c01279a0>] __call_usermodehelper+0x0/0x70\n[  204.620000]  [<c0127b4c>] request_module+0x9c/0xe0\n[  204.620000]  [<c011a7ab>] printk+0x1b/0x20\n[  204.620000]  [<e1934105>] bttv_I2CRead+0x115/0x130 [bttv]\n[  204.620000]  [<e192f9d5>] bttv_init_card2+0x485/0x1650 [bttv]\n[  204.620000]  [<c0323c51>] i2c_add_adapter+0x41/0x270\n[  204.620000]  [<e192e4a3>] bttv_probe+0x3f3/0x790 [bttv]\n[  204.620000]  [<c0253666>] pci_device_probe+0x56/0x80\n[  204.620000]  [<c02aee5a>] really_probe+0x3a/0xf0\n[  204.620000]  [<c02aef4f>] driver_probe_device+0x3f/0xa0\n[  204.620000]  [<c02af0da>] __driver_attach+0x9a/0xa0\n[  204.620000]  [<c02ae82a>] bus_for_each_dev+0x3a/0x60\n[  204.620000]  [<c02aed66>] driver_attach+0x16/0x20\n[  204.620000]  [<c02af040>] __driver_attach+0x0/0xa0\n[  204.620000]  [<c02ae43b>] bus_add_driver+0x7b/0x190\n[  204.620000]  [<c025380b>] __pci_register_driver+0x5b/0x80\n[  204.620000]  [<c01322b3>] sys_init_module+0x153/0x16f0\n[  204.620000]  [<e191c098>] packet_create+0x108/0x130 [af_packet]\n[  204.620000]  [<e191bfa8>] packet_create+0x18/0x130 [af_packet]\n[  204.620000]  [<e191c0c0>] packet_getname_spkt+0x0/0x90 [af_packet]\n[  204.620000]  [<e191bc84>] packet_sendmsg+0x1c4/0x270 [af_packet]\n[  204.620000]  [<e191c0e8>] packet_getname_spkt+0x28/0x90 [af_packet]\n[  204.620000]  [<c0102e2d>] sysenter_past_esp+0x56/0x79\n[  204.620000]  =======================\n[  204.620000] khelper       S 00000002     0  2469      4  2470               \n(L-TLB)\n[  204.620000]        df1c4f3c 00000046 c01161a7 00000002 df533560 df1c4f18 \n00000282 00800111\n[  204.620000]        00000002 dffa7ab0 51f65500 00000003 00000000 dffa7bc0 \n00000000 00000000\n[  204.620000]        00000000 00000000 c17fed08 df533560 00000001 00000004 \nc011c17e 00000000\n[  204.620000] Call Trace:\n[  204.620000]  [<c01161a7>] __activate_task+0x27/0x40\n[  204.620000]  [<c011c17e>] do_wait+0x5ee/0xa60\n[  204.620000]  [<c01012fe>] kernel_thread+0x8e/0xb0\n[  204.620000]  [<c01169a0>] default_wake_function+0x0/0x10\n[  204.620000]  [<c011c621>] sys_wait4+0x31/0x40\n[  204.620000]  [<c0127a86>] wait_for_helper+0x76/0xa0\n[  204.620000]  [<c0127a10>] wait_for_helper+0x0/0xa0\n[  204.620000]  [<c0103a23>] kernel_thread_helper+0x7/0x14\n[  204.620000]  =======================\n[  204.620000] modprobe      D DF670900     0  2470   2469                     \n(NOTLB)\n[  204.620000]        df705d74 00000086 c1496560 df670900 df533560 dffc6690 \ndffd0f80 c040858b\n[  204.620000]        00000001 df533560 54f14580 00000003 00000000 df533670 \n54f14580 00000003\n[  204.620000]        01c9c380 00000000 e1946d4c ffffffff df533560 e1946d50 \nc0409292 e1946d50\n[  204.620000] Call Trace:\n[  204.620000]  [<c040858b>] __sched_text_start+0x2ab/0x5e0\n[  204.620000]  [<c0409292>] __mutex_lock_slowpath+0x42/0x70\n[  204.620000]  [<c0409193>] mutex_lock+0x13/0x20\n[  204.620000]  [<c0323b6b>] i2c_clients_command+0x1b/0xc0\n[  204.620000]  [<e19342d7>] attach_inform+0xb7/0x110 [bttv]\n[  204.620000]  [<c0324103>] i2c_attach_client+0x73/0x1c0\n[  204.620000]  [<e08dd8fb>] msp_attach+0x42b/0x5c0 [msp3400]\n[  204.620000]  [<e08df0f0>] msp3410d_thread+0x0/0x560 [msp3400]\n[  204.620000]  [<c03231ee>] i2c_probe_address+0x3e/0x130\n[  204.620000]  [<c018e38a>] sysfs_create_link+0x7a/0x180\n[  204.620000]  [<c03234ec>] i2c_probe+0x20c/0x220\n[  204.620000]  [<e08dd4d0>] msp_attach+0x0/0x5c0 [msp3400]\n[  204.620000]  [<c02af333>] driver_create_file+0x33/0x50\n[  204.620000]  [<e08dd4d0>] msp_attach+0x0/0x5c0 [msp3400]\n[  204.620000]  [<c03238a9>] i2c_register_driver+0x79/0xa0\n[  204.620000]  [<c01322b3>] sys_init_module+0x153/0x16f0\n[  204.620000]  [<c0102e2d>] sysenter_past_esp+0x56/0x79\n[  204.620000]  =======================\n[  204.620000] msp34xx       S 00000246     0  2480      5          3514   856 \n(L-TLB)\n[  204.620000]        df924f70 00000046 00000000 00000246 df359b00 00000000 \ndf217300 00000001\n[  204.620000]        00000009 c1509560 54f14580 00000003 00000000 c1509670 \ndffc6580 df924f68\n[  204.620000]        00000000 00000000 dec6b73c ffffffff dec6b6c0 df93be00 \ne08dc9b4 00000000\n[  204.620000] Call Trace:\n[  204.620000]  [<e08dc9b4>] msp_sleep+0xc4/0xd0 [msp3400]\n[  204.620000]  [<c01169a0>] default_wake_function+0x0/0x10\n[  204.620000]  [<e08df174>] msp3410d_thread+0x84/0x560 [msp3400]\n[  204.620000]  [<e08df0f0>] msp3410d_thread+0x0/0x560 [msp3400]\n[  204.620000]  [<c012ace4>] kthread+0xe4/0xf0\n[  204.620000]  [<c012ac00>] kthread+0x0/0xf0\n[  204.620000]  [<c0103a23>] kernel_thread_helper+0x7/0x14\n[  204.620000]  =======================\n\nFor me it looks like a deadlock in the i2c locking:\n* modprobe-1946 waits for the khelper-thread, but has\ni2c_add_adapter+0x41/0x270 in its calltrace\n* modprobe-2470 from the khelper-thread waits for a mutex related to\ni2c_clients_command+0x1b/0xc0\n\ndmesg from not working kernel 2.6.18-git11:\n[    0.000000] Linux version 2.6.18-git11 (root@ariolc) (gcc version 4.1.1 \n(Gentoo 4.1.1-r1)) #1 Fri Sep 29 20:11:42 CEST 2006\n[    0.000000] BIOS-provided physical RAM map:\n[    0.000000]  BIOS-e820: 0000000000000000 - 000000000009fc00 (usable)\n[    0.000000]  BIOS-e820: 000000000009fc00 - 00000000000a0000 (reserved)\n[    0.000000]  BIOS-e820: 00000000000f0000 - 0000000000100000 (reserved)\n[    0.000000]  BIOS-e820: 0000000000100000 - 000000001fff0000 (usable)\n[    0.000000]  BIOS-e820: 000000001fff0000 - 000000001fff3000 (ACPI NVS)\n[    0.000000]  BIOS-e820: 000000001fff3000 - 0000000020000000 (ACPI data)\n[    0.000000]  BIOS-e820: 00000000ffff0000 - 0000000100000000 (reserved)\n[    0.000000] 511MB LOWMEM available.\n[    0.000000] Entering add_active_range(0, 0, 131056) 0 entries of 256 used\n[    0.000000] Zone PFN ranges:\n[    0.000000]   DMA             0 ->     4096\n[    0.000000]   Normal       4096 ->   131056\n[    0.000000] early_node_map[1] active PFN ranges\n[    0.000000]     0:        0 ->   131056\n[    0.000000] On node 0 totalpages: 131056\n[    0.000000]   DMA zone: 32 pages used for memmap\n[    0.000000]   DMA zone: 0 pages reserved\n[    0.000000]   DMA zone: 4064 pages, LIFO batch:0\n[    0.000000]   Normal zone: 991 pages used for memmap\n[    0.000000]   Normal zone: 125969 pages, LIFO batch:31\n[    0.000000] DMI 2.3 present.\n[    0.000000] ACPI: RSDP (v000 BIOSTA                                ) @ \n0x000f7440\n[    0.000000] ACPI: RSDT (v001 BIOSTA AWRDACPI 0x42302e31 AWRD 0x00000000) @ \n0x1fff3000\n[    0.000000] ACPI: FADT (v001 BIOSTA AWRDACPI 0x42302e31 AWRD 0x00000000) @ \n0x1fff3040\n[    0.000000] ACPI: DSDT (v001 VIA694 AWRDACPI 0x00001000 MSFT 0x0100000c) @ \n0x00000000\n[    0.000000] ACPI: PM-Timer IO Port: 0x4008\n[    0.000000] Allocating PCI resources starting at 30000000 (gap: \n20000000:dfff0000)\n[    0.000000] Detected 1002.305 MHz processor.\n[   19.250911] Built 1 zonelists.  Total pages: 130033\n[   19.250916] Kernel command line: root=/dev/sdb2 console=ttyS0,38400 \nconsole=tty1 lapic\n[   19.251317] Local APIC disabled by BIOS -- reenabling.\n[   19.251322] Found and enabled local APIC!\n[   19.251328] mapped APIC to ffffd000 (fee00000)\n[   19.251335] Enabling fast FPU save and restore... done.\n[   19.251340] Initializing CPU#0\n[   19.251476] CPU 0 irqstacks, hard=c0592000 soft=c0591000\n[   19.251483] PID hash table entries: 2048 (order: 11, 8192 bytes)\n[   19.252670] Console: colour VGA+ 80x25\n[   19.699175] Dentry cache hash table entries: 65536 (order: 6, 262144 bytes)\n[   19.720682] Inode-cache hash table entries: 32768 (order: 5, 131072 bytes)\n[   19.775239] Memory: 514192k/524224k available (3115k kernel code, 9480k \nreserved, 1332k data, 200k init, 0k highmem)\n[   19.806833] virtual kernel memory layout:\n[   19.806835]     fixmap  : 0xfffb7000 - 0xfffff000   ( 288 kB)\n[   19.806838]     vmalloc : 0xe0800000 - 0xfffb5000   ( 503 MB)\n[   19.806841]     lowmem  : 0xc0000000 - 0xdfff0000   ( 511 MB)\n[   19.806844]       .init : 0xc055a000 - 0xc058c000   ( 200 kB)\n[   19.806847]       .data : 0xc040add2 - 0xc055801c   (1332 kB)\n[   19.806850]       .text : 0xc0100000 - 0xc040add2   (3115 kB)\n[   19.922390] Checking if this processor honours the WP bit even in supervisor \nmode... Ok.\n[   20.090938] Calibrating delay using timer specific routine.. 2006.03 \nBogoMIPS (lpj=10030169)\n[   20.116398] Security Framework v1.0.0 initialized\n[   20.130559] Mount-cache hash table entries: 512\n[   20.144376] CPU: After generic identify, caps: 0183fbff c1c7fbff 00000000 \n00000000 00000000 00000000 00000000\n[   20.144391] CPU: L1 I Cache: 64K (64 bytes/line), D cache 64K (64 \nbytes/line)\n[   20.165812] CPU: L2 Cache: 256K (64 bytes/line)\n[   20.179422] CPU: After all inits, caps: 0183fbff c1c7fbff 00000000 00000420 \n00000000 00000000 00000000\n[   20.179434] Intel machine check architecture supported.\n[   20.195142] Intel machine check reporting enabled on CPU#0.\n[   20.211889] CPU: AMD Athlon(tm) Processor stepping 02\n[   20.227217] Checking 'hlt' instruction... OK.\n[   20.272277] ACPI: Core revision 20060707\n[   20.293071] ACPI: setting ELCR to 0800 (from 0e20)\n[   20.571309] NET: Registered protocol family 16\n[   20.584668] spurious 8259A interrupt: IRQ7.\n[   20.584842] ACPI: bus type pci registered\n[   20.613412] PCI: PCI BIOS revision 2.10 entry at 0xfb380, last bus=1\n[   20.632496] PCI: Using configuration type 1\n[   20.645070] Setting up standard PCI resources\n[   20.678366] ACPI: Interpreter enabled\n[   20.689397] ACPI: Using PIC for interrupt routing\n[   20.704509] ACPI: PCI Root Bridge [PCI0] (0000:00)\n[   20.718933] PCI: Probing PCI hardware (bus 00)\n[   20.719067] ACPI: Assume root bridge [\\_SB_.PCI0] bus is 0\n[   20.738008] Disabling VIA memory write queue (PCI ID 0305, rev 03): [55] 81 \n& 1f -> 01\n[   20.762094] PCI quirk: region 4000-40ff claimed by vt82c586 ACPI\n[   20.780142] PCI quirk: region 6000-607f claimed by vt82c686 HW-mon\n[   20.798706] PCI quirk: region 5000-500f claimed by vt82c686 SMB\n[   20.816897] Boot video device is 0000:01:00.0\n[   20.816960] ACPI: PCI Interrupt Routing Table [\\_SB_.PCI0._PRT]\n[   20.845634] ACPI: PCI Interrupt Link [LNKA] (IRQs 1 3 4 5 6 7 10 *11 12 14 \n15)\n[   20.868819] ACPI: PCI Interrupt Link [LNKB] (IRQs 1 3 4 5 6 7 *10 11 12 14 \n15)\n[   20.892033] ACPI: PCI Interrupt Link [LNKC] (IRQs 1 3 4 *5 6 7 10 11 12 14 \n15)\n[   20.915251] ACPI: PCI Interrupt Link [LNKD] (IRQs 1 3 4 5 6 7 10 11 12 14 \n15) *9\n[   20.942867] Linux Plug and Play Support v0.97 (c) Adam Belay\n[   20.959882] pnp: PnP ACPI init\n[   20.969184] pnp: ACPI device : hid PNP0C01\n[   20.969687] pnp: ACPI device : hid PNP0A03\n[   20.970174] pnp: ACPI device : hid PNP0C02\n[   20.970252] pnp: ACPI device : hid PNP0200\n[   20.970324] pnp: ACPI device : hid PNP0B00\n[   20.970408] pnp: ACPI device : hid PNP0800\n[   20.970478] pnp: ACPI device : hid PNP0C04\n[   20.970841] pnp: ACPI device : hid PNP0700\n[   20.971278] pnp: ACPI device : hid PNP0501\n[   20.972067] pnp: ACPI device : hid PNP0501\n[   20.973083] pnp: ACPI device : hid PNP0400\n[   20.973937] pnp: ACPI device : hid PNP0F13\n[   20.974075] pnp: ACPI device : hid PNP0303\n[   20.974157] pnp: PnP ACPI: found 13 devices\n[   20.986836] Generic PHY: Registered new driver\n[   21.000445] SCSI subsystem initialized\n[   21.011831] usbcore: registered new interface driver usbfs\n[   21.028370] usbcore: registered new interface driver hub\n[   21.044386] usbcore: registered new device driver usb\n[   21.059684] PCI: Using ACPI for IRQ routing\n[   21.072256] PCI: If a device doesn't work, try \"pci=routeirq\".  If it helps, \npost a report\n[   21.127722] pnp: the driver 'system' has been registered\n[   21.127772] pnp: match found with the PnP device '00:00' and the \ndriver 'system'\n[   21.127788] pnp: match found with the PnP device '00:02' and the \ndriver 'system'\n[   21.128195] PCI: Bridge: 0000:00:01.0\n[   21.139224]   IO window: disabled.\n[   21.149463]   MEM window: dc000000-ddffffff\n[   21.162033]   PREFETCH window: d0000000-d7ffffff\n[   21.175923] PCI: Setting latency timer of device 0000:00:01.0 to 64\n[   21.175969] NET: Registered protocol family 2\n[   21.280278] IP route cache hash table entries: 4096 (order: 2, 16384 bytes)\n[   21.301350] TCP established hash table entries: 16384 (order: 4, 65536 \nbytes)\n[   21.323070] TCP bind hash table entries: 8192 (order: 3, 32768 bytes)\n[   21.342556] TCP: Hash tables configured (established 16384 bind 8192)\n[   21.361882] TCP reno registered\n[   21.374030] Total HugeTLB memory allocated, 0\n[   21.387259] VFS: Disk quotas dquot_6.5.1\n[   21.399102] Dquot-cache hash table entries: 1024 (order 0, 4096 bytes)\n[   21.418872] SGI XFS with ACLs, security attributes, no debug enabled\n[   21.438164] SGI XFS Quota Management subsystem\n[   21.451599] io scheduler noop registered\n[   21.463489] io scheduler cfq registered (default)\n[   21.477809] PCI: Disabling Via external APIC routing\n[   21.492747] pci 0000:00:07.2: uhci_check_and_reset_hc: legsup = 0x2000\n[   21.492752] pci 0000:00:07.2: Performing full reset\n[   21.492769] pci 0000:00:07.3: uhci_check_and_reset_hc: legsup = 0x2000\n[   21.492773] pci 0000:00:07.3: Performing full reset\n[   21.493122] ACPI: CPU0 (power states: C1[C1] C2[C2])\n[   21.508288] ACPI: Processor [CPU0] (supports 2 throttling states)\n[   21.566883] Real Time Clock Driver v1.12ac\n[   21.579423] Non-volatile memory driver v1.2\n[   21.592069] Linux agpgart interface v0.101 (c) Dave Jones\n[   21.608415] agpgart: Detected VIA Twister-K/KT133x/KM133 chipset\n[   21.633376] agpgart: AGP aperture is 64M @ 0xd8000000\n[   21.648722] [drm] Initialized drm 1.0.1 20051102\n[   21.662676] Serial: 8250/16550 driver $Revision: 1.90 $ 1 ports, IRQ sharing \ndisabled\n[   21.686423] serial8250: ttyS0 at I/O 0x3f8 (irq = 4) is a 16550A\n[   21.704956] pnp: the driver 'serial' has been registered\n[   21.705101] pnp: match found with the PnP device '00:08' and the \ndriver 'serial'\n[   21.705404] 00:08: ttyS0 at I/O 0x3f8 (irq = 4) is a 16550A\n[   21.722476] pnp: match found with the PnP device '00:09' and the \ndriver 'serial'\n[   21.722818] pnp: Device 00:09 disabled.\n[   21.734582] parport_pc: VIA 686A/8231 detected\n[   21.734587] parport_pc: probing current configuration\n[   21.734606] parport_pc: Current parallel port base: 0x378\n[   21.734652] parport0: PC-style at 0x378, irq 7 [PCSPP,TRISTATE,EPP]\n[    1.420000] parport_pc: VIA parallel port: io=0x378, irq=7\n[    1.430000] Floppy drive(s): fd0 is 1.44M\n[    1.460000] FDC 0 is a post-1991 82077\n[    1.470000] fealnx.c:v2.52 Sep-11-2006\n[    1.480000] ACPI: PCI Interrupt Link [LNKA] enabled at IRQ 11\n[    1.490000] PCI: setting IRQ 11 as level-triggered\n[    1.490000] ACPI: PCI Interrupt 0000:00:08.0[A] -> Link [LNKA] -> GSI 11 \n(level, low) -> IRQ 11\n[    1.520000] eth0: 100/10M Ethernet PCI Adapter at 0001ec00, \n00:02:2a:c0:86:2a, IRQ 11.\n[    1.540000] Linux video capture interface: v2.00\n[    1.550000] libata version 2.00 loaded.\n[    1.550000] pata_via 0000:00:07.1: version 0.1.14\n[    1.550000] PCI: VIA IRQ fixup for 0000:00:07.1, from 255 to 0\n[    1.560000] ata1: PATA max UDMA/66 cmd 0x1F0 ctl 0x3F6 bmdma 0xD000 irq 14\n[    1.570000] ata2: PATA max UDMA/66 cmd 0x170 ctl 0x376 bmdma 0xD008 irq 15\n[    1.580000] scsi0 : pata_via\n[    1.750000] ata1.00: ATA-6, max UDMA/100, 39865392 sectors: LBA\n[    1.760000] ata1.00: ata1: dev 0 multi count 16\n[    1.770000] ata1.01: ATA-7, max UDMA/133, 490234752 sectors: LBA48\n[    1.780000] ata1.01: ata1: dev 1 multi count 16\n[    1.800000] ata1.00: configured for UDMA/33\n[    1.810000] ata1.01: configured for UDMA/33\n[    1.820000] scsi1 : pata_via\n[    2.150000] ata2.00: ATAPI, max MWDMA2\n[    2.320000] ata2.01: ATAPI, max MWDMA2\n[    2.490000] ata2.00: configured for MWDMA2\n[    2.660000] ata2.01: configured for MWDMA2\n[    2.670000] scsi 0:0:0:0: Direct-Access     ATA      SAMSUNG SV2042H  PK10 \nPQ: 0 ANSI: 5\n[    2.680000] SCSI device sda: 39865392 512-byte hdwr sectors (20411 MB)\n[    2.690000] sda: Write Protect is off\n[    2.700000] sda: Mode Sense: 00 3a 00 00\n[    2.700000] SCSI device sda: drive cache: write back\n[    2.710000] SCSI device sda: 39865392 512-byte hdwr sectors (20411 MB)\n[    2.720000] sda: Write Protect is off\n[    2.730000] sda: Mode Sense: 00 3a 00 00\n[    2.730000] SCSI device sda: drive cache: write back\n[    2.740000]  sda: sda1 sda2 < sda5 >\n[    2.770000] sd 0:0:0:0: Attached scsi disk sda\n[    2.790000] scsi 0:0:1:0: Direct-Access     ATA      Maxtor 6L250R0   BAH4 \nPQ: 0 ANSI: 5\n[    2.800000] SCSI device sdb: 490234752 512-byte hdwr sectors (251000 MB)\n[    2.810000] sdb: Write Protect is off\n[    2.820000] sdb: Mode Sense: 00 3a 00 00\n[    2.820000] SCSI device sdb: drive cache: write back\n[    2.830000] SCSI device sdb: 490234752 512-byte hdwr sectors (251000 MB)\n[    2.840000] sdb: Write Protect is off\n[    2.850000] sdb: Mode Sense: 00 3a 00 00\n[    2.850000] SCSI device sdb: drive cache: write back\n[    2.860000]  sdb: sdb1 sdb2 sdb3 sdb4 < sdb5 sdb6 >\n[    2.930000] sd 0:0:1:0: Attached scsi disk sdb\n[    2.940000] scsi 1:0:0:0: CD-ROM            SAMSUNG  DVD-ROM SD-612S  SS06 \nPQ: 0 ANSI: 5\n[    2.950000] scsi 1:0:1:0: CD-ROM            SAMSUNG  CD-R/RW SW-208B  BS04 \nPQ: 0 ANSI: 5\n[    2.960000] ieee1394: Initialized config rom entry `ip1394'\n[    2.960000] ieee1394: sbp2: Driver forced to serialize I/O (serialize_io=1)\n[    2.970000] ieee1394: sbp2: Try serialize_io=0 for better performance\n[    2.980000] ehci_hcd: block sizes: qh 128 qtd 96 itd 192 sitd 96\n[    2.980000] ohci_hcd: 2006 August 04 USB 1.1 'Open' Host Controller (OHCI) \nDriver (PCI)\n[    2.980000] ohci_hcd: block sizes: ed 64 td 64\n[    2.980000] USB Universal Host Controller Interface driver v3.0\n[    2.990000] ACPI: PCI Interrupt Link [LNKD] enabled at IRQ 10\n[    3.000000] PCI: setting IRQ 10 as level-triggered\n[    3.000000] ACPI: PCI Interrupt 0000:00:07.2[D] -> Link [LNKD] -> GSI 10 \n(level, low) -> IRQ 10\n[    3.020000] PCI: VIA IRQ fixup for 0000:00:07.2, from 9 to 10\n[    3.030000] uhci_hcd 0000:00:07.2: UHCI Host Controller\n[    3.040000] drivers/usb/core/inode.c: creating file 'devices'\n[    3.040000] drivers/usb/core/inode.c: creating file '001'\n[    3.040000] uhci_hcd 0000:00:07.2: new USB bus registered, assigned bus \nnumber 1\n[    3.050000] uhci_hcd 0000:00:07.2: detected 2 ports\n[    3.060000] uhci_hcd 0000:00:07.2: uhci_check_and_reset_hc: cmd = 0x0000\n[    3.060000] uhci_hcd 0000:00:07.2: Performing full reset\n[    3.060000] uhci_hcd 0000:00:07.2: irq 10, io base 0x0000d400\n[    3.070000] usb usb1: default language 0x0409\n[    3.070000] usb usb1: new device strings: Mfr=3, Product=2, SerialNumber=1\n[    3.070000] usb usb1: Product: UHCI Host Controller\n[    3.080000] usb usb1: Manufacturer: Linux 2.6.18-git11 uhci_hcd\n[    3.090000] usb usb1: SerialNumber: 0000:00:07.2\n[    3.100000] usb usb1: uevent\n[    3.100000] usb usb1: usb_probe_device\n[    3.100000] usb usb1: configuration #1 chosen from 1 choice\n[    3.110000] usb usb1: adding 1-0:1.0 (config #1, interface 0)\n[    3.110000] usb 1-0:1.0: uevent\n[    3.110000] hub 1-0:1.0: usb_probe_interface\n[    3.110000] hub 1-0:1.0: usb_probe_interface - got id\n[    3.110000] hub 1-0:1.0: USB hub found\n[    3.120000] hub 1-0:1.0: 2 ports detected\n[    3.130000] hub 1-0:1.0: standalone hub\n[    3.130000] hub 1-0:1.0: no power switching (usb 1.0)\n[    3.130000] hub 1-0:1.0: individual port over-current protection\n[    3.130000] hub 1-0:1.0: power on to power good time: 2ms\n[    3.130000] hub 1-0:1.0: local power source is good\n[    3.130000] hub 1-0:1.0: trying to enable port power on non-switchable hub\n[    3.240000] hub 1-0:1.0: state 7 ports 2 chg 0000 evt 0000\n[    3.240000] drivers/usb/core/inode.c: creating file '001'\n[    3.240000] ACPI: PCI Interrupt 0000:00:07.3[D] -> Link [LNKD] -> GSI 10 \n(level, low) -> IRQ 10\n[    3.260000] PCI: VIA IRQ fixup for 0000:00:07.3, from 9 to 10\n[    3.270000] uhci_hcd 0000:00:07.3: UHCI Host Controller\n[    3.280000] uhci_hcd 0000:00:07.2: port 1 portsc 018a,00\n[    3.280000] hub 1-0:1.0: port 1, status 0300, change 0003, 1.5 Mb/s\n[    3.280000] drivers/usb/core/inode.c: creating file '002'\n[    3.280000] uhci_hcd 0000:00:07.3: new USB bus registered, assigned bus \nnumber 2\n[    3.290000] uhci_hcd 0000:00:07.3: detected 2 ports\n[    3.300000] uhci_hcd 0000:00:07.3: uhci_check_and_reset_hc: cmd = 0x0000\n[    3.300000] uhci_hcd 0000:00:07.3: Performing full reset\n[    3.300000] uhci_hcd 0000:00:07.3: irq 10, io base 0x0000d800\n[    3.310000] usb usb2: default language 0x0409\n[    3.310000] usb usb2: new device strings: Mfr=3, Product=2, SerialNumber=1\n[    3.310000] usb usb2: Product: UHCI Host Controller\n[    3.320000] usb usb2: Manufacturer: Linux 2.6.18-git11 uhci_hcd\n[    3.330000] usb usb2: SerialNumber: 0000:00:07.3\n[    3.340000] usb usb2: uevent\n[    3.340000] usb usb2: usb_probe_device\n[    3.340000] usb usb2: configuration #1 chosen from 1 choice\n[    3.350000] usb usb2: adding 2-0:1.0 (config #1, interface 0)\n[    3.350000] usb 2-0:1.0: uevent\n[    3.350000] hub 2-0:1.0: usb_probe_interface\n[    3.350000] hub 2-0:1.0: usb_probe_interface - got id\n[    3.350000] hub 2-0:1.0: USB hub found\n[    3.360000] hub 2-0:1.0: 2 ports detected\n[    3.370000] hub 2-0:1.0: standalone hub\n[    3.370000] hub 2-0:1.0: no power switching (usb 1.0)\n[    3.370000] hub 2-0:1.0: individual port over-current protection\n[    3.370000] hub 2-0:1.0: power on to power good time: 2ms\n[    3.370000] hub 2-0:1.0: local power source is good\n[    3.370000] hub 2-0:1.0: trying to enable port power on non-switchable hub\n[    3.460000] hub 1-0:1.0: debounce: port 1: total 100ms stable 100ms status \n0x300\n[    3.460000] uhci_hcd 0000:00:07.2: port 2 portsc 018a,00\n[    3.460000] hub 1-0:1.0: port 2, status 0300, change 0003, 1.5 Mb/s\n[    3.480000] drivers/usb/core/inode.c: creating file '001'\n[    3.620000] hub 1-0:1.0: debounce: port 2: total 100ms stable 100ms status \n0x300\n[    3.620000] hub 1-0:1.0: state 7 ports 2 chg 0000 evt 0000\n[    3.620000] hub 2-0:1.0: state 7 ports 2 chg 0000 evt 0006\n[    3.620000] uhci_hcd 0000:00:07.3: port 1 portsc 018a,00\n[    3.620000] hub 2-0:1.0: port 1, status 0300, change 0003, 1.5 Mb/s\n[    3.780000] hub 2-0:1.0: debounce: port 1: total 100ms stable 100ms status \n0x300\n[    3.780000] uhci_hcd 0000:00:07.3: port 2 portsc 018a,00\n[    3.780000] hub 2-0:1.0: port 2, status 0300, change 0003, 1.5 Mb/s\n[    3.940000] hub 2-0:1.0: debounce: port 2: total 100ms stable 100ms status \n0x300\n[    3.940000] hub 2-0:1.0: state 7 ports 2 chg 0000 evt 0000\n[    3.940000] usbcore: registered new interface driver libusual\n[    3.950000] pnp: the driver 'i8042 kbd' has been registered\n[    3.950000] pnp: match found with the PnP device '00:0c' and the \ndriver 'i8042 kbd'\n[    3.950000] pnp: the driver 'i8042 aux' has been registered\n[    3.950000] pnp: match found with the PnP device '00:0b' and the \ndriver 'i8042 aux'\n[    3.950000] PNP: PS/2 Controller [PNP0303:PS2K,PNP0f13:PS2M] at 0x60,0x64 \nirq 1,12\n[    3.960000] serio: i8042 AUX port at 0x60,0x64 irq 12\n[    3.970000] serio: i8042 KBD port at 0x60,0x64 irq 1\n[    3.980000] mice: PS/2 mouse device common for all mice\n[    3.990000] input: PC Speaker as /class/input/input0\n[    4.020000] input: AT Translated Set 2 keyboard as /class/input/input1\n[    4.030000] i2c /dev entries driver\n[    4.180000] input: GenPS/2 Genius Mouse as /class/input/input2\n[    4.240000] Advanced Linux Sound Architecture Driver Version 1.0.12rc1 (Thu \nJun 22 13:55:50 2006 UTC).\n[    4.250000] ACPI: PCI Interrupt Link [LNKB] enabled at IRQ 10\n[    4.260000] ACPI: PCI Interrupt 0000:00:09.1[A] -> Link [LNKB] -> GSI 10 \n(level, low) -> IRQ 10\n[    4.280000] ACPI: PCI Interrupt Link [LNKC] enabled at IRQ 5\n[    4.290000] PCI: setting IRQ 5 as level-triggered\n[    4.290000] ACPI: PCI Interrupt 0000:00:07.5[C] -> Link [LNKC] -> GSI 5 \n(level, low) -> IRQ 5\n[    4.310000] PCI: Setting latency timer of device 0000:00:07.5 to 64\n[    4.490000] usb usb1: suspend_rh (auto-stop)\n[    4.830000] ALSA device list:\n[    4.830000]   #0: VIA 82C686A/B rev20 with STAC9721,23 at 0xdc00, irq 5\n[    4.840000]   #1: Brooktree Bt878 at 0xdf002000, irq 10\n[    4.850000] NET: Registered protocol family 1\n[    4.860000] NET: Registered protocol family 10\n[    4.870000] lo: Disabled Privacy Extensions\n[    4.880000] IPv6 over IPv4 tunneling driver\n[    4.890000] Testing NMI watchdog ... <7>usb usb2: suspend_rh (auto-stop)\n[    5.010000] OK.\n[    5.020000] Using IPI Shortcut mode\n[    5.030000] ACPI: (supports<6>Time: tsc clocksource has been installed.\n[    5.050000]  S0 S1 S4<6>Time: acpi_pm clocksource has been installed.\n[    5.070000]  S5)\n[    5.130000] XFS mounting filesystem sdb2\n[    5.240000] Ending clean XFS mount for filesystem: sdb2\n[    5.240000] VFS: Mounted root (xfs filesystem) readonly.\n[    5.250000] Freeing unused kernel memory: 200k freed\n[    6.730000] warning: process `touch' used the removed sysctl system call\n[    7.220000] usb 2-0:1.0: uevent\n[    7.220000] usb usb2: uevent\n[    7.220000] usb 1-0:1.0: uevent\n[    7.220000] usb usb1: uevent\n[   10.500000] sr0: scsi3-mmc drive: 16x/40x cd/rw xa/form2 cdda tray\n[   10.500000] Uniform CD-ROM driver Revision: 3.20\n[   10.510000] sr 1:0:0:0: Attached scsi CD-ROM sr0\n[   10.510000] sr1: scsi3-mmc drive: 8x/32x writer cd/rw xa/form2 cdda tray\n[   10.510000] sr 1:0:1:0: Attached scsi CD-ROM sr1\n[   10.570000] ACPI: PCI Interrupt 0000:01:00.0[A] -> Link [LNKA] -> GSI 11 \n(level, low) -> IRQ 11\n[   10.570000] nvidiafb: Device ID: 10de0110\n[   10.840000] nvidiafb: EDID found from BUS1\n[   10.860000] nvidiafb: Unable to detect which CRTCNumber...\n[   10.860000] ...Defaulting to CRTCNumber 0\n[   10.860000] nvidiafb: Using CRT on CRTC 0\n[   10.860000] nvidiafb: MTRR set to ON\n[   10.860000] nvidiafb: PCI nVidia NV11 framebuffer (32MB @ 0xD0000000)\n[   14.140000] bttv: driver version 0.9.16 loaded\n[   14.140000] bttv: using 8 buffers with 2080k (520 pages) each for capture\n[   14.140000] bttv: Bt8xx card found (0).\n[   14.140000] ACPI: PCI Interrupt 0000:00:09.0[A] -> Link [LNKB] -> GSI 10 \n(level, low) -> IRQ 10\n[   14.140000] bttv0: Bt878 (rev 17) at 0000:00:09.0, irq: 10, latency: 32, \nmmio: 0xdf001000\n[   14.140000] bttv0: detected: Hauppauge WinTV [card=10], PCI subsystem ID is \n0070:13eb\n[   14.140000] bttv0: using: Hauppauge (bt878) [card=10,autodetected]\n[   14.140000] bttv0: gpio: en=00000000, out=00000000 in=00ffffdb [init]\n[   14.150000] bttv0: Hauppauge/Voodoo msp34xx: reset line init [5]\n[   14.250000] tveeprom 4-0050: Hauppauge model 61344, rev D421, serial# \n3902813\n[   14.250000] tveeprom 4-0050: tuner model is Philips FM1216 (idx 21, type 5)\n[   14.250000] tveeprom 4-0050: TV standards PAL(B/G) (eeprom 0x04)\n[   14.250000] tveeprom 4-0050: audio processor is MSP3415 (idx 6)\n[   14.250000] tveeprom 4-0050: has radio\n[   14.250000] bttv0: Hauppauge eeprom indicates model#61344\n[   14.250000] bttv0: using tuner=5\n[   14.250000] bttv0: i2c: checking for MSP34xx @ 0x80... found\n[   14.310000] msp3400 4-0040: MSP3415D-B3 found @ 0x80 (bt878 #0 [sw])\n[   14.310000] msp3400 4-0040: MSP3415D-B3 supports nicam, mode is autodetect\n[   79.910000] warning: process `blogd' used the removed sysctl system call\n[   79.970000] warning: process `touch' used the removed sysctl system call\n[   80.050000] warning: process `touch' used the removed sysctl system call\n[   80.110000] warning: process `touch' used the removed sysctl system call\n[   81.070000] XFS mounting filesystem sdb6\n[   81.180000] Ending clean XFS mount for filesystem: sdb6\n[   81.320000] Adding 497972k swap on /dev/sdb5.  Priority:-1 extents:1 \nacross:497972k\n[  117.330000] NET: Registered protocol family 17\n[  126.560000] eth0: no IPv6 routers present\n\nbttv-part of dmesg from working kernel 2.6.18_rc2-mm1:\nSep 29 20:21:33 ariolc [   12.740000] bttv: driver version 0.9.16 loaded\nSep 29 20:21:33 ariolc [   12.740000] bttv: using 8 buffers with 2080k (520 \npages) each for capture\nSep 29 20:21:33 ariolc [   12.740000] bttv: Bt8xx card found (0).\nSep 29 20:21:33 ariolc [   12.740000] ACPI: PCI Interrupt 0000:00:09.0[A] -> \nLink [LNKB] -> GSI 10 (level, low) -> IRQ 10\nSep 29 20:21:33 ariolc [   12.740000] bttv0: Bt878 (rev 17) at 0000:00:09.0, \nirq: 10, latency: 32, mmio: 0xdf001000\nSep 29 20:21:33 ariolc [   12.740000] bttv0: detected: Hauppauge WinTV \n[card=10], PCI subsystem ID is 0070:13eb\nSep 29 20:21:33 ariolc [   12.740000] bttv0: using: Hauppauge (bt878) \n[card=10,autodetected]\nSep 29 20:21:33 ariolc [   12.740000] bttv0: gpio: en=00000000, out=00000000 \nin=00ffffdb [init]\nSep 29 20:21:33 ariolc [   12.740000] bttv0: Hauppauge/Voodoo msp34xx: reset \nline init [5]\nSep 29 20:21:33 ariolc [   12.760000] msp3400 1-0040: MSP3415D-B3 found @ 0x80 \n(bt878 #0 [sw])\nSep 29 20:21:33 ariolc [   12.760000] msp3400 1-0040: MSP3415D-B3 supports \nnicam, mode is autodetect\nSep 29 20:21:33 ariolc [   12.870000] tveeprom 1-0050: Hauppauge model 61344, \nrev D421, serial# 3902813\nSep 29 20:21:33 ariolc [   12.870000] tveeprom 1-0050: tuner model is Philips \nFM1216 (idx 21, type 5)\nSep 29 20:21:33 ariolc [   12.870000] tveeprom 1-0050: TV standards PAL(B/G) \n(eeprom 0x04)\nSep 29 20:21:33 ariolc [   12.870000] tveeprom 1-0050: audio processor is \nMSP3415 (idx 6)\nSep 29 20:21:33 ariolc [   12.870000] tveeprom 1-0050: has radio\nSep 29 20:21:33 ariolc [   12.870000] bttv0: Hauppauge eeprom indicates \nmodel#61344\nSep 29 20:21:33 ariolc [   12.870000] bttv0: using tuner=5\nSep 29 20:21:33 ariolc [   12.870000] bttv0: i2c: checking for MSP34xx @ \n0x80... found\nSep 29 20:21:33 ariolc [   12.880000] bttv0: i2c: checking for TDA9875 @ \n0xb0... not found\nSep 29 20:21:33 ariolc [   12.890000] bttv0: i2c: checking for TDA7432 @ \n0x8a... not found\nSep 29 20:21:33 ariolc [   13.410000] bttv0: i2c: checking for TDA9887 @ \n0x86... not found\nSep 29 20:21:33 ariolc [   13.440000] tuner 1-0061: chip found @ 0xc2 (bt878 #0 \n[sw])\nSep 29 20:21:33 ariolc [   13.440000] tuner 1-0061: type set to 5 (Philips \nPAL_BG (FI1216 and compatibles))\nSep 29 20:21:33 ariolc [   13.690000] bttv0: registered device video0\nSep 29 20:21:33 ariolc [   13.700000] bttv0: registered device vbi0\nSep 29 20:21:33 ariolc [   13.700000] bttv0: registered device radio0\nSep 29 20:21:33 ariolc [   13.730000] bttv0: PLL: 28636363 => 35468950 .. ok", "patch": ["---\n drivers/i2c/i2c-core.c |   25 +++++++++++++------------\n 1 file changed, 13 insertions(+), 12 deletions(-)\n\n--- linux-2.6.18.orig/drivers/i2c/i2c-core.c\t2006-09-29 22:50:11.000000000 +0200\n+++ linux-2.6.18/drivers/i2c/i2c-core.c\t2006-09-30 12:37:27.000000000 +0200\n@@ -420,14 +420,6 @@\n \t}\n \tlist_add_tail(&client->list,&adapter->clients);\n \t\n-\tif (adapter->client_register)  {\n-\t\tif (adapter->client_register(client))  {\n-\t\t\tdev_dbg(&adapter->dev, \"client_register \"\n-\t\t\t\t\"failed for client [%s] at 0x%02x\\n\",\n-\t\t\t\tclient->name, client->addr);\n-\t\t}\n-\t}\n-\n \tclient->usage_count = 0;\n \n \tclient->dev.parent = &client->adapter->dev;\n@@ -445,10 +437,17 @@\n \tres = device_create_file(&client->dev, &dev_attr_client_name);\n \tif (res)\n \t\tgoto out_unregister;\n-\n-out_unlock:\n \tmutex_unlock(&adapter->clist_lock);\n-\treturn res;\n+\n+\tif (adapter->client_register)  {\n+\t\tif (adapter->client_register(client)) {\n+\t\t\tdev_dbg(&adapter->dev, \"client_register \"\n+\t\t\t\t\"failed for client [%s] at 0x%02x\\n\",\n+\t\t\t\tclient->name, client->addr);\n+\t\t}\n+\t}\n+\n+\treturn 0;\n \n out_unregister:\n \tinit_completion(&client->released); /* Needed? */\n@@ -458,7 +457,9 @@\n \tlist_del(&client->list);\n \tdev_err(&adapter->dev, \"Failed to attach i2c client %s at 0x%02x \"\n \t\t\"(%d)\\n\", client->name, client->addr, res);\n-\tgoto out_unlock;\n+out_unlock:\n+\tmutex_unlock(&adapter->clist_lock);\n+\treturn res;\n }\n \n \n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "I2C", "Hardware": "i386 Linux", "Importance": "P2 high", "Assignee": "Jean Delvare", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2006-09-29 11:57 UTC by Torsten Kaiser", "Modified": "2006-10-01 00:49 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "2.6.18", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/i2c/i2c-core.c"], "methods": ["i2c_attach_client"]}
{"id": "7206", "title": "acpi not recognize residual charge on packard bell easynote S5011", "description": "On start of my notebook, with kde, Klaptop not display my residual charge.\n\nStart with only battery:\n\nconfix@portatile ~ $ cat /proc/acpi/battery/BAT1/info\npresent:                 no\n\nconfix@portatile ~ $ cat /proc/acpi/battery/BAT1/state\npresent:                 no\n\nAfter i insert and disconnect AC Power Supply:\n\nconfix@portatile ~ $ cat /proc/acpi/battery/BAT1/state\npresent:                 yes\ncapacity state:          ok\ncharging state:          discharging\npresent rate:            2240 mA\nremaining capacity:      1731 mAh\npresent voltage:         12321 mV\n\nconfix@portatile ~ $ cat /proc/acpi/battery/BAT1/info\npresent:                 yes\ndesign capacity:         4000 mAh\nlast full capacity:      3089 mAh\nbattery technology:      rechargeable\ndesign voltage:          9600 mV\ndesign capacity warning: 400 mAh\ndesign capacity low:     123 mAh\ncapacity granularity 1:  64 mAh\ncapacity granularity 2:  64 mAh\nmodel number:            PC-VP-WP66/OP-570-76620\nserial number:\nbattery type:            NiMH\nOEM info:                NEC\n\nand klaptop display residual charge.", "patch": ["diff -rup linux-2.6.18-a/drivers/acpi/battery.c linux-2.6.18-b/drivers/acpi/battery.c\n--- linux-2.6.18-a/drivers/acpi/battery.c\t2006-09-27 23:12:16.000000000 +0400\n+++ linux-2.6.18-b/drivers/acpi/battery.c\t2006-09-27 23:12:09.000000000 +0400\n@@ -324,6 +324,13 @@ static int acpi_battery_check(struct acp\n \treturn result;\n }\n \n+static void acpi_battery_check_present(struct acpi_battery *battery)\n+{\n+\tif (!battery->flags.present) {\n+\t\tacpi_battery_check(battery);\n+\t}\n+}\n+\n /* --------------------------------------------------------------------------\n                               FS Interface (/proc)\n    -------------------------------------------------------------------------- */\n@@ -340,6 +347,8 @@ static int acpi_battery_read_info(struct\n \tif (!battery)\n \t\tgoto end;\n \n+\tacpi_battery_check_present(battery);\n+\n \tif (battery->flags.present)\n \t\tseq_printf(seq, \"present:                 yes\\n\");\n \telse {\n@@ -424,6 +433,8 @@ static int acpi_battery_read_state(struc\n \tif (!battery)\n \t\tgoto end;\n \n+\tacpi_battery_check_present(battery);\n+\n \tif (battery->flags.present)\n \t\tseq_printf(seq, \"present:                 yes\\n\");\n \telse {\n@@ -499,6 +510,8 @@ static int acpi_battery_read_alarm(struc\n \tif (!battery)\n \t\tgoto end;\n \n+\tacpi_battery_check_present(battery);\n+\n \tif (!battery->flags.present) {\n \t\tseq_printf(seq, \"present:                 no\\n\");\n \t\tgoto end;\n@@ -536,6 +549,8 @@ acpi_battery_write_alarm(struct file *fi\n \tif (!battery || (count > sizeof(alarm_string) - 1))\n \t\treturn -EINVAL;\n \n+\tacpi_battery_check_present(battery);\n+\n \tif (!battery->flags.present)\n \t\treturn -ENODEV;\n \n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "Power-Battery", "Hardware": "i386 Linux", "Importance": "P2 normal", "Assignee": "Vladimir Lebedev", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2006-09-26 03:23 UTC by Fanini Enrico", "Modified": "2006-10-13 11:45 UTC", "CC List": "0 users", "See Also": "", "Kernel Version": "2.6.20", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/acpi/battery.c"], "methods": ["acpi_battery_read_info", "acpi_battery_read_state", "acpi_battery_read_alarm", "acpi_battery_write_alarm"]}
{"id": "7201", "title": "Connecting Nokia E70 via USB - unregistering non-registered device?", "description": "Most recent kernel where this bug did not occur: None I know\nDistribution: Debian unstable, but my own kernel compile off kernel.org\nHardware Environment: Toshiba R100, with docking station\nSoftware Environment: Debian unstable\nProblem Description:\n\nI connect the nokia E70 (a symbian S60 3rd edition device) to the USB, and\nselect \"PC Suite\". The kernel spews the following:\n\nSep 25 16:16:52 r100 kernel: usb 1-3.4: new full speed USB device using ehci_hcd\nand address 9\nSep 25 16:16:52 r100 kernel: usb 1-3.4: configuration #1 chosen from 1 choice\nSep 25 16:16:53 r100 kernel: cdc_acm 1-3.4:1.12: ttyACM0: USB ACM device\nSep 25 16:16:53 r100 kernel: usbcore: registered new driver cdc_acm\nSep 25 16:16:53 r100 kernel: drivers/usb/class/cdc-acm.c: v0.25:USB Abstract\nControl Model driver for USB modems and ISDN adapters\nSep 25 16:16:53 r100 kernel: usbcore: registered new driver cdc_ether\nSep 25 16:16:53 r100 kernel: usb%%d: unregister 'rndis_host'\nusb-0000:00:1d.7-3.4, RNDIS device\nSep 25 16:16:53 r100 kernel: unregister_netdevice: device usb%%d/c343b000 never\nwas registered\nSep 25 16:16:53 r100 kernel: Modules linked in: rndis_host cdc_ether usbnet\ncdc_acm rfcomm l2cap thermal fan button processor ac battery usblp mct_u232\nusbserial ipv6 usbhid hci_usb bluetooth arc4 ieee80211_crypt_wep msdos fat\nnls_iso8859_1 ntfs dm_snapshot dm_mirror dm_mod ide_cd cdrom 8250_pci joydev\nsnd_intel8x0 snd_intel8x0m snd_ac97_codec snd_ac97_bus snd_pcm_oss snd_mixer_oss\nmousedev snd_pcm snd_timer tsdev snd ipw2100 ehci_hcd uhci_hcd intel_agp\nsoundcore yenta_socket rsrc_nonstatic pcmcia ieee80211 ieee80211_crypt shpchp\npci_hotplug usbcore agpgart psmouse pcmcia_core rtc snd_page_alloc\nfirmware_class pcspkr e100 mii serio_raw evdev ext3 jbd mbcache ide_disk\nide_generic via82cxxx trm290 triflex slc90e66 sis5513 siimage serverworks sc1200\nrz1000 piix pdc202xx_old pdc202xx_new opti621 ns87415 it821x hpt366 hpt34x\ngeneric cy82c693 cs5535 cs5530 cs5520 cmd64x atiixp amd74xx alim15x3 aec62xx\nide_core\nSep 25 16:16:53 r100 kernel: EIP:    0060:[<b0154b0f>]    Not tainted VLI\nSep 25 16:16:53 r100 kernel: EFLAGS: 00010046   (2.6.18 #2) \nSep 25 16:16:53 r100 kernel:  [<d0bd3014>] usbnet_probe+0x4ee/0x503 [usbnet]\nSep 25 16:16:53 r100 kernel:  [<b020ce28>] __driver_attach+0x0/0x5d\nSep 25 16:16:53 r100 kernel:  [<d0941ba1>] usb_probe_interface+0x58/0x87 [usbcore]\nSep 25 16:16:53 r100 kernel:  [<b020cd89>] driver_probe_device+0x42/0x8b\nSep 25 16:16:53 r100 kernel:  [<b020ce60>] __driver_attach+0x38/0x5d\nSep 25 16:16:53 r100 kernel:  [<b020c8aa>] bus_for_each_dev+0x33/0x55\nSep 25 16:16:53 r100 kernel:  [<b020ccf3>] driver_attach+0x11/0x13\nSep 25 16:16:53 r100 kernel:  [<b020ce28>] __driver_attach+0x0/0x5d\nSep 25 16:16:53 r100 kernel:  [<b020c5c3>] bus_add_driver+0x64/0xfd\nSep 25 16:16:53 r100 kernel:  [<d09419d6>] usb_register_driver+0x60/0xbb [usbcore]\nSep 25 16:16:53 r100 kernel:  [<b01354ce>] sys_init_module+0x1692/0x1815\nSep 25 16:16:53 r100 kernel:  [<b0102c73>] syscall_call+0x7/0xb\nSep 25 16:16:53 r100 udevd-event[5375]: run_program: '/sbin/modprobe' abnormal exit\n\nUSB system bocomes unstable. on 2.6.17 (debian version -2) the kernel would\ncrash pretty fast after this. In this version it seems I can still use firefox\nto send this bug.\n\nSteps to reproduce:\n\nAs above.", "patch": ["--- linux-2.6.20-rc4/drivers/usb/net/rndis_host.c.orig\t2007-01-15 19:23:01.000000000 +0100\n+++ linux-2.6.20-rc4/drivers/usb/net/rndis_host.c\t2007-01-15 19:23:11.000000000 +0100\n@@ -379,6 +379,7 @@\n {\n \tint\t\t\tretval;\n \tstruct net_device\t*net = dev->net;\n+\tstruct cdc_state\t*info = (void *) &dev->data;\n \tunion {\n \t\tvoid\t\t\t*buf;\n \t\tstruct rndis_msg_hdr\t*header;\n@@ -397,7 +398,7 @@\n \t\treturn -ENOMEM;\n \tretval = usbnet_generic_cdc_bind(dev, intf);\n \tif (retval < 0)\n-\t\tgoto done;\n+\t\tgoto fail;\n \n \tnet->hard_header_len += sizeof (struct rndis_data_hdr);\n \n@@ -412,10 +413,7 @@\n \tif (unlikely(retval < 0)) {\n \t\t/* it might not even be an RNDIS device!! */\n \t\tdev_err(&intf->dev, \"RNDIS init failed, %d\\n\", retval);\n-fail:\n-\t\tusb_driver_release_interface(driver_of(intf),\n-\t\t\t((struct cdc_state *)&(dev->data))->data);\n-\t\tgoto done;\n+\t\tgoto fail_and_release;\n \t}\n \tdev->hard_mtu = le32_to_cpu(u.init_c->max_transfer_size);\n \t/* REVISIT:  peripheral \"alignment\" request is ignored ... */\n@@ -431,7 +429,7 @@\n \tretval = rndis_command(dev, u.header);\n \tif (unlikely(retval < 0)) {\n \t\tdev_err(&intf->dev, \"rndis get ethaddr, %d\\n\", retval);\n-\t\tgoto fail;\n+\t\tgoto fail_and_release;\n \t}\n \ttmp = le32_to_cpu(u.get_c->offset);\n \tif (unlikely((tmp + 8) > (1024 - ETH_ALEN)\n@@ -439,7 +437,7 @@\n \t\tdev_err(&intf->dev, \"rndis ethaddr off %d len %d ?\\n\",\n \t\t\ttmp, le32_to_cpu(u.get_c->len));\n \t\tretval = -EDOM;\n-\t\tgoto fail;\n+\t\tgoto fail_and_release;\n \t}\n \tmemcpy(net->dev_addr, tmp + (char *)&u.get_c->request_id, ETH_ALEN);\n \n@@ -455,11 +453,18 @@\n \tretval = rndis_command(dev, u.header);\n \tif (unlikely(retval < 0)) {\n \t\tdev_err(&intf->dev, \"rndis set packet filter, %d\\n\", retval);\n-\t\tgoto fail;\n+\t\tgoto fail_and_release;\n \t}\n \n \tretval = 0;\n-done:\n+\n+\tkfree(u.buf);\n+\treturn retval;\n+\n+fail_and_release:\t\n+\tusb_set_intfdata(info->data, NULL);\n+\tusb_driver_release_interface(driver_of(intf), info->data);\n+fail:\t\n \tkfree(u.buf);\n \treturn retval;\n }\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "USB", "Hardware": "i386 Linux", "Importance": "P2 high", "Assignee": "Greg Kroah-Hartman", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2006-09-25 06:17 UTC by Sam Freed", "Modified": "2007-06-30 16:18 UTC", "CC List": "13 users", "See Also": "", "Kernel Version": "2.6.18", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/usb/net/rndis_host.c"], "methods": ["rndis_bind"]}
{"id": "7200", "title": "battery not detected on laptop - nec versa p550", "description": "Most recent kernel where this bug did not occur:\nDistribution: fedora/ubuntu/suse\nHardware Environment: nec versa p550\nSoftware Environment: fedora core <= 5.90, ubuntu <= 6.06, suse 10\nProblem Description: The battery is not found after booting. But when I plugin  \nthe power cord or remove it then the battery is and remains detected.\n\nSteps to reproduce: \nBoot and see: battery not present.\n\nacpi version: 1.04\n\nBattery info after plugging in the cable:\n$ cat /proc/acpi/battery/BAT1/info\npresent:                 yes\ndesign capacity:         4800 mAh\nlast full capacity:      3507 mAh\nbattery technology:      rechargeable\ndesign voltage:          14800 mV\ndesign capacity warning: 400 mAh\ndesign capacity low:     140 mAh\ncapacity granularity 1:  64 mAh\ncapacity granularity 2:  64 mAh\nmodel number:            PC-VP-WP66/OP-570-76620\nserial number:\nbattery type:            LION\nOEM info:                NEC", "patch": ["diff -rup linux-2.6.20-rc6.a/drivers/acpi/battery.c linux-2.6.20-rc6.b/drivers/acpi/battery.c\n--- linux-2.6.20-rc6.a/drivers/acpi/battery.c\t2007-01-29 08:15:58.000000000 +0300\n+++ linux-2.6.20-rc6.b/drivers/acpi/battery.c\t2007-01-29 08:19:07.000000000 +0300\n@@ -324,6 +324,13 @@ static int acpi_battery_check(struct acp\n \treturn result;\n }\n \n+static void acpi_battery_check_present(struct acpi_battery *battery)\n+{\n+\tif (!battery->flags.present) {\n+\t\tacpi_battery_check(battery);\n+\t}\n+}\n+\n /* --------------------------------------------------------------------------\n                               FS Interface (/proc)\n    -------------------------------------------------------------------------- */\n@@ -340,6 +347,8 @@ static int acpi_battery_read_info(struct\n \tif (!battery)\n \t\tgoto end;\n \n+\tacpi_battery_check_present(battery);\n+\n \tif (battery->flags.present)\n \t\tseq_printf(seq, \"present:                 yes\\n\");\n \telse {\n@@ -424,6 +433,8 @@ static int acpi_battery_read_state(struc\n \tif (!battery)\n \t\tgoto end;\n \n+\tacpi_battery_check_present(battery);\n+\n \tif (battery->flags.present)\n \t\tseq_printf(seq, \"present:                 yes\\n\");\n \telse {\n@@ -499,6 +510,8 @@ static int acpi_battery_read_alarm(struc\n \tif (!battery)\n \t\tgoto end;\n \n+\tacpi_battery_check_present(battery);\n+\n \tif (!battery->flags.present) {\n \t\tseq_printf(seq, \"present:                 no\\n\");\n \t\tgoto end;\n@@ -536,6 +549,8 @@ acpi_battery_write_alarm(struct file *fi\n \tif (!battery || (count > sizeof(alarm_string) - 1))\n \t\treturn -EINVAL;\n \n+\tacpi_battery_check_present(battery);\n+\n \tif (!battery->flags.present)\n \t\treturn -ENODEV;\n \n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "Power-Battery", "Hardware": "i386 Linux", "Importance": "P2 normal", "Assignee": "Vladimir Lebedev", "URL": "", "Keywords": "", "Duplicates (1)": "6183", "Depends on": "", "Blocks": "", "Reported": "2006-09-25 04:03 UTC by Stefan Geuns", "Modified": "2007-02-20 22:39 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "2.6.20", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/acpi/battery.c"], "methods": ["acpi_battery_read_info", "acpi_battery_read_state", "acpi_battery_read_alarm", "acpi_battery_write_alarm"]}
{"id": "7180", "title": "aic94xx driver locks up on IBM x366 with Calgary IOMMU enabled", "description": "Most recent kernel where this bug did not occur: 2.6.17\nDistribution: Ubuntu 6.06\nHardware Environment: IBM x366, 4x 3.16GHz Xeon, 8G RAM, aic94xx SAS controller,\n6x 36G SAS disks, Calgary IOMMU\nSoftware Environment: netbooted Ubuntu mutant.\nProblem Description: aic94xx driver NMIs the system if calgary iommu is enabled.\n\nSteps to reproduce:\n1. Clone linux-2.6 and add in scsi-misc, scsi-rc-fixes and aic94xx from\ngit.kernel.org.\n2. Build a netbootable \"allmodconfig\" kernel with attached config file.\n3. Calgary IOMMU code activates\n4. Subsequent loading of the aic94xx driver causes the service processor to log\na PCI SERR with a split completion timeout, followed by an NMI, followed by a\nreboot.\n\nNote that disabling the Calgary IOMMU for the bus that the SAS controller is\nconnected to (either via kconfig or iommu=none or calgary=disable=1) will make\nthe problem go away.", "patch": ["diff --git a/arch/x86_64/kernel/pci-calgary.c b/arch/x86_64/kernel/pci-calgary.c\nindex b3296cc..3124265 100644\n--- a/arch/x86_64/kernel/pci-calgary.c\n+++ b/arch/x86_64/kernel/pci-calgary.c\n@@ -732,6 +732,22 @@ static void calgary_watchdog(unsigned lo\n \t}\n }\n \n+#define CONFIG_REGISTER 0x108\n+static void __init calgary_disable_sc_timeout(void __iomem *bbar)\n+{\n+\tu64 val64;\n+\tvoid __iomem *target;\n+\n+\ttarget = calgary_reg(bbar, CONFIG_REGISTER);\n+\tval64 = be64_to_cpu(readq(target));\n+\t/* sets PHB1 timeout to 0x1110, which is a 2s timeout */\n+\tval64 &= 0xFFFFFF0FFFFFFFFF;\n+\tval64 |= 0x000000E000000000;\n+\twriteq(cpu_to_be64(val64), target);\n+\treadq(target); /* flush */\n+}\n+\n+\n static void __init calgary_enable_translation(struct pci_dev *dev)\n {\n \tu32 val32;\n@@ -756,6 +772,9 @@ static void __init calgary_enable_transl\n \twritel(cpu_to_be32(val32), target);\n \treadl(target); /* flush */\n \n+\tif (busnum == 1)\n+\t\tcalgary_disable_sc_timeout(bbar);\n+\n \tinit_timer(&tbl->watchdog_timer);\n \ttbl->watchdog_timer.function = &calgary_watchdog;\n \ttbl->watchdog_timer.data = (unsigned long)dev;\n", "diff -r 3f7bc84201e7 arch/x86_64/kernel/pci-calgary.c\n--- a/arch/x86_64/kernel/pci-calgary.c\tWed Oct 18 09:14:19 2006 +0200\n+++ b/arch/x86_64/kernel/pci-calgary.c\tWed Oct 18 11:48:51 2006 +0200\n@@ -52,7 +52,8 @@\n #define ONE_BASED_CHASSIS_NUM   1\n \n /* register offsets inside the host bridge space */\n-#define PHB_CSR_OFFSET\t\t0x0110\n+#define CALGARY_CONFIG_REG\t0x0108\n+#define PHB_CSR_OFFSET\t\t0x0110 /* Channel Status */\n #define PHB_PLSSR_OFFSET\t0x0120\n #define PHB_CONFIG_RW_OFFSET\t0x0160\n #define PHB_IOBASE_BAR_LOW\t0x0170\n@@ -83,6 +84,8 @@\n #define TAR_VALID\t\t0x0000000000000008UL\n /* CSR (Channel/DMA Status Register) */\n #define CSR_AGENT_MASK\t\t0xffe0ffff\n+/* CCR (Calgary Configuration Register) */\n+#define CCR_2SEC_TIMEOUT        0x000000000000000EUL\n \n #define MAX_NUM_OF_PHBS\t\t8 /* how many PHBs in total? */\n #define MAX_NUM_CHASSIS\t\t8 /* max number of chassis */\n@@ -732,6 +735,45 @@ static void calgary_watchdog(unsigned lo\n \t}\n }\n \n+static void __init calgary_increase_split_completion_timeout(void __iomem *bbar,\n+\tunsigned char busnum)\n+{\n+\tu64 val64;\n+\tvoid __iomem *target;\n+\tunsigned long phb_shift = -1;\n+\tu64 mask;\n+\n+\tswitch (busno_to_phbid(busnum)) {\n+\tcase 0: phb_shift = (63 - 19);\n+\t\tbreak;\n+\tcase 1: phb_shift = (63 - 23);\n+\t\tbreak;\n+\tcase 2: phb_shift = (63 - 27);\n+\t\tbreak;\n+\tcase 3: phb_shift = (63 - 35);\n+\t\tbreak;\n+\tdefault:\n+\t\tBUG_ON(busno_to_phbid(busnum));\n+\t}\n+\n+\ttarget = calgary_reg(bbar, CALGARY_CONFIG_REG);\n+\tval64 = be64_to_cpu(readq(target));\n+\n+\t/* zero out this PHB's timer bits */\n+\tmask = ~(0xFUL << phb_shift);\n+\tprintk(\"Calgary mask: 0x%Lx [%s]\\n\", mask,\n+\t       (mask == 0xFFFFFF0FFFFFFFFF) ? \"same\" : \"different\");\n+\tval64 &= mask;\n+\n+\tval64 |= (CCR_2SEC_TIMEOUT << phb_shift);\n+\tprintk(\"Calgary timeout val: 0x%lx [%s]\\n\",\n+\t       (CCR_2SEC_TIMEOUT << phb_shift),\n+\t       ((CCR_2SEC_TIMEOUT << phb_shift) == 0x000000E000000000) ?\n+\t       \"same\" : \"different\");\n+\twriteq(cpu_to_be64(val64), target);\n+\treadq(target); /* flush */\n+}\n+\n static void __init calgary_enable_translation(struct pci_dev *dev)\n {\n \tu32 val32;\n@@ -755,6 +797,13 @@ static void __init calgary_enable_transl\n \n \twritel(cpu_to_be32(val32), target);\n \treadl(target); /* flush */\n+\n+\t/*\n+\t * Give split completion a longer timeout on bus 1 for aic94xx\n+\t * http://bugzilla.kernel.org/show_bug.cgi?id=7180\n+\t */\n+\tif (busnum == 1)\n+\t\tcalgary_increase_split_completion_timeout(bbar, busnum);\n \n \tinit_timer(&tbl->watchdog_timer);\n \ttbl->watchdog_timer.function = &calgary_watchdog;\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "SCSI Drivers", "Classification": "Unclassified", "Component": "AIC94XX", "Hardware": "i386 Linux", "Importance": "P2 normal", "Assignee": "Muli Ben-Yehuda", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2006-09-21 18:01 UTC by Darrick J. Wong", "Modified": "2006-10-24 04:50 UTC", "CC List": "3 users", "See Also": "", "Kernel Version": "2.6.18", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["arch/x86_64/kernel/pci-calgary.c"], "methods": ["calgary_enable_translation"]}
{"id": "7153", "title": "oops on ipmi_msghandler removal for non ipmi systems", "description": "On a system *without* ipmi:\n- modprobe ipmi_si (it'll load also ipmi_msghandler)\n- the ipmi_si module returns of course -ENODEV\n- rmmod ipmi_msghandler\n- watch the kernel oopsing\n\nThe cause of this bug is a forgotten step in the error path. The ipmi_si module\nnever calls driver_unregister in his error path. \nA fix will be provided in the next comment :)", "patch": ["IPMI: Fix oops on ipmi_msghandler removal for non ipmi systems\n\nWhen the ipmi_si module is loaded on a system without any ipmi device, it fails\nwith nodev. It would be fine if all resources were freed. A call to \ndevice_unregister() is missing, resulting to a oops when you remove the \nipmi_msghandler.\n\n\nSigned-Off-by: Arnaud Patard <apatard@mandriva.com>\n\n---\n\nIndex: linux-2.6.17/drivers/char/ipmi/ipmi_si_intf.c\n===================================================================\n--- linux-2.6.17.orig/drivers/char/ipmi/ipmi_si_intf.c\n+++ linux-2.6.17/drivers/char/ipmi/ipmi_si_intf.c\n@@ -2549,6 +2549,7 @@ static __devinit int init_ipmi_si(void)\n #ifdef CONFIG_PCI\n \t\tpci_unregister_driver(&ipmi_pci_driver);\n #endif\n+\t\tdriver_unregister(&ipmi_driver);\n \t\tprintk(\"ipmi_si: Unable to find any System Interface(s)\\n\");\n \t\treturn -ENODEV;\n \t} else {\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Other", "Hardware": "i386 Linux", "Importance": "P2 normal", "Assignee": "drivers_other", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2006-09-13 04:39 UTC by Arnaud Patard", "Modified": "2006-10-05 05:24 UTC", "CC List": "1 user", "See Also": "", "Kernel Version": "2.6.17", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/char/ipmi/ipmi_si_intf.c"], "methods": ["init_ipmi_si"]}
{"id": "7062", "title": "nanosleep blocks indefinitely when CONFIG_HPET_TIMER is enabled", "description": "Most recent kernel where this bug did not occur:\n2.6.17.3\nI did not test 2.6.17.11 yet but I'm pretty sure the bug was introduced in\n2.6.18-rc1\n\nDistribution:\nDebian unstable\n\nHardware Environment:\nThinkpad Z61m\nIt has a Pentium M CoreDuo. /proc/cpuinfo says:\nGenuine Intel(R) CPU           T2500  @ 2.00GHz\n\nProblem Description:\nWhen CONFIG_HPET_TIMER is enabled any call to nanosleep blocks indefinitely. \nFor me that's in a initramfs during udevsettle. Alt+PrintScreen+T says \nsomething about nanosleep. replaceing udevsettle with \"busybox sleep 1\" blocks \nas well with similar results for Alt+PrintScreen+T. The waiting process can be \nkilled with Alt+PrintScreen+I and the boot process continues until the next \nnanosleep.\nWhen CONFIG_HPET_TIMER is disabled the problem does not occur.\n\nI have tested 2.6.18-rc1 - 2.6.18-rc4 and several 2.6.18-rc?-mm? kernels. The \nproblem occurs for all of them. I assume the bug was intoduced with the big \ni386 timer related patches.\n\"indefinitely\" is of course a guess. I did however wait for serveral minutes \nfor a \"busybox sleep 1\" to complete.", "patch": ["diff --git a/arch/i386/kernel/hpet.c b/arch/i386/kernel/hpet.c\nindex c6737c3..17647a5 100644\n--- a/arch/i386/kernel/hpet.c\n+++ b/arch/i386/kernel/hpet.c\n@@ -35,7 +35,7 @@ static int __init init_hpet_clocksource(\n \tvoid __iomem* hpet_base;\n \tu64 tmp;\n \n-\tif (!hpet_address)\n+\tif (!is_hpet_enabled())\n \t\treturn -ENODEV;\n \n \t/* calculate the hpet address: */\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Timers", "Classification": "Unclassified", "Component": "Other", "Hardware": "i386 Linux", "Importance": "P2 normal", "Assignee": "john stultz", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2006-08-27 06:08 UTC by Michael Olbrich", "Modified": "2006-09-06 16:45 UTC", "CC List": "1 user", "See Also": "", "Kernel Version": "2.6.18-rc4", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["arch/i386/kernel/hpet.c"], "methods": ["init_hpet_clocksource"]}
{"id": "6965", "title": "Kernel doesn't re-sync usb-raid1 after running mdadm --add", "description": "Most recent kernel where this bug did not occur: 2.6.18-rc2\nDistribution: Slackintosh-Current\nHardware Environment:\n\nMac-Mini (ppc) : Internal Harddisk (rootfs) mirrored to an external\nUSB2 Harddrive\n\nProblem Description:\n\nThe internal harddrive of my MacMini is mirrored to an external\nUSB2-Harddrive via md-raid1.\n\nBecause the kernel doesn't attach the usb-device (sda2) to my\nraid (md0) itself (after a reboot) i'm using something like this in my\n/etc/rc.d/rc.local:\n\n> #!/bin/sh\n> postfix start  (<-- note: postfix ist started before attaching sda2)\n> /sbin/mdadm --manage /dev/md0 --add /dev/sda2\n\nThis worked well with kernels below 2.6.18-rc2 :\nA full sync from hda3 -> sda2 was started after each reboot.\n\nBeginning with 2.6.18-rc2 the kernel didn't sync\nthe drive after attaching it: It was added to the raid without\na full resync.\n\nAccording to 'iostat' the kernel does write to both devices\n*after* mdadm attached the harddrive but it seems like everything\nwritten to md0 before attaching sda2 will never make it to sda2 :-( :\n\nExample:\n--------\nmdadm --manage /dev/md0 -f /dev/hda3\nmdadm --manage /dev/md0 -r /dev/hda3 #sda2 is now the only active disk of md0\nmount /dev/hda3 /mnt/bla\n# cat /var/spool/postfix/pid/master.pid \n             649\n# cat /mnt/bla/var/spool/postfix/pid/master.pid\n             413 <-- ouch!", "patch": ["Status: ok\n\nAvoid backward event updates in md superblock when degraded.\n\nIf we\n  - shut down a clean array,\n  - restart with one (or more) drive(s) missing\n  - make some changes\n  - pause, so that they array gets marked 'clean',\nthe event count on the superblock of included drives\nwill be the same as that of the removed drives.\nSo adding the removed drive back in will cause it\nto be included with no resync.\n\nTo avoid this, we only update the eventcount backwards when the array\nis not degraded.  In this case there can (should) be no non-connected\ndrives that we can get confused with, and this is the particular case\nwhere updating-backwards is valuable.\n\n\nSigned-off-by: Neil Brown <neilb@suse.de>\n\n### Diffstat output\n ./drivers/md/md.c |   13 +++++++++++++\n 1 file changed, 13 insertions(+)\n\ndiff .prev/drivers/md/md.c ./drivers/md/md.c\n--- .prev/drivers/md/md.c\t2006-08-08 09:00:44.000000000 +1000\n+++ ./drivers/md/md.c\t2006-08-08 09:04:04.000000000 +1000\n@@ -1597,6 +1597,19 @@ void md_update_sb(mddev_t * mddev)\n \n repeat:\n \tspin_lock_irq(&mddev->write_lock);\n+\n+\tif (mddev->degraded && mddev->sb_dirty == 3)\n+\t\t/* If the array is degraded, then skipping spares is both\n+\t\t * dangerous and fairly pointless.\n+\t\t * Dangerous because a device that was removed from the array\n+\t\t * might have a event_count that still looks up-to-date,\n+\t\t * so it can be re-added without a resync.\n+\t\t * Pointless because if there are any spares to skip,\n+\t\t * then a recovery will happen and soon that array won't\n+\t\t * be degraded any more and the spare can go back to sleep then.\n+\t\t */\n+\t\tmddev->sb_dirty = 1;\n+\n \tsync_req = mddev->in_sync;\n \tmddev->utime = get_seconds();\n \tif (mddev->sb_dirty == 3)\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "IO/Storage", "Classification": "Unclassified", "Component": "MD", "Hardware": "i386 Linux", "Importance": "P2 normal", "Assignee": "Neil Brown", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2006-08-06 01:18 UTC by Adrian Ulrich", "Modified": "2008-03-26 23:15 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "2.6.18-rc3", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/md/md.c"], "methods": ["md_update_sb"]}
{"id": "6921", "title": "cpqarray fails to detect array when built as a module", "description": "Most recent kernel where this bug did not occur: 2.6.14\nDistribution: Debian (etch)\nHardware Environment: Compaq Proliant DL360\nSoftware Environment: n/a\nProblem Description: When built as a module, cpqarray, since 2.6.15, is unable \nto detect arrays. Built into the kernel it works fine. The errors are as \nfollows:\ncpqarray: Finding drives on ida0\ncpqarray: ida0: idaSendPciCmd Timeout out, No command list address returned!\ncpqarray: error sending ID Controller\n\nSteps to reproduce: Boot with a Compaq Smart Array card (shows up as \"raid \ncontroller lsi logic/symbios logic 53C1510 (rev 2)\" in lspci) and a valid \narray. If the kernel is built with cpqarray as a module that is loaded in an \ninitrd, the module is loaded and the array can not be found. If the array \ncontains the root partition, the system (obviously) becomes unbootable.", "patch": ["--- a/drivers/block/cpqarray.c\t2006-07-21 17:19:06.000000000 +0200\n+++ b/drivers/block/cpqarray.c\t2006-08-16 22:58:11.000000000 +0200\n@@ -1589,7 +1589,7 @@\n \n \t/* Wait (up to 2 seconds) for a command to complete */\n \n-\tfor (i = 200000; i > 0; i--) {\n+\tfor (i = 1000000; i > 0; i--) {\n \t\tdone = hba[ctlr]->access.command_completed(hba[ctlr]);\n \t\tif (done == 0) {\n \t\t\tudelay(10);\t/* a short fixed delay */\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "IO/Storage", "Classification": "Unclassified", "Component": "SCSI", "Hardware": "i386 Linux", "Importance": "P2 normal", "Assignee": "io_scsi", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2006-07-29 20:17 UTC by Joshua Rubin", "Modified": "2008-03-28 10:42 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "2.6.16", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/block/cpqarray.c"], "methods": ["pollcomplete"]}
{"id": "6706", "title": "modprobe -r ohci1394 hangs or panics", "description": "Most recent kernel where this bug did not occur: unknown\nDistribution: Mandrake 10.1\nHardware Environment: x86 K7 uniprocessor\ntwo FireWire host adapters (0: TI based, 1394b, 1: VIA based, 1394a)\nSoftware Environment: gcc 3.4.1, kernel.org's kernel\nProblem Description:\n\nWhen \"modprobe ohci1394\" is followed shortly by \"modprobe -r ohci1394\" (e.g. 1\nsecond after the previous modprobe finished), one of the following may happen:\n\n - kernel panic due to exception in interrupt\n   (happened on 2.6.15.x preempt uniprocessor)\n\n   or\n\n - modprobe -r hangs in D state, as does knodemgrd_0\n   (happened on 2.6.16.x preempt SMP on a uniprocessor machine,\n   with original drivers as well as with 1394 drivers equivalent\n   to 2.6.17-rc6-mm2 --- i.e. 2.6.17 will also be affected).\n\n   The knodemgrd_1 slept interruptibly (S state) while the other\n   slept uninterruptibly (D state) right after modprobe -r was\n   issued. This happens with or without other nodes attached to\n   the FireWire ports, with or without eth1394 loaded.\n\nThere is no problem if a longer pause is put between modprobe and modprobe -r,\nfor example 4 seconds.", "patch": ["Date: Tue, 21 Nov 2006 22:50:02 +0100 (CET)\nFrom: Stefan Richter <stefanr@s5r6.in-berlin.de>\nSubject: ieee1394: nodemgr: fix deadlock in shutdown\n\nIf \"modprobe ohci1394\" was quickly followed by \"modprobe -r ohci1394\",\nsay with 1 second pause in between, the modprobe -r got stuck in\nuninterruptible sleep in kthread_stop.  At the same time the knodemgrd\nslept uninterruptibly in bus_rescan_devices_helper.  That's because\ndriver_detach took the semaphore of the PCI device and\nbus_rescan_devices_helper wanted to take the semaphore of the FireWire\nhost device's parent, which is the same semaphore. This was a regression\nsince Linux 2.6.16, commit bf74ad5bc41727d5f2f1c6bedb2c1fac394de731,\n\"Hold the device's parent's lock during probe and remove\".\n\nThe fix (or workaround) adds a dummy driver to the hpsb_host device. Now\nbus_rescan_devices_helper won't scan the host device anymore.  This\ndoesn't hurt since we have no drivers which will bind to these devices\nand it is unlikely that there will ever be such a driver.  The dummy\ndriver is befittingly presented as a representation of ieee1394 itself.\n\nFixes: http://bugzilla.kernel.org/show_bug.cgi?id=6706\n\nSigned-off-by: Stefan Richter <stefanr@s5r6.in-berlin.de>\n---\n drivers/ieee1394/nodemgr.c |   21 ++++++++++++++++++---\n 1 files changed, 18 insertions(+), 3 deletions(-)\n\nIndex: linux/drivers/ieee1394/nodemgr.c\n===================================================================\n--- linux.orig/drivers/ieee1394/nodemgr.c\t2006-11-21 00:09:25.000000000 +0100\n+++ linux/drivers/ieee1394/nodemgr.c\t2006-11-21 22:32:09.000000000 +0100\n@@ -14,6 +14,7 @@\n #include <linux/slab.h>\n #include <linux/delay.h>\n #include <linux/kthread.h>\n+#include <linux/module.h>\n #include <linux/moduleparam.h>\n #include <asm/atomic.h>\n \n@@ -259,9 +260,20 @@ static struct device nodemgr_dev_templat\n \t.release\t= nodemgr_release_ne,\n };\n \n+/* This dummy driver prevents the host devices from being scanned. We have no\n+ * useful drivers for them yet, and there would be a deadlock possible if the\n+ * driver core scans the host device while the host's low-level driver (i.e.\n+ * the host's parent device) is being removed. */\n+static struct device_driver nodemgr_mid_layer_driver = {\n+\t.bus\t\t= &ieee1394_bus_type,\n+\t.name\t\t= \"ieee1394\",\n+\t.owner\t\t= THIS_MODULE,\n+};\n+\n struct device nodemgr_dev_template_host = {\n \t.bus\t\t= &ieee1394_bus_type,\n \t.release\t= nodemgr_release_host,\n+\t.driver\t\t= &nodemgr_mid_layer_driver,\n };\n \n \n@@ -704,11 +716,14 @@ static int nodemgr_bus_match(struct devi\n \t\treturn 0;\n \n \tud = container_of(dev, struct unit_directory, device);\n-\tdriver = container_of(drv, struct hpsb_protocol_driver, driver);\n-\n \tif (ud->ne->in_limbo || ud->ignore_driver)\n \t\treturn 0;\n \n+\t/* We only match drivers of type hpsb_protocol_driver */\n+\tif (drv == &nodemgr_mid_layer_driver)\n+\t\treturn 0;\n+\n+\tdriver = container_of(drv, struct hpsb_protocol_driver, driver);\n         for (id = driver->id_table; id->match_flags != 0; id++) {\n                 if ((id->match_flags & IEEE1394_MATCH_VENDOR_ID) &&\n                     id->vendor_id != ud->vendor_id)\n@@ -1899,7 +1914,7 @@ int init_ieee1394_nodemgr(void)\n \t\tclass_unregister(&nodemgr_ne_class);\n \t\treturn error;\n \t}\n-\n+\terror = driver_register(&nodemgr_mid_layer_driver);\n \thpsb_register_highlevel(&nodemgr_highlevel);\n \treturn 0;\n }\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "IEEE1394", "Hardware": "i386 Linux", "Importance": "P2 normal", "Assignee": "Stefan Richter", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2006-06-18 03:40 UTC by Stefan Richter", "Modified": "2006-12-10 08:32 UTC", "CC List": "0 users", "See Also": "", "Kernel Version": "2.6.15", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/ieee1394/nodemgr.c"], "methods": ["nodemgr_bus_match", "init_ieee1394_nodemgr", "nodemgr_dev_template_host"]}
{"id": "6455", "title": "battery and AC status stops updating - HP Compaq nx6125", "description": "Most recent kernel where this bug did not occur: not known\nDistribution: Gentoo Linux\nHardware Environment: HP Compaq nx6125 laptop with AMD Turion 64 CPU, BIOS F.0E\nSoftware Environment: KDE 3.5.2\nProblem Description:\nAt some point battery and AC status just stops updating. This happens when I\nunplug the AC cable and when I start my laptop withiut being connected to AC\npower. I think that it is more likely to happen when I do something that uses a\nlot of CPU or Graphics power.\n\nSteps to reproduce:\nI can't tell you the exact steps as I didn't figure out what causes it to stop\nupdating. Most of the time it stops working when I power on my laptop while\ntravelling by train to the work and then at some point it justs stops updating.\nIt also happens at one point when if keep plugginh and unplugging the laptop\nfrom AC power. High CPU usage at that time may help in causing this bug.", "patch": ["diff -ru linux-2.6.17-rc6-mm2.a/drivers/acpi/ec.c linux-2.6.17-rc6-mm2.b/drivers/acpi/ec.c\n--- linux-2.6.17-rc6-mm2.a/drivers/acpi/ec.c\t2006-06-21 03:02:26.000000000 +0400\n+++ linux-2.6.17-rc6-mm2.b/drivers/acpi/ec.c\t2006-06-21 02:58:05.000000000 +0400\n@@ -212,7 +212,7 @@\n \n \tswitch (event) {\n \tcase ACPI_EC_EVENT_IBE:\n-\t\tif (~acpi_ec_read_status(ec) & event) {\n+\t\tif (~acpi_ec_read_status(ec) & ACPI_EC_FLAG_IBF) {\n \t\t\tec->intr.expect_event = 0;\n \t\t\treturn 0;\n \t\t}\n@@ -771,12 +771,15 @@\n \tcase ACPI_EC_EVENT_OBF:\n \t\tif (!(value & ACPI_EC_FLAG_OBF))\n \t\t\tbreak;\n+\t\tec->intr.expect_event = 0;\n+\t\twake_up(&ec->intr.wait);\n+\t\tbreak;\n \tcase ACPI_EC_EVENT_IBE:\n \t\tif ((value & ACPI_EC_FLAG_IBF))\n \t\t\tbreak;\n \t\tec->intr.expect_event = 0;\n \t\twake_up(&ec->intr.wait);\n-\t\treturn ACPI_INTERRUPT_HANDLED;\n+\t\tbreak;\n \tdefault:\n \t\tbreak;\n \t}\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "Power-Battery", "Hardware": "i386 Linux", "Importance": "P2 normal", "Assignee": "Vladimir Lebedev", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2006-04-28 14:23 UTC by Jure Repinc", "Modified": "2006-06-30 17:01 UTC", "CC List": "1 user", "See Also": "", "Kernel Version": "2.6.17", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/acpi/ec.c"], "methods": ["acpi_ec_intr_wait", "acpi_ec_gpe_intr_handler"]}
{"id": "6200", "title": "Linux 2.4.32 keeps hanging", "description": "We are running Linux Kernel 2.4.32 and have been experiencing hangs every 1-4\ndays.  Sometimes, we can get multiple hangs in a single day.  We cannot\ndetermine the precise steps to reproduce the hang, but we have replaced the\nserver three times, and each time the problem continues to reoccur.  The\nfirst server had Intel server board SE7501WV2A.  The second system was a Dell\nPrecision WorkStation 450 (Intel 7505 chipset).  The last system was a Dell\nPowerEdge 1750 box (Intel ServerWorks GC LE chipset). All systems have Dual\nXeon, 4 gb memory.  The first two systems were using on-board Intel e1000, which\nI was suspicious was the cause of the problem, but the last system was running\ndual Broadcom gigabit and using the tg3 driver, so this was not an issue.  The\nusers logging into the server are accessing their home directories from our NFS\nserver.\n\nWhen the server hangs, the monitor on the console screen goes black, yet the\nmachine remains pingable.  An nmap on the machine reveals the ports that it\nprovides services on.  The machine will answer on those ports, but the\nservices are not available.  We also have the contents of a \"ps\" that\nis going to a file once every minute, in order to try to help us solve\nthis problem, and that activity stops.  Activity prior to the crash is\ngenerally minimal.  A serial console displays nothing until the machine\nis rebooted. \n\nWe recently installed the sgi kdb patch in the hopes that we might be able to\nprovide more details in order to solve this problem.  Yesterday, the system\ncrashed again.  We were able to get into kdb and record the following information:\n\n1) a ps listing of all running processes\n2) sysrq memory data\n2) a backtrace on each running process\n3) a single step trace on each of the processors\n\nI have included this data in the attached file.\n\nWe are extremely anxious to solve this problem.  If anyone has any idea, please\nlet us know.", "patch": ["\nHere is a patch that stops inodes from being removed\nfrom the inode hash list when an ESTALE error is\nreturned from a getattr request. This unhashing would\ncause the sync() to loop indefinitely in certain cases.\n\nThe dump shows that the inode is indeed on the locked list, but\nnot locked.  It's also clear why, and it has nothing to do with i_count:\nrather, the problem is that the inode is unhashed.  (\"Ahhhh!\")\n\n__sync_one does:\n\n\tinode->i_state |= I_LOCK;\n\t/* Do stuff */\n\tinode->i_state &= ~I_LOCK;\n\tif (!(inode->i_state & I_FREEING))\n\t\t__refile_inode(inode);\n\nand __refile_inode() itself does:\n\n\tif (inode->i_state & I_FREEING)\n\t\treturn;\n\tif (list_empty(&inode->i_hash))\n\t\treturn;\n\t\t\nAnd indeed, the inode here is unhashed, so __refile_inode is doing\nnothing.  *That* is the source of the problem!\n\nSo why is this happening?\n\nBecause NFS calls remove_inode_hash exactly once.  In\n__nfs_revalidate_inode().  If the inode is stale:\n\n\t\tif (status == -ESTALE) {\n\t\t\tNFS_FLAGS(inode) |= NFS_INO_STALE;\n\t\t\tif (inode != inode->i_sb->s_root->d_inode)\n\t\t\t\tremove_inode_hash(inode);\n\t\t}\n\nAny time this path triggers during a sync(), when the inode is locked,\nyou'll get the bug.  The \"acregmin=1,acregmax=1\" options exacerbate the\nproblem simply by calling __nfs_revalidate_inode so much.\n\n\n--- linux-2.4.21/fs/nfs/inode.c.orig\n+++ linux-2.4.21/fs/nfs/inode.c\n@@ -1167,11 +1167,8 @@ __nfs_revalidate_inode(struct nfs_server\n \tif (status) {\n \t\tdfprintk(PAGECACHE, \"nfs_revalidate_inode: (%x/%Ld) getattr failed, error=%d\\n\",\n \t\t\t inode->i_dev, (long long)NFS_FILEID(inode), status);\n-\t\tif (status == -ESTALE) {\n+\t\tif (status == -ESTALE)\n \t\t\tNFS_FLAGS(inode) |= NFS_INO_STALE;\n-\t\t\tif (inode != inode->i_sb->s_root->d_inode)\n-\t\t\t\tremove_inode_hash(inode);\n-\t\t}\n \t\tgoto out;\n \t}\n \n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "IO/Storage", "Classification": "Unclassified", "Component": "Other", "Hardware": "i386 Linux", "Importance": "P2 high", "Assignee": "fs_other", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2006-03-09 08:08 UTC by jas", "Modified": "2008-03-19 01:45 UTC", "CC List": "1 user", "See Also": "", "Kernel Version": "2.4.32", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["fs/nfs/inode.c"], "methods": ["__nfs_revalidate_inode"]}
{"id": "5992", "title": "r8169 driver - no network connection, hang at shutdown", "description": "Most recent kernel where this bug did not occur: None found yet, seems to affect\nall recent 2.6.x kernels on my system\n\nDistribution: Ubuntu (Breezy)\n\nHardware Environment: Foxconn motherboard with r8169 integrated (gigabit\nethernet version). lspci -vvv output supplied.\n\nSoftware Environment: Linux kernel 2.6.15.1 (with Ubuntu Breezy). Output from\ndmesg supplied.\n\nProblem Description: r8169 gets a bad MAC address. After that occurs, no network\nconnectivity is possible. Attempting to use ifconfig to reconfigure the\ninterface causes a hang. System also hangs at \"deconfiguring network interfaces\"\nphase of shutdown.\n\nSteps to reproduce: Boot my system. Networking simply doesn't work.\n\nMore information:\n\nr8169 driver and Linux kernel 2.6.15.1 fails to work with my Realtek 8169\nethernet controller. This is the gigabit ethernet-capable embedded version which\nis integrated into a Foxconn 925A01-8EKRS2 motherboard.\n\nWhenever the system boots, the r8169 driver does not pick up the MAC\naddress for the card; it reports the MAC addrress as being\nFF:FF:FF:FF:FF:FF. (I have also tried various 2.6.12, 2.6.13, 2.6.14\nkernels with the same experience). My first thought was a broken chip, but this\nbox has similar issues with other network cards which I'll mention later.\n\nWhen I run ifconfig, this reports:\n\neth0      Link encap:Ethernet  HWaddr FF:FF:FF:FF:FF:FF\n             inet addr:192.168.0.9  Bcast:192.168.255.255  Mask:255.255.0.0\n             UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1\n             RX packets:0 errors:0 dropped:4294967290 overruns:0 frame:0\n             TX packets:0 errors:0 dropped:0 overruns:0 carrier:0\n             collisions:0 txqueuelen:1000\n             RX bytes:0 (0.0 b)  TX bytes:0 (0.0 b)\n             Interrupt:21 Base address:0x4800\n\nThe IP address has been assigned statically in /etc/network/interfaces\nas I don't use DHCP (and I doubt DHCP would currently work anyway). If I\ntry to use \"ifconfig eth0 hw ether\" to set the MAC address then ifconfig\njust hangs.\n\nI am unable to ping anywhere in my network or beyond the gateway, nor\ncan I establish any network connections to any other machine. Given that\nthere appears to be something wrong at the link layer, I wouldn't expect\nhigher layer diagnostics to reveal much, but I figured it was worth a try.\n\nIn addition, my system tends to hang at the \"deconfiguring network\ninterfaces\" stage of system shutdown.\n\nI have tried building the r8169 module both with and without gigabit\nethernet support and using MMIO versus PIO - no luck.\n\nFrom browsing around the web, some people suggest changing the Plug and\nPlay OS setting in the BIOS, only my BIOS doesn't appear to have any\nsuch setting. The only option in the PNP area was to reset the ESCD\ndata, so I tried this to see if that would help, but still the issue\npersisted.\n\nSome reports seemed to suggest an issue with IRQ assignment and ACPI,\nso I tried booting with kernel options including nolapic, acpi=off,\nacpi=noirq, pci=noacpi, pci=routeirq and various combinations of these. None of\nthem worked (in fact nolapic hangs my system during boot-up).\n\nI include the output from lspci -vvv and dmesg so you can see what is\nhappening. I also used Donald Becker's rtl8169-diag program, but that\ncomplained that \"A recognized chip has been found, but it does not\nappear to exist in I/O space\".\n\nIncidentally, I tried some known good 3Com and D-Link network cards in\nthis machine (both with and without the Realtek enabled in the BIOS) and\nI couldn't get them to work either for similar reasons. If it were just\nthe Realtek I might assume it was a defective chip, but the lack of\nability to get any network card working on this machine suggests a\ndeeper issue.\n\nI'm happy to try testing new patches or settings, but would appreciate\nsome tips on what to do next. In all other respects my system is happy\nand stable, it just lacks a working network connection.\n\nThanks in advance.\n\nAndrew", "patch": ["From afca3c33130060d5696dfed27463760d961a5612 Mon Sep 17 00:00:00 2001\nFrom: Francois Romieu <romieu@fr.zoreil.com>\nDate: Thu, 25 Jan 2007 00:02:48 +0100\nSubject: [PATCH] r8169: merge release 6.001.00 of Realtek's driver - take #1\n\nRealtek's driver restricts itself to 0x8169 and 0x8167.\nIt won't be surprising if it breaks on anything else until\nI merge the new 0x8168 and 0x8136 bits.\n\nSigned-off-by: Francois Romieu <romieu@fr.zoreil.com>\n---\n drivers/net/r8169.c |  159 ++++++++++++++++++++++++++++++++++++++------------\n 1 files changed, 121 insertions(+), 38 deletions(-)\n\ndiff --git a/drivers/net/r8169.c b/drivers/net/r8169.c\nindex 577babd..2f320de 100644\n--- a/drivers/net/r8169.c\n+++ b/drivers/net/r8169.c\n@@ -150,11 +150,13 @@ static const int multicast_filter_limit = 32;\n #define RTL_R32(reg)\t\t((unsigned long) readl (ioaddr + (reg)))\n \n enum mac_version {\n-\tRTL_GIGA_MAC_VER_01 = 0x00,\n-\tRTL_GIGA_MAC_VER_02 = 0x01,\n-\tRTL_GIGA_MAC_VER_03 = 0x02,\n-\tRTL_GIGA_MAC_VER_04 = 0x03,\n-\tRTL_GIGA_MAC_VER_05 = 0x04,\n+\tRTL_GIGA_MAC_VER_00 = 0x00,\t// 8169\n+\tRTL_GIGA_MAC_VER_01 = 0x01,\t// 8169S\n+\tRTL_GIGA_MAC_VER_02 = 0x02,\t// 8110S\n+\tRTL_GIGA_MAC_VER_03 = 0x03,\n+\tRTL_GIGA_MAC_VER_04 = 0x04,\t// 8169SB\n+\tRTL_GIGA_MAC_VER_05 = 0x05,\t// 8169SCd\n+\tRTL_GIGA_MAC_VER_06 = 0x06,\t// 8169SCe\n \tRTL_GIGA_MAC_VER_11 = 0x0b,\n \tRTL_GIGA_MAC_VER_12 = 0x0c,\n \tRTL_GIGA_MAC_VER_13 = 0x0d,\n@@ -179,11 +181,13 @@ static const struct {\n \tu8 mac_version;\n \tu32 RxConfigMask;\t/* Clears the bits supported by this chip */\n } rtl_chip_info[] = {\n-\t_R(\"RTL8169\",\t\tRTL_GIGA_MAC_VER_01, 0xff7e1880),\n+\t_R(\"RTL8169\",\t\tRTL_GIGA_MAC_VER_00, 0xff7e1880),\n+\t_R(\"RTL8169s/8110s\",\tRTL_GIGA_MAC_VER_01, 0xff7e1880),\n \t_R(\"RTL8169s/8110s\",\tRTL_GIGA_MAC_VER_02, 0xff7e1880),\n-\t_R(\"RTL8169s/8110s\",\tRTL_GIGA_MAC_VER_03, 0xff7e1880),\n-\t_R(\"RTL8169sb/8110sb\",\tRTL_GIGA_MAC_VER_04, 0xff7e1880),\n+\t_R(\"RTL8169sb/8110sb\",\tRTL_GIGA_MAC_VER_03, 0xff7e1880),\n+\t_R(\"RTL8169sc/8110sc\",\tRTL_GIGA_MAC_VER_04, 0xff7e1880),\n \t_R(\"RTL8169sc/8110sc\",\tRTL_GIGA_MAC_VER_05, 0xff7e1880),\n+\t_R(\"RTL8169sc/8110sc\",\tRTL_GIGA_MAC_VER_06, 0xff7e1880),\n \t_R(\"RTL8168b/8111b\",\tRTL_GIGA_MAC_VER_11, 0xff7e1880), // PCI-E\n \t_R(\"RTL8168b/8111b\",\tRTL_GIGA_MAC_VER_12, 0xff7e1880), // PCI-E\n \t_R(\"RTL8101e\",\t\tRTL_GIGA_MAC_VER_13, 0xff7e1880), // PCI-E 8139\n@@ -231,6 +235,7 @@ static struct {\n \n enum RTL8169_registers {\n \tMAC0 = 0,\t\t/* Ethernet hardware address. */\n+\tMAC4 = 4,\n \tMAR0 = 8,\t\t/* Multicast filter. */\n \tCounterAddrLow = 0x10,\n \tCounterAddrHigh = 0x14,\n@@ -322,6 +327,11 @@ enum RTL8169_register_content {\n \t/* Config1 register p.24 */\n \tPMEnable\t= (1 << 0),\t/* Power Management Enable */\n \n+\t/* Config2 register p. 25 */\n+\tPCI_Clock_66MHz\t= 0x01,\n+\tPCI_Clock_33MHz\t= 0x00,\n+\n+\n \t/* Config3 register p.25 */\n \tMagicPacket\t= (1 << 5),\t/* Wake up when receives a Magic Packet */\n \tLinkUp\t\t= (1 << 4),\t/* Wake up when the cable connection is re-established */\n@@ -1172,15 +1182,17 @@ static void rtl8169_get_mac_version(struct rtl8169_private *tp, void __iomem *io\n \t\t{ 0x34000000,\tRTL_GIGA_MAC_VER_13 },\n \t\t{ 0x30800000,\tRTL_GIGA_MAC_VER_14 },\n \t\t{ 0x30000000,\tRTL_GIGA_MAC_VER_11 },\n+\t\t{ 0x98000000,\tRTL_GIGA_MAC_VER_05 },\n \t\t{ 0x18000000,\tRTL_GIGA_MAC_VER_05 },\n-\t\t{ 0x10000000,\tRTL_GIGA_MAC_VER_04 },\n-\t\t{ 0x04000000,\tRTL_GIGA_MAC_VER_03 },\n-\t\t{ 0x00800000,\tRTL_GIGA_MAC_VER_02 },\n-\t\t{ 0x00000000,\tRTL_GIGA_MAC_VER_01 }\t/* Catch-all */\n+\t\t{ 0x18000000,\tRTL_GIGA_MAC_VER_04 },\n+\t\t{ 0x10000000,\tRTL_GIGA_MAC_VER_03 },\n+\t\t{ 0x04000000,\tRTL_GIGA_MAC_VER_02 },\n+\t\t{ 0x00800000,\tRTL_GIGA_MAC_VER_01 },\n+\t\t{ 0x00000000,\tRTL_GIGA_MAC_VER_00 }\t/* Catch-all */\n \t}, *p = mac_info;\n \tu32 reg;\n \n-\treg = RTL_R32(TxConfig) & 0x7c800000;\n+\treg = RTL_R32(TxConfig) & 0xfc800000;\n \twhile ((reg & p->mask) != p->mask)\n \t\tp++;\n \ttp->mac_version = p->mac_version;\n@@ -1273,7 +1285,7 @@ static void rtl8169_hw_phy_config(struct net_device *dev)\n \trtl8169_print_mac_version(tp);\n \trtl8169_print_phy_version(tp);\n \n-\tif (tp->mac_version <= RTL_GIGA_MAC_VER_01)\n+\tif (tp->mac_version <= RTL_GIGA_MAC_VER_00)\n \t\treturn;\n \tif (tp->phy_version >= RTL_GIGA_PHY_VER_H)\n \t\treturn;\n@@ -1283,7 +1295,7 @@ static void rtl8169_hw_phy_config(struct net_device *dev)\n \n \t/* Shazam ! */\n \n-\tif (tp->mac_version == RTL_GIGA_MAC_VER_04) {\n+\tif (tp->mac_version == RTL_GIGA_MAC_VER_03) {\n \t\tmdio_write(ioaddr, 31, 0x0002);\n \t\tmdio_write(ioaddr,  1, 0x90d0);\n \t\tmdio_write(ioaddr, 31, 0x0000);\n@@ -1317,7 +1329,7 @@ static void rtl8169_phy_timer(unsigned long __opaque)\n \tvoid __iomem *ioaddr = tp->mmio_addr;\n \tunsigned long timeout = RTL8169_PHY_TIMEOUT;\n \n-\tassert(tp->mac_version > RTL_GIGA_MAC_VER_01);\n+\tassert(tp->mac_version > RTL_GIGA_MAC_VER_00);\n \tassert(tp->phy_version < RTL_GIGA_PHY_VER_H);\n \n \tif (!(tp->phy_1000_ctrl_reg & ADVERTISE_1000FULL))\n@@ -1353,7 +1365,7 @@ static inline void rtl8169_delete_timer(struct net_device *dev)\n \tstruct rtl8169_private *tp = netdev_priv(dev);\n \tstruct timer_list *timer = &tp->timer;\n \n-\tif ((tp->mac_version <= RTL_GIGA_MAC_VER_01) ||\n+\tif ((tp->mac_version <= RTL_GIGA_MAC_VER_00) ||\n \t    (tp->phy_version >= RTL_GIGA_PHY_VER_H))\n \t\treturn;\n \n@@ -1365,7 +1377,7 @@ static inline void rtl8169_request_timer(struct net_device *dev)\n \tstruct rtl8169_private *tp = netdev_priv(dev);\n \tstruct timer_list *timer = &tp->timer;\n \n-\tif ((tp->mac_version <= RTL_GIGA_MAC_VER_01) ||\n+\tif ((tp->mac_version <= RTL_GIGA_MAC_VER_00) ||\n \t    (tp->phy_version >= RTL_GIGA_PHY_VER_H))\n \t\treturn;\n \n@@ -1432,12 +1444,14 @@ static void rtl8169_init_phy(struct net_device *dev, struct rtl8169_private *tp)\n \tdprintk(\"Set MAC Reg C+CR Offset 0x82h = 0x01h\\n\");\n \tRTL_W8(0x82, 0x01);\n \n-\tif (tp->mac_version < RTL_GIGA_MAC_VER_03) {\n+\tif (tp->mac_version < RTL_GIGA_MAC_VER_02) {\n \t\tdprintk(\"Set PCI Latency=0x40\\n\");\n \t\tpci_write_config_byte(tp->pci_dev, PCI_LATENCY_TIMER, 0x40);\n \t}\n \n-\tif (tp->mac_version == RTL_GIGA_MAC_VER_02) {\n+\tpci_write_config_byte(tp->pci_dev, PCI_CACHE_LINE_SIZE, 0x08);\n+\n+\tif (tp->mac_version == RTL_GIGA_MAC_VER_01) {\n \t\tdprintk(\"Set MAC Reg C+CR Offset 0x82h = 0x01h\\n\");\n \t\tRTL_W8(0x82, 0x01);\n \t\tdprintk(\"Set PHY Reg 0x0bh = 0x00h\\n\");\n@@ -1454,6 +1468,36 @@ static void rtl8169_init_phy(struct net_device *dev, struct rtl8169_private *tp)\n \t\tprintk(KERN_INFO PFX \"%s: TBI auto-negotiating\\n\", dev->name);\n }\n \n+static void rtl8169_rar_set(struct rtl8169_private *tp, u8 *addr)\n+{\n+\tvoid __iomem *ioaddr = tp->mmio_addr;\n+\tu32 low;\n+\tu32 high;\n+\n+\tlow  = addr[0] | (addr[1] << 8) | (addr[2] << 16) | (addr[3] << 24);\n+\thigh = addr[4] | (addr[5] << 8);\n+\n+\tRTL_W8(Cfg9346, Cfg9346_Unlock);\n+\tRTL_W32(MAC0, low);\n+\tRTL_W32(MAC4, high);\n+\tRTL_W8(Cfg9346, Cfg9346_Lock);\n+}\n+\n+static int rtl8169_set_mac_address(struct net_device *dev, void *p)\n+{\n+\tstruct rtl8169_private *tp = netdev_priv(dev);\n+\tstruct sockaddr *addr = p;\n+\n+\tif (!is_valid_ether_addr(addr->sa_data))\n+\t\treturn -EADDRNOTAVAIL;\n+\n+\tmemcpy(dev->dev_addr, addr->sa_data, dev->addr_len);\n+\n+\trtl8169_rar_set(tp, dev->dev_addr);\n+\n+\treturn 0;\n+}\n+\n static int rtl8169_ioctl(struct net_device *dev, struct ifreq *ifr, int cmd)\n {\n \tstruct rtl8169_private *tp = netdev_priv(dev);\n@@ -1665,6 +1709,7 @@ rtl8169_init_one(struct pci_dev *pdev, const struct pci_device_id *ent)\n \tdev->irq = pdev->irq;\n \tdev->base_addr = (unsigned long) ioaddr;\n \tdev->change_mtu = rtl8169_change_mtu;\n+\tdev->set_mac_address = rtl8169_set_mac_address;\n \n #ifdef CONFIG_R8169_NAPI\n \tdev->poll = rtl8169_poll;\n@@ -1825,6 +1870,41 @@ static void rtl8169_set_rx_tx_config_registers(struct rtl8169_private *tp)\n \t\t(InterFrameGap << TxInterFrameGapShift));\n }\n \n+static void rtl8169_set_magic_reg(void __iomem *ioaddr, unsigned mac_version)\n+{\n+\tstruct {\n+\t\tu32 mac_version;\n+\t\tu32 clk66;\n+\t\tu32 val;\n+\t} cfg2_info [] = {\n+\t\t{ RTL_GIGA_MAC_VER_05, 0, 0x000fff00 },\n+\t\t{ RTL_GIGA_MAC_VER_05, 1, 0x000fffff },\n+\t\t{ RTL_GIGA_MAC_VER_06, 0, 0x00ffffff },\n+\t\t{ RTL_GIGA_MAC_VER_06, 1, 0x00ffff00 }\n+\t}, *p = cfg2_info;\n+\tunsigned int i;\n+\tu32 clk66;\n+\n+\tclk66 = RTL_R8(Config2) & PCI_Clock_66MHz;\n+\tfor (i = 0; i < ARRAY_SIZE(cfg2_info); i++) {\n+\t\tif ((p->mac_version == mac_version) && (p->clk66 == clk66)) {\n+\t\t\tRTL_W32(0x7c, p->val);\n+\t\t\tbreak;\n+\t\t}\n+\t}\n+}\n+\n+static bool rtl8169_plain_old_8169(unsigned int mac_version)\n+{\n+\treturn ((mac_version == RTL_GIGA_MAC_VER_00) ||\n+\t\t(mac_version == RTL_GIGA_MAC_VER_01) ||\n+\t\t(mac_version == RTL_GIGA_MAC_VER_02) ||\n+\t\t(mac_version == RTL_GIGA_MAC_VER_03) || // FIXME: remove ?\n+\t\t(mac_version == RTL_GIGA_MAC_VER_04) ||\n+\t\t(mac_version == RTL_GIGA_MAC_VER_05) ||\n+\t\t(mac_version == RTL_GIGA_MAC_VER_06)) ? true : false;\n+}\n+\n static void rtl8169_hw_start(struct net_device *dev)\n {\n \tstruct rtl8169_private *tp = netdev_priv(dev);\n@@ -1843,10 +1923,8 @@ static void rtl8169_hw_start(struct net_device *dev)\n \t\tmsleep_interruptible(1);\n \t}\n \n-\tif (tp->mac_version == RTL_GIGA_MAC_VER_05) {\n+\tif (tp->mac_version == RTL_GIGA_MAC_VER_04)\n \t\tRTL_W16(CPlusCmd, RTL_R16(CPlusCmd) | PCIMulRW);\n-\t\tpci_write_config_byte(pdev, PCI_CACHE_LINE_SIZE, 0x08);\n-\t}\n \n \tif (tp->mac_version == RTL_GIGA_MAC_VER_13) {\n \t\tpci_write_config_word(pdev, 0x68, 0x00);\n@@ -1854,7 +1932,7 @@ static void rtl8169_hw_start(struct net_device *dev)\n \t}\n \n \t/* Undocumented stuff. */\n-\tif (tp->mac_version == RTL_GIGA_MAC_VER_05) {\n+\tif (tp->mac_version == RTL_GIGA_MAC_VER_04) {\n \t\t/* Realtek's r1000_n.c driver uses '&& 0x01' here. Well... */\n \t\tif ((RTL_R8(Config2) & 0x07) & 0x01)\n \t\t\tRTL_W32(0x7c, 0x0007ffff);\n@@ -1867,10 +1945,8 @@ static void rtl8169_hw_start(struct net_device *dev)\n \t}\n \n \tRTL_W8(Cfg9346, Cfg9346_Unlock);\n-\tif ((tp->mac_version == RTL_GIGA_MAC_VER_01) ||\n-\t    (tp->mac_version == RTL_GIGA_MAC_VER_02) ||\n-\t    (tp->mac_version == RTL_GIGA_MAC_VER_03) ||\n-\t    (tp->mac_version == RTL_GIGA_MAC_VER_04))\n+\n+\tif (rtl8169_plain_old_8169(tp->mac_version))\n \t\tRTL_W8(ChipCmd, CmdTxEnb | CmdRxEnb);\n \n \tRTL_W8(EarlyTxThres, EarlyTxThld);\n@@ -1878,10 +1954,7 @@ static void rtl8169_hw_start(struct net_device *dev)\n \t/* Low hurts. Let's disable the filtering. */\n \tRTL_W16(RxMaxSize, 16383);\n \n-\tif ((tp->mac_version == RTL_GIGA_MAC_VER_01) ||\n-\t    (tp->mac_version == RTL_GIGA_MAC_VER_02) ||\n-\t    (tp->mac_version == RTL_GIGA_MAC_VER_03) ||\n-\t    (tp->mac_version == RTL_GIGA_MAC_VER_04))\n+\tif (rtl8169_plain_old_8169(tp->mac_version))\n \t\trtl8169_set_rx_tx_config_registers(tp);\n \n \tcmd = RTL_R16(CPlusCmd);\n@@ -1889,8 +1962,10 @@ static void rtl8169_hw_start(struct net_device *dev)\n \n \ttp->cp_cmd |= cmd | PCIMulRW;\n \n-\tif ((tp->mac_version == RTL_GIGA_MAC_VER_02) ||\n-\t    (tp->mac_version == RTL_GIGA_MAC_VER_03)) {\n+\trtl8169_set_magic_reg(ioaddr, tp->mac_version);\n+\n+\tif ((tp->mac_version == RTL_GIGA_MAC_VER_01) ||\n+\t    (tp->mac_version == RTL_GIGA_MAC_VER_02)) {\n \t\tdprintk(KERN_INFO PFX \"Set MAC Reg C+CR Offset 0xE0. \"\n \t\t\t\"Bit-3 and bit-14 MUST be 1\\n\");\n \t\ttp->cp_cmd |= (1 << 14);\n@@ -1914,10 +1989,7 @@ static void rtl8169_hw_start(struct net_device *dev)\n \tRTL_W32(RxDescAddrHigh, ((u64) tp->RxPhyAddr >> 32));\n \tRTL_W32(RxDescAddrLow, ((u64) tp->RxPhyAddr & DMA_32BIT_MASK));\n \n-\tif ((tp->mac_version != RTL_GIGA_MAC_VER_01) &&\n-\t    (tp->mac_version != RTL_GIGA_MAC_VER_02) &&\n-\t    (tp->mac_version != RTL_GIGA_MAC_VER_03) &&\n-\t    (tp->mac_version != RTL_GIGA_MAC_VER_04)) {\n+\tif (!rtl8169_plain_old_8169(tp->mac_version)) {\n \t\tRTL_W8(ChipCmd, CmdTxEnb | CmdRxEnb);\n \t\trtl8169_set_rx_tx_config_registers(tp);\n \t}\n@@ -1937,6 +2009,9 @@ static void rtl8169_hw_start(struct net_device *dev)\n \t/* Enable all known interrupts by setting the interrupt mask. */\n \tRTL_W16(IntrMask, rtl8169_intr_mask);\n \n+\tif (rtl8169_plain_old_8169(tp->mac_version))\n+\t\tRTL_W8(ChipCmd, CmdTxEnb | CmdRxEnb);\n+\n \tnetif_start_queue(dev);\n }\n \n@@ -2582,6 +2657,14 @@ rtl8169_rx_interrupt(struct net_device *dev, struct rtl8169_private *tp,\n \t\t\ttp->stats.rx_bytes += pkt_size;\n \t\t\ttp->stats.rx_packets++;\n \t\t}\n+\n+\t\t/* Work around for AMD plateform. */\n+\t\tif ((desc->opts2 & 0xfffe000) &&\n+\t\t    (tp->mac_version == RTL_GIGA_MAC_VER_05)) {\n+\t\t\tdesc->opts2 = 0;\n+\t\t\tcur_rx++;\n+\t\t}\n+\n \t}\n \n \tcount = cur_rx - tp->cur_rx;\n-- \n1.4.4.4\n\n", "diff --git a/drivers/net/r8169.c b/drivers/net/r8169.c\nindex b94fa7e..6e7dde5 100644\n--- a/drivers/net/r8169.c\n+++ b/drivers/net/r8169.c\n@@ -1739,7 +1739,9 @@ rtl8169_init_one(struct pci_dev *pdev, const struct pci_device_id *ent)\n \ttp->features |= rtl_try_msi(pdev, ioaddr, cfg);\n \tRTL_W8(Cfg9346, Cfg9346_Lock);\n \n-\tif (RTL_R8(PHYstatus) & TBI_Enable) {\n+\tif ((tp->mac_version != RTL_GIGA_MAC_VER_14) &&\n+\t    (tp->mac_version != RTL_GIGA_MAC_VER_15) &&\n+\t    (RTL_R8(PHYstatus) & TBI_Enable)) {\n \t\ttp->set_speed = rtl8169_set_speed_tbi;\n \t\ttp->get_settings = rtl8169_gset_tbi;\n \t\ttp->phy_reset_enable = rtl8169_tbi_reset_enable;\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Network", "Hardware": "i386 Linux", "Importance": "P2 normal", "Assignee": "Francois Romieu", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2006-02-01 13:16 UTC by Andrew Akehurst", "Modified": "2008-09-24 13:05 UTC", "CC List": "4 users", "See Also": "", "Kernel Version": "2.6.15", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/net/r8169.c"], "methods": ["rtl8169_get_mac_version", "rtl8169_hw_phy_config", "rtl8169_phy_timer", "rtl8169_delete_timer", "rtl8169_request_timer", "rtl8169_init_one", "rtl8169_init_phy", "rtl8169_set_rx_tx_config_registers", "rtl8169_hw_start", "rtl8169_rx_interrupt", "rtl_chip_info", "mac_version", "RTL8169_registers", "RTL8169_register_content"]}
{"id": "5553", "title": "speedstep-smi fails to load if CONFIG_CPU_FREQ_DEBUG is not set", "description": "Most recent kernel where this bug did not occur:\n 2.6.14\nDistribution:\n Debian GNU/Linux Etch\nHardware Environment:\n IBM ThinkPad T22, Pentium III (Coppermine), i440BX\nSoftware Environment:\nProblem Description:\n\ncpufreq used to work with 2.6.8 and 2.6.11 kernels, but doesn't work with 2.6.12\nand 2.6.14 for me. I've found that it actually works with 2.6.14 but only if\nkernel is compiled with CONFIG_CPU_FREQ_DEBUG option set.\n\nSteps to reproduce:\n\nCompile kernel with all allmodconfig and clear the CONFIG_CPU_FREQ_DEBUG.\n\nThen the following happens (otherwise it works):\n\n# modprobe speedstep-lib relaxed_check=1\n# modprobe speedstep-smi\nFATAL: Error inserting speedstep_smi\n(/lib/modules/2.6.14/kernel/arch/i386/kernel/cpu/cpufreq/speedstep-smi.ko): No\nsuch device", "patch": ["Index: sonnenschein/arch/i386/kernel/cpu/cpufreq/speedstep-smi.c\n===================================================================\n--- sonnenschein.orig/arch/i386/kernel/cpu/cpufreq/speedstep-smi.c\n+++ sonnenschein/arch/i386/kernel/cpu/cpufreq/speedstep-smi.c\n@@ -52,9 +52,9 @@ static struct cpufreq_frequency_table sp\n #define SET_SPEEDSTEP_STATE 2\n #define GET_SPEEDSTEP_FREQS 4\n \n-/* how often shall the SMI call be tried if it failed, e.g. because\n- * of DMA activity going on? */\n-#define SMI_TRIES 5\n+/* how often shall the SMI call be tried (it can easily fail, e.g. because\n+ * of DMA activity going on) */\n+#define SMI_TRIES 6\n \n #define dprintk(msg...) cpufreq_debug_printk(CPUFREQ_DEBUG_DRIVER, \"speedstep-smi\", msg)\n \n@@ -161,7 +161,7 @@ static void speedstep_set_state (unsigne\n \tunsigned int result = 0, command, new_state;\n \tunsigned long flags;\n \tunsigned int function=SET_SPEEDSTEP_STATE;\n-\tunsigned int retry = 0;\n+\tunsigned int try = 0;\n \n \tif (state > 0x1)\n \t\treturn;\n@@ -174,24 +174,22 @@ static void speedstep_set_state (unsigne\n \tdprintk(\"trying to set frequency to state %u with command %x at port %x\\n\", state, command, smi_port);\n \n \tdo {\n-\t\tif (retry) {\n-\t\t\tdprintk(\"retry %u, previous result %u, waiting...\\n\", retry, result);\n-\t\t\tmdelay(retry * 50);\n-\t\t}\n-\t\tretry++;\n+\t\tdprintk(\"try %u, previous result %u, waiting...\\n\", try, result);\n+\t\tmdelay(try * 50);\n+\t\ttry++;\n \t\t__asm__ __volatile__(\n \t\t\t\"movl $0, %%edi\\n\"\n \t\t\t\"out %%al, (%%dx)\\n\"\n \t\t\t: \"=b\" (new_state), \"=D\" (result)\n \t\t\t: \"a\" (command), \"b\" (function), \"c\" (state), \"d\" (smi_port), \"S\" (0)\n \t\t\t);\n-\t} while ((new_state != state) && (retry <= SMI_TRIES));\n+\t} while ((new_state != state) && (try <= SMI_TRIES));\n \n \t/* enable IRQs */\n \tlocal_irq_restore(flags);\n \n \tif (new_state == state) {\n-\t\tdprintk(\"change to %u MHz succeeded after %u tries with result %u\\n\", (speedstep_freqs[new_state].frequency / 1000), retry, result);\n+\t\tdprintk(\"change to %u MHz succeeded after %u tries with result %u\\n\", (speedstep_freqs[new_state].frequency / 1000), try, result);\n \t} else {\n \t\tprintk(KERN_ERR \"cpufreq: change failed with new_state %u and result %u\\n\", new_state, result);\n \t}\n", "--- ../linux-source-2.6.15.orig/arch/i386/kernel/cpu/cpufreq/speedstep-smi.c\t2006-01-03 05:21:10.000000000 +0200\n+++ arch/i386/kernel/cpu/cpufreq/speedstep-smi.c\t2006-01-21 23:13:06.000000000 +0200\n@@ -70,7 +70,7 @@\n \tcommand = (smi_sig & 0xffffff00) | (smi_cmd & 0xff);\n \tmagic = virt_to_phys(magic_data);\n \n-\tdprintk(\"trying to obtain ownership with command %x at port %x\\n\", command, smi_port);\n+\tprintk(\"trying to obtain ownership with command %x at port %x\\n\", command, smi_port);\n \n \t__asm__ __volatile__(\n \t\t\"out %%al, (%%dx)\\n\"\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Power Management", "Classification": "Unclassified", "Component": "cpufreq", "Hardware": "i386 Linux", "Importance": "P2 normal", "Assignee": "cpufreq", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2005-11-04 16:14 UTC by Theodor Milkov", "Modified": "2011-07-30 05:19 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "2.6.14", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["arch/i386/kernel/cpu/cpufreq/speedstep-smi.c"], "methods": ["void speedstep_set_state", "SMI_TRIES"]}
{"id": "5475", "title": "USB mouse freezes in X", "": "Show dependency tree", "description": "Most recent kernel where this bug did not occur: 2.6.10\nDistribution: Ubuntu\nHardware Environment: AMD Athlpn 1300, Nvidia GeForce2, Logitech Optical USB Mouse\nSoftware Environment: Ubuntu 5.04/Ubuntu 5.10\nProblem Description: \n\nBooting into Gnome and reading webpages. Not using the mouse for a while. When I\ngrab the mouse and want to move the pointer, the mouse is frozen. I have to\nswitch terminals (Ctrl+Alt+F1) and back to F7 to get the mouse working again.\n\nSteps to reproduce:\n\n1. Boot, log into Gnome.\n2. Use your computer for a while (eg. type in a bugreport on kernel.org)\n3. Move the mouse pointer. It appears frozen.\n\nThis did not appear in kernel 2.6.10. The problem is apparent also in 2.6.12.", "patch": ["From: Vojtech Pavlik <vojtech@suse.cz>\nDate: Sat Mar  4 11:00:50 CET 2006\nSubject: Fix dying mice on Intel UHCI controllers\nPatch-mainline: 2.6.16 or 2.6.17\nReferences: SuSE bugs #146781, #151719, #94064\n\nThe UHCI controllers can sometimes report an intermittent CRC error, probabl\ndue to hardware problems. There is no need to abort under such\ncircumstances.\n\nSigned-off-by: Vojtech Pavlik <vojtech@suse.cz>\n\ndiff --git a/drivers/usb/input/hid-core.c b/drivers/usb/input/hid-core.c\n--- a/drivers/usb/input/hid-core.c\n+++ b/drivers/usb/input/hid-core.c\n@@ -927,8 +927,8 @@ static void hid_irq_in(struct urb *urb, \n \t\tcase -ENOENT:\n \t\tcase -EPERM:\n \t\tcase -ESHUTDOWN:\t/* unplug */\n-\t\tcase -EILSEQ:\t\t/* unplug timeout on uhci */\n \t\t\treturn;\n+\t\tcase -EILSEQ:\t\t/* CRC error or failed urbs before unplug */\n \t\tcase -ETIMEDOUT:\t/* NAK */\n \t\t\tbreak;\n \t\tdefault:\t\t/* error */\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "USB", "Hardware": "i386 Linux", "Importance": "P2 normal", "Assignee": "Dmitry Torokhov", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "USB", "Reported": "2005-10-20 14:30 UTC by Christoffer S", "Modified": "2006-04-10 17:11 UTC", "CC List": "3 users", "See Also": "", "Kernel Version": "2.6.13", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/usb/input/hid-core.c"], "methods": ["hid_irq_in"]}
{"id": "5366", "title": "synchronize_tsc_bp can zero the TSC during a lost ticks measurement", "description": "Most recent kernel where this bug did not occur: Unknown -- long ago, probably\nDistribution:\nHardware Environment: i386 and x86_64\nSoftware Environment:\nProblem Description:\n\nI verified this in 2.6.11 since it was handy on lxr.linux.no, but it\nprobably exists in most kernel versions.  Also, the bug appears to be\npresent in both the i386 and x86_64 arch even though it's in\narch-specific code.\n\nThe basic problem is that (in some system configurations) the timer\ninterrupt handler uses the TSC to determine whether some ticks have\nbeen lost, but the kernel synchronizes the TSCs by zeroing them all\n*after* timer interrupts have been started.  Thus at the next timer\ninterrupt, lost ticks are computed as a value from after the reset\n(near 0) minus a value from before the reset.  This overflows and\nproduces a garbage value that can be either positive or negative (the\ndetails of the arithmetic differ between x86_64 and i386, but the\nvalue is garbage on both).  If it's positive, it looks like a large\nnumber of ticks have been lost and they get spuriously added to the\njiffies counter.  This in turn can cause timeouts to go off before\nthey should.\n\nHere are some more details for x86_64.  i386 is generally similar.\n\narch/x86_64/kernel/smpboot.c:smp_boot_cpus()\n\n\tif (!skip_ioapic_setup && nr_ioapics)\n\t\tsetup_IO_APIC();      // calls check_timer() - hooks up PIT IRQ\n\telse\n\t\tnr_ioapics = 0;\n\n\tsetup_boot_APIC_clock();\n\n\t/*\n\t * Synchronize the TSC with the AP\n\t */\n\tif (cpu_has_tsc && cpucount)\n\t\tsynchronize_tsc_bp(); // Clear TSCs of all cpus\n\n\nsetup_IO_APIC() calls check_timer(). check_timer() goes through\nvarious schemes of hooking up the PIT IRQ. On success, it leaves it in\nthe unmasked state and from that point on we get timer interrupts.\n\nsynchronize_tsc_bp() is called after PIT timer interrupts are enabled. This\nfunction clears TSC on all cpus. By the time TSC is cleared, the BSP is\nguaranteed to have received at least 4 PIT interrupts (otherwise\ncheck_timer() would have declared it nonworking).\n\nThe timer interrupt code has some logic to compensate for lost interrupts.\nTSC of the last interrupt is saved in vxtime.last_tsc. However, when Linux\nclears TSC in synchronize_tsc_bp(), it does not clear any state in vxtime.\nAs a result, the next timer interrupt _after_ TSC is cleared can get\nconfused and think that lots of time was lost. Whether this happens or not\nis non-deterministic. \"offset\" variable that captures the time since the\nlast timer, is declared \"int\". It could end up positive or negative.\n\n\t\toffset = (((tsc - vxtime.last_tsc) *\n\t\t\t   vxtime.tsc_quot) >> 32) - (USEC_PER_SEC / HZ);\n\nThe number of lost ticks in \"lost\" is a function of offset which could be\nbogus. Here is all relevant code:\n\narch/x86)64/kernel/time.c:timer_interrupt(), VXTIME_TSC case:\n\tunsigned long tsc, lost = 0;\n\tint delay, offset = 0;\n\n\tif (vxtime.mode == VXTIME_HPET) {\n           ... // we do not go here\n\t} else {\n\t\toffset = (((tsc - vxtime.last_tsc) *\n\t\t\t   vxtime.tsc_quot) >> 32) - (USEC_PER_SEC / HZ);\n\n\t\tif (offset < 0)\n\t\t\toffset = 0;\n\n\t\tif (offset > (USEC_PER_SEC / HZ)) {\n\t\t\tlost = offset / (USEC_PER_SEC / HZ);\n\t\t\toffset %= (USEC_PER_SEC / HZ);\n\t\t}\n\n\t\tmonotonic_base += (tsc - vxtime.last_tsc)*1000000/cpu_khz ;\n\n\t\tvxtime.last_tsc = tsc - vxtime.quot * delay / vxtime.tsc_quot;\n\n\t\tif ((((tsc - vxtime.last_tsc) *\n\t\t      vxtime.tsc_quot) >> 32) < offset)\n\t\t\tvxtime.last_tsc = tsc -\n\t\t\t\t(((long) offset << 32) / vxtime.tsc_quot) - 1;\n\t}\n\n\tif (lost) {\n\t\tif (report_lost_ticks) {\n\t\t\tprintk(KERN_WARNING \"time.c: Lost %ld timer \"\n\t\t\t       \"tick(s)! \", lost);\n\t\t\tprint_symbol(\"rip %s)\\n\", regs->rip);\n\t\t}\n\t\tjiffies += lost;\n\t}", "patch": ["diff --git a/arch/i386/kernel/timers/timer_tsc.c b/arch/i386/kernel/timers/timer_tsc.c\n--- a/arch/i386/kernel/timers/timer_tsc.c\n+++ b/arch/i386/kernel/timers/timer_tsc.c\n@@ -45,6 +45,15 @@ static unsigned long last_tsc_high; /* m\n static unsigned long long monotonic_base;\n static seqlock_t monotonic_lock = SEQLOCK_UNLOCKED;\n \n+/* Avoid compensating for lost ticks before TSCs are synched */\n+static int detect_lost_ticks;\n+static int __init start_lost_tick_compensation(void)\n+{\n+\tdetect_lost_ticks = 1;\n+\treturn 0;\n+}\n+late_initcall(start_lost_tick_compensation);\n+\n /* convert from cycles(64bits) => nanoseconds (64bits)\n  *  basic equation:\n  *\t\tns = cycles / (freq / ns_per_sec)\n@@ -196,7 +205,8 @@ static void mark_offset_tsc_hpet(void)\n \n \t/* lost tick compensation */\n \toffset = hpet_readl(HPET_T0_CMP) - hpet_tick;\n-\tif (unlikely(((offset - hpet_last) > hpet_tick) && (hpet_last != 0))) {\n+\tif (unlikely(((offset - hpet_last) > hpet_tick) && (hpet_last != 0))\n+\t\t\t\t\t&& detect_lost_ticks) {\n \t\tint lost_ticks = (offset - hpet_last) / hpet_tick;\n \t\tjiffies_64 += lost_ticks;\n \t}\n@@ -419,7 +429,7 @@ static void mark_offset_tsc(void)\n \tdelta += delay_at_last_interrupt;\n \tlost = delta/(1000000/HZ);\n \tdelay = delta%(1000000/HZ);\n-\tif (lost >= 2) {\n+\tif (lost >= 2 && detect_lost_ticks) {\n \t\tjiffies_64 += lost-1;\n \n \t\t/* sanity check to ensure we're not always losing ticks */\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Timers", "Classification": "Unclassified", "Component": "Other", "Hardware": "i386 Linux", "Importance": "P2 low", "Assignee": "john stultz", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2005-10-04 18:16 UTC by Tim Mann", "Modified": "2006-05-09 17:36 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "2.6.11", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["arch/i386/kernel/timers/timer_tsc.c"], "methods": ["mark_offset_tsc_hpet", "mark_offset_tsc"]}
{"id": "5151", "title": "Driver Mouse - Toshiba touchpad after kernel 2.6.11", "description": "Most recent kernel where this bug did not occur: 2.6.11\nDistribution: Debian 3.1\nHardware Environment: Toshiba satellite 2410\nSoftware Environment: KDE\nProblem Description:\n\nSince the kernel 2.6.12, i have a problem with my touchpad. In Kde, the menus\ndisappear. In thunderbird, if i go to my last message and that i use my\ntouchpad, it returns at the beginning.\n\nBut when i put these lines in comments, all is correct. But not the scroll.\n(Option         \"ZAxisMapping\"          \"4 5\")\n\nSection \"InputDevice\"\n        Identifier      \"Configured Mouse\"\n        Driver          \"mouse\"\n        Option          \"CorePointer\"\n        Option          \"Device\"                \"/dev/psaux\"\n        Option          \"Protocol\"              \"ImPS/2\"\n        #Option         \"ZAxisMapping\"          \"4 5\"\nEndSection\nSection \"InputDevice\"\n        Identifier      \"Generic Mouse\"\n        Driver          \"mouse\"\n        Option          \"SendCoreEvents\"        \"true\"\n        Option          \"Device\"                \"/dev/input/mice\"\n        Option          \"Protocol\"              \"ImPS/2\"\n        #Option         \"ZAxisMapping\"          \"4 5\"\nEndSection\n\nIn 2.6.11, it's ok.\n\nThanks,\n\nPatrick", "patch": ["ALPS: Fix scroll wheel reporting\n\nSigned-off-by: Dmitry Torokhov <dtor@mail.ru>\n---\n\n drivers/input/mouse/alps.c |    2 +-\n 1 files changed, 1 insertion(+), 1 deletion(-)\n\nIndex: linux-2.6.12/drivers/input/mouse/alps.c\n===================================================================\n--- linux-2.6.12.orig/drivers/input/mouse/alps.c\n+++ linux-2.6.12/drivers/input/mouse/alps.c\n@@ -169,7 +169,7 @@ static void alps_process_packet(struct p\n \tinput_report_abs(dev, ABS_PRESSURE, z);\n \tinput_report_key(dev, BTN_TOOL_FINGER, z > 0);\n \n-\tif (priv->i->flags & ALPS_WHEEL)\n+\tif ((priv->i->flags & ALPS_WHEEL) && (packet[0] & 0x70)\n \t\tinput_report_rel(dev, REL_WHEEL, ((packet[0] >> 4) & 0x07) | ((packet[2] >> 2) & 0x08));\n \n \tif (priv->i->flags & (ALPS_FW_BK_1 | ALPS_FW_BK_2)) {\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Input Devices", "Hardware": "i386 Linux", "Importance": "P2 high", "Assignee": "Dmitry Torokhov", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2005-08-29 18:32 UTC by Patrick", "Modified": "2005-12-21 14:44 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "2.6.13", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/input/mouse/alps.c"], "methods": ["alps_process_packet"]}
{"id": "5105", "title": "lost ticks - hang check - after loading the CPU", "description": "Distribution: Slamd64\nHardware Environment:\n\nAMD Athlon64 X2 4800+\nGigabyte GA-K8NXP-SLI motherboard\neVGA NVIDIA 6600GT PCI express\n\nSoftware Environment:\nx86_64 kernel target compiled from vanilla 2.6.12.5 kernel source\nx.org, nv driver (open source NVIDIA 2D accelerator driver)\n\nProblem Description:\nThe clock begins to run fast as soon as the CPU is loaded with a mathematical\ncalculation.  Kernel dmesg gives different messages depending on if in X windows\nor just at the console.  At the console the message is:\n\nLosing some ticks... checking if CPU frequency changed.\n\nIn X-Windows an additional message is\n\nwarning: many lost ticks.\nYour time source seems to be instable or some driver is hogging interupts\nrip default_idle+0x20/0x30\n\nIt might be possible to get that second message while only in console\neventually, but I haven't been able to do it.\n\nAlso, if hangcheck is turned on then I get a huge number of Hangcheck messages.\n\nAt first glance this might just sound like an annoying problem where the system\nclock is wrong.  However, it is more than just wrong system time.  After running\nfor a while the clock is running very fast.  The keyboard repeat delay depends\non the system clock being accurate, so once it is running fast then it is almost\nimpossible to type in X-windows.  Typing in the console does not seem to be\naffected.  A workaround I have come up with for the typing problem in X is to\nincrease the key repeat delay to the max:\n\nxset r rate 1000 30\n\nEven this workaround eventually fails as the clock continues to speed up.\n\nSteps to reproduce:\n\nRun anything that uses a lot of CPU.  Wait a while.  May take 30 minutes to an\nhour to start to get bad.", "patch": ["diff --git a/arch/x86_64/kernel/time.c b/arch/x86_64/kernel/time.c\n--- a/arch/x86_64/kernel/time.c\n+++ b/arch/x86_64/kernel/time.c\n@@ -959,9 +959,6 @@ static __init int unsynchronized_tsc(voi\n  \t   are handled in the OEM check above. */\n  \tif (boot_cpu_data.x86_vendor == X86_VENDOR_INTEL)\n  \t\treturn 0;\n- \t/* All in a single socket - should be synchronized */\n- \tif (cpus_weight(cpu_core_map[0]) == num_online_cpus())\n- \t\treturn 0;\n #endif\n  \t/* Assume multi socket systems are not synchronized */\n  \treturn num_online_cpus() > 1;\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Timers", "Classification": "Unclassified", "Component": "Other", "Hardware": "i386 Linux", "Importance": "P2 normal", "Assignee": "john stultz", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2005-08-21 12:47 UTC by Nathan Becker", "Modified": "2010-01-05 00:58 UTC", "CC List": "10 users", "See Also": "", "Kernel Version": "2.6.12", "Subsystem": "", "Regression": "No", "Bisected commit-id": "", "paths": ["arch/x86_64/kernel/time.c"], "methods": ["unsynchronized_tsc"]}
{"id": "5093", "title": "atmel_cs needs to keep firmware", "description": "Distribution: Debian unstable\nHardware Environment: x86 laptop pentium M compaq nc4000\nSoftware Environment: pcmcia_cs (not udev)\nProblem Description: \n\nMachine hangs on swsusp suspend to disk if 3com 3CRSHPW196 (atmel_cs) is in use,\nafter printing these two lines\n\nYenta O2: res at 0x94/0xD4: 00/ea\nYenta O2: enabling read prefetch/write burst\n\nSome investigation with Magic Sysrq indicates that it stopped in the middle of\nswsusp_write -> device_resume ... -> request_firmware: presumably the pcmcia\ndevice got resumed before the disk it wants to load its firmware from\n\nSteps to reproduce \n# #  -- insert a 3com network card and wait for modules to load --\n# echo platform >/sys/power/disk\n# echo disk >/sys/power/state", "patch": ["--- linux-2.6.12/drivers/net/wireless/atmel.c\t2005-06-17 20:48:29.000000000 +0100\n+++ atmel.c\t2005-08-19 16:10:07.000000000 +0100\n@@ -3680,8 +3680,14 @@\n \t\t\t\t\t\t\tfirmware_modifier[i], fw_table[fw_index].fw_file_ext);\n \t\t\t\t\t\tpriv->firmware_id[31] = '\\0';\n \t\t\t\t\t\tif (request_firmware(&fw_entry, priv->firmware_id, priv->sys_dev) == 0) {\n-\t\t\t\t\t\t\tsuccess = 1;\n-\t\t\t\t\t\t\tbreak;\n+\t\t\t\t\t\t\tif(priv->firmware=kmalloc(fw_entry->size,GFP_KERNEL)) {\n+\t\t\t\t\t\t\t\tsuccess = 1;\n+\t\t\t\t\t\t\t\tbreak;\n+\t\t\t\t\t\t\t} else {\n+\t\t\t\t\t\t\t\tprintk(KERN_ALERT \"%s: kmalloc for firmware image failed, cannot start.\\n\",dev->name);\n+\t\t\t\t\t\t\t\trelease_firmware(fw_entry);\n+\t\t\t\t\t\t\t\tbreak;\n+\t\t\t\t\t\t\t}\n \t\t\t\t\t\t}\n \t\t\t\t\t}\n \t\t\t\t}\n@@ -3696,6 +3702,8 @@\n \t\t\t\n \t\t\tfw = fw_entry->data;\n \t\t\tlen = fw_entry->size;\n+\t\t\tmemcpy(priv->firmware,fw,len);\n+\t\t\tpriv->firmware_length=len;\n \t\t}\n \t\t\n \t        if (len <= 0x6000) {\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "PCMCIA", "Hardware": "i386 Linux", "Importance": "P2 normal", "Assignee": "linux-pcmcia", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2005-08-19 07:57 UTC by Daniel Barlow", "Modified": "2009-03-18 08:28 UTC", "CC List": "4 users", "See Also": "", "Kernel Version": "2.6.12", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/net/wireless/atmel.c"], "methods": ["reset_atmel_card"]}
{"id": "4781", "title": "Conservative governor makes me lose my USB keyboard", "description": "Distribution: Slackware-current \n \nHardware Environment: Bi-Opteron system with Tiger K8W board, Logitech USB \nkeyboard \n \nSoftware Environment: Self-compiled 2.6.12rc6 and 2.6.12 kernels with \nkernel.org sources without patches, GCC 3.4.2, KDE 3.4.1 using the Logitech \ndriver. \n \nProblem Description: \nWhen I set up \"conservative\" as scaling governor (using a simple 'echo \n\"conservative\" > /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor' for \nCPU0 and CPU1 at boot), I cannot type anything in consoles and applications \n(like Kword, for instance) anymore. The oly way I can get my keyboard back is \nrebooting. \nWhen I use \"ondemand\", I don't have such problem at all. \nMy keyboard is a Logitech Internet Navigator USB keyboard. I cannot test a PS/2 \nkeyboard on this system, the PS/2 connector doesn't work since I plugged a \nsecond CPU in it. Everything works find, though, on this system, with any \ngovernor except the \"conservative\" one, so my guess is that it still has some \nquirks. \n \nSteps to reproduce: \nPlug a USB keyboard and set \"conservative\" as CPU governor for both processors \non a dual-Opteron system. It occurs every time to me, usually 10 to 20 seconds \nafter typing something.", "patch": ["\nDon't try to access not-present CPUs. \nConservative governor will always oops on SMP without this fix.\n\nSigned-off-by: Venkatesh Pallipadi <venkatesh.pallipadi@intel.com>\n\nIndex: linux-2.6.12/drivers/cpufreq/cpufreq_conservative.c\n===================================================================\n--- linux-2.6.12.orig/drivers/cpufreq/cpufreq_conservative.c\t2005-06-17 12:48:29.000000000 -0700\n+++ linux-2.6.12/drivers/cpufreq/cpufreq_conservative.c\t2005-09-22 15:26:54.669850424 -0700\n@@ -315,9 +315,9 @@\n \tpolicy = this_dbs_info->cur_policy;\n \n \tif ( init_flag == 0 ) {\n-\t\tfor ( /* NULL */; init_flag < NR_CPUS; init_flag++ ) {\n-\t\t\tdbs_info = &per_cpu(cpu_dbs_info, init_flag);\n-\t\t\trequested_freq[cpu] = dbs_info->cur_policy->cur;\n+\t\tfor_each_online_cpu(j) {\n+\t\t\tdbs_info = &per_cpu(cpu_dbs_info, j);\n+\t\t\trequested_freq[j] = dbs_info->cur_policy->cur;\n \t\t}\n \t\tinit_flag = 1;\n \t}\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Power Management", "Classification": "Unclassified", "Component": "cpufreq", "Hardware": "i386 Linux", "Importance": "P2 normal", "Assignee": "Venkatesh Pallipadi", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2005-06-23 00:34 UTC by Richard Van Den Boom", "Modified": "2005-10-29 08:50 UTC", "CC List": "3 users", "See Also": "", "Kernel Version": "2.6.12", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/cpufreq/cpufreq_conservative.c"], "methods": ["dbs_check_cpu"]}
{"id": "4625", "title": "ub is much slower in writing than usb-storage", "description": "Distribution: mandrake 10.2 rc2 \n\nHardware Environment: desktop - Asus A7V133 motherboard - Athlon XP 1600 CPU \n\nProblem Description:\n\nI have a 128Mb usb key drive. Writing to it is very slow with ub driver.\nYesterday, I tried to copy 16Mb to this drive then I issued a sync command to\nunmount it. 11 (eleven) minutes later, I aborted it by rmmoding uhci_hcd. \n\nUsing usb-storage instead of ub worked well. \n\nSteps to reproduce:\n\n# modprobe ub \n(plug the usb key drive)\n# mount -orw,nosuid,nodev,iocharset=iso8859-15,umask=0 /dev/uba1 /mnt/disk\n# time sh -c \" dd if=/dev/urandom of=/mnt/disk/blah bs=1k count=512 ; sync;\" \n512+0 enregistrements lus.\n512+0 enregistrements", "patch": ["The sequential resubmit of URB (non-Axboe approach, needed for packet commands).\nThis returns correct transfer sizes, and, possibly, correct errors.\n- also function rename\n- also space for *page\n\n--- linux-2.6.13-rc4/drivers/block/ub.c\t2005-07-29 19:51:00.000000000 -0700\n+++ linux-2.6.13-rc4-lem/drivers/block/ub.c\t2005-08-14 20:45:52.000000000 -0700\n@@ -16,9 +16,10 @@\n  *  -- verify the 13 conditions and do bulk resets\n  *  -- kill last_pipe and simply do two-state clearing on both pipes\n  *  -- verify protocol (bulk) from USB descriptors (maybe...)\n- *  -- highmem and sg\n+ *  -- highmem\n  *  -- move top_sense and work_bcs into separate allocations (if they survive)\n  *     for cache purists and esoteric architectures.\n+ *  -- Allocate structure for LUN 0 before the first ub_sync_tur, avoid NULL. ?\n  *  -- prune comments, they are too volumnous\n  *  -- Exterminate P3 printks\n  *  -- Resove XXX's\n@@ -171,7 +172,7 @@ struct bulk_cs_wrap {\n  */\n struct ub_dev;\n \n-#define UB_MAX_REQ_SG\t1\n+#define UB_MAX_REQ_SG\t4\n #define UB_MAX_SECTORS 64\n \n /*\n@@ -234,13 +235,10 @@ struct ub_scsi_cmd {\n \n \tint stat_count;\t\t\t/* Retries getting status. */\n \n-\t/*\n-\t * We do not support transfers from highmem pages\n-\t * because the underlying USB framework does not do what we need.\n-\t */\n-\tchar *data;\t\t\t/* Requested buffer */\n \tunsigned int len;\t\t/* Requested length */\n-\t// struct scatterlist sgv[UB_MAX_REQ_SG];\n+\tunsigned int current_sg;\n+\tunsigned int nsg;\t\t/* sgv[nsg] */\n+\tstruct scatterlist sgv[UB_MAX_REQ_SG];\n \n \tstruct ub_lun *lun;\n \tvoid (*done)(struct ub_dev *, struct ub_scsi_cmd *);\n@@ -389,17 +387,18 @@ struct ub_dev {\n \tstruct bulk_cs_wrap work_bcs;\n \tstruct usb_ctrlrequest work_cr;\n \n+\tint sg_stat[UB_MAX_REQ_SG+1];\n \tstruct ub_scsi_trace tr;\n };\n \n /*\n  */\n static void ub_cleanup(struct ub_dev *sc);\n-static int ub_bd_rq_fn_1(struct ub_lun *lun, struct request *rq);\n+static int ub_request_fn_1(struct ub_lun *lun, struct request *rq);\n static int ub_cmd_build_block(struct ub_dev *sc, struct ub_lun *lun,\n     struct ub_scsi_cmd *cmd, struct request *rq);\n-static int ub_cmd_build_packet(struct ub_dev *sc, struct ub_scsi_cmd *cmd,\n-    struct request *rq);\n+static int ub_cmd_build_packet(struct ub_dev *sc, struct ub_lun *lun,\n+    struct ub_scsi_cmd *cmd, struct request *rq);\n static void ub_rw_cmd_done(struct ub_dev *sc, struct ub_scsi_cmd *cmd);\n static void ub_end_rq(struct request *rq, int uptodate);\n static int ub_submit_scsi(struct ub_dev *sc, struct ub_scsi_cmd *cmd);\n@@ -407,6 +406,7 @@ static void ub_urb_complete(struct urb *\n static void ub_scsi_action(unsigned long _dev);\n static void ub_scsi_dispatch(struct ub_dev *sc);\n static void ub_scsi_urb_compl(struct ub_dev *sc, struct ub_scsi_cmd *cmd);\n+static void ub_data_start(struct ub_dev *sc, struct ub_scsi_cmd *cmd);\n static void ub_state_done(struct ub_dev *sc, struct ub_scsi_cmd *cmd, int rc);\n static int __ub_state_stat(struct ub_dev *sc, struct ub_scsi_cmd *cmd);\n static void ub_state_stat(struct ub_dev *sc, struct ub_scsi_cmd *cmd);\n@@ -500,7 +500,8 @@ static void ub_cmdtr_sense(struct ub_dev\n \t}\n }\n \n-static ssize_t ub_diag_show(struct device *dev, struct device_attribute *attr, char *page)\n+static ssize_t ub_diag_show(struct device *dev, struct device_attribute *attr,\n+    char *page)\n {\n \tstruct usb_interface *intf;\n \tstruct ub_dev *sc;\n@@ -523,6 +524,13 @@ static ssize_t ub_diag_show(struct devic\n \tcnt += sprintf(page + cnt,\n \t    \"qlen %d qmax %d\\n\",\n \t    sc->cmd_queue.qlen, sc->cmd_queue.qmax);\n+\tcnt += sprintf(page + cnt,\n+\t    \"sg %d %d %d %d %d\\n\",\n+\t    sc->sg_stat[0],\n+\t    sc->sg_stat[1],\n+\t    sc->sg_stat[2],\n+\t    sc->sg_stat[3],\n+\t    sc->sg_stat[4]);\n \n \tlist_for_each (p, &sc->luns) {\n \t\tlun = list_entry(p, struct ub_lun, link);\n@@ -744,20 +752,20 @@ static struct ub_scsi_cmd *ub_cmdq_pop(s\n  * The request function is our main entry point\n  */\n \n-static void ub_bd_rq_fn(request_queue_t *q)\n+static void ub_request_fn(request_queue_t *q)\n {\n \tstruct ub_lun *lun = q->queuedata;\n \tstruct request *rq;\n \n \twhile ((rq = elv_next_request(q)) != NULL) {\n-\t\tif (ub_bd_rq_fn_1(lun, rq) != 0) {\n+\t\tif (ub_request_fn_1(lun, rq) != 0) {\n \t\t\tblk_stop_queue(q);\n \t\t\tbreak;\n \t\t}\n \t}\n }\n \n-static int ub_bd_rq_fn_1(struct ub_lun *lun, struct request *rq)\n+static int ub_request_fn_1(struct ub_lun *lun, struct request *rq)\n {\n \tstruct ub_dev *sc = lun->udev;\n \tstruct ub_scsi_cmd *cmd;\n@@ -774,9 +782,8 @@ static int ub_bd_rq_fn_1(struct ub_lun *\n \tmemset(cmd, 0, sizeof(struct ub_scsi_cmd));\n \n \tblkdev_dequeue_request(rq);\n-\n \tif (blk_pc_request(rq)) {\n-\t\trc = ub_cmd_build_packet(sc, cmd, rq);\n+\t\trc = ub_cmd_build_packet(sc, lun, cmd, rq);\n \t} else {\n \t\trc = ub_cmd_build_block(sc, lun, cmd, rq);\n \t}\n@@ -791,7 +798,7 @@ static int ub_bd_rq_fn_1(struct ub_lun *\n \tcmd->back = rq;\n \n \tcmd->tag = sc->tagcnt++;\n-\tif ((rc = ub_submit_scsi(sc, cmd)) != 0) {\n+\tif (ub_submit_scsi(sc, cmd) != 0) {\n \t\tub_put_cmd(lun, cmd);\n \t\tub_end_rq(rq, 0);\n \t\treturn 0;\n@@ -804,58 +811,31 @@ static int ub_cmd_build_block(struct ub_\n     struct ub_scsi_cmd *cmd, struct request *rq)\n {\n \tint ub_dir;\n-#if 0 /* We use rq->buffer for now */\n-\tstruct scatterlist *sg;\n \tint n_elem;\n-#endif\n \tunsigned int block, nblks;\n \n \tif (rq_data_dir(rq) == WRITE)\n \t\tub_dir = UB_DIR_WRITE;\n \telse\n \t\tub_dir = UB_DIR_READ;\n+\tcmd->dir = ub_dir;\n \n \t/*\n \t * get scatterlist from block layer\n \t */\n-#if 0 /* We use rq->buffer for now */\n-\tsg = &cmd->sgv[0];\n-\tn_elem = blk_rq_map_sg(q, rq, sg);\n+\tn_elem = blk_rq_map_sg(lun->disk->queue, rq, &cmd->sgv[0]);\n \tif (n_elem <= 0) {\n-\t\tub_put_cmd(lun, cmd);\n-\t\tub_end_rq(rq, 0);\n-\t\tblk_start_queue(q);\n-\t\treturn 0;\t\t/* request with no s/g entries? */\n+\t\tprintk(KERN_INFO \"%s: failed request map (%d)\\n\",\n+\t\t    sc->name, n_elem); /* P3 */\n+\t\treturn -1;\t\t/* request with no s/g entries? */\n \t}\n-\n-\tif (n_elem != 1) {\t\t/* Paranoia */\n+\tif (n_elem > UB_MAX_REQ_SG) {\t/* Paranoia */\n \t\tprintk(KERN_WARNING \"%s: request with %d segments\\n\",\n \t\t    sc->name, n_elem);\n-\t\tub_put_cmd(lun, cmd);\n-\t\tub_end_rq(rq, 0);\n-\t\tblk_start_queue(q);\n-\t\treturn 0;\n-\t}\n-#endif\n-\n-\t/*\n-\t * XXX Unfortunately, this check does not work. It is quite possible\n-\t * to get bogus non-null rq->buffer if you allow sg by mistake.\n-\t */\n-\tif (rq->buffer == NULL) {\n-\t\t/*\n-\t\t * This must not happen if we set the queue right.\n-\t\t * The block level must create bounce buffers for us.\n-\t\t */\n-\t\tstatic int do_print = 1;\n-\t\tif (do_print) {\n-\t\t\tprintk(KERN_WARNING \"%s: unmapped block request\"\n-\t\t\t    \" flags 0x%lx sectors %lu\\n\",\n-\t\t\t    sc->name, rq->flags, rq->nr_sectors);\n-\t\t\tdo_print = 0;\n-\t\t}\n \t\treturn -1;\n \t}\n+\tcmd->nsg = n_elem;\n+\tsc->sg_stat[n_elem]++;\n \n \t/*\n \t * build the command\n@@ -876,30 +856,15 @@ static int ub_cmd_build_block(struct ub_\n \tcmd->cdb[8] = nblks;\n \tcmd->cdb_len = 10;\n \n-\tcmd->dir = ub_dir;\n-\tcmd->data = rq->buffer;\n \tcmd->len = rq->nr_sectors * 512;\n \n \treturn 0;\n }\n \n-static int ub_cmd_build_packet(struct ub_dev *sc, struct ub_scsi_cmd *cmd,\n-    struct request *rq)\n+static int ub_cmd_build_packet(struct ub_dev *sc, struct ub_lun *lun,\n+    struct ub_scsi_cmd *cmd, struct request *rq)\n {\n-\n-\tif (rq->data_len != 0 && rq->data == NULL) {\n-\t\tstatic int do_print = 1;\n-\t\tif (do_print) {\n-\t\t\tprintk(KERN_WARNING \"%s: unmapped packet request\"\n-\t\t\t    \" flags 0x%lx length %d\\n\",\n-\t\t\t    sc->name, rq->flags, rq->data_len);\n-\t\t\tdo_print = 0;\n-\t\t}\n-\t\treturn -1;\n-\t}\n-\n-\tmemcpy(&cmd->cdb, rq->cmd, rq->cmd_len);\n-\tcmd->cdb_len = rq->cmd_len;\n+\tint n_elem;\n \n \tif (rq->data_len == 0) {\n \t\tcmd->dir = UB_DIR_NONE;\n@@ -908,8 +873,29 @@ static int ub_cmd_build_packet(struct ub\n \t\t\tcmd->dir = UB_DIR_WRITE;\n \t\telse\n \t\t\tcmd->dir = UB_DIR_READ;\n+\n+\t}\n+\n+\t/*\n+\t * get scatterlist from block layer\n+\t */\n+\tn_elem = blk_rq_map_sg(lun->disk->queue, rq, &cmd->sgv[0]);\n+\tif (n_elem < 0) {\n+\t\tprintk(KERN_INFO \"%s: failed request map (%d)\\n\",\n+\t\t    sc->name, n_elem); /* P3 */\n+\t\treturn -1;\n+\t}\n+\tif (n_elem > UB_MAX_REQ_SG) {\t/* Paranoia */\n+\t\tprintk(KERN_WARNING \"%s: request with %d segments\\n\",\n+\t\t    sc->name, n_elem);\n+\t\treturn -1;\n \t}\n-\tcmd->data = rq->data;\n+\tcmd->nsg = n_elem;\n+\tsc->sg_stat[n_elem]++;\n+\n+\tmemcpy(&cmd->cdb, rq->cmd, rq->cmd_len);\n+\tcmd->cdb_len = rq->cmd_len;\n+\n \tcmd->len = rq->data_len;\n \n \treturn 0;\n@@ -919,24 +905,34 @@ static void ub_rw_cmd_done(struct ub_dev\n {\n \tstruct request *rq = cmd->back;\n \tstruct ub_lun *lun = cmd->lun;\n-\tstruct gendisk *disk = lun->disk;\n-\trequest_queue_t *q = disk->queue;\n \tint uptodate;\n \n-\tif (blk_pc_request(rq)) {\n-\t\t/* UB_SENSE_SIZE is smaller than SCSI_SENSE_BUFFERSIZE */\n-\t\tmemcpy(rq->sense, sc->top_sense, UB_SENSE_SIZE);\n-\t\trq->sense_len = UB_SENSE_SIZE;\n-\t}\n-\n-\tif (cmd->error == 0)\n+\tif (cmd->error == 0) {\n \t\tuptodate = 1;\n-\telse\n+\n+\t\tif (blk_pc_request(rq)) {\n+\t\t\tif (cmd->act_len >= rq->data_len)\n+\t\t\t\trq->data_len = 0;\n+\t\t\telse\n+\t\t\t\trq->data_len -= cmd->act_len;\n+\t\t}\n+\t} else {\n \t\tuptodate = 0;\n \n+\t\tif (blk_pc_request(rq)) {\n+\t\t\t/* UB_SENSE_SIZE is smaller than SCSI_SENSE_BUFFERSIZE */\n+\t\t\tmemcpy(rq->sense, sc->top_sense, UB_SENSE_SIZE);\n+\t\t\trq->sense_len = UB_SENSE_SIZE;\n+\t\t\tif (sc->top_sense[0] != 0)\n+\t\t\t\trq->errors = SAM_STAT_CHECK_CONDITION;\n+\t\t\telse\n+\t\t\t\trq->errors = DID_ERROR << 16;\n+\t\t}\n+\t}\n+\n \tub_put_cmd(lun, cmd);\n \tub_end_rq(rq, uptodate);\n-\tblk_start_queue(q);\n+\tblk_start_queue(lun->disk->queue);\n }\n \n static void ub_end_rq(struct request *rq, int uptodate)\n@@ -1103,7 +1099,6 @@ static void ub_scsi_urb_compl(struct ub_\n {\n \tstruct urb *urb = &sc->work_urb;\n \tstruct bulk_cs_wrap *bcs;\n-\tint pipe;\n \tint rc;\n \n \tif (atomic_read(&sc->poison)) {\n@@ -1204,38 +1199,13 @@ static void ub_scsi_urb_compl(struct ub_\n \t\t\tgoto Bad_End;\n \t\t}\n \n-\t\tif (cmd->dir == UB_DIR_NONE) {\n+\t\tif (cmd->dir == UB_DIR_NONE || cmd->nsg < 1) {\n \t\t\tub_state_stat(sc, cmd);\n \t\t\treturn;\n \t\t}\n \n-\t\tUB_INIT_COMPLETION(sc->work_done);\n-\n-\t\tif (cmd->dir == UB_DIR_READ)\n-\t\t\tpipe = sc->recv_bulk_pipe;\n-\t\telse\n-\t\t\tpipe = sc->send_bulk_pipe;\n-\t\tsc->last_pipe = pipe;\n-\t\tusb_fill_bulk_urb(&sc->work_urb, sc->dev, pipe,\n-\t\t    cmd->data, cmd->len, ub_urb_complete, sc);\n-\t\tsc->work_urb.transfer_flags = URB_ASYNC_UNLINK;\n-\t\tsc->work_urb.actual_length = 0;\n-\t\tsc->work_urb.error_count = 0;\n-\t\tsc->work_urb.status = 0;\n-\n-\t\tif ((rc = usb_submit_urb(&sc->work_urb, GFP_ATOMIC)) != 0) {\n-\t\t\t/* XXX Clear stalls */\n-\t\t\tprintk(\"ub: data #%d submit failed (%d)\\n\", cmd->tag, rc); /* P3 */\n-\t\t\tub_complete(&sc->work_done);\n-\t\t\tub_state_done(sc, cmd, rc);\n-\t\t\treturn;\n-\t\t}\n-\n-\t\tsc->work_timer.expires = jiffies + UB_DATA_TIMEOUT;\n-\t\tadd_timer(&sc->work_timer);\n-\n-\t\tcmd->state = UB_CMDST_DATA;\n-\t\tub_cmdtr_state(sc, cmd);\n+\t\t// udelay(125);\t\t// usb-storage has this\n+\t\tub_data_start(sc, cmd);\n \n \t} else if (cmd->state == UB_CMDST_DATA) {\n \t\tif (urb->status == -EPIPE) {\n@@ -1257,16 +1227,22 @@ static void ub_scsi_urb_compl(struct ub_\n \t\tif (urb->status == -EOVERFLOW) {\n \t\t\t/*\n \t\t\t * A babble? Failure, but we must transfer CSW now.\n+\t\t\t * XXX This is going to end in perpetual babble. Reset.\n \t\t\t */\n \t\t\tcmd->error = -EOVERFLOW;\t/* A cheap trick... */\n-\t\t} else {\n-\t\t\tif (urb->status != 0)\n-\t\t\t\tgoto Bad_End;\n+\t\t\tub_state_stat(sc, cmd);\n+\t\t\treturn;\n \t\t}\n+\t\tif (urb->status != 0)\n+\t\t\tgoto Bad_End;\n \n-\t\tcmd->act_len = urb->actual_length;\n+\t\tcmd->act_len += urb->actual_length;\n \t\tub_cmdtr_act_len(sc, cmd);\n \n+\t\tif (++cmd->current_sg < cmd->nsg) {\n+\t\t\tub_data_start(sc, cmd);\n+\t\t\treturn;\n+\t\t}\n \t\tub_state_stat(sc, cmd);\n \n \t} else if (cmd->state == UB_CMDST_STAT) {\n@@ -1401,6 +1377,46 @@ Bad_End: /* Little Excel is dead */\n \n /*\n  * Factorization helper for the command state machine:\n+ * Initiate a data segment transfer.\n+ */\n+static void ub_data_start(struct ub_dev *sc, struct ub_scsi_cmd *cmd)\n+{\n+\tstruct scatterlist *sg = &cmd->sgv[cmd->current_sg];\n+\tint pipe;\n+\tint rc;\n+\n+\tUB_INIT_COMPLETION(sc->work_done);\n+\n+\tif (cmd->dir == UB_DIR_READ)\n+\t\tpipe = sc->recv_bulk_pipe;\n+\telse\n+\t\tpipe = sc->send_bulk_pipe;\n+\tsc->last_pipe = pipe;\n+\tusb_fill_bulk_urb(&sc->work_urb, sc->dev, pipe,\n+\t    page_address(sg->page) + sg->offset, sg->length,\n+\t    ub_urb_complete, sc);\n+\tsc->work_urb.transfer_flags = URB_ASYNC_UNLINK;\n+\tsc->work_urb.actual_length = 0;\n+\tsc->work_urb.error_count = 0;\n+\tsc->work_urb.status = 0;\n+\n+\tif ((rc = usb_submit_urb(&sc->work_urb, GFP_ATOMIC)) != 0) {\n+\t\t/* XXX Clear stalls */\n+\t\tprintk(\"ub: data #%d submit failed (%d)\\n\", cmd->tag, rc); /* P3 */\n+\t\tub_complete(&sc->work_done);\n+\t\tub_state_done(sc, cmd, rc);\n+\t\treturn;\n+\t}\n+\n+\tsc->work_timer.expires = jiffies + UB_DATA_TIMEOUT;\n+\tadd_timer(&sc->work_timer);\n+\n+\tcmd->state = UB_CMDST_DATA;\n+\tub_cmdtr_state(sc, cmd);\n+}\n+\n+/*\n+ * Factorization helper for the command state machine:\n  * Finish the command.\n  */\n static void ub_state_done(struct ub_dev *sc, struct ub_scsi_cmd *cmd, int rc)\n@@ -1484,6 +1500,7 @@ static void ub_state_stat_counted(struct\n static void ub_state_sense(struct ub_dev *sc, struct ub_scsi_cmd *cmd)\n {\n \tstruct ub_scsi_cmd *scmd;\n+\tstruct scatterlist *sg;\n \tint rc;\n \n \tif (cmd->cdb[0] == REQUEST_SENSE) {\n@@ -1492,12 +1509,17 @@ static void ub_state_sense(struct ub_dev\n \t}\n \n \tscmd = &sc->top_rqs_cmd;\n+\tmemset(scmd, 0, sizeof(struct ub_scsi_cmd));\n \tscmd->cdb[0] = REQUEST_SENSE;\n \tscmd->cdb[4] = UB_SENSE_SIZE;\n \tscmd->cdb_len = 6;\n \tscmd->dir = UB_DIR_READ;\n \tscmd->state = UB_CMDST_INIT;\n-\tscmd->data = sc->top_sense;\n+\tscmd->nsg = 1;\n+\tsg = &scmd->sgv[0];\n+\tsg->page = virt_to_page(sc->top_sense);\n+\tsg->offset = (unsigned int)sc->top_sense & (PAGE_SIZE-1);\n+\tsg->length = UB_SENSE_SIZE;\n \tscmd->len = UB_SENSE_SIZE;\n \tscmd->lun = cmd->lun;\n \tscmd->done = ub_top_sense_done;\n@@ -1560,7 +1582,7 @@ static int ub_submit_clear_stall(struct \n  */\n static void ub_top_sense_done(struct ub_dev *sc, struct ub_scsi_cmd *scmd)\n {\n-\tunsigned char *sense = scmd->data;\n+\tunsigned char *sense = sc->top_sense;\n \tstruct ub_scsi_cmd *cmd;\n \n \t/*\n@@ -1852,6 +1874,7 @@ static int ub_sync_read_cap(struct ub_de\n     struct ub_capacity *ret)\n {\n \tstruct ub_scsi_cmd *cmd;\n+\tstruct scatterlist *sg;\n \tchar *p;\n \tenum { ALLOC_SIZE = sizeof(struct ub_scsi_cmd) + 8 };\n \tunsigned long flags;\n@@ -1872,7 +1895,11 @@ static int ub_sync_read_cap(struct ub_de\n \tcmd->cdb_len = 10;\n \tcmd->dir = UB_DIR_READ;\n \tcmd->state = UB_CMDST_INIT;\n-\tcmd->data = p;\n+\tcmd->nsg = 1;\n+\tsg = &cmd->sgv[0];\n+\tsg->page = virt_to_page(p);\n+\tsg->offset = (unsigned int)p & (PAGE_SIZE-1);\n+\tsg->length = 8;\n \tcmd->len = 8;\n \tcmd->lun = lun;\n \tcmd->done = ub_probe_done;\n@@ -2289,7 +2316,7 @@ static int ub_probe_lun(struct ub_dev *s\n \tdisk->driverfs_dev = &sc->intf->dev;\t/* XXX Many to one ok? */\n \n \trc = -ENOMEM;\n-\tif ((q = blk_init_queue(ub_bd_rq_fn, &sc->lock)) == NULL)\n+\tif ((q = blk_init_queue(ub_request_fn, &sc->lock)) == NULL)\n \t\tgoto err_blkqinit;\n \n \tdisk->queue = q;\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Other", "Hardware": "i386 Linux", "Importance": "P2 normal", "Assignee": "Pete Zaitcev", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2005-05-14 09:41 UTC by Laurent Riffard", "Modified": "2005-09-18 11:04 UTC", "CC List": "0 users", "See Also": "", "Kernel Version": "2.6.13", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/block/ub.c"], "methods": ["ub_diag_show", "ub_bd_rq_fn", "ub_bd_rq_fn_1", "ub_cmd_build_block", "ub_cmd_build_packet", "ub_rw_cmd_done", "ub_scsi_urb_compl", "ub_state_sense", "ub_submit_clear_stall", "ub_sync_read_cap", "ub_probe_lun", "ub_scsi_cmd", "struct ub_dev"]}
{"id": "4380", "title": "(net via_velocity) receiver hang after setting mtu >1500", "description": "Distribution: \n\nDebian testing\n\nHardware Environment:\n\nA normal PC with Pentium M and a VT6122 PCI board.\n\nlspci -vv:\n\n0000:02:04.0 Ethernet controller: VIA Technologies, Inc. VT6120/VT6121/VT6122\nGigabit Ethernet Adapter (rev 11)\n        Subsystem: VIA Technologies, Inc.: Unknown device 0110\n        Control: I/O+ Mem+ BusMaster- SpecCycle- MemWINV+ VGASnoop- ParErr-\nStepping- SERR+ FastB2B-\n        Status: Cap+ 66MHz+ UDF- FastB2B- ParErr- DEVSEL=medium >TAbort-\n<TAbort- <MAbort- >SERR- <PERR-\n        Interrupt: pin A routed to IRQ 201\n        Region 0: I/O ports at 4000 [size=256]\n        Region 1: Memory at e0201000 (32-bit, non-prefetchable) [size=256]\n        Capabilities: [50] Power Management version 2\n                Flags: PMEClk- DSI- D1+ D2+ AuxCurrent=0mA\nPME(D0+,D1+,D2+,D3hot+,D3cold+)\n                Status: D3 PME-Enable- DSel=0 DScale=0 PME-\n\nSoftware Environment:\n\nDebian testing with 2.6.8 or 2.6.10 kernel.\n\nProblem Description:\n\nThe via velocity GE-driver isn't working after setting MTU to higher\nthen 1500 (and setting it to lower than 1500 isn't allowed by the\ndriver, see bug 4001).\n\nOnly a few frames go through after setting the mtu to higher then 1500\n(ifconfig ethX mtu 1600), and in some cases no frames at all. The size\nof the frames don't seem to make any difference. Ethereal indicates\nthat the receiver stops working. Sending of frames still works.\n\nWhen this has occured must the interface be taken down and then up in\norder to get it working again. Just setting the mtu to 1500 again do\nnot solve the problem. Also, the kernel load was 0.67 when this\noccured, on an idle system. The load went down to <0.05 after taking\nthe interface down.\n\nOne oddity in the driver code is this:\n\n--------------------------------------------------------------------------\nstatic int velocity_open(struct net_device *dev)\n{\n        struct velocity_info *vptr = dev->priv;\n        int ret;\n\n        vptr->rx_buf_sz = (dev->mtu <= 1504 ? PKT_BUF_SZ : dev->mtu + 32);\n\n        ret = velocity_init_rings(vptr);\n--------------------------------------------------------------------------\nstatic int velocity_change_mtu(struct net_device *dev, int new_mtu)\n{\n        struct velocity_info *vptr = dev->priv;\n        unsigned long flags;\n        int oldmtu = dev->mtu;\n        int ret = 0;\n\n        if ((new_mtu < VELOCITY_MIN_MTU) || new_mtu > (VELOCITY_MAX_MTU)) {\n                VELOCITY_PRT(MSG_LEVEL_ERR, KERN_NOTICE \"%s: Invalid MTU.\\n\", \n                                vptr->dev->name);\n                return -EINVAL;\n        }\n\n        if (new_mtu != oldmtu) {\n                spin_lock_irqsave(&vptr->lock, flags);\n\n                netif_stop_queue(dev);\n                velocity_shutdown(vptr);\n\n                velocity_free_td_ring(vptr);\n                velocity_free_rd_ring(vptr);\n\n                dev->mtu = new_mtu;\n                if (new_mtu > 8192)\n                        vptr->rx_buf_sz = 9 * 1024;\n                else if (new_mtu > 4096)\n                        vptr->rx_buf_sz = 8192;\n                else\n                        vptr->rx_buf_sz = 4 * 1024;\n\n                ret = velocity_init_rd_ring(vptr);\n--------------------------------------------------------------------------\n\nAnd PKT_BUF_SZ is set to 1540. The resulting size of the rd's isn't\nthe same after changing the mtu to first 1600 and then back to 1500 as\nwhen set to 1500 in open.\n\nSteps to reproduce:\n\n# ifconfig eth0 mtu 1600\nThen run ping.\n\n/ Anders", "patch": ["<HTML>\n<HEAD>\n</HEAD>\n<BODY>\n<H1><a href=\"http://www.kruu.org/jvtm/via-velocity/velocityget-1.19-2.6.12_compile_fix.diff\">http://www.kruu.org/jvtm/via-velocity/velocityget-1.19-2.6.12_compile_fix.diff</a></H1>\n</BODY>\n</HTML>\n", "diff --git a/drivers/net/via-velocity.c b/drivers/net/via-velocity.c\nindex c2d5907..ed1f837 100644\n--- a/drivers/net/via-velocity.c\n+++ b/drivers/net/via-velocity.c\n@@ -1106,6 +1106,9 @@ static void velocity_free_rd_ring(struct\n \n \tfor (i = 0; i < vptr->options.numrx; i++) {\n \t\tstruct velocity_rd_info *rd_info = &(vptr->rd_info[i]);\n+\t\tstruct rx_desc *rd = vptr->rd_ring + i;\n+\n+\t\tmemset(rd, 0, sizeof(*rd));\n \n \t\tif (!rd_info->skb)\n \t\t\tcontinue;\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Network", "Hardware": "i386 Linux", "Importance": "P2 normal", "Assignee": "Jeff Garzik", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2005-03-21 07:23 UTC by Anders Bostr", "Modified": "2006-07-14 17:20 UTC", "CC List": "4 users", "See Also": "", "Kernel Version": "2.6.8", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/net/via-velocity.c"], "methods": ["velocity_free_rd_ring"]}
{"id": "4364", "title": "S1 suspend/resume resets thermal limits -- TP 600X", "description": "Distribution: Debian testing\n\nHardware Environment: Thinkpad 600X 650MHz Pentium III\n\nSoftware Environment: 2.6.11.4 + ACPI subsystem 20050309 + ibm_acpi 0.10f +\nXFree 4.3.0.1\n\nProblem Description: After entering S1 state, the screen goes blank but then\nstarts growing fine, rainbow-colored patterns near the middle of the screen and\na few horizontal lines.  The cruft grows until I hit the Fn key to wake it up. \nIt eventually comes back and the screen is just as it was before the sleep.  But\nvarious drivers are unhappy.  The uhci_hcd driver continuously reports error\nmessages such as \n\nhub 1-0:1.0: debounce: port 1: total 1500ms stable 0ms status 0x31f\nhub 1-0:1.0: connect-debounce failed, port 1 disabled\nuhci_hcd 0000:00:07.2: port 2 portsc ffff,00\nhub 1-0:1.0: over-current change on port 2\nhub 1-0:1.0: port 2, status 031f, change 000b, 1.5 Mb/s\nuhci_hcd 0000:00:07.2: port 2 portsc ffff,00\nuhci_hcd 0000:00:07.2: port 2 portsc ffff,00\nuhci_hcd 0000:00:07.2: port 2 portsc ffff,00\n\nThe messages continue until I modprobe -r the driver and then reload it.  But\nthat produces the following warning:\n\nUSB Universal Host Controller Interface driver v2.2\nPCI: Enabling device 0000:00:07.2 (0000 -> 0001)\nPCI: Found IRQ 11 for device 0000:00:07.2\nuhci_hcd 0000:00:07.2: Intel Corp. 82371AB/EB/MB PIIX4 USB\nuhci_hcd 0000:00:07.2: irq 11, io base 0x4000\nuhci_hcd 0000:00:07.2: new USB bus registered, assigned bus number 1\nuhci_hcd 0000:00:07.2: detected 8 ports\nuhci_hcd 0000:00:07.2: port count misdetected? forcing to 2 ports\nuhci_hcd 0000:00:07.2: USBCMD_HCRESET timed out!\nuhci_hcd 0000:00:07.2: init error -110\nuhci_hcd 0000:00:07.2: remove, state 0\nuhci_hcd 0000:00:07.2: roothub graceful disconnect\nusb_disconnect nodev\nUninitialised timer!\nThis is just a warning.  Your computer is OK\nfunction=0x00000000, data=0x0\n [<c011f351>] check_timer_failed+0x61/0x70\n [<c011f599>] del_timer+0x19/0x60\n [<e498c9c3>] uhci_stop+0x23/0x90 [uhci_hcd]\n [<c0255417>] usb_hcd_pci_remove+0xb7/0x1c0\n [<c02550c6>] usb_hcd_pci_probe+0x316/0x5b0\n [<c01d3282>] pci_device_probe_static+0x52/0x70\n [<c01d32dc>] __pci_device_probe+0x3c/0x50\n [<c01d331c>] pci_device_probe+0x2c/0x50\n [<c022713f>] driver_probe_device+0x2f/0x80\n [<c022728c>] driver_attach+0x5c/0xa0\n [<c02277dd>] bus_add_driver+0x9d/0xd0\n [<c0227dff>] driver_register+0x2f/0x40\n [<c01d35a4>] pci_register_driver+0x64/0x90\n [<e49b109b>] uhci_hcd_init+0x9b/0xf1 [uhci_hcd]\n [<c012e252>] sys_init_module+0x132/0x1c0\n [<c0102f33>] syscall_call+0x7/0xb\nuhci_hcd 0000:00:07.2: USB bus 1 deregistered\nuhci_hcd: probe of 0000:00:07.2 failed with error -110\n\nNot surprisingly the USB-connected cell phone (cdc_acm driver) wouldn't behave\nafter those errors (couldn't talk to the /dev/ttyACM0 device).  Also the modem\nin the xircom ethernet/modem combination card wouldn't work either.  Both worked\nfine before the sleep attempt (and are working fine now after rebooting).\n\nAlso, the thermal-zone settings reset themselves to the default.  I had done\n\n  echo 120:0:40:55:0 > /proc/acpi/thermal_zone/THM2/trip_points\n\nto get the damn loud fan to be less aggressive (which worked fine -- an ACPI\nsuccess for which I am very happy).  By the way, I also had to do \n\n  echo 10 > THM2/polling_frequency\n\nto get the change to take effect.  But now the polling_frequency is back to\n'polling disabled' and the trip_points back to\n\ncritical (S5):           120 C\nactive[0]:               34 C: devices=0xc1574108 \n\nI am using a custom DSDT: The vanilla TP 600X DSDT (from BIOS 1.11) but with a\nfew meager attempts to fix the DSDT recompilation errors and the S3 \"missing\nsleep state object\" error (Bug #3534) -- no good or bad effect from the fixes,\nat least that I could find.  I'll attach the output of acpidmp as well as\nseveral other hopefully useful files.\n\nSteps to reproduce: Boot w/ \"apm=off pci=noacpi acpi_sleep=s3_bios\" then into X,\nthen \"echo 1 > /proc/acpi/sleep\", wait a few seconds, then wake up by tapping\nthe Fn key.", "patch": ["Index: linux-2.6.16/drivers/acpi/thermal.c\n===================================================================\n--- linux-2.6.16.orig/drivers/acpi/thermal.c\n+++ linux-2.6.16/drivers/acpi/thermal.c\n@@ -82,6 +82,7 @@ MODULE_PARM_DESC(tzp, \"Thermal zone poll\n \n static int acpi_thermal_add(struct acpi_device *device);\n static int acpi_thermal_remove(struct acpi_device *device, int type);\n+static int acpi_thermal_resume(struct acpi_device *device, int state);\n static int acpi_thermal_state_open_fs(struct inode *inode, struct file *file);\n static int acpi_thermal_temp_open_fs(struct inode *inode, struct file *file);\n static int acpi_thermal_trip_open_fs(struct inode *inode, struct file *file);\n@@ -103,6 +104,7 @@ static struct acpi_driver acpi_thermal_d\n \t.ops = {\n \t\t.add = acpi_thermal_add,\n \t\t.remove = acpi_thermal_remove,\n+\t\t.resume = acpi_thermal_resume,\n \t\t},\n };\n \n@@ -1416,6 +1418,22 @@ static int acpi_thermal_remove(struct ac\n \treturn_VALUE(0);\n }\n \n+static int acpi_thermal_resume(struct acpi_device *device, int state)\n+{\n+\tstruct acpi_thermal *tz = NULL;\n+\n+\tACPI_FUNCTION_TRACE(\"acpi_thermal_resume\");\n+\n+\tif (!device || !acpi_driver_data(device))\n+\t\treturn_VALUE(-EINVAL);\n+\n+\ttz = (struct acpi_thermal *)acpi_driver_data(device);\n+\n+\tacpi_thermal_check(tz);\n+\n+\treturn_VALUE(AE_OK);\n+}\n+\n static int __init acpi_thermal_init(void)\n {\n \tint result = 0;\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "Power-Thermal", "Hardware": "i386 Linux", "Importance": "P2 normal", "Assignee": "Konstantin Karasyov", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2005-03-17 23:05 UTC by Sanjoy Mahajan", "Modified": "2007-02-15 22:18 UTC", "CC List": "1 user", "See Also": "", "Kernel Version": "2.6.16", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/acpi/thermal.c"], "methods": ["acpi_thermal_driver"]}
{"id": "4359", "title": "With HT off in bios, /proc/cpuinfo shows2 processors, each with 2 siblings", "description": "Distribution: RHEL4 AS, Fedora Core 2\nHardware Environment: Dual Xeon (HP DL-360 or Sun Fire V60x)\nSoftware Environment: kernel-smp\nProblem Description: inconsistent sibling count when ht is disabled\n\nSteps to reproduce:\n\nOn an HP DL-360 or Sun Fire V60x (dual xeon systems)\n  1. disable HT in the bios\n  2. boot any smp kernel after 2.6.5 (didn't try UP kernel)\n  3. /proc/cpuinfo shows 2 processors (phys ID 0 and 3) with 2 siblings\n\nExpected behavior:\n /proc/cpuinfo should show 2 processors with 1 sibling each.\n\nI don't see this behavior on any of my other dual xeon systems (HP x4000,\nxw8000, or xw8200).\nI don't see this behavior on ANY systems running kernel 2.6.5 or earlier.\nI've tried updating the firmware and that didn't help.", "patch": ["--- linux-2.6.6-1.435.2.3/arch/i386/kernel/smpboot.c.org\t2005-03-19 06:56:51.123416256 -0800\n+++ linux-2.6.6-1.435.2.3/arch/i386/kernel/smpboot.c\t2005-03-19 06:59:01.884537544 -0800\n@@ -1110,8 +1110,12 @@ static void __init smp_boot_cpus(unsigne\n \t\t\tcpu_set(cpu, cpu_sibling_map[cpu]);\n \t\t}\n \n-\t\tif (siblings != smp_num_siblings)\n+\t\tif (siblings != smp_num_siblings) {\n \t\t\tprintk(KERN_WARNING \"WARNING: %d siblings found for CPU%d, should be %d\\n\", siblings, cpu, smp_num_siblings);\n+\t\t\tprintk(KERN_WARNING \"WARNING: BIOS reporting wrong sibling count. Resetting it to %d\\n\", siblings);\n+\t\t\tsmp_num_siblings = siblings;\n+\t\t}\n+\n \t}\n \n \tif (nmi_watchdog == NMI_LOCAL_APIC)\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "BIOS", "Hardware": "i386 Linux", "Importance": "P2 normal", "Assignee": "Suresh B Siddha", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2005-03-17 12:25 UTC by Jay Hilliard", "Modified": "2005-06-03 17:05 UTC", "CC List": "3 users", "See Also": "", "Kernel Version": "2.6.7", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["arch/i386/kernel/smpboot.c"], "methods": ["smp_boot_cpus"]}
{"id": "4351", "title": "acpi_get_firmware_table return an invalid block of memory", "description": "I find this bug in IPMI driver but after root cause I think it is an ACPI \nrelated bug.So post it here and say sorry in advance if it is not the proper \nplace for it.\n\nDistribution:\nRed Hat Enterprise Linux AS release 4\n\nHardware Environment:\nHPCX 2600\n\nSoftware Environment:\n\n\nProblem Description:\n\nFail to load ipmi_si driver with oop.\n\nMore details can be found in PS2.\n\nAfter debugging with the driver, I found the OOP is caused by an invalid \naddress.In IPMI driver, we will call acpi_get_firmware_table in try_init_acpi \nfunction to get the information of SPMI table. In this information, there is a \nmemory pointered by spmi->addr.address and it is invalid. It seems acpi map a \nwrong memory and send itout to IPMI but from the boot log of system ACPI is \nenabled properly. I think in this case, an error code should be returned by \nacpi_get_firmware_table instead of AE_OK, just as what we see in IPMI driver\n(See PS1)\n\n\nSteps to reproduce:\n    modprobe ipmi_msghandler\n    modprobe ipmi_si kcs_addrs=0xff5b0ca2    \n\nPS1:\n\nUnable to handle kernel paging request at virtual address 00000000ff5b0caa\ninsmod[3942]: Oops 8813272891392 [1]\nModules linked in: ipmi_si(U) ipmi_msghandler(U) md5 ipv6 parport_pc lp \nparport autofs4 sunrpc ds yenta_socket pcmcia_core vfat fat dm_mod button \njoydev ohci_hcd ehci_hcd e100 mii tg3 ext3 jbd mptscsih mptbase sd_mod scsi_mod\n\nPid: 3942, CPU 1, comm:               insmod\npsr : 0000101008126030 ifs : 8000000000000693 ip  : [<a00000020048a110>]    \nNot tainted\nip is at init_one_smi+0x19b0/0x2760 [ipmi_si]\nunat: 0000000000000000 pfs : 0000000000000693 rsc : 0000000000000003\nrnat: 0000000000000060 bsps: 0000000000000040 pr  : 0000000005559a59\nldrs: 0000000000000000 ccv : 0000000000000000 fpsr: 0009804c8a70033f\ncsd : 0000000000000000 ssd : 0000000000000000\nb0  : a00000020048a0b0 b6  : a00000010022cba0 b7  : a000000100237780\nf6  : 000000000000000000000 f7  : 0ffe1f000000000000000\nf8  : 10005f000000000000000 f9  : 100028000000000000000\nf10 : 10002effffffff1000000 f11 : 1003e000000000000000f\nr1  : a000000200684000 r2  : e00000000487c384 r3  : e00000003fb20688\nr8  : 0000000000000000 r9  : a0007ffffff28ad8 r10 : a0007ffffff28ab0\nr11 : 0000000000055156 r12 : e000000032da7e00 r13 : e000000032da0000\nr14 : e00000000487c5c0 r15 : 0000000000000078 r16 : 0000000000000230\nr17 : 0000000000000047 r18 : e00000000487c390 r19 : a0007fffffc80000\nr20 : 00000000000613d0 r21 : 000000000000c27a r22 : e000000032da0dd4\nr23 : 00000000ff5b0caa r24 : 00000000ff5b0ca2 r25 : 0000000000000000\nr26 : 00000000ff5b0ca2 r27 : 0000000000000000 r28 : e00000003fb344a4\nr29 : e00000003fb344a8 r30 : e00000003fb34470 r31 : a000000200491cf0\n\nCall Trace:\n [<a000000100016a40>] show_stack+0x80/0xa0\n                                sp=e000000032da79b0 bsp=e000000032da1098\n [<a000000100017350>] show_regs+0x890/0x8c0\n                                sp=e000000032da7b80 bsp=e000000032da1050\n [<a00000010003c970>] die+0x150/0x240\n                                sp=e000000032da7ba0 bsp=e000000032da1010\n [<a00000010005d870>] ia64_do_page_fault+0x9f0/0xba0\n                                sp=e000000032da7ba0 bsp=e000000032da0fa0\n [<a00000010000f480>] ia64_leave_kernel+0x0/0x260\n                                sp=e000000032da7c30 bsp=e000000032da0fa0\n [<a00000020048a110>] init_one_smi+0x19b0/0x2760 [ipmi_si]\n                                sp=e000000032da7e00 bsp=e000000032da0f08\n [<a000000200338290>] init_ipmi_si+0x230/0x560 [ipmi_si]\n                                sp=e000000032da7e30 bsp=e000000032da0ed0\n [<a0000001000af320>] sys_init_module+0x420/0x620\n                                sp=e000000032da7e30 bsp=e000000032da0e60\n [<a00000010000f320>] ia64_ret_from_syscall+0x0/0x20\n                                sp=e000000032da7e30 bsp=e000000032da0e60\n [<a000000000010640>] 0xa000000000010640\n                                sp=e000000032da8000 bsp=e000000032da0e60\n\n\nPS2:(from dmesg)\nLinux version 2.6.9-5.EL (bhcompile@bullwinkle.build.redhat.com) (gcc version \n3.4.3 20041212 (Red Hat 3.4.3-9.EL4)) #1 SMP Wed Jan 5 19:23:24 EST 2005\nEFI v1.10 by HP: SALsystab=0x3fb38000 ACPI 2.0=0x3fb2c000 SMBIOS=0x3fb3a000 \nHCDP=0x3fb2a000\nbooting generic kernel on platform hpzx1\nACPI: RSDP (v002     HP                                ) @ 0x000000003fb2c000\nACPI: XSDT (v001     HP   cx2600 0x00000000 HP 0x00000000) @ 0x000000003fb2c02c\nACPI: FADT (v003     HP   cx2600 0x00000000 HP 0x00000000) @ 0x000000003fb342b0\nACPI: SPCR (v001     HP   cx2600 0x00000000 HP 0x00000000) @ 0x000000003fb343e8\nACPI: DBGP (v001     HP   cx2600 0x00000000 HP 0x00000000) @ 0x000000003fb34438\nACPI: MADT (v001     HP   cx2600 0x00000000 HP 0x00000000) @ 0x000000003fb34510\nACPI: SPMI (v004     HP   cx2600 0x00000000 HP 0x00000000) @ 0x000000003fb34470\nACPI: CPEP (v001     HP   cx2600 0x00000000 HP 0x00000000) @ 0x000000003fb344c0\nACPI: SSDT (v001     HP   cx2600 0x00000006 INTL 0x02012044) @ \n0x000000003fb31940\nACPI: SSDT (v001     HP   cx2600 0x00000006 INTL 0x02012044) @ \n0x000000003fb31ad0\nACPI: SSDT (v001     HP   cx2600 0x00000006 INTL 0x02012044) @ \n0x000000003fb31dd0\nACPI: SSDT (v001     HP   cx2600 0x00000006 INTL 0x02012044) @ \n0x000000003fb32640\nACPI: SSDT (v001     HP   cx2600 0x00000006 INTL 0x02012044) @ \n0x000000003fb32eb0\nACPI: SSDT (v001     HP   cx2600 0x00000006 INTL 0x02012044) @ \n0x000000003fb33720\nACPI: SSDT (v001     HP   cx2600 0x00000006 INTL 0x02012044) @ \n0x000000003fb33f90\nACPI: SSDT (v001     HP   cx2600 0x00000006 INTL 0x02012044) @ \n0x000000003fb34120\nACPI: SSDT (v001     HP   cx2600 0x00000006 INTL 0x02012044) @ \n0x000000003fb341e0\nACPI: DSDT (v001     HP   cx2600 0x00000007 INTL 0x02012044) @ \n0x0000000000000000\nWarning: acpi_table_parse(ACPI_SRAT) returned 0!\nWarning: acpi_table_parse(ACPI_SLIT) returned 0!\n\nThanx.", "patch": ["--- a/drivers/char/ipmi/ipmi_si_intf.c\t2005-03-03 10:56:51.000000000 +0800\n+++ b/drivers/char/ipmi/ipmi_si_intf.c\t2005-03-17 16:34:32.478606080 +0800\n@@ -1466,6 +1466,11 @@ static int try_init_acpi(int intf_num, s\n \tif (!is_new_interface(-1, addr_space, spmi->addr.address))\n \t\treturn -ENODEV;\n \n+\tif (!spmi->addr.register_bit_width) {\n+\t\tacpi_failure = 1;\n+\t\treturn -ENODEV;\n+\t}\n+\n \t/* Figure out the interface type. */\n \tswitch (spmi->InterfaceType)\n \t{\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "BIOS", "Hardware": "i386 Linux", "Importance": "P2 normal", "Assignee": "Shaohua", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2005-03-16 19:35 UTC by aaron", "Modified": "2005-04-14 23:57 UTC", "CC List": "1 user", "See Also": "", "Kernel Version": "2.6.9", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/char/ipmi/ipmi_si_intf.c"], "methods": ["try_init_acpi"]}
{"id": "4312", "title": "tridentfb: flicker when disk I/O is happening", "description": "Distribution: Debian/sarge\nHardware Environment: VIA Mini-ITX with onboard graphic\nlspci -v:\n0000:01:00.0 VGA compatible controller: Trident Microsystems CyberBlade/i1 (rev\n6a) (prog-if 00 [VGA])\n        Subsystem: Trident Microsystems CyberBlade/i1\n        Flags: bus master, 66MHz, medium devsel, latency 32, IRQ 11\n        Memory at e1800000 (32-bit, non-prefetchable) [size=8M]\n        Memory at e2000000 (32-bit, non-prefetchable) [size=128K]\n        Memory at e1000000 (32-bit, non-prefetchable) [size=8M]\n        Capabilities: [80] AGP version 2.0\n                Status: RQ=33 Iso- ArqSz=0 Cal=0 SBA+ ITACoh- GART64- HTrans-\n64bit- FW- AGP3- Rate=x1,x2,x4\n                Command: RQ=1 ArqSz=0 Cal=0 SBA- AGP- GART64- 64bit- FW-\nRate=<none>\n        Capabilities: [90] Power Management version 1\n                Flags: PMEClk- DSI+ D1+ D2+ AuxCurrent=0mA\nPME(D0-,D1-,D2-,D3hot-,D3cold-)\n                Status: D0 PME-Enable- DSel=0 DScale=0 PME-\n\nProblem Description:\nWhen there is disk I/O happening, the framebuffer has a little snow on the \nscreen.  Once I/O has finished, no garbage remains on screen.\n\nSteps to reproduce:\nboot with video=tridentfb (tried with and without noaccel).\nmodule via_agp is loaded with no special options, kernel command line contains\nagp_try_unsupported=1", "patch": ["drivers/video/tridentfb.c: needs update\nIndex: drivers/video/tridentfb.c\n===================================================================\n--- beed7ce23e1c31df16f16ac54a0db3cd6de583fe/drivers/video/tridentfb.c  (mode:100644)\n+++ uncommitted/drivers/video/tridentfb.c  (mode:100644)\n@@ -900,7 +900,7 @@\n \twrite3X4(DRAMControl, tmp);\t//both IO,linear enable\n \n \twrite3X4(InterfaceSel, read3X4(InterfaceSel) | 0x40);\n-\twrite3X4(Performance,0x20);\n+\twrite3X4(Performance,0x92);\n \twrite3X4(PCIReg,0x07);\t\t//MMIO & PCI read and write burst enable\n \n \t/* convert from picoseconds to MHz */\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Console/Framebuffers", "Hardware": "i386 Linux", "Importance": "P2 normal", "Assignee": "Antonino Daplas", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2005-03-08 10:49 UTC by Jochen Hein", "Modified": "2005-08-31 01:13 UTC", "CC List": "1 user", "See Also": "", "Kernel Version": "2.6.11", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/video/tridentfb.c"], "methods": ["tridentfb_set_par"]}
{"id": "4249", "title": "KERNEL: assertion (!atomic_read(&sk->sk_rmem_alloc)) failed at net/netlink/af_netlink.c (122)", "description": "Distribution: Slackware 10\nHardware Environment:\n# cat /proc/cpuinfo\nprocessor       : 0\nvendor_id       : GenuineIntel\ncpu family      : 15\nmodel           : 3\nmodel name      : Intel(R) Pentium(R) 4 CPU 2.80GHz\nstepping        : 4\ncpu MHz         : 2793.832\ncache size      : 1024 KB\nphysical id     : 0\nsiblings        : 2\nfdiv_bug        : no\nhlt_bug         : no\nf00f_bug        : no\ncoma_bug        : no\nfpu             : yes\nfpu_exception   : yes\ncpuid level     : 5\nwp              : yes\nflags           : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov\npat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe pni monitor ds_cpl cid\nxtpr\nbogomips        : 5505.02\n\nprocessor       : 1\nvendor_id       : GenuineIntel\ncpu family      : 15\nmodel           : 3\nmodel name      : Intel(R) Pentium(R) 4 CPU 2.80GHz\nstepping        : 4\ncpu MHz         : 2793.832\ncache size      : 1024 KB\nphysical id     : 0\nsiblings        : 2\nfdiv_bug        : no\nhlt_bug         : no\nf00f_bug        : no\ncoma_bug        : no\nfpu             : yes\nfpu_exception   : yes\ncpuid level     : 5\nwp              : yes\nflags           : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov\npat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe pni monitor ds_cpl cid\nxtpr\nbogomips        : 5570.56\n\n# lspci\n00:00.0 Host bridge: Intel Corp. E7220/E7221 Memory Controller Hub (rev 05)\n00:01.0 PCI bridge: Intel Corp. E7220/E7221 PCI Express Root Port (rev 05)\n00:02.0 VGA compatible controller: Intel Corp. E7221 Integrated Graphics\nController (rev 05)\n00:1c.0 PCI bridge: Intel Corp. 82801FB/FBM/FR/FW/FRW (ICH6 Family) PCI Express\nPort 1 (rev 03)\n00:1c.2 PCI bridge: Intel Corp. 82801FB/FBM/FR/FW/FRW (ICH6 Family) PCI Express\nPort 3 (rev 03)\n00:1c.3 PCI bridge: Intel Corp. 82801FB/FBM/FR/FW/FRW (ICH6 Family) PCI Express\nPort 4 (rev 03)\n00:1d.0 USB Controller: Intel Corp. 82801FB/FBM/FR/FW/FRW (ICH6 Family) USB UHCI\n#1 (rev 03)\n00:1d.1 USB Controller: Intel Corp. 82801FB/FBM/FR/FW/FRW (ICH6 Family) USB UHCI\n#2 (rev 03)\n00:1d.2 USB Controller: Intel Corp. 82801FB/FBM/FR/FW/FRW (ICH6 Family) USB UHCI\n#3 (rev 03)\n00:1d.3 USB Controller: Intel Corp. 82801FB/FBM/FR/FW/FRW (ICH6 Family) USB UHCI\n#4 (rev 03)\n00:1d.7 USB Controller: Intel Corp. 82801FB/FBM/FR/FW/FRW (ICH6 Family) USB2\nEHCI Controller (rev 03)\n00:1e.0 PCI bridge: Intel Corp. 82801 PCI Bridge (rev d3)\n00:1f.0 ISA bridge: Intel Corp. 82801FB/FR (ICH6/ICH6R) LPC Interface Bridge\n(rev 03)\n00:1f.1 IDE interface: Intel Corp. 82801FB/FBM/FR/FW/FRW (ICH6 Family) IDE\nController (rev 03)\n00:1f.2 Class 0106: Intel Corp. 82801FR/FRW (ICH6R/ICH6RW) SATA Controller (rev 03)\n00:1f.3 SMBus: Intel Corp. 82801FB/FBM/FR/FW/FRW (ICH6 Family) SMBus Controller\n(rev 03)\n01:00.0 PCI bridge: Intel Corp. 6702PXH PCI Express-to-PCI Bridge A (rev 09)\n01:00.1 PIC: Intel Corp. 6700/6702PXH I/OxAPIC Interrupt Controller A (rev 09)\n04:00.0 Ethernet controller: Broadcom Corporation NetXtreme BCM5721 Gigabit\nEthernet PCI Express (rev 11)\n05:00.0 Ethernet controller: Broadcom Corporation NetXtreme BCM5721 Gigabit\nEthernet PCI Express (rev 11)\n\nSoftware Environment:\nLinux version 2.6.11-rc4 (root@gw1) (gcc version 3.3.4) #1 SMP Mon Feb 14\n06:47:58 CET 2005\n\n# /usr/src/linux-2.6.11-rc4/scripts/ver_linux\n\nLinux gw1 2.6.11-rc4 #1 SMP Mon Feb 14 06:47:58 CET 2005 i686 unknown unknown\nGNU/Linux\n\nGnu C                  3.3.4\nGnu make               3.80\nbinutils               2.15.92.0.2\nutil-linux             2.12p\nmount                  2.12p\nmodule-init-tools      3.1\ne2fsprogs              1.35\nreiserfsprogs          line\nreiser4progs           line\nquota-tools            3.12.\nPPP                    2.4.2\nLinux C Library        2.3.3\nDynamic linker (ldd)   2.3.3\nLinux C++ Library      5.0.6\nProcps                 3.2.3\nNet-tools              1.60\nKbd                    1.12\nSh-utils               5.2.1\n/usr/src/linux-2.6.11-rc4/scripts/ver_linux: line 90: udevinfo: command not found\nModules Loaded         bonding\n\n# cat /proc/net/bonding/bond0\nEthernet Channel Bonding Driver: v2.6.1 (October 29, 2004)\n\nBonding Mode: fault-tolerance (active-backup)\nPrimary Slave: None\nCurrently Active Slave: eth1\nMII Status: up\nMII Polling Interval (ms): 100\nUp Delay (ms): 0\nDown Delay (ms): 0\n\nSlave Interface: eth0\nMII Status: up\nLink Failure Count: 3\nPermanent HW addr: 00:30:48:XX:XX:XX\n\nSlave Interface: eth1\nMII Status: up\nLink Failure Count: 0\nPermanent HW addr: 00:30:48:XX:XX:XX\n\n# cat /proc/net/vlan/config\nVLAN Dev name    | VLAN ID\nName-Type: VLAN_NAME_TYPE_PLUS_VID_NO_PAD\nvlan1          | 1  | bond0\nvlan2          | 2  | bond0\nvlan6          | 6  | bond0\nvlan33         | 33  | bond0\nvlan5          | 5  | bond0\n\nProblem Description:\nI use keepalived for vrrpd. Sometimes, when I restart (kill & start) keepalived\ndaemon kernel logs:\n\nKERNEL: assertion (!atomic_read(&sk->sk_rmem_alloc)) failed at\nnet/netlink/af_netlink.c (122)\nvlan1: del 01:00:5e:00:00:12 mcast address from master interface\n\nThe vlan1 device is used for vrrpd communication between two routers. It is\ncreated over the bound0 interface (eth0+eth1 in active-backup mode).\n\nAnyway, everything seems to work but this message is not very nice.\n\nSteps to reproduce:\n# killall keepalived", "patch": ["===== net/netlink/af_netlink.c 1.72 vs edited =====\n--- 1.72/net/netlink/af_netlink.c\t2005-03-23 14:17:09 +11:00\n+++ edited/net/netlink/af_netlink.c\t2005-03-30 16:24:27 +10:00\n@@ -1080,9 +1080,11 @@\n \tlen = cb->dump(skb, cb);\n \n \tif (len > 0) {\n+\t\tsock_hold(sk);\n \t\tspin_unlock(&nlk->cb_lock);\n \t\tskb_queue_tail(&sk->sk_receive_queue, skb);\n \t\tsk->sk_data_ready(sk, len);\n+\t\tsock_put(sk);\n \t\treturn 0;\n \t}\n \n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Networking", "Classification": "Unclassified", "Component": "Other", "Hardware": "i386 Linux", "Importance": "P2 normal", "Assignee": "Herbert Xu", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2005-02-24 16:15 UTC by Krzysztof Oledzki", "Modified": "2005-10-01 12:51 UTC", "CC List": "0 users", "See Also": "", "Kernel Version": "2.6.11", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["net/netlink/af_netlink.c"], "methods": ["netlink_dump"]}
{"id": "4219", "title": "pcnet32 fiberoptic do not works on Allied Telesyn 2701FTX", "description": "Problem Description:\n\n We have an Allied Telesyn 2701 FTX network cards. These cards has 2 interfaces:\na Fiberoptic 100 Mbit and a TP 10/100Mbit interface. These cards are based on\nAMD PCnet-PRO (AM79C976) chip. We coonnected two such cards using fiberoptic\ncables so diode on the cards indicates 100Mbit link. But Linux can't detect\nthis. It allways says \"link is down\". However, network works, but speed is very\nlow, about 1 Mbit.", "patch": ["--- linux-2.6.16-git1/drivers/net/pcnet32.c.orig\tMon Mar 20 13:53:17 2006\n+++ linux-2.6.16-git1/drivers/net/pcnet32.c\tMon Mar 20 14:26:15 2006\n@@ -22,8 +22,8 @@\n  *************************************************************************/\n \n #define DRV_NAME\t\"pcnet32\"\n-#define DRV_VERSION\t\"1.31c\"\n-#define DRV_RELDATE\t\"01.Nov.2005\"\n+#define DRV_VERSION\t\"1.32\"\n+#define DRV_RELDATE\t\"18.Mar.2006\"\n #define PFX\t\tDRV_NAME \": \"\n \n static const char * const version =\n@@ -133,7 +133,7 @@ static const char pcnet32_gstrings_test[\n };\n #define PCNET32_TEST_LEN (sizeof(pcnet32_gstrings_test) / ETH_GSTRING_LEN)\n \n-#define PCNET32_NUM_REGS 168\n+#define PCNET32_NUM_REGS 136\n \n #define MAX_UNITS 8\t/* More are supported, limit only on options */\n static int options[MAX_UNITS];\n@@ -265,6 +265,9 @@ static int homepna[MAX_UNITS];\n  * v1.31c  01 Nov 2005 Don Fry Allied Telesyn 2700/2701 FX are 100Mbit only.\n  *\t   Force 100Mbit FD if Auto (ASEL) is selected.\n  *\t   See Bugzilla 2669 and 4551.\n+ * v1.32   18 Mar2006 Thomas Bogendoerfer and Don Fry added Multi-Phy\n+ *\t   handling for supporting AT-270x FTX cards with FX and Tx PHYs.\n+ *\t   Philippe Seewer assisted with auto negotiation and testing.\n  */\n \n \n@@ -375,6 +378,7 @@ struct pcnet32_private {\n     unsigned int\tdirty_rx, dirty_tx; /* The ring entries to be free()ed. */\n     struct net_device_stats stats;\n     char\t\ttx_full;\n+    char\t\tphycount;\t/* number of phys found */\n     int\t\t\toptions;\n     unsigned int\tshared_irq:1,\t/* shared irq possible */\n \t\t\tdxsuflo:1,\t/* disable transmit stop on uflo */\n@@ -384,6 +388,9 @@ struct pcnet32_private {\n     struct timer_list\twatchdog_timer;\n     struct timer_list\tblink_timer;\n     u32\t\t\tmsg_enable;\t/* debug message level */\n+\n+    /* each bit indicates an available PHY */\n+    u32\t\t\tphymask;\n };\n \n static void pcnet32_probe_vlbus(void);\n@@ -415,6 +422,7 @@ static void pcnet32_get_regs(struct net_\n static void pcnet32_purge_tx_ring(struct net_device *dev);\n static int pcnet32_alloc_ring(struct net_device *dev, char *name);\n static void pcnet32_free_ring(struct net_device *dev);\n+static void pcnet32_check_media(struct net_device *dev, int verbose);\n \n \n enum pci_flags_bit {\n@@ -936,9 +944,14 @@ static int pcnet32_phys_id(struct net_de\n     return 0;\n }\n \n+#define PCNET32_REGS_PER_PHY\t32\n+#define PCNET32_MAX_PHYS\t32\n static int pcnet32_get_regs_len(struct net_device *dev)\n {\n-    return(PCNET32_NUM_REGS * sizeof(u16));\n+    struct pcnet32_private *lp = dev->priv;\n+    int j = lp->phycount * PCNET32_REGS_PER_PHY;\n+\n+    return((PCNET32_NUM_REGS + j) * sizeof(u16));\n }\n \n static void pcnet32_get_regs(struct net_device *dev, struct ethtool_regs *regs,\n@@ -998,9 +1011,14 @@ static void pcnet32_get_regs(struct net_\n \n     /* read mii phy registers */\n     if (lp->mii) {\n-\tfor (i=0; i<32; i++) {\n-\t    lp->a.write_bcr(ioaddr, 33, ((lp->mii_if.phy_id) << 5) | i);\n-\t    *buff++ = lp->a.read_bcr(ioaddr, 34);\n+\tint j;\n+\tfor (j=0; j<PCNET32_MAX_PHYS; j++) {\n+\t    if (lp->phymask & (1 << j)) {\n+\t\tfor (i=0; i<PCNET32_REGS_PER_PHY; i++) {\n+\t\t    lp->a.write_bcr(ioaddr, 33, (j << 5) | i);\n+\t\t    *buff++ = lp->a.read_bcr(ioaddr, 34);\n+\t\t}\n+\t    }\n \t}\n     }\n \n@@ -1009,10 +1027,6 @@ static void pcnet32_get_regs(struct net_\n \ta->write_csr(ioaddr, 5, 0x0000);\n     }\n \n-    i = buff - (u16 *)ptr;\n-    for (; i < PCNET32_NUM_REGS; i++)\n-\t*buff++ = 0;\n-\n     spin_unlock_irqrestore(&lp->lock, flags);\n }\n \n@@ -1185,7 +1199,7 @@ pcnet32_probe1(unsigned long ioaddr, int\n \tif (cards_found < MAX_UNITS && homepna[cards_found])\n \t    media |= 1; \t/* switch to home wiring mode */\n \tif (pcnet32_debug & NETIF_MSG_PROBE)\n-\t    printk(KERN_DEBUG PFX \"media set to %sMbit mode.\\n\", \n+\t    printk(KERN_DEBUG PFX \"media set to %sMbit mode.\\n\",\n \t\t    (media & 1) ? \"1\" : \"10\");\n \ta->write_bcr(ioaddr, 49, media);\n \tbreak;\n@@ -1401,8 +1415,34 @@ pcnet32_probe1(unsigned long ioaddr, int\n     }\n \n     /* Set the mii phy_id so that we can query the link state */\n-    if (lp->mii)\n+    if (lp->mii) {\n+\t/* lp->phycount and lp->phymask are set to 0 by memset above */\n+\n \tlp->mii_if.phy_id = ((lp->a.read_bcr (ioaddr, 33)) >> 5) & 0x1f;\n+\t/* scan for PHYs */\n+\tfor (i=0; i<PCNET32_MAX_PHYS; i++) {\n+\t    unsigned short id1, id2;\n+\n+\t    id1 = mdio_read(dev, i, MII_PHYSID1);\n+\t    if (id1 == 0xffff)\n+\t\tcontinue;\n+\t    id2 = mdio_read(dev, i, MII_PHYSID2);\n+\t    if (id2 == 0xffff)\n+\t\tcontinue;\n+\t    if (i == 31 && ((chip_version + 1) & 0xfffe) == 0x2624)\n+\t\tcontinue;\t/* 79C971 & 79C972 have phantom phy at id 31 */\n+\t    lp->phycount++;\n+\t    lp->phymask |= (1 << i);\n+\t    lp->mii_if.phy_id = i;\n+\t    if (pcnet32_debug & NETIF_MSG_PROBE)\n+\t\tprintk(KERN_INFO PFX \"Found PHY %04x:%04x at address %d.\\n\",\n+\t\t\tid1, id2, i);\n+\t}\n+\tlp->a.write_bcr(ioaddr, 33, (lp->mii_if.phy_id) << 5);\n+\tif (lp->phycount > 1) {\n+\t    lp->options |= PCNET32_PORT_MII;\n+\t}\n+    }\n \n     init_timer (&lp->watchdog_timer);\n     lp->watchdog_timer.data = (unsigned long) dev;\n@@ -1625,7 +1665,7 @@ pcnet32_open(struct net_device *dev)\n \t\t\tdev->name);\n \t}\n     }\n-    {\n+    if (lp->phycount < 2) {\n \t/*\n \t * 24 Jun 2004 according AMD, in order to change the PHY,\n \t * DANAS (or DISPM for 79C976) must be set; then select the speed,\n@@ -1651,6 +1691,62 @@ pcnet32_open(struct net_device *dev)\n \t\tlp->a.write_bcr(ioaddr, 32, val);\n \t    }\n \t}\n+    } else {\n+ \tint first_phy = -1;\n+ \tu16 bmcr;\n+ \tu32 bcr9;\n+ \tstruct ethtool_cmd ecmd;\n+\n+ \t/*\n+ \t * There is really no good other way to handle multiple PHYs\n+ \t * other than turning off all automatics\n+ \t */\n+\tval = lp->a.read_bcr(ioaddr, 2);\n+\tlp->a.write_bcr(ioaddr, 2, val & ~2);\n+ \tval = lp->a.read_bcr(ioaddr, 32);\n+ \tlp->a.write_bcr(ioaddr, 32, val & ~(1 << 7)); /* stop MII manager */\n+\n+\tif (!(lp->options & PCNET32_PORT_ASEL)) {\n+\t    /* setup ecmd */\n+\t    ecmd.port = PORT_MII;\n+\t    ecmd.transceiver = XCVR_INTERNAL;\n+\t    ecmd.autoneg = AUTONEG_DISABLE;\n+\t    ecmd.speed = lp->options & PCNET32_PORT_100 ? SPEED_100 : SPEED_10;\n+\t    bcr9 = lp->a.read_bcr(ioaddr, 9);\n+\n+\t    if (lp->options & PCNET32_PORT_FD) {\n+\t\tecmd.duplex = DUPLEX_FULL;\n+\t\tbcr9 |= (1 << 0);\n+\t    } else {\n+\t\tecmd.duplex = DUPLEX_HALF;\n+\t\tbcr9 |= ~(1 << 0);\n+\t    }\n+\t    lp->a.write_bcr(ioaddr, 9, bcr9);\n+\t}\n+\n+ \tfor (i=0; i<PCNET32_MAX_PHYS; i++) {\n+ \t    if (lp->phymask & (1 << i)) {\n+ \t\t/* isolate all but the first PHY */\n+ \t\tbmcr = mdio_read(dev, i, MII_BMCR);\n+ \t\tif (first_phy == -1) {\n+ \t\t    first_phy = i;\n+ \t\t    mdio_write(dev, i, MII_BMCR, bmcr & ~BMCR_ISOLATE);\n+ \t\t} else {\n+ \t\t    mdio_write(dev, i, MII_BMCR, bmcr | BMCR_ISOLATE);\n+ \t\t}\n+ \t\t/* use mii_ethtool_sset to setup PHY */\n+ \t\tlp->mii_if.phy_id = i;\n+ \t\tecmd.phy_address = i;\n+\t\tif (lp->options & PCNET32_PORT_ASEL) {\n+\t\t    mii_ethtool_gset(&lp->mii_if, &ecmd);\n+\t\t    ecmd.autoneg = AUTONEG_ENABLE;\n+\t\t}\n+ \t\tmii_ethtool_sset(&lp->mii_if, &ecmd);\n+ \t    }\n+ \t}\n+ \tlp->mii_if.phy_id = first_phy;\n+\tif (netif_msg_link(lp))\n+\t    printk(KERN_INFO \"%s: Using PHY number %d.\\n\", dev->name, first_phy);\n     }\n \n #ifdef DO_DXSUFLO\n@@ -1680,11 +1776,9 @@ pcnet32_open(struct net_device *dev)\n \n     netif_start_queue(dev);\n \n-    /* If we have mii, print the link status and start the watchdog */\n-    if (lp->mii) {\n-\tmii_check_media (&lp->mii_if, netif_msg_link(lp), 1);\n-\tmod_timer (&(lp->watchdog_timer), PCNET32_WATCHDOG_TIMEOUT);\n-    }\n+    /* Print the link status and start the watchdog */\n+    pcnet32_check_media (dev, 1);\n+    mod_timer (&(lp->watchdog_timer), PCNET32_WATCHDOG_TIMEOUT);\n \n     i = 0;\n     while (i++ < 100)\n@@ -2430,17 +2524,111 @@ static int pcnet32_ioctl(struct net_devi\n     return rc;\n }\n \n+static int pcnet32_check_otherphy(struct net_device *dev)\n+{\n+    struct pcnet32_private *lp = dev->priv;\n+    struct mii_if_info mii = lp->mii_if;\n+    u16 bmcr;\n+    int i;\n+\n+    for (i = 0; i < PCNET32_MAX_PHYS; i++) {\n+\tif (i == lp->mii_if.phy_id)\n+\t    continue; /* skip active phy */\n+\tif (lp->phymask & (1 << i)) {\n+\t    mii.phy_id = i;\n+\t    if (mii_link_ok(&mii)) {\n+\t\t/* found PHY with active link */\n+\t\tif (netif_msg_link(lp))\n+\t\t    printk(KERN_INFO \"%s: Using PHY number %d.\\n\", dev->name, i);\n+\n+\t\t/* isolate inactive phy */\n+\t\tbmcr = mdio_read(dev, lp->mii_if.phy_id, MII_BMCR);\n+\t\tmdio_write(dev, lp->mii_if.phy_id, MII_BMCR, bmcr | BMCR_ISOLATE);\n+\n+\t\t/* de-isolate new phy */\n+\t\tbmcr = mdio_read(dev, i, MII_BMCR);\n+\t\tmdio_write(dev, i, MII_BMCR, bmcr & ~BMCR_ISOLATE);\n+\n+\t\t/* set new phy address */\n+\t\tlp->mii_if.phy_id = i;\n+\t\treturn 1;\n+\t    }\n+\t}\n+    }\n+    return 0;\n+}\n+\n+/*\n+ * Show the status of the media.  Similar to mii_check_media however it\n+ * correctly shows the link speed for all (tested) pcnet32 variants.\n+ * Devices with no mii just report link state without speed.\n+ *\n+ * Caller is assumed to hold and release the lp->lock.\n+ */\n+\n+static void pcnet32_check_media(struct net_device *dev, int verbose)\n+{\n+    struct pcnet32_private *lp = dev->priv;\n+    int curr_link;\n+    int prev_link = netif_carrier_ok(dev) ? 1 : 0;\n+    u32 bcr9;\n+\n+    if (lp->mii) {\n+\tcurr_link = mii_link_ok(&lp->mii_if);\n+    } else {\n+\tulong ioaddr = dev->base_addr;\t/* card base I/O address */\n+\tcurr_link = (lp->a.read_bcr(ioaddr, 4) != 0xc0);\n+    }\n+    if (!curr_link) {\n+\tif (prev_link || verbose) {\n+\t    netif_carrier_off(dev);\n+\t    if (netif_msg_link(lp))\n+\t\tprintk(KERN_INFO \"%s: link down\\n\", dev->name);\n+\t}\n+\tif (lp->phycount > 1) {\n+\t    curr_link = pcnet32_check_otherphy(dev);\n+\t    prev_link = 0;\n+\t}\n+    } else if (verbose || !prev_link) {\n+\tnetif_carrier_on(dev);\n+\tif (lp->mii) {\n+\t    if (netif_msg_link(lp)) {\n+\t\tstruct ethtool_cmd ecmd;\n+\t\tmii_ethtool_gset(&lp->mii_if, &ecmd);\n+\t\tprintk(KERN_INFO \"%s: link up, %sMbps, %s-duplex\\n\",\n+\t\t    dev->name,\n+\t\t    (ecmd.speed == SPEED_100) ? \"100\" : \"10\",\n+\t\t    (ecmd.duplex == DUPLEX_FULL) ? \"full\" : \"half\");\n+\t    }\n+\t    bcr9 = lp->a.read_bcr(dev->base_addr, 9);\n+\t    if ((bcr9 & (1 << 0)) != lp->mii_if.full_duplex)   {\n+\t\tif (lp->mii_if.full_duplex)\n+\t\t    bcr9 |= (1 << 0);\n+\t\telse\n+\t\t    bcr9 &= ~(1 << 0);\n+\t\tlp->a.write_bcr(dev->base_addr, 9, bcr9);\n+\t    }\n+\t} else {\n+\t    if (netif_msg_link(lp))\n+\t\tprintk(KERN_INFO \"%s: link up\\n\", dev->name);\n+\t}\n+    }\n+}\n+\n+/*\n+ * Check for loss of link and link establishment.\n+ * Can not use mii_check_media because it does nothing if mode is forced.\n+ */\n+\n static void pcnet32_watchdog(struct net_device *dev)\n {\n     struct pcnet32_private *lp = dev->priv;\n     unsigned long flags;\n \n     /* Print the link status if it has changed */\n-    if (lp->mii) {\n-\tspin_lock_irqsave(&lp->lock, flags);\n-\tmii_check_media (&lp->mii_if, netif_msg_link(lp), 0);\n-\tspin_unlock_irqrestore(&lp->lock, flags);\n-    }\n+    spin_lock_irqsave(&lp->lock, flags);\n+    pcnet32_check_media(dev, 0);\n+    spin_unlock_irqrestore(&lp->lock, flags);\n \n     mod_timer (&(lp->watchdog_timer), PCNET32_WATCHDOG_TIMEOUT);\n }\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Network", "Hardware": "i386 Linux", "Importance": "P2 high", "Assignee": "Don Fry", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2005-02-16 08:34 UTC by Dmitry Sanarin", "Modified": "2006-06-19 08:30 UTC", "CC List": "1 user", "See Also": "", "Kernel Version": "2.6.16", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/net/pcnet32.c"], "methods": ["pcnet32_get_regs", "pcnet32_get_regs_len", "pcnet32_probe1", "pcnet32_open", "pcnet32_watchdog", "pcnet32_private"]}
{"id": "3518", "title": "disable event LID blocks SLPB and vice versa on wakeup from S3", "description": "Distribution: Slackware 10\nHardware Environment: Notebook Aristo 2500, CPU Celeron 2.40Ghz\nProblem Description:\n\nWhen i go into S3 mode (echo mem >/sys/power/state), i can wakeup\nby pressing SLPB (Fn+ESC on my laptop) or opening LID.\nWhen i do that on a working system, kernel sends events\n\"button/sleep SLPB 00000080 00000000x\" when i'm pressing Fn+ESC\nand \"button/lid LID 000000080 00000000x\" when i'm openning or\nclosing LID.\nBut, when i disable LID (echo LID >/proc/acpi/wakeup) *or*\nSLPB (echo SLPB >/proc/acpi/wakeup), i do cat /proc/acpi/wakeup\nand i see that LID or SLPB is disabled, i can't go back\nfrom S3 state.\n\nSteps to reproduce:\necho LID >/proc/acpi/wakeup or echo SLPB >/proc/acpi/wakeup\nand echo mem >/sys/power/state", "patch": ["--- 2.6/drivers/acpi/sleep/proc.c.orig\t2004-11-11 12:50:00.006278280 +0800\n+++ 2.6/drivers/acpi/sleep/proc.c\t2004-11-11 13:39:41.162073712 +0800\n@@ -395,6 +395,7 @@ acpi_system_write_wakeup_device (\n \tchar\t\tstrbuf[5];\n \tchar\t\tstr[5] = \"\";\n \tint \t\tlen = count;\n+\tstruct acpi_device *found_dev = NULL;\n \n \tif (len > 4) len = 4;\n \n@@ -411,9 +412,25 @@ acpi_system_write_wakeup_device (\n \n \t\tif (!strncmp(dev->pnp.bus_id, str, 4)) {\n \t\t\tdev->wakeup.state.enabled = dev->wakeup.state.enabled ? 0:1;\n+\t\t\tfound_dev = dev;\n \t\t\tbreak;\n \t\t}\n \t}\n+\tif (found_dev) {\n+\t\tlist_for_each_safe(node, next, &acpi_wakeup_device_list) {\n+\t\t\tstruct acpi_device * dev = container_of(node,\n+\t\t\t\tstruct acpi_device, wakeup_list);\n+\n+\t\t\tif ((dev != found_dev) &&\n+\t\t\t\t(dev->wakeup.gpe_number == found_dev->wakeup.gpe_number) &&\n+\t\t\t\t(dev->wakeup.gpe_device == found_dev->wakeup.gpe_device)) {\n+\t\t\t\tprintk(\"Warnning: (%s, %s) have the same GPE, \"\n+\t\t\t\t\t\"can't disable/enable one seperately\\n\",\n+\t\t\t\t\tdev->pnp.bus_id, found_dev->pnp.bus_id);\n+\t\t\t\tdev->wakeup.state.enabled = found_dev->wakeup.state.enabled;\n+\t\t\t}\n+\t\t}\n+\t}\n \tspin_unlock(&acpi_device_lock);\n \treturn count;\n }\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "Power-Sleep-Wake", "Hardware": "i386 Linux", "Importance": "P2 blocking", "Assignee": "Shaohua", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2004-10-07 06:39 UTC by Pawel Maziarz", "Modified": "2005-01-26 23:08 UTC", "CC List": "1 user", "See Also": "", "Kernel Version": "2.6.9", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/acpi/sleep/proc.c"], "methods": ["acpi_system_write_wakeup_device"]}
{"id": "3108", "title": "/proc/bus/usb/devices stall", "description": "Problem Description: \nWe have a setup where we use libusb to control 32 units throughout a test \nprocess.  Basically we detect when a board is plugged in and fork a process for \nit.  Starting with 2.6.7, we have been having hang problems where the fork \noccurs and then the process goes into disk wait.  Once the test completes on \nthe units already running, then the processes in disk wait will continue.  I'm \nbetting it has to do with some of the serialize changes that went into 2.6.7. \n \nSteps to reproduce: \nTransfer data over several devices and then try to cat /proc/bus/usb/devices.", "patch": ["Index: local_tree/drivers/usb/core/devio.c\n===================================================================\n--- local_tree.orig/drivers/usb/core/devio.c\t2004-07-25 14:34:32.000000000 +0200\n+++ local_tree/drivers/usb/core/devio.c\t2004-07-26 13:17:32.566904895 +0200\n@@ -71,6 +71,7 @@\n \t\t\tdev_info( dev , format , ## arg);\t\\\n \t} while (0)\n \n+#define MAX_BUFFER_LENGTH\t16384\n \n static inline int connected (struct usb_device *dev)\n {\n@@ -530,225 +531,378 @@\n         return 0;\n }\n \n+static void wakeup_completion(struct urb *urb, struct pt_regs *regs)\n+{\n+\tcomplete((struct completion *)urb->context);\n+}\n+\n+static void timeout_kill(unsigned long data)\n+{\n+\tstruct urb *urb = (struct urb *) data;\n+\tusb_unlink_urb(urb);\n+}\n+\n+static int start_wait_urb(struct usb_device *dev, struct urb *urb, int timeout, int* actual_length)\n+{\n+\tstruct completion done;\n+\tstruct timer_list timer;\n+\tint status;\n+\n+\tinit_completion(&done);\n+\turb->context = &done;\n+\turb->complete = wakeup_completion;\n+\turb->transfer_flags |= URB_ASYNC_UNLINK;\n+\turb->actual_length = 0;\n+\tstatus = usb_submit_urb(urb, GFP_NOIO);\n+\n+\tif (status == 0) {\n+\t\tif (timeout > 0) {\n+\t\t\tinit_timer(&timer);\n+\t\t\ttimer.expires = jiffies + timeout;\n+\t\t\ttimer.data = (unsigned long)urb;\n+\t\t\ttimer.function = timeout_kill;\n+\t\t\t/* grr.  timeout _should_ include submit delays. */\n+\t\t\tadd_timer(&timer);\n+\t\t}\n+\t\tup(&dev->serialize);\n+\t\twait_for_completion(&done);\n+\t\tdown(&dev->serialize);\n+\t\tstatus = urb->status;\n+\t\t/* note:  HCDs return ETIMEDOUT for other reasons too */\n+\t\tif (status == -ECONNRESET)\n+\t\t\tstatus = -ETIMEDOUT;\n+\t\tif (timeout > 0)\n+\t\t\tdel_timer_sync(&timer);\n+\t}\n+\n+\tif (actual_length)\n+\t\t*actual_length = urb->actual_length;\n+\treturn status;\n+}\n+\n static int proc_control(struct dev_state *ps, void __user *arg)\n {\n-\tstruct usb_device *dev = ps->dev;\n \tstruct usbdevfs_ctrltransfer ctrl;\n-\tunsigned int tmo;\n-\tunsigned char *tbuf;\n-\tint i, j, ret;\n+\tstruct usb_device *dev = ps->dev;\n+\tstruct usb_ctrlrequest *dr = NULL;\n+\tunsigned char *tbuf = NULL;\n+\tstruct urb *urb = NULL;\n+\tint dir_in, j, length, ret;\n+\tunsigned int pipe, timeout;\n \n \tif (copy_from_user(&ctrl, arg, sizeof(ctrl)))\n \t\treturn -EFAULT;\n-\tif ((ret = check_ctrlrecip(ps, ctrl.bRequestType, ctrl.wIndex)))\n-\t\treturn ret;\n-\tif (ctrl.wLength > PAGE_SIZE)\n+\tlength = ctrl.wLength;\n+\tif (length < 0 || length > PAGE_SIZE)\n \t\treturn -EINVAL;\n \tif (!(tbuf = (unsigned char *)__get_free_page(GFP_KERNEL)))\n \t\treturn -ENOMEM;\n-\ttmo = (ctrl.timeout * HZ + 999) / 1000;\n-\tif (ctrl.bRequestType & 0x80) {\n-\t\tif (ctrl.wLength && !access_ok(VERIFY_WRITE, ctrl.data, ctrl.wLength)) {\n-\t\t\tfree_page((unsigned long)tbuf);\n-\t\t\treturn -EINVAL;\n-\t\t}\n-\t\tsnoop(&dev->dev, \"control read: bRequest=%02x bRrequestType=%02x wValue=%04x wIndex=%04x\\n\", \n-\t\t\tctrl.bRequest, ctrl.bRequestType, ctrl.wValue, ctrl.wIndex);\n-\n-\t\ti = usb_control_msg(dev, usb_rcvctrlpipe(dev, 0), ctrl.bRequest, ctrl.bRequestType,\n-\t\t\t\t       ctrl.wValue, ctrl.wIndex, tbuf, ctrl.wLength, tmo);\n-\t\tif ((i > 0) && ctrl.wLength) {\n-\t\t\tif (usbfs_snoop) {\n-\t\t\t\tdev_info(&dev->dev, \"control read: data \");\n-\t\t\t\tfor (j = 0; j < ctrl.wLength; ++j)\n-\t\t\t\t\tprintk (\"%02x \", (unsigned char)(tbuf)[j]);\n-\t\t\t\tprintk(\"\\n\");\n-\t\t\t}\n-\t\t\tif (copy_to_user(ctrl.data, tbuf, ctrl.wLength)) {\n-\t\t\t\tfree_page((unsigned long)tbuf);\n-\t\t\t\treturn -EFAULT;\n-\t\t\t}\n+\tdir_in = ctrl.bRequestType & USB_DIR_IN;\n+\tif (dir_in) {\n+\t\tif (length && !access_ok(VERIFY_WRITE, ctrl.data, length)) {\n+\t\t\tret = -EINVAL;\n+\t\t\tgoto out_free;\n \t\t}\n \t} else {\n-\t\tif (ctrl.wLength) {\n-\t\t\tif (copy_from_user(tbuf, ctrl.data, ctrl.wLength)) {\n-\t\t\t\tfree_page((unsigned long)tbuf);\n-\t\t\t\treturn -EFAULT;\n+\t\tif (length) {\n+\t\t\tif (copy_from_user(tbuf, ctrl.data, length)) {\n+\t\t\t\tret = -EFAULT;\n+\t\t\t\tgoto out_free;\n \t\t\t}\n \t\t}\n-\t\tsnoop(&dev->dev, \"control write: bRequest=%02x bRrequestType=%02x wValue=%04x wIndex=%04x\\n\", \n-\t\t\tctrl.bRequest, ctrl.bRequestType, ctrl.wValue, ctrl.wIndex);\n+\t}\n+\tsnoop(&dev->dev, \"control %s: bRequest=%02x bRrequestType=%02x wValue=%04x wIndex=%04x wLength=%04x\\n\",\n+\t\tdir_in ? \"read\" : \"write\", ctrl.bRequest, ctrl.bRequestType, ctrl.wValue, ctrl.wIndex, ctrl.wLength);\n+\tif (usbfs_snoop && !dir_in) {\n+\t\tdev_info(&dev->dev, \"control write: data: \");\n+\t\tfor (j = 0; j < length; ++j)\n+\t\t\tprintk (\"%02x \", tbuf[j]);\n+\t\tprintk(\"\\n\");\n+\t}\n+\tif (!(urb = usb_alloc_urb(0, GFP_KERNEL))) {\n+\t\tret = -ENOMEM;\n+\t\tgoto out_free;\n+\t}\n+\tif (!(dr = kmalloc(sizeof(struct usb_ctrlrequest), GFP_KERNEL))) {\n+\t\tret = -ENOMEM;\n+\t\tgoto out_free;\n+\t}\n+\tdown(&dev->serialize);\n+\tif (!connected(dev)) {\n+\t\tret = -ENODEV;\n+\t\tgoto out_release;\n+\t}\n+\tif ((ret = check_ctrlrecip(ps, ctrl.bRequestType, ctrl.wIndex)))\n+\t\tgoto out_release;\n+\tif (dir_in)\n+\t\tpipe = usb_rcvctrlpipe(dev, 0);\n+\telse\n+\t\tpipe = usb_sndctrlpipe(dev, 0);\n+\ttimeout = (ctrl.timeout * HZ + 999) / 1000;\n+\tdr->bRequestType= ctrl.bRequestType;\n+\tdr->bRequest = ctrl.bRequest;\n+\tdr->wValue = cpu_to_le16p(&ctrl.wValue);\n+\tdr->wIndex = cpu_to_le16p(&ctrl.wIndex);\n+\tdr->wLength = cpu_to_le16p(&ctrl.wLength);\n+\tusb_fill_control_urb(urb, dev, pipe, (unsigned char*)dr, tbuf, length, NULL, 0);\n+\tret = start_wait_urb(dev, urb, timeout, &length);\n+\tup(&dev->serialize);\n+\tif (ret < 0) {\n+\t\tdev_warn(&dev->dev, \"usbfs: USBDEVFS_CONTROL failed \"\n+\t\t\t\"cmd %s rqt %u rq %u len %u ret %d\\n\",\n+\t\t\tcurrent->comm, ctrl.bRequestType, ctrl.bRequest,\n+\t\t\tctrl.wLength, ret);\n+\t\tgoto out_free;\n+\t}\n+\tif (dir_in && length) {\n \t\tif (usbfs_snoop) {\n-\t\t\tdev_info(&dev->dev, \"control write: data: \");\n-\t\t\tfor (j = 0; j < ctrl.wLength; ++j)\n-\t\t\t\tprintk (\"%02x \", (unsigned char)(tbuf)[j]);\n+\t\t\tdev_info(&dev->dev, \"control read: data \");\n+\t\t\tfor (j = 0; j < length; ++j)\n+\t\t\t\tprintk (\"%02x \", tbuf[j]);\n \t\t\tprintk(\"\\n\");\n \t\t}\n-\t\ti = usb_control_msg(dev, usb_sndctrlpipe(dev, 0), ctrl.bRequest, ctrl.bRequestType,\n-\t\t\t\t       ctrl.wValue, ctrl.wIndex, tbuf, ctrl.wLength, tmo);\n+\t\tif (copy_to_user(ctrl.data, tbuf, length)) {\n+\t\t\tret = -EFAULT;\n+\t\t\tgoto out_free;\n+\t\t}\n \t}\n+\tkfree(dr);\n+\tusb_free_urb(urb);\n \tfree_page((unsigned long)tbuf);\n-\tif (i<0) {\n-\t\tdev_printk(KERN_DEBUG, &dev->dev, \"usbfs: USBDEVFS_CONTROL \"\n-\t\t\t   \"failed cmd %s rqt %u rq %u len %u ret %d\\n\",\n-\t\t\t   current->comm, ctrl.bRequestType, ctrl.bRequest,\n-\t\t\t   ctrl.wLength, i);\n-\t}\n-\treturn i;\n+\treturn ret;\n+out_release:\n+\tup(&dev->serialize);\n+out_free:\n+\tkfree(dr);\n+\tusb_free_urb(urb);\n+\tfree_page((unsigned long)tbuf);\n+\treturn ret;\n }\n \n static int proc_bulk(struct dev_state *ps, void __user *arg)\n {\n-\tstruct usb_device *dev = ps->dev;\n \tstruct usbdevfs_bulktransfer bulk;\n-\tunsigned int tmo, len1, pipe;\n-\tint len2;\n-\tunsigned char *tbuf;\n-\tint i, ret;\n+\tstruct usb_device *dev = ps->dev;\n+\tunsigned char *tbuf = NULL;\n+\tstruct urb *urb = NULL;\n+\tint dir_in, length, ret;\n+\tunsigned int pipe, timeout;\n \n \tif (copy_from_user(&bulk, arg, sizeof(bulk)))\n \t\treturn -EFAULT;\n-\tif ((ret = findintfep(ps->dev, bulk.ep)) < 0)\n-\t\treturn ret;\n-\tif ((ret = checkintf(ps, ret)))\n-\t\treturn ret;\n-\tif (bulk.ep & USB_DIR_IN)\n-\t\tpipe = usb_rcvbulkpipe(dev, bulk.ep & 0x7f);\n-\telse\n-\t\tpipe = usb_sndbulkpipe(dev, bulk.ep & 0x7f);\n-\tif (!usb_maxpacket(dev, pipe, !(bulk.ep & USB_DIR_IN)))\n+\tlength = bulk.len;\n+\tif (length < 0 || length > MAX_BUFFER_LENGTH)\n \t\treturn -EINVAL;\n-\tlen1 = bulk.len;\n-\tif (!(tbuf = kmalloc(len1, GFP_KERNEL)))\n+\tif (!(tbuf = kmalloc(length, GFP_KERNEL)))\n \t\treturn -ENOMEM;\n-\ttmo = (bulk.timeout * HZ + 999) / 1000;\n-\tif (bulk.ep & 0x80) {\n-\t\tif (len1 && !access_ok(VERIFY_WRITE, bulk.data, len1)) {\n-\t\t\tkfree(tbuf);\n-\t\t\treturn -EINVAL;\n-\t\t}\n-\t\ti = usb_bulk_msg(dev, pipe, tbuf, len1, &len2, tmo);\n-\t\tif (!i && len2) {\n-\t\t\tif (copy_to_user(bulk.data, tbuf, len2)) {\n-\t\t\t\tkfree(tbuf);\n-\t\t\t\treturn -EFAULT;\n-\t\t\t}\n+\tdir_in = bulk.ep & USB_DIR_IN;\n+\tif (dir_in) {\n+\t\tif (length && !access_ok(VERIFY_WRITE, bulk.data, length)) {\n+\t\t\tret = -EINVAL;\n+\t\t\tgoto out_free;\n \t\t}\n \t} else {\n-\t\tif (len1) {\n-\t\t\tif (copy_from_user(tbuf, bulk.data, len1)) {\n-\t\t\t\tkfree(tbuf);\n-\t\t\t\treturn -EFAULT;\n+\t\tif (length) {\n+\t\t\tif (copy_from_user(tbuf, bulk.data, length)) {\n+\t\t\t\tret = -EFAULT;\n+\t\t\t\tgoto out_free;\n \t\t\t}\n \t\t}\n-\t\ti = usb_bulk_msg(dev, pipe, tbuf, len1, &len2, tmo);\n \t}\n-\tkfree(tbuf);\n-\tif (i < 0) {\n+\tif (!(urb = usb_alloc_urb(0, GFP_KERNEL))) {\n+\t\tret = -ENOMEM;\n+\t\tgoto out_free;\n+\t}\n+\tdown(&dev->serialize);\n+\tif (!connected(dev)) {\n+\t\tret = -ENODEV;\n+\t\tgoto out_release;\n+\t}\n+\tif ((ret = findintfep(ps->dev, bulk.ep)) < 0)\n+\t\tgoto out_release;\n+\tif ((ret = checkintf(ps, ret)))\n+\t\tgoto out_release;\n+\tif (dir_in)\n+\t\tpipe = usb_rcvbulkpipe(dev, bulk.ep & 0x7f);\n+\telse\n+\t\tpipe = usb_sndbulkpipe(dev, bulk.ep & 0x7f);\n+\tif (!usb_maxpacket(dev, pipe, !dir_in)) {\n+\t\tret = -EINVAL;\n+\t\tgoto out_release;\n+\t}\n+\ttimeout = (bulk.timeout * HZ + 999) / 1000;\n+\tusb_fill_bulk_urb(urb, dev, pipe, tbuf, length, NULL, NULL);\n+\tret = start_wait_urb(dev, urb, timeout, &length);\n+\tup(&dev->serialize);\n+\tif (ret < 0) {\n \t\tdev_warn(&dev->dev, \"usbfs: USBDEVFS_BULK failed \"\n-\t\t\t \"ep 0x%x len %u ret %d\\n\", bulk.ep, bulk.len, i);\n-\t\treturn i;\n+\t\t\t\"ep 0x%x len %u ret %d\\n\", bulk.ep, bulk.len, ret);\n+\t\tgoto out_free;\n \t}\n-\treturn len2;\n+\tif (dir_in && length) {\n+\t\tif (copy_to_user(bulk.data, tbuf, length)) {\n+\t\t\tret = -EFAULT;\n+\t\t\tgoto out_free;\n+\t\t}\n+\t}\n+\tusb_free_urb(urb);\n+\tkfree(tbuf);\n+\treturn length;\n+out_release:\n+\tup(&dev->serialize);\n+out_free:\n+\tusb_free_urb(urb);\n+\tkfree(tbuf);\n+\treturn ret;\n }\n \n static int proc_resetep(struct dev_state *ps, void __user *arg)\n {\n+\tstruct usb_device *dev = ps->dev;\n \tunsigned int ep;\n \tint ret;\n \n \tif (get_user(ep, (unsigned int __user *)arg))\n \t\treturn -EFAULT;\n+\tdown(&dev->serialize);\n+\tif (!connected(dev)) {\n+\t\tret = -ENODEV;\n+\t\tgoto out;\n+\t}\n \tif ((ret = findintfep(ps->dev, ep)) < 0)\n-\t\treturn ret;\n+\t\tgoto out;\n \tif ((ret = checkintf(ps, ret)))\n-\t\treturn ret;\n+\t\tgoto out;\n \tusb_settoggle(ps->dev, ep & 0xf, !(ep & USB_DIR_IN), 0);\n-\treturn 0;\n+out:\n+\tup(&dev->serialize);\n+\treturn ret;\n }\n \n static int proc_clearhalt(struct dev_state *ps, void __user *arg)\n {\n+\tstruct usb_device *dev = ps->dev;\n \tunsigned int ep;\n \tint pipe;\n \tint ret;\n \n \tif (get_user(ep, (unsigned int __user *)arg))\n \t\treturn -EFAULT;\n-\tif ((ret = findintfep(ps->dev, ep)) < 0)\n-\t\treturn ret;\n+\tdown(&dev->serialize);\n+\tif (!connected(dev)) {\n+\t\tret = -ENODEV;\n+\t\tgoto out;\n+\t}\n+\tif ((ret = findintfep(dev, ep)) < 0)\n+\t\tgoto out;\n \tif ((ret = checkintf(ps, ret)))\n-\t\treturn ret;\n+\t\tgoto out;\n \tif (ep & USB_DIR_IN)\n-                pipe = usb_rcvbulkpipe(ps->dev, ep & 0x7f);\n+                pipe = usb_rcvbulkpipe(dev, ep & 0x7f);\n         else\n-                pipe = usb_sndbulkpipe(ps->dev, ep & 0x7f);\n+                pipe = usb_sndbulkpipe(dev, ep & 0x7f);\n \n-\treturn usb_clear_halt(ps->dev, pipe);\n+\tret = usb_clear_halt(dev, pipe);\n+out:\n+\tup(&dev->serialize);\n+\treturn ret;\n }\n \t\t\n \n static int proc_getdriver(struct dev_state *ps, void __user *arg)\n {\n \tstruct usbdevfs_getdriver gd;\n+\tstruct usb_device *dev = ps->dev;\n \tstruct usb_interface *intf;\n-\tint ret;\n+\tint ret = 0;\n \n \tif (copy_from_user(&gd, arg, sizeof(gd)))\n \t\treturn -EFAULT;\n+\tdown(&dev->serialize);\n+\tif (!connected(dev)) {\n+\t\tup(&dev->serialize);\n+\t\treturn -ENODEV;\n+\t}\n \tdown_read(&usb_bus_type.subsys.rwsem);\n-\tintf = usb_ifnum_to_if(ps->dev, gd.interface);\n+\tintf = usb_ifnum_to_if(dev, gd.interface);\n \tif (!intf || !intf->dev.driver)\n \t\tret = -ENODATA;\n-\telse {\n-\t\tstrncpy(gd.driver, intf->dev.driver->name,\n-\t\t\t\tsizeof(gd.driver));\n-\t\tret = (copy_to_user(arg, &gd, sizeof(gd)) ? -EFAULT : 0);\n-\t}\n+\telse\n+\t\tstrncpy(gd.driver, intf->dev.driver->name, sizeof(gd.driver));\n \tup_read(&usb_bus_type.subsys.rwsem);\n+\tup(&dev->serialize);\n+\tif (!ret)\n+\t\tret = (copy_to_user(arg, &gd, sizeof(gd)) ? -EFAULT : 0);\n \treturn ret;\n }\n \n static int proc_connectinfo(struct dev_state *ps, void __user *arg)\n {\n \tstruct usbdevfs_connectinfo ci;\n+\tstruct usb_device *dev = ps->dev;\n \n-\tci.devnum = ps->dev->devnum;\n-\tci.slow = ps->dev->speed == USB_SPEED_LOW;\n-\tif (copy_to_user(arg, &ci, sizeof(ci)))\n-\t\treturn -EFAULT;\n-\treturn 0;\n+\tdown(&dev->serialize);\n+\tif (!connected(dev)) {\n+\t\tup(&dev->serialize);\n+\t\treturn -ENODEV;\n+\t}\n+\tci.devnum = dev->devnum;\n+\tci.slow = dev->speed == USB_SPEED_LOW;\n+\tup(&dev->serialize);\n+\treturn copy_to_user(arg, &ci, sizeof(ci)) ? -EFAULT : 0;\n }\n \n static int proc_resetdevice(struct dev_state *ps)\n {\n-\treturn __usb_reset_device(ps->dev);\n+\tstruct usb_device *dev = ps->dev;\n+\tint ret;\n \n+\tdown(&dev->serialize);\n+\tif (!connected(dev))\n+\t\tret = -ENODEV;\n+\telse\n+\t\tret = usb_reset_device(dev);\n+\tup(&dev->serialize);\n+\treturn ret;\n }\n \n static int proc_setintf(struct dev_state *ps, void __user *arg)\n {\n \tstruct usbdevfs_setinterface setintf;\n+\tstruct usb_device *dev = ps->dev;\n \tint ret;\n \n \tif (copy_from_user(&setintf, arg, sizeof(setintf)))\n \t\treturn -EFAULT;\n+\tdown(&dev->serialize);\n+\tif (!connected(dev)) {\n+\t\tret = -ENODEV;\n+\t\tgoto out;\n+\t}\n \tif ((ret = checkintf(ps, setintf.interface)))\n-\t\treturn ret;\n-\treturn usb_set_interface(ps->dev, setintf.interface,\n-\t\t\tsetintf.altsetting);\n+\t\tgoto out;\n+\tret = usb_set_interface(dev, setintf.interface, setintf.altsetting);\n+out:\n+\tup(&dev->serialize);\n+\treturn ret;\n }\n \n static int proc_setconfig(struct dev_state *ps, void __user *arg)\n {\n-\tunsigned int u;\n-\tint status = 0;\n  \tstruct usb_host_config *actconfig;\n+\tstruct usb_device *dev = ps->dev;\n+\tint ret;\n+\tunsigned int u;\n \n \tif (get_user(u, (unsigned int __user *)arg))\n \t\treturn -EFAULT;\n \n- \tactconfig = ps->dev->actconfig;\n+\tdown(&dev->serialize);\n+\tif (!connected(dev)) {\n+\t\tret = -ENODEV;\n+\t\tgoto out;\n+\t}\n+ \tactconfig = dev->actconfig;\n  \n  \t/* Don't touch the device if any interfaces are claimed.\n  \t * It could interfere with other drivers' operations, and if\n@@ -759,7 +913,7 @@\n  \n  \t\tfor (i = 0; i < actconfig->desc.bNumInterfaces; ++i) {\n  \t\t\tif (usb_interface_claimed(actconfig->interface[i])) {\n-\t\t\t\tdev_warn (&ps->dev->dev,\n+\t\t\t\tdev_warn (&dev->dev,\n \t\t\t\t\t\"usbfs: interface %d claimed \"\n \t\t\t\t\t\"while '%s' sets config #%d\\n\",\n \t\t\t\t\tactconfig->interface[i]\n@@ -767,8 +921,8 @@\n \t\t\t\t\t\t->desc.bInterfaceNumber,\n \t\t\t\t\tcurrent->comm, u);\n #if 0\t/* FIXME:  enable in 2.6.10 or so */\n- \t\t\t\tstatus = -EBUSY;\n-\t\t\t\tbreak;\n+ \t\t\t\tret = -EBUSY;\n+\t\t\t\tgoto out;\n #endif\n \t\t\t}\n  \t\t}\n@@ -777,14 +931,14 @@\n \t/* SET_CONFIGURATION is often abused as a \"cheap\" driver reset,\n \t * so avoid usb_set_configuration()'s kick to sysfs\n \t */\n-\tif (status == 0) {\n-\t\tif (actconfig && actconfig->desc.bConfigurationValue == u)\n-\t\t\tstatus = usb_reset_configuration(ps->dev);\n-\t\telse\n-\t\t\tstatus = usb_set_configuration(ps->dev, u);\n-\t}\n+\tif (actconfig && actconfig->desc.bConfigurationValue == u)\n+\t\tret = usb_reset_configuration(dev);\n+\telse\n+\t\tret = usb_set_configuration(dev, u);\n \n-\treturn status;\n+out:\n+\tup(&dev->serialize);\n+\treturn ret;\n }\n \n static int proc_submiturb(struct dev_state *ps, void __user *arg)\n@@ -960,12 +1114,21 @@\n static int proc_unlinkurb(struct dev_state *ps, void __user *arg)\n {\n \tstruct async *as;\n+\tstruct usb_device *dev = ps->dev;\n+\tint ret = 0;\n \n-\tas = async_getpending(ps, arg);\n-\tif (!as)\n-\t\treturn -EINVAL;\n-\tusb_unlink_urb(as->urb);\n-\treturn 0;\n+\tdown(&dev->serialize);\n+\tif (!connected(dev)) {\n+\t\tret = -ENODEV;\n+\t\tgoto out;\n+\t}\n+\tif ((as = async_getpending(ps, arg)))\n+\t\tusb_unlink_urb(as->urb);\n+\telse\n+\t\tret = -EINVAL;\n+out:\n+\tup(&dev->serialize);\n+\treturn ret;\n }\n \n static int processcompl(struct async *as)\n@@ -1005,6 +1168,11 @@\n \tstruct usb_device *dev = ps->dev;\n \tint ret;\n \n+\tdown(&dev->serialize);\n+\tif (!connected(dev)) {\n+\t\tret = -ENODEV;\n+\t\tgoto fail;\n+\t}\n \tadd_wait_queue(&ps->wait, &wait);\n \twhile (connected(dev)) {\n \t\t__set_current_state(TASK_INTERRUPTIBLE);\n@@ -1018,37 +1186,48 @@\n \t}\n \tremove_wait_queue(&ps->wait, &wait);\n \tset_current_state(TASK_RUNNING);\n-\tif (as) {\n-\t\tret = processcompl(as);\n-\t\taddr = as->userurb;\n-\t\tfree_async(as);\n-\t\tif (ret)\n-\t\t\treturn ret;\n-\t\tif (put_user(addr, (void __user * __user *)arg))\n-\t\t\treturn -EFAULT;\n-\t\treturn 0;\n+\tif (!as) {\n+\t\tret = signal_pending(current) ? -EINTR : -EIO;\n+\t\tgoto fail;\n \t}\n-\tif (signal_pending(current))\n-\t\treturn -EINTR;\n-\treturn -EIO;\n+\tret = processcompl(as);\n+\taddr = as->userurb;\n+\tfree_async(as);\n+\tif (ret)\n+\t\tgoto fail;\n+\tup(&dev->serialize);\n+\treturn put_user(addr, (void __user * __user *)arg) ? -EFAULT : 0;\n+fail:\n+\tup(&dev->serialize);\n+\treturn ret;\n }\n \n static int proc_reapurbnonblock(struct dev_state *ps, void __user *arg)\n {\n \tstruct async *as;\n \tvoid __user *addr;\n+\tstruct usb_device *dev = ps->dev;\n \tint ret;\n \n-\tif (!(as = async_getcompleted(ps)))\n-\t\treturn -EAGAIN;\n+\tdown(&dev->serialize);\n+\tif (!connected(dev)) {\n+\t\tret = -ENODEV;\n+\t\tgoto fail;\n+\t}\n+\tif (!(as = async_getcompleted(ps))) {\n+\t\tret = -EAGAIN;\n+\t\tgoto fail;\n+\t}\n \tret = processcompl(as);\n \taddr = as->userurb;\n \tfree_async(as);\n \tif (ret)\n-\t\treturn ret;\n-\tif (put_user(addr, (void __user * __user *)arg))\n-\t\treturn -EFAULT;\n-\treturn 0;\n+\t\tgoto fail;\n+\tup(&dev->serialize);\n+\treturn put_user(addr, (void __user * __user *)arg) ? -EFAULT : 0;\n+fail:\n+\tup(&dev->serialize);\n+\treturn ret;\n }\n \n static int proc_disconnectsignal(struct dev_state *ps, void __user *arg)\n@@ -1059,18 +1238,31 @@\n \t\treturn -EFAULT;\n \tif (ds.signr != 0 && (ds.signr < SIGRTMIN || ds.signr > SIGRTMAX))\n \t\treturn -EINVAL;\n+\tdown(&ps->dev->serialize);\n+\tif (!connected(ps->dev)) {\n+\t\tup(&ps->dev->serialize);\n+\t\treturn -ENODEV;\n+\t}\n \tps->discsignr = ds.signr;\n \tps->disccontext = ds.context;\n+\tup(&ps->dev->serialize);\n \treturn 0;\n }\n \n static int proc_claiminterface(struct dev_state *ps, void __user *arg)\n {\n \tunsigned int ifnum;\n+\tint ret;\n \n \tif (get_user(ifnum, (unsigned int __user *)arg))\n \t\treturn -EFAULT;\n-\treturn claimintf(ps, ifnum);\n+\tdown(&ps->dev->serialize);\n+\tif (!connected(ps->dev))\n+\t\tret = -ENODEV;\n+\telse\n+\t\tret = claimintf(ps, ifnum);\n+\tup(&ps->dev->serialize);\n+\treturn ret;\n }\n \n static int proc_releaseinterface(struct dev_state *ps, void __user *arg)\n@@ -1080,20 +1272,28 @@\n \n \tif (get_user(ifnum, (unsigned int __user *)arg))\n \t\treturn -EFAULT;\n-\tif ((ret = releaseintf(ps, ifnum)) < 0)\n-\t\treturn ret;\n+\tdown(&ps->dev->serialize);\n+\tif (!connected(ps->dev)) {\n+\t\tret = -ENODEV;\n+\t\tgoto out;\n+\t}\n+\tif ((ret = releaseintf(ps, ifnum)))\n+\t\tgoto out;\n \tdestroy_async_on_interface (ps, ifnum);\n-\treturn 0;\n+out:\n+\tup(&ps->dev->serialize);\n+\treturn ret;\n }\n \n static int proc_ioctl (struct dev_state *ps, void __user *arg)\n {\n \tstruct usbdevfs_ioctl\tctrl;\n-\tint\t\t\tsize;\n \tvoid\t\t\t*buf = NULL;\n-\tint\t\t\tretval = 0;\n-\tstruct usb_interface    *intf = NULL;\n-\tstruct usb_driver       *driver = NULL;\n+\tstruct usb_device\t*dev = ps->dev;\n+\tstruct usb_driver\t*driver = NULL;\n+\tstruct usb_interface\t*intf = NULL;\n+\tint\t\t\tret = 0;\n+\tint\t\t\tsize;\n \n \t/* get input parameters and alloc buffer */\n \tif (copy_from_user(&ctrl, arg, sizeof (ctrl)))\n@@ -1111,17 +1311,23 @@\n \t\t}\n \t}\n \n-\tif (!connected(ps->dev)) {\n-\t\tif (buf)\n-\t\t\tkfree(buf);\n-\t\treturn -ENODEV;\n+\tdown(&dev->serialize);\n+\tif (!connected(dev)) {\n+\t\tret = -ENODEV;\n+\t\tgoto out;\n+\t}\n+\n+\tif (dev->state != USB_STATE_CONFIGURED) {\n+\t\tret = -ENODEV;\n+\t\tgoto out;\n+\t}\n+\n+\tif (!(intf = usb_ifnum_to_if (dev, ctrl.ifno))) {\n+\t\tret = -EINVAL;\n+\t\tgoto out;\n \t}\n \n-\tif (ps->dev->state != USB_STATE_CONFIGURED)\n-\t\tretval = -ENODEV;\n-\telse if (!(intf = usb_ifnum_to_if (ps->dev, ctrl.ifno)))\n-               retval = -EINVAL;\n-\telse switch (ctrl.ioctl_code) {\n+\tswitch (ctrl.ioctl_code) {\n \n \t/* disconnect kernel driver from interface */\n \tcase USBDEVFS_DISCONNECT:\n@@ -1131,7 +1337,7 @@\n \t\t\tdev_dbg (&intf->dev, \"disconnect by usbfs\\n\");\n \t\t\tusb_driver_release_interface(driver, intf);\n \t\t} else\n-\t\t\tretval = -ENODATA;\n+\t\t\tret = -ENODATA;\n \t\tup_write(&usb_bus_type.subsys.rwsem);\n \t\tbreak;\n \n@@ -1146,24 +1352,26 @@\n \t\tif (intf->dev.driver)\n \t\t\tdriver = to_usb_driver(intf->dev.driver);\n \t\tif (driver == 0 || driver->ioctl == 0) {\n-\t\t\tretval = -ENOTTY;\n+\t\t\tret = -ENOTTY;\n \t\t} else {\n-\t\t\tretval = driver->ioctl (intf, ctrl.ioctl_code, buf);\n-\t\t\tif (retval == -ENOIOCTLCMD)\n-\t\t\t\tretval = -ENOTTY;\n+\t\t\tret = driver->ioctl (intf, ctrl.ioctl_code, buf);\n+\t\t\tif (ret == -ENOIOCTLCMD)\n+\t\t\t\tret = -ENOTTY;\n \t\t}\n \t\tup_read(&usb_bus_type.subsys.rwsem);\n \t}\n \n \t/* cleanup and return */\n-\tif (retval >= 0\n-\t\t\t&& (_IOC_DIR (ctrl.ioctl_code) & _IOC_READ) != 0\n-\t\t\t&& size > 0\n-\t\t\t&& copy_to_user (ctrl.data, buf, size) != 0)\n-\t\tretval = -EFAULT;\n-\tif (buf != 0)\n-\t\tkfree (buf);\n-\treturn retval;\n+\tif (ret < 0 || !(_IOC_DIR (ctrl.ioctl_code) & _IOC_READ) || size <= 0)\n+\t\tgoto out;\n+\n+\tkfree (buf);\n+\tup(&dev->serialize);\n+\treturn copy_to_user (ctrl.data, buf, size) ? -EFAULT : 0;\n+out:\n+\tkfree (buf);\n+\tup(&dev->serialize);\n+\treturn ret;\n }\n \n /*\n@@ -1180,11 +1388,6 @@\n \n \tif (!(file->f_mode & FMODE_WRITE))\n \t\treturn -EPERM;\n-\tdown(&dev->serialize);\n-\tif (!connected(dev)) {\n-\t\tup(&dev->serialize);\n-\t\treturn -ENODEV;\n-\t}\n \n \tswitch (cmd) {\n \tcase USBDEVFS_CONTROL:\n@@ -1241,10 +1444,16 @@\n \t\tbreak;\n \n \tcase USBDEVFS_SUBMITURB:\n+\t\tdown(&dev->serialize);\n+\t\tif (!connected(dev)) {\n+\t\t\tup(&dev->serialize);\n+\t\t\treturn -ENODEV;\n+\t\t}\n \t\tsnoop(&dev->dev, \"%s: SUBMITURB\\n\", __FUNCTION__);\n \t\tret = proc_submiturb(ps, p);\n \t\tif (ret >= 0)\n \t\t\tinode->i_mtime = CURRENT_TIME;\n+\t\tup(&dev->serialize);\n \t\tbreak;\n \n \tcase USBDEVFS_DISCARDURB:\n@@ -1282,7 +1491,6 @@\n \t\tret = proc_ioctl(ps, p);\n \t\tbreak;\n \t}\n-\tup(&dev->serialize);\n \tif (ret >= 0)\n \t\tinode->i_atime = CURRENT_TIME;\n \treturn ret;\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "USB", "Hardware": "i386 Linux", "Importance": "P2 normal", "Assignee": "baldrick", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2004-07-22 03:23 UTC by Tyler Nielsen", "Modified": "2004-08-11 10:04 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "2.6.7", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/usb/core/devio.c"], "methods": ["proc_control", "proc_bulk", "proc_resetep", "proc_clearhalt", "proc_getdriver", "proc_connectinfo", "proc_resetdevice", "proc_setintf", "proc_setconfig", "proc_unlinkurb", "proc_reapurbnonblock", "proc_disconnectsignal", "proc_claiminterface", "proc_ioctl"]}
{"id": "3024", "title": "Tyan Thunder K7 hangs on shutdown / reboot", "description": "Distribution: Debian Sid (unstable)\nHardware Environment: Tyan Thunder K7 (s2462 with latest 2.14 Bios), Dual Athlon\nMP 1200 MHz, Ati Radeon 9600, Sounblaster PCI 128 (ens1371)\n\nlspci\n\n0000:00:00.0 Host bridge: Advanced Micro Devices [AMD] AMD-760 MP [IGD4-2P]\nSystem Controller (rev 11)\n0000:00:01.0 PCI bridge: Advanced Micro Devices [AMD] AMD-760 MP [IGD4-2P] AGP\nBridge\n0000:00:07.0 ISA bridge: Advanced Micro Devices [AMD] AMD-766 [ViperPlus] ISA\n(rev 02)\n0000:00:07.1 IDE interface: Advanced Micro Devices [AMD] AMD-766 [ViperPlus] IDE\n(rev 01)\n0000:00:07.3 Bridge: Advanced Micro Devices [AMD] AMD-766 [ViperPlus] ACPI (rev 01)\n0000:00:07.4 USB Controller: Advanced Micro Devices [AMD] AMD-766 [ViperPlus]\nUSB (rev 07)\n0000:00:0b.0 Multimedia audio controller: Ensoniq ES1371 [AudioPCI-97] (rev 06)\n0000:00:0d.0 SCSI storage controller: Adaptec AIC-7899P U160/m (rev 01)\n0000:00:0d.1 SCSI storage controller: Adaptec AIC-7899P U160/m (rev 01)\n0000:00:0f.0 Ethernet controller: 3Com Corporation 3c980-TX Fast Etherlink XL\nServer Adapter [Cyclone] (rev 78)\n0000:00:10.0 Ethernet controller: 3Com Corporation 3c980-TX Fast Etherlink XL\nServer Adapter [Cyclone] (rev 78)\n0000:01:05.0 VGA compatible controller: ATI Technologies Inc RV350 AP [Radeon 9600]\n0000:01:05.1 Display controller: ATI Technologies Inc RV350 AP [Radeon 9600]\n(Secondary)\n\n\nSoftware Environment: ?\nProblem Description:\n\nEvery time I shut down the system (having ACPI enabled) it hangs. The monitor\ngoes to power saving mode, but the fans, etc. of the computer keep running.\nUsing the power / reset buttons does not help. The system remains in this state\nuntil I pull the power plug.\n\nExactly the same thing happens with rebooting the system. This did not happen\nwith kernel 2.6.0. It seems to me somewhat ACPI related. Without any apci\nmodules loaded there is no problem.\n\nInterestingly I can shut down the system from Windows 2000, but I cannot reboot\nit (same symptoms).\n\nSteps to reproduce:\n\nBoot system with ACPI modules loaded.\n\nshutdown -h now\nor shutdown -r now\n\n=> System hangs.", "patch": ["diff -u -r -N linux-2.6.8.1/drivers/acpi/hardware/hwsleep.c linux-2.6.8.1-acpifix/drivers/acpi/hardware/hwsleep.c\n--- linux-2.6.8.1/drivers/acpi/hardware/hwsleep.c\t2004-08-16 09:53:05.000000000 +0200\n+++ linux-2.6.8.1-acpifix/drivers/acpi/hardware/hwsleep.c\t2004-08-16 10:00:41.257905209 +0200\n@@ -284,6 +284,11 @@\n \t\tif (ACPI_FAILURE (status)) {\n \t\t\treturn_ACPI_STATUS (status);\n \t\t}\n+\t} else {\n+\t\tstatus = acpi_hw_clear_acpi_status (ACPI_MTX_DO_NOT_LOCK);\n+\t\tif (ACPI_FAILURE (status)) {\n+\t\treturn_ACPI_STATUS (status);\n+\t\t}\n \t}\n \n \t/*\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "Power-Off", "Hardware": "i386 Linux", "Importance": "P2 normal", "Assignee": "acpi_power-off", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2004-07-06 09:23 UTC by Marcel Weber", "Modified": "2004-08-29 10:01 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "2.6.7", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/acpi/hardware/hwsleep.c"], "methods": ["acpi_enter_sleep_state_prep"]}
{"id": "2829", "title": "posix_locks_deadlock() loops infinitely", "description": "Distribution: debian\nHardware Environment:\nSoftware Environment:\nProblem Description: Using POSIX threads makes posix_locks_deadlock() loop\ninfinitely.\n\nSteps to reproduce:\n\nThere are 3 processes; \"A\", \"B\" and \"C\".\nEach process opens \"file1\", \"file2\" and \"file3\".\n\n\"A\" creates 3 POSIX threads; \"A1\", \"A2\" and \"A3\". (These threads' PIDs are the\nsame.)\n\"B\" creates 2 POSIX threads; \"B1\" and \"B2\". (These threads' PIDs are the same.)\n\"C\" creates 1 POSIX thread; \"C1\".\n\n\n1. \"A1\" locks \"file1\" exclusively.\n2. \"B1\" locks \"file2\" exclusively.\n3. \"C1\" locks \"file3\" exclusively.\n4. \"A2\" trys to lock \"file2\" and sleeps (blocked by \"B1\").\n5. \"A3\" trys to lock \"file3\" and sleeps (blocked by \"C1\").\n6. \"B2\" trys to lock \"file1\".\n   Here, posix_locks_deadlock() must detect deadlock, but\n   it does not. Then \"B2\" sleeps (blocked \"A1\").\n\n  \"A\"                                    \"B\"\n   |                                      |\n   +--A1(LOCK)---->(file1)<-B2(*deadlock)-+\n   |                                      |\n   |                                      |\n   +--A2(BLOCK)--->(file2)<---B1(LOCK)----+\n   |\n   |\n   +--A3(BLOCK)--->(file3)<---C1(LOCK)----\"C\"\n\n    block_list -> A3(BLOCK) -> A2(BLOCK)\n\n\n7. \"C1\" unlocks \"file3\". (\"A3\" wakes up and locks \"file3\".)\n8. \"A3\" unlocks \"file3\".\n9. Another process locks \"file1\".\n   This makes posix_locks_deadlock() loop infinitely.", "patch": ["From 4db21bd89a9850133a72e139e00ce435d6f8408f Mon Sep 17 00:00:00 2001\nFrom: J. Bruce Fields <bfields@citi.umich.edu>\nDate: Sun, 28 Oct 2007 12:22:38 -0400\nSubject: [PATCH] locks: fix possible infinite loop in posix deadlock detection\n\nIt's currently possible to send posix_locks_deadlock() into an infinite\nloop (under the BKL).\n\nFor now, fix this just by bailing out after a few iterations.  We may\nwant to fix this in a way that better clarifies the semantics of\ndeadlock detection.  But that will take more time, and this minimal fix\nis probably adequate for any realistic scenario, and is simple enough to\nbe appropriate for applying to stable kernels now.\n\nThanks to George Davis for reporting the problem.\n\nCc: \"George G. Davis\" <gdavis@mvista.com>\nSigned-off-by: J. Bruce Fields <bfields@citi.umich.edu>\n---\n fs/locks.c |   11 +++++++++++\n 1 files changed, 11 insertions(+), 0 deletions(-)\n\ndiff --git a/fs/locks.c b/fs/locks.c\nindex 0127a28..8b8388e 100644\n--- a/fs/locks.c\n+++ b/fs/locks.c\n@@ -696,17 +696,28 @@ EXPORT_SYMBOL(posix_test_lock);\n  * Note: the above assumption may not be true when handling lock requests\n  * from a broken NFS client. But broken NFS clients have a lot more to\n  * worry about than proper deadlock detection anyway... --okir\n+ *\n+ * However, the failure of this assumption (also possible in the case of\n+ * multiple tasks sharing the same open file table) also means there's no\n+ * guarantee that the loop below will terminate.  As a hack, we give up\n+ * after a few iterations.\n  */\n+\n+#define MAX_DEADLK_ITERATIONS 10\n+\n static int posix_locks_deadlock(struct file_lock *caller_fl,\n \t\t\t\tstruct file_lock *block_fl)\n {\n \tstruct file_lock *fl;\n+\tint i = 0;\n \n next_task:\n \tif (posix_same_owner(caller_fl, block_fl))\n \t\treturn 1;\n \tlist_for_each_entry(fl, &blocked_list, fl_link) {\n \t\tif (posix_same_owner(fl, block_fl)) {\n+\t\t\tif (i++ > MAX_DEADLK_ITERATIONS)\n+\t\t\t\treturn 0;\n \t\t\tfl = fl->fl_next;\n \t\t\tblock_fl = fl;\n \t\t\tgoto next_task;\n-- \n1.5.3.4.208.gc990\n\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "File System", "Classification": "Unclassified", "Component": "VFS", "Hardware": "i386 Linux", "Importance": "P2 normal", "Assignee": "fs_vfs", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2004-06-03 22:45 UTC by i-sakamoto", "Modified": "2008-03-03 20:37 UTC", "CC List": "3 users", "See Also": "", "Kernel Version": "2.6.6", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["fs/locks.c"], "methods": ["posix_locks_deadlock"]}
{"id": "2638", "title": "kernel parameter acpi_os_name= does not work", "description": "Distribution: Debian unstable \nHardware Environment: Centrino Notebook Bullman V5Cen (= Compal  \nCL50) \nProblem Description: \n \nI am using the command line parameter acpi_os_name=\"Microsoft \nWindows XP\" to prevent the EHCI device from being disabled. However, \nthis does not work anymore with kernel 2.6.5 onwards. \n \nWith kernel 2.6.4, dmesg also showed a line containing: \n \nACPI: Overriding _OS definition \n \nWith kernel 2.6.5 and 2.6.6-rc1, acpi_os_name=\"Microsoft Windows XP\" \ndoes not have the desired effect (not disabling the EHCI device), and the \nabove line is not shown in dmesg. \n \nThis happens with both the kernels supplied by the Debian project and \nkernels compiled by myself from the original source.", "patch": ["--- linux-2.6.6.orig/init/main.c\t2004-05-14 13:38:31.000000000 +0800\n+++ linux-2.6.6/init/main.c\t2004-05-14 15:16:55.888691104 +0800\n@@ -242,9 +242,17 @@ __setup(\"quiet\", quiet_kernel);\n    failed parameters */\n static int __init unknown_bootoption(char *param, char *val)\n {\n-\t/* Change NUL term back to \"=\", to make \"param\" the whole string. */\n-\tif (val)\n-\t\tval[-1] = '=';\n+\t/* Change NUL term back to \"=\" and restore quotes, to make \"param\"\n+\t   the whole string. */\n+\tif (val) {\n+\t\tif (val[-1] == '\"') {\n+\t\t\tval[-2] = '=';\n+\t\t\tval[strlen(val)] = '\"';\n+\t\t\tval[strlen(val) + 1] = '\\0';\n+\t\t}\n+\t\telse\n+\t\t\tval[-1] = '=';\n+\t}\n \n \t/* Handle obsolete-style parameters */\n \tif (obsolete_checksetup(param))\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "Other", "Hardware": "i386 Linux", "Importance": "P2 normal", "Assignee": "Zhu Yi", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2004-05-04 13:25 UTC by Peter Teichmann", "Modified": "2004-11-03 17:52 UTC", "CC List": "1 user", "See Also": "", "Kernel Version": "2.6.5", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["init/main.c"], "methods": ["unknown_bootoption"]}
{"id": "2567", "title": "wrong irq rouing on centrino laptop - PIC", "description": "Hardware Environment: some centrino laptop\nProblem Description:\n\n I'm trying to use Intel Wireless 2100 adapter on my centrino based\n notebook. I use ipw2100 drivers from ipw2100.sf.net. The thing is that\n hardware says that the device should generate irq11, but it really\n generates irq5. I tryed both 2.4.26 and 2.6.5. I also tryed to compile\n kernel with and without ACPI. I tryed to compile kernel with and\n without APIC support. I also tryed to pass some parameters to kernel\n (acpi=off, acpi=force, pci=biosirq). But anyway kernel says irq 11 and\n device generates irq5. Of course it is possible to be hardware\n problem, but it works under windows.", "patch": ["--- linux-2.4.22-1.2174.nptl.asp/drivers/acpi/pci_link.c\t2004-02-20 00:52:23.000000000 +0300\n+++ linux-2.4.22-1.2174.nptl.aspmy/drivers/acpi/pci_link.c\t2004-04-24 13:15:09.000000000 +0400\n@@ -261,12 +261,6 @@\n \t\tgoto end;\n \t}\n \n-\t/*\n-\t * Note that we don't validate that the current IRQ (_CRS) exists\n-\t * within the possible IRQs (_PRS): we blindly assume that whatever\n-\t * IRQ a boot-enabled Link device is set to is the correct one.\n-\t * (Required to support systems such as the Toshiba 5005-S504.)\n-\t */\n \tlink->irq.active = irq;\n \n \tACPI_DEBUG_PRINT((ACPI_DB_INFO, \"Link at IRQ %d \\n\", link->irq.active));\n@@ -495,13 +489,26 @@\n static int acpi_pci_link_allocate(struct acpi_pci_link* link) {\n \tint irq;\n \tint i;\n+\tint irq_allowed;\n \n \tACPI_FUNCTION_TRACE(\"acpi_pci_link_allocate\");\n \n \tif (link->irq.setonboot)\n \t\treturn_VALUE(0);\n \n-\tif (link->irq.active) {\n+\tif(link->irq.active) {\n+\t\tirq_allowed = 0;\n+\t\tfor (i=(link->irq.possible_count-1); i>0; i--)\n+\t\t\tif(link->irq.possible[i] == link->irq.active)\n+\t\t\t{\n+\t\t\t\tirq_allowed = 1;\n+\t\t\t\tbreak;\n+\t\t\t}\n+\t} else {\n+\t\tirq_allowed = 1;\n+\t}\n+\t\n+\tif (link->irq.active && irq_allowed) {\n \t\tirq = link->irq.active;\n \t} else {\n \t\tirq = link->irq.possible[0];\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "Config-Interrupts", "Hardware": "i386 Linux", "Importance": "P2 normal", "Assignee": "Len Brown", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2004-04-22 09:45 UTC by Andrey Ulanov", "Modified": "2004-05-11 23:28 UTC", "CC List": "1 user", "See Also": "", "Kernel Version": "2.4.26", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/acpi/pci_link.c"], "methods": ["acpi_pci_link_allocate"]}
{"id": "2443", "title": "Frequent short \"pauses\" corresponding to multiple battery events", "description": "Distribution: Slackware-based, mostly self-built \nHardware Environment: IBM ThinkPad 240 - Celeron Mendocino 300, 192MB RAM \nSoftware Environment: \nProblem Description: System \"pauses\" for up to a second at a time, \napproximately every 10-15 seconds when ACPI is enabled. This corresponds to a \nblock of anything up to 10 \"battery BAT1 00000080 00000001\" events being \ngenerated. Running top shows \"events/0\" clocking up a chunk of CPU time \ncorresponding to the pause duration each time it occurs. \n \nUnder 2.4.25, the battery events always appear in twos. \n \nSteps to reproduce: Simply boot the system with an ACPI-enabled kernel :) I \ndon't know whether it is ThinkPad 240-specific or whether other systems are \nalso affected. The pauses are most noticeable when playing audio or video, but \naffect everything - when typing, characters will briefly stop being echoed \"in \nreal time\", then the system will \"catch up\" when the pause ends.", "patch": ["--- linux-2.6.6/drivers/acpi/events/evxfevnt.c\tMon May 10 03:32:26 2004\n+++ patched/drivers/acpi/events/evxfevnt.c\tThu May 20 11:15:16 2004\n@@ -247,6 +247,12 @@\n \t\tgoto unlock_and_exit;\n \t}\n \n+\t/* Be sure to clear status before enable it*/\n+\tstatus = acpi_hw_clear_gpe(gpe_event_info);\n+\tif (ACPI_FAILURE (status)) {\n+\t\tgoto unlock_and_exit;\n+\t}\n+\n \t/* Check for Wake vs Runtime GPE */\n \n \tif (flags & ACPI_EVENT_WAKE_ENABLE) {\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "Power-Battery", "Hardware": "i386 Linux", "Importance": "P2 normal", "Assignee": "Shaohua", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2004-04-05 09:48 UTC by Stephen Mollett", "Modified": "2004-12-29 18:10 UTC", "CC List": "1 user", "See Also": "", "Kernel Version": "2.6.5", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/acpi/events/evxfevnt.c"], "methods": ["acpi_enable_gpe"]}
{"id": "2423", "title": "2.6.4-rc3 OOPSes on insertion/removal of bluetooth dongle", "description": "Distribution: debian unstable\nHardware Environment: Asus L7000 OEM laptop (Intel UHCI), bluetooth dongle\n(worked before)\nSoftware Environment: hotplug 0.0.20040329-2, bluez 1.5-2 (debian unstable)\nProblem Description:\nWhen I insert my USB/Bluetooth dongle, the kernel OOPSes on me, and the device\ndoesn't show up in /proc/usb/devices (it doesn't work at all):\n\nusb 1-1: new full speed USB device using address 3\nUnable to handle kernel NULL pointer dereference at virtual address 00000004\n printing eip:\nc0238fc4\n*pde = 00000000\nOops: 0000 [#1]\nCPU:    0\nEIP:    0060:[<c0238fc4>]    Not tainted\nEFLAGS: 00010296   (2.6.5-rc3) \nEIP is at usb_disable_interface+0x14/0x50\neax: cb6280e0   ebx: 00000000   ecx: 00000286   edx: cbfef0a0\nesi: 00000002   edi: 00000000   ebp: c98eb800   esp: cbd53d48\nds: 007b   es: 007b   ss: 0068\nProcess khubd (pid: 5, threadinfo=cbd52000 task=cbfb2040)\nStack: 00001388 0000007b 00000001 00000002 c4496c10 c98eb800 c0239248 c98eb800 \n       cb6280e0 0000000b 00000001 00000002 00000001 00000000 00000000 00001388 \n       00000000 cb6280e0 00000000 c44d1080 c44d1138 c448fd60 c0250a4c c98eb800 \nCall Trace:\n [<c0239248>] usb_set_interface+0xb8/0x1a0\n [<c0250a4c>] hci_usb_probe+0x23c/0x4b0\n [<c0167046>] alloc_inode+0x136/0x140\n [<c017ea3e>] sysfs_new_inode+0x5e/0xb0\n [<c0233421>] usb_probe_interface+0x61/0x80\n [<c01fdfdf>] bus_match+0x3f/0x70\n [<c01fe05f>] device_attach+0x4f/0xa0\n [<c01fe25b>] bus_add_device+0x5b/0xa0\n [<c01fd0a1>] device_add+0xa1/0x130\n [<c0239605>] usb_set_configuration+0x1d5/0x270\n [<c0234538>] usb_new_device+0x258/0x3d0\n [<c0235df3>] hub_port_connect_change+0x183/0x290\n [<c02361aa>] hub_events+0x2aa/0x300\n [<c0236235>] hub_thread+0x35/0x100\n [<c011a990>] default_wake_function+0x0/0x20\n [<c0236200>] hub_thread+0x0/0x100\n [<c01052ad>] kernel_thread_helper+0x5/0x18\n\nCode: 80 7b 04 00 74 26 31 f6 8d 74 26 00 8b 43 0c 47 0f b6 44 30 \n\n\nSteps to reproduce:\nJust plugging in my dongle (or having it inserted on boot) triggers the OOPS.\nPlugging in my USB mouse doesn't.", "patch": ["--- 1.47/drivers/usb/core/message.c\tTue Mar 30 01:04:29 2004\n+++ edited/drivers/usb/core/message.c\tTue Mar 30 17:34:54 2004\n@@ -1176,15 +1176,34 @@\n \t\t\tintf->dev.bus = &usb_bus_type;\n \t\t\tintf->dev.dma_mask = dev->dev.dma_mask;\n \t\t\tintf->dev.release = release_interface;\n+\t\t\tdevice_initialize (&intf->dev);\n \t\t\tsprintf (&intf->dev.bus_id[0], \"%d-%s:%d.%d\",\n \t\t\t\t dev->bus->busnum, dev->devpath,\n \t\t\t\t configuration,\n \t\t\t\t alt->desc.bInterfaceNumber);\n+\t\t}\n+\n+\t\t/* Now that all interfaces are setup, probe() calls\n+\t\t * may claim() any interface that's not yet bound.\n+\t\t * Many class drivers need that: CDC, audio, video, etc.\n+\t\t */\n+\t\tfor (i = 0; i < cp->desc.bNumInterfaces; ++i) {\n+\t\t\tstruct usb_interface *intf = cp->interface[i];\n+\t\t\tstruct usb_interface_descriptor *desc;\n+\n+\t\t\tdesc = &intf->altsetting [0].desc;\n \t\t\tdev_dbg (&dev->dev,\n-\t\t\t\t\"registering %s (config #%d, interface %d)\\n\",\n+\t\t\t\t\"adding %s (config #%d, interface %d)\\n\",\n \t\t\t\tintf->dev.bus_id, configuration,\n-\t\t\t\talt->desc.bInterfaceNumber);\n-\t\t\tdevice_register (&intf->dev);\n+\t\t\t\tdesc->bInterfaceNumber);\n+\t\t\tret = device_add (&intf->dev);\n+\t\t\tif (ret != 0) {\n+\t\t\t\tdev_err(&dev->dev,\n+\t\t\t\t\t\"device_add(%s) --> %d\\n\",\n+\t\t\t\t\tintf->dev.bus_id,\n+\t\t\t\t\tret);\n+\t\t\t\tcontinue;\n+\t\t\t}\n \t\t\tusb_create_driverfs_intf_files (intf);\n \t\t}\n \t}\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "USB", "Hardware": "i386 Linux", "Importance": "P2 normal", "Assignee": "Alan Stern", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2004-04-01 12:45 UTC by Martijn van de Streek", "Modified": "2004-11-12 12:53 UTC", "CC List": "1 user", "See Also": "", "Kernel Version": "2.6.5", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/usb/core/message.c"], "methods": ["usb_set_configuration"]}
{"id": "2200", "title": "uncorrectly enabling GPEs", "description": "Current ACPI implementation will enable a GPE if its corresponding _Lxx or \n_Exx method is found. But some GPEs the methods stand are wakeup GPEs. we \nshouldn't enable it before system enters sleep state.\nIn my P4 box, keyboard is such kind of devices. keyboard can generate 0x15 GPE \nto wakeup system, and DSDT has a method '_L15'. In 2.6.2, after boot, every \nhitting keyboard generates a SCI interrupt. if 0x15 is not enabled, keyboard \ndoesn't create SCI.", "patch": ["--- a/drivers/acpi/events/evgpeblk.c\t2004-02-26 16:43:24.000000000 +0800\n+++ b/drivers/acpi/events/evgpeblk.c\t2004-02-26 17:53:45.000000000 +0800\n@@ -48,7 +48,83 @@\n #define _COMPONENT          ACPI_EVENTS\n \t ACPI_MODULE_NAME    (\"evgpeblk\")\n \n+#define MAX_WAKEUP_GPES 30\n+static u32 wakeup_gpes[MAX_WAKEUP_GPES];\n+static int wakeup_gpes_index = 0;\n \n+static acpi_status\n+acpi_ev_save_wakeup_gpes (\n+\tacpi_handle                     obj_handle,\n+\tu32                             level,\n+\tvoid                            *obj_desc,\n+\tvoid                            **return_value)\n+{\n+\tacpi_status\tstatus;\n+\tstruct acpi_buffer\tbuffer = {ACPI_ALLOCATE_BUFFER, NULL};\n+\tunion acpi_object\t*package = NULL;\n+\tunion acpi_object\t*element = NULL;\n+\n+\tACPI_FUNCTION_TRACE(\"acpi_ev_save_wakeup_gpes\");\n+ \n+\t/* _PRW */\n+\tstatus = acpi_evaluate_object(obj_handle, \"_PRW\", NULL, &buffer);\n+\tif (ACPI_FAILURE(status)) {\n+\t\treturn_ACPI_STATUS (AE_OK);\n+\t}\n+\n+\tpackage = (union acpi_object *) buffer.pointer;\n+\tif (package->package.count < 2) {\t\n+\t\tACPI_DEBUG_PRINT((ACPI_DB_ERROR, \"Bad _PRW package\\n\"));\n+\t\tgoto end;\n+\t}\n+\n+\telement = &(package->package.elements[0]);\n+\tif (element->type != ACPI_TYPE_INTEGER) {\n+\t\t/* TBD: support GPE devices */\t\n+\t\tACPI_DEBUG_PRINT((ACPI_DB_ERROR, \"Bad _PRW package\\n\"));\n+\t\tgoto end;\n+\t}\n+\twakeup_gpes[wakeup_gpes_index++] = element->integer.value;\n+\n+end:\n+\tacpi_os_free(buffer.pointer);\n+\treturn_ACPI_STATUS (AE_OK);\n+}\n+\n+static acpi_status\n+acpi_ev_wakeup_gpes_initialize (void)\n+{\t\n+\tacpi_status\tstatus;\n+\tint\ti = 0;\n+\n+\tACPI_FUNCTION_TRACE(\"acpi_ev_wakeup_gpes_initialize\");\n+printk(\"hahah\\n\");\n+\tstatus = acpi_ns_walk_namespace (ACPI_TYPE_DEVICE, ACPI_ROOT_OBJECT,\n+\t\t\t  ACPI_UINT32_MAX, ACPI_NS_WALK_NO_UNLOCK, acpi_ev_save_wakeup_gpes,\n+\t\t\t  NULL, NULL);\n+\t\n+\tACPI_DEBUG_PRINT((ACPI_DB_INFO, \"Wakeup GPEs: \"));\n+\twhile (i < wakeup_gpes_index) {\n+\t\tACPI_DEBUG_PRINT((ACPI_DB_INFO, \"%8.8x \", wakeup_gpes[i]));\n+\t\ti ++;\n+\t}\n+\tACPI_DEBUG_PRINT((ACPI_DB_INFO, \"\\n\"));\n+\n+\treturn status;\n+}\n+\n+static int acpi_ev_is_wakeup_gpe(u32 gpe_number)\n+{\n+\tint i = 0;\n+\twhile (i < wakeup_gpes_index)\n+\t{\n+\t\tif (wakeup_gpes[i] == gpe_number)\n+\t\t\treturn 1;\n+\t\ti ++;\n+\t}\n+\n+\treturn 0;\n+}\n /*******************************************************************************\n  *\n  * FUNCTION:    acpi_ev_valid_gpe_event\n@@ -225,6 +301,10 @@ acpi_ev_save_method_info (\n \t/* Convert the last two characters of the name to the GPE Number */\n \n \tgpe_number = ACPI_STRTOUL (&name[2], NULL, 16);\n+\t/* Skip wakeup GPEs */\n+\tif (acpi_ev_is_wakeup_gpe(gpe_number))\n+\t\treturn_ACPI_STATUS (AE_OK);\n+\n \tif (gpe_number == ACPI_UINT32_MAX) {\n \t\t/* Conversion failed; invalid method, just ignore it */\n \n@@ -793,7 +873,11 @@ acpi_ev_gpe_initialize (void)\n \tif (ACPI_FAILURE (status)) {\n \t\treturn_ACPI_STATUS (status);\n \t}\n-\n+\t/* Find all wakeup GPEs */\n+\tstatus = acpi_ev_wakeup_gpes_initialize(); \n+\tif (ACPI_FAILURE (status)) {\n+\t\treturn_ACPI_STATUS (status);\n+\t}\n \t/*\n \t * Initialize the GPE Blocks defined in the FADT\n \t *\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "ACPICA-Core", "Hardware": "i386 Linux", "Importance": "P2 normal", "Assignee": "Robert Moore", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2004-02-26 01:56 UTC by Shaohua", "Modified": "2006-09-28 13:22 UTC", "CC List": "1 user", "See Also": "", "Kernel Version": "2.6.2", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/acpi/events/evgpeblk.c"], "methods": ["acpi_ev_save_method_info", "acpi_ev_gpe_initialize"]}
{"id": "1930", "title": "2.6.1 fails to mount large iso9660 dvd discs with ATAPI drivers, succeeds with SCSI.", "description": "Distribution: Gentoo\n\nHardware Environment: \nAbit NF-7 (nforce2) Mobo, Athlon-XP 2500 (Barton), TDK Indi DVD+RW, Creative PC-DVD.\n\n################################################################################\n\nSoftware Environment: \nLinux gentoo 2.6.1 #3 Wed Jan 21 17:53:53 CST 2004 i686 AMD Athlon(tm) XP 2500+\nAuthenticAMD GNU/Linux\n \nGnu C                  3.2.3\nGnu make               3.80\nutil-linux             2.11z\nmount                  2.11z\nmodule-init-tools      0.9.15-pre4\ne2fsprogs              1.34\nnfs-utils              1.0.6\nLinux C Library        2.3.2\nDynamic linker (ldd)   2.3.2\nProcps                 3.1.12\nNet-tools              1.60\nKbd                    1.08\nSh-utils               5.0.91\nModules Loaded         nvnet nvidia\n################################################################################\n\nProblem Description:\nI've used growisofs (a mkisofs frontend) to write big (1.4 Gb) .avi's to my\nDVD+RW under both 2.4.xx and 2.6 kernels (atapi on the 2.6). However, none of my\n2.6 kernels (atapi only) seem to be able to mount nearly full dvd's, while my\n2.4.24 kernel (scsi-emulation) can mount dvd's that are full (about 4.3 Gb).\nEnabling scsi emulation and passing hdc=ide-scsi at boot fixes the problem for\nlinux-2.6.1, so it seems that there may be a problem with an atapi-only dvdrom\nmounting dvd's with over 3.3 Gb on them.\n\nI also have a regular dvdplayer attched and it is known as:\n\n/dev/cdroms/cdrom0 -> ../ide/host0/bus1/target1/lun0/cd\n\nThis drive reports \"No medium found\" for any large iso9660 dvd's, but can mount\nUDF disks no problem.\n\nSteps to reproduce:\n\n# Big iso9660 (4.0 Gb total)\n$ mount /mnt/dvdburner/\nmount: block device /dev/cdroms/cdrom0 is write-protected, mounting read-only\nmount: wrong fs type, bad option, bad superblock on /dev/cdroms/cdrom0,\nor too many mounted file systems\n\n# Output from tail -f /var/log/kernel/current\nJan 21 10:29:05 [kernel] Unable to identify CD-ROM format.\n\n###############################################\n\n# Smaller iso9660 (3.3 Gb total)\n$ mount /mnt/dvdburner/\nmount: block device /dev/cdroms/cdrom0 is write-protected, mounting read-only\n\n# Output from tail -f /var/log/kernel/current\nJan 21 10:32:12 [kernel] ISO 9660 Extensions: Microsoft Joliet Level 3\nJan 21 10:32:12 [kernel] ISO 9660 Extensions: RRIP_1991A\n\n############################################### \n\nBoth of these DVD's were made using growisofs, and the only difference I can see\nis that they are of different size.\nPlease let me know if there is anything else I can do to further troubleshoot\nthis problem.\nThanks.", "patch": ["--- a/drivers/ide/ide-cd.c\t2004-12-10 23:06:18.000000000 +0100\n+++ b/drivers/ide/ide-cd.c\t2004-12-17 19:30:56.000000000 +0100\n@@ -2356,25 +2356,31 @@\n \t/* Read the multisession information. */\n \tif (toc->hdr.first_track != CDROM_LEADOUT) {\n \t\t/* Read the multisession information. */\n-\t\tstat = cdrom_read_tocentry(drive, 0, 1, 1, (char *)&ms_tmp,\n+\t\tstat = cdrom_read_tocentry(drive, 0, 0, 1, (char *)&ms_tmp,\n \t\t\t\t\t   sizeof(ms_tmp), sense);\n \t\tif (stat) return stat;\n+\t\n+\t\ttoc->last_session_lba = be32_to_cpu(ms_tmp.ent.addr.lba);\n \t} else {\n-\t\tms_tmp.ent.addr.msf.minute = 0;\n-\t\tms_tmp.ent.addr.msf.second = 2;\n-\t\tms_tmp.ent.addr.msf.frame  = 0;\n \t\tms_tmp.hdr.first_track = ms_tmp.hdr.last_track = CDROM_LEADOUT;\n+\t\ttoc->last_session_lba = msf_to_lba(0, 2, 0); /* 0m 2s 0f */\n \t}\n \n #if ! STANDARD_ATAPI\n-\tif (CDROM_CONFIG_FLAGS(drive)->tocaddr_as_bcd)\n+\tif (CDROM_CONFIG_FLAGS(drive)->tocaddr_as_bcd) {\n+\t\t/* Re-read multisession information using MSF format */\n+\t\tstat = cdrom_read_tocentry(drive, 0, 1, 1, (char *)&ms_tmp,\n+\t\t\t\t\t   sizeof(ms_tmp), sense);\n+\t\tif (stat)\n+\t\t\treturn stat;\n+\n \t\tmsf_from_bcd (&ms_tmp.ent.addr.msf);\n+\t\ttoc->last_session_lba = msf_to_lba(ms_tmp.ent.addr.msf.minute,\n+\t\t\t\t\t  \t   ms_tmp.ent.addr.msf.second,\n+\t\t\t\t\t\t   ms_tmp.ent.addr.msf.frame);\n+\t}\n #endif  /* not STANDARD_ATAPI */\n \n-\ttoc->last_session_lba = msf_to_lba (ms_tmp.ent.addr.msf.minute,\n-\t\t\t\t\t    ms_tmp.ent.addr.msf.second,\n-\t\t\t\t\t    ms_tmp.ent.addr.msf.frame);\n-\n \ttoc->xa_flag = (ms_tmp.hdr.first_track != ms_tmp.hdr.last_track);\n \n \t/* Now try to get the total cdrom capacity. */\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "IO/Storage", "Classification": "Unclassified", "Component": "IDE", "Hardware": "i386 Linux", "Importance": "P2 normal", "Assignee": "Luca Tettamanti", "URL": "", "Keywords": "", "Duplicates (1)": "3882", "Depends on": "", "Blocks": "", "Reported": "2004-01-21 16:28 UTC by Jeff Gardner", "Modified": "2004-12-18 14:31 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "2.6.1", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/ide/ide-cd.c"], "methods": ["cdrom_read_toc"]}
{"id": "1865", "title": "uhci-hcd or hid modules stops working blocking usb mouse and module unloading", "description": "Distribution: Gentoo Linux\nHardware Environment: AMD Athlon XP 2200+ on Via KT400 based board, 1GB Memory\nSoftware Environment: Gentoo Linux 1.4, Kernel 2.6 (and 2.6.1)\nProblem Description: \n\nThe driver responsible for my Logitech USB Mouse (uhci/ehci-hcd or hid) crashes\nand prevents the mouse from working any more. While the mouse's internal LED\nstays lit, it's impossible to unload and reload any module any more, so only a\nreboot solves the problem.\n\nReboot itself does not complete because it freezes when unloading other modules,\nlike Alsa. Any attempt to rmmod hid even with \"the force\" results in another\nuseless shell. Force module unload is enabled in Kernel.\n\nThe problem occured with both Kernel 2.6.0 and 2.6.1. I have not yet figured\nout, what really provokes the crash, but it will occur sometime after system\nstart. Shortest period was 30 minutes, longest 90 minutes.\n\nSteps to reproduce:\n- Start system\n- Wait.\n\nThis are example outputs of /var/log/messages at module crash time:\n\nJan 14 15:00:01 king kernel: drivers/usb/core/usb.c: deregistering driver hid\nJan 14 15:00:01 king input.agent[5388]: ... no modules for INPUT product\n3/46d/c00e/1100\nJan 14 15:00:01 king kernel: input: USB HID v1.10 Mouse [Logitech USB-PS/2\nOptical Mouse] on usb-0000:00:10.0-2.2\nJan 14 15:00:01 king kernel: drivers/usb/core/usb.c: registered new driver hid\nJan 14 15:00:01 king kernel: drivers/usb/input/hid-core.c: v2.0:USB HID core driver\nJan 14 15:41:16 king kernel: [f78d82d0] link (378d81e2) element (378d9200)\nJan 14 15:41:16 king kernel:  Element != First TD\nJan 14 15:41:16 king kernel:   0: [f78d9180] link (378d91c0) e3 Length=7\nMaxLen=7 DT0 EndPt=0 Dev=3, PID=2d(SETUP) (buf=37439ae0)\nJan 14 15:41:16 king kernel:   1: [f78d91c0] link (378d9200) e3 Length=7\nMaxLen=7 DT1 EndPt=0 Dev=3, PID=69(IN) (buf=3743a6c0)\nJan 14 15:41:16 king kernel:   2: [f78d9200] link (378d9240) e3 Stalled Babble\nLength=7ff MaxLen=3 DT0 EndPt=0 Dev=3, PID=69(IN) (buf=3743a6c8)\nJan 14 15:41:16 king kernel:   3: [f78d9240] link (00000001) e3 IOC Active\nLength=0 MaxLen=7ff DT1 EndPt=0 Dev=3, PID=e1(OUT) (buf=00000000)\nJan 14 15:41:16 king kernel:\nJan 14 15:41:21 king kernel: usb 2-2: control timeout on ep0in\nJan 14 15:41:41 king kernel: drivers/usb/core/usb.c: deregistering driver hid\nJan 14 15:41:46 king kernel: usb 2-2.2: control timeout on ep0out\n\nJan 14 14:38:42 king kernel: [f78db2d0] link (378db1e2) element (378e1200)\nJan 14 14:38:42 king kernel:  Element != First TD\nJan 14 14:38:42 king kernel:   0: [f78e1180] link (378e11c0) e3 Length=7\nMaxLen=7 DT0 EndPt=0 Dev=3, PID=2d(SETUP) (buf=322c47e0)\nJan 14 14:38:42 king kernel:   1: [f78e11c0] link (378e1200) e3 Length=7\nMaxLen=7 DT1 EndPt=0 Dev=3, PID=69(IN) (buf=36018780)\nJan 14 14:38:42 king kernel:   2: [f78e1200] link (378e1240) e3 Stalled Babble\nLength=7ff MaxLen=3 DT0 EndPt=0 Dev=3, PID=69(IN) (buf=36018788)\nJan 14 14:38:42 king kernel:   3: [f78e1240] link (00000001) e3 IOC Active\nLength=0 MaxLen=7ff DT1 EndPt=0 Dev=3, PID=e1(OUT) (buf=00000000)\nJan 14 14:38:42 king kernel:\nJan 14 14:38:47 king kernel: usb 2-2: control timeout on ep0in\nJan 14 14:49:43 king kernel: drivers/usb/core/usb.c: deregistering driver hid\nJan 14 14:49:48 king kernel: usb 2-2.2: control timeout on ep0out", "patch": ["===== uhci-hcd.c 1.78 vs edited =====\n--- 1.78/drivers/usb/host/uhci-hcd.c\tThu Feb  5 05:59:31 2004\n+++ edited/drivers/usb/host/uhci-hcd.c\tMon Feb  9 11:02:33 2004\n@@ -1516,6 +1516,7 @@\n \t}\n \n \tspin_unlock_irqrestore(&uhci->urb_list_lock, flags);\n+\tprintk(KERN_DEBUG \"%lx: queue urb %p\\n\", uhci->io_addr, urb);\n \n \treturn 0;\n }\n@@ -1667,6 +1668,7 @@\n \t  return 0;\n \t}\n \n+\tprintk(KERN_DEBUG \"%lx: dequeue urb %p\\n\", uhci->io_addr, urb);\n \tspin_lock_irqsave(&uhci->urb_list_lock, flags);\n \n \tlist_del_init(&urbp->urb_list);\n@@ -1857,6 +1859,7 @@\n \t\turb->status = status;\n \tspin_unlock_irqrestore(&urb->lock, flags);\n \n+\tprintk(KERN_DEBUG \"%lx: giveback urb %p\\n\", uhci->io_addr, urb);\n \tusb_hcd_giveback_urb(hcd, urb, regs);\n }\n \n@@ -1923,6 +1926,7 @@\n \tif (!status)\t/* shared interrupt, not mine */\n \t\treturn IRQ_NONE;\n \toutw(status, io_addr + USBSTS);\t\t/* Clear it */\n+\tprintk(KERN_DEBUG \"%x: irq status 0x%x\\n\", io_addr, status);\n \n \tif (status & ~(USBSTS_USBINT | USBSTS_ERROR | USBSTS_RD)) {\n \t\tif (status & USBSTS_HSE)\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "USB", "Hardware": "i386 Linux", "Importance": "P2 high", "Assignee": "Alan Stern", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2004-01-14 07:19 UTC by Christoph Dahlen", "Modified": "2004-05-11 13:56 UTC", "CC List": "3 users", "See Also": "", "Kernel Version": "2.6.1", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/usb/host/uhci-hcd.c"], "methods": ["uhci_urb_enqueue", "uhci_urb_dequeue", "uhci_finish_urb", "uhci_irq"]}
{"id": "1822", "title": "usb-storage borks out with my camera", "description": "I get this, while plugin my FinePix2400Zom camera to me USB port (it does work\nwith the 2.4 kernel series):\n\nInitializing USB Mass Storage driver...\nscsi0 : SCSI emulation for USB Mass Storage devices\n  Vendor: Fujifilm  Model: FinePix 1400Zoom  Rev: 1000\n  Type:   Direct-Access                      ANSI SCSI revision: 02\nsda : READ CAPACITY failed.\nsda : status=0, message=00, host=7, driver=00\nsda : sense not available.\nsda: assuming Write Enabled\nsda: assuming drive cache: write through\nsda : READ CAPACITY failed.\nsda : status=0, message=00, host=7, driver=00\nsda : sense not available.\nsda: assuming Write Enabled\nsda: assuming drive cache: write through\nsda : READ CAPACITY failed.\nsda : status=0, message=00, host=7, driver=00\nsda : sense not available.\nsda: assuming Write Enabled\nsda: assuming drive cache: write through\n /dev/scsi/host0/bus0/target0/lun0:<3>Buffer I/O error on device sda, logical\nblock 0\nBuffer I/O error on device sda, logical block 0\n unable to read partition table\n /dev/scsi/host0/bus0/target0/lun0:<3>Buffer I/O error on device sda, logical\nblock 0\n unable to read partition table\nAttached scsi removable disk sda at scsi0, channel 0, id 0, lun 0\nAttached scsi generic sg0 at scsi0, channel 0, id 0, lun 0,  type 0\nWARNING: USB Mass Storage data integrity not assured\nUSB Mass Storage device found at 3\ndrivers/usb/core/usb.c: registered new driver usb-storage\nUSB Mass Storage support registered.\nusbfs: USBDEVFS_CONTROL failed cmd usbmodules dev 3 rqt 128 rq 6 len 18 ret -110\n\n\n\n^^^^^^^^^ lots of those like this last line.", "patch": ["===== drivers/usb/storage/transport.c 1.123 vs edited =====\n--- 1.123/drivers/usb/storage/transport.c\tSun Feb 15 15:07:08 2004\n+++ edited/drivers/usb/storage/transport.c\tMon Feb 16 00:47:38 2004\n@@ -815,7 +815,10 @@\n \tif (us->iobuf[0]) {\n \t\tUS_DEBUGP(\"CBI IRQ data showed reserved bType %d\\n\",\n \t\t\t\tus->iobuf[0]);\n-\t\treturn USB_STOR_TRANSPORT_ERROR;\n+//\t\treturn USB_STOR_TRANSPORT_ERROR;\n+\t\t/* weirdo device -- fake goodness */\n+\t\treturn USB_STOR_TRANSPORT_GOOD;\n+\n \t}\n \n \tswitch (us->iobuf[1] & 0x0F) {\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "IO/Storage", "Classification": "Unclassified", "Component": "SCSI", "Hardware": "i386 Linux", "Importance": "P2 high", "Assignee": "Matthew Dharm", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2004-01-09 09:01 UTC by Andr", "Modified": "2004-03-13 03:20 UTC", "CC List": "5 users", "See Also": "", "Kernel Version": "2.6.1", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/usb/storage/transport.c"], "methods": ["usb_stor_CBI_transport"]}
{"id": "1696", "title": "Centrino's Speedstep is not detected correctly", "description": "I used to use /proc/acpi/processor/.../performance to set Centrino's 5 \nperformance states via userspace daemon. \n \nNow in linux 2.6.0, I configured the kernel ACPI to include \"processor\" and I \nconfigured SpeedStep to support the \"deprecated\" acpi performance interface as \nwell as anything else I think I have to turn on for cpufreq. \nBut after booting 2.6, I have /proc/acpi/processor/.../ but without \n\"performance\" in it. \"info\" says  \n+----- \n| processor id:            0 \n| acpi id:                 0 \n| bus mastering control:   yes \n| power management:        yes \n| throttling control:      no \n| performance management:  no \n| limit interface:         yes \n+----- \n \nSo it seems like \"performance\" is not supported even if I select it in kernel \nconfig. \n \nAdditionally, I do not find anything cpufreq-related in /sys/.  \n \ndmesg|grep \"cpufreq\" says: \n+----- \n| cpufreq: No CPUs supporting ACPI performance management found. \n+----- \n \nIn 2.4, everything is fine...", "patch": ["One big limitation of the ACPI specification is that it's impossible to\ndetect the current P-State by reading from ACPI-defined registers. And the\nCPU isn't always at P0 when the system boots. So, try to \"guess\" the current\nP-State by analyzing cpu_khz.\n\n arch/i386/kernel/cpu/cpufreq/acpi.c |   35 ++++++++++++++++++++++++++++++-----\n 1 files changed, 30 insertions(+), 5 deletions(-)\n\ndiff -ruN linux-original/arch/i386/kernel/cpu/cpufreq/acpi.c linux/arch/i386/kernel/cpu/cpufreq/acpi.c\n--- linux-original/arch/i386/kernel/cpu/cpufreq/acpi.c\t2004-03-15 09:20:50.000000000 +0100\n+++ linux/arch/i386/kernel/cpu/cpufreq/acpi.c\t2004-03-15 13:50:36.152118840 +0100\n@@ -238,6 +238,34 @@\n }\n \n \n+static unsigned long\n+acpi_cpufreq_guess_freq (\n+\tstruct cpufreq_acpi_io\t*data,\n+\tunsigned int\t\tcpu)\n+{\n+\tif (cpu_khz) {\n+\t\t/* search the closest match to cpu_khz */\n+\t\tunsigned int i;\n+\t\tunsigned long freq;\n+\t\tunsigned long freqn = data->acpi_data.states[0].core_frequency * 1000;\n+\n+\t\tfor (i=0; i < (data->acpi_data.state_count - 1); i++) {\n+\t\t\tfreq = freqn;\n+\t\t\tfreqn = data->acpi_data.states[i+1].core_frequency * 1000;\n+\t\t\tif ((2 * cpu_khz) > (freqn + freq)) {\n+\t\t\t\tdata->acpi_data.state = i;\n+\t\t\t\treturn (freq);\n+\t\t\t}\n+\t\t}\n+\t\tdata->acpi_data.state = data->acpi_data.state_count - 1;\n+\t\treturn (freqn);\n+\t} else\n+\t\t/* assume CPU is at P0... */\n+\t\tdata->acpi_data.state = 0;\n+\t\treturn data->acpi_data.states[0].core_frequency * 1000;\n+\t\n+}\n+\n static int\n acpi_cpufreq_cpu_init (\n \tstruct cpufreq_policy   *policy)\n@@ -290,11 +318,8 @@\n \t}\n \tpolicy->governor = CPUFREQ_DEFAULT_GOVERNOR;\n \n-\t/* \n-\t * The current speed is unknown and not detectable by ACPI... argh! Assume \n-\t * it's P0, it will be set to this value later during initialization.\n-\t */\n-\tpolicy->cur = data->acpi_data.states[0].core_frequency * 1000;\n+\t/* The current speed is unknown and not detectable by ACPI...  */\n+\tpolicy->cur = acpi_cpufreq_guess_freq(data, policy->cpu);\n \n \t/* table init */\n \tfor (i=0; i<=data->acpi_data.state_count; i++)\n", "Export an array of supported frequencies in sysfs [scaling_available_frequencies]\n\n arch/i386/kernel/cpu/cpufreq/acpi.c |   10 +++++++++-\n 1 files changed, 9 insertions(+), 1 deletion(-)\n\ndiff -ruN linux-original/arch/i386/kernel/cpu/cpufreq/acpi.c linux/arch/i386/kernel/cpu/cpufreq/acpi.c\n--- linux-original/arch/i386/kernel/cpu/cpufreq/acpi.c\t2004-03-15 13:52:08.060146696 +0100\n+++ linux/arch/i386/kernel/cpu/cpufreq/acpi.c\t2004-03-15 13:52:32.376450056 +0100\n@@ -331,7 +331,7 @@\n \t\t\tdata->freq_table[i].frequency = CPUFREQ_TABLE_END;\n \t}\n \n-\tresult = cpufreq_frequency_table_cpuinfo(policy, &data->freq_table[0]);\n+\tresult = cpufreq_frequency_table_cpuinfo(policy, data->freq_table);\n \tif (result) {\n \t\tgoto err_freqfree;\n \t}\n@@ -346,6 +346,7 @@\n \t\t\t(u32) data->acpi_data.states[i].power,\n \t\t\t(u32) data->acpi_data.states[i].transition_latency);\n \n+\tcpufreq_frequency_table_get_attr(data->freq_table, policy->cpu);\n \treturn_VALUE(result);\n \n  err_freqfree:\n@@ -370,6 +371,7 @@\n \tACPI_FUNCTION_TRACE(\"acpi_cpufreq_cpu_exit\");\n \n \tif (data) {\n+\t\tcpufreq_frequency_table_put_attr(policy->cpu);\n \t\tacpi_io_data[policy->cpu] = NULL;\n \t\tacpi_processor_unregister_performance(&data->acpi_data, policy->cpu);\n \t\tkfree(data);\n@@ -379,6 +381,11 @@\n }\n \n \n+static struct freq_attr* acpi_cpufreq_attr[] = {\n+\t&cpufreq_freq_attr_scaling_available_freqs,\n+\tNULL,\n+};\n+\n static struct cpufreq_driver acpi_cpufreq_driver = {\n \t.verify \t= acpi_cpufreq_verify,\n \t.target \t= acpi_cpufreq_target,\n@@ -386,6 +393,7 @@\n \t.exit\t\t= acpi_cpufreq_cpu_exit,\n \t.name\t\t= \"acpi-cpufreq\",\n \t.owner\t\t= THIS_MODULE,\n+\t.attr           = acpi_cpufreq_attr,\n };\n \n \n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "ACPI", "Classification": "Unclassified", "Component": "Power-Processor", "Hardware": "i386 Linux", "Importance": "P2 normal", "Assignee": "Len Brown", "URL": "", "Keywords": "", "Duplicates (1)": "1697", "Depends on": "", "Blocks": "", "Reported": "2003-12-18 02:16 UTC by Bernd Wurst", "Modified": "2004-06-02 09:42 UTC", "CC List": "4 users", "See Also": "", "Kernel Version": "2.6.0", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["arch/i386/kernel/cpu/cpufreq/acpi.c"], "methods": ["acpi_cpufreq_cpu_init"]}
{"id": "1321", "title": "[8139cp?] 2.6.0-test6 hangs while executing \"make menuconfig\" on a remote computer", "description": "Distribution: Red Hat 9.0 (both local and remote computers)\nHardware Environment:\nLocal: Athlon, ATI+ALi combo, 512 MB RAM, IDE HDD, RTL 8139 C+ (8139cp) Fast\nEthernet card\nRemote: Athlon, ALi, 512 MB RAN, IDE HDD, DEC Tulip Ethernet card\nSoftware Environment:\nLocal: 2.6.0-test6 (vesa driver for XFree86, KDE/Konsole)\nRemote: 2.4.23-pre6\nProblem Description: Kernel hangs while executing \"make menuconfig\" from a\nremote computer.\n\nSteps to reproduce:\n1. Consider 2 computers: laptop (local), desktop (remote)\n2. From laptop computer under KDE's Konsole ssh to desktop\n3. Execute make menuconfig (2.4.23-pre6 source tree in my case) on the remote\ncomputer.\n4. Exit and restart it few times (in my case it hangs within a dozen attempts)\n5. The local computer hangs. Remote computer is fine.\n\nIt doesn't happen if I try the same from Console terminals. And it doesn't\nhappen under 2.4.23-pre6 on the same local computer.\n\nThanks\nSrihari\nharisri@bigpond.com", "patch": ["# This is a BitKeeper generated patch for the following project:\n# Project Name: Linux kernel tree\n# This patch format is intended for GNU patch command version 2.5 or higher.\n# This patch includes the following deltas:\n#\t           ChangeSet\t1.1510  -> 1.1511 \n#\tdrivers/net/8139cp.c\t1.58    -> 1.59   \n#\n# The following is the BitKeeper ChangeSet Log\n# --------------------------------------------\n# 04/01/24\thirofumi@mail.parknet.co.jp\t1.1511\n# [netdrvr 8139cp] fix NAPI race\n# \n# Andreas Happe <andreashappe@gmx.net> writes:\n# > my notebook (hp/compaq nx7000) still crashes when using 8139cp (runs\n# > rock solid with 8139too driver). The computer just locks up, there is no\n# > dmesg output. This has happened since I've got this laptop (around\n# > november '03).\n# \n# It seems 8139cp.c has the race condition of rx_poll and interrupt.\n# \n# NOTE, since I don't have this device, patch is untested. Sorry.\n# --------------------------------------------\n#\ndiff -Nru a/drivers/net/8139cp.c b/drivers/net/8139cp.c\n--- a/drivers/net/8139cp.c\tSat Jan 24 19:48:25 2004\n+++ b/drivers/net/8139cp.c\tSat Jan 24 19:48:25 2004\n@@ -615,8 +615,10 @@\n \t\tif (cpr16(IntrStatus) & cp_rx_intr_mask)\n \t\t\tgoto rx_status_loop;\n \n-\t\tnetif_rx_complete(dev);\n+\t\tlocal_irq_disable();\n \t\tcpw16_f(IntrMask, cp_intr_mask);\n+\t\t__netif_rx_complete(dev);\n+\t\tlocal_irq_enable();\n \n \t\treturn 0;\t/* done */\n \t}\n@@ -643,6 +645,12 @@\n \n \tspin_lock(&cp->lock);\n \n+\t/* close possible race's with dev_close */\n+\tif (unlikely(!netif_running(dev))) {\n+\t\tcpw16(IntrMask, 0);\n+\t\tgoto out;\n+\t}\n+\n \tif (status & (RxOK | RxErr | RxEmpty | RxFIFOOvr)) {\n \t\tif (netif_rx_schedule_prep(dev)) {\n \t\t\tcpw16_f(IntrMask, cp_norx_intr_mask);\n@@ -664,7 +672,7 @@\n \n \t\t/* TODO: reset hardware */\n \t}\n-\n+out:\n \tspin_unlock(&cp->lock);\n \treturn IRQ_HANDLED;\n }\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Drivers", "Classification": "Unclassified", "Component": "Network", "Hardware": "i386 Linux", "Importance": "P2 high", "Assignee": "Jeff Garzik", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2003-10-03 22:06 UTC by Srihari Vijayaraghavan", "Modified": "2004-01-25 21:56 UTC", "CC List": "2 users", "See Also": "", "Kernel Version": "2.6.0", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["drivers/net/8139cp.c"], "methods": ["cp_rx_poll", "cp_interrupt"]}
{"id": "933", "title": "FTP NAT doesn't work in 2.6.0-test1", "description": "Distribution: Red Hat 9\nHardware Environment: \nSoftware Environment: gcc-3.3\nProblem Description:\n\nBoth IP masquerading and SNAT do not work with FTP. When I issue dir command,\nftp connection gets stuck. In ethernet sniffer I see a lot of TCP ack packets\ngoing in both directions. Both FTP client and server are Win2k boxes. \n\nSteps to reproduce:\n\nSetup a NAT box\nmodprobe ip_nat_ftp\nmodprobe ip_conntrack_ftp\niptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE (assuming eth0 is an\nexternal interface)\n\nTry ftp connection.\n\nThis setup works fine with RedHat kernel 2.4.20-18.9.", "patch": ["--- linux-2.5.75/net/ipv4/netfilter/ip_nat_helper.c.orig\t2003-07-17 19:27:53.000000000 +0200\n+++ linux-2.5.75/net/ipv4/netfilter/ip_nat_helper.c\t2003-07-17 19:30:29.000000000 +0200\n@@ -191,7 +191,7 @@\n \t\t\t\t   csum_partial((char *)tcph, tcph->doff*4,\n \t\t\t\t\t\t(*pskb)->csum));\n \tadjust_tcp_sequence(ntohl(tcph->seq),\n-\t\t\t    (int)match_len - (int)rep_len,\n+\t\t\t    (int)rep_len - (int)match_len,\n \t\t\t    ct, ctinfo);\n \treturn 1;\n }\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Networking", "Classification": "Unclassified", "Component": "Netfilter/Iptables", "Hardware": "i386 Linux", "Importance": "P2 normal", "Assignee": "Martin Josefsson", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2003-07-15 10:44 UTC by Pavel R", "Modified": "2003-07-20 23:39 UTC", "CC List": "0 users", "See Also": "", "Kernel Version": "2.5.75", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["net/ipv4/netfilter/ip_nat_helper.c"], "methods": ["ip_nat_mangle_tcp_packet"]}
{"id": "640", "title": "2.5.68-mjb2 stops at activating swap", "description": "Distribution: RH 7.3\nHardware Environment: 8-way pIII-700\nSoftware Environment:\nProblem Description:\nOn boot, the boot stops progressing at \"Activating swap\"  The machine is not\ncompletely hung (magic sysrq works) but is useless of course.  I tried this with\n2.5.68-vanilla and it does not have the same problem, but mjb1 and mjb2 do have\nthe problem.\n\nSteps to reproduce:\nHere's what I suspect it is having problems with:\n(exerpt from /etc/fstab)\n/dev/sda5               swap                    swap    defaults        0 0\n/dev/sda6               swap                    swap    defaults        0 0\n/dev/sda7               swap                    swap    defaults        0 0\n/dev/sda8               swap                    swap    defaults        0 0\n/dev/sda9               swap                    swap    defaults        0 0\n/dev/sda10              swap                    swap    defaults        0 0\n/dev/sda11              swap                    swap    defaults        0 0\n/dev/sda12              swap                    swap    defaults        0 0", "patch": ["--- linux-2.5.68-vmal_fault/arch/i386/mm/fault.c.orig\tWed Apr 30 13:36:49 2003\n+++ linux-2.5.68-vmal_fault/arch/i386/mm/fault.c\tWed Apr 30 13:36:18 2003\n@@ -405,7 +405,15 @@\n \n \t\tif (!pgd_present(*pgd_k))\n \t\t\tgoto no_context;\n+\t\t/*\n+\t\t * kernel pmd pages are shared among all processes\n+\t\t * with PAE on.  Since vmalloc pages are always\n+\t\t * in the kernel area, this will always be a \n+\t\t * waste with PAE on.\n+\t\t */\n+#ifndef CONFIG_X86_PAE\n \t\tset_pgd(pgd, *pgd_k);\n+#endif\n \t\t\n \t\tpmd = pmd_offset(pgd, address);\n \t\tpmd_k = pmd_offset(pgd_k, address);\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "Alternate Trees", "Classification": "Unclassified", "Component": "mjb", "Hardware": "i386 Linux", "Importance": "P2 normal", "Assignee": "Dave Hansen", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2003-04-25 15:21 UTC by Paul Larson", "Modified": "2003-06-05 15:04 UTC", "CC List": "0 users", "See Also": "", "Kernel Version": "2.5.68", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["arch/i386/mm/fault.c"], "methods": ["do_page_fault"]}
{"id": "583", "title": "Enabling Coda with Devfs causes Kernel Panic", "description": "Distribution: Gentoo 1.4_rc \nHardware Environment: Micron Millenia Transport, P133 (i586) \nSoftware Environment: i586-pc-linux-gnu, posix threads, gcc 3.2.2 \nProblem Description: Compiling Devfs into kernel is fine. Compiling Coda into kernel is fine. \nCompiling Devfs and Coda together is not fine, causes a kernel panic. \n \nSorry, I don't have a console - here is what I can see of the error: \n \nCPU:     0 \nEIP:     0060:[<C020605F>]    Not tainted \nEFLAGS: 00010202 \nEIP is at vsnprintf+0x2f/0x460 \neax: c2fd3f43    ebx: c2fd3f44   ecx: c040776c   edx: 00000000 \nesi: c2fd3f44    edi: 00000000   ebp: c2fd3f24    esp: c2fd3f0c \nds: 007b    es: 007b    ss: 0068 \nProcess swapper (pid: 1, threadinfo=c2fd2000 task c2fd0040) \nStack: 000001f0 c2fd3f2c c2fd3f83 c2fd3f44 c2fd3fa0 00000000 c2fd3f8c c01a4a62 \n          c2fd3f44 00000040 00000000 c2fd3f98 c01360d1 00000000 00000246 00000043 \n          00000001 00000000 c2fd3f70 c0150e47 00000018 000000d0 00000000 00000001 \n \n[<c01a4a62>] devfs_mk_dir+0x22/0xd0 \n[<c01360d1>] kmalloc+0x81/0x99 \n[<c0150e47>] register_chrdev_region+0x17/0x120 \n[<c0150f6b>] register_chrdev+0x1b/0x20 \n[<c019a9ab>] init_coda_psdev+0x4b/0x90 \n[<c019b050>] init_once+0x0/0x20 \n[<c01050a2>] init+0x32/0x190 \n[<c0105070>] init+0x0/0x190 \n[<c0107255>] kernel_thread_helper+0x50/0x10 \n \nCode: 80 3a 00 74 1d 8a 02 3c 25 74 3d 3b 75 f0 77 05 88 06 8b 55 \n<0>Kernel panic: Attempted to kill init! \n \nSteps to reproduce: \nCompile Devfs and Codafs into kernel (have not tested as modules.) This causes kernel panic \nupon boot.", "patch": ["--- linux-2.5.67/fs/coda/psdev.c.orig\t2002-12-17 21:09:56.000000000 -0500\n+++ linux-2.5.67/fs/coda/psdev.c\t2003-04-15 23:05:04.000000000 -0400\n@@ -371,7 +371,7 @@\n \t\t     CODA_PSDEV_MAJOR);\n               return -EIO;\n \t}\n-\tdevfs_mk_dir (NULL, \"coda\", NULL);\n+\tdevfs_mk_dir (\"coda\");\n \tfor (i = 0; i < MAX_CODADEVS; i++) {\n \t\tchar name[16];\n \t\tsprintf(name, \"coda/%d\", i);\n"], "Status": "CLOSED CODE_FIX", "Alias": "None", "Product": "File System", "Classification": "Unclassified", "Component": "Other", "Hardware": "i386 Linux", "Importance": "P2 blocking", "Assignee": "Jan Harkes", "URL": "", "Keywords": "", "Depends on": "", "Blocks": "", "Reported": "2003-04-14 18:49 UTC by Matt Chorman", "Modified": "2003-04-21 10:38 UTC", "CC List": "0 users", "See Also": "", "Kernel Version": "2.5.67", "Subsystem": "", "Regression": "---", "Bisected commit-id": "", "paths": ["fs/coda/psdev.c"], "methods": ["init_coda_psdev"]}
